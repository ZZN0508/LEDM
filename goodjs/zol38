(function(a){a.fn.zsuggest=function(c){var f={offsetX:0,offsetY:0,cssUrl:window.location.protocol+"//icon.zol-img.com.cn/public/css/suggest20150320.css",source:"article",defaultUrl:"//search.zol.com.cn/new/autoComplatePresetNew.php",suggestUrl:"//search.zol.com.cn/new/autoComplateZol21.php",isSuggest:true,isFixed:false};var b=a(this);var d=b.parents("form").attr("action");var c=a.extend({suggestLock:false,zSuggest:"#zSearchSuggest",sResultList:"#searchResultList"},f,c);b.bind("keydown",function(h){var g=b.attr("data-source")==""?c.source:b.attr("data-source");if(h.keyCode==8&&searchType&&g=="all"){b.parents("form").attr("action",d)}});var e={getPosition:function(){return{"width":b.width(),"height":b.height(),"left":b.offset().left,"top":b.offset().top}},loadCSS:function(){var g=a("#zSearchSuggestCSS").length>0?true:false;if(g){return}a('<link id="zSearchSuggestCSS" href="'+c.cssUrl+'" rel="stylesheet">').appendTo("head")},closeSuggest:function(){if(!c.keyword){c.suggestLock=false}else{c.suggestLock=true}var h=c.isFixed?"fixed":"absolute";var g=a(c.zSuggest+"[data-role="+h+"]");if(g.length>0){setTimeout(function(){g.hide()},100)}},createHTML:function(k){var n=this;var p=n.getPosition();var j=p.left+c.offsetX;var o=p.top+c.offsetY+p.height;var g=c.width!="undefined"?c.width:"auto";var l=c.isFixed?"fixed":"absolute";var i=a(window).scrollTop();o=c.isFixed?o-i:o;var m={"position":l,"width":g,"left":j,"top":o,"z-index":100000};var q=a(c.zSuggest);if(q.length>0){q.css(m).html(k).show()}else{var h=a('<div id="zSearchSuggest" data-role="'+l+'"></div>');h.css(m).html(k).appendTo(a("body"))}n.resizePos();a(document).bind("click",function(){n.closeSuggest()});a("#zSearchSuggest").click(function(r){r.stopPropagation();b.focus()});a("#zSearchSuggestClose").click(function(r){r.stopPropagation();n.closeSuggest()})},getSuggest:function(){var i=this;var k=b.attr("data-source")==""?c.source:b.attr("data-source");var m=['<div class="zsearch-suggest-link">','<a class="search-home" href="http://search.zol.com.cn/s/" target="_blank">\u8fdb\u5165\u641c\u7d22\u9996\u9875&gt;&gt;</a>','<a href="http://top.zol.com.cn/" target="_blank">\u70ed\u95e8\u4ea7\u54c1\u6392\u884c\u699c&gt;&gt;</a>',"</div>"].join("");if(k==="bbs"){m=['<div class="zsearch-suggest-link zsearch-suggest-link-forbbs">','<span id="zSearchSuggestClose">\u5173\u95ED</span>','<a href="http://bbs.zol.com.cn/top/" target="_blank">ZOL\u8BBA\u575B\u6392\u884C\u699C&gt;&gt;</a>',"</div>"].join("")}if(window.searchType&&location.href.indexOf("search.zol.com.cn")<-1){m=['<div class="zsearch-suggest-link">','<a class="search-home" href="http://www.zol.com.cn" target="_blank">\u8fdb\u5165\u9996\u9875&gt;&gt;</a>','<a href="http://top.zol.com.cn/" target="_blank">\u70ed\u95e8\u4ea7\u54c1\u6392\u884c\u699c&gt;&gt;</a>',"</div>"].join("")}if(arguments.length!=0){var h=c.suggestUrl+"?callback=?&m="+k+"&key="+arguments[0];if(typeof c.bbsid!=="undefined"){g+="&bbsid="+c.bbsid}if(typeof c.corp!=="undefined"){for(var j in c.corp){g+="&"+j+"="+c.corp[j]}}if(k!="all"){h="//search.zol.com.cn/new/autoComplateZolNew.php?callback=?&m="+k+"&key="+arguments[0];a.getJSON(h,function(o){if(o&&o.length!=0){var n='<ul id="searchResultList" class="talk-about-search-suggest">';a.each(o,function(r){var p=o[r].split("@#");var q="<li><em>"+p[1]+"</em><span>"+p[0]+"</span></li>";n+=q});n+="</ul>"+m;i.createHTML(n);i.bindSearchResultEvent()}else{a(c.zSuggest).hide()}})}else{a.getJSON(h,function(o){if(+o.status===1){var o=o.data;var n='<ul id="searchResultList" class="talk-about-search-suggest">';a.each(o,function(r){var p=o[r][0].split("@#");var q='<li><a target="_blank" href="'+o[r][1]+'"><em>'+p[1]+"</em><span>"+p[0]+"</span></a></li>";n+=q});n+="</ul>"+m;i.createHTML(n);i.bindSearchResultEvent()}else{if(+o.status===2){var o=o.data;var n='<ul id="searchResultList" class="talk-about-search-suggest">';a.each(o,function(r){var p=o[r].split("@#");var q="<li><em>"+p[1]+"</em><span>"+p[0]+"</span></li>";n+=q});n+="</ul>"+m;i.createHTML(n);i.bindSearchResultEvent()}else{a(c.zSuggest).hide()}}})}}else{var l=location.host;if(k=="all"){k="pro"}var g=c.defaultUrl+"?callback=?&m="+k+"&hostname="+l;if(typeof c.bbsid!=="undefined"){g+="&bbsid="+c.bbsid}if(typeof c.corp!=="undefined"){for(var j in c.corp){g+="&"+j+"="+c.corp[j]}}a.getJSON(g,function(o){if(o[k]!="null"){var n=o[k].replace(/\<a/g,'<a target="_blank"');i.createHTML(n+m);c.suggestLock=false}})}setTimeout(function(){if(k=="all"&&a(c.zSuggest).find("a").length>2){b.parents("form").attr("action",d)}},300)},keyEvent:function(g){switch(g){case 38:this.prevResult();break;case 40:this.nextResult();break}},keywordResult:function(){var g=a(c.sResultList);if(g.find(".active").length==0){b.parents("form").attr("action",d)}},nextResult:function(){var j=a(c.sResultList);if(j.length==0){return}var i=j.find("li.active");if(i.length>0){var h=i.next().length==0?c.keyword:i.next().find("span").html().replace(/<[^>].*?>/g,"");i.removeClass().next().addClass("active");b.val(h)}else{j.find("li:first").addClass("active");b.val(j.find("li:first span").html().replace(/<[^>].*?>/g,""))}if(i.find("a")){var g=i.find("a").attr("href");if(i.length>0){b.parents("form").attr("action",g);this.keywordResult()}else{this.keywordResult();j.find("li:first").addClass("active");b.parents("form").attr("action",j.find("li:first").find("a").attr("href"))}}else{b.parents("form").attr("action",d)}},prevResult:function(){var j=a(c.sResultList);if(j.length==0){return}var i=j.find("li.active");if(i.find("a")&&i.length){var g=i.find("a").attr("href");b.parents("form").attr("action",g)}else{b.parents("form").attr("action",d)}if(i.length>0){var h=i.prev().length==0?c.keyword:i.prev().find("span").html().replace(/<[^>].*?>/g,"");i.removeClass().prev().addClass("active");b.val(h);this.keywordResult()}else{j.find("li:last").addClass("active");this.keywordResult();b.val(j.find("li:last span").html().replace(/<[^>].*?>/g,""))}},bindSearchResultEvent:function(){var g=this;var h=a(c.sResultList).find("li");h.hover(function(){a(this).addClass("active")},function(){a(this).removeClass("active")});a("#zSearchSuggest .r-buy").click(function(m){g.closeSuggest();m.stopPropagation();eventName="pc_search_first";var l=document.cookie.match(/ip_ck=([^;$]+)/);if(l){l=l[1]}var i=typeof(url)==="undefined"?document.URL:url;var k="//pvtest.zol.com.cn/images/pvevents.gif?t="+new Date().getTime()+"&event="+eventName+"&ip_ck="+l+"&url="+i;var j=new Image();j.src=k;return a(this)});h.click(function(){var i=b.attr("data-source")==""?c.source:b.attr("data-source");b.val(a(this).find("span").html().replace(/<[^>].*?>/g,"")).focus();g.closeSuggest();if(i!="all"){if(b.attr("data-source")!="undefined"&&b.attr("data-source")!=""){b.parent().parent("form").submit()}else{b.parent("form").submit()}}else{if(!a(this).find("a").length){b.parents("form").submit()}}})},resizePos:function(){var g=this;a(window).resize(function(){var h=g.getPosition().left+c.offsetX;a(c.zSuggest).css("left",h)})}};e.loadCSS();return this.each(function(){var i=!-[1,]&&!window.XMLHttpRequest;if(i){return}b.attr({"data-source":"","autocomplete":"off"});b.click(function(j){j.stopPropagation()});var g=null;b.bind("focus",function(){if(c.suggestLock){return}if(g){clearTimeout(g)}g=setTimeout(function(){e.getSuggest()},200)});b.bind("blur",function(){});var h=null;b.bind("keyup",function(k){var l=k.keyCode;if((/38$|40$|13$|108$/.test(k.keyCode))){k.preventDefault();k.stopPropagation();e.keyEvent(l)}else{var j=a.trim(b.val());c.keyword=j;if(j==""){if(c.suggestLock){setTimeout(function(){e.getSuggest()},100)}return}if(!c.isSuggest&&j!=""){e.closeSuggest();return}if(h){clearTimeout(h)}h=setTimeout(function(){e.getSuggest(j);c.suggestLock=true},200)}})})}})(jQuery);