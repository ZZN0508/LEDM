!function(){function addHandler(e,t,n){return e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)}function whiteServerList(e){for(var t=!1,n=[/\.huya\.com$/,/\.yaoguo\.com$/,/\.huyakeji\.com$/],i=0;i<n.length;i++)if(n[i].test(e)){t=!0;break}return t}function byId(e){return"string"==typeof e?document.getElementById(e):e}function byTagName(e,t){return(t||document).getElementsByTagName(e)}function getCookieVal(e){for(var t=document.cookie.split("; "),n=0;n<t.length;n+=1){var i=t[n].split("=");if(i[0]==e)return decodeURIComponent(i[1])}return""}function css(e,t,n){if(2==arguments.length){if("string"==typeof arguments[1])return parseFloat(e.currentStyle?e.currentStyle[t]:getComputedStyle(e,null)[t]);for(var i in t)"opacity"==i?(e.style.filter="alpha(opacity="+t[i]+")",e.style.opacity=t[i]/100):e.style[i]=t[i]}else if(3==arguments.length)switch(t){case"width":case"height":case"top":case"right":case"bottom":case"left":case"marginTop":case"marginRigth":case"marginBottom":case"marginLeft":e.style[t]=n+"px";break;case"opacity":e.style.filter="alpha(opacity="+n+")",e.style.opacity=n/100;break;default:e.style[t]=n}}function sendReport(e,t,n,i){if(window.JSON&&window.JSON.stringify)try{var o=document.getElementsByTagName("head")[0],r=document.createElement("script");o.appendChild(r);var a="https://udblog.huya.com/web/log/report?request=",s={topic:"huyaudb",json:JSON.stringify({term_type:4,net_type:2,carrier_type:2,user_type:"",device_id:getCookieVal("udb_guiddata")||"",device_name:navigator.platform,system_info:navigator.userAgent,appid:5002,sdk_ver:"2.4",local_time:(new Date).getTime(),uid:getCookieVal("udb_uid")||0,uri:i,ui_cmd:encodeURIComponent(location.href),context:"ER-"+getCookieVal("udb_guiddata")+"-"+getCookieVal("__yamid_new")+"-"+getCookieVal("guid"),rsp_time:e,rescode:t,strategy:"","detail:":n})};r.src=a+encodeURIComponent(JSON.stringify(s)),o.removeChild(r)}catch(c){}}function credLogin(e){function t(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"==e?t:3&t|8;return n.toString(16)})}function n(){try{o(c,{uri:"70015",version:e.VERSION,context:"1",appId:e.appid,appSign:r(e.appid+"_"+e.VERSION+"_"+e.appKey),lcid:"2052",traceid:a,sdid:window.localStorage.sdid,data:{page:encodeURIComponent(window.location.href)}},function(e){e.data.writeCookieFlag&&(getCookieVal("udb_biztoken")?sendReport(0,a,"cookieExchange",320001):sendReport(0,a,"cookieExchangeError",320001))})}catch(t){window.console&&console.log(t)}}var i=["//udblgn-test.huya.com","//udblgn.huya.com"],o=function(){var e=0,t=function(t){var n=++e+"";return t?t+n:n},n={init:function(){function e(e,t,n){return e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)}var t=this;e(window,"message",function(e){for(var n=e.origin+"/",o=!1,r=0;r<i.length;r++)if(n.indexOf(i[r])>-1){o=!0;break}if(o)try{var a=JSON.parse(e.data);t[a.callbackName]&&t[a.callbackName](a.data),t[a.callbackName]&&delete t[a.callbackName]}catch(e){window.console&&console.log(e)}})},getIframe:function(e,n,o){var r=this;this.createIframe(e,function(a){var s=t("proxyCallback"),c=n&&n.type;c&&delete n.type;var u={callbackName:s,uri:"cookieExchange",version:"2.0",exchange:"",context:"",returnCode:"cookieExchange",message:"",description:"",type:c,url:e,data:n};r[s]=function(e){o(e)};for(var d=/\/\/([^\/]*\/)/gi.exec(a.src),l=0;l<i.length;l++)if(d&&d[0]&&d[0].indexOf(i[l])>-1){a.contentWindow.postMessage(JSON.stringify(u),location.protocol+i[l]);break}})},createIframe:function(e,t){var n=/\/\/([^\/]*)\//g.exec(e)[1],i=this;if(this[n]&&"createIng"!==this[n].status)t(this[n].frame);else if(this[n])this[n].queue.push(t);else{var o=document.createElement("iframe"),r=function(){if(i[n].frame=o,t(o),i[n].queue)for(var e=0;e<i[n].queue.length;e++)i[n].queue[e](o);delete i[n].queue,delete i[n].status};this[n]={},this[n].queue=[],this[n].status="createIng",o.src="//"+n+"/proxy.html",o.attachEvent?o.attachEvent("onload",function(){r()}):o.onload=function(){r()},o.style.display="none",document.body.appendChild(o)}}};return n.init(),function(e,t,i){return n.getIframe(e,t,i)}}(),r=function(e){function t(e,t){return e<<t|e>>>32-t}function n(e,t){var n,i,o,r,a;return o=2147483648&e,r=2147483648&t,n=1073741824&e,i=1073741824&t,a=(1073741823&e)+(1073741823&t),n&i?2147483648^a^o^r:n|i?1073741824&a?3221225472^a^o^r:1073741824^a^o^r:a^o^r}function i(e,t,n){return e&t|~e&n}function o(e,t,n){return e&n|t&~n}function r(e,t,n){return e^t^n}function a(e,t,n){return t^(e|~n)}function s(e,o,r,a,s,c,u){return e=n(e,n(n(i(o,r,a),s),u)),n(t(e,c),o)}function c(e,i,r,a,s,c,u){return e=n(e,n(n(o(i,r,a),s),u)),n(t(e,c),i)}function u(e,i,o,a,s,c,u){return e=n(e,n(n(r(i,o,a),s),u)),n(t(e,c),i)}function d(e,i,o,r,s,c,u){return e=n(e,n(n(a(i,o,r),s),u)),n(t(e,c),i)}function l(e){for(var t,n=e.length,i=n+8,o=(i-i%64)/64,r=16*(o+1),a=Array(r-1),s=0,c=0;n>c;)t=(c-c%4)/4,s=c%4*8,a[t]=a[t]|e.charCodeAt(c)<<s,c++;return t=(c-c%4)/4,s=c%4*8,a[t]=a[t]|128<<s,a[r-2]=n<<3,a[r-1]=n>>>29,a}function f(e){var t,n,i="",o="";for(n=0;3>=n;n++)t=e>>>8*n&255,o="0"+t.toString(16),i+=o.substr(o.length-2,2);return i}function g(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var i=e.charCodeAt(n);128>i?t+=String.fromCharCode(i):i>127&&2048>i?(t+=String.fromCharCode(i>>6|192),t+=String.fromCharCode(63&i|128)):(t+=String.fromCharCode(i>>12|224),t+=String.fromCharCode(i>>6&63|128),t+=String.fromCharCode(63&i|128))}return t}var h,p,m,y,S,v,L,w,k,b=Array(),_=7,x=12,C=17,U=22,I=5,O=9,T=14,N=20,D=4,B=11,E=16,R=23,H=6,V=10,$=15,A=21;for(e=g(e),b=l(e),v=1732584193,L=4023233417,w=2562383102,k=271733878,h=0;h<b.length;h+=16)p=v,m=L,y=w,S=k,v=s(v,L,w,k,b[h+0],_,3614090360),k=s(k,v,L,w,b[h+1],x,3905402710),w=s(w,k,v,L,b[h+2],C,606105819),L=s(L,w,k,v,b[h+3],U,3250441966),v=s(v,L,w,k,b[h+4],_,4118548399),k=s(k,v,L,w,b[h+5],x,1200080426),w=s(w,k,v,L,b[h+6],C,2821735955),L=s(L,w,k,v,b[h+7],U,4249261313),v=s(v,L,w,k,b[h+8],_,1770035416),k=s(k,v,L,w,b[h+9],x,2336552879),w=s(w,k,v,L,b[h+10],C,4294925233),L=s(L,w,k,v,b[h+11],U,2304563134),v=s(v,L,w,k,b[h+12],_,1804603682),k=s(k,v,L,w,b[h+13],x,4254626195),w=s(w,k,v,L,b[h+14],C,2792965006),L=s(L,w,k,v,b[h+15],U,1236535329),v=c(v,L,w,k,b[h+1],I,4129170786),k=c(k,v,L,w,b[h+6],O,3225465664),w=c(w,k,v,L,b[h+11],T,643717713),L=c(L,w,k,v,b[h+0],N,3921069994),v=c(v,L,w,k,b[h+5],I,3593408605),k=c(k,v,L,w,b[h+10],O,38016083),w=c(w,k,v,L,b[h+15],T,3634488961),L=c(L,w,k,v,b[h+4],N,3889429448),v=c(v,L,w,k,b[h+9],I,568446438),k=c(k,v,L,w,b[h+14],O,3275163606),w=c(w,k,v,L,b[h+3],T,4107603335),L=c(L,w,k,v,b[h+8],N,1163531501),v=c(v,L,w,k,b[h+13],I,2850285829),k=c(k,v,L,w,b[h+2],O,4243563512),w=c(w,k,v,L,b[h+7],T,1735328473),L=c(L,w,k,v,b[h+12],N,2368359562),v=u(v,L,w,k,b[h+5],D,4294588738),k=u(k,v,L,w,b[h+8],B,2272392833),w=u(w,k,v,L,b[h+11],E,1839030562),L=u(L,w,k,v,b[h+14],R,4259657740),v=u(v,L,w,k,b[h+1],D,2763975236),k=u(k,v,L,w,b[h+4],B,1272893353),w=u(w,k,v,L,b[h+7],E,4139469664),L=u(L,w,k,v,b[h+10],R,3200236656),v=u(v,L,w,k,b[h+13],D,681279174),k=u(k,v,L,w,b[h+0],B,3936430074),w=u(w,k,v,L,b[h+3],E,3572445317),L=u(L,w,k,v,b[h+6],R,76029189),v=u(v,L,w,k,b[h+9],D,3654602809),k=u(k,v,L,w,b[h+12],B,3873151461),w=u(w,k,v,L,b[h+15],E,530742520),L=u(L,w,k,v,b[h+2],R,3299628645),v=d(v,L,w,k,b[h+0],H,4096336452),k=d(k,v,L,w,b[h+7],V,1126891415),w=d(w,k,v,L,b[h+14],$,2878612391),L=d(L,w,k,v,b[h+5],A,4237533241),v=d(v,L,w,k,b[h+12],H,1700485571),k=d(k,v,L,w,b[h+3],V,2399980690),w=d(w,k,v,L,b[h+10],$,4293915773),L=d(L,w,k,v,b[h+1],A,2240044497),v=d(v,L,w,k,b[h+8],H,1873313359),k=d(k,v,L,w,b[h+15],V,4264355552),w=d(w,k,v,L,b[h+6],$,2734768916),L=d(L,w,k,v,b[h+13],A,1309151649),v=d(v,L,w,k,b[h+4],H,4149444226),k=d(k,v,L,w,b[h+11],V,3174756917),w=d(w,k,v,L,b[h+2],$,718787259),L=d(L,w,k,v,b[h+9],A,3951481745),v=n(v,p),L=n(L,m),w=n(w,y),k=n(k,S);return(f(v)+f(L)+f(w)+f(k)).toLowerCase()},a=t(),s="//udblgn.huya.com/web/credLogin",c="//udblgn.huya.com/web/cookieExchange";try{if(getCookieVal("udb_cred")&&(!getCookieVal("udb_uid")||!getCookieVal("udb_biztoken"))){var u=+new Date;o(s,{uri:"70017",version:e.VERSION,context:"1",appId:e.appid,appSign:r(e.appid+"_"+e.VERSION+"_"+e.appKey),lcid:"2052",sdid:window.localStorage.sdid,data:{page:encodeURIComponent(window.location.href)}},function(e){if(0===e.returnCode){var t=+new Date-u;5e3>t&&window.location.reload()}})}}catch(d){window.console&&console.log(d)}var l=12e5,f=!0;try{(location.href.indexOf("test-www.huya.com")>-1||location.href.indexOf("www.huya.com")>-1)&&document.addEventListener("visibilitychange",function(){f=!document.hidden})}catch(d){}setInterval(function(){f&&n()},l)}function HyLogin(){this.initialize.apply(this,arguments)}var Events=function(){function e(){this.__events={},this.__interimCache={}}function t(e,t,n){var i=!0;if(e){var o=0,r=e.length,a=t[0],s=t[1],c=t[2];switch(t.length){case 0:for(;r>o;o+=2)i=e[o].call(e[o+1]||n)!==!1&&i;break;case 1:for(;r>o;o+=2)i=e[o].call(e[o+1]||n,a)!==!1&&i;break;case 2:for(;r>o;o+=2)i=e[o].call(e[o+1]||n,a,s)!==!1&&i;break;case 3:for(;r>o;o+=2)i=e[o].call(e[o+1]||n,a,s,c)!==!1&&i;break;default:for(;r>o;o+=2)i=e[o].apply(e[o+1]||n,t)!==!1&&i}}return i}function n(e){return"[object Function]"===Object.prototype.toString.call(e)}function i(e,t){if(e.forEach)return e.forEach(t);for(var n=0;n<e.length;n+=1)t(e[n],n,e)}var o=/\s+/;e.prototype.on=function(e,t,n){var i,r,a;if(!t)return this;for(i=this.__events,e=e.split(o);r=e.shift();)a=i[r]||(i[r]=[]),a.push(t,n),this.__interimCache[r]&&(this.trigger.apply(this,[r].concat(this.__interimCache[r])),delete this.__interimCache[r]);return this},e.prototype.once=function(e,t,n){var i=this,o=function(){i.off(e,o),t.apply(n||i,arguments)};return this.on(e,o,n)},e.prototype.off=function(e,t,n){var i,a,s,c;if(!(i=this.__events))return this;if(!(e||t||n))return delete this.__events,this;for(e=e?e.split(o):r(i);a=e.shift();)if(s=i[a])if(t||n)for(c=s.length-2;c>=0;c-=2)t&&s[c]!==t||n&&s[c+1]!==n||s.splice(c,2);else delete i[a];return this},e.prototype.trigger=function(e){var n,i,r,a,s,c,u=[],d=!0;if(!(n=this.__events))return this;for(e=e.split(o),s=1,c=arguments.length;c>s;s++)u[s-1]=arguments[s];for(;i=e.shift();)(r=n.all)&&(r=r.slice()),(a=n[i])&&(a=a.slice()),"all"!==i&&(d=t(a,u,this)&&d),a||(this.__interimCache[i]=u),d=t(r,[i].concat(u),this)&&d;return d},e.prototype.emit=e.prototype.trigger;var r=Object.keys;return r||(r=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t}),e.mixTo=function(t){t=n(t)?t.prototype:t;var o=e.prototype,r=new e;i(Object.keys(o),function(e){t[e]=function(){return o[e].apply(r,Array.prototype.slice.call(arguments)),this}})},e}(),LoginSkeleton=function(){this.initialize.apply(this,arguments)};LoginSkeleton.prototype={initialize:function(){this.iframeLoadStatus=!1,this.iframe=null,function(){var e="#UDBSdkLgn{display:none;position:fixed;z-index:99998;top:0;left:0;width:100%;height:100%}#UDBSdkLgn-mask{width:100%;height:100%;opacity:.5;background:#000;filter:Alpha(Opacity=50)}#UDBSdkLgn-box{position:absolute;top:50%;left:50%;width:520px;height:340px;margin:-185px 0 0 -260px;border-radius:4px;background:#fff}#UDBSdkLgn_iframe{border-radius:4px;height:100%}",t=function(e){var t=document.getElementsByTagName("head")[0],n=document.createElement("style");if(t.appendChild(n),n.styleSheet)n.styleSheet.disabled||(n.styleSheet.cssText=e);else try{n.innerHTML=e}catch(i){n.innerText=e}};t(e)}(),this._createHtml()},_createHtml:function(){var tmpl=function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='\r\n<div id="UDBSdkLgn-mask"></div>\r\n<div id="UDBSdkLgn-box"></div>\r\n';return __p};this.$UDBSdkLgn=document.createElement("div"),this.$UDBSdkLgn.id="UDBSdkLgn",this.$UDBSdkLgn.innerHTML=tmpl(),byTagName("body")[0].appendChild(this.$UDBSdkLgn),this.$UDBSdkLgnBox=byId("UDBSdkLgn-box")},reportTimer:null,createUDBSdkLgnIframe:function(e){var t=this,n=(new Date).getTime();return t.reportTimer&&clearTimeout(t.reportTimer),t.reportTimer=setTimeout(function(){t.reportTimer=null,sendReport((new Date).getTime()-n,-1e3,"登录框html加载失败",32e4)},5e3),this.iframe?(this.iframeLoadStatus?this.sendMessToIframe(e.data):events.on("pageOnload",function(){t.reportTimer&&(sendReport((new Date).getTime()-n,0,"登录框html加载成功",32e4),clearTimeout(t.reportTimer)),t.sendMessToIframe(e.data)}),!1):(e.data.opt.embedDom&&(this.$UDBSdkLgnBox=e.data.opt.embedDom,e.data.opt.embedDom=!0),this.$UDBSdkLgnBox.innerHTML='<iframe src="'+e.url+'" frameborder="0" width="100%" height="100%" scrolling="no" id="UDBSdkLgn_iframe"></iframe>',this.iframe=byId("UDBSdkLgn_iframe"),void events.on("pageOnload",function(){t.iframeLoadStatus=!0,t.reportTimer&&(sendReport((new Date).getTime()-n,0,"登录框html加载成功",32e4),clearTimeout(t.reportTimer)),t.sendMessToIframe(e.data)}))},show:function(e){this.createUDBSdkLgnIframe(e),e.data.opt.embedDom||css(this.$UDBSdkLgn,{display:"block"})},setHeight:function(e){css(this.$UDBSdkLgnBox,{height:e+"px"})},hide:function(){css(this.$UDBSdkLgn,{display:"none"}),this.iframeLoadStatus=!1,this.iframe=null,this.$UDBSdkLgnBox.innerHTML="",events.off("pageOnload")},sendMessToIframe:function(e){this.iframe&&this.iframeLoadStatus&&this.iframe.contentWindow.postMessage(JSON.stringify(e),"*")},showLayer:function(){css(this.$UDBSdkLgn,{display:"block"})}};var events=new Events,loginSkeleton=new LoginSkeleton;HyLogin.prototype={initialize:function(e){var t=this;this.options=e||{},this.upgradeStatus=!1,this.options.pageUrl=window.location.href,this.options.pageReferrerUrl=document.referrer,(location.href.indexOf("test-www.huya.com")>-1||location.href.indexOf("www.huya.com")>-1||location.href.indexOf("yowa.huya.com")>-1)&&credLogin({appid:t.options.appid||"5002",appKey:t.options.appKey||"bfd434f70d40433c6b57a781dbcee91a",VERSION:"2.6"}),this.options.initSuccess&&"function"==typeof this.options.initSuccess&&(this.initSuccess=this.options.initSuccess);var n=new Date;n.setMinutes(0),n.setSeconds(0),n.setMilliseconds(0),n=n.getTime();var i=this.options.domainList?this.options.domainList:"huya.com";this.LOGIN_URL="//aq."+i+"/p/udb_login.html?v="+n,this.options.noThirdLogin&&(this.LOGIN_URL=this.LOGIN_URL.indexOf("?")>-1?this.LOGIN_URL+"&noThirdLogin=1":this.LOGIN_URL+"?noThirdLogin=1"),this._listener(),events.on("loginSuccess",function(e){0==t.upgradeStatus&&t.emit("loginSuccess",e)}),events.on("loginAuthSuccess",function(e){0==t.upgradeStatus&&t.emit("loginAuthSuccess",e)}),events.on("loginFail",function(e){t.emit("loginFail",e)}),events.on("loginAuthFail",function(e){t.emit("loginAuthFail",e)}),events.on("logoutSuccess",function(e){t.emit("logoutSuccess",e)}),events.on("logoutFail",function(e){t.emit("logoutFail",e)}),events.on("loginClose",function(e){t.emit("loginClose",e)})},_setLayerHeight:function(e){loginSkeleton.setHeight(e.height)},_sendUpgradeStatus:function(e){this.upgradeStatus=e.upgradeStatus},_showLayer:function(){loginSkeleton.showLayer()},_setLocalStorage:function(e){localStorage[e.key]=e.val},_loginSuccess:function(e){window.HyLogin.notice("loginSuccess",e)},_loginAuthSuccess:function(e){window.HyLogin.notice("loginAuthSuccess",e)},_logoutFail:function(){window.HyLogin.notice("logoutFail")},_logoutSuccess:function(){window.HyLogin.notice("logoutSuccess")},_loginPageOnload:function(){events.emit("pageOnload")},_listener:function(){var e=this;addHandler(window,"message",function(t){if(!whiteServerList(t.origin))return!1;var n={};try{n=JSON.parse(t.data)}catch(t){}e[n.fnName]&&"function"==typeof e[n.fnName]&&e[n.fnName](n.data)})},login:function(){loginSkeleton.show({url:this.LOGIN_URL,data:{opt:this.options,origin:"udbSdkWeb",fnName:"login"}})},register:function(){loginSkeleton.show({url:this.LOGIN_URL,data:{opt:this.options,origin:"udbSdkWeb",fnName:"register"}})},third:function(e){loginSkeleton.createUDBSdkLgnIframe({url:this.LOGIN_URL,data:{opt:this.options,args:e,origin:"udbSdkWeb",fnName:"third"}})},logout:function(){loginSkeleton.createUDBSdkLgnIframe({url:this.LOGIN_URL,data:{opt:this.options,origin:"udbSdkWeb",fnName:"logout"}})},closeUdbLogin:function(e){window.HyLogin.notice("loginClose"),e&&1==e.reLoad&&window.location.reload(),loginSkeleton.hide()}},Events.mixTo(HyLogin),window.HyLogin=HyLogin,HyLogin.notice=function(e,t){events.emit(e,t)}}();