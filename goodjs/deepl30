"use strict";(self.webpackChunk_deepl_gatsby=self.webpackChunk_deepl_gatsby||[]).push([[2745],{18149:function(e,t,n){n.d(t,{j:function(){return o}});var l=n(27378),r=n(34681),s=n(49359);let o=e=>{let{textSource:t,textTarget:n,langSource:o,langTarget:a,onHide:i,oldTextareaStyling:g=!1}=e,{t:h}=(0,r.$)("glossary"),f=h("tooltip_highlight_text",{sourceText:"|",targetText:"|"}).split("|"),c="."!==f[2][0];return(0,l.useEffect)(()=>(window.addEventListener("scroll",i),()=>window.removeEventListener("scroll",i)),[i]),l.createElement("div",{id:"targetHighlightTooltip",className:(0,s.Ch)("lmt__glossary_tooltip",!g&&"!relative !block"),"data-testid":"glossary-highlight-tooltip"},l.createElement("span",null,f[0]),l.createElement("span",{className:"columnSource",lang:o},`"${t}"`),l.createElement("span",null,f[1]),l.createElement("span",{className:(0,s.Ch)("columnTarget",c&&"padRight"),lang:a},`"${n}"`),l.createElement("span",null,f[2]))}},11929:function(e,t,n){let l;var r=n(4769),s=n(67974),o=n(61606),a=n(94982),i=n(89550),g=n(89355),h=n(94434),f=n(46625),c=n(27378),d=n(31542),u=n(18149),p=n(97306),x=n(25889),v={glossaryHighlightNewTextarea:"targetHighlightAdapter-module--glossaryHighlightNewTextarea--R8Otw"};let m="adapted__",T="glossary-tooltip-portal-node";function I(){return document.getElementById(T)}function E(e,t){let n=Array.from(e.highlightState.getInnerSentenceHighlights().values());return n.some(e=>e.optimizationMode===t)}function S(e,t){let n=[];if(t){let l=new Set(t.map(e=>e.getId()));for(let[t,r]of e)t.node&&r.some(e=>e.sentence&&l.has(e.sentence.getId()))&&n.push(t.node)}else for(let[t,l]of e)t.node&&n.push(t.node);n.forEach(e=>e._markAsChanged())}o.Z.defineType("/translator/core/highlightManagement",["/translator/core/textareas","/translator/core/paragraphHandling","/translator/core/updateSourceSentences","webTranslatorCore","/translator/environment/localizedTexts","/translator/smartEditing/updateTargetSentencesFromText"],(e,t,n,o,N,y)=>{let b=new Map,C=new Map,w=e.getSourceDTextarea(),A=e.getTargetDTextarea(),M=new WeakMap,O=new WeakMap,H=new IntersectionObserver(e=>{e.forEach(e=>{let{isIntersecting:t,target:n}=e,l=M.get(n);if(!l)return;let r=O.get(l);O.set(l,{...r,visible:t}),P(l)})},{threshold:0});function D(e){return S(t.getSourceAlignment(),e),(0,s.wx)("highlightManagement_triggerSourceHighlightUpdate",()=>{w.applyInternalChanges(!1)},0)}function _(e){return S(t.getTargetAlignment(),e),(0,s.wx)("highlightManagement_triggerTargetHighlightUpdate",()=>{A.applyInternalChanges(!1)},0)}function P(e){e instanceof i.t?D([e]):_([e])}function L(t,n,s,i){let S=new Map,y=new Set(n);s.forEach((e,t)=>{y.has(t.node)&&S.set(t,e)}),S.forEach((n,s)=>{let i=s.node;n.forEach(n=>{let{sentence:s,text:S,paragraphOffset:y,sentenceOffset:b}=n;if(!s||0===s.getText().length)return;s instanceof a.Z&&function(e,t,n,s){if(e.highlightState.getInnerSentenceHighlights().forEach((t,n)=>{n.startsWith(m)&&e.highlightState.setInnerSentenceHighlight(n,null)}),!e.highlights||!e.highlights.length)return;let o=()=>{};l||(n.features.with(["/translator/smartEditing/alternativeTranslationsTooltip"],e=>{o=t=>e.isEnabled(t)}),n.features.with(["/translator/web/focusedWordHighlight"],e=>{o=t=>e.enabledTooltipOnHover(t)}));let a=e.getTranslation(),i=a?e.getWhitespacesBefore()+a.getTargetText()+e.getWhitespacesAfter():"",h=new Map;e.highlights.forEach(l=>{var a,f;let{normalizedOffset:m,normalizedLength:E,type:S}=l;if(!h.has(S)){let a=function(e,t,n,l,s,o,a){void 0===a&&(a=!1);let i=e.type;return{classes:[].concat((0,r.Z)(e.classes),[`${v.glossaryHighlightNewTextarea}`]),ranges:[],validationMode:g.s.SENTENCE_CONTENT_UNCHANGED,optimizationMode:"none",referenceText:t,eventListeners:{mouseenter:(e,t,r,g)=>{if(a||r[0].getAttachmentNode(i))return;let f=function(){let e=document.createElement("div");return e.style.position="absolute",e.style.top="100%",e.style.left="-8px",e}();r[0].setAttachmentNode(i,f),n.updateTargetTextareaDOM(),function(e,t,n,l,r,s){let{textSource:o,textTarget:a}=e,i=I();i||((i=document.createElement("div")).id=T,i.classList.add("fixed","z-[10000]","w-[200px]","empty:hidden"),document.documentElement.appendChild(i));let g=t.getBoundingClientRect();i.style.left=`${g.x}px`,i.style.top=`${g.y+g.height}px`,function(e,t){var n;let l=e.getBoundingClientRect(),r=null!==(n=t._rootDomNode.closest(".lmt__textarea_container"))&&void 0!==n?n:t._rootDomNode,s=r.getBoundingClientRect();l.right>s.right&&(e.style.transform=`translate(${s.right-l.right}px, 0)`)}(i,r.getTargetDTextarea());let h=n._internalLanguageManagement.getLangAttributeForSelectedSourceLang(),f=n._internalLanguageManagement.getLangAttributeForSelectedTargetLang();d.render(c.createElement(p.L,{value:l},c.createElement(u.j,{textSource:o,textTarget:a,langSource:h,langTarget:f,onHide:s})),i)}(g.customData.tooltipData,f,l,s,n,()=>h(r[0])),o(!1)},mouseleave:(e,t,n)=>{h(n[0])},click:(e,t,n)=>{h(n[0])}}};function h(e){let t=I();t&&d.unmountComponentAtNode(t),e.removeAttachmentNode(i),n.updateTargetTextareaDOM(),o(!0)}}(l,i,t,n,s,o,e.highlightState.getInnerSentenceHighlights().has("targetPopup"));h.set(S,a)}let N=null!==(a=x.ZP.getOffsetForNormalizedOffset(i,m))&&void 0!==a?a:0,y=null!==(f=x.ZP.getOffsetForNormalizedOffset(i,m+E))&&void 0!==f?f:0;h.get(S).ranges.push({offset:N,length:y-N,customData:{tooltipData:l.tooltipData}})}),h.forEach((t,n)=>{e.highlightState.setInnerSentenceHighlight(`${m}${n}`,t)})}(s,e,o,N);let C=s.highlightState.getSentenceHighlights(),w=s.highlightState.getInnerSentenceHighlights();if(0!==C.size||0!==w.size)try{let e=function(e,t,n,l,s,o){let a=Array.from(s).flatMap(e=>{var t;return null!==(t=e[1].classes)&&void 0!==t?t:[]}),i=n.length,g=e.encapsulateContentByOffset(t,l,i,{type:h.$P.INLINE,tag:"span",classes:["sentence_highlight"].concat((0,r.Z)(a)),nonContentNodeType:`sentence_highlight_${o.getId()}`});if(0===g.length)throw Error("Missing sentence node");g.length;let f=g[0];return s.forEach(e=>{e.eventListeners&&Object.entries(e.eventListeners).forEach(e=>{let[t,n]=e;f.addEventListener(t,e=>n(e,[f.getDomNode()],g))})}),f.onDomNodeCreated=(e,t)=>{M.set(e,o),E(o,"visibility")&&H.observe(e),s.forEach(t=>{t.onDomNodeCreated&&t.onDomNodeCreated(e)})},f}(t,i,S,y,C,s);E(s,"hover")&&(e.addEventListener("mouseenter",e=>{let t=O.get(s);O.set(s,{...t,hovered:!0}),P(s)}),e.addEventListener("mouseleave",e=>{let t=O.get(s);O.set(s,{...t,hovered:!1}),P(s)})),w.size>0&&function(e,t,n,l,s){let o=n.keys(),a=t.collectText();for(let c of o){let o=n.get(c),{optimizationMode:d}=o,u=O.get(s);if(("visibility"!==d||(null==u?void 0:u.visible)!==!1)&&("hover"!==d||(null==u?void 0:u.hovered)!==!1))for(let n of o.ranges){let s=function(e,t,n,l){var s;if(void 0===t.referenceText)return{offset:e.offset-l,length:e.length};let o=`${t.referenceText}
`.indexOf("\n",l),a=null===(s=t.referenceText)||void 0===s?void 0:s.substring(l,o);if(a===n)return{offset:e.offset-l,length:e.length};if(t.validationMode===g.s.SENTENCE_CONTENT_UNCHANGED)return null;let{offset:i,length:h}=e,c=function(e,t,n){if(e===t)return(0,r.Z)(n);let l=n.map((t,n)=>({offset1:Math.max(0,Math.min(e.length-1,t)),offset2:void 0,entryIndex:n})),s=(0,r.Z)(l).sort((e,t)=>e.offset1-t.offset1),o=(0,f.Hg)(e,t),a=0,i=0;for(;o.length&&s.length;){let e=o.shift();if(Array.isArray(e)){let[t,n]=e,l=a+t;for(;s.length&&l>s[0].offset1;)s[0].offset2=void 0,s.shift();a=l,i+=n}else{let t=a+e;for(;s.length&&t>s[0].offset1;)s[0].offset2=i+s[0].offset1-a,s.shift();a=t,i+=e}}let g=[];return l.forEach(e=>{g[e.entryIndex]=e.offset2}),g}(t.referenceText,n,h>1?[i,i+h-1]:[i]);if(0===c.length||c.some(e=>void 0===e))return null;if(t.validationMode===g.s.HIGHLIGHT_CONTENT_UNCHANGED){let e=t.referenceText.slice(i,i+h),l=n.slice(c[0],c[1]+1);if(e!==l)return null}return{offset:c[0],length:c[c.length-1]-c[0]+1}}(n,o,a,l);if(s&&s.offset>=0){var i;let l=e.encapsulateContentByOffset(t,s.offset,s.length,{type:h.$P.INLINE,tag:"span",classes:o.classes,nonContentNodeType:null!==(i=o.domNodeReuseId)&&void 0!==i?i:c});o.eventListeners&&l.forEach(e=>{Object.entries(o.eventListeners).forEach(t=>{let[r,s]=t;e.addEventListener(r,e=>{let t=l.map(e=>e.getDomNode()).filter(e=>e);s(e,t,l,n)})})}),o.onDomNodeCreated&&l.forEach(e=>{e.onDomNodeCreated=e=>{o.onDomNodeCreated(e,n,s)}}),o.onNodesCreated&&o.onNodesCreated(l)}}}}(t,e,w,b,s)}catch(e){}})})}function G(e,t,n){var l;let r=null===(l=n?A:w)||void 0===l?void 0:l._rootDomNode;if(!r)return;let s=n?C:b;if(s.has(e)){let{classes:t}=s.get(e);t.forEach(e=>r.classList.remove(e))}else if(!t)return;t?(s.set(e,t),t.classes.forEach(e=>r.classList.add(e))):s.delete(e)}function $(e,t){var n;return null!==(n=(t?C:b).get(e))&&void 0!==n?n:null}function k(e){var t;let n=null===(t=e?A:w)||void 0===t?void 0:t._rootDomNode;if(!n)return;let l=e?C:b,r=l.keys();for(let e of r){let{classes:t}=l.get(e);t.forEach(e=>n.classList.remove(e)),l.delete(e)}}return w.setFinalizeNodesHandler((e,n,l)=>{L(e,n,t.getSourceAlignment(),!1)}),w.applyInternalChanges(!1),A.setFinalizeNodesHandler((e,n,l)=>{y.ensureTargetSentenceAreUpToDate(),L(e,n,t.getTargetAlignment(),!0)}),A.applyInternalChanges(!1),n.onSourceSentencesChanged.push(()=>{D()}),{notifyTargetSentencesChanged:e=>_(e),notifySourceSentencesChanged:e=>D(e),setGlobalSourceHighlight(e,t){G(e,t,!1)},setGlobalTargetHighlight(e,t){G(e,t,!0)},getGlobalSourceHighlight:e=>$(e,!1),getGlobalTargetHighlight:e=>$(e,!0),clearGlobalSourceHighlights(){k(!1)},clearGlobalTargetHighlights(){k(!0)}}})},41537:function(e,t,n){var l,r=n(4769),s=n(61606),o=n(46625),a=(n(71968),n(25889)),i=n(98808);function g(e,t,n){return e.slice(-n)===t.slice(-n)}function h(e,t,n,l){void 0===n&&(n=null),void 0===l&&(l=!1);let s="[alignSentencesAndParagraphs]";if(l&&console.log(s,e),l&&console.log(s,t),0===e.length||0===t.length)return new Map;let a=e.map(e=>e.text),i=t.map(e=>e.getText()),g=function(e,t,n,l){var s,a,i;let g,h,p,x;void 0===n&&(n=null),void 0===l&&(l=!1);let v=function(e,t,n){void 0===n&&(n=!1);let l=[],s=0,o=0,a=0,i=0,g=[];for(;s<e.length&&o<t.length;){let h=e[s],f=t[o],c=Math.min(h.length-a,f.length-i),d=h.substring(a,a+c);if(f.substring(i,i+c)!==d){n&&console.log(`Prefix mismatch found. [${d}] vs. [${f.substring(i,i+c)}]`);break}let u=g[g.length-1];g.push({pIdx:s,sIdx:o,text:d,paragraphOffset:u?u.paragraphOffset+u.text.length:0,sentenceOffset:i}),a+=c,i+=c,a>=h.length&&(n&&console.log("Paragraph ",s,"fully consumed"),l.push.apply(l,(0,r.Z)(g.splice(0))),++s,a=0),i>=f.length&&(n&&console.log("Sentence ",o,"fully consumed"),++o,i=0)}return n&&console.log("FAST",l),l}(e,t,l),m=v.length?v[v.length-1].pIdx+1:0;if(m===e.length)return v;let T=function(e,t,n){void 0===n&&(n=!1);let l=[],s=e.length-1,o=t.length-1,a=0,i=0,g=[];for(;s>=0&&o>=0;){let h=e[s],f=t[o],c=Math.min(h.length-a,f.length-i),d=h.substring(h.length-a-c,h.length-a),u=f.substring(f.length-i-c,f.length-i);if(u!==d){n&&console.log(`Postfix mismatch found. "${d}" vs. "${u}"`);break}g.push({pIdx:s,sIdx:o,text:d,sentenceOffset:f.length-i-c}),a+=c,i+=c,a>=h.length&&(n&&console.log(`Paragraph #${s} "${h}" fully consumed "`),l.push.apply(l,(0,r.Z)(g.splice(0))),--s,a=0),i>=f.length&&(n&&console.log(`Sentence #${o} "${t[o]}" fully consumed`),--o,i=0)}return l.reverse(),l.forEach((e,t)=>{let n=l[t-1];e.paragraphOffset=(null==n?void 0:n.pIdx)===e.pIdx?n.paragraphOffset+n.text.length:0}),n&&console.log("FAST Reverse",l),l}(e,t,l),I=T.length?e.length-T[0].pIdx:0;l&&console.log("PREFIX",v,m),l&&console.log("POSTFIX",T,I);let E=null===(s=v[v.length-1])||void 0===s?void 0:s.sIdx;if(void 0===E)g=0,h=0;else{let e=0;for(let t=v.length-1;t>=0&&v[t].sIdx===E;--t)e+=v[t].text.length;e===t[E].length?(g=E+1,h=0):(g=E,h=e)}let S=null===(a=T[0])||void 0===a?void 0:a.sIdx;if(void 0===S)p=0,x=0;else{let e=0;for(let t=0;t<T.length&&T[t].sIdx===S;++t)e+=T[t].text.length;e===t[S].length?(p=t.length-S,x=0):(p=t.length-S-1,x=e)}let N=e.slice(m,e.length-I),y=t.slice(g,t.length-p);if(y.length){y[0]=y[0].substring(h);let e=y.length-1,t=y[e];y[e]=t.substring(0,t.length-x)}l&&console.log("CHANGED PARAGRAPHS",N.join(" | "),m,e.length-I-1),l&&console.log("CHANGED SENTENCES",y.join(" | "));let b=Date.now(),C=function(e,t,n,l){void 0===n&&(n=-1),void 0===l&&(l=!1);let r=Date.now(),s=n>=0?r+50:1/0,a=[];for(let t=0;t<e.length;t++)if(a.push(c(e[t])),Date.now()>s)return new u(1);let i=[];for(let e=0;e<t.length;e++)if(i.push(c(t[e])),Date.now()>s)return new u(2);let g=s-Date.now();if(g<=0)return new u(3);let h=(0,o.TY)(a.flat(1),i.flat(1),g);if(!h)return new u(4);l&&console.log("tokensP",a.flat(1)),l&&console.log("tokensS",i.flat(1)),l&&console.log("diff",h);let p=[],x=0,v=0,m=0,T=0;for(let e of h)if(e instanceof Array){let[t,n]=e,l=n>0;for(;t>0;){let e=a[x].length,n=t+m>e?e-m:t;if(0===n)return console.warn("!!!",n),[];p.push({pIdx:x,sIdx:l?v:void 0,text:a[x].slice(m,m+n).join("")}),l=!1,[x,m]=d(a,x,m,n),t-=n}[v,T]=d(i,v,T,n)}else{let t=e;for(;t>0;){let e=a[x].length,n=t+m>e?e-m:t,l=i[v].length,r=t+T>l?l-T:t,s=Math.min(n,r);if(0===s)return console.warn("!!!",n,r),[];p.push({pIdx:x,sIdx:v,text:a[x].slice(m,m+s).join("")}),[v,T]=d(i,v,T,s),[x,m]=d(a,x,m,s),t-=s}}l&&console.log("Alignment:",JSON.stringify(p,null,2));let I=0;for(;p[I];){var E;let e,t;let n=p[I];if(void 0!==n.sIdx){++I;continue}let l=(null===(E=p[I-1])||void 0===E?void 0:E.pIdx)===n.pIdx?p[I-1]:void 0,r=[n];for(let t=I+1;p[t]&&p[t].pIdx===n.pIdx;++t){if(void 0!==p[t].sIdx){e=p[t];break}r.push(p[t])}I+=r.length,(l||e)&&(t=!l&&e?e.sIdx:l&&!e?l.sIdx:l.sIdx===e.sIdx?l.sIdx:l.text.match(/([.!?)]\s|[？。．！]\s*)$/)?e.sIdx:l.sIdx),void 0!==t&&r.forEach(e=>{e.sIdx=t})}let S=[];if(p.forEach(e=>{let t=S[S.length-1];(null==t?void 0:t.pIdx)===e.pIdx&&(null==t?void 0:t.sIdx)===e.sIdx?t.text+=e.text:S.push(e)}),S.length&&void 0!==S[0].sIdx){let e="";for(let n=0;n<S.length;++n){let l=S[n];if(void 0===l.sIdx){l.isGuessedMatch=!0,e="";continue}let r=S[n+1];if(e+=l.text,!r||r.sIdx!==l.sIdx){if(e!==t[l.sIdx])for(let e=n;e>=0&&S[e].sIdx===l.sIdx;--e)S[e].isGuessedMatch=!0;e=""}}}else S.length&&(S[0].isGuessedMatch=!0);return f(S),l&&console.log("Merged alignments:",JSON.stringify(S,null,2)),S}(N,y,50);if(C instanceof u){let e=C.step;C=function(e,t){let n=[],l=0;for(let e=0;e<t.length;e++)n.push({sIdx:e,pIdx:0,paragraphOffset:0,sentenceOffset:l,text:t[e],isGuessedMatch:!0}),l+=t[e].length;for(let l=1;l<e.length;l++)n.push({sIdx:t.length-1,pIdx:l,paragraphOffset:0,sentenceOffset:0,text:"",isGuessedMatch:!0});return n}(N,y),l&&console.log("DetailedAlign timeout detected"),null===(i=n)||void 0===i||i({step:e,time:Date.now()-b})}if(C.forEach(e=>{e.pIdx+=m,void 0!==e.sIdx&&(e.sIdx+=g)}),C.length>0){if(h>0&&C[0].isGuessedMatch){let e=C[0].sIdx;for(let t=v.length-1;t>=0&&v[t].sIdx===e;--t)v[t].isGuessedMatch=!0}if(x>0&&C[C.length-1].isGuessedMatch){let e=C[C.length-1].sIdx;for(let t=0;t<T.length&&T[t].sIdx===e;++t)T[t].isGuessedMatch=!0}if(h>0&&!C[0].isGuessedMatch){let e=v[v.length-1].sIdx,t=v[v.length-1].text.length;for(let n=0;n<C.length&&C[n].sIdx===e;++n)C[n].sentenceOffset+=t}}let w=[].concat((0,r.Z)(v),(0,r.Z)(C),T);return f(w),w}(a,i,n,l),h=new Map,p=[];return e.forEach(e=>{let t=[];p.push(t),h.set(e,t)}),g.forEach(e=>{p[e.pIdx].push({sentence:void 0!==e.sIdx?t[e.sIdx]:void 0,text:e.text,paragraphOffset:e.paragraphOffset,isGuessedMatch:!!e.isGuessedMatch,...void 0!==e.sentenceOffset&&{sentenceOffset:e.sentenceOffset}})}),h}function f(e){e.forEach((t,n)=>{let l=e[n-1];t.paragraphOffset=(null==l?void 0:l.pIdx)===t.pIdx?l.paragraphOffset+l.text.length:0,l?t.sentenceOffset=l.sIdx===t.sIdx?l.sentenceOffset+l.text.length:0:t.sentenceOffset=0})}function c(e){return e.match(a.cc)}function d(e,t,n,l){let r=t,s=l+n;for(;r<e.length-1&&e[r].length<=s;)s-=e[r].length,++r;return[r,s]}s.Z.defineType("/translator/core/paragraphHandling",["/translator/core/textareas","/translator/core/languageManagement","/translator/core/config"],(e,t,n)=>{let l=(0,i.f)();return{getSourceAlignment(){let r=t.getActiveLangContext(),s=e.getSourceParagraphs(),o=r.getSourceSentences();return h(s=function(e,t,n,l){void 0===n&&(n=null),void 0===l&&(l=20);let r=[],s=0,o=t,a=e.map(e=>e.text).join("");if(a.length<=t)return e;if(n){let e=n.map(e=>e.getText()).join("");if(!g(a.substring(0,t),e,l)){let n=function(e,t){for(let n=1;n<=e;n++){if(t(n))return n;if(t(-n))return-n}return null}(l,n=>g(a.substring(0,t+n),e,l));null!=n&&(o=t+n)}}for(let t of e){if(s>=o)break;r.push({...t,text:t.text.slice(0,o-s)}),s+=t.text.length}return r}(s,n.get("CONFIG__MAX_NUM_CHARACTERS"),o),o,l)},getTargetAlignment(){let n=t.getActiveLangContext(),r=e.getTargetParagraphs();return h(r,n.getTargetSentences(),l)},onDetailedAlignTimedOut:l}});let u=function(e){this.step=e};void 0===l&&(l=!1)},56819:function(e,t,n){var l=n(61606),r=n(25889),s=n(84627);let o="updateTargetSentencesFromText";l.Z.defineType("/translator/smartEditing/updateTargetSentencesFromText",["/translator/core/languageManagement","/translator/core/config","/translator/core/textareas","/translator/core/richTextHandling"],(e,t,n,l)=>{let a=(0,s.fo)(),h="";return{ensureTargetSentenceAreUpToDate:function(){var s,f;let c=e.getActiveLangContext(),d=t.get("isRtfEnabled"),u=d?null!==(s=null===(f=n.getTargetDTextarea())||void 0===f?void 0:f.getHtml())&&void 0!==s?s:"":n.getTargetText();if(h===u)return;h=u;let p=n.getTargetText();if(function(e,t,n){let l,s;let a=r.ZP.splitTextIntoParts(t),h=e.targetSentences.slice(0);{let e=h[0];for(;e;){let t,n;let r=e.getParts(),s=0,o=0,f=!1;for(;;){for(n=r[o];n&&n.isWhitespacePart;)o+=1,n=r[o];for(t=a[s];t&&t.isWhitespacePart;)s+=1,t=a[s];if(!n){f=!0;break}if(!t||t.text!==n.text)break;s+=1,o+=1}if(f){let t=a.splice(0,s);if(t.length){let e=t[t.length-1];if(e.isWhitespacePart){let t=i(e.text);e.text=t[0],t[1].length&&a.unshift({text:t[1],isWhitespacePart:!0})}}let n=[];t.forEach(e=>n.push(e.text)),g(e,n,!1),l=e,h.shift(),e=h[0]}else break}}{let e=h[h.length-1];for(;e;){let t,n;let l=e.getParts(),r=a.length-1,o=l.length-1,f=!1;for(;;){for(n=l[o];n&&n.isWhitespacePart;)o-=1,n=l[o];for(t=a[r];t&&t.isWhitespacePart;)r-=1,t=a[r];if(!n){f=!0;break}if(!t||t.text!==n.text)break;r-=1,o-=1}if(f){let t=a.splice(r+1);if(t.length){let e=t[0];if(e.isWhitespacePart){let t=i(e.text);e.text=t[1],t[0].length&&a.push({text:t[0],isWhitespacePart:!0})}}let n=[];t.forEach(e=>n.push(e.text)),g(e,n,!1),s=e,h.pop(),e=h[h.length-1]}else break}}let f=a.reduce((e,t)=>{var n;return null!==(n=e+t.text)&&void 0!==n?n:""},"");if(""!==f&&n({remainingText:f,remainingTargetSentences:h}),1===h.length&&a.length){let e=h.shift(),t=[];a.splice(0).forEach(e=>t.push(e.text)),g(e,t,!0)}else if(!h.length&&a.length){let e=0;if(l||s){if(l&&!s)e=-1;else if(!l&&s)e=1;else{var c;e=null!==(c=l)&&void 0!==c&&c.getText().match(/(\n|[!?])\s*$/)?1:-1}}if(e>0){let e=[];a.splice(0).reverse().forEach(t=>e.unshift(t.text)),e.push(s.getText()),g(s,e,!0)}else if(e<0){let e=[l.getText()];a.splice(0).forEach(t=>e.push(t.text)),g(l,e,!0)}}else if(h.length&&a.length){console.warn(o,"Alignment is lost (ambiguous match).");let e=[];a.splice(0).forEach(t=>e.push(t.text));let t=h.shift();g(t,e,!0),h.forEach(e=>{g(e,[""],!0)})}else h.length>=1&&0===a.length&&(console.warn(o,"Alignment is lost (removed)."),h.forEach(e=>{g(e,[""],!0)}))}(c,p,a),d){let e=n.getTargetTextareaSnapshot();l.updateTargetSentencesHtml(c.targetSentences,e)}},onUpdateTargetSentencesChanged:a}});let a=/^(\s*\n)(\s*)$|^(\s*)$/;function i(e){let t=e.match(a);return t?t[1]?[t[1],t[2]]:[t[3],""]:["",e]}function g(e,t,n){let l=e.getParts();if(l.length){t[0]!==l[0].text&&(l[0].isWhitespacePart||t[0].match(/^\s+$/))&&e.updateWhitespacesBeforeRev();let n=l[l.length-1],r=t[t.length-1];r!==n.text&&(n.isWhitespacePart||r.match(/^\s+$/))&&e.updateWhitespacesAfterRev()}e.updateRawText(t.join(""),!1,n)}}}]);