!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.GdWebCanaryClient=e():t.GdWebCanaryClient=e()}(self,(()=>(()=>{"use strict";var t={d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{default:()=>O});var n="__xhr_gd_ajax_hook",r=["load","loadend","timeout","error","readystatechange","abort"];function o(t,e){var n={};for(var r in t)n[r]=t[r];return n.target=n.currentTarget=e,n}const i=`${n}_QUEUE`;function s(t){return function(e,n){const r=window[i].filter((e=>e[t])),o=r.length;let s=0;const a=()=>{s++,s===o&&n.next(e)};if(o)for(let n=0;n<r.length;n++)(0,r[n][t])(e,{next:a});else n.next(e)}}void 0===window[i]&&(window[i]=[]);var a=r[0],c=r[1],u=r[2],h=r[3],f=r[4],p=r[5];function d(t,e){if(e=e||window,window[i].push(t),!e[n])return function(t){var e=s("onRequest"),i=s("onResponse"),a=s("onError");function c(){return!0}function d(t){return function(e,n){return function(t,e,n,r){var o=new m(t);n={config:t.config,error:n,type:r},a?a(n,o):o.next(n)}(e,0,n,t),!0}}function g(t,e){return 4===t.readyState&&0!==t.status?function(t,e){var n=new w(t),r={response:e.response||e.responseText,status:e.status,statusText:e.statusText,config:t.config,headers:t.resHeader||t.getAllResponseHeaders().split("\r\n").reduce((function(t,e){if(""===e)return t;var n=e.split(":");return t[n.shift()]=function(t){return t.replace(/^\s+|\s+$/g,"")}(n.join(":")),t}),{})};if(!i)return n.resolve(r);i(r,n)}(t,e):4!==t.readyState&&y(t,f),!0}return function(t,e){function i(e){return function(){var n=this.hasOwnProperty(e+"_")?this[e+"_"]:this.xhr[e],r=(t[e]||{}).getter;return r&&r(n,this)||n}}function s(e){return function(n){var r=this.xhr,i=this,s=t[e];if("on"===e.substring(0,2))i[e+"_"]=n,r[e]=function(s){s=o(s,i),t[e]&&t[e].call(i,r,s)||n.call(i,s)};else{var a=(s||{}).setter;n=a&&a(n,i)||n,this[e+"_"]=n;try{r[e]=n}catch(t){}}}}function a(e){return function(){var n=[].slice.call(arguments);if(t[e]){var r=t[e].call(this,n,this.xhr);if(r)return r}return this.xhr[e].apply(this.xhr,n)}}return(e=e||window)[n]=e[n]||e.XMLHttpRequest,e.XMLHttpRequest=function(){for(var t=new e[n],o=0;o<r.length;++o){var c="on"+r[o];void 0===t[c]&&(t[c]=null)}for(var u in t){var h="";try{h=typeof t[u]}catch(t){}"function"===h?this[u]=a(u):Object.defineProperty(this,u,{get:i(u),set:s(u),enumerable:!0})}var f=this;t.getProxy=function(){return f},this.xhr=t},Object.assign(e.XMLHttpRequest,{UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4}),e[n]}({onload:c,onloadend:c,onerror:d(h),ontimeout:d(u),onabort:d(p),onreadystatechange:function(t){return g(t,this)},open:function(t,n){var r=this,o=n.config={headers:{}};o.method=t[0],o.url=t[1],o.async=t[2],o.user=t[3],o.password=t[4],o.xhr=n;var i="on"+f;if(n[i]||(n[i]=function(){return g(n,r)}),e)return!0},send:function(t,n){var r=n.config;if(r.withCredentials=n.withCredentials,r.body=t[0],e){var o=function(){e(r,new x(n))};return!1===r.async?o():setTimeout(o),!0}},setRequestHeader:function(t,n){if(n.config.headers[t[0].toLowerCase()]=t[1],e)return!0},addEventListener:function(t,e){var n=this;if(-1!==r.indexOf(t[0])){var i=t[1];return l(e).addEventListener(t[0],(function(e){var r=o(e,n);r.type=t[0],r.isTrusted=!0,i.call(n,r)})),!0}},getAllResponseHeaders:function(t,e){var n=e.resHeader;if(n){var r="";for(var o in n)r+=o+": "+n[o]+"\r\n";return r}},getResponseHeader:function(t,e){var n=e.resHeader;if(n)return n[(t[0]||"").toLowerCase()]}},t)}(e)}function l(t){return t.watcher||(t.watcher=document.createElement("a"))}function y(t,e){var n,r=t.getProxy(),i="on"+e+"_",s=o({type:e},r);r[i]&&r[i](s),"function"==typeof Event?n=new Event(e,{bubbles:!1}):(n=document.createEvent("Event")).initEvent(e,!1,!0),l(t).dispatchEvent(n)}function g(t){this.xhr=t,this.xhrProxy=t.getProxy()}function v(t){function e(t){g.call(this,t)}return e.prototype=Object.create(g.prototype),e.prototype.next=t,e}g.prototype=Object.create({resolve:function(t){var e=this.xhrProxy,n=this.xhr;e.readyState=4,n.resHeader=t.headers,e.response=e.responseText=t.response,e.statusText=t.statusText,e.status=t.status,y(n,f),y(n,a),y(n,c)},reject:function(t){this.xhrProxy.status=0,y(this.xhr,t.type),y(this.xhr,c)}});var x=v((function(t){var e=this.xhr;for(var n in t=t||e.config,e.withCredentials=t.withCredentials,e.open(t.method,t.url,!1!==t.async,t.user,t.password),t.headers)e.setRequestHeader(n,t.headers[n]);e.send(t.body)})),w=v((function(t){this.resolve(t)})),m=v((function(t){this.reject(t)})),b=function(t,e,n){if(n||2===arguments.length)for(var r,o=0,i=e.length;o<i;o++)!r&&o in e||(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))},E="x-gd-project-env",C=["localhost","127.0.0.1","0.0.0.0","gaoding.com","uupoop.com","h5gdsvip.com","h5gdvip.com","h5gd.com","xsbapp.com","fococlipping.com","hlgdata.com","ttxsapp.com","qingzhan.com","focodesign.com","dadanxia.net","huanleguang.com","qiping.com","yunjian.com","qingzhan.com","pszhuli.com","xsbapp.com","huaban.com","huabanpro.com","huabanimg.com","cowtransfer.cn","cowtransfer.com"];const O=new(function(){function t(){this.cacheCookie="",this.cacheCookie=document.cookie,this.whiteList=b([],C,!0),this.proxyXhr(),this.proxyFetch()}return t.prototype.proxyXhr=function(){var t=this,e=this.getCanaryOption();e&&(d({onRequest:function(n,r){t.isIncludesWhiteUrl(n.url)?(Object.assign(n.headers,e),r.next(n)):r.next(n)},onError:function(t,e){e.next(t.error)},onResponse:function(t,e){e.next(t)}}),Object.assign(XMLHttpRequest,{UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4}))},t.prototype.proxyFetch=function(){var t=this,e=this.getCanaryOption();if(e){var n=window.fetch;window.fetch=function(r,o){var i=r instanceof Request?r.url:r;return t.isIncludesWhiteUrl(i)?(o||((o={}).headers=e),o&&!o.headers&&(o.headers=e),o&&o.headers&&Object.assign(o.headers,e),n.apply(window,[r,o])):n.apply(window,[r,o])}}},t.prototype.getCanaryOption=function(){var t,e,n,r=this.getCanaryForceVersion()||this.getCanaryVersion(),o=this.getProjectEnvVersion();return r&&((t={})["x-gd-traffic-tags"]=r,n=t),o&&(n?n[E]=o:((e={})[E]=o,n=e)),n},t.prototype.getCanaryVersion=function(){var t=this.getCookie("canary");if(t){var e=t.split("?"),n=e[0],r=e[1];return(location.host+location.pathname).includes(n)?r:void 0}},t.prototype.getCanaryForceVersion=function(){return this.getCookie("canary_force")},t.prototype.getProjectEnvVersion=function(){return this.getCookie("project_env")},t.prototype.getCookie=function(t){for(var e=t+"=",n=this.cacheCookie.split(";"),r=0;r<n.length;r++){var o=n[r].trim();if(0==o.indexOf(e))return o.substring(e.length,o.length)}},t.prototype.setWhiteList=function(t,e){"string"==typeof t&&this.whiteList.push(t),Array.isArray(t)&&(this.whiteList=this.whiteList.concat(t)),e&&"string"==typeof t&&(this.whiteList=[t]),e&&Array.isArray(t)&&(this.whiteList=b([],t,!0))},t.prototype.isIncludesWhiteUrl=function(t){if("string"==typeof t){var e=t;if(t.startsWith("/")&&!t.startsWith("//")&&(e="".concat(location.origin).concat(t)),t.startsWith("//")&&(e="".concat(location.protocol).concat(t)),/^http(s)?:\/\//.test(e))for(var n=new URL(e).origin,r=0;r<this.whiteList.length;r++)if(n.includes(this.whiteList[r]))return!0}},t}());return e})()));