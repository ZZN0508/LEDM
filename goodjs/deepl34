"use strict";(self.webpackChunk_deepl_gatsby=self.webpackChunk_deepl_gatsby||[]).push([[264],{72047:function(e,t,n){n.d(t,{RG:function(){return o},aE:function(){return r},gP:function(){return a}});let i=["bold","italic","underline","strikethrough","subscript","superscript","emphasis","strong","mark","code","del","cite","ins","link"],o=["B","I","U","S","SUB","SUP","EM","STRONG","MARK","CODE","DEL","CITE","INS","A"],r={B:"bold",I:"italic",U:"underline",S:"strikethrough",SUB:"subscript",SUP:"superscript",EM:"emphasis",STRONG:"strong",MARK:"mark",CODE:"code",DEL:"del",CITE:"cite",INS:"ins",A:"link"},s={bold:"B",italic:"I",underline:"U",strikethrough:"S",subscript:"Sub",superscript:"Sup",emphasis:"Em",strong:"St",mark:"Ma",code:"Co",del:"Del",cite:"Cit",ins:"Ins",link:"A"},a=function(){function e(){this.data={},this._changeHandler=null}var t=e.prototype;return t.setChangeHandler=function(e){this._changeHandler=e},t.getTags=function(){let e=[],t=this.data;for(let n of o){let i=r[n];t[i]&&e.push(n)}return e},t.hasFormatting=function(){return""!==this.getHash()},t.get=function(e){var t;return null!==(t=this.data[e])&&void 0!==t&&t},t.getHash=function(){let e=this.data;return i.filter(t=>e[t]).map(e=>s[e]).join("")},t.set=function(e,t){var n;void 0===t&&(t=!0),this.data[e]=t,null===(n=this._changeHandler)||void 0===n||n.call(this)},t.clear=function(){if(this.hasFormatting()){var e;null===(e=this._changeHandler)||void 0===e||e.call(this)}this.data={}},t.clone=function(){let t=new e;return t.data={...this.data},t},t.getData=function(){return{...this.data}},e.fromData=function(t){let n=new e;for(let e of i)t[e]&&n.set(e);return n},e.fromDomNodeStyle=function(t){if(!(t instanceof HTMLElement))return null;let n=t.style,i=new e;return i.set("bold","bold"===n.fontWeight||"bolder"===n.fontWeight||Number(n.fontWeight)>500),i.set("italic",n.fontStyle.includes("italic")||n.fontStyle.includes("oblique")),i.set("underline",n.textDecorationLine.includes("underline")||n.textDecoration.includes("underline")),i.set("strikethrough",n.textDecorationLine.includes("line-through")||n.textDecoration.includes("line-through")),i.set("subscript","sub"===n.verticalAlign),i.set("superscript","super"===n.verticalAlign),i.hasFormatting()?i:null},e}()},86679:function(e,t,n){n.d(t,{Ve:function(){return a},cZ:function(){return d},kp:function(){return s}});var i=n(46748);let o={NONE:{},META:{meta:!0},CTRL:{ctrl:!0},SHIFT_META:{meta:!0,shift:!0},SHIFT_CTRL:{shift:!0,ctrl:!0}};function r(e,t,n){return null!=e&&!!e.key&&e.key.toUpperCase()===t&&e.ctrlKey===(!0===n.ctrl)&&e.metaKey===(!0===n.meta)&&e.shiftKey===(!0===n.shift)&&e.altKey===(!0===n.alt)}let s=e=>(0,i.V5)()?r(e,"Z",o.META):r(e,"Z",o.CTRL),a=e=>(0,i.V5)()?r(e,"Z",o.SHIFT_META)||r(e,"Y",o.META):(0,i.ED)()?r(e,"Z",o.SHIFT_CTRL)||r(e,"Y",o.CTRL)||r(e,"F4",o.NONE):r(e,"Z",o.SHIFT_CTRL),d=function(e,t,n){e.addEventListener("keydown",e=>{s(e)?(e.preventDefault(),t()):a(e)&&(e.preventDefault(),n())})}},94434:function(e,t,n){n.d(t,{$P:function(){return a},oS:function(){return u},Gc:function(){return f},NL:function(){return h},FN:function(){return l}});var i=n(4769);n(12959);var o=n(72047);let r=["href"];var s=n(46748);let a={TEXT:"TEXT",INLINE:"INLINE",BLOCK:"BLOCK",LINE_BREAK:"LINE_BREAK"},d=0;function l(e,t){if(e&&!t||!e&&t)return!1;if(e===t)return!0;if(e&&t&&e.length!==t.length)return!1;if(e instanceof Array){if(!(t instanceof Array))return!1;for(let n=0;n<e.length;n+=1)if(e[n]!==t[n])return!1;return!0}if(e instanceof Object){if(!(t instanceof Object))return!1;let n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(let i of n)if(!(i in t)||e[i]!==t[i])return!1;return!0}return!1}let h=()=>{},c=["P","H1","H2","H3","H4","H5","H6","BLOCKQUOTE","PRE"],u=function(){function e(e,t,n){this.id=void 0,this._domNode=void 0,this._tagName=void 0,this._childNodes=void 0,this._parentNode=void 0,this._type=void 0,this._isChanged=void 0,this._isUnclean=void 0,this._collectedText=void 0,this._text=void 0,this._prevState=void 0,this._isContent=void 0,this._nonContentNodeType=void 0,this._formatting=void 0,this._classes=void 0,this._attachmentNodes=void 0,this._eventListeners=void 0,this._attributes=void 0,this._sourceNode=void 0,this.onDomNodeCreated=void 0,this.id=null!=n?n:d+=1,this._childNodes=[],this._type=e,this._isChanged=!0,this._isUnclean=!0,this._classes=new Set,this._isContent=t}e.createVirtualDNode=function(t,n,i,o,r){let s=new e(n,i,t);return o&&(s._tagName=o),r&&(s._attributes={...r}),s};var t=e.prototype;return t.toDescription=function(){let e={id:this.id,type:this._type};return this.isTextNode()?(e.text=this._text,this.hasFormatting()&&(e.formatting=this.getFormattingInfo().getData())):(e.tag=this._tagName,e.isContent=this._isContent,e.childNodes=this._childNodes.map(e=>e.toDescription()),this._classes&&this._classes.size>0&&(e.classes=Array.from(this._classes))),this._nonContentNodeType&&(e.nonContentNodeType=this._nonContentNodeType),this._attributes&&(e.attributes={...this._attributes}),e},t.prevToDescription=function(){if(void 0===this._prevState)return;let e={id:this.id,type:this._type};if(this.isTextNode())e.text=this._prevState.text,this._prevState.formatting&&(e.formatting=this._prevState.formatting);else{var t;e.tag=this._tagName,e.isContent=this._isContent,e.childNodes=null===(t=this._prevState.childNodes)||void 0===t?void 0:t.map(e=>e.prevToDescription()),this._classes&&this._classes.size>0&&(e.classes=Array.from(this._classes))}return this._nonContentNodeType&&(e.nonContentNodeType=this._nonContentNodeType),this._prevState.attributes&&(e.attributes={...this._prevState.attributes}),e},t.toString=function(){if(null==this._text)return this._tagName||(this.isLineBreak()?"BR":"unknown");let e=this._text?`"${this._text}"`:"<empty string>";return this._tagName&&(e=`${this._tagName}: ${e}`),this.hasFormatting()&&(e+=` [${this.getFormattingInfo().getHash()}]`),e},t.setNonContentNodeType=function(e){this._nonContentNodeType=e},t.getNonContentNodeType=function(){return this._nonContentNodeType},t.addEventListener=function(e,t,n){this._eventListeners||(this._eventListeners=[]),this._eventListeners.push({type:e,callback:t,options:n}),this._markAsChanged()},t.removeEventListener=function(e,t,n){if(!this._eventListeners)return;let i=this._eventListeners.findIndex(i=>i.type===e&&i.callback===t&&i.options===n);i>=0&&(this._eventListeners.splice(i,1),this._markAsChanged(),0===this._eventListeners.length&&delete this._eventListeners)},t._markAsChanged=function(){for(let e=this;e&&!e._isChanged;e=e._parentNode)e._isChanged=!0;this._markAsUnclean();for(let e=this;e&&void 0!==e._collectedText;e=e._parentNode)e._collectedText=void 0},t._markAsUnclean=function(){for(let e=this;e&&!e._isUnclean;e=e._parentNode)e._isUnclean=!0},t.markAsClean=function(){for(let e of(this._isUnclean=!1,this._childNodes))e&&e._isUnclean&&e.markAsClean()},t._setTagName=function(e){this._tagName=null==e?void 0:e.toUpperCase()},t.getDomNode=function(){return this._domNode},t.setDomNode=function(e){e!==this._domNode&&(this._domNode=e,this._sourceNode&&this._sourceNode.setDomNode(e),h(this))},t.getChildNodes=function(){return this._childNodes.slice(0)},t.getVirtualChildNodes=function(){return this.getChildNodes().map(t=>{if(!t.isTextNode()||!t.hasMetaInformation())return t;{let n=t.getFormattingInfo().getTags(),i=e.createVirtualDNode(-1,a.INLINE,!0,n.shift(),t._attributes),o=i;for(;n.length>0;){let i=e.createVirtualDNode(-1,a.INLINE,!0,n.shift(),t._attributes);o.appendChild(i),o=i}let r=e.createVirtualDNode(t.id,a.TEXT,!0);return r.setText(t.getText()),r._domNode=t._domNode,r._sourceNode=t,o.appendChild(r),i}})},t._getChildNodes=function(){return this._childNodes},t.isInlineNode=function(){return this._type===a.INLINE},t.isBlockNode=function(){return this._type===a.BLOCK},t.isLineNode=function(){return!!this._tagName&&c.includes(this._tagName)},t.isTextNode=function(){return this._type===a.TEXT},t.isLineBreak=function(){return this._type===a.LINE_BREAK},t.isRootNode=function(){return void 0===this._parentNode},t.getParentNode=function(){return this._parentNode},t.getParentBlockNode=function(){let e=this._parentNode;for(;e;){if(e.isBlockNode())return e;e=e._parentNode}},t.isContent=function(){return this._isContent},t.appendChild=function(e){let t=e._parentNode;t&&(t.detachChild(e),h(t)),this._childNodes.push(e),e._parentNode=this,this._markAsChanged(),h(this)},t.appendChildren=function(e){e.length&&(e.forEach(e=>{let t=e._parentNode;t&&(t.detachChild(e),h(t)),this._childNodes.push(e),e._parentNode=this}),this._markAsChanged()),h(this)},t.insertChildren=function(e,t){var n;(n=this._childNodes).splice.apply(n,[e,0].concat((0,i.Z)(t))),this._markAsChanged(),t.forEach(e=>{e._parentNode&&e._parentNode!==this&&(e._parentNode.detachChild(e),h(e._parentNode)),e._parentNode=this}),h(this)},t.detachChildren=function(){if(this._childNodes.length){this._markAsChanged();let e=this._childNodes.splice(0);return e.forEach(e=>{e._parentNode=void 0}),h(this),e.forEach(e=>h(e)),e}return h(this),[]},t.detachChild=function(e){h(this);let t=this._detachChild(e);return h(this),h(e),t},t._detachChild=function(e){let t=this._childNodes.indexOf(e);if(t>=0){this._markAsChanged(),e._parentNode=void 0;let n=this._childNodes.splice(t,1)[0];return n}},t.replaceChildrenRange=function(e,t,n){var o;let r=this._childNodes.length-t-e;if(r<0)throw Error("Tried to replace a negative range of children");let s=(o=this._childNodes).splice.apply(o,[e,r].concat((0,i.Z)(n)));if(!l(n,s)){this._markAsChanged();let e=new Set(n);n.forEach(e=>{e._parentNode&&e._parentNode!==this&&e._parentNode._detachChild(e),e._parentNode=this}),s.forEach(t=>{e.has(t)||t._parentNode!==this||(t._parentNode=void 0)})}return s},t.replaceChildren=function(e){let t=this.replaceChildrenRange(0,0,e);return h(this),t.forEach(e=>h(e)),t},t.replaceChild=function(t,n){let i=t instanceof e?this._childNodes.indexOf(t):t;return i<0?[]:this.replaceChildrenRange(i,this._childNodes.length-i-1,n)},t.isEmpty=function(){return!this.isLineBreak()&&!this._text&&!this._childNodes.length},t.hasChildren=function(){return this._childNodes.length>0},t.getText=function(){return this._text},t.setText=function(e){if(!this.isTextNode()){console.warn("setText is not supported for this type of node");return}this._text!==e&&(this._collectedText=e,this._text=e,this._markAsChanged()),h(this)},t.collectText=function(){if(void 0===this._collectedText){let e=e=>!e.isRootNode()&&e.isBlockNode(),t=e=>{var t;return null===(t=e._childNodes[e._childNodes.length-1])||void 0===t?void 0:t.collectText().endsWith("\n")},n=e=>e.endsWith("\n"),i=o=>{if(o.isTextNode()){o._collectedText=o._text;return}if(o.isLineBreak()){o._collectedText="\n";return}let r="";o._childNodes.forEach(e=>{i(e),r+=e._collectedText}),!e(o)||o.hasChildren()&&t(o)||(r+="\n"),o._collectedText=r;let s=!o.hasNextNeighbour();e(o)&&s&&n(o._collectedText)&&(o._collectedText=o._collectedText.substring(0,o._collectedText.length-1))};i(this)}return h(this),this._collectedText},e.textNodeToHtml=function(e,t){var n,i;if(e.isLineBreak())return"<BR />";if(!e.isTextNode())throw Error(`Not a text node: ${e.toString()}`);let o=null!==(n=null!=t?t:e.getText())&&void 0!==n?n:"",r=(0,s.Av)(o).replace(/\n/g,"<BR />");if(e.hasFormatting()){let t=e.getFormattingInfo().getTags(),n=null===(i=e._attributes)||void 0===i?void 0:i.href,o=t.map(e=>"A"===e&&n?`<A href="${n}">`:`<${e}>`).join(""),s=t.reverse().map(e=>`</${e}>`).join("");return`${o}${r}${s}`}return r},t.collectHtml=function(t){void 0===t&&(t=!0);let n=function(t,i){if(void 0===i&&(i=!0),t.isTextNode())return e.textNodeToHtml(t);if(t.isLineBreak())return"<BR />";if(t._tagName&&t._childNodes.length>0){let e=t._childNodes.map(e=>n(e)).join("");if(!t._isContent||!i)return e;let o=`<${t._tagName}>${e}</${t._tagName}>`;return o}return""},i=n(this,t);return i.endsWith("\n")&&(i=i.substring(0,i.length-1)),i},t.setAttachmentNode=function(e,t){if(this.isTextNode()){console.warn("setAttachmentNode is not supported for this type of node",this);return}this._attachmentNodes||(this._attachmentNodes={});let n=this._attachmentNodes[e];l(t,n)||(n&&n.parentNode&&n.parentNode.removeChild(n),(void 0===t.contentEditable||"inherit"===t.contentEditable)&&(t.contentEditable="false"),this._attachmentNodes[e]=t,this._markAsChanged()),h(this)},t.getAttachmentNode=function(e){var t;return null===(t=this._attachmentNodes)||void 0===t?void 0:t[e]},t.removeAttachmentNode=function(e){if(!this._attachmentNodes){h(this);return}let t=this._attachmentNodes[e];return t&&t.parentNode&&t.parentNode.removeChild(t),delete this._attachmentNodes[e],h(this),t},t.isWhitespace=function(){return void 0!==this._text&&!!this._text.match(/^\s+$/)},t.addClass=function(e){this._classes.has(e)||(this._classes.add(e),this._markAsChanged()),h(this)},t.applyClassesFrom=function(e){e._classes?this._classes=new Set(e._classes):this._classes=new Set},t.hasClass=function(e){return this._classes.has(e)},t.removeClass=function(e){this._classes.delete(e)&&this._markAsChanged(),h(this)},t.resetRecordedChanges=function(){this._isChanged&&(this._isChanged=!1,this._prevState={text:this._text,childNodes:Array.from(this._childNodes),parentNode:this._parentNode},this.hasFormatting()&&(this._prevState.formatting=this.getFormattingInfo().getData()),this._attributes&&(this._prevState.attributes=this._attributes),this._childNodes.forEach(e=>e.resetRecordedChanges())),h(this)},t.getPath=function(){let e=[];for(let t=this;t._parentNode;t=t._parentNode)e.unshift(t._parentNode._childNodes.indexOf(t));return e},t.getNextSibling=function(){let e=this._parentNode&&this._parentNode._childNodes;if(e)return e[e.indexOf(this)+1]},t.hasNextNeighbour=function(){let e=this;for(;e._parentNode;){if(void 0!==e.getNextSibling())return!0;e=e._parentNode}return!1},t.getPreviousSibling=function(){let e=this._parentNode&&this._parentNode._childNodes;if(e)return e[e.indexOf(this)-1]},t.normalizeSpaces=function(){let e=String.fromCharCode(160),t=!1;if(this.isTextNode()){var n;let i=null!==(n=this.getText())&&void 0!==n?n:"";i.includes(e)&&(this.setText(i.replaceAll(e," ")),t=!0)}return t},t.isFormattingInlineNode=function(){return!!(this.isContent()&&this.isInlineNode())&&!!(this._tagName&&o.RG.includes(this._tagName)||this.hasFormatting())},t.isFormattingBlockNode=function(){return this.isContent()&&this.isBlockNode()&&this.hasFormatting()},t.getFormattingInlineNodeTypes=function(){let e=[];this.hasFormatting()&&(e=this.getFormattingInfo().getTags()),this.isFormattingInlineNode()&&this._tagName&&!e.includes(this._tagName)&&e.unshift(this._tagName);let t=e.map(e=>o.aE[e]);return t},t.getFormattingInfo=function(){var e;return null!==(e=this._formatting)&&void 0!==e?e:null},t.getOrCreateFormattingInfo=function(){if(!this.isTextNode())throw Error("Trying to create FormattingInfo object for non-text node");return this.getOrCreateFormattingInfoForAnyNodeType()},t.getOrCreateFormattingInfoForAnyNodeType=function(){return this._formatting||(this._formatting=new o.gP,this._formatting.setChangeHandler(()=>this.handleFormattingChange())),this._formatting},t.hasFormatting=function(){var e,t;return null!==(e=null===(t=this._formatting)||void 0===t?void 0:t.hasFormatting())&&void 0!==e&&e},t.getAttributes=function(){return this._attributes?{...this._attributes}:null},t.hasAttributes=function(){return void 0!==this._attributes&&Object.keys(this._attributes).length>0},t.hasAttribute=function(e){return!!this._attributes&&e in this._attributes},t.hasMetaInformation=function(){return this.hasFormatting()||this.hasAttributes()},t.setAttribute=function(e,t){this._attributes&&this._attributes[e]===t||(this._attributes||(this._attributes={}),null==t?e in this._attributes&&delete this._attributes[e]:this._attributes[e]=t,this._markAsChanged())},t.applyAttributes=function(e,t){void 0===t&&(t=!1),t?this._attributes={...e}:this._attributes={...this._attributes,...e},this._markAsChanged()},t.applyAttributesFromDomNode=function(e){for(let t of r)e.hasAttribute(t)&&this.setAttribute(t,e.getAttribute(t))},t.applyAttributesFromDNode=function(e){if(e._attributes)for(let t of Object.keys(e._attributes))this.setAttribute(t,e._attributes[t])},t.applyFormatting=function(e){var t;null===(t=this._formatting)||void 0===t||t.setChangeHandler(null),this._formatting=e.clone(),this._formatting.setChangeHandler(()=>this.handleFormattingChange()),this._formatting.hasFormatting()&&this.handleFormattingChange()},t.handleFormattingChange=function(){this._markAsChanged()},t.clearFormatting=function(){var e;let t=this.hasFormatting();null===(e=this._formatting)||void 0===e||e.setChangeHandler(null),this._formatting=void 0,t&&this.handleFormattingChange()},t.hasIdenticalMetaInformation=function(e){return!!(this.hasFormatting()===e.hasFormatting()&&l(this._attributes,e._attributes))&&(!this.hasFormatting()||this._formatting.getHash()===e._formatting.getHash())},t.containsAnyFormatting=function(){return this.isTextNode()?this.hasFormatting():!this.isLineBreak()&&this.getChildNodes().some(e=>e.containsAnyFormatting())},e}();function f(e,t,n){console.debug(`${n||""}: ${t||""}
${e?function e(t,n){let i=`${"-".repeat(n)+t.toString()} [id:${t.id} changed:${t._isChanged}]`;return t.hasFormatting()&&(i+=`[formatting: ${t.getFormattingInfo().getHash()}]`),i+=`[clean: ${!t._isUnclean}]`,t.getChildNodes().length>0&&(i+=`
${t.getChildNodes().map(t=>e(t,n+1)).join("\n")}`),i}(e,0):"node is null"}`)}},52425:function(e,t,n){n.d(t,{Q2:function(){return d},c1:function(){return s},vm:function(){return l},wd:function(){return a}});var i=n(72047),o=n(94434),r=n(93843);let s="__tNodeId",a="__nonContentType",d="__syncedListeners",l=function(){function e(){this._nodeRegistry=void 0,this._nodeRegistry=new Map}var t=e.prototype;return t.createTextNode=function(e,t,n){let i=new o.oS(o.$P.TEXT,!0);return i._text=e,t&&i.applyFormatting(t),n&&i.applyAttributes(n),this.registerNode(i),i},t.createInlineNode=function(e,t){void 0===t&&(t=!1);let n=new o.oS(o.$P.INLINE,t);return n._setTagName(e),this.registerNode(n),n},t.createBlockContainerNode=function(e,t){void 0===t&&(t=!1);let n=new o.oS(o.$P.BLOCK,t);return n._setTagName(e),this.registerNode(n),n},t.createLineBreakNode=function(){let e=new o.oS(o.$P.LINE_BREAK,!0);return e._setTagName("br"),this.registerNode(e),e},t.createNodeWithEqualType=function(e){return e.isTextNode()?this.createTextNode(e._text,e.getFormattingInfo(),e.getAttributes()):e.isLineBreak()?this.createLineBreakNode():e.isInlineNode()?this.createInlineNode(e._tagName,e.isContent()):this.createBlockContainerNode(e._tagName,e.isContent())},t.createLineNode=function(){return this.createBlockContainerNode("P",!0)},t.registerNode=function(e){this._nodeRegistry.set(e.id,e)},t.createNodeFromDescription=function(e){let{tag:t,type:n,childNodes:r,text:s,classes:a,isContent:d,nonContentNodeType:l,formatting:h,attributes:c}=e,u=null;if(n===o.$P.TEXT)u=this.createTextNode(s,h?i.gP.fromData(h):null,c);else if(n===o.$P.INLINE)u=this.createInlineNode(t,d),r&&u.replaceChildren(r.map(e=>this.createNodeFromDescription(e)));else if(n===o.$P.BLOCK)u=this.createBlockContainerNode(t||"P",d),r&&u.replaceChildren(r.map(e=>this.createNodeFromDescription(e)));else if(n===o.$P.LINE_BREAK)return this.createLineBreakNode();else throw Error("[createNodeFromDescription] invalid type");return a&&a.forEach(e=>u.addClass(e)),l&&u.setNonContentNodeType(l),u},t.getNodeById=function(e){return this._nodeRegistry.get(e)},t.getNodeForPath=function(e,t){let n=e;return t.forEach(e=>n=n._childNodes[e]),n},t.removeNode=function(e){if(this._nodeRegistry.has(e.id)){var t;null===(t=e.getParentNode())||void 0===t||t.detachChild(e),this._nodeRegistry.delete(e.id)}},t.garbageCollect=function(){let e=this._nodeRegistry.values();for(let t of e)this.garbageCollectNodeIfUnconnected(t)},t.garbageCollectNodeIfUnconnected=function(e){let t=e instanceof o.oS?e:this.getNodeById(e);return!!t&&!this.nodeIsConnectedToDom(t)&&(this.removeNode(t),!0)},t.nodeIsConnectedToDom=function(e){let t=e._domNode;if(!t||t[s]!==e.id)return!1;let{body:n}=document;for(;t&&t!==n;)t=t.parentNode;return null!==t},t.getNodeForDomNode=function(e){let t=e[s];return void 0!==t?this._nodeRegistry.get(t):void 0},t.getNearestNodeForDomNode=function(e){let t=e;for(;null!=t;){let n=this.getNodeForDomNode(e);if(n)return n;t=t.parentNode}},t.cutTextNode=function(e,t){var n;if(!e.isTextNode())throw Error(`Trying to cut a non-text node: ${e.toString()}`);if(t<=0)return[null,e];let i=null!==(n=e.getText())&&void 0!==n?n:"";if(t>=i.length)return[e,null];let o=i.substring(0,t),r=i.substring(t),s=this.createTextNode(r,e.getFormattingInfo(),e.getAttributes());e.setText(o),s.applyClassesFrom(e);let a=[e,s];return e._parentNode&&e._parentNode.replaceChild(e,a),a},t.encapsulateTextContent=function(e,t,n){if(t+n<=0||n<=0)return[];let i=t,o=n;i<0&&(o+=i,i=0);let s=(0,r.O9)(e),a=i+o,d=s.map(e=>e.collectText().length),l=d.slice();for(let e=1;e<l.length;e++)l[e]+=l[e-1];let h=l.map((e,t)=>e-d[t]),c=(0,r.cx)(h,e=>e>i,h.length)-1,u=(0,r.cx)(h,e=>e>=a,h.length)-1;if(i>=l[l.length-1])return[];if(c===u){let[e,t]=this.cutTextNode(s[c],i-h[c]);if(t){let[e,n]=this.cutTextNode(t,a-i);if(e)return[e]}return[]}let[f,g]=this.cutTextNode(s[c],i-h[c]),_=g?[g]:[];for(let e=c+1;e<u;e++)_.push(s[e]);let[m,N]=this.cutTextNode(s[u],a-h[u]);return m&&_.push(m),_},t.encapsulateContentByOffset=function(e,t,n,i){var s,a,d,l;let h=[];if(t+n<0)return h;let c={tag:i.tag,classes:i.classes,nonContentNodeType:i.nonContentNodeType,type:null!==(s=i.type)&&void 0!==s?s:o.$P.INLINE,isContent:!1},u=t,f=n;u<0&&(f+=u,u=0);let g=(0,r.O9)(e),_=0===n,m=0,N=u;for(;m<g.length;){let e=g[m],t=e.collectText();if(t.length<N||t.length===N&&!_)N-=t.length,m+=1;else break}if(m===g.length)return h;let p=m,v=N+f;for(;p<g.length;){let e=g[p],t=e.collectText();if(t.length<v)v-=t.length,p+=1;else{p===m&&(v-=N);break}}p>=g.length&&(p=g.length-1,v+=g[g.length-1].collectText().length);let C=null,T=null;for(let e=m;e<=p;e+=1){let t=g[e],n=t.collectText(),i=[];if(e===m){let e=n.substring(0,N);if(e){let n=this.createTextNode(e,t.getFormattingInfo(),t.getAttributes());i.push(n),n.applyClassesFrom(t)}n=n.substring(e.length)}let o=t.getParentNode(),r=T,s=C!==o||!r||t.isLineBreak();if(s&&(T=r=this.createNodeFromDescription(c),h.push(r),i.push(r)),C=o,e===p){let e=n.substring(v);if(e){let n=this.createTextNode(e,t.getFormattingInfo(),t.getAttributes());i.push(n),n.applyClassesFrom(t)}n=n.substring(0,v)}null===(l=t.getParentNode())||void 0===l||l.replaceChild(t,i),t.isLineBreak()||t.setText(n),r.appendChild(t)}return null===(a=h[0])||void 0===a||a.addClass("--l"),null===(d=h[h.length-1])||void 0===d||d.addClass("--r"),h},e}();l.createNodeTreeFromDescription=e=>{let t=new l;return t.createNodeFromDescription(e)}},93843:function(e,t,n){n.d(t,{GB:function(){return a},O9:function(){return r},_n:function(){return s},cx:function(){return o}});var i=n(94434);let o=function(e,t,n){void 0===n&&(n=-1);let i=e.findIndex(t);return i<0?n:i},r=function(e,t){void 0===t&&(t=!0);let n=null;t&&(n=new i.oS(i.$P.LINE_BREAK,!0))._setTagName("br");let o=[],r=e=>{e._getChildNodes().forEach(e=>{if(e.isTextNode()||e.isLineBreak())o.push(e);else{var i;r(e),t&&e.isBlockNode()&&!(null!==(i=o[o.length-1])&&void 0!==i&&i.isLineBreak())&&e._parentNode._childNodes[e._parentNode._childNodes.length-1]!==e&&o.push(n)}})};return r(e),o},s=(e,t,n)=>{if(t+n<=0||n<=0)return"";let s=t,a=n;s<0&&(a+=s,s=0);let d=r(e);if(0===d.length)return"";let l=s+a,h=d.map(e=>e.collectText().length),c=h.slice();for(let e=1;e<c.length;e++)c[e]+=c[e-1];let u=c.map((e,t)=>e-h[t]);if(t>c[c.length-1])return"";let f=o(u,e=>e>s,u.length)-1,g=o(u,e=>e>=l,u.length)-1;if(f===g){let e=u[f],t=d[f].collectText().substring(s-e,l-e);return i.oS.textNodeToHtml(d[f],t)}let _=d[f].collectText().substring(s-u[f]),m=d[g].collectText().substring(0,l-u[g]),N=i.oS.textNodeToHtml(d[f],_),p=i.oS.textNodeToHtml(d[g],m),v="";for(let e=f+1;e<g;e++)v+=i.oS.textNodeToHtml(d[e]);return`${N}${v}${p}`},a=(e,t)=>{var n,i;let o;if(e.getParentNode())throw Error("Inner nodes not supported");if(t<0)return;let r=0;for(let n of null!==(i=e._childNodes)&&void 0!==i?i:[]){let e=n.collectText();if(t>=r&&t<r+e.length){o=n;break}r+=e.length}return o?{tag:null!==(n=o._tagName)&&void 0!==n?n:"P",id:o.id.toString()}:void 0}},35208:function(e,t,n){n.r(t),n.d(t,{canDTextareaBeUsed:function(){return j},dTextareaComponent:function(){return Z}});var i,o,r,s=n(91976),a=n(93219),d=n(90434),l=n(18229),h=n(84627),c=n(86679);let u=function(){function e(e){void 0===e&&(e=1e4),this._stack=void 0,this._currentIndex=void 0,this._stackSizeLimit=void 0,this.onUndoStackChange=void 0,this._stack=[],this._currentIndex=-1,this._stackSizeLimit=e,this.onUndoStackChange=(0,h.fo)()}var t=e.prototype;return t.isUndoAvailable=function(){return this._stack.length>0&&this._currentIndex>-1},t.isRedoAvailable=function(){return this._currentIndex+1<this._stack.length},t.getUndoCommand=function(){if(this.isUndoAvailable())return this._stack[this._currentIndex]},t.getRedoCommand=function(){if(this.isRedoAvailable())return this._stack[this._currentIndex+1]},t.fetchUndoCommand=function(){if(this.isUndoAvailable()){let e=this._stack[this._currentIndex];return this._currentIndex-=1,this.onUndoStackChange(),e}console.log("undo unavailable")},t.fetchRedoCommand=function(){if(this.isRedoAvailable()){let e=this._stack[this._currentIndex+1];return this._currentIndex+=1,this.onUndoStackChange(),e}console.log("redo unavailable")},t.pushUndoCommand=function(e){if(this.resetAfterCurrentIndex(),this._stack.length+1>this._stackSizeLimit){let e=this._stack.splice(0,this._stack.length+1-this._stackSizeLimit);this._currentIndex-=e.length}this._stack.push(e),this._currentIndex+=1,this.onUndoStackChange()},t.resetAfterCurrentIndex=function(){let e=this._stack.splice(this._currentIndex+1);return this.onUndoStackChange(),e},t.reset=function(){this._currentIndex=-1;let e=this._stack.splice(0);return this.onUndoStackChange(),e},e}();var f=n(94434),g=n(52425),_=n(98808);let m=function(){function e(e){this.enabled=void 0,this.onMutationCaptured=void 0,this._lastMutations=void 0,this._observer=void 0,this._rootDomNode=void 0,this._connected=!1,this.enabled=!0,this._rootDomNode=e,this.onMutationCaptured=(0,_.f)(),this._lastMutations=void 0;let t=new MutationObserver(e=>{this._lastMutations=e,this.applyMutations()});this._observer=t,this.reconnect()}var t=e.prototype;return t.disconnect=function(){if(!this._connected){console.error("Trying to disconnect already disconnected ChangeDetector");return}this._connected=!1,this._observer.disconnect()},t.reconnect=function(){if(this._connected){console.error("Trying to reconnect already connected ChangeDetector");return}this._connected=!0,this._observer.observe(this._rootDomNode,{attributes:!1,childList:!0,characterData:!0,subtree:!0})},t.applyMutations=function(){if(this._lastMutations&&this.enabled){this.enabled;let e=this._lastMutations;this._lastMutations=void 0,this.onMutationCaptured(e)}},e}();function N(e,t,n){return{action:e,path:t,nodeDescription:n}}var p=n(4769),v=n(72047),C=n(45695),T=n(46748);function E(e,t){let n=new DocumentFragment;t.forEach(e=>n.appendChild(e)),e.appendChild(n)}function b(e,t){let n=v.gP.fromDomNodeStyle(e);n&&t.applyFormatting(n),e instanceof HTMLElement&&t.applyAttributesFromDomNode(e)}function x(e){return e.nodeType===Node.ELEMENT_NODE&&e.hasAttribute("d-isAttachmentNode")}function k(e){if(x(e))return"";if(e.nodeType===Node.TEXT_NODE)return e.textContent;let t="";return e.childNodes.forEach(e=>{t+=k(e)}),t}function y(e,t,n){var i;void 0===n&&(n=1),e.set(t,(null!==(i=e.get(t))&&void 0!==i?i:0)+n)}function S(e,t,n){t.setDomNode(e),e[g.c1]=t.id,e.nodeType===Node.ELEMENT_NODE&&e.getAttribute("_d-id")!==`${t.id}`&&(e.setAttribute("_d-id",`${t.id}`),n&&y(n,"setAttribute"));let i=t.getAttributes();if(i&&e instanceof HTMLElement){let t=Object.keys(i);for(let n of t)e.setAttribute(n,i[n]),"href"===n&&(e.title=(0,T.S2)(i[n]))}if(t.isTextNode()?t.getText()===e.textContent?n&&y(n,"textUnchanged"):(e.textContent=t.getText(),n&&y(n,"updateText")):function(e,t,n){let i=e[g.Q2],o=t._eventListeners;if(!(0,f.FN)(i,o)){if(i)for(let t=i.length-1;t>=0;t--){let r=i[t];!(null!=o&&o.includes(r))&&(i.splice(t,1),e.removeEventListener(r.type,r.callback,r.options),n&&y(n,"removeListener"))}if(o&&o.length)for(let t of(i||(i=[],e[g.Q2]=i),o))!i.includes(t)&&(i.push(t),e.addEventListener(t.type,t.callback,t.options),n&&y(n,"addListener"))}}(e,t,n),e.__tContainsAttachmentNodes&&(e.childNodes.forEach(t=>{x(t)&&(e.removeChild(t),n&&y(n,"removeChild"))}),e.__tContainsAttachmentNodes=!1,n&&y(n,"setAttribute")),t._attachmentNodes&&Object.keys(t._attachmentNodes).length&&(Object.values(t._attachmentNodes).filter(e=>e).forEach(t=>{t.setAttribute("d-isAttachmentNode","true"),n&&y(n,"setAttribute"),e.appendChild(t),n&&y(n,"addChild")}),e.__tContainsAttachmentNodes=!0,n&&y(n,"setAttribute")),e.nodeType===Node.ELEMENT_NODE&&t.getParentNode()){let i=(0,p.Z)(t._classes).sort().join(" ");e.className!==i&&(e.className=i,n&&y(n,"updateClass")),e.hasAttribute("style")&&(e.removeAttribute("style"),n&&y(n,"removeAttribute"))}}function L(e,t,n){let i=null;if(i=e.isTextNode()?document.createTextNode(e.getText()):e.isLineBreak()?document.createElement("BR"):document.createElement(e._tagName||"d-container"),t&&y(t,"createNode"),i instanceof HTMLElement){i.setAttribute("_d-id",`${e.id}`),t&&y(t,"setAttribute");let o=e.getVirtualChildNodes().map(e=>L(e,t,n));E(i,o),t&&y(t,"addChild",i.childElementCount),e.onDomNodeCreated&&n.push(()=>e.onDomNodeCreated(i,e));let r=e.getNonContentNodeType();r&&(i[g.wd]=r)}return S(i,e,t),i}function D(e,t,n,i){let o=e.getChildNodes();if(0===o.length||n>=o.length){let e=o.length;return{domNode:t,offset:e}}let r=o[n],s=r.getChildNodes(),a=function e(t,n){if(t.isTextNode())return{node:t,offset:n};let i=t.getChildNodes(),o=n;for(let t=0;t<i.length;++t){let n=i[t],r=n.collectText().length;if(o<=r)return e(n,o);o-=r}return null}(r,i);if(a)return{domNode:a.node.getDomNode(),offset:a.offset};let d=function e(t){let n=t.getChildNodes();return n&&n.length?e(n[n.length-1]):t}(s[s.length-1]);if(d){var l,h;let e=(null===(l=d._domNode)||void 0===l?void 0:l.nodeType)===Node.TEXT_NODE?d._domNode:(null==d?void 0:null===(h=d._domNode)||void 0===h?void 0:h.nodeType)===Node.ELEMENT_NODE?d.isLineBreak()?d._domNode.parentNode:Array.from(d._domNode.childNodes).find(e=>e.nodeType===Node.TEXT_NODE)||d._domNode:null,t=d.isLineBreak()?0:d.collectText().length;return{domNode:e,offset:t}}return{domNode:r._domNode,offset:0}}function A(e,t){let n=t;for(;n&&n.parentNode!==e;)n=n.parentNode;return n}function I(e){let t=e.split("\n");return{numLineBreaks:t.length-1,distanceFromLastLineBreakTillEnd:t[t.length-1].length}}let P=new Set(["STYLE"]);var F=n(69764),R=n(66726),w=n.n(R);let M=function(){function e(){this.mouseDownTargetElement=null,this.mouseDownTargetId=null,this.mouseDownTargetParents=[],this.mouseDownScreenPosition=null,this.debug=!1,this.enabled=!0,this.TAG="[dTextarea ClickHelper]",this.maximumDistance=10,this.debouncedRaiseSimulatedClickEvent=w()(this.raiseSimulatedClickEvent,5),this.onLinkOutHandler=null}var t=e.prototype;return t.attach=function(t,n){this.onLinkOutHandler=null!=n?n:null,t.addEventListener("mousedown",t=>{this.log("mouse down"),this.mouseDownScreenPosition={x:t.screenX,y:t.screenY},this.mouseDownTargetElement=t.target,this.mouseDownTargetId=e.getDNodeId(t.target),t.target instanceof HTMLElement?this.mouseDownTargetParents=e.getParentList(t.target):this.mouseDownTargetParents=[]}),t.addEventListener("mouseup",t=>{if(this.log("mouse up"),!this.enabled)return;if(!t.target||!this.mouseDownScreenPosition||!this.mouseDownTargetElement||!this.mouseDownTargetId){this.reset();return}let n={x:t.screenX,y:t.screenY},i=this.mouseDownTargetElement!==t.target,o=this.mouseDownTargetId!==e.getDNodeId(t.target),r=e.distance(this.mouseDownScreenPosition,n),s=this.mouseDownTargetElement instanceof Node&&document.body.contains(this.mouseDownTargetElement);if(r<this.maximumDistance&&(i&&!s||o&&!i)){let e=new MouseEvent("click",{...t,ctrlKey:t.ctrlKey,metaKey:t.metaKey,altKey:t.altKey,view:window,bubbles:!0,cancelable:!0});this.log("requesting simulated mouse click"),this.debouncedRaiseSimulatedClickEvent(t.target,e,this.mouseDownTargetParents)}this.reset()}),t.addEventListener("click",e=>{this.debouncedRaiseSimulatedClickEvent.cancel(),this.log("click event processed on",e.target);let t=(0,T.u$)(e.target);if(t&&(t.contains(e.target)&&(this.log("click on link prevented"),e.preventDefault(),e.stopPropagation()),e.ctrlKey||e.metaKey)){let e=t.getAttribute("href");if(e){var n;this.log("linking out to:",e),null===(n=this.onLinkOutHandler)||void 0===n||n.call(this,e,t)}else this.log("not linking out, as no href attribute is set")}}),document.body.addEventListener("mouseup",e=>{this.reset()})},t.raiseSimulatedClickEvent=function(e,t,n){if(e instanceof HTMLElement&&!document.body.contains(e)&&n){let t=n.find(e=>document.body.contains(e));this.log("target is not in DOM, considering alternative: ",t,"of",n.slice()),t&&(e=t)}this.log("simulating mouse click",t,"on",e),e.dispatchEvent(t)},t.enableDebug=function(e){this.debug=e},t.enable=function(e){this.enabled=e},t.log=function(e){for(var t,n=arguments.length,i=Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];this.debug&&(t=console).debug.apply(t,[this.TAG,e].concat(i))},e.distance=function(e,t){let n=e.x-t.x,i=t.y-e.y;return Math.sqrt(n*n+i*i)},e.getParentList=function(t){if(t.parentElement){let n=e.getParentList(t.parentElement);return n.unshift(t),n}return[t]},e.getDNodeId=function(e){return e&&e instanceof HTMLElement?e.getAttribute("_d-id"):null},t.reset=function(){this.mouseDownScreenPosition=null,this.mouseDownTargetElement=null,this.mouseDownTargetParents=[],this.mouseDownTargetId=null},e}();var U=n(93843);let B=((i={})[i.DOM_CHANGE=0]="DOM_CHANGE",i[i.INTERNAL=1]="INTERNAL",i[i.UNDO_REDO=2]="UNDO_REDO",i),O=0,H=()=>new CustomEvent("dta_undo",{bubbles:!0}),z=function(){function e(e,t,n){void 0===n&&(n=`DTX${O+=1}`),this._nodeManager=new g.vm,this._undoStack=new u,this.onChange=(0,h.fo)(),this.onUndoStackChange=(0,h.fo)(),this._undoStackLockRegistry=new Set,this._autoUnlockUndoTimeouts=new Map,this.isUndoAvailable=()=>this._undoStack.isUndoAvailable()&&!this.isUndoStackLocked(),this.isRedoAvailable=()=>this._undoStack.isRedoAvailable()&&!this.isUndoStackLocked(),this.onNodeClicked=(0,h.fo)(),this.onPerformanceMeasured=(0,h.fo)(),this.onFormattingShortcutUsed=(0,h.fo)(),this._changeDetector=void 0,this._undoDetector=void 0,this._delayedFinalizeCommandCallback=null,this._debouncedTimeout=null,this._rootDomNode=void 0,this._rootNode=void 0,this._config_flatten=void 0,this._config_removeTextFormatting=void 0,this._config_normalizeSpaces=void 0,this._config_maxContentLength=void 0,this._config_measurePerformance=void 0,this._doFinalizeNodes=void 0,this._lastGarbageCollectionTime=Date.now(),this.prevCursorPos=void 0,this.batchingUndoChanges=!1,this.compositionStarted=!1,this.onCompositionModeChange=(0,h.fo)(),this.onLinkOut=(0,h.fo)(),this.wasMutationObserverTriggeredThisTick=!1,this._config_dbg=!1,this.name=void 0,this._prevDOMContent=null,this._util=null,this.clickHelper=new M,this.name=n,this._rootDomNode=e;let i=(e,n)=>t&&e in t?t[e]:n;this._config_flatten=i("flatten",!0),this._config_removeTextFormatting=i("removeTextFormatting",!0),this._config_normalizeSpaces=i("normalizeSpaces",!0),this._config_dbg=i("_dbg",!1),this._config_measurePerformance=i("measurePerformance",!1),this._config_maxContentLength=i("maxContentLength",null);let o=i("onChange");o&&this.onChange.push(o);let r=i("onLinkOut");r&&this.onLinkOut.push(r),this._doFinalizeNodes=i("doFinalizeNodes",void 0),this._changeDetector=new m(e),this._undoDetector=new c.cZ(this._rootDomNode,()=>this.undo(),()=>this.redo()),this._undoStack.onUndoStackChange.push(()=>{this.onUndoStackChange()});let s=this._nodeManager.createBlockContainerNode(e.tagName);e[g.c1]=s.id,this._rootNode=s,this._changeDetector.onMutationCaptured.push(()=>{this.wasMutationObserverTriggeredThisTick=!0,this._applyDomChanges(),setTimeout(()=>{this.wasMutationObserverTriggeredThisTick=!1},0)}),this._rootDomNode.addEventListener("input",e=>{"insertFromPaste"!==e.inputType&&this.getText().length>0||this.isCompositionInProgress()||this._applyDomChanges(!this.wasMutationObserverTriggeredThisTick)}),this._initDOM();let a=i("onContextMenu");a&&e.addEventListener("contextmenu",e=>{let t=this._nodeManager.getNearestNodeForDomNode(e.target);return a(e,t)}),s.resetRecordedChanges(),this._applyDomChanges(!0),this.resetUndoStack()}var t=e.prototype;return t._initDOM=function(){let e=this._rootDomNode;this.log("[_initDOM]","Init",e),e.addEventListener("keydown",e=>{this._config_removeTextFormatting||this.normalizeTextFormattingHotkeys(e)}),e.addEventListener("click",e=>{let t=e.target;for(;t&&!t[g.c1];)t=t.parentNode;if(t){let n=this._nodeManager.getNodeForDomNode(t);n&&this.onNodeClicked(n,e)}}),e.addEventListener("keyup",()=>this.updatePrevCursorPos()),e.addEventListener("mouseup",()=>this.updatePrevCursorPos()),e.addEventListener("touchend",()=>this.updatePrevCursorPos()),e.addEventListener("compositionstart",e=>{this._changeDetector.enabled=!1,this.compositionStarted=!0,this.onCompositionModeChange(!0)}),e.addEventListener("compositionend",e=>{this._changeDetector.enabled=!0,this._changeDetector.applyMutations(),this.compositionStarted=!1,this.onCompositionModeChange(!1)}),this.clickHelper.attach(e,(e,t)=>this.onLinkOut(e,t))},t.log=function(){if(this._config_dbg){for(var e,t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];(e=console).log.apply(e,[this.name].concat(n))}},t.updatePrevCursorPos=function(e){void 0===e&&(e=this._getCursorPos()),this.batchingUndoChanges||this.compositionStarted||(this.prevCursorPos=e)},t.setFinalizeNodesHandler=function(e){this._doFinalizeNodes=e},t.getFirstLevelNodes=function(){return this._rootNode.getChildNodes()},t.getNodeById=function(e){return this._nodeManager.getNodeById(e)},t.getText=function(){let e=this._rootNode.collectText();return e},t.updateText=function(e){var t;this.log("[updateText]",e);let n=e.split("\n"),i=[];n.forEach(e=>{let t=document.createElement("DIV");""===e?t.appendChild(document.createElement("BR")):t.textContent=e,i.push(t)}),(t=this._rootDomNode).replaceChildren.apply(t,i),this._applyDomChanges(!0)},t.getHtml=function(e){return void 0===e&&(e=this._rootNode),e.collectHtml(!1)},t.getTextNodesForRange=function(e,t,n){return void 0===n&&(n=this._rootNode),this._nodeManager.encapsulateTextContent(n,e,t)},t.updateHtml=function(e,t){void 0===t&&(t=this._rootNode);let n=t.getDomNode();if(!n||!(n instanceof HTMLElement))throw Error(`Trying to update HTML of non-HTML element: ${t.toString()}`);n.innerHTML=e,this._applyDomChanges(!0)},t.undo=function(){let e="[undo]";if(this.isUndoStackLocked()){this.log(e,"prevented as undo stack is locked");return}this.log(e,"undo"),this._cancelDebouncedFinalizeCommand(!0);let t=this._undoStack.fetchUndoCommand();t&&(this._applyCommand(t,!1),this._rootDomNode.dispatchEvent(H()))},t.redo=function(){let e="[redo]";if(this.isUndoStackLocked()){this.log(e,"prevented as undo stack is locked");return}this.log(e,"redo"),this._cancelDebouncedFinalizeCommand(!0);let t=this._undoStack.fetchRedoCommand();t&&(this._applyCommand(t,!0),this._rootDomNode.dispatchEvent(H()))},t.resetUndoStack=function(){this._cancelDebouncedFinalizeCommand(!1),this._undoStack.reset(),this._rootNode.resetRecordedChanges(),this.updatePrevCursorPos()},t.applyInternalChanges=function(e){if(void 0===e&&(e=!0),this.isCompositionInProgress())return;this._beginMeasuringPerformance(),this._markMeasurementStart("getCursorPos");let t=this._getCursorPos();this._markMeasurementEnd("getCursorPos"),this._cleanupNodes();let n=null;e&&(n=this.getChangedParagraphs(),this._finalizeCommand(this.prevCursorPos,t)),this._finalizeNodesBeforeUpdate(B.INTERNAL,n),this._updateDom(),this._restoreCursorPos(t),this.updatePrevCursorPos(t),this._updateGarbageCollection(),this.onChange(),this._finishMeasuringPerformance(F.z.INTERNAL)},t.applyInternalMetaChanges=function(){this._beginMeasuringPerformance(),this._markMeasurementStart("getCursorPos");let e=this._getCursorPos();this._markMeasurementEnd("getCursorPos"),this._updateDom(),this._restoreCursorPos(e),this._updateGarbageCollection(),this._finishMeasuringPerformance(F.z.INTERNAL)},t._updateGarbageCollection=function(){let e=Date.now();e>this._lastGarbageCollectionTime+6e4&&setTimeout(()=>{this._garbageCollect()},20)},t._garbageCollect=function(){this._lastGarbageCollectionTime=Date.now(),this._nodeManager.garbageCollect()},t._isTreeSyncRequired=function(){let e=this._rootDomNode.innerHTML;return e!==this._prevDOMContent},t._applyDomChanges=function(e){if(void 0===e&&(e=!1),!e&&!this._isTreeSyncRequired())return;this._beginMeasuringPerformance(),null!=this._config_maxContentLength&&(this._markMeasurementStart("truncate"),function(e,t,n){var i,o,r;if((null!==(i=e.textContent)&&void 0!==i?i:"").length<=t)return;let s=null===(o=document.activeElement)||void 0===o?void 0:o.contains(e),a=n.enabled;a&&(n.enabled=!1);let d=0,l=e,h=e=>{if(l=e,e.nodeType===Node.TEXT_NODE){var n;let i=(null!==(n=e.textContent)&&void 0!==n?n:"").length;if((d+=i)>t){let n=d-t;e.textContent=e.textContent.substring(0,e.textContent.length-n)}}else{let n=[];e.childNodes.forEach(e=>{d<=t?h(e):n.push(e)}),n.forEach(e=>e.remove())}};if(h(e),s){let e=window.getSelection(),t=new Range,n=Math.max((null!==(r=l.textContent)&&void 0!==r?r:"").length-1,0);t.setStart(l,n),e.removeAllRanges(),e.addRange(t)}a&&setTimeout(()=>{n.enabled=!0})}(this._rootDomNode,this._config_maxContentLength,this._changeDetector),this._markMeasurementEnd("truncate")),this._markMeasurementStart("updateNodesFromDom"),function e(t,n){return function(t,n){let i=n.getNodeForDomNode(t);if(i){if(t.nodeType===Node.TEXT_NODE){if(i.getText()===k(t))return i.clearFormatting(),i}else if(t.nodeType===Node.ELEMENT_NODE&&i.isTextNode()){if(Array.from(t.childNodes).every(e=>x(e)||e.nodeType===Node.TEXT_NODE)&&i.getText()===k(t))return b(t,i),i}else if(t.nodeType===Node.ELEMENT_NODE){let o=i.getChildNodes(),r=[];return t.childNodes.forEach(t=>{x(t)||r.push(e(t,n))}),(0,f.FN)(o,r)||i.replaceChildren(r.filter(e=>void 0!==e&&(!e.isTextNode()||e.isTextNode()&&""!==e.collectText()))),b(t,i),i}}return null}(t,n)||function(t,n){if(t.nodeType===Node.TEXT_NODE){let e=t.textContent,i=n.createTextNode(e);return t[g.c1]=i.id,i}if(t.nodeType===Node.ELEMENT_NODE){if("BR"===t.tagName){let e=n.createLineBreakNode();return t[g.c1]=e.id,e}let i=null;return i=C.tB.has(t.tagName)?n.createBlockContainerNode(t.tagName,!0):n.createInlineNode(t.tagName,!0),b(t,i),t.childNodes.forEach(t=>{x(t)||i.appendChild(e(t,n))}),t[g.c1]=i.id,i}return console.log("[updateNodesFromDom]","ignore",t),n.createTextNode("")}(t,n)}(this._rootDomNode,this._nodeManager),this._markMeasurementEnd("updateNodesFromDom"),this._markMeasurementStart("getCursorPos");let t=this._getCursorPos();this._markMeasurementEnd("getCursorPos"),this._cleanupNodes(),this.batchingUndoChanges=!0,this._debounceFinalizeCommand(this.prevCursorPos,t),this._finalizeNodesBeforeUpdate(B.DOM_CHANGE),this._updateDom(),this._prevDOMContent=this._rootDomNode.innerHTML,this._restoreCursorPos(t),this._updateGarbageCollection(),this.onChange(),this._finishMeasuringPerformance(F.z.DOMCHANGES)},t._markMeasurementStart=function(e){this._config_measurePerformance&&performance.mark(`dTextarea_${e}_start`)},t._markMeasurementEnd=function(e){this._config_measurePerformance&&performance.mark(`dTextarea_${e}_end`)},t._beginMeasuringPerformance=function(){this._config_measurePerformance&&(performance.clearMarks(),performance.clearMeasures(),performance.mark("dTextarea_performance_start"))},t._finishMeasuringPerformance=function(e){var t,n,i,o,r,s;if(!this._config_measurePerformance)return;let a=e=>{try{return performance.measure(e,`dTextarea_${e}_start`,`dTextarea_${e}_end`).duration}catch(e){return null}};performance.mark("dTextarea_performance_end");let d={total:a("performance"),truncation:a("truncation"),updateNodesFromDom:a("updateNodesFromDom"),cleanupNodes:a("cleanupNodes"),finalizeNodes:a("finalizeNodes"),updateDom:a("updateDom"),getCursorPos:a("getCursorPos"),other:0,characterCount:this.getText().length,trigger:e};d.other=d.total-(null!==(t=d.truncation)&&void 0!==t?t:0)-(null!==(n=d.updateNodesFromDom)&&void 0!==n?n:0)-(null!==(i=d.cleanupNodes)&&void 0!==i?i:0)-(null!==(o=d.finalizeNodes)&&void 0!==o?o:0)-(null!==(r=d.updateDom)&&void 0!==r?r:0)-(null!==(s=d.getCursorPos)&&void 0!==s?s:0),this.onPerformanceMeasured(d)},t._updateDom=function(){this._markMeasurementStart("updateDom");let e=new Map;this._changeDetector.disconnect(),this._rootDomNode=function(e,t,n){void 0===n&&(n=null);let i=[],o=function e(t,n,i,o){if(void 0===o&&(o=null),o&&y(o,"touchNodeForUpdate"),t.isTextNode()&&n.nodeType!==Node.TEXT_NODE||!t.isTextNode()&&n.nodeType!==Node.ELEMENT_NODE||t._tagName&&t._tagName!==n.tagName)return L(t,o,i);if(S(n,t,o),t.isTextNode())return n;let r=t.getVirtualChildNodes(),s=n.childNodes,a=new Set(s),d=Array(r.length),l=r.length;if(l>0&&a.size){let e=new Map;a.forEach(t=>{let n=t[g.c1];n&&n>0&&e.set(n,t)}),r.forEach((t,n)=>{let i=e.get(t.id);i&&(l-=1,a.delete(i),d[n]=i)})}if(l>0&&a.size){let e=new Map;a.forEach(t=>{let n=t[g.wd];n&&(e.has(n)||e.set(n,[]),e.get(n).push(t))}),r.forEach((t,n)=>{if(!d[n]){let i=t.getNonContentNodeType();if(i&&e.has(i)&&e.get(i).length){let t=e.get(i).shift();l-=1,a.delete(t),d[n]=t}}})}if(l>0&&a.size){let e=[];a.forEach(t=>{t.nodeType===Node.TEXT_NODE&&e.push(t)}),r.forEach((t,n)=>{if(!d[n]&&t.isTextNode()&&e.length){let t=e.shift();l-=1,a.delete(t),d[n]=t}})}r.forEach((t,n)=>{d[n]&&(d[n]=e(t,d[n],i,o))}),l>0&&r.forEach((e,t)=>{d[t]||(d[t]=L(e,o,i))});let h=Object.values(t._attachmentNodes||{}).filter(e=>e);h.length&&d.push.apply(d,(0,p.Z)(h));let c=Array.from(s);if(!(0,f.FN)(c,d)){let e=0;for(;e<c.length&&c[e]===d[e];)e+=1;let t=c.slice(e);t.forEach(e=>{n.removeChild(e),o&&y(o,"removeChild")});let i=d.slice(e);i.length&&(E(n,i),o&&y(o,"addChild",i.length))}return n}(e,t,i,n);return i.forEach(e=>e()),o}(this._rootNode,this._rootDomNode,e),this._changeDetector.reconnect(),this._markMeasurementEnd("updateDom")},t._cleanupNodes=function(){var e,t,n,i,o;this._markMeasurementStart("cleanupNodes"),e=this._rootNode,t=this._nodeManager,n=this._config_removeTextFormatting,i=this._config_normalizeSpaces,this._config_dbg,function(e,t){let n=e=>{if(!e._isUnclean)return[e];let i=[];if(e._tagName&&P.has(e._tagName))return t.removeNode(e),i;let o=e.getChildNodes();for(let e=0;e<o.length;e+=1)i.push.apply(i,(0,p.Z)(n(o[e])));return e.replaceChildren(i),[e]},i=[];e.getChildNodes().slice(0).forEach(e=>i.push.apply(i,(0,p.Z)(n(e)))),e.replaceChildren(i)}(e,t),function(e,t){let n=e.getChildNodes();if(1===n.length&&"BR"===n[0]._tagName&&t.removeNode(n[0]),0===e.getChildNodes().length){let n=t.createBlockContainerNode("DIV");n.appendChild(t.createLineBreakNode()),e.appendChild(n)}}(e,t),function(e,t){let n=e=>{var i,o,r;if(!e._isUnclean)return[e];if(!e.isTextNode()){if(null!==(o=e.getChildNodes())&&void 0!==o&&o.length){let t=[];null===(r=e.getChildNodes())||void 0===r||r.forEach(e=>t.push.apply(t,(0,p.Z)(n(e)))),e.replaceChildren(t)}return[e]}let s=[];if(null!==(i=e.getText())&&void 0!==i&&i.includes("\n")){t.removeNode(e);let n=e.getText().split("\n");n.forEach((e,i)=>{""!==e&&s.push(t.createTextNode(e)),i<n.length-1&&s.push(t.createLineBreakNode())})}else s.push(e);return s},i=[];e.getChildNodes().forEach(e=>i.push.apply(i,(0,p.Z)(n(e)))),e.replaceChildren(i)}(e,t),function(e,t){let n=e=>{let i=[e],o=e,r=[],s=[];if(!e._isUnclean)return i;for(e.getChildNodes().forEach(e=>{r.push.apply(r,(0,p.Z)(n(e)))});r.length;){let n=r.shift();if(null!=n&&n.isLineBreak()){if(0===r.length)s.push(n);else{e.isInlineNode()?i.push(n):t.removeNode(n);let r=s.splice(0);0===r.length&&r.push(t.createLineBreakNode()),o.replaceChildren(r),o=t.createNodeWithEqualType(e),i.push(o)}}else s.push(n)}return o.replaceChildren(s),i},i=[];e.getChildNodes().forEach(e=>i.push.apply(i,(0,p.Z)(n(e)))),e.replaceChildren(i)}(e,t),function(e,t,n){let i=e=>{if(!e._isUnclean)return;let o=!1,r=[];e.getChildNodes().slice(0).forEach(e=>{e.isTextNode()||i(e),e.isInlineNode()&&(n||!e.isFormattingInlineNode())?(r.push.apply(r,(0,p.Z)(e.detachChildren())),t.removeNode(e),o=!0):r.push(e)}),o&&e.replaceChildren(r)};i(e)}(e,t,n),n||function(e){let t=e=>{if(!e._isUnclean)return;let n=e._childNodes.slice();if(e.isFormattingBlockNode()){let t=e.getFormattingInlineNodeTypes();t.length>0&&n.forEach(e=>{let n=e.getOrCreateFormattingInfoForAnyNodeType();for(let e of t)n.set(e,!0)}),e.clearFormatting()}if(n.forEach(e=>t(e)),e.isFormattingInlineNode()){var i;let t=e.getFormattingInlineNodeTypes();(t.length>0||e.hasAttributes())&&e._childNodes.forEach(n=>{if(n.isTextNode()){let i=n.getOrCreateFormattingInfo();for(let e of t)i.set(e,!0);n.applyAttributesFromDNode(e)}}),null===(i=e._parentNode)||void 0===i||i.replaceChild(e,e._childNodes.slice())}};t(e)}(e),function(e,t){let n=e.getChildNodes(),i=[],o=e=>{if(!e._isUnclean)return;let n=Array.from(e.getChildNodes()),r=null;for(let s=0;s<n.length;s++){let a=n[s];a.isBlockNode()?(e.detachChild(a),r&&r.getChildNodes().length&&i.push(r),i.push(a),r=t.createLineNode(),o(a)):r&&r.appendChild(a)}r&&r.getChildNodes().length?i.push(r):r&&t.removeNode(r)};for(let e=0;e<n.length;e++){let t=n[e];i.push(t),o(t)}e.replaceChildren(i)}(e,t),function(e,t){let n=null,i=e=>{if(!e._isUnclean)return[e];if(e.isEmpty()&&!e.isLineBreak())return(0,f.NL)(e),e.getParentNode()&&(0,f.NL)(e.getParentNode()),t.removeNode(e),(0,f.NL)(e),[];if(e.isLineBreak()){let i=[];if(n)n=null;else{let e=t.createLineNode();e.appendChild(t.createLineBreakNode()),i.push(e)}if(!e.getNextSibling()&&!e._parentNode.isLineNode()){let e=t.createLineNode();e.appendChild(t.createLineBreakNode()),i.push(e)}return i}if(e.isLineNode())return n=null,[e];if(e.isBlockNode()){let i=t.createLineNode();return i.replaceChildren(e.detachChildren()),e.getParentNode().detachChild(e),t.removeNode(e),(0,f.NL)(e),n=null,[i]}let i=null==n||e.isLineBreak();return i&&(n=t.createLineNode()),n.appendChild(e),(0,f.NL)(n),i?[n]:[]};(0,f.NL)(e);let o=[];e.getChildNodes().forEach(e=>o.push.apply(o,(0,p.Z)(i(e)))),e.replaceChildren(o)}(e,t),n&&function(e){e._childNodes.forEach(e=>{e.isLineNode()&&"P"!==e._tagName&&(e._tagName="P")})}(e),function(e,t,n){let i=[],o=e=>{if(!e._isUnclean)return;let t=e.getChildNodes(),r=t.length,s=[];for(let e=0;e<r;)if(t[e].isTextNode()){let o=t[e];s.push(o);let r=t[e];for(e+=1;null!==(a=t[e])&&void 0!==a&&a.isTextNode()&&(n||t[e].hasIdenticalMetaInformation(r));){var a;o.setText(o.getText()+t[e].getText()),i.push(t[e]),e+=1}}else o(t[e]),s.push(t[e]),e+=1;r!==s.length&&e.replaceChildren(s)};o(e),i.forEach(e=>t.removeNode(e))}(e,t,n),i&&function(e,t){let n=e=>{var t;e._isUnclean&&(null===(t=e.getChildNodes())||void 0===t||t.forEach(e=>{e.isTextNode()?e.normalizeSpaces():n(e)}))};n(e)}(e,0),function(e,t){let n=e=>{var t,i;e._isUnclean&&(null===(t=e.getChildNodes())||void 0===t||t.forEach(n),null!==(i=e.getFormattingInfo())&&void 0!==i&&i.get("link")&&!e.hasAttribute("href")&&e.getFormattingInfo().set("link",!1))};n(e)}(e,0),e.markAsClean(),(0,f.NL)(e,!0),this._markMeasurementEnd("cleanupNodes")},t._getCursorPos=function(){let e=window.getSelection(),t={line:0,offset:0,lineEnd:void 0,offsetEnd:void 0};if(e){if(!1===e.isCollapsed){let n=e.getRangeAt(0),i=this._createCursorPos(n.startContainer,n.startOffset,!0),o=this._createCursorPos(n.endContainer,n.endOffset,!1),r=function(e,t){if(!e.focusNode||!e.anchorNode)return!1;if(e.focusNode===e.anchorNode)return e.focusOffset<e.anchorOffset;let n=A(t,e.focusNode),i=A(t,e.anchorNode);if(!n||!i)return!1;let o=Array.from(t.childNodes);return o.indexOf(i)>o.indexOf(n)}(e,n.commonAncestorContainer),s=r?o:i,a=r?i:o;t.line=s.line,t.offset=s.offset,t.lineEnd=a.line,t.offsetEnd=a.offset}else if(e.focusNode){let n=this._createCursorPos(e.focusNode,e.focusOffset,!1);t.line=n.line,t.offset=n.offset}}return t},t._createCursorPos=function(e,t,n){return function(e,t,n,i,o){var r,s,a;let d=-1,l=0,h=n,c=i,u=e._domNode;if(u&&!u.contains(h))return{line:0,offset:0};if(h.hasChildNodes()){let e=Array.from(h.childNodes),t=e[c-1];t&&(c=(null===(r=(h=t).textContent)||void 0===r?void 0:r.length)||0)}let f=t.getNearestNodeForDomNode(h);if(f===e){if(o)return{line:0,offset:0};let t=Math.max(c-1,0),n=null!==(s=null===(a=e.getChildNodes()[t])||void 0===a?void 0:a.collectText().replace(/\n*$/,"").length)&&void 0!==s?s:0;return{line:t,offset:n}}let g=!1;return function t(n){for(let i=0;i<n.length&&!g;i++){let r=n[i];if(f===r){let{numLineBreaks:t,distanceFromLastLineBreakTillEnd:s}=I(f.collectText().substring(0,c));t>0?(d+=t,l=s):l+=s,r.isLineBreak()&&i!==n.length-1||r._tagName&&C.tB.has(r._tagName)?(d+=1,l=o?0:c):r.isTextNode()&&r.getParentNode()===e&&0===i&&(d+=1),g=!0}else if(r.isLineBreak()&&i!==n.length-1)d+=1,l=0;else if(r._tagName&&C.tB.has(r._tagName)){let n=r.getChildNodes();(!n||n[0]&&!n[0]._tagName||n[0]&&n[0]._tagName&&!C.tB.has(n[0]._tagName)&&(r!==e||"DIV"===r._tagName))&&(d+=1,l=0),t(n)}else if(r.isTextNode()&&r.collectText().replace(/\n/g,"").length&&r.getParentNode()===e&&0===i)d+=1;else if(t(r.getChildNodes()),r.isTextNode()){let{numLineBreaks:e,distanceFromLastLineBreakTillEnd:t}=I(r.collectText());e>0?(d+=e,l=t):l+=t}}}(e.getChildNodes()),{line:d=d>=0?d:0,offset:l}}(this._rootNode,this._nodeManager,e,t,n)},t._isActiveElement=function(){return document.activeElement===this._rootDomNode},t._restoreCursorPos=function(e,t,n){if(void 0===e&&(e={line:0,offset:0,lineEnd:void 0,offsetEnd:void 0}),void 0===t&&(t=!1),void 0===n&&(n=!1),n){setTimeout(()=>this._restoreCursorPos(e,t,!1),0);return}(t||this._isActiveElement())&&function(e,t,n){void 0===n&&(n={line:0,offset:0,lineEnd:void 0,offsetEnd:void 0});let i=void 0!==n.lineEnd&&n.line>n.lineEnd||void 0!==n.offsetEnd&&n.line===n.lineEnd&&n.offset>n.offsetEnd,o=D(e,t,n.line,n.offset),r=void 0!==n.lineEnd?D(e,t,n.lineEnd,n.offsetEnd):void 0;if(o)try{let e=window.getSelection(),t=(null==e?void 0:e.isCollapsed)&&e.anchorNode===e.focusNode,n=!1==!!r,s=t&&n&&function(e,t){if(!e.isCollapsed)return!1;let n=t.domNode!==(null==e?void 0:e.anchorNode),i=(null==e?void 0:e.anchorOffset)!==t.offset;return!n&&!i}(e,o),a=!t&&!n&&function(e,t,n){if(e.isCollapsed||e.anchorNode!==e.focusNode||t.domNode!==n.domNode)return!1;let i=e.anchorOffset===t.offset,o=e.focusOffset===n.offset;return!!i&&!!o}(e,o,r);if(s||a);else{let t=new Range;t.setStart(o.domNode,o.offset),r&&!i&&t.setEnd(r.domNode,r.offset),r||t.collapse(!0),e.removeAllRanges(),e.addRange(t),i&&e.extend(r.domNode,r.offset)}}catch(e){console.warn("[cursorPosFunctions]","cursor pos could not be set",n,e)}}(this._rootNode,this._rootDomNode,e)},t.lockUndoStack=function(e,t){void 0===t&&(t=-1);let n=0===this._undoStackLockRegistry.size;if(this._undoStackLockRegistry.add(e),n&&(this._cancelDebouncedFinalizeCommand(!1),this.batchingUndoChanges=!0,this.onUndoStackChange()),t>=0){let n=this._autoUnlockUndoTimeouts.get(e);n&&clearTimeout(n);let i=setTimeout(()=>{this.unlockUndoStack(e)},t);this._autoUnlockUndoTimeouts.set(e,i)}},t.unlockUndoStack=function(e){if(this._undoStackLockRegistry.has(e)){if(this._undoStackLockRegistry.delete(e),0===this._undoStackLockRegistry.size){var t;null===(t=this._delayedFinalizeCommandCallback)||void 0===t||t.call(this),this.batchingUndoChanges=!1,this.onUndoStackChange()}let n=this._autoUnlockUndoTimeouts.get(e);n&&clearTimeout(n)}},t.isUndoStackLocked=function(){return this._undoStackLockRegistry.size>0},t._debounceFinalizeCommand=function(e,t){this._cancelDebouncedFinalizeCommand(!1);let n=()=>{this._finalizeCommand(e,t),this.batchingUndoChanges=!1,this._delayedFinalizeCommandCallback=null,this.updatePrevCursorPos(t)};this._delayedFinalizeCommandCallback=n,this.isUndoStackLocked()||(this._debouncedTimeout=setTimeout(n,275))},t._cancelDebouncedFinalizeCommand=function(e){if(void 0===e&&(e=!1),this._debouncedTimeout){if(e){var t;null===(t=this._delayedFinalizeCommandCallback)||void 0===t||t.call(this)}clearTimeout(this._debouncedTimeout),this._debouncedTimeout=null}},t._finalizeCommand=function(e,t){if(!this._rootNode._isChanged)return;let n=function(e,t,n){let i=[],o=[];if(e._prevState&&function(e){if(!e._prevState)return!1;let t=e._childNodes.filter(t=>e._prevState.childNodes.find(e=>e.id===t.id)),n=t.map(t=>e._prevState.childNodes.findIndex(e=>e.id===t.id));for(let e=1;e<n.length;e++)if(n[e]<n[e-1])return!0;return!1}(e)){let t=e.prevToDescription(),n=e.toDescription();i.unshift(N("REPLACE_SUBTREE",[],t)),o.push(N("REPLACE_SUBTREE",[],n))}else e.getChildNodes().forEach((e,t)=>{if(!e._isChanged)return;let n=e.prevToDescription(),r=e.toDescription();void 0===n&&void 0!==r?(i.unshift(N("REMOVE_SUBTREE",[t])),o.push(N("INSERT_SUBTREE",[t],r))):void 0!==n&&void 0!==r&&(i.unshift(N("REPLACE_SUBTREE",[t],n)),o.push(N("REPLACE_SUBTREE",[t],r)))}),e._prevState&&e._prevState.childNodes.forEach((t,n)=>{if(t._parentNode!==e){let e=t.prevToDescription();i.push(N("INSERT_SUBTREE",[n],e)),o.unshift(N("REMOVE_SUBTREE",[n]))}});return i.push(N("SET_CURSOR",[],t)),o.push(N("SET_CURSOR",[],n)),{type:"command",backwardActions:i,forwardActions:o}}(this._rootNode,e,t);n&&this._undoStack.pushUndoCommand(n),this._rootNode.resetRecordedChanges()},t._applyCommand=function(e,t){if(void 0===t&&(t=!1),void 0!==e){let n=function(e,t,n,i,o){let r=i,s=o?e.forwardActions:e.backwardActions;return s.forEach(e=>{let{path:i}=e;switch(e.action){case"INSERT_SUBTREE":(function(e,t,n,i){let o=t[t.length-1],r=i.createNodeFromDescription(n);e.insertChildren(o,[r])})(n.getNodeForPath(t,i.slice(0,-1)),i.slice(-1),e.nodeDescription,n);break;case"REMOVE_SUBTREE":(function(e){let t=e._parentNode;if(!t)throw Error("Can't remove root node");t.detachChild(e)})(n.getNodeForPath(t,i));break;case"REPLACE_SUBTREE":(function(e,t,n,i){if(e===n){(function(e,t,n){let i=n.createNodeFromDescription(e);t.replaceChildren(i._childNodes.slice()),n.removeNode(i),(0,f.NL)(t)})(t,n,i);return}let o=e._parentNode,r=o._childNodes.indexOf(e),s=i.createNodeFromDescription(t);o.replaceChild(r,[s])})(n.getNodeForPath(t,i),e.nodeDescription,t,n);break;case"SET_CURSOR":r=e.nodeDescription}}),r}(e,this._rootNode,this._nodeManager,this._getCursorPos(),t);this._cleanupNodes(),this._rootNode.resetRecordedChanges(),this._finalizeNodesBeforeUpdate(B.UNDO_REDO),this._updateDom(),this._prevDOMContent=this._rootDomNode.innerHTML,this.updatePrevCursorPos(),this._restoreCursorPos(n,!0,!this._isActiveElement()),this.onChange()}},t._finalizeNodesBeforeUpdate=function(e,t){if(this._markMeasurementStart("finalizeNodes"),this._doFinalizeNodes){let n=t||this.getChangedParagraphs();try{this._doFinalizeNodes(this._nodeManager,n,e)}catch(e){setTimeout(()=>{throw e})}}this._markMeasurementEnd("finalizeNodes")},t.getChangedParagraphs=function(){return this._rootNode.getChildNodes().filter(e=>e._isChanged)},t.isCompositionInProgress=function(){return this.compositionStarted},t.hasAnyFormatting=function(){return this._rootNode.containsAnyFormatting()},t.getHtmlForRange=function(e,t,n){return void 0===n&&(n=this._rootNode),(0,U._n)(n,e,t)},t.getParagraphInfoForCharacterOffset=function(e){return(0,U.GB)(this._rootNode,e)},t.toDescription=function(){return this._rootNode.toDescription()},t.normalizeTextFormattingHotkeys=function(e){if(e.key&&((0,T.ED)()&&e.ctrlKey||(0,T.V5)()&&e.metaKey)){let n=(0,T.ZT)().trim().replaceAll("\n",""),i=this.getText().trim().replaceAll("\n",""),o=n===i;switch(e.key.toUpperCase()){case"B":t("bold"),this.onFormattingShortcutUsed(F.T.BOLD,o);break;case"I":t("italic"),this.onFormattingShortcutUsed(F.T.ITALIC,o);break;case"U":t("underline"),this.onFormattingShortcutUsed(F.T.UNDERLINE,o);break;case".":t("superscript"),this.onFormattingShortcutUsed(F.T.SUPERSCRIPT,o);break;case",":t("subscript"),this.onFormattingShortcutUsed(F.T.SUBSCRIPT,o)}}function t(t){e.preventDefault(),e.stopPropagation(),document.execCommand(t,!1,void 0)}},(0,s.Z)(e,[{key:"previousCursorPosition",get:function(){return this.prevCursorPos}}]),e}(),$={dTextarea:z,dNode:f.oS,NodeTypes:f.$P,ActionTypes:{INSERT_SUBTREE:"INSERT_SUBTREE",REMOVE_SUBTREE:"REMOVE_SUBTREE",REPLACE_SUBTREE:"REPLACE_SUBTREE",SET_CURSOR:"SET_CURSOR"}};"undefined"!=typeof window&&null!==(o=window)&&void 0!==o&&o.M&&window.M.registerAsync("dTextarea",$);let K={maxContentLength:null,removeTextFormatting:!0,normalizeSpaces:!0,flatten:!0},Z=function(e){function t(t,n,i){var o;return void 0===n&&(n={}),void 0===i&&(i=!1),(o=e.call(this)||this).name=t,o.adjustedConfig=n,o._dbg=i,o._onblur=null,o._onfocus=null,o.wasChanged=!1,o.textarea=null,o.eventListenerMap=void 0,o.div=null,o.htmlPlaceholder=null,o.attributesChangedBeforeInit=new Set,o.eventListenerMap=new Map,o}(0,a.Z)(t,e);var n=t.prototype;return n.attributeChangedCallback=function(e,t,n){if(!this.textarea){this.attributesChangedBeforeInit.add(e);return}switch(e){case"value":t!==n&&this.textarea.updateText(n);break;case"disabled":this._updateEnabled();break;case"placeholder":this._updatePlaceholderState();break;case"data-remove-rtf":t!==n&&(this.textarea._config_removeTextFormatting="false"!==n);break;default:if(!this.div){this.warnNotInitialized(`Prop ${e}`),this.attributesChangedBeforeInit.add(e);return}this.div.setAttribute(e,n)}},n._updateEnabled=function(){return this.div?this.disabled?(this.div.setAttribute("contenteditable","false"),this.div.setAttribute("aria-disabled","true"),this.div.setAttribute("tabindex","-1"),!1):(this.div.setAttribute("contenteditable","true"),this.div.setAttribute("aria-disabled","false"),this.div.setAttribute("tabindex","0"),!0):(this.warnNotInitialized(this._updateEnabled.name),!1)},n.addEventListener=function(t,n,i){if(!this.div){this.warnNotInitialized(this.addEventListener.name);return}if(null!=i&&i.doNotModify){this.div.addEventListener(t,n,i);return}let o=()=>{};switch(t){case"blur":case"focus":o=e=>{n instanceof Function?n(e):n.handleEvent(e)},this.div.addEventListener(t,o,i);break;default:e.prototype.addEventListener.call(this,t,n,i)}o&&this.eventListenerMap.set(n,o)},n.removeEventListener=function(t,n,i){let o=n,r=this.eventListenerMap.get(n);r&&(o=r,this.eventListenerMap.delete(n)),e.prototype.removeEventListener.call(this,t,o,i)},n.setSelectionRange=function(e,t){if(!this.textarea){this.warnNotInitialized(this.setSelectionRange.name);return}let n=null!=e?e:0;if(n<0||t&&t<n){this.setSelectionRange(null!=t?t:0);return}let i=this.textarea.getFirstLevelNodes(),o=r(n);if(t&&n!==t){let{line:e,offset:n}=r(t);o.lineEnd=e,o.offsetEnd=n}function r(e){let t=0,n=e;for(;t<i.length&&n>=i[t].collectText().length;)n-=i[t].collectText().length,t+=1;return t>=i.length?{line:i.length-1,offset:i[i.length-1].collectText().length}:{line:t,offset:n}}this.textarea._restoreCursorPos(o)},n._getSelectionRange=function(){var e,t,n,i;if(!this.textarea)return this.warnNotInitialized(this._getSelectionRange.name),{from:0,to:0};let o=this.textarea.getFirstLevelNodes(),r=this.textarea._getCursorPos(),s={from:null!==(e=a(o,r.line,r.offset))&&void 0!==e?e:0,to:null!==(t=a(o,null!==(n=r.lineEnd)&&void 0!==n?n:r.line,null!==(i=r.offsetEnd)&&void 0!==i?i:r.offset))&&void 0!==t?t:0};return s;function a(e,t,n){t>e.length&&(l.uT("[getCharIndex]: index requested for line number larger than given lines",{level:"warning",extra:{line:t,offset:n,lines:e.length}}),t=e.length);let i=0;for(let n=0;n<t;n++)i+=e[n].collectText().length;return i+n}},n.initContenteditable=function(e){e.setAttribute("contenteditable","true"),e.setAttribute("role","textbox"),e.setAttribute("aria-multiline","true"),e.setAttribute("tabindex","0"),e.setAttribute("data-content","true")},n.initPlaceholder=function(e){e.setAttribute("aria-hidden","true"),e.setAttribute("tabIndex","-1")},n.connectedCallback=function(){var e;this.div=this.querySelector('[data-content="true"]'),this.div||(this.div=document.createElement("div"),this.firstChild?this.insertBefore(this.div,this.firstChild):this.appendChild(this.div)),this.initContenteditable(this.div),this.htmlPlaceholder=this.querySelector('[data-placeholder="true"]'),this.htmlPlaceholder&&this.initPlaceholder(this.htmlPlaceholder);let t=this.getAttribute("data-remove-rtf");t&&(this.adjustedConfig.removeTextFormatting="false"!==t),this.textarea=new z(this.div,{...K,...this.adjustedConfig,_dbg:this._dbg},this.name);let n=this.getAttribute("value");n&&this.textarea.updateText(n),this._updatePlaceholderState(),this._updateEnabled();let i=this.attributesChangedBeforeInit.keys();for(let e of i){let t=this.getAttribute(e);null!=t&&this.div.setAttribute(e,t)}this.attributesChangedBeforeInit.clear(),this.addEventListener("focus",()=>{this.wasChanged=!1}),null===(e=this.div)||void 0===e||e.addEventListener("paste",()=>{var e;null!==(e=this.textarea)&&void 0!==e&&e._config_removeTextFormatting||(this.div.classList.add("no-pre-wrap"),setTimeout(()=>this.div.classList.remove("no-pre-wrap"),0))}),this.textarea.onChange.push(()=>{this._updatePlaceholderState(),this.hasFocus()&&(this.wasChanged=!0)}),this.textarea.onCompositionModeChange.push(()=>{this._updatePlaceholderState()}),this.addEventListener("blur",()=>{this.wasChanged&&(this.dispatchChangeEvent(),this.wasChanged=!1)})},n.dispatchChangeEvent=function(){let e=document.createEvent("Event");e.initEvent("change",!0,!0),this.dispatchEvent(e)},n.hasFocus=function(){let e=document.activeElement;if(e===document.body)return!1;for(;e;){if(e===this.div)return!0;e=e.parentElement}return!1},n.select=function(){if(!this.textarea){this.warnNotInitialized(this.select.name);return}this.focus();let e=this.textarea.getFirstLevelNodes();e.length>0?this.textarea._restoreCursorPos({line:0,offset:0,lineEnd:e.length-1,offsetEnd:e[e.length-1].collectText().length}):this.textarea._restoreCursorPos({line:0,offset:0,lineEnd:0,offsetEnd:0})},n.focus=function(){if(!this.textarea||!this.div){this.warnNotInitialized(this.focus.name);return}this.textarea._isActiveElement()||(this.div.focus(),this.textarea._restoreCursorPos(this.textarea.previousCursorPosition))},n._updatePlaceholderState=function(){var e,t,n,i,o,r;if(!this.textarea||!this.div){this.warnNotInitialized(this._updatePlaceholderState.name);return}if(this.htmlPlaceholder)this.div.removeAttribute("placeholder"),""!==this.value||this.textarea.isCompositionInProgress()?null===(r=this.htmlPlaceholder)||void 0===r||r.classList.remove("show"):null===(o=this.htmlPlaceholder)||void 0===o||o.classList.add("show");else{let e="";""!==this.value||this.textarea.isCompositionInProgress()||(e=this.getAttribute("placeholder")||""),e?this.div.setAttribute("placeholder",e):this.div.removeAttribute("placeholder")}null===(e=this.div)||void 0===e||e.setAttribute("aria-placeholder",null!==(t=null!==(n=this.getAttribute("placeholder"))&&void 0!==n?n:null===(i=this.htmlPlaceholder)||void 0===i?void 0:i.innerText)&&void 0!==t?t:"")},n.warnNotInitialized=function(e){console.warn(`"${e} was called before the component was attached to the DOM.`)},(0,s.Z)(t,[{key:"disabled",get:function(){let e=this.getAttribute("disabled");return null!=e&&"false"!==e},set:function(e){e?this.setAttribute("disabled",""):this.removeAttribute("disabled")}},{key:"dTextarea",get:function(){return this.textarea}},{key:"value",get:function(){return this.textarea?this.textarea.getText():(this.warnNotInitialized("get value"),"")},set:function(e){if(!this.textarea){this.warnNotInitialized("set value");return}this.textarea.updateText(null!=e?e:"")}},{key:"onblur",get:function(){return this._onblur},set:function(e){this._onblur&&this.removeEventListener("blur",this._onblur),this._onblur=e,e&&e instanceof Function&&this.addEventListener("blur",e)}},{key:"onfocus",get:function(){return this._onfocus},set:function(e){this._onfocus&&this.removeEventListener("focus",this._onfocus),this._onfocus=e,e&&e instanceof Function&&this.addEventListener("focus",e)}},{key:"selectionStart",get:function(){let{from:e,to:t}=this._getSelectionRange();return Math.min(e,t)},set:function(e){this.setSelectionRange(e,this.selectionEnd)}},{key:"selectionEnd",get:function(){let{from:e,to:t}=this._getSelectionRange();return Math.max(e,t)},set:function(e){this.setSelectionRange(this.selectionStart,e)}}],[{key:"observedAttributes",get:function(){return["value","disabled","placeholder","aria-labelledby","data-remove-rtf","lang","spellcheck","data-gram,","data-gramm_editor","data-enable-grammarly"]}}]),t}((0,d.Z)(HTMLElement)),G=!1;try{"undefined"!=typeof window&&(customElements.define("d-textarea",Z),G=!0)}catch(e){console.warn("[dTextarea Web Component]","customElement definition failed, dTextarea not usable")}function j(){return G}"undefined"!=typeof window&&null!==(r=window)&&void 0!==r&&r.M&&window.M.registerAsync("dTextareaComponent",Z)},69764:function(e,t,n){var i,o;n.d(t,{T:function(){return s},z:function(){return r}});let r=((i={})[i.UNSPECIFIED=0]="UNSPECIFIED",i[i.INTERNAL=1]="INTERNAL",i[i.DOMCHANGES=2]="DOMCHANGES",i),s=((o={})[o.UNSPECIFIED=0]="UNSPECIFIED",o[o.BOLD=1]="BOLD",o[o.ITALIC=2]="ITALIC",o[o.UNDERLINE=3]="UNDERLINE",o[o.STRIKETHROUGH=4]="STRIKETHROUGH",o[o.SUBSCRIPT=5]="SUBSCRIPT",o[o.SUPERSCRIPT=6]="SUPERSCRIPT",o)},46748:function(e,t,n){n.d(t,{Av:function(){return r},ED:function(){return o},S2:function(){return a},V5:function(){return i},ZT:function(){return d},u$:function(){return s}});let i=()=>{var e;return(null===(e=navigator)||void 0===e?void 0:e.userAgent.toLowerCase().indexOf("macintosh"))>-1},o=()=>{var e;return(null===(e=navigator)||void 0===e?void 0:e.userAgent.toLowerCase().indexOf("windows"))>-1};function r(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function s(e){let t=e;for(;t;){if(t instanceof HTMLAnchorElement)return t;t=t.parentElement}if(e instanceof HTMLElement&&1===e.childNodes.length){let t=e.childNodes[0];if(t instanceof HTMLAnchorElement)return t}return null}function a(e){return e.length>1e3?`${e.substring(0,500)}...${e.substring(e.length-500)}`:e}let d=()=>{let e=window.getSelection();return!e||e.isCollapsed?"":e.toString()}}}]);