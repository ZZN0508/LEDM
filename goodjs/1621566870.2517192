/*!
 * nanoStream Webcaster API v.5.9.2
 * (c) 2017-2020, nanocosmos gmbh
 * https://www.nanocosmos.de
 * sales@nanocosmos.de
 * 
 * LEGAL NOTICE:
 * This material is subject to the terms and conditions defined in
 * separate license conditions ('LICENSE.txt' or nanocosmos.de/terms).
 * All information contained herein is, and remains the property
 * of nanocosmos GmbH and its suppliers if any. The intellectual and technical concepts
 * contained herein are proprietary to nanocosmos GmbH, and are protected by trade secret
 * or copyright law. Dissemination of this information or reproduction of this material
 * is strictly forbidden unless prior written permission is obtained from nanocosmos.
 * All modifications will remain property of nanocosmos.
 */!function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=82)}([function(e,t,r){var n;void 0===(n=function(){"use strict";var e=Math.floor,t=Math.random,r={browserInfo:void 0,debugLevel:0,debugCount:0,debugMax:30,ELEMENT_DEBUG:"debug",ELEMENT_MESSAGES:"messages",ELEMENT_ERRORS:"errors",parseJSON:function(e,t,n){if("object"==typeof e)return e;try{return JSON.parse(e,t)}catch(t){r.error("Error:"+t+" parsing from json: "+e,n)}},stringifyJSON:function(e,t,n,i){if(r.isString(e))return e;try{return JSON.stringify(e,t,n)}catch(t){r.error("Error:"+t+" stringifying to json: "+e,i)}},encodeURIComponent:function(e,t){if(r.isString(e))return decodeURIComponent(e)===e?encodeURIComponent(e):e;r.error("Error: could not uri encode: "+e+"(must be of type string)",t)},getElement:function(e){var t=document.getElementById(e);return t||(r.debug("DOM element not found "+e),{value:void 0,checked:void 0,enabled:void 0,textContent:void 0,options:{length:0},style:{},innerHTML:"",src:"",classList:"",click:function(){return null},show:function(){return null},hide:function(){return null},removeChild:function(){return null}})},print:function(e){r._log(e,"messages")},success:function(e){r._log(e,"messages","green")},warning:function(e){r._log(e,"messages","orange")},error:function(e,t){t||(t=1),r._log(e,r.ELEMENT_MESSAGES,"red"),r._log(e,r.ELEMENT_ERRORS,"red",t)},debug:function(e){0!==r.debugLevel&&r._log(e,r.ELEMENT_DEBUG)},_log:function(e,t,n,i){switch(r.isObject(e)&&(e=r.stringifyJSON(e,null," ")),n){case"green":e="Success: "+e;break;case"orange":e="Warning: "+e;break;case"red":e="Error: "+e;break;default:n=""}n?console.log("%c"+e,"color:"+n):console.log(e);var o=document.getElementById(t);if(o&&(t===r.ELEMENT_DEBUG&&r.debugCount>r.debugMax&&(o.removeChild(o.firstChild),r.debugCount++),o.innerHTML+="<span"+(n?' style="color:'+n+';">':">")+e+"</span><br>"),i>1)throw new Error(e)},isBool:function(e){return!0===e||!1===e},isIntString:function(e){return r.isString(e)&&r.isInt(Number(e))},isNumber:function(e){return Number(e)===e&&isFinite(e)},isIntInRange:function(e,t,n){return r.isNumber(e)&&e>=t&&e<=n},isInt:function(e){return e===Number(e)&&e%1==0},isUint:function(e){return e===Number(e)&&e%1==0&&e>=0},isString:function(e){return"string"==typeof e||e instanceof String},isFunction:function(e){return"function"==typeof e},isObject:function(e){return!!e&&e.constructor!==Array&&("object"==typeof e||e instanceof Object)},isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},isEmpty:function(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0},getRandomUint:function(n){return n=r.isUint(n)?n:10,e(t()*n)},getRandomString:function(e,t){var n;switch(e){case 0:n="0123456789";break;case 1:n="0123456789abcdefghijklmnopqrstuvwxyz";break;case 2:n="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";break;default:n="0123456789abcdefghijklmnopqrstuvwxyz"}for(var i="",o=r.getRandomUint,s=r.isUint(t)?t:6,a=n.length,c=0;c<s;c++)i+=n[o(a)];return i},getTime:function(){return(new Date).toISOString()},getKeyByValue:function(e,t){if(r.isObject(e))return Object.keys(e).filter(function(r){return e[r]===t})[0]},enumContainsValue:function(e,t){for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&e[r]===t)return!0;return!1},enumToString:function(e){var t=[];for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var i=e[n];r.isFunction(i)||t.push(e[n])}return t.join()},getVersionText:function(e,t,r){var n="Your browser: "+e+" v."+t;return r&&(n+=" (mobile)"),n},getSupportText:function(e,t,n,i){var o=r.getVersionText(e,t,n),s="";return i>0&&(s=o+" is not supported.",i>1&&(s=o+" is not fully supported. ",s+="You may try to use it, but it may show issues. Please report any issues to https://webrtc.live.")),s},createBrowserInfo:function(){var e="";screen.width&&(e+=(screen.width?screen.width:"")+" x "+(screen.height?screen.height:""));var t,n,i,o=navigator.appVersion,s=navigator.userAgent,a=navigator.appName,c=""+parseFloat(o),d=parseInt(o,10);-1!==(n=s.indexOf("Opera"))&&(a="Opera",c=s.substring(n+6),-1!==(n=s.indexOf("Version"))&&(c=s.substring(n+8))),-1!==(n=s.indexOf("OPR/"))?(a="Opera",c=s.substring(n+4)):-1!==(n=s.indexOf("MSIE"))?(a="Microsoft Internet Explorer",c=s.substring(n+5)):"Netscape"===a&&-1!==(n=s.indexOf("Trident/"))?(a="Microsoft Internet Explorer",c=s.substring(n+8),-1!==(n=s.indexOf("rv:"))&&(c=s.substring(n+3))):"Netscape"===a&&-1!==(n=s.indexOf("Edge/"))?(a="Microsoft Edge",c=s.substring(n+5)):-1!==(n=s.indexOf("Chrome"))?(a="Chrome",c=s.substring(n+7)):-1!==(n=s.indexOf("Safari"))?(a="Safari",c=s.substring(n+7),-1!==(n=s.indexOf("Version"))&&(c=s.substring(n+8)),-1!==s.indexOf("CriOS")&&(a="Chrome")):-1!==(n=s.indexOf("Firefox"))?(a="Firefox",c=s.substring(n+8)):(t=s.lastIndexOf(" ")+1)<(n=s.lastIndexOf("/"))&&(a=s.substring(t,n),c=s.substring(n+1),a.toLowerCase()===a.toUpperCase()&&(a=navigator.appName)),-1!==(i=c.indexOf(";"))&&(c=c.substring(0,i)),-1!==(i=c.indexOf(" "))&&(c=c.substring(0,i)),-1!==(i=c.indexOf(")"))&&(c=c.substring(0,i)),d=parseInt(""+c,10),isNaN(d)&&(c=""+parseFloat(o),d=parseInt(o,10));var u=/Mobile|mini|Fennec|Android|iP(ad|od|hone)/.test(o),l=navigator.cookieEnabled;void 0!==navigator.cookieEnabled||l||(document.cookie="testcookie",l=-1!==document.cookie.indexOf("testcookie"));for(var p="Unknown",f=[{os:"Windows XP",regex:/(Windows NT 5.1|Windows XP)/},{os:"Windows Server 2003",regex:/Windows NT 5.2/},{os:"Windows Vista",regex:/Windows NT 6.0/},{os:"Windows 7",regex:/(Windows 7|Windows NT 6.1)/},{os:"Windows 8.1",regex:/(Windows 8.1|Windows NT 6.3)/},{os:"Windows 8",regex:/(Windows 8|Windows NT 6.2)/},{os:"Windows NT 4.0",regex:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{os:"Windows ME",regex:/Windows ME/},{os:"Android",regex:/Android/},{os:"Open BSD",regex:/OpenBSD/},{os:"Sun OS",regex:/SunOS/},{os:"Linux",regex:/(Linux|X11)/},{os:"iOS",regex:/(iPhone|iPad|iPod)/},{os:"Mac OS X",regex:/Mac OS X/},{os:"Mac OS",regex:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{os:"QNX",regex:/QNX/},{os:"UNIX",regex:/UNIX/},{os:"BeOS",regex:/BeOS/},{os:"OS/2",regex:/OS\/2/},{os:"Search Bot",regex:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}],h=0,g=f.length;h<g;++h)if(f[h].regex.test(s)){p=f[h].os;break}var v="Unknown";switch(/Windows/.test(p)&&(v=(/Windows (.*)/.exec(p)||[])[1],p="Windows"),p){case"Mac OS X":v=(/Mac OS X (10[\.\_\d]+)/.exec(s)||[])[1];break;case"Android":v=(/Android ([\.\_\d]+)/.exec(s)||[])[1];break;case"iOS":v=(v=/OS (\d+)_(\d+)_?(\d+)?/.exec(o)||[])[1]+"."+v[2]+"."+(0|v[3])}r.browserInfo={screenSize:e,browser:a,browserVersion:c,mobile:u,os:p,osVersion:v,cookiesEnabled:l}}};return r.createBrowserInfo(),r}.apply(t,[]))||(e.exports=n)},function(e,t){e.exports=function(e){return null!=e&&"object"==typeof e}},function(e,t,r){var n,i;n=[r(0),r(6),r(3),r(46),r(87)],void 0===(i=function(e,t,r,n,i){"use strict";var o=e.getTime,s=e.stringifyJSON,a=e.isObject,c=e.isNumber,d=e.isIntInRange,u=e.isString,l=e.isEmpty,p=0,f={_console:{loggers:[],level:t.LOG_LEVEL.INFO},_graylog:{loggers:[],credentials:{accountId:"",accountKey:""},baseUrl:"https://glog1.nanocosmos.de/gelf/"},_globalPrefix:"nanowebrtc",setConfig:function(e){if(console.log(o()+": ["+f._globalPrefix+"][LoggerController] - setConfig("+s(e)+")"),!a(e)||l(e))throw r.TypeNotValidError("config","Object");if(a(e.console)){if(c(e.console.level)&&d(e.console.level,t.LOG_LEVEL.DISABLED,t.LOG_LEVEL.VERBOSE))f._console.level=e.console.level;else{var n=r.ValueNotValidError("config.console.level","0|1|2|3|4");console.error(o()+": ["+f._globalPrefix+"][LoggerController] - setConfig(): "+s(n))}f._console.loggers.forEach(function(e){e._level=f._console.level})}if(a(e.graylog)){if(!a(e.graylog.credentials)||l(e.graylog.credentials))throw r.TypeNotValidError("config.graylog.credentials","Object");if(!u(e.graylog.credentials.accountId))throw r.TypeNotValidError("config.graylog.credentials.accountId","String");if(0==e.graylog.credentials.accountId.length)throw r.ValueNotValidError("config.graylog.credentials.accountId","1..n characters");if(!u(e.graylog.credentials.accountKey))throw r.TypeNotValidError("config.graylog.credentials.accountKey","String");if(0==e.graylog.credentials.accountKey.length)throw r.TypeNotValidError("config.graylog.credentials.accountKey","1..n characters");f._graylog.credentials.accountId=""+e.graylog.credentials.accountId,f._graylog.credentials.accountKey=""+e.graylog.credentials.accountKey,f._graylog.loggers.forEach(function(e){e._credentials.accountId=f._graylog.credentials.accountId,e._credentials.accountKey=f._graylog.credentials.accountKey})}},create:function(a,c){if(e.enumContainsValue(t.LOGGER_TYPE,c)){var d=void 0;return p++,c===t.LOGGER_TYPE.GRAYLOG?(d=new i(f._globalPrefix,f._console.level,f._graylog.baseUrl,f._graylog.credentials.accountId,f._graylog.credentials.accountKey,p),f._graylog.loggers.push(d)):(d=new n(f._globalPrefix,a,f._console.level,p),f._console.loggers.push(d)),d}var u=r.EnumValueNotValidError(c,t.LOGGER_TYPE);console.log(o()+": ["+f._globalPrefix+"][LoggerController] - create(): "+s(u))},delete:function(e){for(var t,r,n=!1,i=0;i<f._console.loggers.length;i++)if(t=f._console.loggers[i],e._id===t._id){f._console.loggers.splice(i,1),n=!0;break}if(n)return n;for(var o=0;o<f._graylog.loggers.length;o++)if(r=f._graylog.loggers[o],e._id===r._id){f._graylog.loggers.splice(o,1),n=!0;break}return n}};return f}.apply(t,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r(0)],void 0===(i=function(e){"use strict";var t=e.enumToString,r=function(e,t,r,n){this.name=e,this.type="NanoError",this.code=t,this.message=r,this.userinfo=n,this.toJSON=function(){return{error:{name:this.name,type:this.type,code:this.errorCode,message:this.message,userinfo:this.userinfo}}}},n=function(){};return n.GeneralError=function(e){return new r("GeneralError",1e3,e=e)},n.TypeNotValidError=function(e,t){return new r("TypeNotValidError",1001,'"'+e+'" type not valid',{value:e,expected_type:t})},n.ValueNotValidError=function(e,t){return new r("ValueNotValidError",1002,'"'+e+'" value not valid',{value:e,expected_value:t})},n.EnumValueNotValidError=function(e,n){return new r("EnumValueNotValidError",1003,'"'+e+'" enum value not valid',{value:e,expected_values:t(n)})},n.ObjectNotExistError=function(e,t){return new r("ObjectNotExistError",1004,'"'+e+'" object not exist',{value:e,expected_type:t})},n.FunctionNotDefinedError=function(e){return new r("FunctionNotDefinedError",1005,'"'+e+'" function not defined',{func:e})},n.OperationNotAllowedError=function(e,t){return new r("OperationNotAllowedError",1006,"Operation not allowed, reason: "+t)},n.RequestError=function(e,t){return new r("RequestError",2e3,"",{status:e,statusText:t})},n.WebSocketError=function(e,t){return new r("WebSocketError",3e3,e,{server:t})},n.WrongStateError=function(e){return new r("WrongStateError",3001,"Wrong state",{state:e})},n.CreateWebSocketError=function(e,t){return new r("CreateWebSocketError",3002,e,{server:t})},n.SignInError=function(e){return new r("SignInError",4e3,"Sign in failed",{reason:e})},n.NotSignedInError=function(){return new r("NotSignedInError",4001,"Session not signed in")},n.StartBroadcastError=function(e){return new r("StartBroadcastError",5001,"Starting broadcast failed",{reason:e})},n.BroadcastError=function(e){return new r("BroadcastError",5002,"Broadcast failed",{reason:e})},n.StopBroadcastError=function(e){return new r("StopBroadcastError",5003,"Stopping broadcast failed",{reason:e})},n.DeviceBlockedError=function(e,t){return new r("DeviceBlockedError",6e3,"Media stream received, but no "+(e?e+" ":"")+"data from device"+(t?' "'+t+'". ':". ")+"Device could be in use from another application",{kind:e,label:t})},n.MediaStreamTrackError=function(){return new r("MediaStreamTrackError",6001,"Media stream received, but no tracks",{})},n.MediaStreamNotFoundError=function(){return new r("MediaStreamNotFoundError",6002,"Media stream not found",{})},n.MediaStreamNotRemovedError=function(){return new r("MediaStreamNotRemovedError",6003,"Media stream not removed",{})},n.DevicesNotFoundError=function(){return new r("DevicesNotFoundError",6004,'Devices not set for "getUserMedia"',{})},n.GetUserMediaError=function(e,t){var n=e&&e.constraint?e.constraint:void 0,i=e&&e.name&&!n?e.name:n?"OverconstrainedError":"GetUserMediaError",o=e&&e.message?e.message:"Failed to get user / display media.";return new r(i,6005,o,{constraint:n,retry:t})},n.EnumerateDevicesError=function(e){var t=e&&e.name?e.name:"EnumerateDevicesError",n=e&&e.message?e.message:"Failed to enumerate devices.";return new r(t,6006,n,{})},n.GetDisplayMediaError=function(e,t){return new r(e,6008,t=t||'Failed to call "getDisplayMedia".',{})},n.ServerError=function(e){return new r("ServerError",7e3,"An error has occurred on server side",{reason:e})},n.composeEvent=function(e,t){var r="",n=void 0,i="",o=void 0;switch(e.name){case"GeneralError":r="GeneralError",i=e.message||"General error";break;case"TypeNotValidError":r="TypeNotValidError",i=e.message;break;case"ValueNotValidError":r="ValueNotValidError",i=e.message;break;case"EnumValueNotValidError":r="EnumValueNotValidError",i=e.message;break;case"ObjectNotExistError":r="ObjectNotExistError",i=e.message;break;case"FunctionNotDefinedError":e.userinfo&&e.userinfo.func&&(-1!==e.userinfo.func.indexOf("getUserMedia")?r="GetUserMediaError":-1!==e.userinfo.func.indexOf("getDisplayMedia")?r="GetDisplayMediaError":-1!==e.userinfo.func.indexOf("enumerateDevices")&&(r="EnumerateDevicesError"),i=e.userinfo.func+" not defined");break;case"RequestError":r="RequestError",i=e.message;break;case"WebSocketError":r="RequestError";break;case"WrongStateError":r="WrongStateError",i=e.message;break;case"SignInError":r="SignInError",i=e.message;break;case"NotSignedInError":r="NotSignedInError",i=e.message;break;case"StartBroadcastError":r="StartBroadcastError",i=e.message;break;case"BroadcastError":r="BroadcastError",i=e.message;break;case"StopBroadcastError":r="StopBroadcastError",i=e.message;break;case"DeviceBlockedError":case"MediaStreamTrackError":r="MediaStreamError",i=e.message;break;case"MediaStreamNotFoundError":r="NoStreamError",i="No stream is available for the device.";break;case"MediaStreamNotRemovedError":r="MediaStreamNotRemovedError",i=e.message;break;case"DevicesNotFoundError":r="NoDeviceError",i='No device is available for "getUserMedia".';break;case"GetUserMediaError":case"PermissionDenied":case"NotAllowedError":case"NotReadableError":case"NotFoundError":case"OverconstrainedError":case"AbortError":case"GetMediaError":case"NoDeviceError":case"NoStreamError":r=e.name,i=e.message,n=e.userinfo.constraint,o=e.userinfo.retry;break;case"EnumerateDevicesError":r="EnumerateDevicesError",i=e.message;break;case"ServerError":r="ServerError",i=e.message;break;case"WebrtcServerError":r="WebrtcServerError",i=e.message;break;default:r=e.name||"UnknownError",i=e.message||"Unknown error."}var s={};return s.name=t||e.name,s.data={error:r+": "+i,message:i,text:i,constraint:n,errorType:r,retry:o},s.error={name:e.name,type:e.type,code:e.code,message:e.message,text:e.message,userinfo:e.userinfo},s},n}.apply(t,n))||(e.exports=i)},function(e,t,r){var n=r(12),i=r(114),o=r(115),s="[object Null]",a="[object Undefined]",c=n?n.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?a:s:c&&c in Object(e)?i(e):o(e)}},function(e,t,r){var n;
/*!
 * EventEmitter v4.2.11 - git.io/ee
 * Unlicense - http://unlicense.org/
 * Oliver Caldwell - http://oli.me.uk/
 * @preserve
 */(function(){"use strict";function t(){}var i=t.prototype,o=this,s=o.EventEmitter;function a(e,t){for(var r=e.length;r--;)if(e[r].listener===t)return r;return-1}function c(e){return function(){return this[e].apply(this,arguments)}}i.getListeners=function(e){var t,r,n=this._getEvents();if(e instanceof RegExp)for(r in t={},n)n.hasOwnProperty(r)&&e.test(r)&&(t[r]=n[r]);else t=n[e]||(n[e]=[]);return t},i.flattenListeners=function(e){var t,r=[];for(t=0;t<e.length;t+=1)r.push(e[t].listener);return r},i.getListenersAsObject=function(e){var t,r=this.getListeners(e);return r instanceof Array&&((t={})[e]=r),t||r},i.addListener=function(e,t){var r,n=this.getListenersAsObject(e),i="object"==typeof t;for(r in n)n.hasOwnProperty(r)&&-1===a(n[r],t)&&n[r].push(i?t:{listener:t,once:!1});return this},i.on=c("addListener"),i.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},i.once=c("addOnceListener"),i.defineEvent=function(e){return this.getListeners(e),this},i.defineEvents=function(e){for(var t=0;t<e.length;t+=1)this.defineEvent(e[t]);return this},i.removeListener=function(e,t){var r,n,i=this.getListenersAsObject(e);for(n in i)i.hasOwnProperty(n)&&-1!==(r=a(i[n],t))&&i[n].splice(r,1);return this},i.off=c("removeListener"),i.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},i.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},i.manipulateListeners=function(e,t,r){var n,i,o=e?this.removeListener:this.addListener,s=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(n=r.length;n--;)o.call(this,t,r[n]);else for(n in t)t.hasOwnProperty(n)&&(i=t[n])&&("function"==typeof i?o.call(this,n,i):s.call(this,n,i));return this},i.removeEvent=function(e){var t,r=typeof e,n=this._getEvents();if("string"===r)delete n[e];else if(e instanceof RegExp)for(t in n)n.hasOwnProperty(t)&&e.test(t)&&delete n[t];else delete this._events;return this},i.removeAllListeners=c("removeEvent"),i.emitEvent=function(e,t){var r,n,i,o,s=this.getListenersAsObject(e);for(o in s)if(s.hasOwnProperty(o))for(i=(r=s[o].slice(0)).length;i--;)!0===(n=r[i]).once&&this.removeListener(e,n.listener),n.listener.apply(this,t||[])===this._getOnceReturnValue()&&this.removeListener(e,n.listener);return this},i.trigger=c("emitEvent"),i.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},i.emitSimple=function(e,t,r){return this.emitEvent(e,[{name:e||"AnonymousEvent",data:t||{},error:r||{}}])},i.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},i._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},i._getEvents=function(){return this._events||(this._events={})},t.noConflict=function(){return o.EventEmitter=s,t},void 0===(n=function(){return t}.call(o,r,o,e))||(e.exports=n)}).call(this)},function(e,t,r){var n;void 0===(n=function(){"use strict";return{STREAM_NOMEDIASTREAM:1,STREAM_ACTIVE:2,STREAM_INACTIVE:3,STREAM_ENDED:4,MEDIA_SOURCES:{CAMERA:"camera",SCREEN:"screen"},ELEMENT_TYPES:{VIDEO:"video",AUDIO:"audio"},LOGGER_TYPE:{CONSOLE:"console",GRAYLOG:"graylog"},LOG_LEVEL:{DISABLED:0,ERROR:1,WARNING:2,INFO:3,VERBOSE:4},BROADCAST_STATE:{IDLE:1,INITIALIZED:2,STARTED:3,SIGNALING:4,CONNECTED:5,BROADCASTING:6,RECONNECTING:7,DISCONNECTED:8,FAILED:9,STOPPED:10},CHATPEER_STATE:{IDLE:1,INITIALIZED:2,SIGNALING:3,SIGNALLING_DONE:4,CALLING:5,NEGOTIATION_NEEDED:7,DISCONNECTED:8,FAILED:9,STOPPED:10},SCREEN_CAPTURE_BROWSER:{CHROME:"chrome",FIREFOX:"firefox",SAFARI:"safari"},EVENT_NAMES:{webcast:["SignInSuccess","SignInError","ServerError","SignOutSuccess","SignOutError","SetConfigError","ReceivedServerStats","ReceivedWebRTCStats","StartBroadcastSuccess","StartBroadcastError","BroadcastStatus","BroadcastError","StopBroadcastSuccess","StopBroadcastError","Error","ReceivedDeviceList","GetDevicesError","SetVideoDeviceError","SetAudioDeviceError","GetSelectedVideoDeviceError","GetSelectedAudioDeviceError","GetSelectedDeviceError","StartPreviewSuccess","StartPreviewError","StopPreviewSuccess","StopPreviewError","MuteDeviceError","StreamTrackEnded"],chat:["EnterRoomSuccess","EnterRoomError","LeaveRoomSuccess","LeaveRoomError","InvokeCall","HangUpCall","AnswerCall","DeclineCall","PeerListUpdated","CallIncoming","CallDeclined","CallActive","RemoteStreamError"]}}}.apply(t,[]))||(e.exports=n)},function(e,t,r){var n=r(52),i="object"==typeof self&&self&&self.Object===Object&&self,o=n||i||Function("return this")();e.exports=o},function(e,t){var r=Array.isArray;e.exports=r},function(e,t){e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},function(e,t,r){var n=r(51),i=r(117);e.exports=function(e,t){var r=i(e,t);return n(r)?r:void 0}},function(e,t,r){var n=r(146),i=r(34),o=r(147),s=r(148),a=r(149),c=r(4),d=r(54),u=d(n),l=d(i),p=d(o),f=d(s),h=d(a),g=c;(n&&"[object DataView]"!=g(new n(new ArrayBuffer(1)))||i&&"[object Map]"!=g(new i)||o&&"[object Promise]"!=g(o.resolve())||s&&"[object Set]"!=g(new s)||a&&"[object WeakMap]"!=g(new a))&&(g=function(e){var t=c(e),r="[object Object]"==t?e.constructor:void 0,n=r?d(r):"";if(n)switch(n){case u:return"[object DataView]";case l:return"[object Map]";case p:return"[object Promise]";case f:return"[object Set]";case h:return"[object WeakMap]"}return t}),e.exports=g},function(e,t,r){var n=r(7).Symbol;e.exports=n},function(e,t,r){var n=r(58),i=r(60),o=r(16);e.exports=function(e){return o(e)?n(e):i(e)}},function(e,t){e.exports=function(e){return function(t){return e(t)}}},function(e,t,r){(function(e){var n=r(52),i=t&&!t.nodeType&&t,o=i&&"object"==typeof e&&e&&!e.nodeType&&e,s=o&&o.exports===i&&n.process,a=function(){try{var e=o&&o.require&&o.require("util").types;return e||s&&s.binding&&s.binding("util")}catch(e){}}();e.exports=a}).call(this,r(36)(e))},function(e,t,r){var n=r(24),i=r(37);e.exports=function(e){return null!=e&&i(e.length)&&!n(e)}},function(e,t,r){var n=r(56),i=r(57);e.exports=function(e,t,r,o){var s=!r;r||(r={});for(var a=-1,c=t.length;++a<c;){var d=t[a],u=o?o(r[d],e[d],d,r,e):void 0;void 0===u&&(u=e[d]),s?i(r,d,u):n(r,d,u)}return r}},function(e,t,r){(function(e){var n=r(7),i=r(59),o=t&&!t.nodeType&&t,s=o&&"object"==typeof e&&e&&!e.nodeType&&e,a=s&&s.exports===o?n.Buffer:void 0,c=(a?a.isBuffer:void 0)||i;e.exports=c}).call(this,r(36)(e))},function(e,t,r){var n,i;n=[r(5),r(86),r(31),r(0),r(3),r(2)],void 0===(i=function(e,t,r,n,i,o){"use strict";var s=n.stringifyJSON,a=n.isObject,c=n.isString,d={IDLE:1,SIGNED_IN:2,SIGNED_OUT:3,RECONNECTING:4,FAILED:5};function u(){e.call(this),this._sessionId=void 0,this._serverUrl=void 0,this._state=d.IDLE,this._logger=o.create("Session","console"),this._websocketClient=new t}var l=u.prototype=Object.create(e.prototype);return l.isSignedIn=function(){return this._state===d.SIGNED_IN},l.signIn=function(e){this._logger.verbose("signIn("+s(e)+")");if(this.isSignedIn())return Promise.reject(i.SignInError("Already signed in"));if(!a(e))return Promise.reject(i.TypeNotValidError("data","Object"));if(!e.server||!c(e.server))return Promise.reject(i.TypeNotValidError("data.serverUrl","String"));if(e.bintuApiKey&&!c(e.bintuApiKey))return Promise.reject(i.TypeNotValidError("data.bintuApiKey","String"));if(e.token&&!c(e.token))return Promise.reject(i.TypeNotValidError("data.token","String"));if(e.jwt&&!c(e.jwt))return Promise.reject(i.TypeNotValidError("data.jwt","String"));this._serverUrl=e.server;var t={user_name:"defaultUserName",room:"defaultRoom"};e.bintuApiKey&&(t.bintu_api_key=e.bintuApiKey),e.token&&(t.token=e.token),e.jwt&&(t.jwt=e.jwt),t.api_version=r.webrtc.release_version;var n=this;return this._websocketClient.connect(this._serverUrl,this._onMessage.bind(this)).then(function(){return n._websocketClient.sendMessage("sign_in",t)}).then(function(e){return n._logger.verbose("signIn(): Signed in: "+s(e)),n._sessionId=e.session_id,n._setState(d.SIGNED_IN),{data:{server:n._serverUrl,userId:e.user_id,iceServers:e.ice_servers?e.ice_servers:void 0}}}).catch(function(e){return n._logger.error("signIn(): "+s(e)),"CreateWebSocketError"!==e.name&&n._websocketClient.close(),Promise.reject(e)})},l.signOut=function(){this._logger.verbose("signOut(), sessionId"+this._sessionId);if(!this.isSignedIn())return Promise.reject(i.NotSignedInError());var e=this;return this._websocketClient.sendMessage("sign_out",{session_id:this._sessionId}).then(function(t){return e._logger.verbose("signOut(): "+t),e.removeAllListeners(),e._sessionId=void 0,e._setState(d.SIGNED_OUT),e._websocketClient.close(),t}).catch(function(t){return e._logger.error("signOut(): "+t),e._websocketClient.close(),e._sessionId=void 0,Promise.reject(t)})},l.echo=function(e){return this._websocketClient.sendMessage("echo",{session_id:this._sessionId,message:e})},l.sendSignalingMessage=function(e){this._logger.verbose("sendSignalingMessage("+s(e)+")");if(!this.isSignedIn())return Promise.reject(i.NotSignedInError());var t=this;return this._checkPeerMessage(e).then(function(){return t._websocketClient.sendMessage("signaling_message",e)}).catch(function(e){return t._logger.error("sendSignalingMessage(): "+s(e)),Promise.reject(e)})},l.enterRoom=function(e){return this._logger.verbose("enterRoom("+s(e)+"), sessionId: "+this._sessionId),this.isSignedIn()?a(e)?c(e.roomName)?c(e.userName)?this._checkRoomName(e.roomName)?this._websocketClient.sendMessage("enter_room",{session_id:this._sessionId,room_name:e.roomName,user_name:e.userName}):Promise.reject(i.ValueNotValidError("data.room","Alphanumeric characters / underscore (_) / dash (-) / dot (.)")):Promise.reject(i.TypeNotValidError("data.userName","String")):Promise.reject(i.TypeNotValidError("data.roomName","String")):Promise.reject(i.TypeNotValidError("data","Object")):Promise.reject(i.NotSignedInError())},l.leaveRoom=function(e){return this._logger.verbose("leaveRoom("+s(e)+"), sessionId: "+this._sessionId),this.isSignedIn()?a(e)?c(e.roomName)?this._websocketClient.sendMessage("leave_room",{session_id:this._sessionId,room_name:e.roomName}):Promise.reject(i.TypeNotValidError("data.roomName","String")):Promise.reject(i.TypeNotValidError("data","Object")):Promise.reject(i.NotSignedInError())},l.callUser=function(e){return this._logger.verbose("callUser("+s(e)+")"),this.isSignedIn()?a(e)?c(e.userId)?c(e.roomName)?this._websocketClient.sendMessage("call_user",{session_id:this._sessionId,user_id:e.userId,room_name:e.roomName}):Promise.reject(i.TypeNotValidError("data.roomName","String")):Promise.reject(i.TypeNotValidError("data.userId","String")):Promise.reject(i.TypeNotValidError("data","Object")):Promise.reject(i.NotSignedInError())},l.answerCall=function(e){return this._logger.verbose("answerCall("+s(e)+")"),this.isSignedIn()?a(e)?c(e.userId)?c(e.roomName)?this._websocketClient.sendMessage("answer_call",{session_id:this._sessionId,user_id:e.userId,room_name:e.roomName}):Promise.reject(i.TypeNotValidError("data.roomName","String")):Promise.reject(i.TypeNotValidError("data.userId","String")):Promise.reject(i.TypeNotValidError("data","Object")):Promise.reject(i.NotSignedInError())},l.declineCall=function(e){return this._logger.verbose("declineCall("+s(e)+")"),this.isSignedIn()?a(e)?c(e.userId)?c(e.roomName)?this._websocketClient.sendMessage("decline_call",{session_id:this._sessionId,user_id:e.userId,room_name:e.roomName}):Promise.reject(i.TypeNotValidError("data.roomName","String")):Promise.reject(i.TypeNotValidError("data.userId","String")):Promise.reject(i.TypeNotValidError("data","Object")):Promise.reject(i.NotSignedInError())},l.hangUpCall=function(e){return this._logger.verbose("hangUpCall("+s(e)+")"),this.isSignedIn()?this._websocketClient.sendMessage("hangup_call",{session_id:this._sessionId,user_id:e.userId,room_name:e.roomName}):Promise.reject(i.NotSignedInError())},l.startBroadcast=function(e){this._logger.verbose("startBroadcast("+s(e)+")");if(!this.isSignedIn())return Promise.reject(i.NotSignedInError());if(!a(e))return Promise.reject(i.TypeNotValidError("broadcastParams","Object"));e.session_id=this._sessionId;var t=this;return this._websocketClient.sendMessage("start_broadcast",e).catch(function(e){t._logger.error("startBroadcast(): "+s(e));var r=e.error;return"WebrtcServerError"===r.name&&(r.type="NanoError"),Promise.reject(r)})},l.stopBroadcast=function(e){this._logger.verbose("stopBroadcast("+s(e)+")");if(!this.isSignedIn())return Promise.reject(i.NotSignedInError());if(!a(e))return Promise.reject(i.TypeNotValidError("data","Object"));if(!c(e.sender_peer))return Promise.reject(i.TypeNotValidError("data.sender_peer","String"));if(!c(e.receiver_peer))return Promise.reject(i.TypeNotValidError("data.receiver_peer","String"));var t=this;return this._checkPeerMessage(e).then(t._websocketClient.sendMessage("stop_broadcast",{session_id:t._sessionId,sender_peer:e.sender_peer,receiver_peer:e.receiver_peer})).catch(function(e){return t._logger.error("stopBroadcast(): "+s(e)),Promise.reject(e)})},l.sendMetaData=function(e){this._logger.verbose("sendMetaData("+s(e)+")");if(!this.isSignedIn())return Promise.reject(i.NotSignedInError());var t=this;return this._checkPeerMessage(e).then(t._websocketClient.sendMessage("send_metadata",e)).catch(function(e){return t._logger.error("sendMetaData(): "+s(e)),Promise.reject(e)})},l.status=function(){this._logger.verbose("status()");if(!this.isSignedIn())return Promise.reject(i.NotSignedInError());var e=this;return this._websocketClient.sendMessage("status",{}).catch(function(t){return e._logger.error("status(): "+s(t)),Promise.reject(t)})},l._onMessage=function(e){this._logger.verbose("_onMessage("+JSON.stringify(e)+")");var t;if(e){if(e.receiver_peer)return t=e.receiver_peer,void this.emit("receiver_peer_"+t,e);switch(e.type){case"room_update":case"call_incoming":case"call_declined":case"start_as_caller":case"hang_up":return this.emit("RoomMessage",e);case"close":this._state!==d.SIGNED_OUT&&(this.emit("SessionMessage",{type:"close",reason:"disconnect"}),this._setState(d.IDLE));break;default:this._logger.warning("_onMessage(): Unhandled message received: "+e)}}},l._setState=function(e){this._logger.verbose("_setState("+e+")");if(e!==this._state){var t=this._state;this._state=e;var r="_setState(): State: "+n.getKeyByValue(d,t)+" -> "+n.getKeyByValue(d,this._state);this._logger.verbose(r)}},l._checkPeerMessage=function(e){return this._logger.verbose("_checkPeerMessage("+s(e)+")"),a(e)?e.sender_peer?e.receiver_peer?Promise.resolve():Promise.reject(i.TypeNotValidError("message.receiver_peer","String")):Promise.reject(i.TypeNotValidError("message.sender_peer","String")):Promise.reject(i.TypeNotValidError("message","Object"))},l._checkRoomName=function(e){return/^([a-zA-Z0-9_\-.]{1,})$/gm.test(e)},u}.apply(t,n))||(e.exports=i)},function(e,t,r){var n=r(33),i=r(130),o=r(56),s=r(132),a=r(138),c=r(141),d=r(62),u=r(142),l=r(144),p=r(66),f=r(145),h=r(11),g=r(150),v=r(151),m=r(156),_=r(8),S=r(18),b=r(69),y=r(9),C=r(70),E=r(13),T=1,P=2,w=4,R="[object Arguments]",I="[object Function]",x="[object GeneratorFunction]",O="[object Object]",D={};D[R]=D["[object Array]"]=D["[object ArrayBuffer]"]=D["[object DataView]"]=D["[object Boolean]"]=D["[object Date]"]=D["[object Float32Array]"]=D["[object Float64Array]"]=D["[object Int8Array]"]=D["[object Int16Array]"]=D["[object Int32Array]"]=D["[object Map]"]=D["[object Number]"]=D[O]=D["[object RegExp]"]=D["[object Set]"]=D["[object String]"]=D["[object Symbol]"]=D["[object Uint8Array]"]=D["[object Uint8ClampedArray]"]=D["[object Uint16Array]"]=D["[object Uint32Array]"]=!0,D["[object Error]"]=D[I]=D["[object WeakMap]"]=!1,e.exports=function e(t,r,N,M,k,j){var A,L=r&T,U=r&P,B=r&w;if(N&&(A=k?N(t,M,k,j):N(t)),void 0!==A)return A;if(!y(t))return t;var V=_(t);if(V){if(A=g(t),!L)return d(t,A)}else{var G=h(t),F=G==I||G==x;if(S(t))return c(t,L);if(G==O||G==R||F&&!k){if(A=U||F?{}:m(t),!L)return U?l(t,a(A,t)):u(t,s(A,t))}else{if(!D[G])return k?t:{};A=v(t,G,L)}}j||(j=new n);var W=j.get(t);if(W)return W;j.set(t,A),C(t)?t.forEach(function(n){A.add(e(n,r,N,n,t,j))}):b(t)&&t.forEach(function(n,i){A.set(i,e(n,r,N,i,t,j))});var J=B?U?f:p:U?keysIn:E,z=V?void 0:J(t);return i(z||t,function(n,i){z&&(n=t[i=n]),o(A,i,e(n,r,N,i,t,j))}),A}},function(e,t,r){var n=r(103),i=r(104),o=r(105),s=r(106),a=r(107);function c(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}c.prototype.clear=n,c.prototype.delete=i,c.prototype.get=o,c.prototype.has=s,c.prototype.set=a,e.exports=c},function(e,t,r){var n=r(23);e.exports=function(e,t){for(var r=e.length;r--;)if(n(e[r][0],t))return r;return-1}},function(e,t){e.exports=function(e,t){return e===t||e!=e&&t!=t}},function(e,t,r){var n=r(4),i=r(9),o="[object AsyncFunction]",s="[object Function]",a="[object GeneratorFunction]",c="[object Proxy]";e.exports=function(e){if(!i(e))return!1;var t=n(e);return t==s||t==a||t==o||t==c}},function(e,t,r){var n=r(10)(Object,"create");e.exports=n},function(e,t,r){var n=r(126);e.exports=function(e,t){var r=e.__data__;return n(t)?r["string"==typeof t?"string":"hash"]:r.map}},function(e,t,r){var n=r(136),i=r(14),o=r(15),s=o&&o.isTypedArray,a=s?i(s):n;e.exports=a},function(e,t){var r=Object.prototype;e.exports=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||r)}},function(e,t,r){var n=r(42);e.exports=function(e){return function(t,r){return"string"==typeof t&&"string"==typeof r||(t=n(t),r=n(r)),e(t,r)}}},function(e,t,r){var n=r(75);e.exports=function(e){var t=n(e),r=t%1;return t==t?r?t-r:t:0}},function(e,t,r){var n;void 0===(n=function(){"use strict";return JSON.parse(JSON.stringify({webrtc:{release_version:"5.9.2"}}))}.apply(t,[]))||(e.exports=n)},function(e,t,r){var n,i;n=[r(6),r(0),r(93),r(3),r(5),r(2)],void 0===(i=function(e,t,r,n,i,o){"use strict";var s=t.stringifyJSON,a=t.isObject,c=t.isBool,d=t.isFunction;function u(e){i.call(this),this._medias={local:[],remote:[]},this._constraints={},this._error=void 0,this._deviceController=e,this._logger=o.create("MediaController","console")}var l=u.prototype=Object.create(i.prototype);return u.getSupportedConstraints=function(){var e;return(navigator.mediaDevices||navigator.mediaDevices.getSupportedConstraints)&&(e=navigator.mediaDevices.getSupportedConstraints()),e},l.getMediaForDevices=function(t,r){this._logger.verbose("getMediaForDevices("+s(t)+", "+r+")");var i="getMediaForDevices(): ",o=void 0,a=this;return new Promise(function(s,d){return a._verifyDevicesExistence(t).then(function(){return o=t.videoinput.videoDeviceConfig?t.videoinput.videoDeviceConfig.source:c(t.videoinput)?e.MEDIA_SOURCES.CAMERA:void 0,a._verifySourceValidity(o)}).then(function(){return a._deviceController.composeConstraints(t)}).then(function(e){return a._constraints=e,a._getMedia(o,e)}).then(function(e){var t=e.data.stream;a._error=void 0,a._reenumerateDevices(r).then(function(o){if(t)return a._deviceController.updateSelected(t,r),s({stream:e,devices:o});var c=a._deviceController._selected.videoinput,u=a._deviceController._selected.audioinput;if(!1!==c||!1!==u){var l=n.MediaStreamNotFoundError(),p=n.composeEvent(l);return a._logger.error(i+JSON.stringify(l)),d(p)}})}).catch(function(e){var t=n.composeEvent(e);return a._logger.error(i+JSON.stringify(e)),d(t)})})},l._addLocalMedia=function(e){this._logger.verbose("_addLocalMedia(): "+s(e));try{var t=new r(e)}catch(e){var i=n.composeEvent(e);return this._logger.error("_addLocalMedia(): "+JSON.stringify(e)),Promise.reject(i)}var o=t.kind;return this._medias[o].push(t),Promise.resolve(t)},l.addRemoteMedia=function(e){this._logger.verbose("addRemoteMedia("+e+")");try{var t=new r(e)}catch(e){var i=n.composeEvent(e);return this._logger.error("addRemoteMedia(): "+JSON.stringify(e)),Promise.reject(i)}var o=t.kind;return this._medias[o].push(t),this._setupMedia(t)},l.removeMedia=function(e){this._logger.verbose("removeMedia("+e+")");for(var t=this.getLocalMedias(),r=0;r<t.length;r++){var n=t[r];n.stream.id===e&&(n.unbind(),t.splice(r,1))}var i=this.getRemoteMedias();for(r=0;r<i.length;r++){var o=i[r];o.stream.id===e&&(o.unbind(),i.splice(r,1))}},l.removeRemoteMedias=function(){this._logger.verbose("removeRemoteMedias()");for(var e=this._medias.remote,t=0;t<e.length;t++){e[t].unbind(),e.splice(t,1)}if(0==e.length)return Promise.resolve({data:{}});var r=n.MediaStreamNotRemovedError();return this._logger.error("removeRemoteMedias(): "+JSON.stringify(r)),Promise.reject(r)},l.removeLocalMedias=function(){this._logger.verbose("removeLocalMedias()");for(var e=this._medias.local,t=0;t<e.length;t++){e[t].unbind(),e.splice(t,1)}if(0==e.length)return Promise.resolve({data:{stream:null}});var r=n.MediaStreamNotRemovedError(),i=n.composeEvent(r);return this._logger.error("removeLocalMedias(): "+JSON.stringify(r)),Promise.reject(i)},l.getLocalMedias=function(){return this._logger.verbose("getLocalMedias()"),this._medias.local},l.applyAudioConstraints=function(e){var t="applyAudioConstraints(): ";this._logger.verbose(t+s(e));var r=u.getSupportedConstraints(),n=this.getLocalMedias()[0],i={},o=[];return Object.getOwnPropertyNames(e).forEach(function(t,n){r[t]&&!0===r[t]?i[t]=e[t]:o.push(t)}),0!==o.length&&this._logger.warning(t+"constraint(s) not supported: "+JSON.stringify(o)),n.applyAudioConstraints(i)},l.getRemoteMedias=function(){return this._logger.verbose("getRemoteMedias()"),this._medias.remote},l.muteVideoTracks=function(e){this._logger.verbose("muteVideoTracks("+e+")"),this._muteTracks("videoinput",e)},l.muteAudioTracks=function(e){this._logger.verbose("muteAudioTracks("+e+")"),this._muteTracks("audioinput",e)},l.muteTracks=function(e){this._logger.verbose("muteTracks("+s(e)+")");var t="muteTracks(): ";if(!a(e)){var r=n.TypeNotValidError("config","Object");return this._logger.error(t+JSON.stringify(r)),Promise.reject(r)}if(void 0===e.kind||"videoinput"!==e.kind&&"audioinput"!==e.kind){r=n.ValueNotValidError("config.kind","video/audio");return this._logger.error(t+JSON.stringify(r)),Promise.reject(r)}if(void 0===e.mute||!c(e.mute)){r=n.TypeNotValidError("config.mute","Boolean");return this._logger.error(t+JSON.stringify(r)),Promise.reject(r)}return this._muteTracks(e.kind,e.mute),Promise.resolve({data:{}})},l._getMedia=function(t,r){this._logger.verbose("_getMedia("+t+", "+s(r)+")");var n=this;return this._verifySourceValidity(t).then(function(){return n._getReadyForMedia()}).then(function(){return t===e.MEDIA_SOURCES.CAMERA?n._getUserMedia(r):t===e.MEDIA_SOURCES.SCREEN?n._getDisplayMedia(r):void 0}).then(function(e){return n._addLocalMedia(e)}).then(function(e){return e.bind(n),n._setupMedia(e)}).catch(function(e){var t="_getMedia(): "+JSON.stringify(e);return n._logger.error(t),Promise.reject(e)})},l._getUserMedia=function(e){this._logger.verbose("_getUserMedia("+s(e)+")");var t="_getUserMedia(): ",r=this;return this._verifyGetUserMediaExistence().then(function(t){return t.getUserMedia(e)}).then(function(e){return Promise.resolve({stream:e,kind:"local"})}).catch(function(e){if(!e){var i=n.ObjectNotExistError("error","Error");return r._logger.error(t+JSON.stringify(i)),Promise.reject(i)}if("NanoError"===e.type)return r._logger.error(t+JSON.stringify(e)),Promise.reject(e);var o=!r._error||r._error&&"OverconstrainedError"!==r._error.name;i=n.GetUserMediaError(e,o);return r._error=i,r._logger.error(t+JSON.stringify(i)),Promise.reject(i)})},l._getDisplayMedia=function(e){this._logger.verbose("_getDisplayMedia("+s(e)+")");var r="_getDisplayMedia(): ",i="Chrome"===t.browserInfo.browser,o=this;return this._verifyGetDisplayMediaExistence().then(function(t){return t.getDisplayMedia({video:e.video,audio:!i&&e.audio})}).then(function(t){return i&&e.audio?o._getUserMedia({video:!1,audio:e.audio}).then(function(e){return o._addAudioToStream(e,t)}):t}).then(function(e){return Promise.resolve({stream:e,kind:"local"})}).catch(function(e){if(!e){var t=n.ObjectNotExistError("error","Error");return o._logger.error(r+JSON.stringify(t)),Promise.reject(t)}if("NanoError"===e.type)return o._logger.error(r+JSON.stringify(e)),Promise.reject(e);t=n.GetUserMediaError(e);return o._logger.error(r+JSON.stringify(t)),Promise.reject(t)})},l._getReadyForMedia=function(){this._logger.verbose("_getReadyForMedia()");var e=this.getLocalMedias()[0];return e&&this.removeMedia(e.stream.id),Promise.resolve()},l._setupMedia=function(e){this._logger.verbose("_setupMedia("+s(e)+")");var t="_setupMedia(): ",r=this;return new Promise(function(i,o){var s=e.getVideoTracks(),a=e.getAudioTracks();if(!s&&!a){p=n.MediaStreamTrackError();return r._logger.error(t+JSON.stringify(p)),o(p)}for(var c=[].concat(s).concat(a),d=!0,u=0;u<c.length;u++){var l=c[u];if(l.readyState&&(!d||"live"!==l.readyState)){d=!1;var p=n.DeviceBlockedError(l.kind,l.label);return r._logger.error(t+JSON.stringify(p)),o(p)}}r._composeMetadata(e).then(function(e){return i(e)}).catch(function(e){return r._logger.error(t+JSON.stringify(e)),o(e)})})},l._muteTracks=function(e,t){this._logger.verbose("_muteTracks("+e+", "+t+")");var r=this.getLocalMedias()[0];r&&r.muteTracks(e,t)},l._composeMetadata=function(e){this._logger.verbose("_composeMetadata("+s(e)+")");var t="_composeMetadata(): ";if(!e){var r=n.ObjectNotExistError("media","Media");return this._logger.error(t+JSON.stringify(r)),Promise.reject(r)}var i=e.metadata;if(!i){r=n.ObjectNotExistError("metadata","Metadata");return this._logger.error(t+JSON.stringify(r)),Promise.reject(r)}var o=e.hasVideoTracks()||e.metadata.hasVideo,a=e.hasAudioTracks()||e.metadata.hasAudio,c=e.getVideoTracksSettings(),d=e.getAudioTracksSettings(),u=c?c.width:e.metadata.width,l=c?c.height:e.metadata.height,p=c?Object.prototype.hasOwnProperty.call(c,"frameRate")?c.frameRate:Object.prototype.hasOwnProperty.call(c,"framerate")?c.framerate:e.metadata.framerate:e.metadata.framerate;i.hasVideo=o,i.hasAudio=a,i.width=u,i.height=l,i.framerate=Math.round(p);var f={audio:d||{},video:c||{}};return Promise.resolve({data:{stream:e.stream,metadata:i,constraints:this._constraints,settings:f}})},l._addAudioToStream=function(e,t){this._logger.verbose("_addAudioToStream("+s(e)+", "+s(t)+")");var r="_addAudioToStream(): ";if(!e){var i=n.ObjectNotExistError("audio","MediaStream");return this._logger.error(r+JSON.stringify(i)),Promise.reject(i)}if(!t){i=n.ObjectNotExistError("streamInfo","MediaStream");return this._logger.error(r+JSON.stringify(i)),Promise.reject(i)}var o=e.stream.getAudioTracks()[0];return t.addTrack(o),Promise.resolve(t)},l._reenumerateDevices=function(e){return this._logger.verbose("_reenumerateDevices("+e+")"),this._deviceController.shouldReenumerate(e)?this._deviceController.enumerateDevices():Promise.resolve()},l._verifyDevicesExistence=function(e){this._logger.verbose("_verifyDevicesExistence("+s(e)+")");var t="_verifyDevicesExistence(): ";if(!e){var r=n.ObjectNotExistError("devices","Array");return this._logger.error(t+JSON.stringify(r)),Promise.reject(r)}if(!e.videoinput&&!e.audioinput){r=n.DevicesNotFoundError();return this._logger.error(t+JSON.stringify(r)),Promise.reject(r)}return Promise.resolve()},l._verifySourceValidity=function(r){this._logger.verbose("_verifySourceValidity("+r+")");if(t.enumContainsValue(e.MEDIA_SOURCES,r))return Promise.resolve();var i=n.EnumValueNotValidError(r,e.MEDIA_SOURCES);return this._logger.error("_verifySourceValidity(): "+JSON.stringify(i)),Promise.reject(i)},l._verifyGetUserMediaExistence=function(){this._logger.verbose("_verifyGetUserMediaExistence()");var e=navigator.mediaDevices;if(!e||!d(e.getUserMedia)){var t=n.FunctionNotDefinedError("getUserMedia");return this._logger.error("_verifyGetUserMediaExistence(): "+JSON.stringify(t)),Promise.reject(t)}return Promise.resolve(e)},l._verifyGetDisplayMediaExistence=function(){this._logger.verbose("_verifyGetDisplayMediaExistence()");var e=navigator.mediaDevices;if(!e||!d(e.getDisplayMedia)){var t=n.FunctionNotDefinedError("getDisplayMedia");return this._logger.error("_verifyGetDisplayMediaExistence(): "+JSON.stringify(t)),Promise.reject(t)}return Promise.resolve(e)},l._onTrackEnded=function(e){this._logger.verbose("_onTrackEnded("+s(e)+")"),this._logger.info("StreamTrackEnded"),this.emit("StreamTrackEnded",{track:e.target.kind,type:e.type,device:e.target.label})},u}.apply(t,n))||(e.exports=i)},function(e,t,r){var n=r(21),i=r(108),o=r(109),s=r(110),a=r(111),c=r(112);function d(e){var t=this.__data__=new n(e);this.size=t.size}d.prototype.clear=i,d.prototype.delete=o,d.prototype.get=s,d.prototype.has=a,d.prototype.set=c,e.exports=d},function(e,t,r){var n=r(10)(r(7),"Map");e.exports=n},function(e,t,r){var n=r(134),i=r(1),o=Object.prototype,s=o.hasOwnProperty,a=o.propertyIsEnumerable,c=n(function(){return arguments}())?n:function(e){return i(e)&&s.call(e,"callee")&&!a.call(e,"callee")};e.exports=c},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t){var r=9007199254740991;e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=r}},function(e,t,r){var n=r(58),i=r(139),o=r(16);e.exports=function(e){return o(e)?n(e,!0):i(e)}},function(e,t,r){var n=r(143),i=r(63),o=Object.prototype.propertyIsEnumerable,s=Object.getOwnPropertySymbols,a=s?function(e){return null==e?[]:(e=Object(e),n(s(e),function(t){return o.call(e,t)}))}:i;e.exports=a},function(e,t,r){var n=r(61)(Object.getPrototypeOf,Object);e.exports=n},function(e,t,r){var n=r(68);e.exports=function(e){var t=new e.constructor(e.byteLength);return new n(t).set(new n(e)),t}},function(e,t,r){var n=r(9),i=r(43),o=NaN,s=/^\s+|\s+$/g,a=/^[-+]0x[0-9a-f]+$/i,c=/^0b[01]+$/i,d=/^0o[0-7]+$/i,u=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(i(e))return o;if(n(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=n(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(s,"");var r=c.test(e);return r||d.test(e)?u(e.slice(2),r?2:8):a.test(e)?o:+e}},function(e,t,r){var n=r(4),i=r(1),o="[object Symbol]";e.exports=function(e){return"symbol"==typeof e||i(e)&&n(e)==o}},function(e,t,r){var n=r(4),i=r(40),o=r(1),s="[object Object]",a=Function.prototype,c=Object.prototype,d=a.toString,u=c.hasOwnProperty,l=d.call(Object);e.exports=function(e){if(!o(e)||n(e)!=s)return!1;var t=i(e);if(null===t)return!0;var r=u.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&d.call(r)==l}},function(e,t,r){var n=r(177),i=r(1);e.exports=function e(t,r,o,s,a){return t===r||(null==t||null==r||!i(t)&&!i(r)?t!=t&&r!=r:n(t,r,o,s,e,a))}},function(e,t,r){var n,i;n=[r(0),r(6)],void 0===(i=function(e,t){"use strict";var r=e.getTime;return function(n,i,o,s){this._globalPrefix=n,this._label=i,this._level=o,this._id=s,this.error=function(e){this._log(e,t.LOG_LEVEL.ERROR)},this.warning=function(e){this._log(e,t.LOG_LEVEL.WARNING)},this.info=function(e){this._log(e,t.LOG_LEVEL.INFO)},this.debug=function(e){this._log(e,t.LOG_LEVEL.DEBUG)},this.verbose=function(e){this._log(e,t.LOG_LEVEL.VERBOSE)},this._log=function(n,i){if(this._level>=i)switch(e.isObject(n)&&(n=JSON.stringify(n,null," ")),n=r()+": ["+this._globalPrefix+"]["+this._label+"] - "+n,i){case t.LOG_LEVEL.ERROR:console.error(n);break;case t.LOG_LEVEL.WARNING:console.warn(n);break;case t.LOG_LEVEL.INFO:console.info(n);break;case t.LOG_LEVEL.VERBOSE:console.log(n)}}}}.apply(t,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r(88),r(48),r(5),r(3),r(0),r(2),r(49)],void 0===(i=function(e,t,r,n,i,o,s){"use strict";var a=i.parseJSON,c=i.stringifyJSON,d=i.isFunction,u=i.isArray,l={offerToReceiveAudio:!0,offerToReceiveVideo:!0};function p(e,t){r.call(this),this._logger=o.create("PeerConnectionClient","console"),this._logger.verbose("PeerConnectionClient("+c(e)+", "+t+")");if(!u(e.peerConnectionConfig.iceServers)||0===e.peerConnectionConfig.iceServers.length){this._logger.warning("PeerConnectionClient(): params.peerConnectionConfig.iceServers parameter is malformed, must be an array with at least one entry")}this._params=e,this._startTime=t,this._pc=null,this._hasRemoteSdp=!1,this._messageQueue=[],this._isInitiator=!1,this._started=!1,this._closedIceConnectionStateSent=!1,this._sentEndOfRemoteCandidates=!1,this._create()}var f=p.prototype=Object.create(r.prototype);return f.isStarted=function(){return this._started},f.isInitiator=function(){return this._isInitiator},f._create=function(){this._logger.verbose("_create()");this.close();try{this._pc=new RTCPeerConnection(this._params.peerConnectionConfig,this._params.peerConnectionConstraints),this._bind(),this._logger.verbose("_create(): PeerConnectionCreated")}catch(e){this._onError("CreatePeerConnection",e)}},f.close=function(){this._logger.verbose("close()");var e=this;this._pc?(this._pc.close(),setTimeout(function(){e._closedIceConnectionStateSent||e.emitSimple("IceConnectionStateChange",{state:"closed"}),e._reset(),e._logger.verbose("close(): Peer connection closed"),o.delete(e._logger)},500)):this._logger.verbose("close(): No PeerConnection")},f.addStream=function(e){this._logger.verbose("addStream("+c(e)+")"),this._pc&&this._pc.addStream(e)},f.updateEncodingSettings=function(t,r){this._logger.verbose("updateEncodingSettings("+t+", "+r+")");var n="updateEncoderOptions(): ",i=this;e.setSenderBitrates(this._pc,{video:r||0,audio:t||0}).then(function(){i._logger.info(n+"Sucessfully set bitrates")}).catch(function(e){i._logger.warning(n+"Could not set bitrates "+e)})},f.removeStream=function(e){var t,r,n;if(this._logger.verbose("removeStream("+c(e)+")"),this._pc)if(d(this._pc.removeTrack)&&d(this._pc.getSenders)){var i=e.getTracks(),o=this._pc.getSenders();for(t=0,n=o.length;t<n;++t)for(r=0,n=i.length;r<n;++r)o[t].track===i[r]&&this._pc.removeTrack(o[t])}else d(this._pc.removeStream)&&this._pc.removeStream(e)},f.startAsCaller=function(e){this._logger.verbose("startAsCaller("+c(e)+")");if(this._pc&&!this._started){this._isInitiator=!0,this._started=!0;var t=this._buildConstraints(e);this._logger.verbose("startAsCaller(): Sending offer to peer with constraints: \n'"+c(t));var r=this;this._pc.createOffer(t).then(function(e){return r._setLocalDescription(e)}).then(function(e){r.emitSimple("SignalingMessage",e)}).catch(function(e){r._logger.error("startAsCaller(): "+c(e)),r._onError("createOffer",e)})}},f.startAsCallee=function(e){var t,r;if(this._logger.verbose("startAsCallee("+c(e)+")"),this._pc&&!this._started){if(this._isInitiator=!1,this._started=!0,e&&e.length>0)for(t=0,r=e.length;t<r;t++)this.queueSignalingMessage(e[t]);this._messageQueue.length>0&&this._drainMessageQueue()}},f.queueSignalingMessage=function(e){this._logger.verbose("queueSignalingMessage("+c(e)+")");var t=a(e);t&&(this._isInitiator&&"answer"===t.type||!this._isInitiator&&"offer"===t.type?(this._hasRemoteSdp=!0,this._messageQueue.unshift(t)):t.candidate?this._messageQueue.push(t):this._logger.error("queueSignalingMessage(): Unknown message: "+c(e)))},f.setRemoteDescription=function(e){this._logger.verbose("setRemoteDescription("+c(e)+")");var t=this,r=t._adjustRemoteDescription(e);return t._pc.setRemoteDescription(new RTCSessionDescription(r)).then(function(){t._hasRemoteSdp=!0}).then(function(){for(var e=0,r=t._messageQueue.length;e<r;e++){t.addIceCandidate(t._messageQueue[e]),"Microsoft Edge"===i.browserInfo.browser&&setTimeout(function(){t._sentEndOfRemoteCandidates||(t.addIceCandidate(""),t._sentEndOfRemoteCandidates=!0)},3e3)}t._messageQueue=[]}).catch(function(e){return t._onError(t,"setRemoteDescription"),t._logger.error("setRemoteDescription(): "+c(e)),Promise.reject(e)})},f.doAnswer=function(){this._logger.verbose("doAnswer()");var e=this,t=this._buildConstraints();return this._logger.verbose("doAnswer(): Sending answer to peer with constraints: "+c(t,null," ")),this._pc.createAnswer(t).then(function(t){return e._setLocalDescription(t)}).catch(function(t){return e._onError("doAnswer",t),Promise.reject(t)})},f.addIceCandidate=function(e){this._logger.verbose("addIceCandidate("+c(e)+")");var t,r,n="addIceCandidate(): ",i=this;return this._hasRemoteSdp?(e&&""!==e?(t=a(e),r=new RTCIceCandidate({sdpMLineIndex:t.sdpMLineIndex,sdpMid:t.sdpMid,candidate:t.candidate}),this._logger.verbose(n+"Adding ice candidate:"+c(r.toJSON()))):(r=e,this._logger.verbose(n+"(Microsoft Edge only) Adding the end of remote candidates")),this._recordIceCandidate("Remote",r),this._pc.addIceCandidate(r).then(function(){i._logger.verbose(n+"MSG: Remote candidate added successfully")}).catch(function(e){i._logger.error(n+c(e))})):(this._messageQueue.push(e),this._logger.verbose(n+"Queueing candidate, not reveiced remote sdp, yet"),Promise.resolve())},f.getStats=function(e){var t,r,i,o;if(this._logger.verbose("getStats("+e+")"),!this._pc)return Promise.reject(new Error("No PeerConnection"));if(e&&"video"!==e&&"audio"!==e)return Promise.reject(n.ValueNotValidError("kind","video / audio"));if(d(this._pc.getSenders)){var s=this._pc.getSenders().filter(function(t){return!!(i=t.track)&&(i.kind&&i.kind===e)});s&&s.length&&(t=s[0].track)}else(o=this._pc.getRemoteStreams())&&o.length&&(r="video"===e?o[0].getVideoTracks():"audio"===e?o[0].getAudioTracks():void 0).length&&(t=r[0]);return this._pc.getStats(t)},f._reset=function(){this._logger.verbose("_reset()"),this._unbind(),this._pc=null,this._hasRemoteSdp=!1,this._messageQueue=[],this._isInitiator=!1,this._started=!1},f._bind=function(){this._logger.verbose("_bind()");this._pc?(this._pc.onicecandidate=this._onIceCandidate.bind(this),this._pc.ontrack=this._onRemoteStreamAdded.bind(this),this._pc.onremovestream=this._onRemoteStreamRemoved.bind(this),this._pc.onsignalingstatechange=this._onSignalingStateChanged.bind(this),this._pc.oniceconnectionstatechange=this._onIceConnectionStateChanged.bind(this),this._pc.onnegotiationneeded=this._onNegotiationNeeded.bind(this)):this._logger.error("_bind(): No PeerConnection")},f._unbind=function(){this._logger.verbose("_unbind()");this._pc?(this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.onremovestream=null,this._pc.onsignalingstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onnegotiationneeded=null):this._logger.warning("_unbind(): No PeerConnection")},f._setLocalDescription=function(e){this._logger.verbose("_setLocalDescription("+c(e)+")");var t,r="_setLocalDescription(): ",n=this;try{this._params.sdpPatches&&!this._params.sdpPatches.preventReplaceSendReceive&&(e.sdp=this._replaceSendReceive(e.sdp,this._params.send,this._params.receive)),e.sdp=maybePreferVideoReceiveCodec(e.sdp,this._params)}catch(e){return this._logger.verbose(r+e),Promise.reject(e)}return this._pc.setLocalDescription(e).then(function(){return n._logger.verbose(r+"setLocalDescription success"),t={sdp:e.sdp,type:e.type},n._logger.verbose("description after setting: "+c(t)),t}).catch(function(e){n._onError("_setLocalDescription",e)})},f._buildConstraints=function(e){return this._logger.verbose("_buildConstraints("+c(e)+")"),mergeConstraints(e,l)},f._adjustRemoteDescription=function(e){return this._logger.verbose("_adjustRemoteDescription() - before adjusting: "+c(e)),e.sdp=maybePreferVideoReceiveCodec(e.sdp,this._params),e.sdp=maybePreferVideoSendCodec(e.sdp,this._params),this._params.encoding&&("cbp"===this._params.encoding.h264Profile?e.sdp=this._forceBaseline(e.sdp):"high"===this._params.encoding.h264Profile&&(e.sdp=this._forceHigh(e.sdp))),this._params.videoSendBitrate&&(e.sdp=maybeSetVideoSendBitRate(e.sdp,this._params)),this._params.videoSendInitialBitrate&&(e.sdp=maybeSetVideoSendInitialBitRate(e.sdp,this._params)),this._logger.verbose("_adjustRemoteDescription() - after adjusting: "+c(e)+")"),e},f._drainMessageQueue=function(){var e,t;if(this._logger.verbose("_drainMessageQueue()"),this._pc&&this._started&&this._hasRemoteSdp){for(e=0,t=this._messageQueue.length;e<t;e++)this._processSignalingMessage(this._messageQueue[e]);this._messageQueue=[]}},f._processSignalingMessage=function(e){this._logger.verbose("_processSignalingMessage("+c(e)+")");var t="_processSignalingMessage(): ";if("offer"!==e.type||this._isInitiator)if("answer"===e.type&&this._isInitiator){if(this._logger.verbose(t+"Received answer"),"have-local-offer"!==this._pc.signalingState){e="MSG: ERROR: remote answer received in unexpected state: "+this._pc.signalingState;return void this._logger.verbose(t+e)}this._setRemoteSdp(e)}else if(e.candidate||"candidate"===e.type){this._logger.verbose(t+"New ice candidate");var r=new RTCIceCandidate({sdpMLineIndex:e.sdpMLineIndex,sdpMid:e.sdpMid,candidate:e.candidate});this._recordIceCandidate("Remote",r);var n=this;this._pc.addIceCandidate(r).then(function(){n._logger.verbose(t+"MSG: Remote candidate added successfully")}).catch(function(e){n._onError("addIceCandidate",e)})}else this._logger.warning(t+"Unexpected message: "+c(e));else{if(this._logger.verbose(t+"Received offer"),"stable"!==this._pc.signalingState){var e="ERROR: remote offer received in unexpected state: "+this._pc.signalingState;return void this._logger.verbose(t+e)}this._setRemoteSdp(e),this.doAnswer()}},f._onIceCandidate=function(e){this._logger.verbose("_onIceCandidate("+c(e)+")");var t=e.candidate;if(!t)return this._logger.verbose("_onIceCandidate(): End of candidates"),void this.emitSimple("EndOfLocalCandidates",{});this._isValidIceCandidate(t)&&(this.emitSimple("SignalingMessage",{sdpMLineIndex:t.sdpMLineIndex,sdpMid:t.sdpMid,candidate:t.candidate}),this._recordIceCandidate("Local",t))},f._isValidIceCandidate=function(e){this._logger.verbose("_isValidIceCandidate("+c(e)+")");var t=e.candidate;return-1===t.indexOf("tcp")&&("relay"!==this._params.peerConnectionConfig.iceTransports||"relay"===iceCandidateType(t))},f._onSignalingStateChanged=function(){this._logger.verbose("_onSignalingStateChanged()");if(!this._pc)return!1;this._logger.verbose("_onSignalingStateChanged(): Signaling state changed to: "+this._pc.signalingState),this.emitSimple("SignalingStateChanged",{state:this._pc.signalingState})},f._onIceConnectionStateChanged=function(){this._logger.verbose("_onIceConnectionStateChanged()");var e="_onIceConnectionStateChanged(): ";if(!this._pc)return!1;if("completed"===this._pc.iceConnectionState){var t=e+"ICE complete time: "+(window.performance.now()-this._startTime).toFixed(0)+"ms";this._logger.verbose(t)}this._logger.verbose(e+"ICE connection state changed to: "+this._pc.iceConnectionState),this.emitSimple("IceConnectionStateChange",{state:this._pc.iceConnectionState}),"closed"===this._pc.iceConnectionState&&(this._closedIceConnectionStateSent=!0)},f._onNegotiationNeeded=function(e){this._logger.verbose("_onNegotiationNeeded("+c(e)+")");if(!this._pc)return!1;this._logger.verbose("_onNegotiationNeeded(): NegotiationNeeded Event"),this.emitSimple("NegotiationNeeded",e)},f._recordIceCandidate=function(e,t){this._logger.verbose("_recordIceCandidate("+c(e)+", "+c(t)+")");this._logger.verbose("_recordIceCandidate(): New ICE candidate for "+e),this.emitSimple("NewIceCandidate",{location:e,candidate:t})},f._onRemoteStreamAdded=function(e){this._logger.verbose("_onRemoteStreamAdded("+c(e)+")");this._logger.verbose("_onRemoteStreamAdded(): Remote stream added to peer connection"),this.emitSimple("RemoteStreamAdded",{stream:e.streams[0]})},f._onRemoteStreamRemoved=function(e){this._logger.verbose("_onRemoteStreamRemoved("+c(e)+")");this._logger.verbose("_onRemoteStreamRemoved(): Remote stream removed from peer connection"),this.emitSimple("RemoteStreamRemoved",{stream:e.stream})},f._onError=function(e,t){this._logger.error("_onError("+e+", "+t.toString()),this.emitSimple("PeerConnectionError",{tag:e,error:t.toString()})},f._replaceSendReceive=function(e,t,r){this._logger.verbose("_replaceSendReceive("+c(e)+", "+c(t)+", "+c(r)+")");var n,i,o="";t&&r?o="a=sendrecv":t?o="a=sendonly":r&&(o="a=recvonly");var s,a=e.split("\r\n");for(n=0,i=a.length;n<i;n++)-1===(s=a[n]).indexOf("a=sendrecv")&&-1===s.indexOf("a=sendonly")&&-1===s.indexOf("a=recvonly")||(a[n]=o);return a.join("\r\n")},f._forceProfile=function(e,t,r){var n,i,o=e.split("\r\n"),s=this;return o.forEach(function(e,a){e.indexOf(";profile-level-id=")>-1&&2===(i=e.split(";profile-level-id=")).length&&(n=i[1],t.includes(n)?(s._logger.verbose("_forceProfile() : replacing profile: "+n+" with "+r),o[a]=e.split(n).join(r)):s._logger.verbose("_forceProfile() : not replacing profile: "+n))}),o.join("\r\n")},f._forceBaseline=function(e){return this._forceProfile(e,["640032","640c1f","42001f","4d0032","42001f"],"42e01f")},f._forceHigh=function(e){return this._forceProfile(e,["640032","640c1f","42001f","4d0032","42001f","42e01f"],"640c1f")},p}.apply(t,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r(89)],void 0===(i=function(e){window.trace=function(e){if("\n"===e[e.length-1]&&(e=e.substring(0,e.length-1)),window.performance){var t=(window.performance.now()/1e3).toFixed(3);console.log(t+": "+e)}else console.log(e)}}.apply(t,n))||(e.exports=i)},function(e,t,r){var n;e.exports=function e(t,r,i){function o(a,c){if(!r[a]){if(!t[a]){if(!c&&"function"==typeof n&&n)return n(a,!0);if(s)return s(a,!0);var d=new Error("Cannot find module '"+a+"'");throw d.code="MODULE_NOT_FOUND",d}var u=r[a]={exports:{}};t[a][0].call(u.exports,function(e){return o(t[a][1][e]||e)},u,u.exports,e,t,r,i)}return r[a].exports}for(var s="function"==typeof n&&n,a=0;a<i.length;a++)o(i[a]);return o}({1:[function(e,t,r){"use strict";var n=(0,e("./adapter_factory.js").adapterFactory)({window:window});t.exports=n},{"./adapter_factory.js":2}],2:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.adapterFactory=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).window,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0},r=n.log,d=n.detectBrowser(e),u={browserDetails:d,commonShim:c,extractVersion:n.extractVersion,disableLog:n.disableLog,disableWarnings:n.disableWarnings};switch(d.browser){case"chrome":if(!i||!i.shimPeerConnection||!t.shimChrome)return r("Chrome shim is not included in this adapter release."),u;r("adapter.js shimming chrome."),u.browserShim=i,i.shimGetUserMedia(e),i.shimMediaStream(e),i.shimPeerConnection(e),i.shimOnTrack(e),i.shimAddTrackRemoveTrack(e),i.shimGetSendersWithDtmf(e),i.shimGetStats(e),i.shimSenderReceiverGetStats(e),i.fixNegotiationNeeded(e),c.shimRTCIceCandidate(e),c.shimConnectionState(e),c.shimMaxMessageSize(e),c.shimSendThrowTypeError(e),c.removeAllowExtmapMixed(e);break;case"firefox":if(!s||!s.shimPeerConnection||!t.shimFirefox)return r("Firefox shim is not included in this adapter release."),u;r("adapter.js shimming firefox."),u.browserShim=s,s.shimGetUserMedia(e),s.shimPeerConnection(e),s.shimOnTrack(e),s.shimRemoveStream(e),s.shimSenderGetStats(e),s.shimReceiverGetStats(e),s.shimRTCDataChannel(e),s.shimAddTransceiver(e),s.shimCreateOffer(e),s.shimCreateAnswer(e),c.shimRTCIceCandidate(e),c.shimConnectionState(e),c.shimMaxMessageSize(e),c.shimSendThrowTypeError(e);break;case"edge":if(!o||!o.shimPeerConnection||!t.shimEdge)return r("MS edge shim is not included in this adapter release."),u;r("adapter.js shimming edge."),u.browserShim=o,o.shimGetUserMedia(e),o.shimGetDisplayMedia(e),o.shimPeerConnection(e),o.shimReplaceTrack(e),c.shimMaxMessageSize(e),c.shimSendThrowTypeError(e);break;case"safari":if(!a||!t.shimSafari)return r("Safari shim is not included in this adapter release."),u;r("adapter.js shimming safari."),u.browserShim=a,a.shimRTCIceServerUrls(e),a.shimCreateOfferLegacy(e),a.shimCallbacksAPI(e),a.shimLocalStreamsAPI(e),a.shimRemoteStreamsAPI(e),a.shimTrackEventTransceiver(e),a.shimGetUserMedia(e),c.shimRTCIceCandidate(e),c.shimMaxMessageSize(e),c.shimSendThrowTypeError(e),c.removeAllowExtmapMixed(e);break;default:r("Unsupported browser!")}return u};var n=d(e("./utils")),i=d(e("./chrome/chrome_shim")),o=d(e("./edge/edge_shim")),s=d(e("./firefox/firefox_shim")),a=d(e("./safari/safari_shim")),c=d(e("./common_shim"));function d(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}},{"./chrome/chrome_shim":3,"./common_shim":6,"./edge/edge_shim":7,"./firefox/firefox_shim":11,"./safari/safari_shim":14,"./utils":15}],3:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=r.shimGetUserMedia=void 0;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=e("./getusermedia");Object.defineProperty(r,"shimGetUserMedia",{enumerable:!0,get:function(){return i.shimGetUserMedia}});var o=e("./getdisplaymedia");Object.defineProperty(r,"shimGetDisplayMedia",{enumerable:!0,get:function(){return o.shimGetDisplayMedia}}),r.shimMediaStream=function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},r.shimOnTrack=function(e){if("object"!==(void 0===e?"undefined":n(e))||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype)s.wrapPeerConnectionEvent(e,"track",function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e});else{Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var r=this;return this._ontrackpoly||(this._ontrackpoly=function(t){t.stream.addEventListener("addtrack",function(n){var i=void 0;i=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find(function(e){return e.track&&e.track.id===n.track.id}):{track:n.track};var o=new Event("track");o.track=n.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],r.dispatchEvent(o)}),t.stream.getTracks().forEach(function(n){var i=void 0;i=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find(function(e){return e.track&&e.track.id===n.id}):{track:n};var o=new Event("track");o.track=n,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],r.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}},r.shimGetSendersWithDtmf=function(e){if("object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){var i=r.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){i.apply(this,arguments);var t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}var o=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;this._senders=this._senders||[],o.apply(this,[e]),e.getTracks().forEach(function(e){r._senders.push(t(r,e))})};var s=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._senders=this._senders||[],s.apply(this,[e]),e.getTracks().forEach(function(e){var r=t._senders.find(function(t){return t.track===e});r&&t._senders.splice(t._senders.indexOf(r),1)})}}else if("object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var a=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=a.apply(this,[]);return t.forEach(function(t){return t._pc=e}),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},r.shimGetStats=function(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=this,r=Array.prototype.slice.call(arguments),n=r[0],i=r[1],o=r[2];if(arguments.length>0&&"function"==typeof n)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof n))return t.apply(this,[]);var s=function(e){var t={};return e.result().forEach(function(e){var r={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){r[t]=e.stat(t)}),t[r.id]=r}),t},a=function(e){return new Map(Object.keys(e).map(function(t){return[t,e[t]]}))};if(arguments.length>=2){var c=function(e){i(a(s(e)))};return t.apply(this,[c,n])}return new Promise(function(r,n){t.apply(e,[function(e){r(a(s(e)))},n])}).then(i,o)}}},r.shimSenderReceiverGetStats=function(e){if("object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(this,[]);return r.forEach(function(t){return t._pc=e}),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(t){return s.filterStats(t,e.track,!0)})}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var i=e.RTCPeerConnection.prototype.getReceivers;i&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=i.apply(this,[]);return t.forEach(function(t){return t._pc=e}),t}),s.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(t){return s.filterStats(t,e.track,!1)})}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var t=arguments[0],r=void 0,n=void 0,i=void 0;return this.getSenders().forEach(function(e){e.track===t&&(r?i=!0:r=e)}),this.getReceivers().forEach(function(e){return e.track===t&&(n?i=!0:n=e),e.track===t}),i||r&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return o.apply(this,arguments)}}}},r.shimAddTrackRemoveTrackWithNative=c,r.shimAddTrackRemoveTrack=function(e){if(e.RTCPeerConnection){var t=s.detectBrowser(e);if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return c(e);var r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=r.apply(this);return this._reverseStreams=this._reverseStreams||{},t.map(function(t){return e._reverseStreams[t.id]})};var n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var r=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach(function(e){if(r.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[t.id]){var i=new e.MediaStream(t.getTracks());this._streams[t.id]=i,this._reverseStreams[i.id]=t,t=i}n.apply(this,[t])};var i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,r){var n=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find(function(e){return e===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");var o=this.getSenders().find(function(e){return e.track===t});if(o)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var s=this._streams[r.id];if(s)s.addTrack(t),Promise.resolve().then(function(){n.dispatchEvent(new Event("negotiationneeded"))});else{var a=new e.MediaStream([t]);this._streams[r.id]=a,this._reverseStreams[a.id]=r,this.addStream(a)}return this.getSenders().find(function(e){return e.track===t})},["createOffer","createAnswer"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t],n=a({},t,function(){var e=this,t=arguments,n=arguments.length&&"function"==typeof arguments[0];return n?r.apply(this,[function(r){var n=u(e,r);t[0].apply(null,[n])},function(e){t[1]&&t[1].apply(null,e)},arguments[2]]):r.apply(this,arguments).then(function(t){return u(e,t)})});e.RTCPeerConnection.prototype[t]=n[t]});var o=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=l(this,arguments[0]),o.apply(this,arguments)):o.apply(this,arguments)};var d=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=d.get.apply(this);return""===e.type?e:u(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};var r=void 0;Object.keys(this._streams).forEach(function(n){t._streams[n].getTracks().find(function(t){return e.track===t})&&(r=t._streams[n])}),r&&(1===r.getTracks().length?this.removeStream(this._reverseStreams[r.id]):r.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function u(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var n=e._reverseStreams[t],i=e._streams[n.id];r=r.replace(new RegExp(i.id,"g"),n.id)}),new RTCSessionDescription({type:t.type,sdp:r})}function l(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var n=e._reverseStreams[t],i=e._streams[n.id];r=r.replace(new RegExp(n.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:r})}},r.shimPeerConnection=function(e){var t=s.detectBrowser(e);if(!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection){t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t],n=a({},t,function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)});e.RTCPeerConnection.prototype[t]=n[t]});var r=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?t.version<78&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}},r.fixNegotiationNeeded=function(e){s.wrapPeerConnectionEvent(e,"negotiationneeded",function(e){if("stable"===e.target.signalingState)return e})};var s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils.js"));function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function c(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(t){return e._shimmedLocalStreams[t][0]})};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){if(!r)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var n=t.apply(this,arguments);return this._shimmedLocalStreams[r.id]?-1===this._shimmedLocalStreams[r.id].indexOf(n)&&this._shimmedLocalStreams[r.id].push(n):this._shimmedLocalStreams[r.id]=[r,n],n};var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(function(e){if(t.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")});var n=this.getSenders();r.apply(this,arguments);var i=this.getSenders().filter(function(e){return-1===n.indexOf(e)});this._shimmedLocalStreams[e.id]=[e].concat(i)};var n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],n.apply(this,arguments)};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(function(r){var n=t._shimmedLocalStreams[r].indexOf(e);-1!==n&&t._shimmedLocalStreams[r].splice(n,1),1===t._shimmedLocalStreams[r].length&&delete t._shimmedLocalStreams[r]}),i.apply(this,arguments)}}},{"../utils.js":15,"./getdisplaymedia":4,"./getusermedia":5}],4:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then(function(t){var n=r.video&&r.video.width,i=r.video&&r.video.height,o=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:o||3}},n&&(r.video.mandatory.maxWidth=n),i&&(r.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(r)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}},{}],5:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.shimGetUserMedia=function(e){var t=e&&e.navigator;if(t.mediaDevices){var r=i.detectBrowser(e),s=function(e){if("object"!==(void 0===e?"undefined":n(e))||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(r){if("require"!==r&&"advanced"!==r&&"mediaSource"!==r){var i="object"===n(e[r])?e[r]:{ideal:e[r]};void 0!==i.exact&&"number"==typeof i.exact&&(i.min=i.max=i.exact);var o=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==i.ideal){t.optional=t.optional||[];var s={};"number"==typeof i.ideal?(s[o("min",r)]=i.ideal,t.optional.push(s),(s={})[o("max",r)]=i.ideal,t.optional.push(s)):(s[o("",r)]=i.ideal,t.optional.push(s))}void 0!==i.exact&&"number"!=typeof i.exact?(t.mandatory=t.mandatory||{},t.mandatory[o("",r)]=i.exact):["min","max"].forEach(function(e){void 0!==i[e]&&(t.mandatory=t.mandatory||{},t.mandatory[o(e,r)]=i[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},a=function(e,i){if(r.version>=61)return i(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"===n(e.audio)){var a=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])};a((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),a(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=s(e.audio)}if(e&&"object"===n(e.video)){var c=e.video.facingMode;c=c&&("object"===(void 0===c?"undefined":n(c))?c:{ideal:c});var d=r.version<66;if(c&&("user"===c.exact||"environment"===c.exact||"user"===c.ideal||"environment"===c.ideal)&&(!t.mediaDevices.getSupportedConstraints||!t.mediaDevices.getSupportedConstraints().facingMode||d)){delete e.video.facingMode;var u=void 0;if("environment"===c.exact||"environment"===c.ideal?u=["back","rear"]:"user"!==c.exact&&"user"!==c.ideal||(u=["front"]),u)return t.mediaDevices.enumerateDevices().then(function(t){var r=(t=t.filter(function(e){return"videoinput"===e.kind})).find(function(e){return u.some(function(t){return e.label.toLowerCase().includes(t)})});return!r&&t.length&&u.includes("back")&&(r=t[t.length-1]),r&&(e.video.deviceId=c.exact?{exact:r.deviceId}:{ideal:r.deviceId}),e.video=s(e.video),o("chrome: "+JSON.stringify(e)),i(e)})}e.video=s(e.video)}return o("chrome: "+JSON.stringify(e)),i(e)},c=function(e){return r.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};if(t.getUserMedia=function(e,r,n){a(e,function(e){t.webkitGetUserMedia(e,r,function(e){n&&n(c(e))})})}.bind(t),t.mediaDevices.getUserMedia){var d=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return a(e,function(e){return d(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return t},function(e){return Promise.reject(c(e))})})}}}};var i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils.js")),o=i.log},{"../utils.js":15}],6:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.shimRTCIceCandidate=function(e){if(e.RTCIceCandidate&&!(e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"===(void 0===e?"undefined":n(e))&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var r=new t(e),i=s.default.parseCandidate(e.candidate),o=Object.assign(r,i);return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,a.wrapPeerConnectionEvent(e,"icecandidate",function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t})}},r.shimMaxMessageSize=function(e){if(e.RTCPeerConnection){var t=a.detectBrowser(e);"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var r=function(e){if(!e||!e.sdp)return!1;var t=s.default.splitSections(e.sdp);return t.shift(),t.some(function(e){var t=s.default.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})},n=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var r=parseInt(t[1],10);return r!=r?-1:r},i=function(e){var r=65536;return"firefox"===t.browser&&(r=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),r},o=function(e,r){var n=65536;"firefox"===t.browser&&57===t.version&&(n=65535);var i=s.default.matchPrefix(e.sdp,"a=max-message-size:");return i.length>0?n=parseInt(i[0].substr(19),10):"firefox"===t.browser&&-1!==r&&(n=2147483637),n},c=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){var e=this.getConfiguration(),s=e.sdpSemantics;"plan-b"===s&&Object.defineProperty(this,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(r(arguments[0])){var a=n(arguments[0]),d=i(a),u=o(arguments[0],a),l=void 0;l=0===d&&0===u?Number.POSITIVE_INFINITY:0===d||0===u?Math.max(d,u):Math.min(d,u);var p={};Object.defineProperty(p,"maxMessageSize",{get:function(){return l}}),this._sctp=p}return c.apply(this,arguments)}}},r.shimSendThrowTypeError=function(e){if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var t=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=t.apply(this,arguments);return r(e,this),e},a.wrapPeerConnectionEvent(e,"datachannel",function(e){return r(e.channel,e.target),e})}function r(e,t){var r=e.send;e.send=function(){var n=arguments[0],i=n.length||n.size||n.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return r.apply(e,arguments)}}},r.shimConnectionState=function(e){if(e.RTCPeerConnection&&!("connectionState"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(function(e){var r=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(e){var t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;var r=new Event("connectionstatechange",e);t.dispatchEvent(r)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}},r.removeAllowExtmapMixed=function(e){if(e.RTCPeerConnection){var t=a.detectBrowser(e);if(!("chrome"===t.browser&&t.version>=71)){var r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(e){return e&&e.sdp&&-1!==e.sdp.indexOf("\na=extmap-allow-mixed")&&(e.sdp=e.sdp.split("\n").filter(function(e){return"a=extmap-allow-mixed"!==e.trim()}).join("\n")),r.apply(this,arguments)}}}};var i,o=e("sdp"),s=(i=o)&&i.__esModule?i:{default:i},a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("./utils"))},{"./utils":15,sdp:17}],7:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=r.shimGetUserMedia=void 0;var n=e("./getusermedia");Object.defineProperty(r,"shimGetUserMedia",{enumerable:!0,get:function(){return n.shimGetUserMedia}});var i=e("./getdisplaymedia");Object.defineProperty(r,"shimGetDisplayMedia",{enumerable:!0,get:function(){return i.shimGetDisplayMedia}}),r.shimPeerConnection=function(e){var t=s.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){var r=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){r.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}!e.RTCRtpSender||"dtmf"in e.RTCRtpSender.prototype||Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);var n=(0,d.default)(e,t.version);e.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=(0,a.filterIceServers)(e.iceServers,t.version),s.log("ICE servers after filtering:",e.iceServers)),new n(e)},e.RTCPeerConnection.prototype=n.prototype},r.shimReplaceTrack=function(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)};var o,s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils")),a=e("./filtericeservers"),c=e("rtcpeerconnection-shim"),d=(o=c)&&o.__esModule?o:{default:o}},{"../utils":15,"./filtericeservers":8,"./getdisplaymedia":9,"./getusermedia":10,"rtcpeerconnection-shim":16}],8:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.filterIceServers=function(e,t){var r=!1;return(e=JSON.parse(JSON.stringify(e))).filter(function(e){if(e&&(e.urls||e.url)){var t=e.urls||e.url;e.url&&!e.urls&&n.deprecated("RTCIceServer.url","RTCIceServer.urls");var i="string"==typeof t;return i&&(t=[t]),t=t.filter(function(e){if(0===e.indexOf("stun:"))return!1;var t=e.startsWith("turn")&&!e.startsWith("turn:[")&&e.includes("transport=udp");return t&&!r?(r=!0,!0):t&&!r}),delete e.url,e.urls=i?t[0]:t,!!t.length}})};var n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils"))},{"../utils":15}],9:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=function(e){"getDisplayMedia"in e.navigator&&e.navigator.mediaDevices&&(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=e.navigator.getDisplayMedia.bind(e.navigator)))}},{}],10:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetUserMedia=function(e){var t=e&&e.navigator,r=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return r(e).catch(function(e){return Promise.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}}(e))})}}},{}],11:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=r.shimGetUserMedia=void 0;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=e("./getusermedia");Object.defineProperty(r,"shimGetUserMedia",{enumerable:!0,get:function(){return i.shimGetUserMedia}});var o=e("./getdisplaymedia");Object.defineProperty(r,"shimGetDisplayMedia",{enumerable:!0,get:function(){return o.shimGetDisplayMedia}}),r.shimOnTrack=function(e){"object"===(void 0===e?"undefined":n(e))&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},r.shimPeerConnection=function(e){var t=s.detectBrowser(e);if("object"===(void 0===e?"undefined":n(e))&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){if(!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r,n,i,o=e.RTCPeerConnection.prototype[t],s=(i=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)},(n=t)in(r={})?Object.defineProperty(r,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[n]=i,r);e.RTCPeerConnection.prototype[t]=s[t]}),t.version<68){var r=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?arguments[0]&&""===arguments[0].candidate?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}var i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=Array.prototype.slice.call(arguments),r=e[0],n=e[1],s=e[2];return o.apply(this,[r||null]).then(function(e){if(t.version<53&&!n)try{e.forEach(function(e){e.type=i[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach(function(t,r){e.set(r,Object.assign({},t,{type:i[t.type]||t.type}))})}return e}).then(n,s)}}},r.shimSenderGetStats=function(e){if("object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&!(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(this,[]);return r.forEach(function(t){return t._pc=e}),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}},r.shimReceiverGetStats=function(e){if("object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&!(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)){var t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,r=t.apply(this,[]);return r.forEach(function(t){return t._pc=e}),r}),s.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}},r.shimRemoveStream=function(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;s.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(r){r.track&&e.getTracks().includes(r.track)&&t.removeTrack(r)})})},r.shimRTCDataChannel=function(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)},r.shimAddTransceiver=function(e){if("object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var e=arguments[1],r=e&&"sendEncodings"in e;r&&e.sendEncodings.forEach(function(e){if("rid"in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});var n=t.apply(this,arguments);if(r){var i=n.sender,o=i.getParameters();"encodings"in o||(o.encodings=e.sendEncodings,this.setParametersPromises.push(i.setParameters(o).catch(function(){})))}return n})}},r.shimCreateOffer=function(e){if("object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){var e=this,r=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return t.apply(e,r)}).finally(function(){e.setParametersPromises=[]}):t.apply(this,arguments)}}},r.shimCreateAnswer=function(e){if("object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){var e=this,r=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return t.apply(e,r)}).finally(function(){e.setParametersPromises=[]}):t.apply(this,arguments)}}};var s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils"))},{"../utils":15,"./getdisplaymedia":12,"./getusermedia":13}],12:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!r||!r.video){var n=new DOMException("getDisplayMedia without video constraints is undefined");return n.name="NotFoundError",n.code=8,Promise.reject(n)}return!0===r.video?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})}},{}],13:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.shimGetUserMedia=function(e){var t=i.detectBrowser(e),r=e&&e.navigator,o=e&&e.MediaStreamTrack;if(r.getUserMedia=function(e,t,n){i.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(e).then(t,n)},!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){var s=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])},a=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(e){return"object"===(void 0===e?"undefined":n(e))&&"object"===n(e.audio)&&(e=JSON.parse(JSON.stringify(e)),s(e.audio,"autoGainControl","mozAutoGainControl"),s(e.audio,"noiseSuppression","mozNoiseSuppression")),a(e)},o&&o.prototype.getSettings){var c=o.prototype.getSettings;o.prototype.getSettings=function(){var e=c.apply(this,arguments);return s(e,"mozAutoGainControl","autoGainControl"),s(e,"mozNoiseSuppression","noiseSuppression"),e}}if(o&&o.prototype.applyConstraints){var d=o.prototype.applyConstraints;o.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"===(void 0===e?"undefined":n(e))&&(e=JSON.parse(JSON.stringify(e)),s(e,"autoGainControl","mozAutoGainControl"),s(e,"noiseSuppression","mozNoiseSuppression")),d.apply(this,[e])}}}};var i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils"))},{"../utils":15}],14:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.shimLocalStreamsAPI=function(e){if("object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach(function(n){return t.call(r,n,e)}),e.getVideoTracks().forEach(function(n){return t.call(r,n,e)})},e.RTCPeerConnection.prototype.addTrack=function(e){var r=arguments[1];return r&&(this._localStreams?this._localStreams.includes(r)||this._localStreams.push(r):this._localStreams=[r]),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._localStreams||(this._localStreams=[]);var r=this._localStreams.indexOf(e);if(-1!==r){this._localStreams.splice(r,1);var n=e.getTracks();this.getSenders().forEach(function(e){n.includes(e.track)&&t.removeTrack(e)})}})}},r.shimRemoteStreamsAPI=function(e){if("object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var t=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach(function(e){if(t._remoteStreams||(t._remoteStreams=[]),!t._remoteStreams.includes(e)){t._remoteStreams.push(e);var r=new Event("addstream");r.stream=e,t.dispatchEvent(r)}})})}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(function(t){if(e._remoteStreams||(e._remoteStreams=[]),!(e._remoteStreams.indexOf(t)>=0)){e._remoteStreams.push(t);var r=new Event("addstream");r.stream=t,e.dispatchEvent(r)}})}),t.apply(e,arguments)}}},r.shimCallbacksAPI=function(e){if("object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,r=t.createOffer,i=t.createAnswer,o=t.setLocalDescription,s=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],n=i.apply(this,[r]);return t?(n.then(e,t),Promise.resolve()):n};var c=function(e,t,r){var n=o.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n};t.setLocalDescription=c,c=function(e,t,r){var n=s.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.setRemoteDescription=c,c=function(e,t,r){var n=a.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.addIceCandidate=c}},r.shimGetUserMedia=function(e){var t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){var r=t.mediaDevices,n=r.getUserMedia.bind(r);t.mediaDevices.getUserMedia=function(e){return n(o(e))}}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,r,n){t.mediaDevices.getUserMedia(e).then(r,n)}.bind(t))},r.shimConstraints=o,r.shimRTCIceServerUrls=function(e){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,r){if(e&&e.iceServers){for(var n=[],o=0;o<e.iceServers.length;o++){var s=e.iceServers[o];!s.hasOwnProperty("urls")&&s.hasOwnProperty("url")?(i.deprecated("RTCIceServer.url","RTCIceServer.urls"),(s=JSON.parse(JSON.stringify(s))).urls=s.url,delete s.url,n.push(s)):n.push(e.iceServers[o])}e.iceServers=n}return new t(e,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})},r.shimTrackEventTransceiver=function(e){"object"===(void 0===e?"undefined":n(e))&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},r.shimCreateOfferLegacy=function(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var r=this.getTransceivers().find(function(e){return"audio"===e.receiver.track.kind});!1===e.offerToReceiveAudio&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0!==e.offerToReceiveAudio||r||this.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var n=this.getTransceivers().find(function(e){return"video"===e.receiver.track.kind});!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video")}return t.apply(this,arguments)}};var i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils"));function o(e){return e&&void 0!==e.video?Object.assign({},e,{video:i.compactObject(e.video)}):e}},{"../utils":15}],15:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.extractVersion=s,r.wrapPeerConnectionEvent=function(e,t,r){if(e.RTCPeerConnection){var n=e.RTCPeerConnection.prototype,i=n.addEventListener;n.addEventListener=function(e,n){if(e!==t)return i.apply(this,arguments);var o=function(e){var t=r(e);t&&n(t)};return this._eventMap=this._eventMap||{},this._eventMap[n]=o,i.apply(this,[e,o])};var o=n.removeEventListener;n.removeEventListener=function(e,r){if(e!==t||!this._eventMap||!this._eventMap[r])return o.apply(this,arguments);var n=this._eventMap[r];return delete this._eventMap[r],o.apply(this,[e,n])},Object.defineProperty(n,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}},r.disableLog=function(e){return"boolean"!=typeof e?new Error("Argument type: "+(void 0===e?"undefined":n(e))+". Please use a boolean."):(i=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},r.disableWarnings=function(e){return"boolean"!=typeof e?new Error("Argument type: "+(void 0===e?"undefined":n(e))+". Please use a boolean."):(o=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))},r.log=function(){if("object"===("undefined"==typeof window?"undefined":n(window))){if(i)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},r.deprecated=function(e,t){o&&console.warn(e+" is deprecated, please use "+t+" instead.")},r.detectBrowser=function(e){var t=e.navigator,r={browser:null,version:null};if(void 0===e||!e.navigator)return r.browser="Not a browser.",r;if(t.mozGetUserMedia)r.browser="firefox",r.version=s(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)r.browser="chrome",r.version=s(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))r.browser="edge",r.version=s(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return r.browser="Not a supported browser.",r;r.browser="safari",r.version=s(t.userAgent,/AppleWebKit\/(\d+)\./,1),r.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return r},r.compactObject=function e(t){return a(t)?Object.keys(t).reduce(function(r,n){var i=a(t[n]),o=i?e(t[n]):t[n],s=i&&!Object.keys(o).length;return void 0===o||s?r:Object.assign(r,function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}({},n,o))},{}):t},r.walkStats=c,r.filterStats=function(e,t,r){var n=r?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;var o=[];return e.forEach(function(e){"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)}),o.forEach(function(t){e.forEach(function(r){r.type===n&&r.trackId===t.id&&c(e,r,i)})}),i};var i=!0,o=!0;function s(e,t,r){var n=e.match(t);return n&&n.length>=r&&parseInt(n[r],10)}function a(e){return"[object Object]"===Object.prototype.toString.call(e)}function c(e,t,r){t&&!r.has(t.id)&&(r.set(t.id,t),Object.keys(t).forEach(function(n){n.endsWith("Id")?c(e,e.get(t[n]),r):n.endsWith("Ids")&&t[n].forEach(function(t){c(e,e.get(t),r)})}))}},{}],16:[function(e,t,r){"use strict";var n=e("sdp");function i(e,t,r,i,o){var s=n.writeRtpDescription(e.kind,t);if(s+=n.writeIceParameters(e.iceGatherer.getLocalParameters()),s+=n.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":o||"active"),s+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?s+="a=sendrecv\r\n":e.rtpSender?s+="a=sendonly\r\n":e.rtpReceiver?s+="a=recvonly\r\n":s+="a=inactive\r\n",e.rtpSender){var a=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=a;var c="msid:"+(i?i.id:"-")+" "+a+"\r\n";s+="a="+c,s+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+c,e.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+c,s+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return s+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+n.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+n.localCName+"\r\n"),s}function o(e,t){var r={codecs:[],headerExtensions:[],fecMechanisms:[]},n=function(e,t){e=parseInt(e,10);for(var r=0;r<t.length;r++)if(t[r].payloadType===e||t[r].preferredPayloadType===e)return t[r]},i=function(e,t,r,i){var o=n(e.parameters.apt,r),s=n(t.parameters.apt,i);return o&&s&&o.name.toLowerCase()===s.name.toLowerCase()};return e.codecs.forEach(function(n){for(var o=0;o<t.codecs.length;o++){var s=t.codecs[o];if(n.name.toLowerCase()===s.name.toLowerCase()&&n.clockRate===s.clockRate){if("rtx"===n.name.toLowerCase()&&n.parameters&&s.parameters.apt&&!i(n,s,e.codecs,t.codecs))continue;(s=JSON.parse(JSON.stringify(s))).numChannels=Math.min(n.numChannels,s.numChannels),r.codecs.push(s),s.rtcpFeedback=s.rtcpFeedback.filter(function(e){for(var t=0;t<n.rtcpFeedback.length;t++)if(n.rtcpFeedback[t].type===e.type&&n.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(e){for(var n=0;n<t.headerExtensions.length;n++){var i=t.headerExtensions[n];if(e.uri===i.uri){r.headerExtensions.push(i);break}}}),r}function s(e,t,r){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(r)}function a(e,t){var r=e.getRemoteCandidates().find(function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type});return r||e.addRemoteCandidate(t),!r}function c(e,t){var r=new Error(t);return r.name=e,r.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],r}t.exports=function(e,t){function r(t,r){r.addTrack(t),r.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function d(t,r,n,i){var o=new Event("track");o.track=r,o.receiver=n,o.transceiver={receiver:n},o.streams=i,e.setTimeout(function(){t._dispatchEvent("track",o)})}var u=function(r){var i=this,o=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){i[e]=o[e].bind(o)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",r=JSON.parse(JSON.stringify(r||{})),this.usingBundle="max-bundle"===r.bundlePolicy,"negotiate"===r.rtcpMuxPolicy)throw c("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(r.rtcpMuxPolicy||(r.rtcpMuxPolicy="require"),r.iceTransportPolicy){case"all":case"relay":break;default:r.iceTransportPolicy="all"}switch(r.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:r.bundlePolicy="balanced"}if(r.iceServers=function(e,t){var r=!1;return(e=JSON.parse(JSON.stringify(e))).filter(function(e){if(e&&(e.urls||e.url)){var n=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var i="string"==typeof n;return i&&(n=[n]),n=n.filter(function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||r?0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp"):(r=!0,!0)}),delete e.url,e.urls=i?n[0]:n,!!n.length}})}(r.iceServers||[],t),this._iceGatherers=[],r.iceCandidatePoolSize)for(var s=r.iceCandidatePoolSize;s>0;s--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:r.iceServers,gatherPolicy:r.iceTransportPolicy}));else r.iceCandidatePoolSize=0;this._config=r,this.transceivers=[],this._sdpSessionId=n.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(u.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(u.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),u.prototype.onicecandidate=null,u.prototype.onaddstream=null,u.prototype.ontrack=null,u.prototype.onremovestream=null,u.prototype.onsignalingstatechange=null,u.prototype.oniceconnectionstatechange=null,u.prototype.onconnectionstatechange=null,u.prototype.onicegatheringstatechange=null,u.prototype.onnegotiationneeded=null,u.prototype.ondatachannel=null,u.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},u.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},u.prototype.getConfiguration=function(){return this._config},u.prototype.getLocalStreams=function(){return this.localStreams},u.prototype.getRemoteStreams=function(){return this.remoteStreams},u.prototype._createTransceiver=function(e,t){var r=this.transceivers.length>0,n={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&r)n.iceTransport=this.transceivers[0].iceTransport,n.dtlsTransport=this.transceivers[0].dtlsTransport;else{var i=this._createIceAndDtlsTransports();n.iceTransport=i.iceTransport,n.dtlsTransport=i.dtlsTransport}return t||this.transceivers.push(n),n},u.prototype.addTrack=function(t,r){if(this._isClosed)throw c("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var n;if(this.transceivers.find(function(e){return e.track===t}))throw c("InvalidAccessError","Track already exists.");for(var i=0;i<this.transceivers.length;i++)this.transceivers[i].track||this.transceivers[i].kind!==t.kind||(n=this.transceivers[i]);return n||(n=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(r)&&this.localStreams.push(r),n.track=t,n.stream=r,n.rtpSender=new e.RTCRtpSender(t,n.dtlsTransport),n.rtpSender},u.prototype.addStream=function(e){var r=this;if(t>=15025)e.getTracks().forEach(function(t){r.addTrack(t,e)});else{var n=e.clone();e.getTracks().forEach(function(e,t){var r=n.getTracks()[t];e.addEventListener("enabled",function(e){r.enabled=e.enabled})}),n.getTracks().forEach(function(e){r.addTrack(e,n)})}},u.prototype.removeTrack=function(t){if(this._isClosed)throw c("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var r=this.transceivers.find(function(e){return e.rtpSender===t});if(!r)throw c("InvalidAccessError","Sender was not created by this connection.");var n=r.stream;r.rtpSender.stop(),r.rtpSender=null,r.track=null,r.stream=null,-1===this.transceivers.map(function(e){return e.stream}).indexOf(n)&&this.localStreams.indexOf(n)>-1&&this.localStreams.splice(this.localStreams.indexOf(n),1),this._maybeFireNegotiationNeeded()},u.prototype.removeStream=function(e){var t=this;e.getTracks().forEach(function(e){var r=t.getSenders().find(function(t){return t.track===e});r&&t.removeTrack(r)})},u.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},u.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},u.prototype._createIceGatherer=function(t,r){var n=this;if(r&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var i=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(i,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var r=!e.candidate||0===Object.keys(e.candidate).length;i.state=r?"completed":"gathering",null!==n.transceivers[t].bufferedCandidateEvents&&n.transceivers[t].bufferedCandidateEvents.push(e)},i.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),i},u.prototype._gather=function(t,r){var i=this,o=this.transceivers[r].iceGatherer;if(!o.onlocalcandidate){var s=this.transceivers[r].bufferedCandidateEvents;this.transceivers[r].bufferedCandidateEvents=null,o.removeEventListener("localcandidate",this.transceivers[r].bufferCandidates),o.onlocalcandidate=function(e){if(!(i.usingBundle&&r>0)){var s=new Event("icecandidate");s.candidate={sdpMid:t,sdpMLineIndex:r};var a=e.candidate,c=!a||0===Object.keys(a).length;if(c)"new"!==o.state&&"gathering"!==o.state||(o.state="completed");else{"new"===o.state&&(o.state="gathering"),a.component=1,a.ufrag=o.getLocalParameters().usernameFragment;var d=n.writeCandidate(a);s.candidate=Object.assign(s.candidate,n.parseCandidate(d)),s.candidate.candidate=d,s.candidate.toJSON=function(){return{candidate:s.candidate.candidate,sdpMid:s.candidate.sdpMid,sdpMLineIndex:s.candidate.sdpMLineIndex,usernameFragment:s.candidate.usernameFragment}}}var u=n.getMediaSections(i._localDescription.sdp);u[s.candidate.sdpMLineIndex]+=c?"a=end-of-candidates\r\n":"a="+s.candidate.candidate+"\r\n",i._localDescription.sdp=n.getDescription(i._localDescription.sdp)+u.join("");var l=i.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});"gathering"!==i.iceGatheringState&&(i.iceGatheringState="gathering",i._emitGatheringStateChange()),c||i._dispatchEvent("icecandidate",s),l&&(i._dispatchEvent("icecandidate",new Event("icecandidate")),i.iceGatheringState="complete",i._emitGatheringStateChange())}},e.setTimeout(function(){s.forEach(function(e){o.onlocalcandidate(e)})},0)}},u.prototype._createIceAndDtlsTransports=function(){var t=this,r=new e.RTCIceTransport(null);r.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var n=new e.RTCDtlsTransport(r);return n.ondtlsstatechange=function(){t._updateConnectionState()},n.onerror=function(){Object.defineProperty(n,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:r,dtlsTransport:n}},u.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var r=this.transceivers[e].iceTransport;r&&(delete r.onicestatechange,delete this.transceivers[e].iceTransport);var n=this.transceivers[e].dtlsTransport;n&&(delete n.ondtlsstatechange,delete n.onerror,delete this.transceivers[e].dtlsTransport)},u.prototype._transceive=function(e,r,i){var s=o(e.localCapabilities,e.remoteCapabilities);r&&e.rtpSender&&(s.encodings=e.sendEncodingParameters,s.rtcp={cname:n.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(s.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(s)),i&&e.rtpReceiver&&s.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),e.recvEncodingParameters.length?s.encodings=e.recvEncodingParameters:s.encodings=[{}],s.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(s.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(s.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(s))},u.prototype.setLocalDescription=function(e){var t,r,i=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(c("TypeError",'Unsupported type "'+e.type+'"'));if(!s("setLocalDescription",e.type,i.signalingState)||i._isClosed)return Promise.reject(c("InvalidStateError","Can not set local "+e.type+" in state "+i.signalingState));if("offer"===e.type)t=n.splitSections(e.sdp),r=t.shift(),t.forEach(function(e,t){var r=n.parseRtpParameters(e);i.transceivers[t].localCapabilities=r}),i.transceivers.forEach(function(e,t){i._gather(e.mid,t)});else if("answer"===e.type){t=n.splitSections(i._remoteDescription.sdp),r=t.shift();var a=n.matchPrefix(r,"a=ice-lite").length>0;t.forEach(function(e,t){var s=i.transceivers[t],c=s.iceGatherer,d=s.iceTransport,u=s.dtlsTransport,l=s.localCapabilities,p=s.remoteCapabilities;if(!(n.isRejected(e)&&0===n.matchPrefix(e,"a=bundle-only").length||s.rejected)){var f=n.getIceParameters(e,r),h=n.getDtlsParameters(e,r);a&&(h.role="server"),i.usingBundle&&0!==t||(i._gather(s.mid,t),"new"===d.state&&d.start(c,f,a?"controlling":"controlled"),"new"===u.state&&u.start(h));var g=o(l,p);i._transceive(s,g.codecs.length>0,!1)}})}return i._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?i._updateSignalingState("have-local-offer"):i._updateSignalingState("stable"),Promise.resolve()},u.prototype.setRemoteDescription=function(i){var u=this;if(-1===["offer","answer"].indexOf(i.type))return Promise.reject(c("TypeError",'Unsupported type "'+i.type+'"'));if(!s("setRemoteDescription",i.type,u.signalingState)||u._isClosed)return Promise.reject(c("InvalidStateError","Can not set remote "+i.type+" in state "+u.signalingState));var l={};u.remoteStreams.forEach(function(e){l[e.id]=e});var p=[],f=n.splitSections(i.sdp),h=f.shift(),g=n.matchPrefix(h,"a=ice-lite").length>0,v=n.matchPrefix(h,"a=group:BUNDLE ").length>0;u.usingBundle=v;var m=n.matchPrefix(h,"a=ice-options:")[0];return u.canTrickleIceCandidates=!!m&&m.substr(14).split(" ").indexOf("trickle")>=0,f.forEach(function(s,c){var d=n.splitLines(s),f=n.getKind(s),m=n.isRejected(s)&&0===n.matchPrefix(s,"a=bundle-only").length,_=d[0].substr(2).split(" ")[2],S=n.getDirection(s,h),b=n.parseMsid(s),y=n.getMid(s)||n.generateIdentifier();if(m||"application"===f&&("DTLS/SCTP"===_||"UDP/DTLS/SCTP"===_))u.transceivers[c]={mid:y,kind:f,protocol:_,rejected:!0};else{var C,E,T,P,w,R,I,x,O;!m&&u.transceivers[c]&&u.transceivers[c].rejected&&(u.transceivers[c]=u._createTransceiver(f,!0));var D,N,M=n.parseRtpParameters(s);m||(D=n.getIceParameters(s,h),(N=n.getDtlsParameters(s,h)).role="client"),I=n.parseRtpEncodingParameters(s);var k=n.parseRtcpParameters(s),j=n.matchPrefix(s,"a=end-of-candidates",h).length>0,A=n.matchPrefix(s,"a=candidate:").map(function(e){return n.parseCandidate(e)}).filter(function(e){return 1===e.component});if(("offer"===i.type||"answer"===i.type)&&!m&&v&&c>0&&u.transceivers[c]&&(u._disposeIceAndDtlsTransports(c),u.transceivers[c].iceGatherer=u.transceivers[0].iceGatherer,u.transceivers[c].iceTransport=u.transceivers[0].iceTransport,u.transceivers[c].dtlsTransport=u.transceivers[0].dtlsTransport,u.transceivers[c].rtpSender&&u.transceivers[c].rtpSender.setTransport(u.transceivers[0].dtlsTransport),u.transceivers[c].rtpReceiver&&u.transceivers[c].rtpReceiver.setTransport(u.transceivers[0].dtlsTransport)),"offer"!==i.type||m)"answer"!==i.type||m||(E=(C=u.transceivers[c]).iceGatherer,T=C.iceTransport,P=C.dtlsTransport,w=C.rtpReceiver,R=C.sendEncodingParameters,x=C.localCapabilities,u.transceivers[c].recvEncodingParameters=I,u.transceivers[c].remoteCapabilities=M,u.transceivers[c].rtcpParameters=k,A.length&&"new"===T.state&&(!g&&!j||v&&0!==c?A.forEach(function(e){a(C.iceTransport,e)}):T.setRemoteCandidates(A)),v&&0!==c||("new"===T.state&&T.start(E,D,"controlling"),"new"===P.state&&P.start(N)),!o(C.localCapabilities,C.remoteCapabilities).codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&C.sendEncodingParameters[0].rtx&&delete C.sendEncodingParameters[0].rtx,u._transceive(C,"sendrecv"===S||"recvonly"===S,"sendrecv"===S||"sendonly"===S),!w||"sendrecv"!==S&&"sendonly"!==S?delete C.rtpReceiver:(O=w.track,b?(l[b.stream]||(l[b.stream]=new e.MediaStream),r(O,l[b.stream]),p.push([O,w,l[b.stream]])):(l.default||(l.default=new e.MediaStream),r(O,l.default),p.push([O,w,l.default]))));else{(C=u.transceivers[c]||u._createTransceiver(f)).mid=y,C.iceGatherer||(C.iceGatherer=u._createIceGatherer(c,v)),A.length&&"new"===C.iceTransport.state&&(!j||v&&0!==c?A.forEach(function(e){a(C.iceTransport,e)}):C.iceTransport.setRemoteCandidates(A)),x=e.RTCRtpReceiver.getCapabilities(f),t<15019&&(x.codecs=x.codecs.filter(function(e){return"rtx"!==e.name})),R=C.sendEncodingParameters||[{ssrc:1001*(2*c+2)}];var L,U=!1;"sendrecv"===S||"sendonly"===S?(U=!C.rtpReceiver,w=C.rtpReceiver||new e.RTCRtpReceiver(C.dtlsTransport,f),U&&(O=w.track,b&&"-"===b.stream||(b?(l[b.stream]||(l[b.stream]=new e.MediaStream,Object.defineProperty(l[b.stream],"id",{get:function(){return b.stream}})),Object.defineProperty(O,"id",{get:function(){return b.track}}),L=l[b.stream]):(l.default||(l.default=new e.MediaStream),L=l.default)),L&&(r(O,L),C.associatedRemoteMediaStreams.push(L)),p.push([O,w,L]))):C.rtpReceiver&&C.rtpReceiver.track&&(C.associatedRemoteMediaStreams.forEach(function(t){var r=t.getTracks().find(function(e){return e.id===C.rtpReceiver.track.id});r&&function(t,r){r.removeTrack(t),r.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:t}))}(r,t)}),C.associatedRemoteMediaStreams=[]),C.localCapabilities=x,C.remoteCapabilities=M,C.rtpReceiver=w,C.rtcpParameters=k,C.sendEncodingParameters=R,C.recvEncodingParameters=I,u._transceive(u.transceivers[c],!1,U)}}}),void 0===u._dtlsRole&&(u._dtlsRole="offer"===i.type?"active":"passive"),u._remoteDescription={type:i.type,sdp:i.sdp},"offer"===i.type?u._updateSignalingState("have-remote-offer"):u._updateSignalingState("stable"),Object.keys(l).forEach(function(t){var r=l[t];if(r.getTracks().length){if(-1===u.remoteStreams.indexOf(r)){u.remoteStreams.push(r);var n=new Event("addstream");n.stream=r,e.setTimeout(function(){u._dispatchEvent("addstream",n)})}p.forEach(function(e){var t=e[0],n=e[1];r.id===e[2].id&&d(u,t,n,[r])})}}),p.forEach(function(e){e[2]||d(u,e[0],e[1],[])}),e.setTimeout(function(){u&&u.transceivers&&u.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},u.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},u.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},u.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout(function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}},0))},u.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){e.iceTransport&&!e.rejected&&t[e.iceTransport.state]++}),e="new",t.failed>0?e="failed":t.checking>0?e="checking":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0?e="connected":t.completed>0&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var r=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",r)}},u.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){e.iceTransport&&e.dtlsTransport&&!e.rejected&&(t[e.iceTransport.state]++,t[e.dtlsTransport.state]++)}),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0&&(e="connected"),e!==this.connectionState){this.connectionState=e;var r=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",r)}},u.prototype.createOffer=function(){var r=this;if(r._isClosed)return Promise.reject(c("InvalidStateError","Can not call createOffer after close"));var o=r.transceivers.filter(function(e){return"audio"===e.kind}).length,s=r.transceivers.filter(function(e){return"video"===e.kind}).length,a=arguments[0];if(a){if(a.mandatory||a.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==a.offerToReceiveAudio&&(o=!0===a.offerToReceiveAudio?1:!1===a.offerToReceiveAudio?0:a.offerToReceiveAudio),void 0!==a.offerToReceiveVideo&&(s=!0===a.offerToReceiveVideo?1:!1===a.offerToReceiveVideo?0:a.offerToReceiveVideo)}for(r.transceivers.forEach(function(e){"audio"===e.kind?--o<0&&(e.wantReceive=!1):"video"===e.kind&&--s<0&&(e.wantReceive=!1)});o>0||s>0;)o>0&&(r._createTransceiver("audio"),o--),s>0&&(r._createTransceiver("video"),s--);var d=n.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.transceivers.forEach(function(i,o){var s=i.track,a=i.kind,c=i.mid||n.generateIdentifier();i.mid=c,i.iceGatherer||(i.iceGatherer=r._createIceGatherer(o,r.usingBundle));var d=e.RTCRtpSender.getCapabilities(a);t<15019&&(d.codecs=d.codecs.filter(function(e){return"rtx"!==e.name})),d.codecs.forEach(function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),i.remoteCapabilities&&i.remoteCapabilities.codecs&&i.remoteCapabilities.codecs.forEach(function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)})}),d.headerExtensions.forEach(function(e){(i.remoteCapabilities&&i.remoteCapabilities.headerExtensions||[]).forEach(function(t){e.uri===t.uri&&(e.id=t.id)})});var u=i.sendEncodingParameters||[{ssrc:1001*(2*o+1)}];s&&t>=15019&&"video"===a&&!u[0].rtx&&(u[0].rtx={ssrc:u[0].ssrc+1}),i.wantReceive&&(i.rtpReceiver=new e.RTCRtpReceiver(i.dtlsTransport,a)),i.localCapabilities=d,i.sendEncodingParameters=u}),"max-compat"!==r._config.bundlePolicy&&(d+="a=group:BUNDLE "+r.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),d+="a=ice-options:trickle\r\n",r.transceivers.forEach(function(e,t){d+=i(e,e.localCapabilities,"offer",e.stream,r._dtlsRole),d+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===r.iceGatheringState||0!==t&&r.usingBundle||(e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1,d+="a="+n.writeCandidate(e)+"\r\n"}),"completed"===e.iceGatherer.state&&(d+="a=end-of-candidates\r\n"))});var u=new e.RTCSessionDescription({type:"offer",sdp:d});return Promise.resolve(u)},u.prototype.createAnswer=function(){var r=this;if(r._isClosed)return Promise.reject(c("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==r.signalingState&&"have-local-pranswer"!==r.signalingState)return Promise.reject(c("InvalidStateError","Can not call createAnswer in signalingState "+r.signalingState));var s=n.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.usingBundle&&(s+="a=group:BUNDLE "+r.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),s+="a=ice-options:trickle\r\n";var a=n.getMediaSections(r._remoteDescription.sdp).length;r.transceivers.forEach(function(e,n){if(!(n+1>a)){if(e.rejected)return"application"===e.kind?"DTLS/SCTP"===e.protocol?s+="m=application 0 DTLS/SCTP 5000\r\n":s+="m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?s+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(s+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(s+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var c;e.stream&&("audio"===e.kind?c=e.stream.getAudioTracks()[0]:"video"===e.kind&&(c=e.stream.getVideoTracks()[0]),c&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1}));var d=o(e.localCapabilities,e.remoteCapabilities);!d.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,s+=i(e,d,"answer",e.stream,r._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(s+="a=rtcp-rsize\r\n")}});var d=new e.RTCSessionDescription({type:"answer",sdp:s});return Promise.resolve(d)},u.prototype.addIceCandidate=function(e){var t,r=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(i,o){if(!r._remoteDescription)return o(c("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var s=e.sdpMLineIndex;if(e.sdpMid)for(var d=0;d<r.transceivers.length;d++)if(r.transceivers[d].mid===e.sdpMid){s=d;break}var u=r.transceivers[s];if(!u)return o(c("OperationError","Can not add ICE candidate"));if(u.rejected)return i();var l=Object.keys(e.candidate).length>0?n.parseCandidate(e.candidate):{};if("tcp"===l.protocol&&(0===l.port||9===l.port))return i();if(l.component&&1!==l.component)return i();if((0===s||s>0&&u.iceTransport!==r.transceivers[0].iceTransport)&&!a(u.iceTransport,l))return o(c("OperationError","Can not add ICE candidate"));var p=e.candidate.trim();0===p.indexOf("a=")&&(p=p.substr(2)),(t=n.getMediaSections(r._remoteDescription.sdp))[s]+="a="+(l.type?p:"end-of-candidates")+"\r\n",r._remoteDescription.sdp=n.getDescription(r._remoteDescription.sdp)+t.join("")}else for(var f=0;f<r.transceivers.length&&(r.transceivers[f].rejected||(r.transceivers[f].iceTransport.addRemoteCandidate({}),(t=n.getMediaSections(r._remoteDescription.sdp))[f]+="a=end-of-candidates\r\n",r._remoteDescription.sdp=n.getDescription(r._remoteDescription.sdp)+t.join(""),!r.usingBundle));f++);i()})},u.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var r=null;if(this.transceivers.forEach(function(e){e.rtpSender&&e.rtpSender.track===t?r=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(r=e.rtpReceiver)}),!r)throw c("InvalidAccessError","Invalid selector.");return r.getStats()}var n=[];return this.transceivers.forEach(function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(t){e[t]&&n.push(e[t].getStats())})}),Promise.all(n).then(function(e){var t=new Map;return e.forEach(function(e){e.forEach(function(e){t.set(e.id,e)})}),t})},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(t){var r=e[t];if(r&&r.prototype&&r.prototype.getStats){var n=r.prototype.getStats;r.prototype.getStats=function(){return n.apply(this).then(function(e){var t=new Map;return Object.keys(e).forEach(function(r){var n;e[r].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(n=e[r]).type]||n.type,t.set(r,e[r])}),t})}}});var l=["createOffer","createAnswer"];return l.forEach(function(e){var t=u.prototype[e];u.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then(function(t){"function"==typeof e[0]&&e[0].apply(null,[t])},function(t){"function"==typeof e[1]&&e[1].apply(null,[t])}):t.apply(this,arguments)}}),(l=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(e){var t=u.prototype[e];u.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)},function(t){"function"==typeof e[2]&&e[2].apply(null,[t])}):t.apply(this,arguments)}}),["getStats"].forEach(function(e){var t=u.prototype[e];u.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)}):t.apply(this,arguments)}}),u}},{sdp:17}],17:[function(e,t,r){"use strict";var n={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};n.localCName=n.generateIdentifier(),n.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},n.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},n.getDescription=function(e){var t=n.splitSections(e);return t&&t[0]},n.getMediaSections=function(e){var t=n.splitSections(e);return t.shift(),t},n.matchPrefix=function(e,t){return n.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},n.parseCandidate=function(e){for(var t,r={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},n=8;n<t.length;n+=2)switch(t[n]){case"raddr":r.relatedAddress=t[n+1];break;case"rport":r.relatedPort=parseInt(t[n+1],10);break;case"tcptype":r.tcpType=t[n+1];break;case"ufrag":r.ufrag=t[n+1],r.usernameFragment=t[n+1];break;default:r[t[n]]=t[n+1]}return r},n.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},n.parseIceOptions=function(e){return e.substr(14).split(" ")},n.parseRtpMap=function(e){var t=e.substr(9).split(" "),r={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),r.name=t[0],r.clockRate=parseInt(t[1],10),r.channels=3===t.length?parseInt(t[2],10):1,r.numChannels=r.channels,r},n.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var r=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==r?"/"+r:"")+"\r\n"},n.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},n.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},n.parseFmtp=function(e){for(var t,r={},n=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<n.length;i++)r[(t=n[i].trim().split("="))[0].trim()]=t[1];return r},n.writeFmtp=function(e){var t="",r=e.payloadType;if(void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var n=[];Object.keys(e.parameters).forEach(function(t){e.parameters[t]?n.push(t+"="+e.parameters[t]):n.push(t)}),t+="a=fmtp:"+r+" "+n.join(";")+"\r\n"}return t},n.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},n.writeRtcpFb=function(e){var t="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},n.parseSsrcMedia=function(e){var t=e.indexOf(" "),r={ssrc:parseInt(e.substr(7,t-7),10)},n=e.indexOf(":",t);return n>-1?(r.attribute=e.substr(t+1,n-t-1),r.value=e.substr(n+1)):r.attribute=e.substr(t+1),r},n.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(function(e){return parseInt(e,10)})}},n.getMid=function(e){var t=n.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},n.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},n.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:n.matchPrefix(e+t,"a=fingerprint:").map(n.parseFingerprint)}},n.writeDtlsParameters=function(e,t){var r="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),r},n.getIceParameters=function(e,t){var r=n.splitLines(e);return{usernameFragment:(r=r.concat(n.splitLines(t))).filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:r.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)}},n.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},n.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=n.splitLines(e)[0].split(" "),i=3;i<r.length;i++){var o=r[i],s=n.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(s){var a=n.parseRtpMap(s),c=n.matchPrefix(e,"a=fmtp:"+o+" ");switch(a.parameters=c.length?n.parseFmtp(c[0]):{},a.rtcpFeedback=n.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(n.parseRtcpFb),t.codecs.push(a),a.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(a.name.toUpperCase())}}}return n.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(n.parseExtmap(e))}),t},n.writeRtpDescription=function(e,t){var r="";r+="m="+e+" ",r+=t.codecs.length>0?"9":"0",r+=" UDP/TLS/RTP/SAVPF ",r+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){r+=n.writeRtpMap(e),r+=n.writeFmtp(e),r+=n.writeRtcpFb(e)});var i=0;return t.codecs.forEach(function(e){e.maxptime>i&&(i=e.maxptime)}),i>0&&(r+="a=maxptime:"+i+"\r\n"),r+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach(function(e){r+=n.writeExtmap(e)}),r},n.parseRtpEncodingParameters=function(e){var t,r=[],i=n.parseRtpParameters(e),o=-1!==i.fecMechanisms.indexOf("RED"),s=-1!==i.fecMechanisms.indexOf("ULPFEC"),a=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),c=a.length>0&&a[0].ssrc,d=n.matchPrefix(e,"a=ssrc-group:FID").map(function(e){return e.substr(17).split(" ").map(function(e){return parseInt(e,10)})});d.length>0&&d[0].length>1&&d[0][0]===c&&(t=d[0][1]),i.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var n={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&t&&(n.rtx={ssrc:t}),r.push(n),o&&((n=JSON.parse(JSON.stringify(n))).fec={ssrc:c,mechanism:s?"red+ulpfec":"red"},r.push(n))}}),0===r.length&&c&&r.push({ssrc:c});var u=n.matchPrefix(e,"b=");return u.length&&(u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substr(7),10):0===u[0].indexOf("b=AS:")?1e3*parseInt(u[0].substr(5),10)*.95-16e3:void 0,r.forEach(function(e){e.maxBitrate=u})),r},n.parseRtcpParameters=function(e){var t={},r=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];r&&(t.cname=r.value,t.ssrc=r.ssrc);var i=n.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=i.length>0,t.compound=0===i.length;var o=n.matchPrefix(e,"a=rtcp-mux");return t.mux=o.length>0,t},n.parseMsid=function(e){var t,r=n.matchPrefix(e,"a=msid:");if(1===r.length)return{stream:(t=r[0].substr(7).split(" "))[0],track:t[1]};var i=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return i.length>0?{stream:(t=i[0].value.split(" "))[0],track:t[1]}:void 0},n.parseSctpDescription=function(e){var t,r=n.parseMLine(e),i=n.matchPrefix(e,"a=max-message-size:");i.length>0&&(t=parseInt(i[0].substr(19),10)),isNaN(t)&&(t=65536);var o=n.matchPrefix(e,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substr(12),10),protocol:r.fmt,maxMessageSize:t};if(n.matchPrefix(e,"a=sctpmap:").length>0){var s=n.matchPrefix(e,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(s[0],10),protocol:s[1],maxMessageSize:t}}},n.writeSctpDescription=function(e,t){var r=[];return r="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&r.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),r.join("")},n.generateSessionId=function(){return Math.random().toString().substr(2,21)},n.writeSessionBoilerplate=function(e,t,r){var i=void 0!==t?t:2;return"v=0\r\no="+(r||"thisisadapterortc")+" "+(e||n.generateSessionId())+" "+i+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},n.writeMediaSection=function(e,t,r,i){var o=n.writeRtpDescription(e.kind,t);if(o+=n.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=n.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":"active"),o+="a=mid:"+e.mid+"\r\n",e.direction?o+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var s="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";o+="a="+s,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+s,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+s,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+n.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+n.localCName+"\r\n"),o},n.getDirection=function(e,t){for(var r=n.splitLines(e),i=0;i<r.length;i++)switch(r[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[i].substr(2)}return t?n.getDirection(t):"sendrecv"},n.getKind=function(e){return n.splitLines(e)[0].split(" ")[0].substr(2)},n.isRejected=function(e){return"0"===e.split(" ",2)[1]},n.parseMLine=function(e){var t=n.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},n.parseOLine=function(e){var t=n.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},n.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=n.splitLines(e),r=0;r<t.length;r++)if(t[r].length<2||"="!==t[r].charAt(1))return!1;return!0},"object"==typeof t&&(t.exports=n)},{}]},{},[1])(1)},function(e,t,r){var n,i;n=[r(0),r(5),r(2)],void 0===(i=function(e,t,r){"use strict";var n=e.stringifyJSON,i=e.isObject,o=e.isNumber,s=e.isBool;function a(){t.call(this),this._logger=r.create("RtcStats","console"),this._logger.verbose("RtcStats()"),this.videoTimestampPrev=null,this.videoFramesPrev=null,this.videoBytesPrev=0,this.audioTimestampPrev=null,this.audioBytesPrev=0,this.firstReportTimestamp=0,this.videoSsrcPrev=0,this.frameWidthPrev=void 0,this.frameHeightPrev=void 0,this.resolutionChanged=void 0}var c=a.prototype=Object.create(t.prototype);return a.logger=r.create("RtcStats","console"),c.putReport=function(e,t,r){this._logger.verbose("putReport("+n(e)+", "+t+", "+r+")");var i=this._filterStats(e,t,r);this.emitSimple("ReceivedWebRTCStats",{results:i})},c._filterStats=function(e,t,r){if(this._logger.verbose("_filterStats("+n(e)+", "+t+")"),i(e)){var a=this,c={};return e.forEach(function(n){if((!t||"video"===t)&&("track"===n.type&&("video"===n.kind||n.id&&-1!==n.id.indexOf("RTCMediaStreamTrack_sender")||s(n.remoteSource)&&!1===n.remoteSource)&&(n.framesPerSecond&&(c.framerate=Math.round(10*n.framesPerSecond)/10),n.frameWidth&&(c.frameWidth=n.frameWidth,c.frameHeight=n.frameHeight,o(a.frameWidthPrev)&&o(a.frameHeightPrev)?a.frameWidthPrev!==n.frameWidth||a.frameHeightPrev!==n.frameHeight?(a.resolutionChanged=1,a.frameWidthPrev=n.frameWidth,a.frameHeightPrev=n.frameHeight):a.resolutionChanged=0:(a.frameWidthPrev=n.frameWidth,a.frameHeightPrev=n.frameHeight,a.resolutionChanged=0))),"outbound-rtp"===n.type&&"video"===n.mediaType)){if(n.codecId)if(m=e.get(n.codecId)){var i=m.mimeType;c.videoCodec=i}else c.videoCodec=n.codecId;var d=n.timestamp;if(n.bytesSent){var u=n.bytesSent;if(a.videoBytesPrev&&a.videoTimestampPrev){var l=8*(u-a.videoBytesPrev)/(d-a.videoTimestampPrev);c.videoBitrate=Math.round(l)}a.videoBytesPrev=u}if(n.framesEncoded&&a.videoTimestampPrev){if(a.videoFramesPrev){var p=1e3*(n.framesEncoded-a.videoFramesPrev)/(d-a.videoTimestampPrev);c.framerate=Math.round(10*p)/10}a.videoFramesPrev=n.framesEncoded}if(r){if(c.extended={nackCount:void 0,framesEncoded:void 0,keyFramesEncoded:void 0,totalEncodeTime:void 0,averageEncodeTime:void 0,encodeTimePercentage:void 0,idleTimePercentage:void 0,firCount:void 0,pliCount:void 0,resolutionChanged:void 0,priority:0},c.extended.nackCount=n.nackCount,c.extended.framesEncoded=n.framesEncoded,c.extended.keyFramesEncoded=n.keyFramesEncoded,c.extended.totalEncodeTime=n.totalEncodeTime,o(n.totalEncodeTime)&&o(n.framesEncoded)){var f=n.totalEncodeTime/n.framesEncoded;c.extended.averageEncodeTime=Math.round(1e3*f)/1e3}if(a.firstReportTimestamp&&o(n.totalEncodeTime)){var h=(d-a.firstReportTimestamp)/1e3,g=100*n.totalEncodeTime/h,v=100-g;c.extended.encodeTimePercentage=Math.round(1e3*g)/1e3,c.extended.idleTimePercentage=Math.round(1e3*v)/1e3}n.ssrc&&a.videoSsrcPrev!==n.ssrc&&(a.videoSsrcPrev=n.ssrc,a.firstReportTimestamp=n.timestamp),c.extended.firCount=n.firCount,c.extended.pliCount=n.pliCount,c.extended.resolutionChanged=a.resolutionChanged,1===a.resolutionChanged&&(c.extended.priority=1)}a.videoTimestampPrev=d}if((!t||"audio"===t)&&"outbound-rtp"===n.type&&"audio"===n.mediaType){var m;if(n.codecId)if(m=e.get(n.codecId)){i=m.mimeType;c.audioCodec=i}else c.audioCodec=n.codecId;d=n.timestamp;if(n.bytesSent){u=n.bytesSent;if(a.audioBytesPrev&&a.audioTimestampPrev){l=8*(u-a.audioBytesPrev)/(d-a.audioTimestampPrev);c.audioBitrate=Math.round(l)}a.audioBytesPrev=u}a.audioTimestampPrev=d}}),c}},a}.apply(t,n))||(e.exports=i)},function(e,t,r){var n=r(24),i=r(116),o=r(9),s=r(54),a=/^\[object .+?Constructor\]$/,c=Function.prototype,d=Object.prototype,u=c.toString,l=d.hasOwnProperty,p=RegExp("^"+u.call(l).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!o(e)||i(e))&&(n(e)?p:a).test(s(e))}},function(e,t,r){(function(t){var r="object"==typeof t&&t&&t.Object===Object&&t;e.exports=r}).call(this,r(113))},function(e,t,r){var n=r(7)["__core-js_shared__"];e.exports=n},function(e,t){var r=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return r.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},function(e,t,r){var n=r(118),i=r(125),o=r(127),s=r(128),a=r(129);function c(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}c.prototype.clear=n,c.prototype.delete=i,c.prototype.get=o,c.prototype.has=s,c.prototype.set=a,e.exports=c},function(e,t,r){var n=r(57),i=r(23),o=Object.prototype.hasOwnProperty;e.exports=function(e,t,r){var s=e[t];o.call(e,t)&&i(s,r)&&(void 0!==r||t in e)||n(e,t,r)}},function(e,t,r){var n=r(131);e.exports=function(e,t,r){"__proto__"==t&&n?n(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}},function(e,t,r){var n=r(133),i=r(35),o=r(8),s=r(18),a=r(135),c=r(27),d=Object.prototype.hasOwnProperty;e.exports=function(e,t){var r=o(e),u=!r&&i(e),l=!r&&!u&&s(e),p=!r&&!u&&!l&&c(e),f=r||u||l||p,h=f?n(e.length,String):[],g=h.length;for(var v in e)!t&&!d.call(e,v)||f&&("length"==v||l&&("offset"==v||"parent"==v)||p&&("buffer"==v||"byteLength"==v||"byteOffset"==v)||a(v,g))||h.push(v);return h}},function(e,t){e.exports=function(){return!1}},function(e,t,r){var n=r(28),i=r(137),o=Object.prototype.hasOwnProperty;e.exports=function(e){if(!n(e))return i(e);var t=[];for(var r in Object(e))o.call(e,r)&&"constructor"!=r&&t.push(r);return t}},function(e,t){e.exports=function(e,t){return function(r){return e(t(r))}}},function(e,t){e.exports=function(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t}},function(e,t){e.exports=function(){return[]}},function(e,t,r){var n=r(65),i=r(40),o=r(39),s=r(63),a=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)n(t,o(e)),e=i(e);return t}:s;e.exports=a},function(e,t){e.exports=function(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e}},function(e,t,r){var n=r(67),i=r(39),o=r(13);e.exports=function(e){return n(e,o,i)}},function(e,t,r){var n=r(65),i=r(8);e.exports=function(e,t,r){var o=t(e);return i(e)?o:n(o,r(e))}},function(e,t,r){var n=r(7).Uint8Array;e.exports=n},function(e,t,r){var n=r(158),i=r(14),o=r(15),s=o&&o.isMap,a=s?i(s):n;e.exports=a},function(e,t,r){var n=r(159),i=r(14),o=r(15),s=o&&o.isSet,a=s?i(s):n;e.exports=a},function(e,t,r){var n=r(178),i=r(181),o=r(182),s=1,a=2;e.exports=function(e,t,r,c,d,u){var l=r&s,p=e.length,f=t.length;if(p!=f&&!(l&&f>p))return!1;var h=u.get(e);if(h&&u.get(t))return h==t;var g=-1,v=!0,m=r&a?new n:void 0;for(u.set(e,t),u.set(t,e);++g<p;){var _=e[g],S=t[g];if(c)var b=l?c(S,_,g,t,e,u):c(_,S,g,e,t,u);if(void 0!==b){if(b)continue;v=!1;break}if(m){if(!i(t,function(e,t){if(!o(m,t)&&(_===e||d(_,e,r,c,u)))return m.push(t)})){v=!1;break}}else if(_!==S&&!d(_,S,r,c,u)){v=!1;break}}return u.delete(e),u.delete(t),v}},function(e,t){e.exports=function(e){var t=-1,r=Array(e.size);return e.forEach(function(e,n){r[++t]=[n,e]}),r}},function(e,t){e.exports=function(e){var t=-1,r=Array(e.size);return e.forEach(function(e){r[++t]=e}),r}},function(e,t,r){var n=r(30);e.exports=function(e){return"number"==typeof e&&e==n(e)}},function(e,t,r){var n=r(42),i=1/0,o=17976931348623157e292;e.exports=function(e){return e?(e=n(e))===i||e===-i?(e<0?-1:1)*o:e==e?e:0:0===e?e:0}},function(e,t,r){var n=r(33),i=r(45),o=1,s=2;e.exports=function(e,t,r,a){var c=r.length,d=c,u=!a;if(null==e)return!d;for(e=Object(e);c--;){var l=r[c];if(u&&l[2]?l[1]!==e[l[0]]:!(l[0]in e))return!1}for(;++c<d;){var p=(l=r[c])[0],f=e[p],h=l[1];if(u&&l[2]){if(void 0===f&&!(p in e))return!1}else{var g=new n;if(a)var v=a(f,h,p,e,t,g);if(!(void 0===v?i(h,f,o|s,a,g):v))return!1}}return!0}},function(e,t,r){var n=r(189),i=r(13);e.exports=function(e){for(var t=i(e),r=t.length;r--;){var o=t[r],s=e[o];t[r]=[o,s,n(s)]}return t}},function(e,t,r){var n=r(4),i=r(1),o="[object Number]";e.exports=function(e){return"number"==typeof e||i(e)&&n(e)==o}},function(e,t,r){var n=r(4),i=r(8),o=r(1),s="[object String]";e.exports=function(e){return"string"==typeof e||!i(e)&&o(e)&&n(e)==s}},function(e,t){e.exports=function(e,t){for(var r=-1,n=null==e?0:e.length,i=Array(n);++r<n;)i[r]=t(e[r],r,e);return i}},function(e,t){e.exports=function(e,t,r){return e==e&&(void 0!==r&&(e=e<=r?e:r),void 0!==t&&(e=e>=t?e:t)),e}},function(e,t,r){var n,i;n=[r(83),r(84),r(6),r(0),r(218),r(31)],void 0===(i=function(e,t,r,n,i,o){"use strict";window.nanowebrtc={user:e,userinternal:t,tools:n,const:r,audioprocess:i,version:o.webrtc.release_version,release_description:o.webrtc.release_description}}.apply(t,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r(5),r(0),r(6)],void 0===(i=function(e,t,r){"use strict";var n=t.parseJSON,i=t.stringifyJSON;function o(){e.call(this);var t=window.nanowebrtc.userinternal;this._rtcUser=new t;var n=this;r.EVENT_NAMES.webcast.forEach(function(e){n._rtcUser.on(e,function(e){n.emitSimple(e.name,e.data,e.error)})}),r.EVENT_NAMES.chat.forEach(function(e){n._rtcUser.on(e,function(e){n.emit(e.name,e.data)})}),o.browserSupport=t.browserSupport}var s=o.prototype=Object.create(e.prototype);return o.browserSupport={supportLevel:-1,supportText:""},o.checkSupport=function(){var e=window.nanowebrtc.userinternal;return o.browserSupport=e.checkSupport(),n(i(o.browserSupport))},s.signIn=function(e){return this._rtcUser.signIn(e)},s.signOut=function(){return this._rtcUser.signOut()},s.isSignedIn=function(){return this._rtcUser.isSignedIn()},s.setConfig=function(e){return this._rtcUser.setConfig(e)},s.setIceServers=function(e){return this._rtcUser.setIceServers(e)},s.checkServer=function(e){return this._rtcUser.checkServer(e)},s.enableStats=function(e,t){return this._rtcUser.enableStats(e,t)},s.startBroadcast=function(e){return this._rtcUser.startBroadcast(e)},s.stopBroadcast=function(){return this._rtcUser.stopBroadcast()},s.sendMetaData=function(e,t){return this._rtcUser.sendMetaData(e,t)},s.enterRoom=function(e){return this._rtcUser.enterRoom(e)},s.leaveRoom=function(){return this._rtcUser.leaveRoom()},s.invokeCall=function(e){return this._rtcUser.invokeCall(e)},s.hangUpCall=function(e){return this._rtcUser.hangUpCall(e)},s.answerCall=function(e){return this._rtcUser.answerCall(e)},s.declineCall=function(e){return this._rtcUser.declineCall(e)},s.addScreenCaptureExtension=function(e){return this._rtcUser.addScreenCaptureExtension(e)},s.isScreenCaptureAvailable=function(){return this._rtcUser.isScreenCaptureAvailable()},s.getDevices=function(){return this._rtcUser.getDevices()},s.setVideoDevice=function(e){return this._rtcUser.setVideoDevice(e)},s.setAudioDevice=function(e){return this._rtcUser.setAudioDevice(e)},s.getSelectedVideoDevice=function(){return this._rtcUser.getSelectedVideoDevice()},s.getSelectedAudioDevice=function(){return this._rtcUser.getSelectedAudioDevice()},s.getSelectedDevice=function(e){return this._rtcUser.getSelectedDevice(e)},s.startPreview=function(e){return this._rtcUser.startPreview(e)},s.stopPreview=function(){return this._rtcUser.stopPreview()},s.muteVideo=function(e){return this._rtcUser.muteVideo(e)},s.muteAudio=function(e){return this._rtcUser.muteAudio(e)},s.muteDevice=function(e){return this._rtcUser.muteDevice(e)},s.injectExternalMediaStream=function(e){return this._rtcUser.injectExternalMediaStream(e)},o}.apply(t,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r(85),r(6),r(0),r(5),r(90),r(91),r(32),r(94),r(19),r(95),r(3),r(97),r(2),r(98)],void 0===(i=function(e,t,n,i,o,s,a,c,d,u,l,p,f,h){"use strict";var g=r(100),v=n.getElement,m=n.stringifyJSON,_=n.parseJSON,S=n.isObject,b=n.isArray,y=n.isString,C=n.isBool,E=(n.isNumber,n.isInt),T=n.isEmpty,P={Chrome:{versions:{current:72,minimal:50},mobile:!0},Firefox:{versions:{current:66,minimal:42},mobile:!0},Opera:{versions:{current:60,minimal:40},mobile:!0},"Microsoft Edge":{versions:void 0,mobile:void 0},Safari:{versions:{current:12,minimal:11},mobile:!1}};function w(){i.call(this),this._logger=f.create("RtcUser","console"),this._logger.verbose("RtcUser()"),this._userId=void 0,this._iceServers=[{urls:["stun:stun.l.google.com:19302"]},{urls:["stun:stun.nanocosmos.net:80"],username:"nano",credential:"nano"}],this._iceServersOverride=void 0,this._config={codecs:{videoCodec:"H264"},bitrates:{videoSendInitialBitrate:0,videoSendBitrate:0},sdpPatches:{preventReplaceSendReceive:!1}},this._streamProtected=!1,this._statsEnabled=!1,this._statsIntervalTime=1e3,this._metricsEnabled=!1,this._broadcaster=void 0,this._isBroadcasting=!1,this._audioMixer=new o,this._session=void 0,this._deviceController=new s,this._mediaController=new a(this._deviceController),this._mediaController.on("StreamTrackEnded",this._onStreamTrackEnded.bind(this)),this._screenCaptureExtension=new c;var e=this._screenCaptureExtension.getScreenCaptureName(),t=this._deviceController.addScreenCaptureDevice(e);t.length>0&&(t.updated=!0,this.emitSimple("ReceivedDeviceList",t)),this._videoDeviceConfig={},w.checkSupport()}var R=w.prototype=Object.create(i.prototype);return w.browserSupport={supportLevel:-1,supportText:""},w.logger=f.create("RtcUser","console"),w.checkSupport=function(){w.logger.verbose("checkSupport()");var e=n.browserInfo.browser,t=parseInt(n.browserInfo.browserVersion.split(".")[0],10),r=n.browserInfo.mobile,i=n.getVersionText(e,t,r);w.logger.verbose("checkSupport(): "+i);var o=1,s=P[e];void 0!==s&&(void 0!==s.versions&&void 0!==s.mobile?(o=0,t<s.versions.current&&t>=s.versions.minimal&&(o=2),(t<s.versions.minimal||r&&!1===s.mobile)&&(o=3)):o=3);var a=n.getSupportText(e,t,r,o);return 1===o&&w.logger.error("checkSupport(): "+a),w.browserSupport.supportLevel=o,w.browserSupport.supportText=a,w.browserSupport},R.signIn=function(e){var t=g.cloneDeep(e);this._logger.verbose("signIn("+m(t)+")");var r="signIn(): ",n=this;if(!S(t)){var i=l.TypeNotValidError("options","Object");this._logger.error(r+m(i));var o=l.composeEvent(i,"SignInError");return this.emitSimple(o.name,o.data,o.error),void this._sendMetrics(o)}return t.userName&&this._logger.warning(r+'"options.userName" parameter is deprecated and will be removed in the WebRTC-Client v.6'),t.room&&(this._logger.warning(r+'"options.room" parameter is deprecated and will be removed in the WebRTC-Client v.6'),/_/.test(t.room)&&(t.room=t.room.replace(/_/g,""),this._logger.warning(r+'"options.room" parameter should not contain underscores (_)'))),t.serverUserName&&this._logger.warning(r+'"options.serverUserName" parameter is deprecated and will be removed in the WebRTC-Client v.6'),t.serverPassword&&this._logger.warning(r+'"options.serverPassword" parameter is deprecated and will be removed in the WebRTC-Client v.6'),p.isWebSocketUrl(t.server)||this._logger.warning(r+'"options.server" parameter is expected to be a String of format: "ws(s)://host[:port]/path[?query]". An error will be thrown on incorrect type/format starting from the WebRTC-Client v.6'),t.jwt&&(p.isJWT(t.jwt)||this._logger.warning(r+'"options.jwt" parameter is expected to be a String of format: "Base64-encoded part.Base64-encoded part.Base64-encoded part". An error will be thrown on incorrect type/format starting from the WebRTC-Client v.6')),this.isSignedIn()?Promise.reject(l.SignInError("Already signed in")):(this._session=new d,this._session.on("SessionMessage",n._onSessionMessage.bind(n)),this._session.signIn(t).then(function(e){if(e.data){e.data.iceServers&&(n._iceServers=e.data.iceServers),n._userId=e.data.userId;var t=JSON.parse(JSON.stringify(e));t.name="SignInSuccess",delete t.data.iceServers,n._logger.info(r+t.name+": "+m(t)),n.emitSimple(t.name,t.data),n._sendMetrics(t)}}).catch(function(e){n._session.removeAllListeners(),"NanoError"!==e.type&&(e=l.GeneralError("Failed to sign in")),n._logger.error(r+m(e));var t=l.composeEvent(e,"SignInError");n.emitSimple(t.name,t.data,t.error),n._sendMetrics(t)}))},R.signOut=function(){this._logger.verbose("signOut()");var e=this;if(!this.isSignedIn())return Promise.reject(l.NotSignedInError());this._session.signOut().then(function(){return e._destroy()}).then(function(){e._session.removeAllListeners(),e._session=void 0;var t={name:"SignOutSuccess",data:{}};e.emitSimple(t.name,t.data),e._sendMetrics(t)}).catch(function(t){"NanoError"!==t.type&&(t=l.GeneralError("Failed to sign out")),e._logger.error("signOut(): "+m(t));var r=l.composeEvent(t,"SignOutError");e.emitSimple(r.name,r.data,r.error),e._sendMetrics(r)})},R.isSignedIn=function(){return this._logger.verbose("isSignedIn()"),!!this._session&&this._session.isSignedIn()},R.setConfig=function(e){var r=g.cloneDeep(e);this._logger.verbose("setConfig("+m(r)+")");var n="setConfig(): ";if(S(r)){var i={};if(S(r.metrics)){var o=""+r.metrics.accountId,s=""+r.metrics.accountKey;if(o.length>0&&s.length>0){i.graylog={credentials:{accountId:o,accountKey:s}};var a=JSON.parse(JSON.stringify(r.metrics));delete a.accountId,delete a.accountKey;try{this._metricsController=new h(this,a),this._metricsEnabled=!0}catch(c){this._logger.error(n+m(c)),this._metricsEnabled=!1}}}if(p.isIntInRange(r.logLevel,t.LOG_LEVEL.DISABLED,t.LOG_LEVEL.VERBOSE)&&(i.console={level:r.logLevel}),T(i)||f.setConfig(i),r.codecs)if(y(r.codecs.videoCodec))this._config.codecs.videoCodec=r.codecs.videoCodec;else if(void 0!==r.codecs.videoCodec){c=l.TypeNotValidError("config.bitrates.videoCodec","String");this._logger.error(n+m(c));d=l.composeEvent(c,"SetConfigError");this.emitSimple(d.name,d.data,d.error),this._sendMetrics(d)}if(r.bitrates){if(E(r.bitrates.videoSendInitialBitrate))p.isIntInRange(r.bitrates.videoSendInitialBitrate,0,34e3)||this._logger.warning(n+'"config.bitrates.videoSendInitialBitrate" parameter is expected to be an Integer in range 0 - 34000 kbps. An error will be thrown on incorrect type/range starting from the WebRTC-Client v.6'),this._config.bitrates.videoSendInitialBitrate=r.bitrates.videoSendInitialBitrate;else if(void 0!==r.bitrates.videoSendInitialBitrate){c=l.TypeNotValidError("config.bitrates.videoSendInitialBitrate","Number");this._logger.error(n+m(c));d=l.composeEvent(c,"SetConfigError");this.emitSimple(d.name,d.data,d.error),this._sendMetrics(d)}if(E(r.bitrates.videoSendBitrate))p.isIntInRange(r.bitrates.videoSendBitrate,0,34e3)||this._logger.warning(n+'"config.bitrates.videoSendBitrate" parameter is expected to be an Integer in range 0 - 34000 kbps. An error will be thrown on incorrect type/range starting from the WebRTC-Client v.6'),this._config.bitrates.videoSendBitrate=r.bitrates.videoSendBitrate;else if(void 0!==r.bitrates.videoSendBitrate){c=l.TypeNotValidError("config.bitrates.videoSendBitrate","Number");this._logger.error(n+m(c));d=l.composeEvent(c,"SetConfigError");this.emitSimple(d.name,d.data,d.error),this._sendMetrics(d)}if(E(r.bitrates.audioSendBitrate))p.isIntInRange(r.bitrates.audioSendBitrate,0,512)||this._logger.warning(n+'"config.bitrates.audioSendBitrate" parameter is expected to be an Integer in range 0 - 512 kbps. An error will be thrown on incorrect type/range starting from the WebRTC-Client v.6'),this._config.bitrates.audioSendBitrate=r.bitrates.audioSendBitrate;else if(void 0!==r.bitrates.audioSendBitrate){c=l.TypeNotValidError("config.bitrates.audioSendBitrate","Number");this._logger.error(n+m(c));d=l.composeEvent(c,"SetConfigError");this.emitSimple(d.name,d.data,d.error),this._sendMetrics(d)}}if(r.sdpPatches)if(C(r.sdpPatches.preventReplaceSendReceive))this._config.sdpPatches.preventReplaceSendReceive=r.sdpPatches.preventReplaceSendReceive;else{c=l.TypeNotValidError("config.sdpPatches.preventReplaceSendReceive","Bool");this._logger.error(n+m(c));d=l.composeEvent(c,"SetConfigError");this.emitSimple(d.name,d.data,d.error),this._sendMetrics(d)}r.iceServers&&b(r.iceServers)&&(this._config.iceServers=r.iceServers)}else{var c=l.TypeNotValidError("config","Object");this._logger.error(n+m(c));var d=l.composeEvent(c,"SetConfigError");this.emitSimple(d.name,d.data,d.error)}},R.setIceServers=function(e){var t=g.cloneDeep(e);this._logger.verbose("setIceServers("+m(t)+")"),this._logger.warning('"setIceServers()" function is deprecated and will be removed in the WebRTC-Client v.6'),this._iceServersOverride=t},R.checkServer=function(e){this._logger.verbose("checkServer()");var t=this;if(!this.isSignedIn())return Promise.reject(l.NotSignedInError());this._session.status().then(function(e){t.emitSimple("ReceivedServerStats",{stats:_(e.data)||{error:{message:"Could not parse response from server",code:-1,userinfo:null}}})}).catch(function(e){t._logger.error("checkServer: "+m(e))})},R.enableStats=function(e,t){this._logger.verbose("enableStats("+e+", "+t+")");t<1e3&&this._logger.warning('enableStats(): "interval" parameter is expected to be an Integer higher than or equal to 1 second. An error will be thrown on incorrect type/format starting from the WebRTC-Client v.6'),this._statsEnabled=void 0===e||e,this._statsIntervalTime=t||1e3},R.startBroadcast=function(t){var r=g.cloneDeep(t);this._logger.debug("startBroadcast("+m(r)+")");var i="startBroadcast(): ",o=this;if(S(r)){if(!o.isSignedIn())return u=l.NotSignedInError(),this._logger.error(i+m(u)),f=l.composeEvent(u,"StartBroadcastError"),this.emitSimple(f.name,f.data,f.error),void this._sendMetrics(f);if(this._broadcaster)return u=l.WrongStateError("Already broadcasting"),this._logger.error(i+m(u)),f=l.composeEvent(u,"StartBroadcastError"),this.emitSimple(f.name,f.data,f.error),void this._sendMetrics(f);var s=this._mediaController.getLocalMedias()[0];if(!s)return u=l.WrongStateError("No Local Media"),this._logger.error(i+m(u)),f=l.composeEvent(u,"StartBroadcastError"),this.emitSimple(f.name,f.data,f.error),void this._sendMetrics(f);r.encoding&&!T(r.encoding)&&(p.isH264Profile(r.encoding.h264Profile)?(("Chrome"!==n.browserInfo.browser||"Windows"!==n.browserInfo.os||"Chrome"===n.browserInfo.browser&&n.browserInfo.mobile)&&(delete r.encoding.h264Profile,this._logger.warning(i+'"config.encoding.h264Profile" parameter should be set in Chrome desktop for Windows only.')),this._config.encoding=r.encoding):this._logger.warning(i+'"config.encoding.h264Profile" parameter is not a valid H264 codec profile.')),this._broadcaster=new e(this._userId,this._session),this._config.jwt=r.jwt,this._config.extended=this._metricsEnabled,this._broadcaster.setConfig(this._config);var a=this._iceServersOverride||this._config.iceServers||this._iceServers;this._broadcaster.setIceServers(a),this._broadcaster.enableStats(this._statsEnabled,this._statsIntervalTime),this._listenToBroadcaster(this._broadcaster);var c=s.stream;this._broadcaster.addStream(c),S(r.transcodingTargets)||(r.transcodingTargets={}),T(r.transcodingTargets)||(p.isRtmpUrl(r.transcodingTargets.output)||this._logger.warning(i+'"config.transcodingTargets.output" parameter is expected to be a String of format: "rtmp(s)://host[:port]/application/[path]". An error will be thrown on incorrect type/format starting from the WebRTC-Client v.6'),r.transcodingTargets.audiobitrate&&(p.isIntInRange(r.transcodingTargets.audiobitrate,0,512)||this._logger.warning(i+'Starting from the WebRTC-Client v.6, the "config.transcodingTargets.audiobitrate" parameter will be expected to be an Integer in range 0 - 510 kbps.')),r.transcodingTargets.rtmpconnectinfo&&(p.isObjectOfMaxDepth(r.transcodingTargets.rtmpconnectinfo,1)||this._logger.warning(i+'"config.transcodingTargets.rtmpconnectinfo" parameter is expected to be a flat object (of max depth 1). An error will be thrown on incorrect type/format starting from the WebRTC-Client v.6'))),r.jwt&&(p.isJWT(r.jwt)||this._logger.warning(i+'"options.jwt" parameter is expected to be a String of format: "Base64-encoded part.Base64-encoded part.Base64-encoded part". An error will be thrown on incorrect type/format starting from the WebRTC-Client v.6'));var d=s.metadata;r.transcodingTargets.videowidth=d.width,r.transcodingTargets.videoheight=d.height,this._deviceController.getDevice("videoinput").then(function(e){var t=C(e)?o._videoDeviceConfig:e.videoDeviceConfig;return(!C(e)||C(e)&&!0===e)&&(r.transcodingTargets.targetvideowidth=t.width&&t.width.ideal||0,r.transcodingTargets.targetvideoheight=t.height&&t.height.ideal||0,r.transcodingTargets.source=t.source||"",r.transcodingTargets.ismobile=n.browserInfo.mobile?1:0),o._broadcaster.setTranscodingSettings(r.transcodingTargets),o._broadcaster.start()}).then(function(e){o._streamProtected=!0,o._logger.info(i+"StartBroadcastSuccess: stream name: "+c),e.name="StartBroadcastSuccess",o.emitSimple(e.name,e.data),o._sendMetrics(e)}).catch(function(e){o._isBroadcasting=!1,o._broadcaster.destroy(),o._broadcaster=void 0,o._streamProtected=o._chatRoom&&!!o._chatRoom.getUsersCount()||!1,"NanoError"!==e.type&&(e=l.GeneralError("Failed to start broadcast")),o._logger.error(i+m(e)),f=l.composeEvent(e,"StartBroadcastError"),o.emitSimple(f.name,f.data,f.error),o._sendMetrics(f)})}else{var u=l.TypeNotValidError("config","Object");this._logger.error(i+m(u));var f=l.composeEvent(u,"StartBroadcastError");this.emitSimple(f.name,f.data,f.error)}},R.stopBroadcast=function(){this._logger.verbose("stopBroadcast()");var e="stopBroadcast(): ",t=this,r=t._broadcaster;if(this._broadcaster=void 0,r)r.stop().catch(function(r){"NanoError"!==r.type&&(r=l.GeneralError("Failed to stop broadcast")),t._logger.error(e+m(r));var n=l.composeEvent(r,"StopBroadcastError");t.emitSimple(n.name,n.data,n.error),t._sendMetrics(n)}).then(function(r){t._isBroadcasting=!1,t._streamProtected=t._chatRoom&&!!t._chatRoom.getUsersCount()||!1,t._logger.info(e+"StopBroadcastSuccess"),r.name="StopBroadcastSuccess",t.emitSimple(r.name,r.data),t._sendMetrics(r)});else{var n=l.StopBroadcastError("No broadcast is running");this._logger.error(e+m(n));var i=l.composeEvent(n);this.emitSimple(i.name,i.data,i.error),this._sendMetrics(i)}},R.sendMetaData=function(e,t){var r=g.cloneDeep(t);this._logger.verbose("sendMetaData("+e+", "+m(r)+")");var n="sendMetaData(): ",i=this;if(!y(e)){var o=l.TypeNotValidError("handlerName","String");this._logger.error(n+m(o));var s=l.composeEvent(o,"Error");return this.emitSimple(s.name,s.data,s.error),void this._sendMetrics(s)}if(p.isMetadataHandler(e)||this._logger.warning(n+'"handlerName" parameter is expected to be a String containg one of the following values: "onMetaData" or "onCuePoint". An error will be thrown on incorrect type/value starting from the WebRTC-Client v.6'),!S(r)){o=l.TypeNotValidError("jsonValues","Object");this._logger.error(n+m(o));s=l.composeEvent(o,"Error");return this.emitSimple(s.name,s.data,s.error),void this._sendMetrics(s)}if(p.isObjectOfMaxDepth(r,6)||this._logger.warning(n+'"jsonValues" parameter is expected to be an Object of max depth 6. An error will be thrown on incorrect type/format starting from the WebRTC-Client v.6'),this._isBroadcasting){this._channels.getBroadcaster().sendMetaData(e,r).catch(function(e){"NanoError"!==e.type&&(e=l.GeneralError("Failed to send metadata")),i._logger.error(n+m(e));var t=l.composeEvent(e,"Error");i.emitSimple(t.name,t.data,t.error),i._sendMetrics(t)})}else{o=l.WrongStateError("Not broadcasting");this._logger.error(n+m(o));s=l.composeEvent(o,"Error");this.emitSimple(s.name,s.data,s.error),this._sendMetrics(s)}},R.enterRoom=function(e){var t=g.cloneDeep(e);this._logger.verbose("enterRoom("+m(t)+")");var r,n,i=this;if(!i.isSignedIn())return r=l.NotSignedInError(),n=l.composeEvent(r,"EnterRoomError"),void this.emitSimple(n.name,n.data,n.error);if(i._chatRoom)return r=l.WrongStateError("Already in room"),n=l.composeEvent(r,"EnterRoomError"),void this.emitSimple(n.name,n.data,n.error);if(!S(t))return r=l.TypeNotValidError("roomOptions","Object"),n=l.composeEvent(r,"EnterRoomError"),void i.emitSimple(n.name,n.data,n.error);if(!y(t.userName))return r=l.TypeNotValidError("roomOptions.userName","String"),n=l.composeEvent(r,"EnterRoomError"),void i.emitSimple(n.name,n.data,n.error);if(!y(t.room))return r=l.TypeNotValidError("roomOptions.room","String"),n=l.composeEvent(r,"EnterRoomError"),void i.emitSimple(n.name,n.data,n.error);t.userId=i._userId,i._chatRoom=new u(t,i._session,i._mediaController),i._chatRoom.setConfig(i._config);var o=i._iceServersOverride||i._iceServers;i._chatRoom.setIceServers(o),i._chatRoom.on("RoomUpdate",i._onRoomUpdate.bind(i)),i._chatRoom.on("RemoteStreamAdded",i._onRemoteStreamAdded.bind(this)),i._chatRoom.enter().then(function(){i._logger.info("enterRoom(): EnterRoomSuccess: user name: "+t.userName+", room name: "+t.room),i.emitSimple("EnterRoomSuccess",{})}).catch(function(e){"NanoError"!==e.type&&(e=l.GeneralError("Failed to enter room"));var t=l.composeEvent(e,"EnterRoomError");i.emitSimple(t.name,t.data,t.error),i._chatRoom.removeEvent("RoomUpdate"),i._chatRoom=void 0})},R.leaveRoom=function(){this._logger.verbose("leaveRoom()");var e=this;if(e._chatRoom)e._chatRoom.removeEvent("RoomUpdate"),e._chatRoom.removeEvent("RemoteStreamAdded"),e._chatRoom.leave().then(function(){e._logger.info("leaveRoom(): LeaveRoomSuccess: user name:"+e._chatRoom._userName+", room name: "+e._chatRoom._roomName),e.emitSimple("LeaveRoomSuccess",{})}).catch(function(t){"NanoError"!==t.type&&(t=l.GeneralError("Failed to leave room"));var r=l.composeEvent(t,"LeaveRoomError");e.emitSimple(r.name,r.data,r.error)}).then(function(){e._chatRoom=void 0});else{var t=l.ObjectNotExistError("_chatRoom","String"),r=l.composeEvent(t,"LeaveRoomError");e.emitSimple(r.name,r.data,r.error)}},R.invokeCall=function(e){this._logger.verbose("invokeCall("+e+")");var t=this;if(t._chatRoom)if(y(e))t._chatRoom.callUser(e).then(function(){t._logger.info("invokeCall(): Invoke call: remote user id: "+e),t._streamProtected=!0}).catch(function(e){t._streamProtected=!!t._chatRoom.getUsersCount()||t._isBroadcasting,"NanoError"!==e.type&&(e=l.GeneralError("Failed to invoke call"));var r=l.composeEvent(e,"InvokeCall");t.emitSimple(r.name,r.data,r.error)});else{r=l.TypeNotValidError("remoteUserId","String"),n=l.composeEvent(r,"InvokeCall");t.emitSimple(n.name,n.data,n.error)}else{var r=l.ObjectNotExistError("_chatRoom","String"),n=l.composeEvent(r,"InvokeCall");t.emitSimple(n.name,n.data,n.error)}},R.hangUpCall=function(e){this._logger.verbose("hangUpCall("+e+")");var t=this;if(t._chatRoom)if(y(e))t._chatRoom.hangUpCall(e).then(function(){t._logger.info("hangUpCall(): Hang up call: remote user id: "+e),t._streamProtected=!!t._chatRoom.getUsersCount()||t._isBroadcasting}).catch(function(e){t._streamProtected=!!t._chatRoom.getUsersCount()||t._isBroadcasting,"NanoError"!==e.type&&(e=l.GeneralError("Failed to hang up call"));var r=l.composeEvent(e,"HangUpCall");t.emitSimple(r.name,r.data,r.error)});else{r=l.TypeNotValidError("remoteUserId","String"),n=l.composeEvent(r,"HangUpCall");t.emitSimple(n.name,n.data,n.error)}else{var r=l.ObjectNotExistError("_chatRoom","String"),n=l.composeEvent(r,"HangUpCall");t.emitSimple(n.name,n.data,n.error)}},R.answerCall=function(e){this._logger.verbose("answerCall("+e+")");var t=this;if(t._chatRoom)if(y(e))t._chatRoom.answerCall(e).then(function(){t._logger.info("answerCall(): Answer call: remote user id: "+e),t._streamProtected=!0}).catch(function(e){t._streamProtected=!!t._chatRoom.getUsersCount()||t._isBroadcasting,"NanoError"!==e.type&&(e=l.GeneralError("Failed to answer call")),t._logger.error("answerCall(): "+m(e));var r=l.composeEvent(e,"AnswerCall");t.emitSimple(r.name,r.data,r.error)});else{r=l.TypeNotValidError("remoteUserId","String"),n=l.composeEvent(r,"AnswerCall");t.emitSimple(n.name,n.data,n.error)}else{var r=l.ObjectNotExistError("_chatRoom","String"),n=l.composeEvent(r,"AnswerCall");t.emitSimple(n.name,n.data,n.error)}},R.declineCall=function(e){this._logger.verbose("declineCall("+e+")");var t=this;if(t._chatRoom)if(y(e))t._chatRoom.declineCall(e).then(function(){t._logger.info("declineCall(): Decline call: remote user id: "+e)}).catch(function(e){"NanoError"!==e.type&&(e=l.GeneralError("Failed to decline call")),t._logger.error("declineCall(): "+m(e));var r=l.composeEvent(e,"DeclineCall");t.emitSimple(r.name,r.data,r.error)});else{r=l.TypeNotValidError("remoteUserId","String"),n=l.composeEvent(r,"DeclineCall");t.emitSimple(n.name,n.data,n.error)}else{var r=l.ObjectNotExistError("_chatRoom","String"),n=l.composeEvent(r,"DeclineCall");t.emitSimple(n.name,n.data,n.error)}},R.addScreenCaptureExtension=function(e){this._logger.verbose("addScreenCaptureExtension("+e+")");var t=n.browserInfo.browser,r=parseInt(n.browserInfo.browserVersion.split(".")[0],10);if("Chrome"===t&&r<72){e=y(e)?e:"nanoScreenCapture",this._screenCaptureExtension.addChromeExtension(e);var i=this._deviceController.addScreenCaptureDevice(e);i.length>0&&(i.updated=!0,this.emitSimple("ReceivedDeviceList",i))}else this._logger.warning("addScreenCaptureExtension(): Screen capture extension is only required for Chrome versions < 72")},R.isScreenCaptureAvailable=function(){return this._logger.verbose("isScreenCaptureAvailable()"),!!this._screenCaptureExtension&&this._screenCaptureExtension.isScreenCaptureAvailable()},R.getDevices=function(){this._logger.verbose("getDevices()"),this._deviceController.enumerateDevices().then(this._getDevicesSuccess.bind(this)).catch(this._getDevicesError.bind(this))},R.setVideoDevice=function(e){var t=g.cloneDeep(e);if(this._logger.verbose("setVideoDevice("+m(t)+")"),this._logger.warning('"setVideoDevice()" function is deprecated and will be removed in the WebRTC-Client v.6'),this._streamProtected){var r=l.WrongStateError("Stream is already in use"),n=l.composeEvent(r,"SetVideoDeviceError");this.emitSimple(n.name,n.data,n.error)}else t.kind="videoinput",this._deviceController.setDevice(t)},R.setAudioDevice=function(e){var t=g.cloneDeep(e);if(this._logger.verbose("setAudioDevice("+m(t)+")"),this._logger.warning('"setAudioDevice()" function is deprecated and will be removed in the WebRTC-Client v.6'),this._streamProtected){var r=l.WrongStateError("Stream is already in use"),n=l.composeEvent(r,"SetAudioDeviceError");this.emitSimple(n.name,n.data,n.error)}else t.kind="audioinput",this._deviceController.setDevice(t)},R.getSelectedVideoDevice=function(){if(this._logger.verbose("getSelectedVideoDevice()"),this._logger.warning('"getSelectedVideoDevice()" function is deprecated and will be removed in the WebRTC-Client v.6'),this._streamProtected){var e=l.WrongStateError("Stream is already in use"),t=l.composeEvent(e,"GetSelectedVideoDeviceError");this.emitSimple(t.name,t.data,t.error)}else this._deviceController.getDevice("videoinput").then(function(e){return e}).catch(function(e){"NanoError"!==e.type&&(e=l.GeneralError("Failed to get device"));var t=l.composeEvent(e,"GetSelectedVideoDeviceError");self.emitSimple(t.name,t.data,t.error)})},R.getSelectedAudioDevice=function(){if(this._logger.verbose("getSelectedAudioDevice()"),this._logger.warning('"getSelectedAudioDevice()" function is deprecated and will be removed in the WebRTC-Client v.6'),this._streamProtected){var e=l.WrongStateError("Stream is already in use"),t=l.composeEvent(e,"GetSelectedAudioDeviceError");this.emitSimple(t.name,t.data,t.error)}else this._deviceController.getDevice("audioinput").then(function(e){return e}).catch(function(e){"NanoError"!==e.type&&(e=l.GeneralError("Failed to get device"));var t=l.composeEvent(e,"GetSelectedAudioDeviceError");self.emitSimple(t.name,t.data,t.error)})},R.getSelectedDevice=function(e){var t=g.cloneDeep(e);this._logger.verbose("getSelectedDevice("+m(t)+")");var r="getSelectedDevice(): ",n=this;if(this._streamProtected){var i=l.WrongStateError("Stream is already in use");this._logger.error(r+m(i));var o=l.composeEvent(i,"GetSelectedDeviceError");return this.emitSimple(o.name,o.data,o.error),void this._sendMetrics(o)}p.isDeviceKind(t.kind)||this._logger.warning(r+'"config.kind" parameter is expected to be a String containg one of the following values: "videoinput" or "audioinput". An error will be thrown on incorrect type/value starting from the WebRTC-Client v.6'),this._deviceController.getDevice(t.kind).then(function(e){return n._logger.info(r+"Selected "+("videoinput"===t.kind?"video":"audio")+" device: "+m(e)),e}).catch(function(e){"NanoError"!==e.type&&(e=l.GeneralError("Failed to get device")),n._logger.error(r+m(e));var t=l.composeEvent(e,"GetSelectedDeviceError");n.emitSimple(t.name,t.data,t.error),n._sendMetrics(t)})},R.startPreview=function(e){var t=g.cloneDeep(e);this._logger.verbose("startPreview("+m(t)+")");var r="startPreview(): ",n=this;if(this._streamProtected){var i=l.WrongStateError("Stream is already in use");this._logger.error(r+m(i));var o=l.composeEvent(i,"StartPreviewError");return this.emitSimple(o.name,o.data,o.error),void this._sendMetrics(o)}if(!S(t)){i=l.TypeNotValidError("config","Object");this._logger.error(r+m(i));o=l.composeEvent(i,"StartPreviewError");return this.emitSimple(o.name,o.data,o.error),void this._sendMetrics(o)}if(!S(t.videoDeviceConfig)){i=l.TypeNotValidError("config.videoDeviceConfig","Object");this._logger.error(r+m(i));o=l.composeEvent(i,"StartPreviewError");return this.emitSimple(o.name,o.data,o.error),void this._sendMetrics(o)}if(!S(t.audioDeviceConfig)){i=l.TypeNotValidError("config.audioDeviceConfig","Object");this._logger.error(r+m(i));o=l.composeEvent(i,"StartPreviewError");return this.emitSimple(o.name,o.data,o.error),void this._sendMetrics(o)}if(p.isVideoSource(t.videoDeviceConfig.source)||this._logger.warning(r+'"config.videoDeviceConfig.source" parameter is expected to be a String containg one of the following values: "camera" or "screen". An error will be thrown on incorrect type/value starting from the WebRTC-Client v.6'),t.videoDeviceConfig.width&&(p.isVideoWidth(t.videoDeviceConfig.width)||this._logger.warning(r+'"config.videoDeviceConfig.width" parameter is expected to be an Integer in range 320 - 3840(4K). An error will be thrown on incorrect type/range starting from the WebRTC-Client v.6')),t.videoDeviceConfig.height&&(p.isVideoHeight(t.videoDeviceConfig.height)||this._logger.warning(r+'"config.videoDeviceConfig.height" parameter is expected to be an Integer in range 240 - 2160(4K). An error will be thrown on incorrect type/range starting from the WebRTC-Client v.6')),t.videoDeviceConfig.framerate&&(p.isFramerate(t.videoDeviceConfig.framerate)||this._logger.warning(r+'"config.videoDeviceConfig.framerate" parameter is expected to be an Integer in range 0 - 60 fps. An error will be thrown on incorrect type/range starting from the WebRTC-Client v.6')),p.isDevice(t.videoDeviceConfig.device)||this._logger.warning(r+'"config.videoDeviceConfig.device" parameter is expected to be a Boolean or an Integer. An error will be thrown on incorrect type/value starting from the WebRTC-Client v.6'),t.audioDeviceConfig.autoGainControl&&!C(t.audioDeviceConfig.autoGainControl)){i=l.TypeNotValidError("config.audioDeviceConfig.autoGainControl","Bool");this._logger.error(r+m(i));o=l.composeEvent(i,"StartPreviewError");return this.emitSimple(o.name,o.data,o.error),void this._sendMetrics(o)}if(t.audioDeviceConfig.echoCancellation&&!C(t.audioDeviceConfig.echoCancellation)){i=l.TypeNotValidError("config.audioDeviceConfig.echoCancellation","Bool");this._logger.error(r+m(i));o=l.composeEvent(i,"StartPreviewError");return this.emitSimple(o.name,o.data,o.error),void this._sendMetrics(o)}if(t.audioDeviceConfig.noiseSuppression&&!C(t.audioDeviceConfig.noiseSuppression)){i=l.TypeNotValidError("config.audioDeviceConfig.noiseSuppression","Bool");this._logger.error(r+m(i));o=l.composeEvent(i,"StartPreviewError");return this.emitSimple(o.name,o.data,o.error),void this._sendMetrics(o)}var s=t.videoDeviceConfig;s.kind="videoinput";var a=t.audioDeviceConfig;a.kind="audioinput";var c=t.elementId,d=!!t.useWebView;this._videoDeviceConfig.height={ideal:s.height},this._videoDeviceConfig.width={ideal:s.width},this._videoDeviceConfig.source=s.source,this._deviceController.setDevice(s).then(function(e){return n._logger.verbose(r+"Selected video device: "+m(e)),n._deviceController.setDevice(a)}).then(function(e){return n._logger.verbose(r+"Selected audio device: "+m(e)),n._getStream(d,!1)}).then(function(e){if(e&&e.stream&&e.stream.data&&e.stream.data.stream){var t=e.stream.data.stream;if(c)v(c).srcObject=t;n._logger.info(r+"StartPreviewSuccess: stream: "+m(e.stream)),e.name="StartPreviewSuccess",e.data=e.stream.data,delete e.stream,n.emitSimple(e.name,e.data),n._sendMetrics(e),e.devices&&(e.name="ReceivedDeviceList",n.emitSimple(e.name,e.devices.data))}}).catch(function(e){"NanoError"!==e.type&&(e=l.GeneralError("Failed to start preview")),n._logger.error(r+m(e));var t=l.composeEvent(e,"StartPreviewError");n.emitSimple(t.name,t.data,t.error),n._sendMetrics(t)})},R.stopPreview=function(){this._logger.verbose("stopPreview()");var e=this;if(this._streamProtected){var t=l.WrongStateError("Stream is already in use"),r=l.composeEvent(t,"StopPreviewError");return this.emitSimple(r.name,r.data,r.error),void this._sendMetrics(r)}this._mediaController.removeLocalMedias().then(function(t){null===t.data.stream&&(t.name="StopPreviewSuccess",e.emitSimple(t.name,t.data),e._sendMetrics(t))}).catch(function(t){"NanoError"!==t.type&&(t=l.GeneralError("Failed to stop preview")),e._logger.error("stopPreview(): "+m(t));var r=l.composeEvent(t,"StopPreviewError");e.emitSimple(r.name,r.data,r.error),e._sendMetrics(r)})},R.muteVideo=function(e){this._logger.verbose("muteVideo("+e+")"),this._logger.warning('"muteVideo()" function is deprecated and will be removed in the WebRTC-Client v.6'),this._mediaController.muteVideoTracks(e)},R.muteAudio=function(e){this._logger.verbose("muteAudio("+e+")"),this._logger.warning('"muteAudio()" function is deprecated and will be removed in the WebRTC-Client v.6'),this._mediaController.muteAudioTracks(e)},R.muteDevice=function(e){var t=g.cloneDeep(e);this._logger.verbose("muteDevice("+m(t)+")");var r=this;this._mediaController.muteTracks(t).catch(function(e){"NanoError"!==e.type&&(e=l.GeneralError("Failed to mute")),r._logger.error("muteDevice(): "+m(e));var t=l.composeEvent(e,"MuteDeviceError");r.emitSimple(t.name,t.data,t.error),r._sendMetrics(t)})},R.injectExternalMediaStream=function(e){var t=g.cloneDeep(e);return this._logger.verbose("injectExternalMediaStream("+m(t)+")"),t&&t.stream?n.isArray(t.tracks)&&t.tracks.length?this._streamProtected?Promise.reject(new Error("Cant inject, stream is already beeing used")):-1!==t.tracks.indexOf("audio")?this._mixExternalAudio(t.stream):Promise.reject(new Error('Mixing in tracks other than "audio" is not supported at the moment')):Promise.reject(new Error("Parameter config.tracks must contain an array with track types to be replaced")):Promise.reject(new Error("You need to provide a stream config object"))},R._listenToBroadcaster=function(e){this._logger.verbose("_listenToBroadcaster()"),e.on("BroadcastStatus",this._onBroadcastStatus.bind(this)),e.on("ReceivedWebRTCStats",this._onReceivedWebRTCStats.bind(this))},R._getStream=function(e,t,r){this._logger.verbose("_getStream("+e+", "+t+", "+m(r)+")");var n=this,i={};return Promise.resolve().then(function(){return t?n._deviceController.enumerateDevices():Promise.resolve()}).then(function(e){if(e&&e.data){if(!e.data.updated)return Promise.reject(r);n._getDevicesSuccess(e)}return n._deviceController.getDevice("videoinput")}).then(function(e){return i.videoinput=e,n._deviceController.getDevice("audioinput")}).then(function(t){return i.audioinput=t,n._mediaController.getMediaForDevices(i,e)}).catch(function(r){return"OverconstrainedError"===r.name&&r.userinfo&&"deviceId"===r.userinfo.constraint&&r.userinfo.retry&&!t?n._getStream(e,!0,r):Promise.reject(r)})},R._mixExternalAudio=function(e){if(this._logger.verbose("_mixExternalAudio("+m(e)+")"),!e)return Promise.reject(new Error("No external stream passed"));var t,r,n=this;return Promise.resolve(this._mediaController.getLocalMedias()[0]).then(function(e){if(e&&e[0])return e[0];throw new Error("No local stream")}).then(function(e){if((r=(t=e).getAudioTracks()).length>0)return n._audioMixer.connect(t,0);throw new Error("Local stream has no audio")}).then(function(){return n._audioMixer.connect(e,1)}).then(function(){return n._audioMixer.getOutputStream()}).then(function(e){var n=r[0],i=e.getAudioTracks()[0];t.removeTrack(n),t.addTrack(i)}).catch(function(e){throw n._logger.error("_mixExternalAudio(): Could not mix audioTracks: "+e),e})},R._sendMetrics=function(e){this._metricsController&&this._metricsController.onEvent(e)},R._destroy=function(){this._logger.verbose("destroy()");var e=this;e._broadcaster&&e._broadcaster.stop().catch(function(t){e._logger.verbose(t)}).then(function(){e._broadcaster=void 0}),e._chatRoom&&e._chatRoom.destroy().catch(function(t){e._logger.verbose("_destroy(): "+m(t))}).then(function(){e._chatRoom=void 0})},R._onBroadcastStatus=function(e){this._logger.verbose("_onBroadcastStatus("+m(e)+")");var r={name:"BroadcastStatus"};switch(e.data.state){case t.BROADCAST_STATE.INITIALIZED:case t.BROADCAST_STATE.STARTED:case t.BROADCAST_STATE.SIGNALING:case t.BROADCAST_STATE.CONNECTED:case t.BROADCAST_STATE.RECONNECTING:case t.BROADCAST_STATE.STOPPED:r.data=e.data;break;case t.BROADCAST_STATE.BROADCASTING:r.data=e.data,this._isBroadcasting=!0;break;case t.BROADCAST_STATE.DISCONNECTED:return r.name="BroadcastError",r.error=l.BroadcastError("Broadcast got disconnected"),this.emitSimple(r.name,r.data,r.error),this._sendMetrics(r),this._isBroadcasting=!1,this._broadcaster.destroy(),void(this._broadcaster=void 0);case t.BROADCAST_STATE.FAILED:return this._isBroadcasting?(r.name="BroadcastError",r.error=l.BroadcastError("Unknown reason")):(r.name="StartBroadcastError",r.error=l.StartBroadcastError("Unknown reason")),this.emitSimple(r.name,r.data,r.error),this._sendMetrics(r),this._isBroadcasting=!1,this._broadcaster.destroy(),void(this._broadcaster=void 0)}this.emitSimple(r.name,r.data,r.error),this._sendMetrics(r)},R._onRemoteStreamAdded=function(e){this._logger.verbose("_onRemoteStreamAdded("+m(e)+")"),e.data.stream&&e.data.stream.id;for(var t=this._mediaController.getRemoteMedias(),r=0;r<t.length;r++){var n=t[r];if(n.stream.id===e.data.stream)return void this.emitSimple("CallActive",{data:n})}e.name="RemoteStreamError",this.emitSimple(e.name,e)},R._onReceivedWebRTCStats=function(e){if(this._logger.verbose("_onReceivedWebRTCStats("+m(e)+")"),this._metricsController){var t=JSON.parse(JSON.stringify(e));this._metricsController.onEvent(t)}e.data&&e.data.results&&e.data.results.extended&&!T(e.data.results.extended)&&delete e.data.results.extended,this.emitSimple(e.name,e.data,e.error)},R._onSessionMessage=function(e){this._logger.verbose("_onSessionMessage("+m(e)+")");switch(e.type){case"close":if(this._destroy(),"disconnect"===e.reason){var t=l.ServerError("disconnect");this._logger.error("_onSessionMessage(): "+m(t));var r=l.composeEvent(t,"ServerError");this.emitSimple(r.name,r.data,r.error),this._sendMetrics(r)}}},R._onRoomUpdate=function(e){switch(this._logger.verbose("_onRoomUpdate("+m(e)+")"),e.type){case"room_update":this._streamProtected=!!this._chatRoom.getUsersCount()||this._isBroadcasting,this.emitSimple("PeerListUpdated",{data:e.data});break;case"call_incoming":this.emitSimple("CallIncoming",{data:e.data});break;case"call_declined":this._streamProtected=!!this._chatRoom.getUsersCount()||this._isBroadcasting,this.emitSimple("CallDeclined",{data:e.data})}},R._onStreamTrackEnded=function(e){this._logger.verbose("_onStreamTrackEnded("+m(e)+")"),this.emitSimple("StreamTrackEnded",{data:e})},R._getDevicesSuccess=function(e){this._logger.info("_getDevicesSuccess("+m(e)+")"),this.emitSimple("ReceivedDeviceList",e.data)},R._getDevicesError=function(e){this._logger.error("_getDevicesError("+m(e)+")"),this.emitSimple("GetDevicesError",e.data,e.error),this._sendMetrics(e)},w}.apply(t,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r(19),r(47),r(6),r(5),r(0),r(50),r(3),r(2)],void 0===(i=function(e,t,r,n,i,o,s,a){"use strict";var c=i.isString,d=i.isIntString,u=i.stringifyJSON,l=i.isObject,p=i.isArray,f=i.isFunction,h=r.BROADCAST_STATE;function g(e,t){if(n.call(this),this._logger=a.create("Broadcaster","console"),this._logger.verbose("Broadcaster("+e+")"),d(e)||this._logger.error("Param userId must be an integer"),!t||!t||!f(t.signIn))throw s.TypeNotValidError("session","Session");this._userId=e,this._remoteUserId=e,this._peerId=void 0,this._remotePeerId=void 0,this._remoteUserName="webrtc2H264",this._pcClient=void 0,this._streams=[],this._transcodingSettings={output:null,streamname:null,videobitrate:null,videowidth:null,videoheight:null,targetvideowidth:null,targetvideoheight:null,source:null,ismobile:null,audiobitrate:null,framerate:null,dropframes:null,h264passthrough:1,icecast_audio:null,icecast_event_id:null,rtmpconnectinfo:null},this._startTime=null,this._iceServers=[],this._config={},this._state=h.IDLE,this._sdpAnswerSent=!1,this._messageQueueRemote=[],this._messageQueueLocal=[],this._remoteStream=null,this._statsEnabled=!1,this._statsIntervalTime=1e3,this._statsInterval=0,this._rtcStats=null,this._session=t}var v=g.prototype=Object.create(n.prototype);return v.setIceServers=function(e){this._iceServers=e},v.setConfig=function(e){this._config=e},v.getState=function(){return this._state},v.getPeerId=function(){return this._peerId},v.setTranscodingSettings=function(e){var t;for(t in e)Object.prototype.hasOwnProperty.call(this._transcodingSettings,t)&&(this._transcodingSettings[t]=e[t])},v.start=function(){this._logger.verbose("start()");var e,t=this;return this._session.startBroadcast(this._getBroadcastParameters()).then(function(r){return t._peerId=r.peer_id,t._setState(h.INITIALIZED),e="receiver_peer_"+t._peerId,t._session.on(e,t._onServerMessage.bind(t)),t._transcodingSettings.output||(t._transcodingSettings.output=r.output),t._transcodingSettings.streamname||(t._transcodingSettings.streamname=r.stream_name),Promise.resolve({data:{output:t._transcodingSettings.output,streamname:t._transcodingSettings.streamname}})}).catch(function(e){return t._setState(h.FAILED),Promise.reject(e)})},v.stop=function(){this._logger.verbose("stop()");var e=this;return e._stopCollectRtcStats(),e._peerId&&e._remotePeerId?e._session.isSignedIn()?this._session.stopBroadcast({sender_peer:this._peerId,receiver_peer:this._remotePeerId}).then(function(){var t="receiver_peer_"+e._peerId;return e._session.removeEvent(t),t="receiver_peer_"+e._remotePeerId,e._session.removeEvent(t),e.destroy(),e._logger.verbose("stop(): Broadcast stopped"),Promise.resolve({data:{output:e._transcodingSettings.output,streamname:e._transcodingSettings.streamname}})}).catch(function(t){return t&&"NanoError"===t.type&&e._logger.error(s.StopBroadcastError("Stopping broadcast failed: "+t)),e.destroy(),e._logger.verbose("stop(): Broadcast stopped"),Promise.reject(t)}):(e.destroy(),Promise.resolve()):Promise.reject(s.StopBroadcastError("Not connected to any peer"))},v.addStream=function(e){this._logger.verbose("addStream()");e?2!==this._streams.length?p(e)?this._streams=e:this._streams.push(e):this._logger.warning("addStream(): [_peerId: r "+this._peerId+"] Stream count is already = 2, we only support 2 streams/Broadcaster"):this._logger.error("addStream(): [_peerId: "+this._peerId+'] Parameter "stream" must not be undefined')},v.sendMetaData=function(e,t){this._logger.verbose("sendMetaData()");if(this.getState()===h.BROADCASTING){this._logger.verbose("sendMetaData(): [_peerId: "+this._peerId+"] Sending metaData: "+e+" - "+u(t));var r={eventType:"metaData",eventName:e,strLabel:this._streams[0].id,payload:t},n={sender_peer:this._peerId,receiver_peer:this._remotePeerId,data:r};return this._session.sendMetaData(n)}var i="[_peerId: "+this._peerId+"] Tried to send metaData but Broadcaster is not in active state";return this._logger.error(i),Promise.reject(i)},v.enableStats=function(e,t){this._logger.verbose("enableStats()"),this._statsEnabled=void 0===e||e,this._statsIntervalTime=t||1e3,this._rtcStats=null,this._statsEnabled&&(this._rtcStats=new o,this._rtcStats.on("ReceivedWebRTCStats",this._reemit.bind(this)))},v.destroy=function(){this._logger.verbose("destroy()"),this._unbind(),this._closePCClient(),this._messageQueueRemote=[],this._messageQueueLocal=[],this._sdpAnswerSent=!1,this._setState(h.STOPPED),a.delete(this._logger)},v._getBroadcastParameters=function(){this._logger.verbose("_getBroadcastParameters()");var e,t={};for(e in t.peer=this._peerId,this._transcodingSettings){var r=this._transcodingSettings[e];null!==r&&((l(r)||c(r))&&(r=u(r)),t[e.toString()]=r.toString())}return t.jwt=this._config.jwt,t.stream_label=this._streams[0]&&this._streams[0].id?this._streams[0].id:"",t.stream_label2=this._streams[1]&&this._streams[1].id?this._streams[1].id:"",t.videocodec=this._config.codecs.videoCodec?this._config.codecs.videoCodec:"H264",t.audio=this._streams[0].getAudioTracks().length>0?"1":"0",t.video=this._streams[0].getVideoTracks().length>0?"1":"0",t},v._onServerMessage=function(e){this._logger.verbose("_onServerMessage()");var t="_onServerMessage(): ",r=this;switch(e.type){case"transcoder_message":"started"===e.state?r._pcClient?r._logger.error(t+"We should not have a pcClient at this moment"):(r._createPCClient(),r._pcClient.startAsCallee(r._messageQueueRemote),r._setState(h.STARTED)):"disconnected"===e.state&&(r._setState(h.DISCONNECTED),r._logger.verbose(t+"Disconnected"));break;case"sdp_message":if(!e.sender_peer)return void r._logger.error(t+"Received sdp_message, but message has no sender_peer");r._remotePeerId=e.sender_peer,r._pcClient&&r._pcClient.isStarted()?r._pcClient.setRemoteDescription(e.data.sdp).catch(function(e){return r._logger.error(t+"setRemoteDescription failed: "+e),Promise.reject(e)}).then(function(){return r._logger.verbose(t+"setRemoteDescription succeded"),r._pcClient.doAnswer()}).catch(function(e){return r._logger.error(t+"doAnswer failed:"+e),Promise.reject(e)}).then(function(e){r._logger.verbose(t+"doAnswer succeded: "+u(e));var n={};return n.sender_peer=r._peerId,n.receiver_peer=r._remotePeerId,n.data=e,r.emitSimple("SDPAnswer",n),r._session.sendSignalingMessage(n).then(function(){r._sdpAnswerSent=!0}).catch(function(e){r._logger.error(t+"sendSignalingMessage (answer) failed: "+e)})}).catch(function(e){r._logger.error(t+"sendSignalingMessage failed: "+e)}):r._messageQueueRemote.push(e.data.sdp);break;case"ice_candidate":r._pcClient&&r._pcClient.isStarted()?r._pcClient.addIceCandidate(e.data.candidate):r._messageQueueRemote.push(e.data.candidate);break;case"rtmp_status":r._logger.verbose(t+"Received rtmp status: "+u(e.data)),e.data&&"status"===e.data.status&&("connected"===e.data.message?r._setState(h.BROADCASTING):"reconnecting"===e.data.message&&r._setState(h.RECONNECTING)),e.data&&"error"===e.data.status&&4711===e.data.number&&r._setState(h.FAILED);var n=r._addEventPayload({data:e.data});r.emit("BroadcastStatus",n);break;case"server_error":r._setState(h.FAILED),r._logger.error(t+"Server error: "+e.error);break;default:r._logger.verbose(t+"Unknown message:"+e)}},v._addEventPayload=function(e){return(e=e||{}).data=e.data||{},e.data.streamname=this._transcodingSettings.streamname,e.data.state=this._state,e.data.message=i.getKeyByValue(h,this._state).toLowerCase(),e.data.text=e.data.message,e},v._reemit=function(e){e=this._addEventPayload(e),this.emit(e.name,e)},v._collectRtcStats=function(){this._logger.verbose("_collectRtcStats()");var e=this,t=e._config.extended;clearInterval(e._statsInterval),this._statsInterval=setInterval(function(){if(e._pcClient){var r=void 0,n=e._getBroadcastParameters();if("1"===n.video&&"0"===n.audio)r="video";else if("0"===n.video&&"1"===n.audio)r="audio";else if("0"===n.video&&"0"===n.audio)return void e._logger.error('_collectRtcStatsAttempts to show stats for "no video" and "no audio" stream');e._pcClient.getStats(r).then(function(n){e._rtcStats||(e._rtcStats=new o),e._rtcStats.putReport(n,r,t)}).catch(function(t){e._logger.error("_collectRtcStats[_peerId: "+e._peerId+"] "+t)})}else clearInterval(e._statsInterval)},this._statsIntervalTime)},v._stopCollectRtcStats=function(){this._logger.verbose("_stopCollectRtcStats()");this._statsInterval&&(this._logger.verbose("_stopCollectRtcStats(): Stopping rtc stats collection"),this._rtcStats.removeEvent("ReceivedWebRTCStats"),clearInterval(this._statsInterval),this._rtcStats=null)},v._getPeerConnectionConfig=function(){this._logger.verbose("_getPeerConnectionConfig()");var e={iceServers:this._iceServers,iceTransports:"all"},t={optional:[],mandatory:[]};return t.optional.push({googCpuOveruseDetection:!1}),t.optional.push({RtpDataChannels:!1}),{mediaConstraints:{audio:!0,video:!0},sdpPatches:this._config.sdpPatches,encoding:this._config.encoding,peerConnectionConfig:e,peerConnectionConstraints:t,send:0!==this._streams.length,receive:!1,audioSendBitrate:this._config.bitrates.audioSendBitrate||0,videoSendCodec:this._config.codecs.videoCodec||"H264",videoRecvCodec:this._config.codecs.videoCodec||"H264",videoSendBitrate:this._config.bitrates.videoSendBitrate||0,videoSendInitialBitrate:this._config.bitrates.videoSendInitialBitrate||0}},v._createPCClient=function(){this._logger.verbose("_createPCClient()");var e="_createPCClient(): ";if(this._pcClient)this._logger.verbose(e+"[_peerId:  "+this._peerId+"] PeerConnection still alive, do not create!");else try{if(this._pcClient=new t(this._getPeerConnectionConfig(),this._startTime),"object"==typeof callstats&&callstats&&callstats.fabricUsage){try{var r=callstats.fabricUsage.multiplex,n=this._remoteUserName,i=this._remoteUserName+"_"+this._peerId+"_"+this._userId+"__"+this._remotePeerId+"_"+this._remoteUserId;callstats.addNewFabric(this._pcClient._pc,n,r,i,function(t,r){this._logger.verbose(e+"Callstats Monitoring status: "+t+" msg: "+r)})}catch(t){this._logger.warning(e+"Error in callstats")}}this._bind();for(var o=0;o<this._streams.length;o++)this._pcClient.addStream(this._streams[o]);this._logger.verbose(e+"Created PeerConnectionClient")}catch(t){this._logger.error(e+"[_peerId: "+this._peerId+"] Create PeerConnection exception: "+t.message),this.emitSimple("CreatePeerConnectionClientError")}},v._bind=function(){this._logger.verbose("_bind()"),this._pcClient.on("SignalingMessage",this._onSignalingMessage.bind(this)),this._pcClient.on("RemoteStreamRemoved",this._onRemoteStreamRemoved.bind(this)),this._pcClient.on("RemoteStreamAdded",this._onRemoteStreamAdded.bind(this)),this._pcClient.on("IceConnectionStateChange",this._onIceConnectionStateChange.bind(this)),this._pcClient.on("EndOfLocalCandidates",this._onEndOfLocalCandidates.bind(this)),this._pcClient.on("NegotiationNeeded",this._onNegotiationNeeded.bind(this))},v._unbind=function(){this._logger.verbose("_unbind()"),this._pcClient&&(this._pcClient.off("SignalingMessage",this._onSignalingMessage.bind(this)),this._pcClient.off("RemoteStreamRemoved",this._onRemoteStreamRemoved.bind(this)),this._pcClient.off("RemoteStreamAdded",this._onRemoteStreamAdded.bind(this)),this._pcClient.off("IceConnectionStateChange",this._onIceConnectionStateChange.bind(this)),this._pcClient.off("EndOfLocalCandidates",this._onEndOfLocalCandidates.bind(this)),this._pcClient.off("NegotiationNeeded",this._onNegotiationNeeded.bind(this)))},v._setState=function(e){if(e!==this._state){var t=this._state;this._state=e,this._logger.verbose("_setState(): State: "+i.getKeyByValue(h,t)+" -> "+i.getKeyByValue(h,this._state))}},v._onIceConnectionStateChange=function(e){this._logger.verbose("_onIceConnectionStateChange("+u(e)+")");switch(this._logger.verbose("_onIceConnectionStateChange(): Ice connection state: "+e.data.state),e.data.state){case"new":case"checking":this._setState(h.SIGNALING);break;case"connected":case"completed":if(this._setState(h.CONNECTED),this._statsEnabled&&this._pcClient&&this._collectRtcStats(),this._config&&this._config.bitrates)"Microsoft Edge"!==i.browserInfo.browser?this._pcClient.updateEncodingSettings(this._config.bitrates.audioSendBitrate||0,this._config.bitrates.videoSendBitrate||0):this._logger.warning("Setting bitrate is not supported in Microsoft Edge");break;case"failed":this._setState(h.FAILED),this._statsEnabled&&this._pcClient&&this._stopCollectRtcStats();break;case"disconnected":this._setState(h.DISCONNECTED);break;case"closed":this._setState(h.STOPPED)}e=this._addEventPayload(e),this.emit("BroadcastStatus",e)},v._onNegotiationNeeded=function(e){this._logger.verbose("NegotiationNeeded event has been fired")},v._onEndOfLocalCandidates=function(e){this._logger.verbose("_onEndOfLocalCandidates()")},v._onRemoteStreamAdded=function(e){this._logger.verbose("_onRemoteStreamAdded()"),this._remoteStream=e.data.stream},v._onRemoteStreamRemoved=function(e){this._logger.verbose("_onRemoteStreamRemoved()"),this._remoteStream=null},v._closePCClient=function(){this._logger.verbose("_closePCClient()");if(this._pcClient){var e,t,r=this._streams;for(e=0,t=r.length;e<t;++e)try{this._pcClient.removeStream(r[e])}catch(e){this._logger.error("_closePCClient(): [_peerId: "+this._peerId+"] Could not remove stream from peerconnectionclient")}this._pcClient.close(),this._pcClient=null}},v._sendMessageToPeer=function(e){this._logger.verbose("_sendMessageToPeer()");var t="_sendMessageToPeer(): ",r=this,n={},i=void 0;return this._remotePeerId&&c(this._remotePeerId)||(i=this._remotePeerId?s.TypeNotValidError("_remotePeerId","String"):s.ObjectNotExistError("_remotePeerId","String")),this._peerId&&c(this._peerId)||(i=this._peerId?s.TypeNotValidError("_peerId","String"):s.ObjectNotExistError("_peerId","String")),l(e)||(i=s.TypeNotValidError("message","Object")),i?(this._logger.error(t+u(i)),Promise.reject(i)):(n.sender_peer=this._peerId,n.receiver_peer=this._remotePeerId,n.data=e,n.data&&""===n.data.candidate?Promise.resolve():this._session.sendSignalingMessage(n).catch(function(e){return r._logger.error(t+u(e)),Promise.reject(e)}))},v._onSignalingMessage=function(e){this._logger.verbose("_onSignalingMessage - "+u(e.data));var t="_onSignalingMessage(): ",r=this;if(this._remotePeerId){if(this._sdpAnswerSent&&this._messageQueueLocal.length>0)for(this._logger.debug(t+"answer sent, sending enqueued messages, count: "+this._messageQueueLocal.length);this._messageQueueLocal.length>0;){var n=this._messageQueueLocal.shift();n&&this._sendMessageToPeer(n).catch(function(e){r._logger.error(t+u(e))})}if(!this._sdpAnswerSent)return this._logger.debug(t+"answer not sent yet, enqueueing message."),void this._messageQueueLocal.push(e.data);this._sendMessageToPeer(e.data).then(function(){}).catch(function(e){r._logger.error(t+u(e))})}else this._logger.error(t+"Trying to send message, but no remote peer set! This should not happen!")},g}.apply(t,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r(5),r(0),r(3),r(2)],void 0===(i=function(e,t,r,n){"use strict";var i=t.isString,o=t.stringifyJSON,s=t.isObject,a=t.isInt,c=t.isFunction,d=0,u={IDLE:1,CONNECTED:2,CLOSED:3};function l(){this._websocket=void 0,this._url=void 0,this._callback=void 0,this._state=u.IDLE,this._resolvers={},this._logger=n.create("WebsocketClient","console")}var p=l.prototype;return p.connect=function(e,t){if(this._logger.verbose("connect()"),!i(e))return Promise.reject(r.TypeNotValidError("url","String"));if(!c(t))return Promise.reject(r.TypeNotValidError("callback","Function"));if(this._state!==u.IDLE&&this._state!==u.CLOSED)return Promise.reject(r.WrongStateError());this._url=e,this._callback=t;var n=this;try{this._websocket=new WebSocket(this._url)}catch(e){return Promise.reject(r.CreateWebSocketError("Creating websocket failed",this._url))}return this._websocket.onclose=function(e){n._onClose(e)},this._websocket.onmessage=function(e){n._onMessage(e)},this._websocket.onerror=function(e){n._onError(e)},this._websocket.onopen=function(e){n._onOpen(e)},this._createResolver("connect")},p.close=function(){var e;return this._logger.verbose("close()"),this._websocket?(e=this._createResolver("close"),this._websocket.close(),this._setState(u.CLOSED),this._websocket=void 0):e=Promise.reject(r.WebSocketError("No websocket",this._url)),e},p.sendMessage=function(e,t){if(this._logger.verbose("sendMessage("+e+", "+o(t)+")"),!i(e))return Promise.reject(r.TypeNotValidError("type","String"));if(!s(t))return Promise.reject(r.TypeNotValidError("message","Object"));if(!this._websocket||this._websocket.readyState>1)return Promise.reject(r.WebSocketError("Sending message failed",this._url));var n=d++,a=this._createResolver(n);return this._websocket.send(o({type:e,message:t,message_id:n})),a},p._setState=function(e){this._logger.verbose("_setState("+e+")");if(e!==this._state){var r=this._state;this._state=e;var n="_setState(): State: "+t.getKeyByValue(u,r)+" -> "+t.getKeyByValue(u,this._state);this._logger.verbose(n)}},p._onOpen=function(e){this._logger.verbose("_onOpen("+o(e)+")"),this._setState(u.CONNECTED),this._resolve("connect",{event:e})},p._onClose=function(e){this._logger.verbose("_onClose("+o(e)+")"),this._setState(u.CLOSED),this._resolve("close",{type:e.type,code:e.code})},p._onMessage=function(e){this._logger.verbose("_onMessage("+o(e.data)+")");var t,r;if(e&&e.data){try{t=JSON.parse(e.data)}catch(e){return void this._logger.error("_onMessage(): "+o(e))}r=t.message_id,this._resolve(r,t)}else this._logger.error('_onMessage(): event has no "data" property')},p._onError=function(e){this._logger.error("_onError("+o(e)+")"),this._resolve("connect",{event:e})},p._createResolver=function(e){if(this._logger.verbose("_createResolver("+e+")"),!a(e)&&!i(e))return Promise.reject("resolver error"+e);var t,r,n=new Promise(function(e,n){t=e,r=n});return this._resolvers[e]={resolve:t,reject:r},n},p._resolve=function(e,t){this._logger.verbose("_resolve("+e+", "+o(t)+")");var n="_resolve(): ",i=this._resolvers[e];if(i){if(this._logger.verbose(n+"Message id: "+e),delete this._resolvers[e],t&&t.event&&"error"===t.event.type&&"connect"===e)return i.reject(r.WebSocketError("Could not connect to server, please check server url",this._url));t.error?(this._logger.verbose(n+"Rejecting id: "+e),i.reject(t.error)):(this._logger.verbose(n+"Resolving id: "+e),i.resolve(t))}else this._logger.verbose(n+"Passive message"),this._callback(t)},l}.apply(t,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r(0),r(46)],void 0===(i=function(e,t){"use strict";var r=e.stringifyJSON,n=e.isString;return function(e,i,o,s,a,c){this._globalPrefix=e,this._level=i,this._url=o,this._credentials={accountId:s,accountKey:a},this._id=c,this._logger=new t(e,"GrayLogger",i),this._logger.verbose("GrayLogger("+e+", "+i+", "+o+")");var d=0,u={};this.send=function(e,t){this._logger.verbose("send("+e+", "+r(t)+")");var i="send(): ",o=this;if(n(this._credentials.accountId)&&(""!==this._credentials.accountId||n(this._credentials.accountKey))&&""!==this._credentials.accountKey)try{d+=1;var s=new XMLHttpRequest;if(u[d]=s,s.open("POST",o._url+o._credentials.accountKey,!0),s.onreadystatechange=function(e,t){if(this&&4===this.readyState){var r=this.status>=400?"fail":this.status>=200?"success":"unknown";o._done.call(o,e,t,r)}}.bind(s,d,e),void 0!==t){if("string"==typeof t)try{t=JSON.parse(t)}catch(e){this._logger.error(i+r(e)),t=null}if("object"==typeof t)try{t=JSON.stringify(t),setTimeout(o._done.bind(o,d,e,"suspend"),5e3),s.send(t)}catch(e){this._logger.error(i+r(e)),o._done.call(o,d,"catch "+e.message)}}else this._logger.verbose(i+'"data" is undefined and will not be sent')}catch(e){this._logger.error(i+r(e)),o._done.call(o,d,"catch "+e.message)}else o._logger.verbose(i+"No credentials is set; graylogger is disabled. Returning")},this.destroy=function(){for(var e in this._logger.verbose("destroy()"),u)if(Object.prototype.hasOwnProperty.call(u,e)){var t=u[e];"function"==typeof t.onreadystatechange&&(t.onreadystatechange=null),delete u[e]}},this._done=function(e,t,r){if(this._logger.verbose("_done("+e+", "+t+", "+r+")"),void 0!==u[e]){var n=u[e];"function"==typeof n.onreadystatechange&&(n.onreadystatechange=null),delete u[e]}}}}.apply(t,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r(6),r(48),r(0),r(2),r(3)],void 0===(i=function(e,t,r,n,i){"use strict";var o=r.isInt,s=r.isObject,a=r.stringifyJSON,c=r.browserInfo,d={_logger:n.create("EncodingUtils","console"),setSenderBitrates:function(e,t){d._logger.verbose("setSenderBitrates("+a(e)+", "+a(t)+")");var r="setSenderBitrates(): ";if(!(e&&e instanceof window.RTCPeerConnection)){var n=i.TypeNotValidError("peerConnection","RTCPeerConnection");return d._logger.error(r+JSON.stringify(n)),Promise.reject(n)}if(!s(t)){n=i.TypeNotValidError("bitrates","Object");return d._logger.error(r+JSON.stringify(n)),Promise.reject(n)}var u=parseInt(c.browserVersion,10);if(("Chrome"===c.browser||"Firefox"===c.browser&&u>=64||"Safari"===c.browser&&u>=13)&&"RTCRtpSender"in window&&"setParameters"in window.RTCRtpSender.prototype)return Promise.resolve().then(function(){if(o(t.video)){var n=d.getVideoSenders(e)[0];if(n)return d.setVideoSenderMaxBitrate(n,t.video);d._logger.verbose(r+'No sender of type "video" in peerconnection, skipping')}}).catch(function(e){d._logger.warning(r+e)}).then(function(){if(o(t.audio)){var n=d.getAudioSenders(e)[0];if(n)return d.setAudioSenderMaxBitrate(n,t.audio);d._logger.verbose(r+'No sender of type "audio" in peerconnection, skipping')}}).catch(function(e){d._logger.warning(r+e)});n=i.GeneralError("Can not set bitrates on RTCRtpSender, browser not supported");return d._logger.error(r+JSON.stringify(n)),Promise.reject(n)},setAudioSenderMaxBitrate:function(e,t){d._logger.verbose("setAudioSenderMaxBitrate("+e+", "+t+")");var r=e.getParameters();return(!r.encodings||r.encodings.length<=0)&&(r.encodings=[{}]),0===t?delete r.encodings[0].maxBitrate:r.encodings[0].maxBitrate=1e3*t,e.setParameters(r)},setVideoSenderMaxBitrate:function(e,t){d._logger.verbose("setVideoSenderMaxBitrate("+e+", "+t+")");var r=e.getParameters();return(!r.encodings||r.encodings.length<=0)&&(r.encodings=[{}]),0===t?delete r.encodings[0].maxBitrate:r.encodings[0].maxBitrate=1e3*t,e.setParameters(r)},getAudioSenders:function(e){return e.getSenders().filter(function(e){return e.track&&"audio"===e.track.kind})},getVideoSenders:function(e){return e.getSenders().filter(function(e){return e.track&&"video"===e.track.kind})},setDegradationPreference:function(e,t){},setSDPAudioOptions:function(e,t){parseInt(c.browserVersion,10);return t&&(t.bitrate&&(e.sdp=setCodecParam(sdp,"opus/48000","maxaveragebitrate",t.bitrate)),!0===t.cbr&&(e.sdp=setCodecParam(sdp,"opus/48000","cbr",1)),!0===t.stereo&&(e.sdp=maybeSetOpusOptions(e.sdp,{opusStereo:"true"}))),e}};return d}.apply(t,n))||(e.exports=i)},function(e,t,r){"use strict";window.mergeConstraints=function(e,t){if(!e||!t)return e||t;var r=e;for(var n in t)r[n]=t[n];return r},window.iceCandidateType=function(e){return e.split(" ")[7]},window.maybeSetOpusOptions=function(e,t){return"true"===t.opusStereo?e=setCodecParam(e,"opus/48000","stereo","1"):"false"===t.opusStereo&&(e=removeCodecParam(e,"opus/48000","stereo")),"true"===t.opusFec?e=setCodecParam(e,"opus/48000","useinbandfec","1"):"false"===t.opusFec&&(e=removeCodecParam(e,"opus/48000","useinbandfec")),"true"===t.opusDtx?e=setCodecParam(e,"opus/48000","usedtx","1"):"false"===t.opusDtx&&(e=removeCodecParam(e,"opus/48000","usedtx")),t.opusMaxPbr&&(e=setCodecParam(e,"opus/48000","maxplaybackrate",t.opusMaxPbr)),e},window.maybeSetAudioSendBitRate=function(e,t){return t.audioSendBitrate?(trace("Prefer audio send bitrate: "+t.audioSendBitrate),preferBitRate(e,t.audioSendBitrate,"audio")):e},window.maybeSetAudioReceiveBitRate=function(e,t){return t.audioRecvBitrate?(trace("Prefer audio receive bitrate: "+t.audioRecvBitrate),preferBitRate(e,t.audioRecvBitrate,"audio")):e},window.maybeSetVideoSendBitRate=function(e,t){return t.videoSendBitrate?(trace("Prefer video send bitrate: "+t.videoSendBitrate),preferBitRate(e,t.videoSendBitrate,"video")):e},window.maybeSetVideoReceiveBitRate=function(e,t){return t.videoRecvBitrate?(trace("Prefer video receive bitrate: "+t.videoRecvBitrate),preferBitRate(e,t.videoRecvBitrate,"video")):e},window.preferBitRate=function(e,t,r){var n=e.split("\r\n"),i=findLine(n,"m=",r);if(null===i)return trace("Failed to add bandwidth line to sdp, as no m-line found"),e;var o=findLineInRange(n,i+1,-1,"m=");null===o&&(o=n.length);var s=findLineInRange(n,i+1,o,"c=");if(null===s)return trace("Failed to add bandwidth line to sdp, as no c-line found"),e;var a=findLineInRange(n,s+1,o,"b=AS");a&&n.splice(a,1);var c="b=AS:"+t;return n.splice(s+1,0,c),e=n.join("\r\n")},window.maybeSetVideoSendInitialBitRate=function(e,t){var r=parseInt(t.videoSendInitialBitrate);if(!r)return e;var n=parseInt(r),i=parseInt(t.videoSendBitrate);i&&(r>i&&(trace("Clamping initial bitrate to max bitrate of "+i+" kbps."),r=i,t.videoSendInitialBitrate=r),n=i);var o=e.split("\r\n"),s=findLine(o,"m=","video");if(null===s)return trace("Failed to find video m-line"),e;var a=o[s],c=new RegExp("m=video\\s\\d+\\s[A-Z/]+\\s"),d=a.split(c)[1].split(" ")[0],u=o[findLine(o,"a=rtpmap",d)].split("a=rtpmap:"+d)[1].split("/")[0],l=t.videoSendCodec||u;return e=setCodecParam(e,l,"x-google-min-bitrate",t.videoSendInitialBitrate.toString()),e=setCodecParam(e,l,"x-google-max-bitrate",n.toString())},window.removePayloadTypeFromMline=function(e,t){e=e.split(" ");for(var r=0;r<e.length;++r)e[r]===t.toString()&&e.splice(r,1);return e.join(" ")},window.removeCodecByName=function(e,t){var r=findLine(e,"a=rtpmap",t);if(null===r)return e;var n=getCodecPayloadTypeFromLine(e[r]);e.splice(r,1);var i=findLine(e,"m=","video");return null===i?e:(e[i]=removePayloadTypeFromMline(e[i],n),e)},window.removeCodecByPayloadType=function(e,t){var r=findLine(e,"a=rtpmap",t.toString());if(null===r)return e;e.splice(r,1);var n=findLine(e,"m=","video");return null===n?e:(e[n]=removePayloadTypeFromMline(e[n],t),e)},window.maybeRemoveVideoFec=function(e,t){if("false"!==t.videoFec)return e;var r=e.split("\r\n"),n=findLine(r,"a=rtpmap","red");if(null===n)return e;var i=getCodecPayloadTypeFromLine(r[n]);if(r=removeCodecByPayloadType(r,i),r=removeCodecByName(r,"ulpfec"),null===(n=findLine(r,"a=fmtp",i.toString())))return e;var o=parseFmtpLine(r[n]).pt;return null===o?e:(r.splice(n,1),(r=removeCodecByPayloadType(r,o)).join("\r\n"))},window.maybePreferAudioSendCodec=function(e,t){return maybePreferCodec(e,"audio","send",t.audioSendCodec)},window.maybePreferAudioReceiveCodec=function(e,t){return maybePreferCodec(e,"audio","receive",t.audioRecvCodec)},window.maybePreferVideoSendCodec=function(e,t){return maybePreferCodec(e,"video","send",t.videoSendCodec)},window.maybePreferVideoReceiveCodec=function(e,t){return maybePreferCodec(e,"video","receive",t.videoRecvCodec)},window.maybePreferCodec=function(e,t,r,n){var i=t+" "+r+" codec";if(!n)return trace("No preference on "+i+"."),e;trace("Prefer "+i+": "+n);var o=e.split("\r\n"),s=findLine(o,"m=",t);if(null===s)return e;for(var a=null,c=o.length-1;c>=0;--c){var d=findLineInRange(o,c,0,"a=rtpmap",n,"desc");if(null===d)break;c=d,(a=getCodecPayloadTypeFromLine(o[d]))&&(o[s]=setDefaultCodec(o[s],a))}return e=o.join("\r\n")},window.setCodecParam=function(e,t,r,n){var i=e.split("\r\n"),o=findFmtpLine(i,t),s={};if(null===o){var a=findLine(i,"a=rtpmap",t);if(null===a)return e;var c=getCodecPayloadTypeFromLine(i[a]);s.pt=c.toString(),s.params={},s.params[r]=n,i.splice(a+1,0,writeFmtpLine(s))}else(s=parseFmtpLine(i[o])).params[r]=n,i[o]=writeFmtpLine(s);return e=i.join("\r\n")},window.removeCodecParam=function(e,t,r){var n=e.split("\r\n"),i=findFmtpLine(n,t);if(null===i)return e;var o=parseFmtpLine(n[i]);delete o.params[r];var s=writeFmtpLine(o);return null===s?n.splice(i,1):n[i]=s,e=n.join("\r\n")},window.parseFmtpLine=function(e){var t={},r=e.indexOf(" "),n=e.substring(r+1).split(";"),i=new RegExp("a=fmtp:(\\d+)"),o=e.match(i);if(!o||2!==o.length)return null;t.pt=o[1];for(var s={},a=0;a<n.length;++a){var c=n[a].split("=");2===c.length&&(s[c[0]]=c[1])}return t.params=s,t},window.writeFmtpLine=function(e){if(!e.hasOwnProperty("pt")||!e.hasOwnProperty("params"))return null;var t=e.pt,r=e.params,n=[],i=0;for(var o in r)n[i]=o+"="+r[o],++i;return 0===i?null:"a=fmtp:"+t.toString()+" "+n.join(";")},window.findFmtpLine=function(e,t){var r=getCodecPayloadType(e,t);return r?findLine(e,"a=fmtp:"+r.toString()):null},window.findLine=function(e,t,r){return findLineInRange(e,0,-1,t,r)},window.findLineInRange=function(e,t,r,n,i,o){if(void 0===o&&(o="asc"),"asc"===(o=o||"asc")){for(var s=-1!==r?r:e.length,a=t;a<s;++a)if(0===e[a].indexOf(n)&&(!i||-1!==e[a].toLowerCase().indexOf(i.toLowerCase())))return a}else for(var c=-1!==t?t:e.length-1;c>=0;--c)if(0===e[c].indexOf(n)&&(!i||-1!==e[c].toLowerCase().indexOf(i.toLowerCase())))return c;return null},window.getCodecPayloadType=function(e,t){var r=findLine(e,"a=rtpmap",t);return r?getCodecPayloadTypeFromLine(e[r]):null},window.getCodecPayloadTypeFromLine=function(e){var t=new RegExp("a=rtpmap:(\\d+) [a-zA-Z0-9-]+\\/\\d+"),r=e.match(t);return r&&2===r.length?r[1]:null},window.setDefaultCodec=function(e,t){var r=e.split(" "),n=r.slice(0,3);n.push(t);for(var i=3;i<r.length;i++)r[i]!==t&&n.push(r[i]);return n.join(" ")}},function(e,t,r){var n,i;n=[r(5),r(0),r(2)],void 0===(i=function(e,t,r){"use strict";var n=t.stringifyJSON,i=t.isNumber;function o(){e.call(this),this._logger=r.create("AudioMixer","console"),this._logger.verbose("AudioMixer()"),this._name="AudioMixer",this._audioContext,this._streams=[],this._output}var s=o.prototype=Object.create(e.prototype);return s.connect=function(e,t){if(this._logger.verbose("connect("+n(e)+", "+t+")"),!e||0===e.getAudioTracks().length)return Promise.reject(new Error(this._name+'.connect parameter "stream" must contain a AudioStreamTrack'));if(!i(t)||t>1)return Promise.reject(new Error(this._name+'.connect parameter "input" must be 0 or 1'));var r=e.clone();return this._streams[t]=r,this._listenToStream(r)},s.disconnect=function(e){this._logger.verbose("disconnect("+e+")"),r.delete(this._logger)},s.getOutputStream=function(){return this._logger.verbose("getOutputStream()"),this._streams.length<2?Promise.reject(new Error(this._name+" needs exactly 2 input streams")):this._getMixedStream()},s._listenToStream=function(e){return this._logger.verbose("_listenToStream("+n(e)+")"),e.onactive=this._onactive.bind(this),e.oninactive=this._oninactive.bind(this),e.onaddtrack=this._onaddtrack.bind(this),e.onended=this._onended.bind(this),Promise.resolve()},s._unregisterAudioTrackListeners=function(e){this._logger.verbose("_unregisterAudioTrackListeners("+e+")")},s._onactive=function(e){this._logger.verbose("_onactive("+n(e)+")")},s._oninactive=function(e){this._logger.verbose("_oninactive("+n(e)+")")},s._onaddtrack=function(e){this._logger.verbose("_onaddtrack("+n(e)+")")},s._onended=function(e){this._logger.verbose("_onended("+n(e)+")")},s._getMixedStream=function(){this._logger.verbose("_getMixedStream()"),this._audioContext||(this._audioContext=new AudioContext);var e=this._audioContext.createMediaStreamSource(this._streams[0]),t=this._audioContext.createMediaStreamSource(this._streams[1]),r=this._audioContext.createChannelSplitter(2),n=this._audioContext.createChannelSplitter(2);e.connect(r),t.connect(n);var i=this._audioContext.createChannelMerger(4);r.connect(i,0,0),r.connect(i,1,1),n.connect(i,0,2),n.connect(i,1,3);var o=this._createDownMixerNode();return i.connect(o),this._output=this._audioContext.createMediaStreamDestination(),o.connect(this._output),Promise.resolve(this._output.stream)},s._createDownMixerNode=function(){this._logger.verbose("_createDownMixerNode()");var e=this._audioContext.createScriptProcessor(4096,4,2);return e.onaudioprocess=function(e){for(var t,r=e.inputBuffer.getChannelData(0),n=e.inputBuffer.getChannelData(1),i=e.inputBuffer.getChannelData(2),o=e.inputBuffer.getChannelData(3),s=e.outputBuffer.getChannelData(0),a=e.outputBuffer.getChannelData(1),c=0;c<r.length;c++)t=.25*(r[c]+n[c])+.25*(i[c]+o[c]),s[c]=t,a[c]=t},e},o}.apply(t,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r(6),r(0),r(92),r(3),r(2)],void 0===(i=function(e,t,r,n,i){"use strict";var o=t.stringifyJSON,s=t.isObject,a=t.isBool,c=t.isInt,d=t.isFunction,u=t.browserInfo;function l(){this._devices={videoinput:[],audioinput:[]},this._selected={videoinput:!0,audioinput:!0},this._tempDevice=void 0,this._reenumeratedOnce=!1,this._logger=i.create("DeviceController","console")}var p=l.prototype;return p.enumerateDevices=function(){this._logger.verbose("enumerateDevices()");var e="enumerateDevices(): ",t=this;return t._verifyEnumerateDevicesExistence().then(function(e){return e.enumerateDevices()}).then(function(e){var r,n=t._createDevices(e);r=t._updateDevices(n);var i=t._tempDevice;if(i&&!t._hasSCD()){var o=t._devices.videoinput.length;i.displayIndex=o,t._devices[i.kind].push(i)}return Promise.resolve({data:{devices:{videodevices:t._listed().videoinput,audiodevices:t._listed().audioinput},updated:r}})}).catch(function(r){if(!r){var i=n.ObjectNotExistError("error","Error");return t._logger.error(e+JSON.stringify(i)),Promise.reject(i)}if("NanoError"===r.type){var o=n.composeEvent(r);return t._logger.error(e+JSON.stringify(r)),Promise.reject(o)}i=n.EnumerateDevicesError(r),o=n.composeEvent(i);return t._logger.error(e+JSON.stringify(i)),Promise.reject(o)})},p.addScreenCaptureDevice=function(n){this._logger.verbose("addScreenCaptureDevice("+n+")");var i=t.browserInfo.browser,o=t.browserInfo.mobile;if(!t.enumContainsValue(e.SCREEN_CAPTURE_BROWSER,i.toLowerCase())||o)return{};var s=new r({deviceId:"screen",kind:"videoinput",label:n+" ("+i+")",displayLabel:n+" ("+i+")"});if("Chrome"!==i||this._hasDevices())return this._tempDevice=s,{};var a=this._devices.videoinput.length;return s.displayIndex=a,this._devices.videoinput.push(s),{data:{devices:{videodevices:this._listed().videoinput,audiodevices:this._listed().audioinput},updated:!0}}},p.setDevice=function(e){this._logger.verbose("setDevice("+o(e)+")");var t="setDevice(): ";if(!s(e)){var r=n.TypeNotValidError("config","Object");return this._logger.error(t+JSON.stringify(r)),Promise.reject(r)}if("videoinput"!==e.kind&&"audioinput"!==e.kind){r=n.ValueNotValidError("config.kind","video/audio");return this._logger.error(t+JSON.stringify(r)),Promise.reject(r)}if("camera"===e.source&&!a(e.device)&&!c(e.device)){r=n.TypeNotValidError("config.device","Boolean/Int");return this._logger.error(t+JSON.stringify(r)),Promise.reject(r)}var i=e.device,d=this._devices[e.kind],u=void 0;if(a(i))u=i;else if(void 0!==(i="screen"===e.source?"screen"===d[d.length-1].deviceId?d[d.length-1]:void 0:d[i]))for(var l=0;l<d.length;l++)if(i.deviceId===d[l].deviceId){"videoinput"===e.kind&&i.setVideoDeviceConfig(e),"audioinput"===e.kind&&i.setAudioDeviceConfig(e),u=i;break}if(void 0===u){this._selected[e.kind]=!1;r=n.DevicesNotFoundError();return this._logger.error(t+JSON.stringify(r)),Promise.reject(r)}return this._selected[e.kind]=u,Promise.resolve({device:u})},p.getDevice=function(e){this._logger.verbose("getDevice("+e+")");if("videoinput"!==e&&"audioinput"!==e){var t=n.ValueNotValidError("config.kind","video/audio");return this._logger.error("getDevice(): "+JSON.stringify(t)),Promise.reject(t)}var r=this._selected;return Promise.resolve(r[e])},p.updateSelected=function(e,t){this._logger.verbose("updateSelected("+e+", "+t+")");var r=e.getVideoTracks(),n=e.getAudioTracks(),i=this;r&&r.length>0&&this.getDevice("videoinput").then(function(e){if(t||"screen"!==!e.deviceId){if(!a(e)){s=e.videoDeviceConfig||{};e.setVideoDeviceConfig(s)}i._selected.videoinput=e}else{var n=r[0].label,o=i._getDeviceForLabel(n);if(!0===e||o.label!==e.label){var s=e.videoDeviceConfig||{};o.setVideoDeviceConfig(s),i._selected.videoinput=o}}}).catch(function(e){i._logger.error("updateSelected(): "+JSON.stringify(e))}),n&&n.length>0&&i.getDevice("audioinput").then(function(e){if(t)i._selected.audioinput=e;else{var r=n[0].label,o=i._getDeviceForLabel(r);!0!==e&&o.label===e.label||(i._selected.audioinput=o)}}).catch(function(e){i._logger.error("updateSelected(): "+JSON.stringify(e))})},p.shouldReenumerate=function(e){if(this._logger.verbose("shouldReenumerate("+e+")"),e&&this._reenumeratedOnce)return!1;this._reenumeratedOnce=!0;for(var t=0,r=this._getAllDevices(),n=0;n<r.length;n++){""===(r[n].label||"")&&(t+=1)}return t==(this._hasSCD()?r.length-1:r.length)},p.composeConstraints=function(e){this._logger.verbose("composeConstraints("+o(e)+")");var t="composeConstraints(): ",r=this;return this._getConstraintTypes(e).then(function(n){for(var i={audio:!1,video:!1},o=0;o<n.length;o++)switch(n[o]){case"video":a(e.videoinput)?i.video=e.videoinput:(i.video=e.videoinput.videoDeviceConfig,""!==e.videoinput.deviceId&&(i.video.deviceId={exact:e.videoinput.deviceId}));break;case"audio":a(e.audioinput)?i.audio=e.audioinput:(i.audio=e.audioinput.getAudioDeviceConfig(),""!==e.audioinput.deviceId&&(i.audio.deviceId={exact:e.audioinput.deviceId}));break;case"screen":var s=e.videoinput.videoDeviceConfig;i.video={width:s.width.ideal,height:s.height.ideal,frameRate:s.frameRate.ideal},a(e.audioinput)?i.audio=e.audioinput:(i.audio={},i.audio.deviceId={exact:e.audioinput.deviceId})}var c=t+JSON.stringify(i);return r._logger.verbose(c),Promise.resolve(i)}).catch(function(e){var n=t+JSON.stringify(e);return r._logger.error(n),Promise.reject(e)})},p._fixChromePermissionsIssue=function(){this._logger.verbose("_fixChromePermissionsIssue()");var e=this,t=u.browser,r=parseInt(u.browserVersion,10),n=1===u.mobile;return"Chrome"===t&&r>=81&&!n?this._verifyGetUserMediaExistence().then(function(t){e._logger.verbose("_fixChromePermissionsIssue() - applying fix");return t.getUserMedia({video:{width:{ideal:1920},height:{ideal:1080},frameRate:{ideal:30}},audio:!0})}):Promise.resolve()},p._getAllDevices=function(){return[].concat(this._devices.videoinput).concat(this._devices.audioinput)},p._hasDevices=function(){return!(this._getAllDevices().length>0)},p._hasSCD=function(){var t=this._devices.videoinput.length-1,r=this._devices.videoinput[t];return r&&r.deviceId===e.MEDIA_SOURCES.SCREEN},p._listed=function(){var e=this._getAllDevices();return this._getListedFromDevices(e)},p._createDevices=function(e){this._logger.verbose("_createDevices("+o(i)+")");for(var t={videoinput:[],audioinput:[]},n=0;n<e.length;n++){var i=e[n],s=i.kind;if("videoinput"===s||"audioinput"===s){var a=t[s].length;i.displayIndex=a;var c=new r(i);t[s].push(c)}}return t},p._addDevices=function(e){for(this._logger.verbose("_addDevices("+o(e)+")");this._devices.videoinput.length;)this._devices.videoinput.pop();for(;this._devices.audioinput.length;)this._devices.audioinput.pop();this._devices.videoinput=e.videoinput,this._devices.audioinput=e.audioinput},p._updateDevices=function(e){this._logger.verbose("_updateDevices("+o(a)+")");var t=[].concat(e.videoinput).concat(e.audioinput),r=this._getAllDevices().filter(function(e){return"screen"!==e.deviceId}),n=!1;if(r.length!==t.length)n=!0;else for(var i=0;i<r.length;i++){var s=r[i],a=t[i],c=["constraints","setVideoDeviceConfig","videoDeviceConfig"];for(var d in s)if(Object.prototype.hasOwnProperty.call(s,d)&&Object.prototype.hasOwnProperty.call(a,d)&&-1===c.indexOf(d)&&-1===c.indexOf(d)&&s[d]!==a[d]){n=!0;break}}return this._addDevices(e),n},p._getDeviceForLabel=function(e){this._logger.verbose("_getDeviceForLabel("+e+")");var t=this._getAllDevices();if(-1!==e.indexOf("screen"))for(var r=0;r<t.length;r++){if("screen"===(n=t[r]).deviceId)return n}else for(r=0;r<t.length;r++){var n;if((n=t[r]).label===e)return n}},p._getListedFromDevices=function(e){this._logger.verbose("_getListedFromDevices("+o(e)+")");for(var t={videoinput:[],audioinput:[]},r=0;r<e.length;r++){var n=e[r];t[n.kind].push({index:n.displayIndex,id:n.label||n.displayId})}return t},p._getConstraintTypes=function(r){this._logger.verbose("_getConstraintTypes("+o(r)+")");var i="_getConstraintTypes(): ";if(!r){var s=n.ObjectNotExistError("devices","Array");return this._logger.error(i+JSON.stringify(s)),Promise.reject(s)}var c=[];if(r.videoinput){var d=r.videoinput.videoDeviceConfig?r.videoinput.videoDeviceConfig.source:a(r.videoinput)?e.MEDIA_SOURCES.CAMERA:void 0;if(!t.enumContainsValue(e.MEDIA_SOURCES,d)){s=n.EnumValueNotValidError(d,e.MEDIA_SOURCES);return this._logger.error(i+JSON.stringify(s)),Promise.reject(s)}c.push(d===e.MEDIA_SOURCES.SCREEN?"screen":"video")}return r.audioinput&&(r.videoinput&&"screen"!==r.videoinput.deviceId||!r.videoinput)&&c.push("audio"),Promise.resolve(c)},p._verifyEnumerateDevicesExistence=function(){this._logger.verbose("_verifyEnumerateDevicesExistence()");var e=navigator.mediaDevices;if(!e||!d(e.enumerateDevices)){var t=n.FunctionNotDefinedError("enumerateDevices");return this._logger.error("_verifyEnumerateDevicesExistence(): "+JSON.stringify(t)),Promise.reject(t)}return Promise.resolve(e)},p._verifyGetUserMediaExistence=function(){this._logger.verbose("_verifyGetUserMediaExistence()");var e=navigator.mediaDevices;if(!e||!d(e.getUserMedia)){var t=n.FunctionNotDefinedError("getUserMedia");return this._logger.error("_verifyGetUserMediaExistence(): "+JSON.stringify(t)),Promise.reject(t)}return Promise.resolve(e)},l}.apply(t,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r(6)],void 0===(i=function(e){"use strict";return function(t){this.deviceId=t.deviceId,this.kind=t.kind,this.label=t.label,this.groupId=t.groupId,this.displayIndex=t.displayIndex,this.displayId=t.kind+"device ID: "+t.deviceId.substr(0,10),this.videoDeviceConfig={},this.audioDeviceConfig={},this.setVideoDeviceConfig=function(t){var r=(t=t||{}).source||e.MEDIA_SOURCES.CAMERA,n=t.width||0,i=t.height||0,o=t.framerate||0,s=t.minFramerate||0;r!==e.MEDIA_SOURCES.CAMERA&&r!==e.MEDIA_SOURCES.SCREEN||(this.videoDeviceConfig.source=r),o<s&&(o=s),n>0&&i>0&&(this.videoDeviceConfig.width={ideal:n},this.videoDeviceConfig.height={ideal:i}),o>0&&(this.videoDeviceConfig.frameRate={ideal:o})},this.getVideoDeviceConfig=function(){return this.videoDeviceConfig},this.setAudioDeviceConfig=function(e){this.audioDeviceConfig=e||{}},this.getAudioDeviceConfig=function(){return this.audioDeviceConfig}}}.apply(t,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r(0),r(3),r(2)],void 0===(i=function(e,t,r){"use strict";var n=e.stringifyJSON,i=e.isObject,o=e.isEmpty,s=e.isString;return function(e){this._logger=r.create("Media","console");if(!i(e)||o(e)){var a=t.TypeNotValidError("config","Object");throw this._logger.error("Media(): "+n(a)),a}if(!i(e.stream)){a=t.TypeNotValidError("config.stream","Object");throw this._consoleLogger.error("Media(): "+n(a)),a}if(!s(e.kind)||"local"!==e.kind&&"remote"!==e.kind){a=t.ValueNotValidError("config.kind","local/remote");throw this._consoleLogger.error("Media(): "+n(a)),a}this.stream=e.stream,this.kind=e.kind,this.metadata={hasVideo:0,hasAudio:0,width:0,height:0,framerate:0},this.remoteUserName=e.remoteUserName,this.remoteUserId=e.remoteUserId,this.getTracks=function(){return[].concat(this.getVideoTracks()).concat(this.getAudioTracks())},this.getVideoTracks=function(){return this.stream.getVideoTracks()},this.getAudioTracks=function(){return this.stream.getAudioTracks()},this.hasVideoTracks=function(){return this.stream.getVideoTracks().length>0?1:0},this.hasAudioTracks=function(){return this.stream.getAudioTracks().length>0?1:0},this.getVideoTracksSettings=function(){var e=this.stream.getVideoTracks();return e&&e.length>0?this.stream.getVideoTracks()[0].getSettings():void 0},this.getVideoTracksConstraints=function(){var e=this.stream.getVideoTracks();return e&&e.length>0?this.stream.getVideoTracks()[0].geConstraints():void 0},this.getAudioTracksSettings=function(){var e=this.stream.getAudioTracks();return e&&e.length>0?this.stream.getAudioTracks()[0].getSettings():void 0},this.getAudioTrackConstraints=function(){var e=this.stream.getAudioTracks();return e&&e.length>0?this.stream.getAudioTracks()[0].getConstraints():void 0},this.applyAudioConstraints=function(e){var r,s,a="applyAudioConstraints(): ",c=this;return c._logger.verbose(a+n(e)),!i(e)||o(e)?(r=t.TypeNotValidError("constraints","Object"),c._logger.error(a+n(r)),Promise.reject(r)):c.hasAudioTracks()?(s=c.getAudioTracks()[0],c._logger.verbose(a+"constraints before applying: "+n(c.getAudioTrackConstraints())),s.applyConstraints(e).then(function(){c._logger.verbose(a+"constraints after applying: "+n(c.getAudioTrackConstraints()))}).catch(function(e){return c._logger.error(a+n(e)),Promise.reject(e)})):(r=t.OperationNotAllowedError("Media.applyAudioConstraints()","Media has no audio tracks."),c._logger.error(a+n(r)),Promise.reject(r))},this.muteTracks=function(e,t){var r="videoinput"===e?this.getVideoTracks():"audioinput"===e?this.getAudioTracks():void 0;if(r)for(var n=0;n<r.length;n++)r[n].enabled=!t},this.bind=function(e){for(var t=this.getTracks(),r=0;r<t.length;r++)t[r].onended=e._onTrackEnded.bind(e)},this.unbind=function(){if(this.stream){for(var e=this.getTracks(),t=0;t<e.length;t++)e[t].onended=void 0;this._stopTracks(e),this.stream=void 0}this.metadata={hasAudio:0,hasVideo:0,width:0,height:0,framerate:0}},this._stopTracks=function(e){for(var t=0;t<e.length;t++)e[t].stop()}}}.apply(t,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r(6),r(0),r(5),r(2),r(3),r(49)],void 0===(i=function(e,t,r,n,i,o){"use strict";var s=t.isObject,a=t.isString,c=t.isFunction,d=t.stringifyJSON;function u(){r.call(this),this._logger=n.create("ScreenCapture","console"),this._logger.verbose("ScreenCapture()");this._screenCaptureName=void 0,this._isScreenCaptureAvailable=!1,this._isChromeScreenCaptureExtensionInstalled=!1,this._sourceId=null,this._onGetSourceId=null;var e=this;window.addEventListener("message",function(t){e._logger.verbose("window.addEventListener("+d(t)+")");var r="addEventListener(): ",n=t.origin;if(a(n)&&e._isValidOrigin(n)&&s(t.data)){var o=t.data.type;if(a(o)&&e._isValidType(o)){var c=t.data.command;if(a(c)){var u=t.data.value;if(a(u)){if("message"===c){if("isReady"===u||"isLoaded"===u){e._isChromeScreenCaptureExtensionInstalled=!0;var l=r+e._screenCaptureName+" event: "+u;e._logger.verbose(l)}}else if("error"===c){l=r+e._screenCaptureName+" error: "+u;if(e._logger.verbose(l),"PermissionDeniedError"===u){var p=i.GetDisplayMediaError("PermissionDenied",l);e.emit(p.name,p)}}else if("setSourceId"===c){var f=u;l=r+e._screenCaptureName+"event: "+c;e._logger.verbose(l),e._setSourceId(f)}e._isScreenCaptureAvailable=!!("getDisplayMedia"in navigator.mediaDevices&&e._isChromeScreenCaptureExtensionInstalled)}}}}}),"chrome"===o.browserDetails.browser&&o.browserDetails.version<72?this._logger.warning('ScreenCapture(): Chrome screen capture extension is required for Chrome < v.72; use RTCUser\'s "addScreenCaptureExtension()" call to enable an extension'):this._initWithNativeAPISupport()}var l=u.prototype=Object.create(r.prototype);return l.addChromeExtension=function(e){this._logger.verbose("addChromeExtension("+e+")");if(!a(e)){var t=i.TypeNotValidError("name","String");throw self._logger.error("addChromeExtension(): "+d(t)),t}this._screenCaptureName=e,this._checkChromeExtensionAliveness(),this._initWithChromeExtensionSupport()},l.getScreenCaptureName=function(){return this._logger.verbose("getScreenCaptureName()"),this._screenCaptureName},l.isScreenCaptureAvailable=function(){return this._logger.verbose("isScreenCaptureAvailable()"),this._isScreenCaptureAvailable},l._initWithNativeAPISupport=function(){this._logger.verbose("_initWithNativeAPISupport()");var r=t.browserInfo.mobile;t.enumContainsValue(e.SCREEN_CAPTURE_BROWSER,o.browserDetails.browser.toLowerCase())&&!r?(this._screenCaptureName="nanoScreenCapture","firefox"==o.browserDetails.browser&&o.browserShim.shimGetDisplayMedia(window,"screen"),this._isScreenCaptureAvailable="getDisplayMedia"in navigator.mediaDevices):this._isScreenCaptureAvailable=!1},l._initWithChromeExtensionSupport=function(){this._logger.verbose("_initWithChromeExtensionSupport()");var e="_initWithChromeExtensionSupport(): ",t=this;o.browserShim.shimGetDisplayMedia(window,function(){return new Promise(function(r,n){t.once("PermissionDenied",function(){var r=i.GetDisplayMediaError("PermissionDenied");t._logger.error(e+d(r)),n(r)}),t._getSourceId(function(){if(t._sourceId)r(t._sourceId);else{var o=i.GetDisplayMediaError("NotAllowedError");t._logger.error(e+d(o)),n(o)}})})})},l._checkChromeExtensionAliveness=function(){this._logger.verbose("_checkChromeExtensionAliveness()");var e=this;setTimeout(function(){e._isChromeScreenCaptureExtensionInstalled||(e._isChromeScreenCaptureExtensionInstalled=!1)},500),this._logger.verbose("_checkChromeExtensionAliveness(): "+this._screenCaptureName+"alive?"),this._toWindow(this._screenCaptureName,"isAlive","")},l._isValidOrigin=function(e){return this._logger.verbose("_isValidOrigin("+e+")"),e===window.location.origin},l._isValidType=function(e){return this._logger.verbose("_isValidType("+e+")"),e===this._screenCaptureName},l._getSourceId=function(e){this._logger.verbose("_getSourceId()");c(e)&&(this._onGetSourceId=e,this._logger.verbose("_getSourceId(): "+this._screenCaptureName),this._toWindow(this._screenCaptureName,"getSourceId",""))},l._setSourceId=function(e){this._logger.verbose("_setSourceId("+e+")"),this._sourceId=void 0!==e?e:null,this._onGetSourceId&&this._onGetSourceId()},l._toWindow=function(e,t,r){this._logger.verbose("_toWindow("+this._screenCaptureName+e+", "+t+", "+r+")"),window.postMessage({type:e,command:t,value:r},"*")},u}.apply(t,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r(19),r(6),r(5),r(0),r(96),r(32),r(3),r(2)],void 0===(i=function(e,t,r,n,i,o,s,a){"use strict";var c=n.stringifyJSON,d={IDLE:1,ROOM_ENTERED:2,STOPPED:3},u=t.CHATPEER_STATE;function l(e,t,n){r.call(this),this._logger=a.create("ChatRoom","console"),this._logger.verbose("ChatRoom("+c(e)+")"),this._roomName=e.room,this._userName=e.userName,this._userId=e.userId,this._peers=[],this._serverUserList=[],this._state=d.IDLE,this._iceServers=[],this._config={},this._session=t,this._mediaController=n}var p=l.prototype=Object.create(r.prototype);return p.setConfig=function(e){this._logger.verbose("setConfig("+c(e)+")"),this._config=e},p.setIceServers=function(e){this._iceServers=e},p.enter=function(){this._logger.verbose("enter()");var e=this;return e._state==d.ROOM_ENTERED?Promise.reject(s.WrongStateError("Already in room")):(this._session.on("RoomMessage",e._onRoomMessage.bind(e)),this._session.enterRoom({roomName:this._roomName,userName:this._userName}).then(function(t){e._state=d.ROOM_ENTERED}))},p.leave=function(){this._logger.verbose("leave()");var e=this;return this._session.removeEvent("RoomMessage"),this._session.leaveRoom({roomName:this._roomName}).then(function(){e.destroy(),e._state=d.STOPPED}).catch(function(t){return e.destroy(),e._state=d.STOPPED,e._logger.error("leave(): "+c(t)),Promise.reject(t)})},p.callUser=function(e){this._logger.verbose("callUser("+e+")");var t=this;return this._session.callUser({userId:e,roomName:this._roomName}).catch(function(e){return t._logger.error("callUser(): "+c(e)),Promise.reject(e)})},p.answerCall=function(e){this._logger.verbose("answerCall("+e+")");var t=this;return this._session.answerCall({userId:e,roomName:this._roomName}).then(function(r){t._createChatPeer(!1,e,r.user_name,r.caller_peer_id,r.callee_peer_id)}).catch(function(e){return t._logger.error("answerCall(): "+c(e)),Promise.reject(e)})},p.declineCall=function(e){this._logger.verbose("declineCall("+e+")");var t=this;return this._session.declineCall({userId:e,roomName:this._roomName}).catch(function(e){return t._logger.error("declineCall(): "+c(e)),Promise.reject(e)})},p.hangUpCall=function(e){this._logger.verbose("hangUpCall("+e+")");var t=this;return this._session.hangUpCall({userId:e,roomName:this._roomName}).then(function(){t._destroyPeer(e),t._createPublicUserList()}).catch(function(e){return t._logger.error("hangUpCall(): "+c(e)),Promise.reject(e)})},p.getUsersCount=function(){return this._logger.verbose("getUsersCount()"),this._peers.length},p.destroy=function(){this._logger.verbose("destroy()"),this._session.removeEvent("RoomMessage");for(var e=0;e<this._peers.length;e++)this._peers[e].destroy();return this._peers=[],a.delete(this._logger),Promise.resolve()},p._addEventPayload=function(e){return(e=e||{}).data=e.data||{},e.data.state=this._state,e},p._reemit=function(e){e=this._addEventPayload(e),this.emit(e.name,e)},p._createChatPeer=function(e,t,r,n,o){this._logger.verbose("_createChatPeer("+e+", "+t+", "+r+", "+n+", "+o+")");var s=new i(this._userName,this._userId,t,r,this._roomName,this._session,this._mediaController);s.setIceServers(this._iceServers),s.addStream(this._mediaController.getLocalMedias()[0].stream),s.setConfig(this._config),s.start(e,n,o),this._peers.push(s),this._bind(s)},p._destroyPeer=function(e){this._logger.verbose("_destroyPeer("+e+")");var t=this._removePeerFromPeerList(e);this._unbind(t),t.destroy()},p._bind=function(e){this._logger.verbose("_bind("+c(e)+")"),e.on("RemoteStreamAdded",this._reemit.bind(this)),e.on("StateChanged",this._handlePeerState.bind(this))},p._unbind=function(e){this._logger.verbose("_unbind("+c(e)+")"),e.removeEvent("RemoteStreamAdded"),e.removeEvent("StateChanged")},p._handlePeerState=function(e){switch(this._logger.verbose("_handlePeerState( "+c(e)+")"),e.data.state){case t.CHATPEER_STATE.INITIALIZED:case t.CHATPEER_STATE.SIGNALING:case t.CHATPEER_STATE.SIGNALLING_DONE:case t.CHATPEER_STATE.CALLING:case t.CHATPEER_STATE.NEGOTIATION_NEEDED:break;case t.CHATPEER_STATE.DISCONNECTED:case t.CHATPEER_STATE.FAILED:this._destroyPeer(e.target.getRemoteUserId());break;case t.CHATPEER_STATE.STOPPED:}this._createPublicUserList()},p._createPublicUserList=function(){this._logger.verbose("_createPublicUserList()");for(var e,t,r,i,o="_createPublicUserList(): ",s=[],a=0;a<this._peers.length;a++)i={},t=(e=this._peers[a]).getState(),r=n.getKeyByValue(u,t).toLowerCase(),i.state=r,i.remoteUserName=e.getRemoteUserName(),i.remoteUserId=e.getRemoteUserId(),s.push(i);var d=this._serverUserList.filter(function(e){for(var t=0;t<s.length;t++)if(s[t].remoteUserId==e.remoteUserId)return!1;return!0}),l=d.concat(s).sort(function(e,t){return e.remoteUserName.toUpperCase()<t.remoteUserName.toUpperCase()?-1:e.remoteUserName.toUpperCase()>t.remoteUserName.toUpperCase()?1:0});return this._logger.verbose(o+"publicList: "+c(d)),this._logger.verbose(o+"peerList: "+c(s)),this._logger.verbose(o+"sortedList: "+c(l)),this.emit("RoomUpdate",{type:"room_update",data:{userlist:l}}),l},p._getPeerByRemoteUserId=function(e){var t;this._logger.verbose("_getPeerByRemoteUserId("+e+")");for(var r=0;r<this._peers.length;r++)if((t=this._peers[r]).getRemoteUserId()===e)return t},p._removePeerFromPeerList=function(e){var t;this._logger.verbose("_removePeerFromPeerList("+e+")");for(var r=0;r<this._peers.length;r++)if((t=this._peers[r]).getRemoteUserId()===e)return this._peers.splice(r,1),t},p._onRoomMessage=function(e){this._logger.verbose("_onRoomMessage("+c(e)+")");var t={};switch(e.type){case"room_update":this._logger.verbose("_onRoomMessage(): room_update: "+c(e)),this._serverUserList=e.data.userlist,this._createPublicUserList();break;case"call_incoming":t.remoteUserId=e.user_id,t.remoteUserName=e.user_name,this.emit("RoomUpdate",{type:"call_incoming",data:t});break;case"call_declined":t.remoteUserName=e.data.user_name,t.remoteUserId=e.data.user_id,this.emit("RoomUpdate",{type:"call_declined",data:t});break;case"hang_up":this._destroyPeer(e.data.user_id),this._createPublicUserList();break;case"start_as_caller":this._createChatPeer(!0,e.user_id,e.user_name,e.caller_peer_id,e.callee_peer_id)}},l}.apply(t,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r(19),r(47),r(6),r(5),r(0),r(50),r(32),r(2)],void 0===(i=function(e,t,r,n,i,o,s,a){"use strict";var c=i.isString,d=i.isIntString,u=i.stringifyJSON,l=i.isArray,p=r.CHATPEER_STATE;function f(e,t,r,i,o,s,u){n.call(this),this._logger=a.create("ChatPeer","console"),this._logger.verbose("ChatPeer("+e+", "+t+", "+r+", "+i+", "+o+")");var l="ChatPeer(): ";c(e)||this._logger.error(l+"Param userName must be a string"),c(o)||this._logger.error(l+"Param room must be a string"),d(t)||this._logger.error(l+"Param userId must be an integer"),this._userName=e,this._userId=t,this._peerId=void 0,this._remoteUserName=i,this._remoteUserId=r,this._remotePeerId=void 0,this._room=o,this._pcClient=void 0,this._streams=[],this._startTime=null,this._iceServers=[],this._config={},this._state=p.IDLE,this._messageQueue=[],this._isCaller=!1,this._remoteStream=null,this._statsEnabled=!1,this._statsIntervalTime=1e3,this._statsInterval=0,this._rtcStats=null,this._session=s,this._mediaController=u}var h=f.prototype=Object.create(n.prototype);return h.setIceServers=function(e){this._iceServers=e},h.setConfig=function(e){this._config=e},h.getState=function(){return this._state},h.getPeerId=function(){return this._peerId},h.getRemoteUserId=function(){return this._remoteUserId},h.getRemoteUserName=function(){return this._remoteUserName},h.start=function(e,t,r){var n;this._logger.verbose("start("+e+", "+t+", "+r+")"),this._isCaller=e,this._createPCClient(),this._isCaller?(this._peerId=t,this._remotePeerId=r):(this._peerId=r,this._remotePeerId=t),n="receiver_peer_"+this._peerId,this._session.on(n,this._onServerMessage.bind(this)),this._isCaller?this._pcClient.startAsCaller(null):this._pcClient.startAsCallee(this._messageQueue),this._setState(p.INITIALIZED)},h.addStream=function(e){this._logger.verbose("addStream("+u(e)+")");e?2!==this._streams.length?l(e)?this._streams=e:this._streams.push(e):this._logger.__warning("addStream(): [peer id: "+this._peerId+"] stream count is already=2, we only support 2 streams/Chatpeer"):this._logger.error("addStream(): [peer id: "+this._peerId+'] parameter "stream" must not be undefined')},h.enableStats=function(e,t){this._logger.verbose("enableStats("+e+", "+t+")"),this._statsEnabled=void 0===e||e,this._statsIntervalTime=t||1e3,this._rtcStats=null,this._statsEnabled&&(this._rtcStats=new o,this._rtcStats.on("ReceivedWebRTCStats",this._reemit.bind(this)))},h.destroy=function(){this._logger.verbose("destroy()"),this._unbind(),this._closePCClient(),this._setState(p.STOPPED),this._remoteStream&&(this._mediaController.removeMedia(this._remoteStream.id),this._remoteStream=null),a.delete(this._logger)},h._onServerMessage=function(e){this._logger.verbose("_onServerMessage("+u(e)+")");var t="_onServerMessage(): ",r=this;switch(e.type){case"sdp_message":r._pcClient&&r._pcClient.isStarted()?r._pcClient.setRemoteDescription(e.data).catch(function(e){return r._logger.error(t+"setRemoteDescription failed:"+e),Promise.reject(e)}).then(function(){if(r._logger.verbose(t+"setRemoteDescription succeded"),!r._isCaller)return r._pcClient.doAnswer()}).catch(function(e){return r._logger.error(t+"doAnswer failed:"+e),Promise.reject(e)}).then(function(e){if(!r._isCaller){r._logger.verbose(t+"doAnswer succeded "+e);var n={};return n.sender_peer=r._peerId,n.receiver_peer=r._remotePeerId,n.data=e,r._session.sendSignalingMessage(n).catch(function(e){r._logger.error(t+"sendSignalingMessage - "+e)})}}).catch(function(e){r._logger.error(t+"doAnswer failed:",e)}):r._messageQueue.push(e.data.sdp);break;case"ice_candidate":r._pcClient&&r._pcClient.isStarted()?r._pcClient.addIceCandidate(e.data.candidate):r._messageQueue.push(e.data.candidate);break;case"server_error":r._setState(p.FAILED),r._logger.error(t+"Server error: "+e.error);break;default:r._logger.verbose(t+"Unknown message:"+e)}},h._addEventPayload=function(e){return(e=e||{}).target=this,e.data=e.data||{},e.data.state=this._state,e.data.message=i.getKeyByValue(p,this._state).toLowerCase(),e.data.text=e.data.message,e},h._reemit=function(e){e=this._addEventPayload(e),this.emit(e.name,e)},h._collectRtcStats=function(){this._logger.verbose("_collectRtcStats()");var e=this;clearInterval(e._statsInterval),this._statsInterval=setInterval(function(){e._pcClient?e._pcClient.getStats().then(function(t){e._rtcStats||(e._rtcStats=new o),e._rtcStats.putReport(t)}).catch(function(t){e._logger.error("_collectRtcStats(): [peer id: "+e._peerId+"] "+t)}):clearInterval(e._statsInterval)},this._statsIntervalTime)},h._stopCollectRtcStats=function(){this._logger.verbose("_stopCollectRtcStats()");this._statsInterval&&(this._logger.verbose("_stopCollectRtcStats(): Stopping rtc stats collection"),clearInterval(this._statsInterval))},h._getPeerConnectionConfig=function(){this._logger.verbose("_getPeerConnectionConfig()");var e={iceServers:this._iceServers,iceTransports:"all"},t={optional:[],mandatory:[]};return t.optional.push({googCpuOveruseDetection:!1}),t.optional.push({RtpDataChannels:!1}),{mediaConstraints:{audio:!0,video:!0},sdpPatches:this._config.sdpPatches,peerConnectionConfig:e,peerConnectionConstraints:t,send:!0,receive:!0,videoSendCodec:this._config.codecs.videoCodec||"H264",videoRecvCodec:this._config.codecs.videoCodec||"H264",videoSendBitrate:this._config.bitrates.videoSendBitrate||0,videoSendInitialBitrate:this._config.bitrates.videoSendInitialBitrate||0}},h._createPCClient=function(){this._logger.verbose("_createPCClient()");var e="_createPCClient(): ";if(this._pcClient)this._logger.verbose(e+"[peer id:  "+this._peerId+"] PeerConnection still alive, do not create!");else try{this._pcClient=new t(this._getPeerConnectionConfig(),this._startTime),this._bind();for(var r=0;r<this._streams.length;r++)this._pcClient.addStream(this._streams[r]);this._logger.verbose(e+"Created PeerConnectionClient")}catch(t){this._logger.error(e+"[peer id: "+this._peerId+"] Create PeerConnection exception: "+t.message),this.emitSimple("CreatePeerConnectionClientError")}},h._bind=function(){this._logger.verbose("_bind()"),this._pcClient.on("SignalingMessage",this._onSignalingMessage.bind(this)),this._pcClient.on("RemoteStreamRemoved",this._onRemoteStreamRemoved.bind(this)),this._pcClient.on("RemoteStreamAdded",this._onRemoteStreamAdded.bind(this)),this._pcClient.on("IceConnectionStateChange",this._onIceConnectionStateChange.bind(this)),this._pcClient.on("EndOfLocalCandidates",this._onEndOfLocalCandidates.bind(this)),this._pcClient.on("NegotiationNeeded",this._onNegotiationNeeded.bind(this))},h._unbind=function(){this._logger.verbose("_unbind()"),this._pcClient.off("SignalingMessage",this._onSignalingMessage.bind(this)),this._pcClient.off("RemoteStreamRemoved",this._onRemoteStreamRemoved.bind(this)),this._pcClient.off("RemoteStreamAdded",this._onRemoteStreamAdded.bind(this)),this._pcClient.off("IceConnectionStateChange",this._onIceConnectionStateChange.bind(this)),this._pcClient.off("EndOfLocalCandidates",this._onEndOfLocalCandidates.bind(this)),this._pcClient.off("NegotiationNeeded",this._onNegotiationNeeded.bind(this))},h._setState=function(e){this._logger.verbose("_setState("+e+")");if(e!==this._state){if(this._state!==p.CALLING||e!==p.SIGNALING&&e!==p.SIGNALLING_DONE){var t,r=this._state;this._state=e,this._logger.verbose("_setState(): State: "+i.getKeyByValue(p,r)+" -> "+i.getKeyByValue(p,this._state)),t=this._addEventPayload({}),this.emit("StateChanged",t)}}else this._logger.verbose("_setState(): No state change")},h._onIceConnectionStateChange=function(e){switch(this._logger.verbose("_onIceConnectionStateChange("+u(e)+")"),e.data.state){case"new":case"checking":this._setState(p.SIGNALING);break;case"connected":case"completed":this._setState(p.SIGNALLING_DONE),this._statsEnabled&&this._pcClient&&this._collectRtcStats();break;case"failed":this._setState(p.FAILED),this._statsEnabled&&this._pcClient&&this._stopCollectRtcStats();break;case"disconnected":this._setState(p.DISCONNECTED)}},h._onNegotiationNeeded=function(e){this._logger.verbose("_onNegotiationNeeded("+u(e)+")");this._logger.warning("_onNegotiationNeeded(): NegotiationNeeded event has been fired")},h._onEndOfLocalCandidates=function(e){this._logger.verbose("_onEndOfLocalCandidates("+u(e)+")")},h._onRemoteStreamAdded=function(e){this._logger.verbose("_onRemoteStreamAdded("+u(e)+")");var t=this;if(!this._remoteStream){this._remoteStream=e.data.stream;var r={stream:this._remoteStream,kind:"remote",remoteUserId:this._remoteUserId,remoteUserName:this._remoteUserName};this._mediaController.addRemoteMedia(r).then(function(){t._setState(p.CALLING),t.emitSimple(e.name,{stream:t._remoteStream.id})}).catch(function(e){var r="_onRemoteStreamAdded(): Failed to add remote media to MediaController list of medias:"+e;t._logger.error(r)})}},h._onRemoteStreamRemoved=function(e){this._logger.verbose("_onRemoteStreamRemoved("+u(e)+")"),this._remoteStream&&(this._mediaController.removeMedia(this._remoteStream.id),this._remoteStream=null)},h._closePCClient=function(){this._logger.verbose("_closePCClient()");if(this._pcClient){var e,t,r=this._streams;for(e=0,t=r.length;e<t;++e)try{this._pcClient.removeStream(r[e])}catch(e){this._logger.error("_closePCClient(): [peer id: "+this._peerId+"] Could not remove stream from peerconnectionclient")}this._pcClient.close(),this._streams=null,this._pcClient=null}else this._logger.warning("_closePCClient(): No PeerConenctionClient")},h._sendMessageToPeer=function(e){this._logger.verbose("_sendMessageToPeer("+u(e)+")");var t="_sendMessageToPeer(): ",r=this,n={};if(!this._remotePeerId){var i=t+"Trying to send message, but no remote peer id set! This should not happen!";return this._logger.error(i),Promise.reject(i)}if(!this._peerId){i=t+"Trying to send message, but no peer id set! This should not happen!";return this._logger.error(i),Promise.reject(i)}return n.sender_peer=this._peerId,n.receiver_peer=this._remotePeerId,n.data=e,this._session.sendSignalingMessage(n).catch(function(e){return r._logger.error(t+e),Promise.reject(e)})},h._onSignalingMessage=function(e){this._logger.verbose("_onSignalingMessage("+u(e)+")");var t="_onSignalingMessage(): ",r=this;this._remotePeerId?this._sendMessageToPeer(e.data).then(function(){}).catch(function(e){r._logger.error(t+e)}):this._logger.error(t+"Trying to send message, but no remote peer set! This should not happen!")},f}.apply(t,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r(2),r(0)],void 0===(i=function(e,t){"use strict";var r={_logger:e.create("ParamUtils","console"),isRtmpUrl:function(e){if(!t.isString(e))return!1;if(!/^([rR][tT][mM][pP][sS]?):\/\/([a-zA-Z0-9.\-:]{4,})\/\b([a-zA-Z0-9()@:%_\+.~#?&\/=-]*)$/gm.test(e))return!1;var n=e.split("//")[1].split("/")[0];if(!n)return!1;var i=n.split(":")[0],o=n.split(":")[1];return!(!r.isValidDomainName(i)&&!r.isValidIp(i))&&!(o&&(o.length>5||!/^\d+$/.test(o)))},isWebSocketUrl:function(e){if(!t.isString(e))return!1;if(!/^([wW][sS][sS]?):\/\/([a-zA-Z0-9.\-:]{4,})\/\b([a-zA-Z0-9()@:%_\+.~#?&\/=-]*)$/gm.test(e))return!1;var n=e.split("//")[1].split("/")[0],i=n.split(":")[0],o=n.split(":")[1];return!(!r.isValidDomainName(i)&&!r.isValidIp(i))&&!(o&&(o.length>5||!/^\d+$/.test(o)))},isIceServerUrl:function(e){if(!t.isString(e))return!1;if(!/^([sS][tT][uU][nN]|[tT][uU][rR][nN]):([a-zA-Z0-9.\-:]{4,})\??\b([a-zA-Z0-9()@:%_\+.~#?&\/=-]*)$/gm.test(e))return!1;var n=e.split(":")[1].split("?")[0],i=n.split(":")[0],o=n.split(":")[1];return!(!r.isValidDomainName(i)&&!r.isValidIp(i))&&!(o&&(o.length>5||!/^\d+$/.test(o)))},isJWT:function(e){return!!t.isString(e)&&/^[A-Za-z0-9+_\-=]+\.[A-Za-z0-9+_\-=]+\.[A-Za-z0-9+_\-=]*$/gm.test(e)},isObjectOfMaxDepth:function(e,n){return t.isObject(e)&&r.getObjectDepth(e)<=n},isIntInRange:function(e,r,n){return t.isIntInRange(e,r,n)},isMetadataHandler:function(e){return!!t.isString(e)&&("onMetaData"===e||"onCuePoint"===e)},isDeviceKind:function(e){return!!t.isString(e)&&("videoinput"===e||"audioinput"===e)},isVideoSource:function(e){return!!t.isString(e)&&("camera"===e||"screen"===e)},isVideoWidth:function(e){return!!t.isInt(e)&&(e>=320&&e<=3840)},isVideoHeight:function(e){return!!t.isInt(e)&&(e>=240&&e<=2160)},isFramerate:function(e){return!!t.isInt(e)&&(e>=0&&e<=60)},isDevice:function(e){return t.isInt(e)||t.isBool(e)},isH264Profile:function(e){return!!t.isString(e)&&("cbp"===e||"high"===e)},isValidDomainName:function(e){var t=e,r="."===t.charAt(t.length-1);if(t=r?t.slice(0,-1):t,!/^[a-zA-Z0-9.\-]*$/.test(t))return!1;if(t.length<1||t.length>253)return!1;var n=t.split(".");if(n.length<2)return!1;for(var i=0;i<n.length;i++){var o=n[i],s=i===n.length-1;if(o.length<1||o.length>63)return!1;if("-"===o.charAt(0)||"-"===o.charAt(o.length-1))return!1;if(s){if(!isNaN(Number(o)))return!1;if(o.length<2)return!1}}return!0},isValidIp:function(e){return/^((25[0-5]|(2[0-4]|1[0-9]|[1-9]|)[0-9])(\.(?!$)|$)){4}$/.test(e)},getObjectDepth:function(e){var t=1;for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&"object"==typeof e[n]){var i=r.getObjectDepth(e[n])+1;t=Math.max(i,t)}return t}};return r}.apply(t,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r(0),r(31),r(2),r(99),r(3)],void 0===(i=function(e,t,r,n,i){"use strict";var o=e.isObject,s=e.isBool,a=e.isInt,c=e.isEmpty,d=e.stringifyJSON;function u(e,t){this._consoleLogger=r.create("MetricsController","console"),this._grayLogger=r.create("MetricsController","graylog"),this._consoleLogger.verbose("MetricsController("+d(t)+")");var s="MetricsController(): ";if(this._statsInterval=10,this._lastStatsUpdate=void 0,this._broadcastSignallingTime=void 0,this._broadcastStartingTime=void 0,this._lastPLICount=void 0,this._lastPLICountUpdate=void 0,!o(e)||c(e)){var u=i.TypeNotValidError("rtcUser","Object");throw this._consoleLogger.error(s+d(u)),u}if(this._rtcUser=e,this._metrics=new n(t),t&&a(t.statsInterval)){if(t.statsInterval<1||t.statsInterval>10){u=i.ValueNotValidError("config.statsInterval","1...10");throw this._consoleLogger.error(s+d(u)),u}this._statsInterval=t.statsInterval}this._rtcUser._statsEnabled||this._rtcUser.enableStats(!0,1e3*this._statsInterval)}var l=u.prototype;return l.onEvent=function(e){this._consoleLogger.verbose("onEvent("+d(e)+")");var t=this;return Promise.resolve().then(function(){switch(e.name){case"SignInSuccess":return t._metrics.session.serverUrl=t._rtcUser._session._serverUrl,t._metrics.session.sessionId=t._rtcUser._session._sessionId,t._rtcUser._session.status().then(function(r){var n=r&&r.data?r.data.hostname:"";return t._metrics.session.hostName=n,t._getPayload(e)});case"SignOutSuccess":t._metrics.cleanUpSession();break;case"StartPreviewSuccess":return t._rtcUser._deviceController.getDevice("videoinput").then(function(e){return t._metrics.devices.videoinput=e,t._rtcUser._deviceController.getDevice("audioinput")}).then(function(r){return t._metrics.devices.audioinput=r,t._getPayload(e)});case"StopPreviewSuccess":t._metrics.cleanUpDevices();break;case"StartBroadcastSuccess":var r=e&&e.data?e.data.output:"",n=e&&e.data?e.data.streamname:"";t._metrics.rtmp.url=r,t._metrics.rtmp.streamname=n,t._broadcastStartingTime=(new Date).getTime();break;case"StopBroadcastSuccess":if(void 0!==t._broadcastStartingTime){var i=(new Date).getTime()-t._broadcastStartingTime;t._metrics.broadcast.totalTime=i/1e3}t._metrics.broadcast.status="stopped",t._metrics.cleanUpStats();break;case"BroadcastStatus":var o=e&&e.data?e.data.message:"";if(t._metrics.broadcast.status=o,"signaling"===o)t._broadcastSignallingTime=(new Date).getTime();else if("broadcasting"===o&&void 0!==t._broadcastSignallingTime){var s=(new Date).getTime()-t._broadcastSignallingTime;t._metrics.broadcast.startupTime=s/1e3}break;case"ReceivedWebRTCStats":e.name="ReceivedWebRtcStats";var a=(new Date).getTime(),c=t._lastStatsUpdate;if(void 0!==c)if((a-c)/1e3<t._statsInterval&&e.data&&e.data.results&&e.data.results.extended&&1!==e.data.results.extended.priority)return;if(t._lastStatsUpdate=a,e&&e.data&&e.data.results){var d=e.data.results,u={};for(var l in d)Object.prototype.hasOwnProperty.call(d,l)&&"extended"!==l&&(u[l]=d[l]);if(d.extended){var p=d.extended;for(var l in p)Object.prototype.hasOwnProperty.call(p,l)&&(u[l]=p[l]);var f=t._metrics.devices;f.videoinput&&f.videoinput.videoDeviceConfig&&(u.contentType=""+f.videoinput.videoDeviceConfig.source);a=(new Date).getTime();var h=e.data.results.extended.pliCount,g=t._lastPLICount,v=t._lastPLICountUpdate;if(void 0!==g&&void 0!==v){var m=h-g;if(m>0){var _=(a-v)/1e3/m;u.pliFrequency=_,t._lastPLICount=h,t._lastPLICountUpdate=a}else t._consoleLogger.verbose("Connection issue: PLI is not increasing")}else t._lastPLICount=h,t._lastPLICountUpdate=a}t._metrics.stats=u}if(void 0!==t._broadcastStartingTime){var S=a-t._broadcastStartingTime;t._metrics.broadcast.totalTime=S/1e3}break;default:if(e.name&&-1!==e.name.indexOf("Error")){var b={};b.code=e.error.code,b.message=e.error.message,t._metrics.error=b,t._metrics.broadcast.status="error"}}return t._getPayload(e)}).then(function(r){o(r)&&!c(r)&&t._grayLogger.send(e.name,r)}).then(function(){("StopBroadcastSuccess"===e.name||e.name&&-1!==e.name.indexOf("Error"))&&(t._metrics.cleanUpRtmp(),t._metrics.cleanUpBroadcast(),t._metrics.cleanUpStats()),t._metrics.cleanUpError()}).catch(function(r){"NanoError"!==r.type&&(r=i.GeneralError("Failed to handle an event: "+e.name)),t._consoleLogger.error("onEvent(): "+d(r)),t._metrics.cleanUpRtmp(),t._metrics.cleanUpBroadcast(),t._metrics.cleanUpStats(),t._metrics.cleanUpError()})},l._getPayload=function(n){var i=e.browserInfo,o=r._graylog.credentials,a=this._metrics;return Promise.resolve().then(function(){var e={application_name:"webrtc-client",application_event_id:a.eventId,application_account_id:o.accountId,application_account_key:o.accountKey,message:n.name.replace(/\b\w/g,function(e){return e.toLowerCase()}).replace(/([A-Z])/g,"_$1").toUpperCase(),origin:document.location.origin,path_name:document.location.pathname,referrer:document.location.href,search:document.location.search,os:i.os,os_version:i.osVersion,browser:i.browser,browser_version:i.browserVersion,webrtc_client_version:t.webrtc.release_version,server_url:a.session.serverUrl,server_hostname:a.session.hostName,session_id:a.session.sessionId,rtmp_url:a.rtmp.url,rtmp_streamname:a.rtmp.streamname,broadcast_status:a.broadcast.status,broadcast_startup_time:a.broadcast.startupTime,broadcast_total_time:a.broadcast.totalTime,bintu_orga_hash:-1!==a.rtmp.url.indexOf("bintu")?a.rtmp.streamname.split("-")[0]:"",video_device:a.devices.videoinput.label||(s(a.devices.videoinput)?a.devices.videoinput+"":a.devices.videoinput.label),audio_device:a.devices.audioinput.label||(s(a.devices.audioinput)?a.devices.audioinput+"":a.devices.audioinput.label),stats_content_type:a.stats.contentType,stats_audio_codec:a.stats.audioCodec,stats_audio_bitrate:a.stats.audioBitrate,stats_video_codec:a.stats.videoCodec,stats_frame_height:a.stats.frameHeight,stats_frame_width:a.stats.frameWidth,stats_framerate:a.stats.framerate,stats_video_bitrate:a.stats.videoBitrate,stats_nack_count:a.stats.nackCount,stats_frames_encoded:a.stats.framesEncoded,stats_key_frames_encoded:a.stats.keyFramesEncoded,stats_total_encode_time:a.stats.totalEncodeTime,stats_average_encode_time:a.stats.averageEncodeTime,stats_encode_time_percentage:a.stats.encodeTimePercentage,stats_idle_time_percentage:a.stats.idleTimePercentage,stats_fir_count:a.stats.firCount,stats_pli_count:a.stats.pliCount,stats_pli_frequency:a.stats.pliFrequency,stats_resolution_changed:a.stats.resolutionChanged,error_code:a.error.code,error_message:a.error.message};for(var r in a.customFields)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=""+a.customFields[r]);return Promise.resolve(e)}).catch(function(e){return Promise.reject(e)})},u}.apply(t,n))||(e.exports=i)},function(e,t,r){var n,i;n=[r(0),r(2),r(3)],void 0===(i=function(e,t,r){"use strict";var n=e.isObject,i=e.isEmpty,o=e.stringifyJSON;return function(e){if(this.logger=t.create("Metrics","console"),this.logger.verbose("Metrics("+o(e)+")"),this.eventId="",this.customFields={},this.session={},this.devices={videoinput:{},audioinput:{}},this.rtmp={url:"",streamname:""},this.broadcast={status:"",startupTime:void 0,totalTime:void 0},this.stats={},this.error={},n(e)&&!i(e))for(var s in this.eventId=""+e.eventId,e)if(0===s.indexOf("customField")){var a=s.split("customField");if(!(a.length>1&&0===a[0].length)){d=r.GeneralError("Custom field property is invalid");throw this.logger.error(o(d)),d}var c=parseInt(a[1]);if(isNaN(c)||c.toString()!=a[1]){var d=r.GeneralError("Invalid or incorrect custom field index");throw this.logger.error(o(d)),d}if(c<1||c>10){var d=r.GeneralError("Custom field index exceeds the range 1 to 10");throw this.logger.error(o(d)),d}this.customFields["application_custom_field_"+a[1]]=e[s]}this.cleanUpSession=function(){this.session={}},this.cleanUpDevices=function(){this.devices={videoinput:{},audioinput:{}}},this.cleanUpRtmp=function(){this.rtmp={url:"",streamname:""}},this.cleanUpBroadcast=function(){this.broadcast={status:"",startupTime:void 0,totalTime:void 0}},this.cleanUpStats=function(){this.stats={}},this.cleanUpError=function(){this.error={}}}}.apply(t,n))||(e.exports=i)},function(e,t,r){e.exports={castArray:r(101),clone:r(102),cloneDeep:r(160),cloneDeepWith:r(161),cloneWith:r(162),conformsTo:r(163),eq:r(23),gt:r(165),gte:r(167),isArguments:r(35),isArray:r(8),isArrayBuffer:r(168),isArrayLike:r(16),isArrayLikeObject:r(170),isBoolean:r(171),isBuffer:r(18),isDate:r(172),isElement:r(174),isEmpty:r(175),isEqual:r(176),isEqualWith:r(185),isError:r(186),isFinite:r(187),isFunction:r(24),isInteger:r(74),isLength:r(37),isMap:r(69),isMatch:r(188),isMatchWith:r(190),isNaN:r(191),isNative:r(192),isNil:r(194),isNull:r(195),isNumber:r(78),isObject:r(9),isObjectLike:r(1),isPlainObject:r(44),isRegExp:r(196),isSafeInteger:r(198),isSet:r(70),isString:r(79),isSymbol:r(43),isTypedArray:r(27),isUndefined:r(199),isWeakMap:r(200),isWeakSet:r(201),lt:r(202),lte:r(204),toArray:r(205),toFinite:r(75),toInteger:r(30),toLength:r(213),toNumber:r(42),toPlainObject:r(214),toSafeInteger:r(215),toString:r(216)}},function(e,t,r){var n=r(8);e.exports=function(){if(!arguments.length)return[];var e=arguments[0];return n(e)?e:[e]}},function(e,t,r){var n=r(20),i=4;e.exports=function(e){return n(e,i)}},function(e,t){e.exports=function(){this.__data__=[],this.size=0}},function(e,t,r){var n=r(22),i=Array.prototype.splice;e.exports=function(e){var t=this.__data__,r=n(t,e);return!(r<0)&&(r==t.length-1?t.pop():i.call(t,r,1),--this.size,!0)}},function(e,t,r){var n=r(22);e.exports=function(e){var t=this.__data__,r=n(t,e);return r<0?void 0:t[r][1]}},function(e,t,r){var n=r(22);e.exports=function(e){return n(this.__data__,e)>-1}},function(e,t,r){var n=r(22);e.exports=function(e,t){var r=this.__data__,i=n(r,e);return i<0?(++this.size,r.push([e,t])):r[i][1]=t,this}},function(e,t,r){var n=r(21);e.exports=function(){this.__data__=new n,this.size=0}},function(e,t){e.exports=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}},function(e,t){e.exports=function(e){return this.__data__.get(e)}},function(e,t){e.exports=function(e){return this.__data__.has(e)}},function(e,t,r){var n=r(21),i=r(34),o=r(55),s=200;e.exports=function(e,t){var r=this.__data__;if(r instanceof n){var a=r.__data__;if(!i||a.length<s-1)return a.push([e,t]),this.size=++r.size,this;r=this.__data__=new o(a)}return r.set(e,t),this.size=r.size,this}},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){var n=r(12),i=Object.prototype,o=i.hasOwnProperty,s=i.toString,a=n?n.toStringTag:void 0;e.exports=function(e){var t=o.call(e,a),r=e[a];try{e[a]=void 0;var n=!0}catch(e){}var i=s.call(e);return n&&(t?e[a]=r:delete e[a]),i}},function(e,t){var r=Object.prototype.toString;e.exports=function(e){return r.call(e)}},function(e,t,r){var n,i=r(53),o=(n=/[^.]+$/.exec(i&&i.keys&&i.keys.IE_PROTO||""))?"Symbol(src)_1."+n:"";e.exports=function(e){return!!o&&o in e}},function(e,t){e.exports=function(e,t){return null==e?void 0:e[t]}},function(e,t,r){var n=r(119),i=r(21),o=r(34);e.exports=function(){this.size=0,this.__data__={hash:new n,map:new(o||i),string:new n}}},function(e,t,r){var n=r(120),i=r(121),o=r(122),s=r(123),a=r(124);function c(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}c.prototype.clear=n,c.prototype.delete=i,c.prototype.get=o,c.prototype.has=s,c.prototype.set=a,e.exports=c},function(e,t,r){var n=r(25);e.exports=function(){this.__data__=n?n(null):{},this.size=0}},function(e,t){e.exports=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}},function(e,t,r){var n=r(25),i="__lodash_hash_undefined__",o=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;if(n){var r=t[e];return r===i?void 0:r}return o.call(t,e)?t[e]:void 0}},function(e,t,r){var n=r(25),i=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;return n?void 0!==t[e]:i.call(t,e)}},function(e,t,r){var n=r(25),i="__lodash_hash_undefined__";e.exports=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=n&&void 0===t?i:t,this}},function(e,t,r){var n=r(26);e.exports=function(e){var t=n(this,e).delete(e);return this.size-=t?1:0,t}},function(e,t){e.exports=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}},function(e,t,r){var n=r(26);e.exports=function(e){return n(this,e).get(e)}},function(e,t,r){var n=r(26);e.exports=function(e){return n(this,e).has(e)}},function(e,t,r){var n=r(26);e.exports=function(e,t){var r=n(this,e),i=r.size;return r.set(e,t),this.size+=r.size==i?0:1,this}},function(e,t){e.exports=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n&&!1!==t(e[r],r,e););return e}},function(e,t,r){var n=r(10),i=function(){try{var e=n(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();e.exports=i},function(e,t,r){var n=r(17),i=r(13);e.exports=function(e,t){return e&&n(t,i(t),e)}},function(e,t){e.exports=function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}},function(e,t,r){var n=r(4),i=r(1),o="[object Arguments]";e.exports=function(e){return i(e)&&n(e)==o}},function(e,t){var r=9007199254740991,n=/^(?:0|[1-9]\d*)$/;e.exports=function(e,t){var i=typeof e;return!!(t=null==t?r:t)&&("number"==i||"symbol"!=i&&n.test(e))&&e>-1&&e%1==0&&e<t}},function(e,t,r){var n=r(4),i=r(37),o=r(1),s={};s["[object Float32Array]"]=s["[object Float64Array]"]=s["[object Int8Array]"]=s["[object Int16Array]"]=s["[object Int32Array]"]=s["[object Uint8Array]"]=s["[object Uint8ClampedArray]"]=s["[object Uint16Array]"]=s["[object Uint32Array]"]=!0,s["[object Arguments]"]=s["[object Array]"]=s["[object ArrayBuffer]"]=s["[object Boolean]"]=s["[object DataView]"]=s["[object Date]"]=s["[object Error]"]=s["[object Function]"]=s["[object Map]"]=s["[object Number]"]=s["[object Object]"]=s["[object RegExp]"]=s["[object Set]"]=s["[object String]"]=s["[object WeakMap]"]=!1,e.exports=function(e){return o(e)&&i(e.length)&&!!s[n(e)]}},function(e,t,r){var n=r(61)(Object.keys,Object);e.exports=n},function(e,t,r){var n=r(17),i=r(38);e.exports=function(e,t){return e&&n(t,i(t),e)}},function(e,t,r){var n=r(9),i=r(28),o=r(140),s=Object.prototype.hasOwnProperty;e.exports=function(e){if(!n(e))return o(e);var t=i(e),r=[];for(var a in e)("constructor"!=a||!t&&s.call(e,a))&&r.push(a);return r}},function(e,t){e.exports=function(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t}},function(e,t,r){(function(e){var n=r(7),i=t&&!t.nodeType&&t,o=i&&"object"==typeof e&&e&&!e.nodeType&&e,s=o&&o.exports===i?n.Buffer:void 0,a=s?s.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var r=e.length,n=a?a(r):new e.constructor(r);return e.copy(n),n}}).call(this,r(36)(e))},function(e,t,r){var n=r(17),i=r(39);e.exports=function(e,t){return n(e,i(e),t)}},function(e,t){e.exports=function(e,t){for(var r=-1,n=null==e?0:e.length,i=0,o=[];++r<n;){var s=e[r];t(s,r,e)&&(o[i++]=s)}return o}},function(e,t,r){var n=r(17),i=r(64);e.exports=function(e,t){return n(e,i(e),t)}},function(e,t,r){var n=r(67),i=r(64),o=r(38);e.exports=function(e){return n(e,o,i)}},function(e,t,r){var n=r(10)(r(7),"DataView");e.exports=n},function(e,t,r){var n=r(10)(r(7),"Promise");e.exports=n},function(e,t,r){var n=r(10)(r(7),"Set");e.exports=n},function(e,t,r){var n=r(10)(r(7),"WeakMap");e.exports=n},function(e,t){var r=Object.prototype.hasOwnProperty;e.exports=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&r.call(e,"index")&&(n.index=e.index,n.input=e.input),n}},function(e,t,r){var n=r(41),i=r(152),o=r(153),s=r(154),a=r(155),c="[object Boolean]",d="[object Date]",u="[object Map]",l="[object Number]",p="[object RegExp]",f="[object Set]",h="[object String]",g="[object Symbol]",v="[object ArrayBuffer]",m="[object DataView]",_="[object Float32Array]",S="[object Float64Array]",b="[object Int8Array]",y="[object Int16Array]",C="[object Int32Array]",E="[object Uint8Array]",T="[object Uint8ClampedArray]",P="[object Uint16Array]",w="[object Uint32Array]";e.exports=function(e,t,r){var R=e.constructor;switch(t){case v:return n(e);case c:case d:return new R(+e);case m:return i(e,r);case _:case S:case b:case y:case C:case E:case T:case P:case w:return a(e,r);case u:return new R;case l:case h:return new R(e);case p:return o(e);case f:return new R;case g:return s(e)}}},function(e,t,r){var n=r(41);e.exports=function(e,t){var r=t?n(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}},function(e,t){var r=/\w*$/;e.exports=function(e){var t=new e.constructor(e.source,r.exec(e));return t.lastIndex=e.lastIndex,t}},function(e,t,r){var n=r(12),i=n?n.prototype:void 0,o=i?i.valueOf:void 0;e.exports=function(e){return o?Object(o.call(e)):{}}},function(e,t,r){var n=r(41);e.exports=function(e,t){var r=t?n(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}},function(e,t,r){var n=r(157),i=r(40),o=r(28);e.exports=function(e){return"function"!=typeof e.constructor||o(e)?{}:n(i(e))}},function(e,t,r){var n=r(9),i=Object.create,o=function(){function e(){}return function(t){if(!n(t))return{};if(i)return i(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}();e.exports=o},function(e,t,r){var n=r(11),i=r(1),o="[object Map]";e.exports=function(e){return i(e)&&n(e)==o}},function(e,t,r){var n=r(11),i=r(1),o="[object Set]";e.exports=function(e){return i(e)&&n(e)==o}},function(e,t,r){var n=r(20),i=1,o=4;e.exports=function(e){return n(e,i|o)}},function(e,t,r){var n=r(20),i=1,o=4;e.exports=function(e,t){return n(e,i|o,t="function"==typeof t?t:void 0)}},function(e,t,r){var n=r(20),i=4;e.exports=function(e,t){return n(e,i,t="function"==typeof t?t:void 0)}},function(e,t,r){var n=r(164),i=r(13);e.exports=function(e,t){return null==t||n(e,t,i(t))}},function(e,t){e.exports=function(e,t,r){var n=r.length;if(null==e)return!n;for(e=Object(e);n--;){var i=r[n],o=t[i],s=e[i];if(void 0===s&&!(i in e)||!o(s))return!1}return!0}},function(e,t,r){var n=r(166),i=r(29)(n);e.exports=i},function(e,t){e.exports=function(e,t){return e>t}},function(e,t,r){var n=r(29)(function(e,t){return e>=t});e.exports=n},function(e,t,r){var n=r(169),i=r(14),o=r(15),s=o&&o.isArrayBuffer,a=s?i(s):n;e.exports=a},function(e,t,r){var n=r(4),i=r(1),o="[object ArrayBuffer]";e.exports=function(e){return i(e)&&n(e)==o}},function(e,t,r){var n=r(16),i=r(1);e.exports=function(e){return i(e)&&n(e)}},function(e,t,r){var n=r(4),i=r(1),o="[object Boolean]";e.exports=function(e){return!0===e||!1===e||i(e)&&n(e)==o}},function(e,t,r){var n=r(173),i=r(14),o=r(15),s=o&&o.isDate,a=s?i(s):n;e.exports=a},function(e,t,r){var n=r(4),i=r(1),o="[object Date]";e.exports=function(e){return i(e)&&n(e)==o}},function(e,t,r){var n=r(1),i=r(44);e.exports=function(e){return n(e)&&1===e.nodeType&&!i(e)}},function(e,t,r){var n=r(60),i=r(11),o=r(35),s=r(8),a=r(16),c=r(18),d=r(28),u=r(27),l="[object Map]",p="[object Set]",f=Object.prototype.hasOwnProperty;e.exports=function(e){if(null==e)return!0;if(a(e)&&(s(e)||"string"==typeof e||"function"==typeof e.splice||c(e)||u(e)||o(e)))return!e.length;var t=i(e);if(t==l||t==p)return!e.size;if(d(e))return!n(e).length;for(var r in e)if(f.call(e,r))return!1;return!0}},function(e,t,r){var n=r(45);e.exports=function(e,t){return n(e,t)}},function(e,t,r){var n=r(33),i=r(71),o=r(183),s=r(184),a=r(11),c=r(8),d=r(18),u=r(27),l=1,p="[object Arguments]",f="[object Array]",h="[object Object]",g=Object.prototype.hasOwnProperty;e.exports=function(e,t,r,v,m,_){var S=c(e),b=c(t),y=S?f:a(e),C=b?f:a(t),E=(y=y==p?h:y)==h,T=(C=C==p?h:C)==h,P=y==C;if(P&&d(e)){if(!d(t))return!1;S=!0,E=!1}if(P&&!E)return _||(_=new n),S||u(e)?i(e,t,r,v,m,_):o(e,t,y,r,v,m,_);if(!(r&l)){var w=E&&g.call(e,"__wrapped__"),R=T&&g.call(t,"__wrapped__");if(w||R){var I=w?e.value():e,x=R?t.value():t;return _||(_=new n),m(I,x,r,v,_)}}return!!P&&(_||(_=new n),s(e,t,r,v,m,_))}},function(e,t,r){var n=r(55),i=r(179),o=r(180);function s(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new n;++t<r;)this.add(e[t])}s.prototype.add=s.prototype.push=i,s.prototype.has=o,e.exports=s},function(e,t){var r="__lodash_hash_undefined__";e.exports=function(e){return this.__data__.set(e,r),this}},function(e,t){e.exports=function(e){return this.__data__.has(e)}},function(e,t){e.exports=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}},function(e,t){e.exports=function(e,t){return e.has(t)}},function(e,t,r){var n=r(12),i=r(68),o=r(23),s=r(71),a=r(72),c=r(73),d=1,u=2,l="[object Boolean]",p="[object Date]",f="[object Error]",h="[object Map]",g="[object Number]",v="[object RegExp]",m="[object Set]",_="[object String]",S="[object Symbol]",b="[object ArrayBuffer]",y="[object DataView]",C=n?n.prototype:void 0,E=C?C.valueOf:void 0;e.exports=function(e,t,r,n,C,T,P){switch(r){case y:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case b:return!(e.byteLength!=t.byteLength||!T(new i(e),new i(t)));case l:case p:case g:return o(+e,+t);case f:return e.name==t.name&&e.message==t.message;case v:case _:return e==t+"";case h:var w=a;case m:var R=n&d;if(w||(w=c),e.size!=t.size&&!R)return!1;var I=P.get(e);if(I)return I==t;n|=u,P.set(e,t);var x=s(w(e),w(t),n,C,T,P);return P.delete(e),x;case S:if(E)return E.call(e)==E.call(t)}return!1}},function(e,t,r){var n=r(66),i=1,o=Object.prototype.hasOwnProperty;e.exports=function(e,t,r,s,a,c){var d=r&i,u=n(e),l=u.length;if(l!=n(t).length&&!d)return!1;for(var p=l;p--;){var f=u[p];if(!(d?f in t:o.call(t,f)))return!1}var h=c.get(e);if(h&&c.get(t))return h==t;var g=!0;c.set(e,t),c.set(t,e);for(var v=d;++p<l;){var m=e[f=u[p]],_=t[f];if(s)var S=d?s(_,m,f,t,e,c):s(m,_,f,e,t,c);if(!(void 0===S?m===_||a(m,_,r,s,c):S)){g=!1;break}v||(v="constructor"==f)}if(g&&!v){var b=e.constructor,y=t.constructor;b!=y&&"constructor"in e&&"constructor"in t&&!("function"==typeof b&&b instanceof b&&"function"==typeof y&&y instanceof y)&&(g=!1)}return c.delete(e),c.delete(t),g}},function(e,t,r){var n=r(45);e.exports=function(e,t,r){var i=(r="function"==typeof r?r:void 0)?r(e,t):void 0;return void 0===i?n(e,t,void 0,r):!!i}},function(e,t,r){var n=r(4),i=r(1),o=r(44),s="[object DOMException]",a="[object Error]";e.exports=function(e){if(!i(e))return!1;var t=n(e);return t==a||t==s||"string"==typeof e.message&&"string"==typeof e.name&&!o(e)}},function(e,t,r){var n=r(7).isFinite;e.exports=function(e){return"number"==typeof e&&n(e)}},function(e,t,r){var n=r(76),i=r(77);e.exports=function(e,t){return e===t||n(e,t,i(t))}},function(e,t,r){var n=r(9);e.exports=function(e){return e==e&&!n(e)}},function(e,t,r){var n=r(76),i=r(77);e.exports=function(e,t,r){return r="function"==typeof r?r:void 0,n(e,t,i(t),r)}},function(e,t,r){var n=r(78);e.exports=function(e){return n(e)&&e!=+e}},function(e,t,r){var n=r(51),i=r(193),o="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.";e.exports=function(e){if(i(e))throw new Error(o);return n(e)}},function(e,t,r){var n=r(53),i=r(24),o=r(59),s=n?i:o;e.exports=s},function(e,t){e.exports=function(e){return null==e}},function(e,t){e.exports=function(e){return null===e}},function(e,t,r){var n=r(197),i=r(14),o=r(15),s=o&&o.isRegExp,a=s?i(s):n;e.exports=a},function(e,t,r){var n=r(4),i=r(1),o="[object RegExp]";e.exports=function(e){return i(e)&&n(e)==o}},function(e,t,r){var n=r(74),i=9007199254740991;e.exports=function(e){return n(e)&&e>=-i&&e<=i}},function(e,t){e.exports=function(e){return void 0===e}},function(e,t,r){var n=r(11),i=r(1),o="[object WeakMap]";e.exports=function(e){return i(e)&&n(e)==o}},function(e,t,r){var n=r(4),i=r(1),o="[object WeakSet]";e.exports=function(e){return i(e)&&n(e)==o}},function(e,t,r){var n=r(203),i=r(29)(n);e.exports=i},function(e,t){e.exports=function(e,t){return e<t}},function(e,t,r){var n=r(29)(function(e,t){return e<=t});e.exports=n},function(e,t,r){var n=r(12),i=r(62),o=r(11),s=r(16),a=r(79),c=r(206),d=r(72),u=r(73),l=r(207),p=r(211),f="[object Map]",h="[object Set]",g=n?n.iterator:void 0;e.exports=function(e){if(!e)return[];if(s(e))return a(e)?l(e):i(e);if(g&&e[g])return c(e[g]());var t=o(e);return(t==f?d:t==h?u:p)(e)}},function(e,t){e.exports=function(e){for(var t,r=[];!(t=e.next()).done;)r.push(t.value);return r}},function(e,t,r){var n=r(208),i=r(209),o=r(210);e.exports=function(e){return i(e)?o(e):n(e)}},function(e,t){e.exports=function(e){return e.split("")}},function(e,t){var r=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");e.exports=function(e){return r.test(e)}},function(e,t){var r="[\\ud800-\\udfff]",n="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",i="\\ud83c[\\udffb-\\udfff]",o="[^\\ud800-\\udfff]",s="(?:\\ud83c[\\udde6-\\uddff]){2}",a="[\\ud800-\\udbff][\\udc00-\\udfff]",c="(?:"+n+"|"+i+")"+"?",d="[\\ufe0e\\ufe0f]?"+c+("(?:\\u200d(?:"+[o,s,a].join("|")+")[\\ufe0e\\ufe0f]?"+c+")*"),u="(?:"+[o+n+"?",n,s,a,r].join("|")+")",l=RegExp(i+"(?="+i+")|"+u+d,"g");e.exports=function(e){return e.match(l)||[]}},function(e,t,r){var n=r(212),i=r(13);e.exports=function(e){return null==e?[]:n(e,i(e))}},function(e,t,r){var n=r(80);e.exports=function(e,t){return n(t,function(t){return e[t]})}},function(e,t,r){var n=r(81),i=r(30),o=4294967295;e.exports=function(e){return e?n(i(e),0,o):0}},function(e,t,r){var n=r(17),i=r(38);e.exports=function(e){return n(e,i(e))}},function(e,t,r){var n=r(81),i=r(30),o=9007199254740991;e.exports=function(e){return e?n(i(e),-o,o):0===e?e:0}},function(e,t,r){var n=r(217);e.exports=function(e){return null==e?"":n(e)}},function(e,t,r){var n=r(12),i=r(80),o=r(8),s=r(43),a=1/0,c=n?n.prototype:void 0,d=c?c.toString:void 0;e.exports=function e(t){if("string"==typeof t)return t;if(o(t))return i(t,e)+"";if(s(t))return d?d.call(t):"";var r=t+"";return"0"==r&&1/t==-a?"-0":r}},function(e,t,r){var n,i;n=[r(5),r(0),r(2)],void 0===(i=function(e,t,r){"use strict";var n=Math.max,i=Math.sqrt,o=t.stringifyJSON,s=t.isObject,a=t.isFunction;function c(){e.call(this),this._logger=r.create("AudioProcess","console"),this._logger.verbose("AudioProcess()");this._bufferSize=1024,this._numInputChannels=2,this._numOutputChannels=2,this._channels=[],this._microphone=null,this._scriptProcessorNode=null,this.active=!1;var t=window.AudioContext||window.webkitAudioContext;a(t)?this._audioContext=new t:(this._logger.error("AudioProcess(): No browser audio context found"),this._audioContext=null)}var d=c.prototype=Object.create(e.prototype);function u(e,t){this._logger=r.create("AudioChannel","console"),this._logger.verbose("AudioChannel("+o(e)+", "+t+")");e=e||{},s(t)||this._logger.error("AudioChannel(): Param audioProcess must be of type object",2),this._audioProcess=t,this._level=0,this._maxLevel=0,this._oldLevel=0,this._id=e.id,this._name=e.name,this._channelData=void 0}return d.connect=function(e,t){var r,n;for(this._logger.verbose("connect("+o(e)+", "+o(t)+")"),t=t||{bufferSize:1024,numInputChannels:2,numOutputChannels:2,channels:[{name:"left",id:0},{name:"right",id:1}]},this._bufferSize=t.bufferSize||1024,this._numInputChannels=t.numInputChannels||2,this._numOutputChannels=t.numOutputChannels||2,this._channels=[],r=0,n=t.channels.length;r<n;r++)this._channels.push(new u(t.channels[r],this));if(e){var i=e.getAudioTracks();if(i&&i.length>0){var s=this._scriptProcessorNode=this._audioContext.createScriptProcessor(this._bufferSize,this._numInputChannels,this._numOutputChannels);this._microphone=this._audioContext.createMediaStreamSource(e),this._microphone.connect(s),s.connect(this._audioContext.destination),s.onaudioprocess=this._onAudioProcess.bind(this),this.active=!0}else this.emitSimple("AudioNoTrack",{stream:e})}else this.emitSimple("AudioNoStream",{stream:e})},d.resume=function(){"suspended"===this._audioContext.state&&this._audioContext.resume()},d.reset=function(){this._logger.verbose("reset()"),this.active=!1,this._microphone=null,this._scriptProcessorNode=null},d._onAudioProcess=function(e){if(this.active){var t,r,n=e.inputBuffer,i=this._channels,o=this;setTimeout(function(){var e=[];for(t=0,r=i.length;t<r;t++)i[t].update(n.getChannelData(t)),e.push(i[t].getChannelData());o.emitSimple("AudioProcess",{channels:e})},0)}},u.prototype.update=function(e){this._channelData=e;var t,r=0,o=e.length;for(t=0;t<o;t++)r+=e[t]*e[t];this._level=i(r/(o||1)),this._maxLevel=n(this._level,this._maxLevel),this._oldLevel=n(this._level,this._oldLevel-.008)},u.prototype.getChannelData=function(){return{maxLevel:this._maxLevel,oldLevel:this._oldLevel,avgLevel:this._level,name:this._name,id:this._id}},c}.apply(t,n))||(e.exports=i)}]);