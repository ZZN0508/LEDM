(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5154],{35154:function(n,e,i){"use strict";i.r(e),i.d(e,{default:function(){return R}});var t=i(47568),l=i(26042),r=i(10253),o=i(70655),a=i(85893),d=i(41592),c=i(80142),u=i(60730),s=i(67059),v=i(60645),f=i(10449),_=i(96638),p=i(13013),h=i(94184),b=i.n(h),m=i(96486),g=i(67294),x=i(34394),w=i(77252),Z=i(10124),k=i(38122),y=i(25666),N=i(83244),j=i(8348),S=i.n(j),C={threshold:200,gutter:2,columnSize:82.5,brickId:"pin_id"},E={endMessage:null,loader:null};function I(n){var e=n.pin,i=n.board,u=null===e||void 0===e?void 0:e.pin_id,s=(null===e||void 0===e?void 0:e.board_id)||(null===i||void 0===i?void 0:i.board_id),p=(0,r.Z)((0,_.Z)({max:0,boardId:null}),2),h=p[0],k=p[1],j=(0,r.Z)((0,_.Z)({since:0,boardId:null}),2),I=j[0],R=j[1],A=(0,g.useState)(!0),L=A[0],M=A[1],K=(0,g.useState)([]),P=K[0],T=K[1],O=(0,g.useRef)(null),D=(0,g.useRef)(!0),Y=(0,c.Z)((function(n){return n.pinOpenType}));(0,f.Z)((0,t.Z)((function(){var n,e,i,t;return(0,o.__generator)(this,(function(r){switch(r.label){case 0:return n=h.max,(e=h.boardId)?[4,(0,w._Hf)((0,l.Z)({board_id:e,limit:20},u?{pin_id:u}:null,n?{max:n}:null))]:[2];case 1:return i=r.sent(),(t=(null===i||void 0===i?void 0:i.pins)||[]).length<=0&&M(!1),T(P.concat(t)),[2]}}))})),{refreshDeps:[h]}),(0,f.Z)((0,t.Z)((function(){var n,e,i,t;return(0,o.__generator)(this,(function(r){switch(r.label){case 0:return n=I.since,(e=I.boardId)&&n&&D.current?[4,(0,w._Hf)((0,l.Z)({board_id:e,limit:20},u?{pin_id:u}:null,n?{since:n}:null))]:[2];case 1:return i=r.sent(),(t=(null===i||void 0===i?void 0:i.pins)||[]).length<=0&&(D.current=!1),T(t.concat(P)),[2]}}))})),{refreshDeps:[I]}),(0,g.useEffect)((function(){s&&(M(!0),T([]),k({boardId:s,max:0}),R({boardId:s,since:0}),D.current=!0)}),[s,k,R]);var z=(0,g.useCallback)((function(n){var e=n.pin_id,i=n.file;Y!==d.fj.BLANK?(c.Z.setState({currentPin:{pinId:e,file:i,currentSrc:(0,Z.ZP)(n.file,{width:82.5})}}),window.history.pushState(null,null,"/pins/".concat(e))):window.open("/pins/".concat(e))}),[Y]),X=(0,g.useCallback)((function(n){var e,i,t,l,r,o=Math.min(260,Math.round((null===(e=n.file)||void 0===e?void 0:e.height)/(null===(i=n.file)||void 0===i?void 0:i.width)*82.5));return(0,a.jsx)("a",{className:b()([S().item,u===(null===n||void 0===n?void 0:n.pin_id)?S().active:null]),href:"/pins/".concat(null===n||void 0===n?void 0:n.pin_id),style:{height:o},onClick:function(e){e.metaKey||e.ctrlKey||(e.preventDefault(),z(n))},"data-gd-expose":"content_expose","data-content-type":(0,v.w)(null===n||void 0===n?void 0:n.extra),"data-gd-click":"material_click","data-content-id":n.pin_id,"data-material-id":null===(t=n.extra)||void 0===t?void 0:t.material_id,"data-file-id":n.file_id,"data-board-id":s,children:(0,a.jsx)("div",{className:S().img,children:(0,a.jsx)(N.Z,{onLoad:function(n){var e=n.target;null===e||void 0===e||e.classList.add("transparent-img-bg")},src:(0,Z.ZP)(n.file,{width:82.5}),width:82.5,height:Math.round((null===(l=n.file)||void 0===l?void 0:l.height)/(null===(r=n.file)||void 0===r?void 0:r.width)*82.5),alt:n.raw_text,showError:!0})})},n.pin_id)}),[u,z,s]);return(0,g.useEffect)((function(){var n,e=(0,m.throttle)((function(n){if(n.target.scrollTop<=0&&P.length>0){var e=P[0];R({since:e.seq||e.pin_id})}}),1e3);return null===(n=O.current)||void 0===n||n.addEventListener("scroll",e),function(){var n;null===(n=O.current)||void 0===n||n.removeEventListener("scroll",e)}}),[P,R]),(0,a.jsx)("div",{className:S().gallery,"data-content-source":"\u753b\u677f\u9884\u89c8",ref:O,children:(0,a.jsx)(x.nA,{condition:O.current,children:(0,a.jsx)(y.Z,{dataSource:P,scrollableTarget:O.current,render:X,hasMore:L,onLoadMore:function(){if(P.length>0){var n=P[P.length-1];k({max:n.seq||n.pin_id})}},masonryOptions:C,infiniteScrollOptions:E})})})}function R(n){var e=n.pin,i=n.board,t=n.className,l=(null===e||void 0===e?void 0:e.board_id)||(null===i||void 0===i?void 0:i.board_id),r=(0,g.useRef)(null),o=(0,g.useState)("topRight"),d=o[0],c=o[1],v=(0,g.useMemo)((function(){var n,t,l,r;return(0,a.jsxs)("div",{className:S().preview,children:[(0,a.jsx)(I,{pin:e,board:i}),(0,a.jsx)(x.nA,{condition:e,children:(0,a.jsxs)("div",{className:S().info,children:[(0,a.jsx)("a",{className:S().title,href:"/boards/".concat(null===e||void 0===e?void 0:e.board_id),"data-gd-click":"button_click","data-button-name":"\u53bb\u753b\u677f",target:"_blank",title:(null===e||void 0===e||null===(n=e.board)||void 0===n?void 0:n.title)||"\u67e5\u770b\u753b\u677f",rel:"noreferrer",children:null===e||void 0===e||null===(t=e.board)||void 0===t?void 0:t.title}),(0,a.jsxs)("div",{className:S().num,children:[(0,s.Z)(null===e||void 0===e||null===(l=e.board)||void 0===l?void 0:l.pin_count),"\u91c7\u96c6 \xb7"," ",(0,s.Z)(null===e||void 0===e||null===(r=e.board)||void 0===r?void 0:r.follow_count),"\u4eba\u5173\u6ce8"]})]})})]})}),[e,i]),f=(0,g.useCallback)((function(n){if(n){var e,i=(null===(e=r.current)||void 0===e?void 0:e.getBoundingClientRect())||{},t=i.top-400,l=i.left-344,o="";o=t<0?"bottom":"top",c(o+=l<=0?"Left":"Right"),(0,u.w)(r.current)}}),[]);return(0,a.jsx)(p.Z,{overlayClassName:S().overlay,overlay:v,destroyPopupOnHide:!0,onVisibleChange:f,placement:d,children:(0,a.jsx)("a",{className:b()([S().button,t]),ref:r,"data-button-name":"\u753b\u677f\u9884\u89c8","data-board-id":l,target:"_blank",href:"/boards/".concat(l),rel:"noreferrer",title:"\u753b\u677f\u9884\u89c8",children:(0,a.jsx)(k.Z,{type:"dashboard"})})})}},8348:function(n){n.exports={"color-primary":"__0TY6OvQf","color-text-1":"AE_muQIN","color-text-2":"__2cB_j7V_","color-text-3":"DT8p5WQK","font-sm":"__6WksxGpi","font-md":"KSM11O4b","font-lg":"eNLbE4nN","font-bg":"__6x8FCCtS","single-line-ellipsis":"__9d25VbrR","vertical-center":"YKGXk1a7","justify-center":"TnKHJiUt","drop-list-wrap":"kQyN_4gR","list-item":"RAr85cIw",separate:"eaY534P4","grid-bg":"zwrYZkZu","line-bg":"ERAYFvsx",tip:"dBDX_3tC","primary-btn":"PYGbNVPL","primary-text-btn":"ry2d_0kU","thin-scroll-bar":"__0l2rtqaw",preview:"__2f5kFWnt",gallery:"hAfizvb6",item:"lNbmCSD5",img:"__9nMOSnZA",active:"vovGPK7A",info:"__3mZJ2X_J",title:"urXh1zSX",num:"FT0_0l23",button:"__0ykT6zvg"}}}]);
//# sourceMappingURL=5154.2e93261199d0a588.js.map