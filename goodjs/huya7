/*!
 * Version v1.2.9
 * Author: linguangwen@huya.com
 * Date: Wed Jun 23 2021 10:58:44 GMT+0800 (GMT+08:00)
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.abtest=e():t.abtest=e()}(window,(function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=0)}([function(t,e,r){"use strict";function n(t){return!t||!/\S/.test(t)||"undefined"===t||"null"===t}function o(t){for(var e=document.cookie.split("; "),r=0;r<e.length;r++){var n=e[r].replace("=","$=").split("$=");try{if(n[0]==t)return decodeURIComponent(n[1])}catch(e){if(n[0]==t)return unescape(n[1])}}return""}function i(t,e){try{n(a(t))||function(t){try{localStorage.removeItem(t)}catch(t){console.log(t)}}(t),"string"==typeof e?window.localStorage.setItem(t,e):window.localStorage.setItem(t,JSON.stringify(e))}catch(a){console.log("e:"+a),r=t,o=JSON.stringify(e),c=i||8,s=r+"="+encodeURIComponent(o),u=new Date,l=3600*c*1e3,u.setTime(u.getTime()+l),s+="; expires="+u.toUTCString(),n(location.port)&&(s+="; domain="+document.domain),s+="; path=/",document.cookie=s}var r,o,i,c,s,u,l}function a(t){try{return JSON.parse(localStorage.getItem(t))||JSON.parse(o(t)||null)}catch(e){return n(o(t))?(console.log("e:"+e),null):JSON.parse(o(t)||null)}}r.r(e);var c="https://wsapi-global.master.live",s="https://cdnws.api.huya.com",u="https://testws.va.huya.com";function l(t,e,r){return new Promise((function(n,o){var a=t.platform,l=t.businessId,f=t.uid,p=t.guid,m=t.env,d=t.variable;isNaN(Number(f))&&o("Illegal uid format, requires int uid");var h={tReq:{lUid:Number(f),sUA:"".concat(a,"&1.0.0&store"),sGuid:p,mpVariable:d,sAppId:l}},y=function(){if(void 0!==window.XMLHttpRequest)return new XMLHttpRequest;if(void 0!==window.ActiveXObject){if("string"!=typeof arguments.callee.activeXString)for(var t=["MSXML2.XMLHttp.6.0","Msxml2.XMLHttp.5.0","Msxml2.XMLHttp.4.0","MSXML2.XMLHttp.3.0",,"Msxml2.XMLHttp","MSXML2.XMLHttp"],e=0,r=t.length;e<r;e++)try{var n=new window.ActiveXObject(t[e]);return arguments.callee.activeXString=t[e],n}catch(t){throw console.warn("do not support XHR"),new Error(t)}return new window.ActiveXObject(arguments.callee.activeXString)}throw new Error("No XHR object available")}();y.open("POST","".concat(m?u:"huya"===l?s:c,"?json_func=getConfig")),y.timeout=3e3,y.ontimeout=function(){o("timed out")},y.onerror=function(t){o(t)},y.onload=function(){try{this.response||o("abtestconfig fetch fail");var t=JSON.parse(this.response).tRsp;if(200!=this.status&&304!=this.status)return void o("请求异常");var a=t.mpConfig,c=t.mpExperiment,s=[];for(var u in c)s.push("".concat(u,".").concat(c[u]));r[e]=Object.assign({},{mpExperiment:s.join(","),mpConfig:a}),i("AB_SRE_CONFIGS",r),n(r[e]||{})}catch(t){o(t)}},y.send(JSON.stringify(h))}))}function f(t,e,r){var n=t.platform,o=t.businessId,i=t.uid,a=t.guid,l=t.env,f=t.variable;isNaN(Number(i))&&reject("Illegal uid format, requires int uid");var p={tReq:{lUid:Number(i),sUA:"".concat(n,"&1.0.0&store"),sGuid:a,mpVariable:f,sAppId:o}};return new Promise((function(t,n){wx.request({url:"".concat(l?u:"huya"===o?s:c,"?json_func=getConfig"),data:p,method:"GET",success:function(o){try{o||n("abtestconfig fetch fail");var i=o.data.tRsp;if(200!=o.statusCode&&304!=o.statusCode)return void n("请求异常");var a=i.mpConfig,c=i.mpExperiment,s=[];for(var u in c)s.push("".concat(u,".").concat(c[u]));r[e]=Object.assign({},{mpExperiment:s.join(","),mpConfig:a}),wx.setStorage({key:"AB_SRE_CONFIGS",data:r}),t(r[e]||{})}catch(t){n(t)}},fail:function(t){n(t)}})}))}function p(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var m=function(){function t(e,r){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),!e||"[object Object]"!==Object.prototype.toString.call(e))throw Error("the params parameter of getABExtParam must be Object");this.params=e,this.type=r&&r.type?r.type:"web",this.time=r&&r.loopTime&&!isNaN(Number(r.loopTime))&&0!==Number(r.loopTime)?1e3*Number(r.loopTime):6e5,this.timer={},this.startSetInterval()}var e,r,n;return e=t,(r=[{key:"startSetInterval",value:function(){try{var t=this.getConfigAndKey(),e=t.thisKey,r=t.AB_SRE_CONFIGS;"wx"===this.type?f(this.params,e,r):l(this.params,e,r);var n=this;setInterval((function(){"wx"===n.type?f(n.params,e,r):l(n.params,e,r)}),this.time)}catch(t){throw new Error(t)}}},{key:"getABExtParam",value:function(){try{var t=this.getConfigAndKey(),e=t.thisKey,r=t.AB_SRE_CONFIGS;return"wx"===this.type?f(this.params,e,r):l(this.params,e,r)}catch(t){throw new Error(t)}}},{key:"getSyncABExtParam",value:function(){try{var t=this.getConfigAndKey(),e=t.thisKey;return t.AB_SRE_CONFIGS[e]||{}}catch(t){throw new Error(t)}}},{key:"getConfigAndKey",value:function(){var t=this.type?this.type:"web",e=this.params,r=e.platform,n=e.businessId,o=e.uid,i=e.variable,c="wx"===t?wx.getStorageSync("AB_SRE_CONFIGS")||{}:a("AB_SRE_CONFIGS")||{},s=r+"_"+n+(o?"_uid_".concat(o):"_no_login_data");if(i||"undefined"!==i)for(var u in i)s+="_".concat(u,"_").concat(i[u]);if(!i||"[object Object]"!==Object.prototype.toString.call(i))throw Error("the variable parameter of params must be Object");return{thisKey:s,AB_SRE_CONFIGS:c}}}])&&p(e.prototype,r),n&&p(e,n),t}();e.default=m;window.ABTEST=m}])}));