/*! For license information please see 4949.317c0c1d.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).xss={})}(this,(function(t){"use strict";var e=function(){return e=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},e.apply(this,arguments)};function r(t,e,r){if(r||2===arguments.length)for(var n,i=0,o=e.length;i<o;i++)!n&&i in e||(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))}var n={exports:{}},i={},o={exports:{}},a={};function s(){return{"align-content":!1,"align-items":!1,"align-self":!1,"alignment-adjust":!1,"alignment-baseline":!1,all:!1,"anchor-point":!1,animation:!1,"animation-delay":!1,"animation-direction":!1,"animation-duration":!1,"animation-fill-mode":!1,"animation-iteration-count":!1,"animation-name":!1,"animation-play-state":!1,"animation-timing-function":!1,azimuth:!1,"backface-visibility":!1,background:!0,"background-attachment":!0,"background-clip":!0,"background-color":!0,"background-image":!0,"background-origin":!0,"background-position":!0,"background-repeat":!0,"background-size":!0,"baseline-shift":!1,binding:!1,bleed:!1,"bookmark-label":!1,"bookmark-level":!1,"bookmark-state":!1,border:!0,"border-bottom":!0,"border-bottom-color":!0,"border-bottom-left-radius":!0,"border-bottom-right-radius":!0,"border-bottom-style":!0,"border-bottom-width":!0,"border-collapse":!0,"border-color":!0,"border-image":!0,"border-image-outset":!0,"border-image-repeat":!0,"border-image-slice":!0,"border-image-source":!0,"border-image-width":!0,"border-left":!0,"border-left-color":!0,"border-left-style":!0,"border-left-width":!0,"border-radius":!0,"border-right":!0,"border-right-color":!0,"border-right-style":!0,"border-right-width":!0,"border-spacing":!0,"border-style":!0,"border-top":!0,"border-top-color":!0,"border-top-left-radius":!0,"border-top-right-radius":!0,"border-top-style":!0,"border-top-width":!0,"border-width":!0,bottom:!1,"box-decoration-break":!0,"box-shadow":!0,"box-sizing":!0,"box-snap":!0,"box-suppress":!0,"break-after":!0,"break-before":!0,"break-inside":!0,"caption-side":!1,chains:!1,clear:!0,clip:!1,"clip-path":!1,"clip-rule":!1,color:!0,"color-interpolation-filters":!0,"column-count":!1,"column-fill":!1,"column-gap":!1,"column-rule":!1,"column-rule-color":!1,"column-rule-style":!1,"column-rule-width":!1,"column-span":!1,"column-width":!1,columns:!1,contain:!1,content:!1,"counter-increment":!1,"counter-reset":!1,"counter-set":!1,crop:!1,cue:!1,"cue-after":!1,"cue-before":!1,cursor:!1,direction:!1,display:!0,"display-inside":!0,"display-list":!0,"display-outside":!0,"dominant-baseline":!1,elevation:!1,"empty-cells":!1,filter:!1,flex:!1,"flex-basis":!1,"flex-direction":!1,"flex-flow":!1,"flex-grow":!1,"flex-shrink":!1,"flex-wrap":!1,float:!1,"float-offset":!1,"flood-color":!1,"flood-opacity":!1,"flow-from":!1,"flow-into":!1,font:!0,"font-family":!0,"font-feature-settings":!0,"font-kerning":!0,"font-language-override":!0,"font-size":!0,"font-size-adjust":!0,"font-stretch":!0,"font-style":!0,"font-synthesis":!0,"font-variant":!0,"font-variant-alternates":!0,"font-variant-caps":!0,"font-variant-east-asian":!0,"font-variant-ligatures":!0,"font-variant-numeric":!0,"font-variant-position":!0,"font-weight":!0,grid:!1,"grid-area":!1,"grid-auto-columns":!1,"grid-auto-flow":!1,"grid-auto-rows":!1,"grid-column":!1,"grid-column-end":!1,"grid-column-start":!1,"grid-row":!1,"grid-row-end":!1,"grid-row-start":!1,"grid-template":!1,"grid-template-areas":!1,"grid-template-columns":!1,"grid-template-rows":!1,"hanging-punctuation":!1,height:!0,hyphens:!1,icon:!1,"image-orientation":!1,"image-resolution":!1,"ime-mode":!1,"initial-letters":!1,"inline-box-align":!1,"justify-content":!1,"justify-items":!1,"justify-self":!1,left:!1,"letter-spacing":!0,"lighting-color":!0,"line-box-contain":!1,"line-break":!1,"line-grid":!1,"line-height":!1,"line-snap":!1,"line-stacking":!1,"line-stacking-ruby":!1,"line-stacking-shift":!1,"line-stacking-strategy":!1,"list-style":!0,"list-style-image":!0,"list-style-position":!0,"list-style-type":!0,margin:!0,"margin-bottom":!0,"margin-left":!0,"margin-right":!0,"margin-top":!0,"marker-offset":!1,"marker-side":!1,marks:!1,mask:!1,"mask-box":!1,"mask-box-outset":!1,"mask-box-repeat":!1,"mask-box-slice":!1,"mask-box-source":!1,"mask-box-width":!1,"mask-clip":!1,"mask-image":!1,"mask-origin":!1,"mask-position":!1,"mask-repeat":!1,"mask-size":!1,"mask-source-type":!1,"mask-type":!1,"max-height":!0,"max-lines":!1,"max-width":!0,"min-height":!0,"min-width":!0,"move-to":!1,"nav-down":!1,"nav-index":!1,"nav-left":!1,"nav-right":!1,"nav-up":!1,"object-fit":!1,"object-position":!1,opacity:!1,order:!1,orphans:!1,outline:!1,"outline-color":!1,"outline-offset":!1,"outline-style":!1,"outline-width":!1,overflow:!1,"overflow-wrap":!1,"overflow-x":!1,"overflow-y":!1,padding:!0,"padding-bottom":!0,"padding-left":!0,"padding-right":!0,"padding-top":!0,page:!1,"page-break-after":!1,"page-break-before":!1,"page-break-inside":!1,"page-policy":!1,pause:!1,"pause-after":!1,"pause-before":!1,perspective:!1,"perspective-origin":!1,pitch:!1,"pitch-range":!1,"play-during":!1,position:!1,"presentation-level":!1,quotes:!1,"region-fragment":!1,resize:!1,rest:!1,"rest-after":!1,"rest-before":!1,richness:!1,right:!1,rotation:!1,"rotation-point":!1,"ruby-align":!1,"ruby-merge":!1,"ruby-position":!1,"shape-image-threshold":!1,"shape-outside":!1,"shape-margin":!1,size:!1,speak:!1,"speak-as":!1,"speak-header":!1,"speak-numeral":!1,"speak-punctuation":!1,"speech-rate":!1,stress:!1,"string-set":!1,"tab-size":!1,"table-layout":!1,"text-align":!0,"text-align-last":!0,"text-combine-upright":!0,"text-decoration":!0,"text-decoration-color":!0,"text-decoration-line":!0,"text-decoration-skip":!0,"text-decoration-style":!0,"text-emphasis":!0,"text-emphasis-color":!0,"text-emphasis-position":!0,"text-emphasis-style":!0,"text-height":!0,"text-indent":!0,"text-justify":!0,"text-orientation":!0,"text-overflow":!0,"text-shadow":!0,"text-space-collapse":!0,"text-transform":!0,"text-underline-position":!0,"text-wrap":!0,top:!1,transform:!1,"transform-origin":!1,"transform-style":!1,transition:!1,"transition-delay":!1,"transition-duration":!1,"transition-property":!1,"transition-timing-function":!1,"unicode-bidi":!1,"vertical-align":!1,visibility:!1,"voice-balance":!1,"voice-duration":!1,"voice-family":!1,"voice-pitch":!1,"voice-range":!1,"voice-rate":!1,"voice-stress":!1,"voice-volume":!1,volume:!1,"white-space":!1,widows:!1,width:!0,"will-change":!1,"word-break":!0,"word-spacing":!0,"word-wrap":!0,"wrap-flow":!1,"wrap-through":!1,"writing-mode":!1,"z-index":!1}}var l=/javascript\s*\:/gim;a.whiteList={"align-content":!1,"align-items":!1,"align-self":!1,"alignment-adjust":!1,"alignment-baseline":!1,all:!1,"anchor-point":!1,animation:!1,"animation-delay":!1,"animation-direction":!1,"animation-duration":!1,"animation-fill-mode":!1,"animation-iteration-count":!1,"animation-name":!1,"animation-play-state":!1,"animation-timing-function":!1,azimuth:!1,"backface-visibility":!1,background:!0,"background-attachment":!0,"background-clip":!0,"background-color":!0,"background-image":!0,"background-origin":!0,"background-position":!0,"background-repeat":!0,"background-size":!0,"baseline-shift":!1,binding:!1,bleed:!1,"bookmark-label":!1,"bookmark-level":!1,"bookmark-state":!1,border:!0,"border-bottom":!0,"border-bottom-color":!0,"border-bottom-left-radius":!0,"border-bottom-right-radius":!0,"border-bottom-style":!0,"border-bottom-width":!0,"border-collapse":!0,"border-color":!0,"border-image":!0,"border-image-outset":!0,"border-image-repeat":!0,"border-image-slice":!0,"border-image-source":!0,"border-image-width":!0,"border-left":!0,"border-left-color":!0,"border-left-style":!0,"border-left-width":!0,"border-radius":!0,"border-right":!0,"border-right-color":!0,"border-right-style":!0,"border-right-width":!0,"border-spacing":!0,"border-style":!0,"border-top":!0,"border-top-color":!0,"border-top-left-radius":!0,"border-top-right-radius":!0,"border-top-style":!0,"border-top-width":!0,"border-width":!0,bottom:!1,"box-decoration-break":!0,"box-shadow":!0,"box-sizing":!0,"box-snap":!0,"box-suppress":!0,"break-after":!0,"break-before":!0,"break-inside":!0,"caption-side":!1,chains:!1,clear:!0,clip:!1,"clip-path":!1,"clip-rule":!1,color:!0,"color-interpolation-filters":!0,"column-count":!1,"column-fill":!1,"column-gap":!1,"column-rule":!1,"column-rule-color":!1,"column-rule-style":!1,"column-rule-width":!1,"column-span":!1,"column-width":!1,columns:!1,contain:!1,content:!1,"counter-increment":!1,"counter-reset":!1,"counter-set":!1,crop:!1,cue:!1,"cue-after":!1,"cue-before":!1,cursor:!1,direction:!1,display:!0,"display-inside":!0,"display-list":!0,"display-outside":!0,"dominant-baseline":!1,elevation:!1,"empty-cells":!1,filter:!1,flex:!1,"flex-basis":!1,"flex-direction":!1,"flex-flow":!1,"flex-grow":!1,"flex-shrink":!1,"flex-wrap":!1,float:!1,"float-offset":!1,"flood-color":!1,"flood-opacity":!1,"flow-from":!1,"flow-into":!1,font:!0,"font-family":!0,"font-feature-settings":!0,"font-kerning":!0,"font-language-override":!0,"font-size":!0,"font-size-adjust":!0,"font-stretch":!0,"font-style":!0,"font-synthesis":!0,"font-variant":!0,"font-variant-alternates":!0,"font-variant-caps":!0,"font-variant-east-asian":!0,"font-variant-ligatures":!0,"font-variant-numeric":!0,"font-variant-position":!0,"font-weight":!0,grid:!1,"grid-area":!1,"grid-auto-columns":!1,"grid-auto-flow":!1,"grid-auto-rows":!1,"grid-column":!1,"grid-column-end":!1,"grid-column-start":!1,"grid-row":!1,"grid-row-end":!1,"grid-row-start":!1,"grid-template":!1,"grid-template-areas":!1,"grid-template-columns":!1,"grid-template-rows":!1,"hanging-punctuation":!1,height:!0,hyphens:!1,icon:!1,"image-orientation":!1,"image-resolution":!1,"ime-mode":!1,"initial-letters":!1,"inline-box-align":!1,"justify-content":!1,"justify-items":!1,"justify-self":!1,left:!1,"letter-spacing":!0,"lighting-color":!0,"line-box-contain":!1,"line-break":!1,"line-grid":!1,"line-height":!1,"line-snap":!1,"line-stacking":!1,"line-stacking-ruby":!1,"line-stacking-shift":!1,"line-stacking-strategy":!1,"list-style":!0,"list-style-image":!0,"list-style-position":!0,"list-style-type":!0,margin:!0,"margin-bottom":!0,"margin-left":!0,"margin-right":!0,"margin-top":!0,"marker-offset":!1,"marker-side":!1,marks:!1,mask:!1,"mask-box":!1,"mask-box-outset":!1,"mask-box-repeat":!1,"mask-box-slice":!1,"mask-box-source":!1,"mask-box-width":!1,"mask-clip":!1,"mask-image":!1,"mask-origin":!1,"mask-position":!1,"mask-repeat":!1,"mask-size":!1,"mask-source-type":!1,"mask-type":!1,"max-height":!0,"max-lines":!1,"max-width":!0,"min-height":!0,"min-width":!0,"move-to":!1,"nav-down":!1,"nav-index":!1,"nav-left":!1,"nav-right":!1,"nav-up":!1,"object-fit":!1,"object-position":!1,opacity:!1,order:!1,orphans:!1,outline:!1,"outline-color":!1,"outline-offset":!1,"outline-style":!1,"outline-width":!1,overflow:!1,"overflow-wrap":!1,"overflow-x":!1,"overflow-y":!1,padding:!0,"padding-bottom":!0,"padding-left":!0,"padding-right":!0,"padding-top":!0,page:!1,"page-break-after":!1,"page-break-before":!1,"page-break-inside":!1,"page-policy":!1,pause:!1,"pause-after":!1,"pause-before":!1,perspective:!1,"perspective-origin":!1,pitch:!1,"pitch-range":!1,"play-during":!1,position:!1,"presentation-level":!1,quotes:!1,"region-fragment":!1,resize:!1,rest:!1,"rest-after":!1,"rest-before":!1,richness:!1,right:!1,rotation:!1,"rotation-point":!1,"ruby-align":!1,"ruby-merge":!1,"ruby-position":!1,"shape-image-threshold":!1,"shape-outside":!1,"shape-margin":!1,size:!1,speak:!1,"speak-as":!1,"speak-header":!1,"speak-numeral":!1,"speak-punctuation":!1,"speech-rate":!1,stress:!1,"string-set":!1,"tab-size":!1,"table-layout":!1,"text-align":!0,"text-align-last":!0,"text-combine-upright":!0,"text-decoration":!0,"text-decoration-color":!0,"text-decoration-line":!0,"text-decoration-skip":!0,"text-decoration-style":!0,"text-emphasis":!0,"text-emphasis-color":!0,"text-emphasis-position":!0,"text-emphasis-style":!0,"text-height":!0,"text-indent":!0,"text-justify":!0,"text-orientation":!0,"text-overflow":!0,"text-shadow":!0,"text-space-collapse":!0,"text-transform":!0,"text-underline-position":!0,"text-wrap":!0,top:!1,transform:!1,"transform-origin":!1,"transform-style":!1,transition:!1,"transition-delay":!1,"transition-duration":!1,"transition-property":!1,"transition-timing-function":!1,"unicode-bidi":!1,"vertical-align":!1,visibility:!1,"voice-balance":!1,"voice-duration":!1,"voice-family":!1,"voice-pitch":!1,"voice-range":!1,"voice-rate":!1,"voice-stress":!1,"voice-volume":!1,volume:!1,"white-space":!1,widows:!1,width:!0,"will-change":!1,"word-break":!0,"word-spacing":!0,"word-wrap":!0,"wrap-flow":!1,"wrap-through":!1,"writing-mode":!1,"z-index":!1},a.getDefaultWhiteList=s,a.onAttr=function(t,e,r){},a.onIgnoreAttr=function(t,e,r){},a.safeAttrValue=function(t,e){return l.test(e)?"":e};var u={indexOf:function(t,e){var r,n;if(Array.prototype.indexOf)return t.indexOf(e);for(r=0,n=t.length;r<n;r++)if(t[r]===e)return r;return-1},forEach:function(t,e,r){var n,i;if(Array.prototype.forEach)return t.forEach(e,r);for(n=0,i=t.length;n<i;n++)e.call(r,t[n],n,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(t){return String.prototype.trimRight?t.trimRight():t.replace(/(\s*$)/g,"")}},c=u,h=a,f=function(t,e){";"!==(t=c.trimRight(t))[t.length-1]&&(t+=";");var r=t.length,n=!1,i=0,o=0,a="";function s(){if(!n){var r=c.trim(t.slice(i,o)),s=r.indexOf(":");if(-1!==s){var l=c.trim(r.slice(0,s)),u=c.trim(r.slice(s+1));if(l){var h=e(i,a.length,l,u,r);h&&(a+=h+"; ")}}}i=o+1}for(;o<r;o++){var l=t[o];if("/"===l&&"*"===t[o+1]){var u=t.indexOf("*/",o+2);if(-1===u)break;i=(o=u+1)+1,n=!1}else"("===l?n=!0:")"===l?n=!1:";"===l?n||s():"\n"===l&&s()}return c.trim(a)};function d(t){return null==t}function p(t){(t=function(t){var e={};for(var r in t)e[r]=t[r];return e}(t||{})).whiteList=t.whiteList||h.whiteList,t.onAttr=t.onAttr||h.onAttr,t.onIgnoreAttr=t.onIgnoreAttr||h.onIgnoreAttr,t.safeAttrValue=t.safeAttrValue||h.safeAttrValue,this.options=t}p.prototype.process=function(t){if(!(t=(t=t||"").toString()))return"";var e=this.options,r=e.whiteList,n=e.onAttr,i=e.onIgnoreAttr,o=e.safeAttrValue;return f(t,(function(t,e,a,s,l){var u=r[a],c=!1;if(!0===u?c=u:"function"==typeof u?c=u(s):u instanceof RegExp&&(c=u.test(s)),!0!==c&&(c=!1),s=o(a,s)){var h,f={position:e,sourcePosition:t,source:l,isWhite:c};return c?d(h=n(a,s,f))?a+":"+s:h:d(h=i(a,s,f))?void 0:h}}))};var g=p;!function(t,e){var r=a,n=g;for(var i in(e=t.exports=function(t,e){return new n(e).process(t)}).FilterCSS=n,r)e[i]=r[i];"undefined"!=typeof window&&(window.filterCSS=t.exports)}(o,o.exports);var v={indexOf:function(t,e){var r,n;if(Array.prototype.indexOf)return t.indexOf(e);for(r=0,n=t.length;r<n;r++)if(t[r]===e)return r;return-1},forEach:function(t,e,r){var n,i;if(Array.prototype.forEach)return t.forEach(e,r);for(n=0,i=t.length;n<i;n++)e.call(r,t[n],n,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(t){var e=/\s|\n|\t/.exec(t);return e?e.index:-1}},_=o.exports.FilterCSS,m=o.exports.getDefaultWhiteList,y=v;var b=new _;function w(t){return t.replace(k,"&lt;").replace(I,"&gt;")}var k=/</g,I=/>/g,C=/"/g,x=/&quot;/g,S=/&#([a-zA-Z0-9]*);?/gim,T=/&colon;?/gim,A=/&newline;?/gim,P=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,D=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,E=/u\s*r\s*l\s*\(.*/gi;function N(t){return t.replace(C,"&quot;")}function L(t){return t.replace(x,'"')}function O(t){return t.replace(S,(function(t,e){return"x"===e[0]||"X"===e[0]?String.fromCharCode(parseInt(e.substr(1),16)):String.fromCharCode(parseInt(e,10))}))}function R(t){return t.replace(T,":").replace(A," ")}function B(t){for(var e="",r=0,n=t.length;r<n;r++)e+=t.charCodeAt(r)<32?" ":t.charAt(r);return y.trim(e)}function M(t){return B(t=R(t=O(t=L(t))))}function j(t){return w(t=N(t))}i.whiteList={a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]},i.getDefaultWhiteList=function(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}},i.onTag=function(t,e,r){},i.onIgnoreTag=function(t,e,r){},i.onTagAttr=function(t,e,r){},i.onIgnoreTagAttr=function(t,e,r){},i.safeAttrValue=function(t,e,r,n){if(r=M(r),"href"===e||"src"===e){if("#"===(r=y.trim(r)))return"#";if("http://"!==r.substr(0,7)&&"https://"!==r.substr(0,8)&&"mailto:"!==r.substr(0,7)&&"tel:"!==r.substr(0,4)&&"data:image/"!==r.substr(0,11)&&"ftp://"!==r.substr(0,6)&&"./"!==r.substr(0,2)&&"../"!==r.substr(0,3)&&"#"!==r[0]&&"/"!==r[0])return""}else if("background"===e){if(P.lastIndex=0,P.test(r))return""}else if("style"===e){if(D.lastIndex=0,D.test(r))return"";if(E.lastIndex=0,E.test(r)&&(P.lastIndex=0,P.test(r)))return"";!1!==n&&(r=(n=n||b).process(r))}return j(r)},i.escapeHtml=w,i.escapeQuote=N,i.unescapeQuote=L,i.escapeHtmlEntities=O,i.escapeDangerHtml5Entities=R,i.clearNonPrintableCharacter=B,i.friendlyAttrValue=M,i.escapeAttrValue=j,i.onIgnoreTagStripAll=function(){return""},i.StripTagBody=function(t,e){"function"!=typeof e&&(e=function(){});var r=!Array.isArray(t),n=[],i=!1;return{onIgnoreTag:function(o,a,s){if(function(e){return!!r||-1!==y.indexOf(t,e)}(o)){if(s.isClosing){var l="[/removed]",u=s.position+10;return n.push([!1!==i?i:s.position,u]),i=!1,l}return i||(i=s.position),"[removed]"}return e(o,a,s)},remove:function(t){var e="",r=0;return y.forEach(n,(function(n){e+=t.slice(r,n[0]),r=n[1]})),e+=t.slice(r)}}},i.stripCommentTag=function(t){for(var e="",r=0;r<t.length;){var n=t.indexOf("\x3c!--",r);if(-1===n){e+=t.slice(r);break}e+=t.slice(r,n);var i=t.indexOf("--\x3e",n);if(-1===i)break;r=i+3}return e},i.stripBlankChar=function(t){var e=t.split("");return(e=e.filter((function(t){var e=t.charCodeAt(0);return!(127===e||e<=31&&10!==e&&13!==e)}))).join("")},i.cssFilter=b,i.getDefaultCSSWhiteList=m;var F={},q=v;function H(t){var e,r=q.spaceIndex(t);return e=-1===r?t.slice(1,-1):t.slice(1,r+1),"/"===(e=q.trim(e).toLowerCase()).slice(0,1)&&(e=e.slice(1)),"/"===e.slice(-1)&&(e=e.slice(0,-1)),e}function W(t){return"</"===t.slice(0,2)}var Z=/[^a-zA-Z0-9\\_:.-]/gim;function U(t,e){for(;e<t.length;e++){var r=t[e];if(" "!==r)return"="===r?e:-1}}function z(t,e){for(;e<t.length;e++){var r=t[e];if(" "!==r)return"'"===r||'"'===r?e:-1}}function K(t,e){for(;e>0;e--){var r=t[e];if(" "!==r)return"="===r?e:-1}}function V(t){return function(t){return'"'===t[0]&&'"'===t[t.length-1]||"'"===t[0]&&"'"===t[t.length-1]}(t)?t.substr(1,t.length-2):t}F.parseTag=function(t,e,r){var n="",i=0,o=!1,a=!1,s=0,l=t.length,u="",c="";t:for(s=0;s<l;s++){var h=t.charAt(s);if(!1===o){if("<"===h){o=s;continue}}else if(!1===a){if("<"===h){n+=r(t.slice(i,s)),o=s,i=s;continue}if(">"===h||s===l-1){n+=r(t.slice(i,o)),u=H(c=t.slice(o,s+1)),n+=e(o,n.length,u,c,W(c)),i=s+1,o=!1;continue}if('"'===h||"'"===h)for(var f=1,d=t.charAt(s-f);""===d.trim()||"="===d;){if("="===d){a=h;continue t}d=t.charAt(s-++f)}}else if(h===a){a=!1;continue}}return i<l&&(n+=r(t.substr(i))),n},F.parseAttr=function(t,e){var r=0,n=0,i=[],o=!1,a=t.length;function s(t,r){if(!((t=(t=q.trim(t)).replace(Z,"").toLowerCase()).length<1)){var n=e(t,r||"");n&&i.push(n)}}for(var l=0;l<a;l++){var u,c=t.charAt(l);if(!1!==o||"="!==c)if(!1===o||l!==n){if(/\s|\n|\t/.test(c)){if(t=t.replace(/\s|\n|\t/g," "),!1===o){if(-1===(u=U(t,l))){s(q.trim(t.slice(r,l))),o=!1,r=l+1;continue}l=u-1;continue}if(-1===(u=K(t,l-1))){s(o,V(q.trim(t.slice(r,l)))),o=!1,r=l+1;continue}}}else{if(-1===(u=t.indexOf(c,l+1)))break;s(o,q.trim(t.slice(n+1,u))),o=!1,r=(l=u)+1}else o=t.slice(r,l),r=l+1,n='"'===t.charAt(r)||"'"===t.charAt(r)?r:z(t,l+1)}return r<t.length&&(!1===o?s(t.slice(r)):s(o,V(q.trim(t.slice(r))))),q.trim(i.join(" "))};var G=o.exports.FilterCSS,J=i,X=F,Y=X.parseTag,Q=X.parseAttr,$=v;function tt(t){return null==t}function et(t){(t=function(t){var e={};for(var r in t)e[r]=t[r];return e}(t||{})).stripIgnoreTag&&(t.onIgnoreTag,t.onIgnoreTag=J.onIgnoreTagStripAll),t.whiteList||t.allowList?t.whiteList=function(t){var e={};for(var r in t)Array.isArray(t[r])?e[r.toLowerCase()]=t[r].map((function(t){return t.toLowerCase()})):e[r.toLowerCase()]=t[r];return e}(t.whiteList||t.allowList):t.whiteList=J.whiteList,t.onTag=t.onTag||J.onTag,t.onTagAttr=t.onTagAttr||J.onTagAttr,t.onIgnoreTag=t.onIgnoreTag||J.onIgnoreTag,t.onIgnoreTagAttr=t.onIgnoreTagAttr||J.onIgnoreTagAttr,t.safeAttrValue=t.safeAttrValue||J.safeAttrValue,t.escapeHtml=t.escapeHtml||J.escapeHtml,this.options=t,!1===t.css?this.cssFilter=!1:(t.css=t.css||{},this.cssFilter=new G(t.css))}et.prototype.process=function(t){if(!(t=(t=t||"").toString()))return"";var e=this.options,r=e.whiteList,n=e.onTag,i=e.onIgnoreTag,o=e.onTagAttr,a=e.onIgnoreTagAttr,s=e.safeAttrValue,l=e.escapeHtml,u=this.cssFilter;e.stripBlankChar&&(t=J.stripBlankChar(t)),e.allowCommentTag||(t=J.stripCommentTag(t));var c=!1;e.stripIgnoreTagBody&&(c=J.StripTagBody(e.stripIgnoreTagBody,i),i=c.onIgnoreTag);var h=Y(t,(function(t,e,c,h,f){var d={sourcePosition:t,position:e,isClosing:f,isWhite:Object.prototype.hasOwnProperty.call(r,c)},p=n(c,h,d);if(!tt(p))return p;if(d.isWhite){if(d.isClosing)return"</"+c+">";var g=function(t){var e=$.spaceIndex(t);if(-1===e)return{html:"",closing:"/"===t[t.length-2]};var r="/"===(t=$.trim(t.slice(e+1,-1)))[t.length-1];return r&&(t=$.trim(t.slice(0,-1))),{html:t,closing:r}}(h),v=r[c],_=Q(g.html,(function(t,e){var r=-1!==$.indexOf(v,t),n=o(c,t,e,r);return tt(n)?r?(e=s(c,t,e,u))?t+'="'+e+'"':t:tt(n=a(c,t,e,r))?void 0:n:n}));return h="<"+c,_&&(h+=" "+_),g.closing&&(h+=" /"),h+">"}return tt(p=i(c,h,d))?l(h):p}),l);return c&&(h=c.remove(h)),h};var rt=et;function nt(t){return nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},nt(t)}!function(t,e){var r=i,n=F,o=rt;function a(t,e){return new o(e).process(t)}(e=t.exports=a).filterXSS=a,e.FilterXSS=o,function(){for(var t in r)e[t]=r[t];for(var i in n)e[i]=n[i]}(),"undefined"!=typeof window&&(window.filterXSS=t.exports),"undefined"!=typeof self&&"undefined"!=typeof DedicatedWorkerGlobalScope&&self instanceof DedicatedWorkerGlobalScope&&(self.filterXSS=t.exports)}(n,n.exports);var it,ot="function"==typeof atob,at="function"==typeof btoa,st="function"==typeof Buffer,lt="function"==typeof TextDecoder?new TextDecoder:void 0,ut="function"==typeof TextEncoder?new TextEncoder:void 0,ct=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),ht=(it={},ct.forEach((function(t,e){return it[t]=e})),it),ft=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,dt=String.fromCharCode.bind(String),pt="function"==typeof Uint8Array.from?Uint8Array.from.bind(Uint8Array):function(t){return new Uint8Array(Array.prototype.slice.call(t,0))},gt=function(t){return t.replace(/[^A-Za-z0-9\+\/]/g,"")},vt=at?function(t){return btoa(t)}:st?function(t){return Buffer.from(t,"binary").toString("base64")}:function(t){for(var e,r,n,i,o="",a=t.length%3,s=0;s<t.length;){if((r=t.charCodeAt(s++))>255||(n=t.charCodeAt(s++))>255||(i=t.charCodeAt(s++))>255)throw new TypeError("invalid character found");o+=ct[(e=r<<16|n<<8|i)>>18&63]+ct[e>>12&63]+ct[e>>6&63]+ct[63&e]}return a?o.slice(0,a-3)+"===".substring(a):o},_t=st?function(t){return Buffer.from(t).toString("base64")}:function(t){for(var e=[],r=0,n=t.length;r<n;r+=4096)e.push(dt.apply(null,t.subarray(r,r+4096)));return vt(e.join(""))},mt=function(t){if(t.length<2)return(e=t.charCodeAt(0))<128?t:e<2048?dt(192|e>>>6)+dt(128|63&e):dt(224|e>>>12&15)+dt(128|e>>>6&63)+dt(128|63&e);var e=65536+1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320);return dt(240|e>>>18&7)+dt(128|e>>>12&63)+dt(128|e>>>6&63)+dt(128|63&e)},yt=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,bt=st?function(t){return Buffer.from(t,"utf8").toString("base64")}:ut?function(t){return _t(ut.encode(t))}:function(t){return vt(t.replace(yt,mt))},wt=function(t){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?function(t){return t.replace(/=/g,"").replace(/[+\/]/g,(function(t){return"+"==t?"-":"_"}))}(bt(t)):bt(t)},kt=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,It=function(t){switch(t.length){case 4:var e=((7&t.charCodeAt(0))<<18|(63&t.charCodeAt(1))<<12|(63&t.charCodeAt(2))<<6|63&t.charCodeAt(3))-65536;return dt(55296+(e>>>10))+dt(56320+(1023&e));case 3:return dt((15&t.charCodeAt(0))<<12|(63&t.charCodeAt(1))<<6|63&t.charCodeAt(2));default:return dt((31&t.charCodeAt(0))<<6|63&t.charCodeAt(1))}},Ct=ot?function(t){return atob(gt(t))}:st?function(t){return Buffer.from(t,"base64").toString("binary")}:function(t){if(t=t.replace(/\s+/g,""),!ft.test(t))throw new TypeError("malformed base64.");t+="==".slice(2-(3&t.length));for(var e,r,n,i="",o=0;o<t.length;)e=ht[t.charAt(o++)]<<18|ht[t.charAt(o++)]<<12|(r=ht[t.charAt(o++)])<<6|(n=ht[t.charAt(o++)]),i+=64===r?dt(e>>16&255):64===n?dt(e>>16&255,e>>8&255):dt(e>>16&255,e>>8&255,255&e);return i},xt=st?function(t){return pt(Buffer.from(t,"base64"))}:function(t){return pt(Ct(t).split("").map((function(t){return t.charCodeAt(0)})))},St=st?function(t){return Buffer.from(t,"base64").toString("utf8")}:lt?function(t){return lt.decode(xt(t))}:function(t){return Ct(t).replace(kt,It)},Tt=function(t){return St(function(t){return gt(t.replace(/[-_]/g,(function(t){return"-"==t?"+":"/"})))}(t))},At=function(t){return t&&t.Math==Math&&t},Pt=At("object"===("undefined"==typeof globalThis?"undefined":nt(globalThis))&&globalThis)||At("object"===("undefined"==typeof window?"undefined":nt(window))&&window)||At("object"===("undefined"==typeof self?"undefined":nt(self))&&self)||At("object"===("undefined"==typeof global?"undefined":nt(global))&&global)||Function("return this")(),Dt=new(function(){function t(){var t=this;this.batchData=[],this.uniqKeys=new Set,this.timeout=2e3,this.lock=!1,this.getSlardarBid=function(){var e,r,n="douyin_web";if(!n.includes("bid"))return n;if(t.config&&t.config.bid)return t.config.bid;var i=Pt;if(i&&i._xssBid)return i._xssBid;if(i&&i.slardar&&"function"==typeof i.slardar.config){var o=(i.slardar.config()||{}).bid;if(o)return o}if(i&&i.Slardar&&"function"==typeof i.Slardar.config){var a=(i.Slardar.config()||{}).bid;if(a)return a}return(null===(r=null===(e=null==i?void 0:i.Slardar)||void 0===e?void 0:e._baseParams)||void 0===r?void 0:r.bid)||"argus"},this.getConfigRegion=function(){var e;return"cn".includes("region")?t.config&&t.config.region?t.config.region:((null===(e=null==Pt?void 0:Pt.gfdatav1)||void 0===e?void 0:e.region)||"cn").toLowerCase():"cn"},this.gerReportUrl=function(){var e={cn:Tt("aHR0cHM6Ly9tb24uemlqaWVhcGkuY29tL21vbml0b3JfYnJvd3Nlci9jb2xsZWN0L2JhdGNoL3NlY3VyaXR5Lz9iaWQ9"),boe:Tt("aHR0cHM6Ly9tb24uemlqaWVhcGkuY29tL21vbml0b3JfYnJvd3Nlci9jb2xsZWN0L2JhdGNoL3NlY3VyaXR5Lz9iaWQ9"),ttp:Tt("aHR0cHM6Ly9tb24udXMudGlrdG9rdi5jb20vbW9uaXRvcl9icm93c2VyL2NvbGxlY3QvYmF0Y2gvc2VjdXJpdHkvP2JpZD0="),va:Tt("aHR0cHM6Ly9tb24tdmEuYnl0ZW92ZXJzZWEuY29tL21vbml0b3JfYnJvd3Nlci9jb2xsZWN0L2JhdGNoL3NlY3VyaXR5Lz9iaWQ9"),maliva:Tt("aHR0cHM6Ly9tb24tdmEuYnl0ZW92ZXJzZWEuY29tL21vbml0b3JfYnJvd3Nlci9jb2xsZWN0L2JhdGNoL3NlY3VyaXR5Lz9iaWQ9"),sg:Tt("aHR0cHM6Ly9tb24tdmEuYnl0ZW92ZXJzZWEuY29tL21vbml0b3JfYnJvd3Nlci9jb2xsZWN0L2JhdGNoL3NlY3VyaXR5Lz9iaWQ9"),boei18n:Tt("aHR0cHM6Ly9tb24tdmEuYnl0ZW92ZXJzZWEuY29tL21vbml0b3JfYnJvd3Nlci9jb2xsZWN0L2JhdGNoL3NlY3VyaXR5Lz9iaWQ9")}[t.getConfigRegion()];if(e)return e+t.getSlardarBid()}}return t.prototype.setConfig=function(t){this.config=t},t.prototype.upload=function(){var t=this,e=this.gerReportUrl();!this.lock&&e&&0!==this.batchData.length&&(this.lock=!0,setTimeout((function(){var r=t.batchData.slice(0,100);t.batchData=t.batchData.slice(100),Pt.fetch(e,{method:"post",body:JSON.stringify(r),headers:{"Content-Type":"application/json"}}).catch((function(t){})),t.lock=!1,t.upload()}),this.timeout))},t.prototype.generateKey=function(t){return t.collectKey?[t.collectMode,t.collectKey].join("___"):""},t.prototype.push=function(t){this.batchData.push(t),this.upload()},t.prototype.report=function(t){var e=this.generateKey(t);if(Pt.fetch&&t.collectKey){var r="object"===("undefined"==typeof window?"undefined":nt(window))?window.location.href:"SSR";t.documentUrl=r;var n={age:Math.floor(Date.now()),type:"xss",url:r,body:t,"user-agent":""};"enforce"===t.disposition&&"SSR"!==r||(n.url=e),"SSR"===r&&(n.url="SSR___".concat(n.url),n.body.ssr=!0),this.push(n)}},t}()),Et=function(t){for(var e=0,r=function(r){Array.isArray(t[r])?0===t[r].length?delete t[r]:(t[r]=Array.from(new Set(t[r])),e+=t[r].length):0===Object.keys(t[r]).length?delete t[r]:Object.keys(t[r]).forEach((function(n){t[r][n]=Array.from(new Set(t[r][n])),e+=t[r][n].length}))},n=0,i=Object.keys(t);n<i.length;n++)r(i[n]);return{count:e,ret:t}};function Nt(t,e){return Dt.setConfig(e),new n.exports.FilterXSS(e).process(t)}function Lt(t){var e,r=(e=/\s|\n|\t/.exec(t))?e.index:-1;if(-1===r)return{html:"",closing:"/"===t[t.length-2]};var n="/"===(t=t.slice(r+1,-1).trim())[t.length-1];return n&&(t=t.slice(0,-1).trim()),{html:t,closing:n}}var Ot=function(t){return-1===(t=(t=(t=(t=t.replace(/&colon;/gi,":")).replace(/&tab;/gi,"")).replace(/&newline;/gi,"")).replace(/(\t|\n|\r)/g,"")).indexOf("&#")?t.trim().toLowerCase():t.trim().replace(/&#(?:(x)([0-9a-f]+)|([0-9]+));?/gi,(function(t,e,r,n){return String.fromCharCode(e?parseInt(r,16):parseInt(n))})).toLowerCase()};function Rt(t,e){if(void 0===t&&(t=""),"string"!=typeof t)return!0;if((t=Ot(t)).includes("base64")&&!function(t){if(""===t||""===t.trim())return!0;try{return!t.includes("data:text/html;base64")}catch(t){return!0}}(t))return e&&e("data:text/html;base64"),!1;var r=["expression(","behavior:","view-source:"];if(r.some((function(e){return-1!==t.indexOf(e)})))return r.forEach((function(r){-1!==t.indexOf(r)&&e&&e(r)})),!1;var n=["data:application","data:javascript","data:text/html","data:texthtml"];if(n.some((function(e){return-1!==t.indexOf(e)})))return n.forEach((function(r){-1!==t.indexOf(r)&&e&&e(r)})),!1;if(t.indexOf("javascript:")>0)return e&&e("javascript:"),!1;if(/^javascript:/i.test(t)){var i=t.slice(11).replace(/\s/g,"").trim();return!!["void","void(0)","void0","false","undefined",";"].some((function(t){return t===i}))||(e&&e("javascript:"),!1)}return!0}var Bt=function(t,e){return Rt(t,e)?t:"#"};function Mt(t,e,n){if(void 0===t&&(t=""),void 0===e&&(e=[]),"string"!=typeof t)return!0;if(!Rt(t=Ot(t)))return!1;var i=function(t){var e=t.match(/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/)||[];return{url:e[0],scheme:e[1],slash:e[2],host:e[3],port:e[4],path:e[5],query:e[6],hash:e[7]}}(t),o=i.scheme,a=i.host;return n?Boolean(n(t)):!["http","https","file"].includes(o)||("object"===("undefined"==typeof window?"undefined":nt(window))&&window&&(e=r(r([],e,!0),[location.host],!1)),e.some((function(t){return!!(t instanceof RegExp&&t.test(a))||t===a})))}var jt=Mt,Ft=Mt,qt={a:["target","title","spellcheck","rel"],canvas:[],abbr:["title"],address:[],area:["shape","coords","alt"],article:[],aside:[],audio:["autoplay","controls","loop","preload"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:["dir"],dl:[],dt:[],em:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["alt","title","width","height","decoding"],ins:["datetime"],li:[],mark:[],nav:[],ol:["start"],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],sup:[],delete:[],form:[],strong:[],mask:["maskunits","x","y","width","height","fill"],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],wbr:[],video:["autoplay","controls","loop","preload","height","width"],svg:["viewBox","version","xmlns","fill","width","height","stroke","stroke-width","style"],path:["d","fill","opacity","stroke","p-id","fill-rule","clip-rule","stroke-width","stroke-linecap","stroke-linejoin","fill-opacity","mask"],rect:["x","y","width","height","fill","stroke","rx"],g:[]},Ht={collect:null,initCollect:function(){this.collect={whiteList:{},filterProtocol:[]}},removeCollect:function(){var t=Et(this.collect),e=t.count,r=t.ret;return this.collect=null,{collectKey:0===e?null:JSON.stringify(r),collectMode:"white"}},onIgnoreTagAttr:function(t,e,n){return t&&["href","src"].indexOf(e)>-1?Ht.domainWhiteList&&Array.isArray(Ht.domainWhiteList)&&Ht.domainWhiteList.length>0&&!jt(n,r([],Ht.domainWhiteList,!0))?"":"".concat(e,'="').concat(Bt(n,(function(t){var e;null===(e=Ht.collect)||void 0===e||e.filterProtocol.push(t)})),'"'):t&&(["style","class","id"].indexOf(e)>-1||e.indexOf("data-")>-1)?"".concat(e,'="').concat(n,'"'):(Ht.collect.whiteList[t]=Ht.collect.whiteList[t]||[],void Ht.collect.whiteList[t].push(e))},onIgnoreTag:function(t,e){if("style"===t)return e;n.exports.parseTag(e,(function(t,e,r,i){var o=Lt(i);n.exports.parseAttr(o.html.replace("/",""),(function(t){Ht.collect.whiteList[r]=Ht.collect.whiteList[r]||[],Ht.collect.whiteList[r].push(t)}))}),n.exports.escapeHtml)},whiteList:qt,mergeWhiteList:function(t){for(var e={},r=0,n=Object.keys(qt);r<n.length;r++)e[a=n[r]]=Array.from(qt[a]);for(var i=0,o=Object.keys(t);i<o.length;i++){var a;e[a=o[i]]=a in qt?qt[a].concat(t[a]):Array.from(t[a])}return e},setWhiteList:function(t){for(var e=0,r=Object.keys(t);e<r.length;e++){var n=r[e];this.whiteList[n]=n in qt?qt[n].concat(t[n]):Array.from(t[n])}}};try{var Wt=JSON.parse({}.replace(/'/g,'"')),Zt="merge";Zt.includes("override")&&(Ht.whiteList=Wt.whiteList),Zt.includes("merge")&&Ht.setWhiteList(Wt.whiteList)}catch(t){}var Ut={blackList:{a:["folder"],meta:["content"],iframe:["srcdoc"],input:["pattern"],vmlframe:["xmlns"]},blackTags:["script","xml","embed","isindex","object","base","set","handler","animate","payload","import"],blackAttrs:["charset","ns","namespace","formaction","xlink:href","xmlns:xlink","handler","repeat","repeat-start","repeat-end"],blackAttrRegExps:[/^on/],filterList:{param:["value"],video:["poster"],form:["action"]},filterAttrs:["href","src","background","style","dynsrc","lowsrc","content"]};try{var zt=JSON.parse({}.replace(/'/g,'"'));zt.blackAttrRegExps&&(zt.blackAttrRegExps=zt.blackAttrRegExps.map((function(t){return new RegExp(t.toString().slice(1,t.toString().length-1))})));var Kt="merge";Kt.includes("override")&&(Ut=zt),Kt.includes("merge")&&(Ut=function t(e,r){for(var n={},i=0,o=Object.keys(e);i<o.length;i++){var a=o[i];Array.isArray(e[a])?n[a]=Array.from(e[a]):n[a]=t({},e[a])}for(var s=0,l=Object.keys(r);s<l.length;s++)(a=l[s])in e?Array.isArray(e[a])?n[a]=e[a].concat(r[a]):n[a]=t(e[a],r[a]):Array.isArray(r[a])?n[a]=Array.from(r[a]):n[a]=t({},r[a]);return n}(Ut,zt))}catch(t){}var Vt,Gt={whiteList:{},collect:null,initCollect:function(){Gt.collect={blackList:{},blackTags:[],blackAttrs:[],blackAttrRegExps:[],filterAttrs:[],filterList:{},filterProtocol:[]}},removeCollect:function(){var t=Et(Gt.collect),e=t.count,r=t.ret;return Gt.collect=null,{collectKey:0===e?null:JSON.stringify(r),collectMode:"black"}},onIgnoreTag:function(t,e){var r;if(!Ut.blackTags.includes(t)){var i=n.exports.parseTag(e,(function(t,e,r,i,o){if(-1!==r.indexOf("/"))return n.exports.escapeHtml(i);if(o)return"</".concat(r,">");var a=Lt(i),s=n.exports.parseAttr(a.html,(function(t,e){var n,i=0;if(Ut.blackList[r]&&Ut.blackList[r].includes(t)&&(Gt.collect.blackList[r]=Gt.collect.blackList[r]||[],Gt.collect.blackList[r].push(t),i++),Ut.blackAttrRegExps.length&&Ut.blackAttrRegExps.some((function(e){return e.test(t)}))&&Ut.blackAttrRegExps.forEach((function(e){e.test(t)&&(Gt.collect.blackAttrRegExps.push("".concat(e.toString(),"->").concat(t)),i++)})),Ut.blackAttrs.length&&Ut.blackAttrs.includes(t)&&(Ut.blackAttrs.push(t),i++),!i){if(Ut.filterList&&Ut.filterList[r]&&Ut.filterList[r].includes(t)){var o=Bt(e,(function(t){var e;null===(e=Gt.collect)||void 0===e||e.filterProtocol.push(t)}));return o!==e&&(Gt.collect.filterList[r]=Gt.collect.filterList[r]||[],Gt.collect.filterList[r].push(t)),e?"".concat(t,"='").concat(o,"'"):t}return Ut.filterAttrs&&Ut.filterAttrs.includes(t)?(o=Bt(e,(function(t){var e;null===(e=Gt.collect)||void 0===e||e.filterProtocol.push(t)})),o!==e&&(null===(n=Gt.collect)||void 0===n||n.filterAttrs.push(t)),e?"".concat(t,"='").concat(o,"'"):t):e?"".concat(t,"='").concat(e,"'"):t}}));return i="<".concat(r),s&&(i+=" ".concat(s)),a.closing&&(i+=" /"),i+">"}),n.exports.escapeHtml);return i}null===(r=Gt.collect)||void 0===r||r.blackTags.push(t)}},Jt=function(t){var e=t.reportOnly,r=void 0===e||e,n=t.block;return r&&"all"===r?"report":n?"enforce":r?"report":"enforce"},Xt=function(t){return"string"==typeof t?t.replace(/'/g,'"').replace('=""',"").replace(/\s+/g,"").toLowerCase():""},Yt=function(t){return function(r,n,i){if(!r||"string"!=typeof r)return r;var o=n;t===Nt&&(o=Ht,i&&"black"===i.mode&&(o=Gt),Ht.enabled?o=n:Gt.enabled&&(o=Gt),o.initCollect());var a=t(r,o);if(Xt(a)===Xt(r))return r;if(!i)return a;var s=i.logType,l=Jt(i),u=o.removeCollect();return Dt.report(e(e({type:s,disposition:l},u),{sourceText:wt(r),filterText:wt(a)})),"enforce"===l?a:r}},Qt=Yt(n.exports.filterXSS),$t=Yt(Nt),te=(Vt=Bt,function(t,e,r){var n=[],i=Vt(t,(function(t){n.push(t)}));if(i===t)return t;n=Array.from(new Set(n));var o=e||r||{};if(!o)return i;var a=o.logType,s=Jt(r);return Dt.report({type:a,disposition:s,collectKey:n.join("___"),collectData:JSON.stringify(n),collectMode:"black",sourceText:wt(t),filterText:wt(i)}),"enforce"===s?i:t}),ee=Pt._xssProject||{},re=Pt.xssNamespace||{},ne="3.0.15",ie={FilterXSS:n.exports.FilterXSS,version:ne,filterXSS:Qt,_filterXSS:$t,filterUrl:te,Config:Ht,BlackConfig:Gt,project:ee,setProjectName:function(t){ee[t]=this,Pt._xssProjectName=t}};re.douyin_web=ie,Pt.xssNamespace=re,Pt.Math&&!Pt.Math.xssNamespace&&(Pt.Math.xssNamespace=re),ee[ne]=ie,Pt.globalThis=Pt,Pt.getFilterXss=function(){return void 0!==this._xssProjectName?this._xssProject[this._xssProjectName]:ie},Pt.xss=ie,Pt.isSafeUrl=jt,Pt.isSafeDomain=Ft,Pt.isSafeProtocol=Rt,Pt._xssProject=ee,Pt._xssProjectName&&(ee[Pt._xssProjectName]=ie);var oe=ie.setProjectName.bind(ie);t.BlackConfig=Gt,t.Config=Ht,t.FilterXSS=n.exports.FilterXSS,t._filterXSS=$t,t.filterUrl=te,t.filterXSS=Qt,t.isSafeDomain=Ft,t.isSafeProtocol=Rt,t.isSafeUrl=jt,t.project=ee,t.setProjectName=oe,t.setXssNamespace=function(t){var e=t.appId,r=t.bid,n=t.region,i=t.mode,o=void 0===i?"black":i;re[e]=ie;var a=null;(a="black"===o?Gt:Ht).bid=r,a.region=n,a.enabled=!0},t.xssNamespace=re,Object.defineProperty(t,"__esModule",{value:!0})})),(self.webpackChunkdouyin_web=self.webpackChunkdouyin_web||[]).push([[4949],{49004:function(t,e,r){"use strict";r.d(e,{_c:function(){return p},UV:function(){return g},ZP:function(){return k}});r(72565);var n=r(20018),i=r(71940),o=r(13266),a=r(15986),s=r(7628),l=r(94042),u=r(34708),c=(r(27045),r(20493),r(27780),r(16279),r(23594),r(74989),r(2603),r(49649),r(2435),r(25134),r(98921),r(76673),r(63930),r(67519),r(49741),r(36084),r(51890),r(64084),r(14394),r(85048),r(71486),r(14973),r(59078),r(52448),r(89898),r(89071),r(25235),r(80226),r(98925),r(66029),r(64782),r(80859),r(26536),r(27529),r(83336),r(21962),r(38262),r(8250),r(29035),r(15837),r(44512),r(70873),r(99105),r(77717)),h=r(82009),f=r(35992);function d(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=(0,u.Z)(t);if(e){var i=(0,u.Z)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,l.Z)(this,r)}}var p={ABR_CHANGE:"ABR_CHANGE_A",ABR_UPDATE_SPEC:"ABR_UPDATE_SPEC",START_ABR:"START_ABR",UPDATE_AUTO_DESC:"UPDATE_AUTO_DESC",ABR_START_PROGRESS:"ABR_START_PROGRESS",MAX_BUFFER_CHANGE:"MAX_BUFFER_CHANGE"},g="__auto__",v=0,_=1,m=-1,y=0,b=1,w={PLAYBACK_BITRATE:"avg_play_bitrate",DOWNLOAD_BITRATE:"avg_download_bitrate",DOWNLOAD_NETWORK_SPEED:"avg_download_speed",PREDICT_NETWORK_SPEED:"avg_predict_speed",BUFFER_LENGTH:"avg_buffer_length",QOE:"avg_qoe"},k=function(t){(0,s.Z)(r,t);var e=d(r);function r(t,n,o,s,l){var u,h=arguments.length>5&&arguments[5]!==undefined?arguments[5]:{logger:function(){},openLog:!1};(0,i.Z)(this,r),(u=e.call(this,n,o,s,l,h)).player=t,u.timerId=0,u.isOpenAutoDefi=!!u.autoBitrateOpts.isOpenAutoDefi,u.onPlayrateChange=u._onPlayrateChange.bind((0,a.Z)(u)),u.onPlay=u._onPlay.bind((0,a.Z)(u)),u._stop=u.stop.bind((0,a.Z)(u)),u._bufferRange=new Map,u._sortedBufferRange=[],u._lastCheckResolutionStamp=0,u._currentDefinition=null,u._isSeeking=!1,u._waitingStartTime=0,u._stallCount=0,u._seekState=v,u._stallState=y,u._videoCurrentTime=0,u.listeners=[{evt:"playbackrateChange",handler:u.onPlayrateChange},{evt:"ended",handler:u._stop},{evt:"error",handler:u._stop},{evt:"timeupdate",handler:u._onTimeUpdate.bind((0,a.Z)(u))},{evt:"addVideoBufferEnd",handler:u._bufferRangeUpdate.bind((0,a.Z)(u))},{evt:"canplay",handler:u._updateAutoDesc.bind((0,a.Z)(u))},{evt:"play",handler:u._onplayStart.bind((0,a.Z)(u))},{evt:p.MAX_BUFFER_CHANGE,handler:u._onMaxBufferChange.bind((0,a.Z)(u))},{evt:"seeking",handler:u._onSeeking.bind((0,a.Z)(u))},{evt:"seeked",handler:u._onSeekEnd.bind((0,a.Z)(u))},{evt:"waiting",handler:u._onWaiting.bind((0,a.Z)(u))},{evt:"playing",handler:u._onPlaying.bind((0,a.Z)(u))}],u._hasStart=!1,u.listeners.forEach((function(t){var e=t.evt,r=t.handler;u.player.on(e,r)})),u._isPaused=!1,u._hasAddFrament=!1,u._eventInfo={local_time_ms:0,internet_speed:0,buffer_length:0,last_bitrate:0,now_bitrate:0,play_speed:1},u._bitrateSet=[],u._generalInfo={},u._currentInAbr=!1,u._hasCalcTimelineLog=!1,u._abr_play_info={start_play_time_ms:0,is_hint:0,playback_info:{internet_speed_record:[],play_bitrate_record:[],buffer_length_record:[],play_speed_record:[],qoe_record:[],qoe_a_record:[],qoe_b_record:[],qoe_c_record:[]}},u._abrMethod=u.autoBitrateOpts.method||0,u.logger("abr: constructor"),u._loopInterval=u.initInterval,u._tickCount=0,u._fps=30,c.Z.install(),u.startTime=performance.now(),u.logger("time abr",(new Date).getTime()),u._maxCacheTimeVideo=u.config.maxBufferLength||u.config.preloadTime||50,u._maxCacheTimeAudio=u._maxCacheTimeVideo,u._prevDefinitionItem=null,u._currentItem=null,u._switchCount=0,u._switchBitrate=0,u._avgStatItems={};for(var f=Object.keys(w),d=0;d<f.length;d++){var g=f[d],_=w[g];u._avgStatItems[_]=new I}return u._qoeArgs=[0,0,0,0],u._abrUsed=-1,u._abrAlwaysOn=1,u._prelaodInfo=null,u._hasLogStartInfo=!1,u._hasExecuteAbrAlgo=!1,u._lastExecuteTimeInMs=0,u}return(0,o.Z)(r,[{key:"init",value:function(t){return this._mediaList=t,this.isOpenAutoDefi?this.onLoadWasm():this._wasmPromise.resolve(),this._wasmPromise}},{key:"execute",value:function(){return this.listenSize(),this.initFps(),this.onWinElemSizeChange(),this.onPlay()}},{key:"_onSeeking",value:function(){this._isSeeking=!0,this.player.currentTime<this._videoCurrentTime?this._seekState=m:this._seekState=_,this.logger("seekState",this._seekState)}},{key:"_onSeekEnd",value:function(){this._isSeeking=!1}},{key:"_onWaiting",value:function(){var t=this;this._isSeeking||this._waitingStartTime>0||(this._waitingStartTime=(new Date).getTime(),this._stallId=setTimeout((function(){clearTimeout(t._stallId),t._stallCount++,t._stallState=b}),200))}},{key:"_onPlaying",value:function(){this._waitingStartTime=0,this._stallState=y,clearTimeout(this._stallId)}},{key:"initFps",value:function(){this.fpsDetection=new c.Z,this.fpsDetection.start(),this._fps=this.fpsDetection.fps,this._hasDeviceInfoChanged=!0}},{key:"listenSize",value:function(){this.mediaElem=this.player.video,this._onWinSizeChange=(0,h.Z)(this.onWinElemSizeChange.bind(this),1e3,!1),window.addEventListener("resize",this._onWinSizeChange)}},{key:"onWinElemSizeChange",value:function(){if(this.mediaElem){var t=this.mediaElem.getBoundingClientRect();this._videoWidth=Math.floor(t.width),this._videoHeight=Math.floor(t.height),this._hasDeviceInfoChanged=!0}}},{key:"_onMaxBufferChange",value:function(t){var e=t.videoCacheTime,r=t.audioCacheTime;this._maxCacheTimeAudio=r,this._maxCacheTimeVideo=e}},{key:"_onTimeUpdate",value:function(t){var e=arguments.length>1&&arguments[1]!==undefined&&arguments[1];if(this._sortedBufferRange&&0!==this._sortedBufferRange.length&&this._currentInAbr){this._videoCurrentTime=this.player.currentTime;var r=Date.now();if(!(r-this._lastCheckResolutionStamp<1e3&&0!==this._lastCheckResolutionStamp)||e){this._lastCheckResolutionStamp=r;for(var n=this.player.currentTime,i=0,o=this._sortedBufferRange.length-1,a=null;i<=o;){var s=Math.floor(i+(o-i)/2),l=this._sortedBufferRange[s];if(n<l.start)o=s-1;else{if(!(n>=l.end)){a=l;break}i=s+1}}if(a){var u=this._bitrateToDefitionConfig.get(a.bandwidth),c=u&&u.definition;if(this._currentDefinition===c&&!e||!c)return void(c||this.logger("error defintion, mpd\u914d\u7f6e\u4e0e\u63a5\u53e3\u914d\u7f6e\u4e0d\u4e00\u81f4"));this._currentDefinition=c,this._prevDefinitionItem=this._currentItem,this._currentFps=u.fps,this._currentItem=u,this._emitAutoDescChange(c,!1,this._currentFps,u)}}}}},{key:"_emitAutoDescChange",value:function(t,e,r,n){this.player.emit(p.UPDATE_AUTO_DESC,{definition:t,reset:e,fps:r,item:n,pre_item:this._prevDefinitionItem})}},{key:"_onplayStart",value:function(){this._hasStart=!0,this.logger("onplaystart")}},{key:"_updateAutoDesc",value:function(){var t=this;this._currentInAbr&&this._currentDefinition&&(this._updateId=setTimeout((function(){clearTimeout(t._updateId),t._emitAutoDescChange(t._currentDefinition,!1,t._currentFps,t._currentItem)}),0))}},{key:"_bufferRangeUpdate",value:function(t){if(t.start!==undefined){null===this._currentItem&&this._onTimeUpdate(null,!0);var e=t.start;this._hasAddFrament=!0,this._bufferRange.set(e,t);var r=(0,n.Z)(this._bufferRange.values());this._sortedBufferRange=r.sort((function(t,e){return t.start-e.start})),this.avgStat(w.DOWNLOAD_BITRATE,t.bandwidth)}}},{key:"_onPlayrateChange",value:function(){this.module&&this.updateBufferInfo()}},{key:"_onPlay",value:function(){var t=this;if(!this.isOpenAutoDefi)return this.logger("onPlay"),0;var e=0;try{this.logger("abr: loadeddata"),this.updateSwitchInfo(),this.parseMPD(),this.updateDeviceInfo();var n=r.getIsPlayAutoDefi(this.autoBitrateOpts);if(this.isOpenAutoDefi&&n){this._abrUsed=1;var i=this._getDefautSpeed(this.player);e=this._loopAbr(i),this.start(),this.logger("time abr start prgress",(new Date).getTime()),this.logger("time abr costTime",performance.now()-this.startTime),this.logger("abr onplay"),this.startTimer=setTimeout((function(){t._loopInterval=t.interval,clearTimeout(t.startTimer),t.logger("interval change")}),5e3)}}catch(o){this.logger("abr: loadeddata error",o),this.logger("time abr costTime err",performance.now()-this.startTime)}return e}},{key:"start",value:function(){if(this.logger("abr: start"),this._isPaused=!1,!this._hasCalcTimelineLog){var t=1===Math.floor(100*Math.random());this._abr_play_info.is_hint=t?1:0}this._hasCalcTimelineLog=!0,this._loop()}},{key:"_loop",value:function(){var t=this;this._isPaused||(clearTimeout(this.timerId),this.timerId=setTimeout((function(){if(!t.player.paused||!t.player.config.autoplay&&!t._hasStart){var e=t._hasAddFrament?undefined:t._getDefautSpeed(t.player);t._loopAbr(e)}t._loop()}),this._loopInterval))}},{key:"updateDeviceInfo",value:function(){try{if(this.fpsDetection){var t=this.fpsDetection.fps;t!==this._fps&&(this._fps=t,this._hasDeviceInfoChanged=!0)}this._updateDeviceInfo(this._fps)}catch(e){}}},{key:"updateBufferInfo",value:function(t){var e=this.player.playbackRate,r=this.bufferLength,n=t||Math.floor(this.player.downloadSpeed);return this._tickCount<5&&0===n&&(n=this._getDefautSpeed(this.player),this.logger("initSpeed fix")),this.logger("maxCacheTimeAudio:",this._maxCacheTimeAudio,"maxCacheVideoTime",this._maxCacheTimeVideo,"seekState",this._seekState,"stallState",this._stallState),this.module._updateBufferInfo(e,this._maxCacheTimeAudio,this._maxCacheTimeVideo,r,r,n,this._seekState,this.player.currentTime,this._stallState),this._seekState=v,this._eventInfo={internet_speed:n,buffer_length:r,last_bitrate:this.bitrate,play_speed:e},this.logger("playRate:",e,"buff:",r,"downloadSpeed:",n),{buffer:r,downloadSpeed:n}}},{key:"updateSwitchInfo",value:function(){var t=(new Date).getTime();this._openTimeMs=t,this._abr_play_info.start_play_time_ms=t;var e=this.player.config.preloadTime||50,r=(0,f.C)(t),n=this.autoBitrateOpts.noStallCheckTime||5,i=this.openLog;this.logger("openTime:",t,"this.logger",i),this.module._updateSwitchInfo(r.low,r.high,n,i,this.stall_penalty,this.switch_penalty);var o=this._mediaList.video,a=o.map((function(t){var e=t.bandwidth,r=t.bitrate;return e||r}));this._bitrateSet=a.map((function(t,e){return{bitrate:t,codecs:o[e].codecs||o[e].codec_type}})),this._generalInfo={max_cache_time:e,bitrate_set:this._bitrateSet,segment_duration:this.segment_duration,preload_info:{},startup_info:{}}}},{key:"updatePreloadCacheInfo",value:function(t){try{this._prelaodInfo=t,this.logger("update preloadInfo",t),t&&t.item_num!==t.items.length&&(this.logger("preloadInfo invalid"),this._prelaodInfo=null)}catch(e){this.logger("updatePreloadCacheInfo",e),this._prelaodInfo=null}}},{key:"updatePreloadLogInfo",value:function(t){this._generalInfo.preload_info=t||{}}},{key:"_updatePreloadInfo",value:function(){try{var t=this.player.getPreloadInfos();if(t){var e=t.preloadInfo,r=t.abr;this.updatePreloadLogInfo(e),r&&this.updatePreloadCacheInfo(e)}if(this.logger("_updatePreloadInfo preloadinfos",t),null!=this._prelaodInfo){var n=JSON.stringify(this._prelaodInfo);this.module.ccall("updatePreloadInfo","null",["string"],[n])}else this.logger("_updatePreloadInfo preloadinfo null, no preload")}catch(i){this.logger("_updatePreloadInfo err",i)}}},{key:"_loopAbr",value:function(t){var e;this._tickCount++;var r=[];try{this.updateDeviceInfo();var n=this.updateBufferInfo(t),i=n.downloadSpeed,o=n.buffer;e=this.module._getPredictedBitrate(this.bitrate,this._abrMethod);for(var a=0;a<7;a++)r.push(this.module.HEAP32[e/Int32Array.BYTES_PER_ELEMENT+a]);var s=r[0],l=1===r[1];this._eventInfo.now_bitrate=s,this._eventInfo.local_time_ms=(new Date).getTime();var u=0;if(s!==this.bitrate&&0!==s){var c=this.bitrate;u=Math.abs(c-s);for(var h=[],f=this.player.video.buffered,d=0;d<f.length;d++)h.push({start:f.start(d),end:f.end(d)});var g=this._videoWidth||Number(this.config.width),v=this._videoHeight||Number(this.config.height),_=(new Date).getTime(),m={speed:"".concat(i," KB/s"),buffer_length:"".concat(o," s"),video_pos:this.player.currentTime,all_buffers:h,seek_state:this._seekState,stall_state:this._stallState,screen_width:g,screen_height:v,dpr:window&&window.devicePixelRatio,playbackRate:this.player.playbackRate,bitrateSet:this._bitrateSet,abrMethod:this._abrMethod,delta:this._hasExecuteAbrAlgo?_-this._lastExecuteTimeInMs:0};this._lastExecuteTimeInMs=_,this._hasExecuteAbrAlgo=!0,this.player.emit(p.ABR_CHANGE,this.bitrate,s,l,JSON.stringify(m)),this.logger("abr loop predicte:",s,"willStall:",l,"switchBitrate",u,"cur",c),this.bitrate=s}this._hasLogStartInfo||(this._hasLogStartInfo=!0,this._generalInfo.startup_info={predict_bitrate:s,download_speed:i,screen_width:this._videoWidth||Number(this.config.width),screen_height:this._videoHeight||Number(this.config.height),device_pixel_ratio:window&&window.devicePixelRatio,screen_fps:this._fps,startup_method:this._abrMethod}),this.player.emit("ABR_LOOP"),this.onAbrLoop(i,r[2],u,r.slice(3))}catch(y){this.logger("abr error",y)}finally{this.module._free(e)}return this.bitrate}},{key:"stop",value:function(){!0===(arguments.length>0&&arguments[0]!==undefined&&arguments[0])&&(this._abrAlwaysOn=-1),clearTimeout(this.timerId),this._isPaused=!0,this.logger("abr: stop")}},{key:"destroy",value:function(){var t=this;this._stop(),this.listeners.forEach((function(e){var r=e.evt,n=e.handler;t.player.off(r,n)})),this.player=null,this._heightToDefitionConfig=null,this._bitrateToDefitionConfig=null,this._bufferRange=null,this._sortedBufferRange=null,this.module=null,clearTimeout(this._stallId),clearTimeout(this._updateId),clearTimeout(this.startTimer),window.removeEventListener("resize",this._onWinSizeChange),this.fpsDetection&&this.fpsDetection.stop(),this.player=null}},{key:"eventInfo",get:function(){return this._eventInfo}},{key:"generalInfo",get:function(){return this._generalInfo}},{key:"bufferLength",get:function(){var t=this.player.getBufferedRange(),e=this.player.video.currentTime,r=t[1]-Math.max(t[0],e);return r=Math.max(0,r).toFixed(2),parseFloat(r)}},{key:"downloadSpeed",get:function(){return Math.floor(this.player.downloadSpeed)}},{key:"nowBitrate",get:function(){return this.bitrate}},{key:"openTimeMs",get:function(){return this._openTimeMs}},{key:"isCurrentInAbr",get:function(){return this._currentInAbr},set:function(t){this._currentInAbr=t}},{key:"onAbrLoop",value:function(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0,r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0,n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:[];if(this._qoeArgs=n,this._currentItem&&this.avgStat(w.PLAYBACK_BITRATE,this._currentItem.bitrate),this.avgStat(w.DOWNLOAD_NETWORK_SPEED,1e3*t*8),this.avgStat(w.PREDICT_NETWORK_SPEED,e),this.avgStat(w.BUFFER_LENGTH,this.bufferLength),this.avgStat(w.QOE,this.getQoeRelValue(0)),r>0&&(this._switchCount++,this._switchBitrate+=r),this._abr_play_info.is_hint){var i=this,o=((new Date).getTime()-this.openTimeMs)/1e3;o=parseFloat(o.toFixed(2)),this._abr_play_info.playback_info.internet_speed_record.push([o,i.downloadSpeed]),this._abr_play_info.playback_info.play_bitrate_record.push([o,i.nowBitrate]),this._abr_play_info.playback_info.buffer_length_record.push([o,i.bufferLength]),this._abr_play_info.playback_info.play_speed_record.push([o,this.player.playbackRate]),this._abr_play_info.playback_info.qoe_record.push([o,this.getQoeRelValue(0)]),this._abr_play_info.playback_info.qoe_a_record.push([o,this.getQoeRelValue(1)]),this._abr_play_info.playback_info.qoe_b_record.push([o,this.getQoeRelValue(2)]),this._abr_play_info.playback_info.qoe_c_record.push([o,this.getQoeRelValue(3)])}}},{key:"getQoeRelValue",value:function(t){return this._qoeArgs[t]/100}},{key:"avgStat",value:function(t,e){var r=this._avgStatItems[t];r&&r.add(e)}},{key:"getAbrPlayInfo",value:function(){return this._abr_play_info}},{key:"updateAbrMethod",value:function(t){this._abrMethod=t}},{key:"getAbrMethod",value:function(){return this._abrMethod}},{key:"getAbrVVStats",value:function(){for(var t={},e=Object.keys(w),r=0;r<e.length;r++){var n=e[r],i=w[n],o=this._avgStatItems[i];t[i]=o.avg()}return t.switch_counts=this._switchCount,t.avg_switch_bitrate=0===this._switchCount?0:this._switchBitrate/this._switchCount,t.abr_qoe=this.getQoeRelValue(0),t.abr_qoe_a=this.getQoeRelValue(1),t.abr_qoe_b=this.getQoeRelValue(2),t.abr_qoe_c=this.getQoeRelValue(3),t.abr_method=this._abrMethod,t.abr_used=this._abrUsed,t.abr_always_on=this._abrAlwaysOn,this.logger("abrVVStats",t),t}}],[{key:"getIsPlayAutoDefi",value:function(t){return!!t.isPlayAutoDefi}}]),r}(f.Z),I=function(){function t(){(0,i.Z)(this,t),this.total=0,this.count=0}return(0,o.Z)(t,[{key:"add",value:function(t){this.total+=t,this.count++}},{key:"avg",value:function(){if(0===this.count)return 0;var t=this.total/this.count;return Math.floor(t)}}]),t}()},35992:function(t,e,r){"use strict";r.d(e,{C:function(){return l},Z:function(){return u}});var n=r(71940),i=r(13266),o=(r(2435),r(16279),r(22528),r(59857),r(20493),r(27780),r(23594),r(74989),r(2603),r(49649),r(15837),r(99105),r(49741),r(36084),r(51890),r(64084),r(14394),r(85048),r(71486),r(14973),r(59078),r(52448),r(89898),r(89071),r(25235),r(80226),r(98925),r(66029),r(64782),r(80859),r(26536),r(27529),r(83336),r(21962),r(38262),r(8250),r(29035),r(58484)),a=r(74976),s="danger_d_speed";function l(t){var e=t.toString(16);return e.length<=8?{high:0,low:t}:{high:parseInt(e.substr(0,e.length-8),16),low:parseInt(e.substr(e.length-8),16)}}var u=function(){function t(e,r,i,a){var s=arguments.length>4&&arguments[4]!==undefined?arguments[4]:{logger:function(){},openLog:!1};(0,n.Z)(this,t),this.bitrate=r,this.segment_duration=a||5e3,this.logger=s.logger,this.openLog=s.openLog,this.cdnHost=e.cdnHost,this._loadedPromise=new o.Z,this._wasmPromise=new o.Z,this.config=e,this.autoBitrateOpts=e.autoBitrateOpts||{},this.stall_penalty=this.autoBitrateOpts.stall_penalty||11,this.switch_penalty=this.autoBitrateOpts.switch_penalty||4,this.interval=this.autoBitrateOpts.interval||1e3;var l=e.progressTimer||1e3,u=this.autoBitrateOpts.startInterval||l;this.initInterval=.8*u,this._prealodMethod=e.preloadmethod||0,this._videoWidth=0,this._videoHeight=0,this._hasDeviceInfoChanged=!0,this.updateMediaInfos(i,!1)}return(0,i.Z)(t,[{key:"onLoadWasm",value:function(){var t=this,e=this.module={onRuntimeInitialized:function(){t._wasmPromise.resolve()}};return(0,this.autoBitrateOpts.module)(e),this._wasmPromise}},{key:"updateMediaInfos",value:function(t){var e=this;arguments.length>1&&undefined;this._heightToDefitionConfig=new Map,this._bitrateToDefitionConfig=new Map,t&&(this.mediaInfos=t,this.mediaInfos.dynamic_video_list.forEach((function(t){e._heightToDefitionConfig.set(t.vheight,t),e._bitrateToDefitionConfig.set(t.bitrate,t)})))}},{key:"parseMPD",value:function(){if(this.setDebugModel(this.openLog),this.mediaInfos){this.logger("mediaInfos",this.mediaInfos);try{for(var t=[],e=this.mediaInfos.dynamic_video_list,r=0;r<e.length;r++){var n=e[r];t.push({stream_id:"s".concat(r),bandwidth:n.bitrate||n.bandwidth,width:n.vwidth||n.width,height:n.vheight||n.height,codec:n.codecs||n.codec_type||"h264",frame_rate:Number(n.fps)||-1,segment_duration:this.segment_duration})}var i={v_adaptation:t},o=JSON.stringify(i);this.module.ccall("parseMPD","null",["string"],[o])}catch(a){}}}},{key:"_getDefautSpeed",value:function(t){var e=0,r=window.navigator.connection;if(r&&r.downlink)e=1024*navigator.connection.downlink/8,this.logger("initSpeed connect",e);else try{e=parseFloat(a.Z.getItem(s))||0,this.logger("initSpeed connect",e)}catch(n){}return 0===e&&(e=t&&t.historyAvspeed||0,this.logger("initSpeed history",e)),e}},{key:"setDebugModel",value:function(t){this.module._setDebugModel(t)}},{key:"updateBitrate",value:function(t){this.bitrate=t}},{key:"_updatePreloadSupplier",value:function(t,e){this.module._updatePreloadSupplier(t,e)}},{key:"updatePreloadSupplier",value:function(t){var e=this._getDefautSpeed();this._updatePreloadSupplier(e,t)}},{key:"getPreloadBitrate",value:function(){var t,e=null,r=[];try{this.logger("preloadMethod",this._prealodMethod),t=this.module._getPreloadBitrate(this._prealodMethod);for(var n=0;n<5;n++)r.push(this.module.HEAP32[t/Int32Array.BYTES_PER_ELEMENT+n]);var i={bitrate:r[0],pduration:r[1],preloadType:r[2],size:r[3],mediaType:r[4]};return this.logger("getPreloadBitrate",i),i}catch(o){e=null}finally{this.module._free(t)}return e}},{key:"_updateDeviceInfo",value:function(t){try{if(this._hasDeviceInfoChanged){var e=window.devicePixelRatio||1;this.module._updateDeviceInfo(this._videoWidth||Number(this.config.width),this._videoHeight||Number(this.config.height),e,t||-1)}this._hasDeviceInfoChanged=!1}catch(r){}}},{key:"preload",value:function(t){this.parseMPD(),this.updatePreloadSupplier(t),this._updateDeviceInfo(-1);var e=window.devicePixelRatio||1;return this.logger("baseAbr updateDeviceInfo width",this._videoWidth||Number(this.config.width),"height",this._videoHeight||Number(this.config.height),"dpr",e),this.getPreloadBitrate()}}]),t}();u.SPPED_CACHE=s},52530:function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(i=n.key,o=void 0,"symbol"==typeof(o=function(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(i,"string"))?o:String(o)),n)}var i,o}function o(t,e,r){return e&&i(t.prototype,e),r&&i(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function a(t){return(a=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function s(t,e){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function l(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function u(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=a(t);if(e){var i=a(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return l(t)}(this,r)}}function c(t){return function(t){if(Array.isArray(t))return h(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return h(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return h(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}r.d(e,{_c:function(){return m},ZP:function(){return x}});r(20493),r(27780),r(16279),r(23594),r(43246),r(77734),r(57119),r(19604),r(28995),r(70803),r(6921),r(50415),r(43528),r(42639),r(66769),r(23442),r(34916),r(74989),r(49649),r(25134),r(63930),r(67519),r(36084),r(51890),r(64084),r(14394),r(85048),r(71486),r(14973),r(59078),r(52448),r(89898),r(89071),r(25235),r(80226),r(98925),r(66029),r(64782),r(80859),r(26536),r(27529),r(83336),r(21962),r(38262),r(8250),r(29035),r(15837),r(44512),r(70873);var f=r(77717),d=r(82009),p=(r(22528),r(58484)),g=r(74976),v="danger_d_speed";var _=function(){function t(e,r,i,o){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{logger:function(){},openLog:!1};n(this,t),this.bitrate=r,this.segment_duration=o||5e3,this.logger=a.logger,this.openLog=a.openLog,this.cdnHost=e.cdnHost,this._loadedPromise=new p.Z,this._wasmPromise=new p.Z,this.config=e,this.autoBitrateOpts=e.autoBitrateOpts||{},this.stall_penalty=this.autoBitrateOpts.stall_penalty||11,this.switch_penalty=this.autoBitrateOpts.switch_penalty||4,this.interval=this.autoBitrateOpts.interval||1e3;var s=e.progressTimer||1e3,l=this.autoBitrateOpts.startInterval||s;this.initInterval=.8*l,this._prealodMethod=e.preloadmethod||0,this._videoWidth=0,this._videoHeight=0,this._hasDeviceInfoChanged=!0,this._maxDefinition=this.autoBitrateOpts.maxDefinition||null,this._underflowDefinition=this.autoBitrateOpts.underflowDefinition||null,this.updateMediaInfos(i,!1)}return o(t,[{key:"onLoadWasm",value:function(){var t=this,e=this.module={onRuntimeInitialized:function(){t._wasmPromise.resolve()}};return(0,this.autoBitrateOpts.module)(e),this._wasmPromise}},{key:"updateMediaInfos",value:function(t){var e=this;this._heightToDefitionConfig=new Map,this._bitrateToDefitionConfig=new Map,this._definitionToDefitionConfig=new Map,t&&(this.mediaInfos=t,this.mediaInfos.dynamic_video_list.forEach((function(t){e._heightToDefitionConfig.set(t.vheight,t),e._bitrateToDefitionConfig.set(t.bitrate,t),e._definitionToDefitionConfig.set(t.definition,t)})),this._maxDefinition&&(this._defaultMaxBitrate=this._getBitrate(this._maxDefinition)),this._underflowDefinition&&(this._underflowBitrate=this._getBitrate(this._underflowDefinition)))}},{key:"_getBitrate",value:function(t){var e;return(null===(e=this._definitionToDefitionConfig.get(t))||void 0===e?void 0:e.bitrate)||-1}},{key:"parseMPD",value:function(){if(this.setDebugModel(this.openLog),this.mediaInfos){this.logger("mediaInfos",this.mediaInfos);try{for(var t=[],e=this.mediaInfos.dynamic_video_list,r=0;r<e.length;r++){var n=e[r];t.push({stream_id:"s".concat(r),bandwidth:n.bitrate||n.bandwidth,width:n.vwidth||n.width,height:n.vheight||n.height,codec:n.codecs||n.codec_type||"h264",frame_rate:Number(n.fps)||-1,segment_duration:this.segment_duration})}var i={v_adaptation:t},o=JSON.stringify(i);this.module.ccall("parseMPD","null",["string"],[o])}catch(a){}}}},{key:"_getDefautSpeed",value:function(t){var e=0,r=window.navigator.connection;if(r&&r.downlink)e=1024*navigator.connection.downlink/8,this.logger("initSpeed connect",e);else try{e=parseFloat(g.Z.getItem(v))||0,this.logger("initSpeed connect",e)}catch(n){}return 0===e&&(e=t&&t.historyAvspeed||0,this.logger("initSpeed history",e)),e}},{key:"setDebugModel",value:function(t){this.module._setDebugModel(t)}},{key:"updateBitrate",value:function(t){this.bitrate=t}},{key:"_updatePreloadSupplier",value:function(t,e){this.module._updatePreloadSupplier(t,e)}},{key:"updatePreloadSupplier",value:function(t){var e=this._getDefautSpeed();this._updatePreloadSupplier(e,t)}},{key:"getPreloadBitrate",value:function(){var t,e=null,r=[];try{this.logger("preloadMethod",this._prealodMethod),t=this.module._getPreloadBitrate(this._prealodMethod);for(var n=0;n<5;n++)r.push(this.module.HEAP32[t/Int32Array.BYTES_PER_ELEMENT+n]);var i={bitrate:r[0],pduration:r[1],preloadType:r[2],size:r[3],mediaType:r[4]};return this.logger("getPreloadBitrate",i),i}catch(o){e=null}finally{this.module._free(t)}return e}},{key:"_updateDeviceInfo",value:function(t){try{if(this._hasDeviceInfoChanged){var e=window.devicePixelRatio||1;this.module._updateDeviceInfo(this._videoWidth||Number(this.config.width),this._videoHeight||Number(this.config.height),e,t||-1)}this._hasDeviceInfoChanged=!1}catch(r){}}},{key:"preload",value:function(t){this.parseMPD(),this.updatePreloadSupplier(t),this._updateDeviceInfo(-1);var e=window.devicePixelRatio||1;return this.logger("baseAbr updateDeviceInfo width",this._videoWidth||Number(this.config.width),"height",this._videoHeight||Number(this.config.height),"dpr",e),this.getPreloadBitrate()}}]),t}();_.SPPED_CACHE=v;var m={ABR_CHANGE:"ABR_CHANGE_A",ABR_UPDATE_SPEC:"ABR_UPDATE_SPEC",START_ABR:"START_ABR",UPDATE_AUTO_DESC:"UPDATE_AUTO_DESC",ABR_START_PROGRESS:"ABR_START_PROGRESS",MAX_BUFFER_CHANGE:"MAX_BUFFER_CHANGE",ABR_LIMIT_BITRATE:"ABR_LIMIT_BITRATE"},y=0,b=1,w=-1,k=0,I=1,C={PLAYBACK_BITRATE:"avg_play_bitrate",DOWNLOAD_BITRATE:"avg_download_bitrate",DOWNLOAD_NETWORK_SPEED:"avg_download_speed",PREDICT_NETWORK_SPEED:"avg_predict_speed",BUFFER_LENGTH:"avg_buffer_length",QOE:"avg_qoe"},x=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&s(t,e)}(r,t);var e=u(r);function r(t,i,o,a,s){var u,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{logger:function(){},openLog:!1};n(this,r),(u=e.call(this,i,o,a,s,c)).player=t,u.timerId=0,u.isOpenAutoDefi=!!u.autoBitrateOpts.isOpenAutoDefi,u._maxDefinition=u.autoBitrateOpts.maxDefinition||null,u.onPlayrateChange=u._onPlayrateChange.bind(l(u)),u.onPlay=u._onPlay.bind(l(u)),u._stop=u.stop.bind(l(u)),u._bufferRange=new Map,u._sortedBufferRange=[],u._lastCheckResolutionStamp=0,u._currentDefinition=null,u._isSeeking=!1,u._waitingStartTime=0,u._stallCount=0,u._seekState=y,u._stallState=k,u._videoCurrentTime=0,u._maxBitrate=-1,u.listeners=[{evt:"playbackrateChange",handler:u.onPlayrateChange},{evt:"ended",handler:u._stop},{evt:"error",handler:u._stop},{evt:"timeupdate",handler:u._onTimeUpdate.bind(l(u))},{evt:"addVideoBufferEnd",handler:u._bufferRangeUpdate.bind(l(u))},{evt:"canplay",handler:u._updateAutoDesc.bind(l(u))},{evt:"play",handler:u._onplayStart.bind(l(u))},{evt:m.MAX_BUFFER_CHANGE,handler:u._onMaxBufferChange.bind(l(u))},{evt:"seeking",handler:u._onSeeking.bind(l(u))},{evt:"seeked",handler:u._onSeekEnd.bind(l(u))},{evt:"waiting",handler:u._onWaiting.bind(l(u))},{evt:"playing",handler:u._onPlaying.bind(l(u))}],u._hasStart=!1,u.listeners.forEach((function(t){var e=t.evt,r=t.handler;u.player.on(e,r)})),u._isPaused=!1,u._hasAddFrament=!1,u._eventInfo={local_time_ms:0,internet_speed:0,buffer_length:0,last_bitrate:0,now_bitrate:0,play_speed:1},u._bitrateSet=[],u._generalInfo={},u._currentInAbr=!1,u._hasCalcTimelineLog=!1,u._abr_play_info={start_play_time_ms:0,is_hint:0,playback_info:{internet_speed_record:[],play_bitrate_record:[],buffer_length_record:[],play_speed_record:[],qoe_record:[],qoe_a_record:[],qoe_b_record:[],qoe_c_record:[]}},u._abrMethod=u.autoBitrateOpts.method||0,u.logger("abr: constructor"),u._loopInterval=u.initInterval,u._tickCount=0,u._fps=30,f.Z.install(),u.startTime=performance.now(),u.logger("time abr",(new Date).getTime()),u._maxCacheTimeVideo=u.config.preloadTime||5,u._maxCacheTimeAudio=u._maxCacheTimeVideo,u._prevDefinitionItem=null,u._currentItem=null,u._switchCount=0,u._switchBitrate=0,u._avgStatItems={};for(var h=Object.keys(C),d=0;d<h.length;d++){var p=h[d],g=C[p];u._avgStatItems[g]=new S}return u._qoeArgs=[0,0,0,0],u._abrUsed=-1,u._abrAlwaysOn=1,u._prelaodInfo=null,u._hasLogStartInfo=!1,u._hasExecuteAbrAlgo=!1,u._lastExecuteTimeInMs=0,u}return o(r,[{key:"init",value:function(t){return this._mediaList=t,this.isOpenAutoDefi?this.onLoadWasm():this._wasmPromise.resolve(),this._wasmPromise}},{key:"execute",value:function(){return this.listenSize(),this.initFps(),this.onWinElemSizeChange(),this.onPlay()}},{key:"_onSeeking",value:function(){this._isSeeking=!0,this.player.currentTime<this._videoCurrentTime?this._seekState=w:this._seekState=b,this.logger("seekState",this._seekState)}},{key:"_onSeekEnd",value:function(){this._isSeeking=!1}},{key:"_onWaiting",value:function(){var t=this;if(!(this._isSeeking||this._waitingStartTime>0)){for(var e=this.player.video.buffered,r=this.player.currentTime,n=!1,i=0;i<e.length;i++){var o=e.start(i),a=e.end(i);if(o<=r&&r<a-1&&this.player.readyState<HTMLVideoElement.HAVE_ENOUGH_DATA){n=!0;break}}n&&(this._defaultMaxBitrate||this._underflowBitrate)&&(this.player.emit(m.ABR_LIMIT_BITRATE),this._underflowBitrate>0&&(this._maxBitrate=this._underflowBitrate)),this._waitingStartTime=(new Date).getTime(),this._stallId=setTimeout((function(){clearTimeout(t._stallId),t._stallCount++,t._stallState=I}),200)}}},{key:"_onPlaying",value:function(){this._waitingStartTime=0,this._stallState=k,clearTimeout(this._stallId)}},{key:"initFps",value:function(){this.fpsDetection=new f.Z,this.fpsDetection.start(),this._fps=this.fpsDetection.fps,this._hasDeviceInfoChanged=!0}},{key:"listenSize",value:function(){this.mediaElem=this.player.video,this._onWinSizeChange=(0,d.Z)(this.onWinElemSizeChange.bind(this),1e3,!1),window.addEventListener("resize",this._onWinSizeChange)}},{key:"onWinElemSizeChange",value:function(){if(this.mediaElem){var t=this.mediaElem.getBoundingClientRect();this._videoWidth=Math.floor(t.width),this._videoHeight=Math.floor(t.height),this._hasDeviceInfoChanged=!0}}},{key:"_onMaxBufferChange",value:function(t){var e=t.videoCacheTime,r=t.audioCacheTime;this._maxCacheTimeAudio=r,this._maxCacheTimeVideo=e}},{key:"_onTimeUpdate",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._sortedBufferRange&&0!==this._sortedBufferRange.length&&this._currentInAbr){this._videoCurrentTime=this.player.currentTime;var r=Date.now();if(!(r-this._lastCheckResolutionStamp<1e3&&0!==this._lastCheckResolutionStamp)||e){this._lastCheckResolutionStamp=r;for(var n=this.player.currentTime,i=0,o=this._sortedBufferRange.length-1,a=null;i<=o;){var s=Math.floor(i+(o-i)/2),l=this._sortedBufferRange[s];if(n<l.start)o=s-1;else{if(!(n>=l.end)){a=l;break}i=s+1}}if(a){var u=this._bitrateToDefitionConfig.get(a.bandwidth),c=u&&u.definition;if(this._currentDefinition===c&&!e||!c)return void(c||this.logger("error defintion, mpd\u914d\u7f6e\u4e0e\u63a5\u53e3\u914d\u7f6e\u4e0d\u4e00\u81f4"));this._currentDefinition=c,this._prevDefinitionItem=this._currentItem,this._currentFps=u.fps,this._currentItem=u,this._emitAutoDescChange(c,!1,this._currentFps,u)}}}}},{key:"_emitAutoDescChange",value:function(t,e,r,n){this.player.emit(m.UPDATE_AUTO_DESC,{definition:t,reset:e,fps:r,item:n,pre_item:this._prevDefinitionItem})}},{key:"_onplayStart",value:function(){this._hasStart=!0,this.logger("onplaystart")}},{key:"_updateAutoDesc",value:function(){var t=this;this._currentInAbr&&this._currentDefinition&&(this._updateId=setTimeout((function(){clearTimeout(t._updateId),t._emitAutoDescChange(t._currentDefinition,!1,t._currentFps,t._currentItem)}),0))}},{key:"_bufferRangeUpdate",value:function(t){if(void 0!==t.start){null===this._currentItem&&this._onTimeUpdate(null,!0);var e=t.start;this._hasAddFrament=!0,this._bufferRange.set(e,t);var r=c(this._bufferRange.values());this._sortedBufferRange=r.sort((function(t,e){return t.start-e.start})),this.avgStat(C.DOWNLOAD_BITRATE,t.bandwidth)}}},{key:"_onPlayrateChange",value:function(){this.module&&this.updateBufferInfo()}},{key:"_onPlay",value:function(){var t=this;if(!this.isOpenAutoDefi)return this.logger("onPlay"),0;var e=0;try{this.logger("abr: loadeddata"),this.updateSwitchInfo(),this.parseMPD(),this.updateDeviceInfo();var n=r.getIsPlayAutoDefi(this.autoBitrateOpts);if(this.isOpenAutoDefi&&n){this._abrUsed=1;var i=this._getDefautSpeed(this.player);e=this._loopAbr(i),this.start(),this.logger("time abr start prgress",(new Date).getTime()),this.logger("time abr costTime",performance.now()-this.startTime),this.logger("abr onplay"),this.startTimer=setTimeout((function(){t._loopInterval=t.interval,clearTimeout(t.startTimer),t.logger("interval change")}),5e3)}}catch(o){this.logger("abr: loadeddata error",o),this.logger("time abr costTime err",performance.now()-this.startTime)}return e}},{key:"start",value:function(){if(this.logger("abr: start"),this._isPaused=!1,!this._hasCalcTimelineLog){var t=1===Math.floor(100*Math.random());this._abr_play_info.is_hint=t?1:0}this._hasCalcTimelineLog=!0,this._loop()}},{key:"_loop",value:function(){var t=this;this._isPaused||(clearTimeout(this.timerId),this.timerId=setTimeout((function(){if(!t.player.paused||!t.player.config.autoplay&&!t._hasStart){var e=t._hasAddFrament?void 0:t._getDefautSpeed(t.player);t._loopAbr(e)}t._loop()}),this._loopInterval))}},{key:"updateDeviceInfo",value:function(){try{if(this.fpsDetection){var t=this.fpsDetection.fps;t!==this._fps&&(this._fps=t,this._hasDeviceInfoChanged=!0)}this._updateDeviceInfo(this._fps)}catch(e){}}},{key:"updateBufferInfo",value:function(t){var e=this.player.playbackRate,r=this.bufferLength,n=t||Math.floor(this.player.downloadSpeed);this._tickCount<5&&0===n&&(n=this._getDefautSpeed(this.player),this.logger("initSpeed fix"));var i=-1===this._maxBitrate?this._defaultMaxBitrate:this._maxBitrate;return this.logger("maxCacheTimeAudio:",this._maxCacheTimeAudio,"maxCacheVideoTime",this._maxCacheTimeVideo,"seekState",this._seekState,"stallState",this._stallState,"maxBitrate",i),this.module._updateBufferInfo(e,this._maxCacheTimeAudio,this._maxCacheTimeVideo,r,r,n,this._seekState,this.player.currentTime,this._stallState,i),this._seekState=y,this._eventInfo={internet_speed:n,buffer_length:r,last_bitrate:this.bitrate,play_speed:e},this.logger("playRate:",e,"buff:",r,"downloadSpeed:",n),{buffer:r,downloadSpeed:n}}},{key:"updateSwitchInfo",value:function(){var t=(new Date).getTime();this._openTimeMs=t,this._abr_play_info.start_play_time_ms=t;var e,r,n=this.player.config.preloadTime||50,i=(r=(e=t).toString(16)).length<=8?{high:0,low:e}:{high:parseInt(r.substr(0,r.length-8),16),low:parseInt(r.substr(r.length-8),16)},o=this.autoBitrateOpts.noStallCheckTime||5,a=this.openLog;this.logger("openTime:",t,"this.logger",a),this.module._updateSwitchInfo(i.low,i.high,o,a,this.stall_penalty,this.switch_penalty);var s=this._mediaList.video,l=s.map((function(t){var e=t.bandwidth,r=t.bitrate;return e||r}));this._bitrateSet=l.map((function(t,e){return{bitrate:t,codecs:s[e].codecs||s[e].codec_type}})),this._generalInfo={max_cache_time:n,bitrate_set:this._bitrateSet,segment_duration:this.segment_duration,preload_info:{},startup_info:{}}}},{key:"updatePreloadCacheInfo",value:function(t){try{this._prelaodInfo=t,this.logger("update preloadInfo",t),t&&t.item_num!==t.items.length&&(this.logger("preloadInfo invalid"),this._prelaodInfo=null)}catch(e){this.logger("updatePreloadCacheInfo",e),this._prelaodInfo=null}}},{key:"updatePreloadLogInfo",value:function(t){this._generalInfo.preload_info=t||{}}},{key:"_updatePreloadInfo",value:function(){try{var t=this.player.getPreloadInfos();if(t){var e=t.preloadInfo,r=t.abr;this.updatePreloadLogInfo(e),r&&this.updatePreloadCacheInfo(e)}if(this.logger("_updatePreloadInfo preloadinfos",t),null!=this._prelaodInfo){var n=JSON.stringify(this._prelaodInfo);this.module.ccall("updatePreloadInfo","null",["string"],[n])}else this.logger("_updatePreloadInfo preloadinfo null, no preload")}catch(i){this.logger("_updatePreloadInfo err",i)}}},{key:"_loopAbr",value:function(t){var e;this._tickCount++;var r=[];try{this.updateDeviceInfo();var n=this.updateBufferInfo(t),i=n.downloadSpeed,o=n.buffer;e=this.module._getPredictedBitrate(this.bitrate,this._abrMethod);for(var a=0;a<7;a++)r.push(this.module.HEAP32[e/Int32Array.BYTES_PER_ELEMENT+a]);var s=r[0],l=1===r[1];this._eventInfo.now_bitrate=s,this._eventInfo.local_time_ms=(new Date).getTime();var u=0;if(s!==this.bitrate&&0!==s){var c=this.bitrate;u=Math.abs(c-s);for(var h=[],f=this.player.video.buffered,d=0;d<f.length;d++)h.push({start:f.start(d),end:f.end(d)});var p=this._videoWidth||Number(this.config.width),g=this._videoHeight||Number(this.config.height),v=(new Date).getTime(),_={speed:"".concat(i," KB/s"),buffer_length:"".concat(o," s"),video_pos:this.player.currentTime,all_buffers:h,seek_state:this._seekState,stall_state:this._stallState,screen_width:p,screen_height:g,dpr:window&&window.devicePixelRatio,playbackRate:this.player.playbackRate,bitrateSet:this._bitrateSet,abrMethod:this._abrMethod,delta:this._hasExecuteAbrAlgo?v-this._lastExecuteTimeInMs:0};this._lastExecuteTimeInMs=v,this._hasExecuteAbrAlgo=!0,this.player.emit(m.ABR_CHANGE,this.bitrate,s,l,JSON.stringify(_)),this.logger("abr loop predicte:",s,"willStall:",l,"switchBitrate",u,"cur",c),this.bitrate=s}this._hasLogStartInfo||(this._hasLogStartInfo=!0,this._generalInfo.startup_info={predict_bitrate:s,download_speed:i,screen_width:this._videoWidth||Number(this.config.width),screen_height:this._videoHeight||Number(this.config.height),device_pixel_ratio:window&&window.devicePixelRatio,screen_fps:this._fps,startup_method:this._abrMethod}),this.player.emit("ABR_LOOP"),this.onAbrLoop(i,r[2],u,r.slice(3))}catch(y){this.logger("abr error",y)}finally{this.module._free(e)}return this.bitrate}},{key:"stop",value:function(){!0===(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&(this._abrAlwaysOn=-1),clearTimeout(this.timerId),this._isPaused=!0,this.logger("abr: stop")}},{key:"destroy",value:function(){var t=this;this._stop(),this.listeners.forEach((function(e){var r=e.evt,n=e.handler;t.player.off(r,n)})),this.player=null,this._heightToDefitionConfig=null,this._bitrateToDefitionConfig=null,this._bufferRange=null,this._sortedBufferRange=null,this.module=null,clearTimeout(this._stallId),clearTimeout(this._updateId),clearTimeout(this.startTimer),window.removeEventListener("resize",this._onWinSizeChange),this.fpsDetection&&this.fpsDetection.stop(),this._maxBitrate=-1,this.player=null}},{key:"eventInfo",get:function(){return this._eventInfo}},{key:"generalInfo",get:function(){return this._generalInfo}},{key:"bufferLength",get:function(){var t=this.player.getBufferedRange(),e=this.player.video.currentTime,r=t[1]-Math.max(t[0],e);return r=Math.max(0,r).toFixed(2),parseFloat(r)}},{key:"downloadSpeed",get:function(){return Math.floor(this.player.downloadSpeed)}},{key:"nowBitrate",get:function(){return this.bitrate}},{key:"openTimeMs",get:function(){return this._openTimeMs}},{key:"isCurrentInAbr",get:function(){return this._currentInAbr},set:function(t){this._currentInAbr=t}},{key:"onAbrLoop",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];if(this._qoeArgs=n,this._currentItem&&this.avgStat(C.PLAYBACK_BITRATE,this._currentItem.bitrate),this.avgStat(C.DOWNLOAD_NETWORK_SPEED,1e3*t*8),this.avgStat(C.PREDICT_NETWORK_SPEED,e),this.avgStat(C.BUFFER_LENGTH,this.bufferLength),this.avgStat(C.QOE,this.getQoeRelValue(0)),r>0&&(this._switchCount++,this._switchBitrate+=r),this._abr_play_info.is_hint){var i=this,o=((new Date).getTime()-this.openTimeMs)/1e3;o=parseFloat(o.toFixed(2)),this._abr_play_info.playback_info.internet_speed_record.push([o,i.downloadSpeed]),this._abr_play_info.playback_info.play_bitrate_record.push([o,i.nowBitrate]),this._abr_play_info.playback_info.buffer_length_record.push([o,i.bufferLength]),this._abr_play_info.playback_info.play_speed_record.push([o,this.player.playbackRate]),this._abr_play_info.playback_info.qoe_record.push([o,this.getQoeRelValue(0)]),this._abr_play_info.playback_info.qoe_a_record.push([o,this.getQoeRelValue(1)]),this._abr_play_info.playback_info.qoe_b_record.push([o,this.getQoeRelValue(2)]),this._abr_play_info.playback_info.qoe_c_record.push([o,this.getQoeRelValue(3)])}}},{key:"getQoeRelValue",value:function(t){return this._qoeArgs[t]/100}},{key:"avgStat",value:function(t,e){var r=this._avgStatItems[t];r&&r.add(e)}},{key:"getAbrPlayInfo",value:function(){return this._abr_play_info}},{key:"updateAbrMethod",value:function(t){this._abrMethod=t}},{key:"getAbrMethod",value:function(){return this._abrMethod}},{key:"getAbrVVStats",value:function(){for(var t={},e=Object.keys(C),r=0;r<e.length;r++){var n=e[r],i=C[n],o=this._avgStatItems[i];t[i]=o.avg()}return t.switch_counts=this._switchCount,t.avg_switch_bitrate=0===this._switchCount?0:this._switchBitrate/this._switchCount,t.abr_qoe=this.getQoeRelValue(0),t.abr_qoe_a=this.getQoeRelValue(1),t.abr_qoe_b=this.getQoeRelValue(2),t.abr_qoe_c=this.getQoeRelValue(3),t.abr_method=this._abrMethod,t.abr_used=this._abrUsed,t.abr_always_on=this._abrAlwaysOn,this.logger("abrVVStats",t),t}}],[{key:"getIsPlayAutoDefi",value:function(t){return!!t.isPlayAutoDefi}}]),r}(_),S=function(){function t(){n(this,t),this.total=0,this.count=0}return o(t,[{key:"add",value:function(t){this.total+=t,this.count++}},{key:"avg",value:function(){if(0===this.count)return 0;var t=this.total/this.count;return Math.floor(t)}}]),t}()},87977:function(t,e,r){"use strict";function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function a(t,e,r){return e&&o(t.prototype,e),r&&o(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}r.d(e,{PA:function(){return i},qH:function(){return a},Ac:function(){return n}})},98205:function(t,e,r){"use strict";r.d(e,{l0:function(){return n}});var n=r(36091).l0},99582:function(t,e,r){"use strict";r.d(e,{Z:function(){return i}});var n=r(87977),i=(r(16279),r(49649),function(){function t(){(0,n.PA)(this,t),this.bandwidth2item={},this._mediaInfos=null,this.__p__=!0}return(0,n.qH)(t,[{key:"init",value:function(){throw new Error("init func not implement, return promise")}},{key:"preloadPredict",value:function(t){throw new Error("preloadPredict error",t)}},{key:"updateMediaInfos",value:function(t){if(this._mediaInfos=t,this.bandwidth2item={},this.dynamic_video=t&&t.dynamic_video_list,this.dynamic_video&&this.dynamic_video.length>0)for(var e=0;e<this.dynamic_video.length;e++){var r=this.dynamic_video[e];this.bandwidth2item[r.bitrate||r.bandwidth]=r}}},{key:"getIdx",value:function(t,e){var r=0;return t.forEach((function(t,n){t.definition===e&&(r=n)})),r}},{key:"cachedData",get:function(){return null}}]),t}())},36091:function(t,e,r){"use strict";r.d(e,{Rr:function(){return u},x7:function(){return c},w_:function(){return s},wW:function(){return a},CN:function(){return n},LB:function(){return i},dJ:function(){return l},PO:function(){return o},l0:function(){return h}});var n="PRELOAD_NEXT",i="PRELOAD_SEG_DONE",o={PREPARE:"PREPARE",IDLE:"IDLE",PRELOADING:"PRELOADING",FINISH:"FINISH"},a="ONE_STEP_DONE",s={VIDEO:0,AUDIO:1,MIXED:2},l={DURATION:0,SIZE:1},u={INDEXDB:0,MEMORY:1},c={FAIL:-1,SUCCESS:0,DOWNLOADING:1},h={MP4:"MP4",DASH:"DASH",HLS:"HLS"}},37314:function(t,e,r){"use strict";r.d(e,{Z:function(){return E}});var n=r(87977),i=(r(16279),r(41620),r(21454),r(49413),r(46393)),o=r.n(i),a=(r(36117),r(63930),r(23850),r(70440),r(58484)),s=r(38320),l=r.n(s),u=r(36091),c=function(){function t(e,r,i,a,s){(0,n.PA)(this,t),o()(this),this.state=u.PO.PREPARE,this.options=e||{},this.logger=e.logger||function(){},this._preloadManager=r,this.player=r.player;var l=i.handlers,c=i.predictInst,h=i.readyPromise;this._predictInst=c,this._handlers=l,this._predictInstReadyPromise=h,this._toLoadList=[],this.retryCount=0,this._cachedHandler=a,this._cachedDataHanlder=s,this.cnt=0}return(0,n.qH)(t,[{key:"start",value:function(){var t=this,e=new a.Z;return this._handlers.start(this.options).then((function(r){r.onObtain().then((function(n){t._predictInstReadyPromise.then((function(){t._predictInst.updateMediaInfos(n);var i=t._predictInst.preloadPredict(t.options),o=t._predictInst.cachedData;t._cachedDataHanlder(Object.assign({vid:t.options.vid},{data:o}));var a=Object.assign(i,t.options);r.onTransform(a).then((function(r){t._toLoadList=r,e.resolve(r)}))}))}))})).catch((function(t){e.reject(new Error("preload unit start error"))})),e}},{key:"preloadSeg",value:function(){var t=this;if(0===this._toLoadList.length)return this.state=u.PO.FINISH,void this.emit(u.LB,!0);this.state="PRELOADING";var e=this._toLoadList.shift();this._handlers.onRequest(e,(function(r){var n=Object.assign({},e.extData,r);t._cachedHandler(n)})).then((function(){t.state=u.PO.IDLE,t.emit(u.LB)})).catch((function(e){t.requestError(),t.emit(u.LB,!1)}))}},{key:"requestError",value:function(){this.retryCount++,this.state=u.PO.IDLE,this.retryCount>=10&&(this.state=u.PO.FINISH),this.emit(u.wW),this.logger("preload request error")}},{key:"cancelLoading",value:function(){this._toLoadList=[]}},{key:"destroy",value:function(){l()(this)}}]),t}();r(98538),r(6881),r(53840),r(44512),r(27181),r(20493),r(23594),r(74989),r(22528);var h=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(t){}}();function f(t,e){e&&t.then((function(t){e(null,t)}),(function(t){e(t)}))}function d(t){return"string"!=typeof t&&(t=String(t)),t}var p={},g="readonly",v="readwrite";function _(t){var e=p[t.name],r={};r.promise=new Promise((function(t,e){r.resolve=t,r.reject=e})),e.deferredOperations.push(r),e.dbReady?e.dbReady=e.dbReady.then((function(){return r.promise})):e.dbReady=r.promise}function m(t,e){return new Promise((function(r,n){if(p[t.name]=p[t.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},t.db){if(!e)return r(t.db);_(t),t.db.close()}var i=[t.name];e&&i.push(t.version);var o=h.open.apply(h,i);e&&(o.onupgradeneeded=function(e){var r=o.result;try{r.createObjectStore(t.storeName)}catch(n){if("ConstraintError"!==n.name)throw n}}),o.onerror=function(t){t.preventDefault(),n(o.error)},o.onsuccess=function(){r(o.result),function(t){var e=p[t.name].deferredOperations.pop();if(e)e.resolve(),e.promise}(t)}}))}function y(t){return m(t,!1)}function b(t){return m(t,!0)}function w(t,e){if(!t.db)return!0;var r=!t.db.objectStoreNames.contains(t.storeName),n=t.version<t.db.version,i=t.version>t.db.version;if(n&&(t.version,t.version=t.db.version),i||r){if(r){var o=t.db.version+1;o>t.version&&(t.version=o)}return!0}return!1}function k(t){_(t);for(var e=p[t.name],r=e.forages,n=0;n<r.length;n++){var i=r[n];i._dbInfo.db&&(i._dbInfo.db.close(),i._dbInfo.db=null)}return t.db=null,y(t).then((function(e){return t.db=e,w(t)?b(t):e})).then((function(n){t.db=e.db=n;for(var i=0;i<r.length;i++)r[i]._dbInfo.db=n})).catch((function(e){throw function(t,e){var r=p[t.name].deferredOperations.pop();if(r)r.reject(e),r.promise}(t,e),e}))}function I(t,e,r,n){void 0===n&&(n=1);try{var i=t.db.transaction(t.storeName,e);r(null,i)}catch(o){if(n>0&&(!t.db||"InvalidStateError"===o.name||"NotFoundError"===o.name))return Promise.resolve().then((function(){if(!t.db||"NotFoundError"===o.name&&!t.db.objectStoreNames.contains(t.storeName)&&t.version<=t.db.version)return t.db&&(t.version=t.db.version+1),b(t)})).then((function(){return k(t).then((function(){I(t,e,r,n-1)}))})).catch(r);r(o)}}var C=function(){function t(){(0,n.PA)(this,t)}return(0,n.qH)(t,[{key:"ready",value:function(){return this._ready}},{key:"_initStorage",value:function(t){var e=this;e._defaultConfig=t;var r={db:null};if(t)for(var n in t)r[n]=t[n];var i=p[r.name];i||(i={forages:[],db:null,dbReady:null,deferredOperations:[]},p[r.name]=i),i.forages.push(e),e._initReady||(e._initReady=e.ready,e.ready=e._fullyReady);var o=[];function a(){return Promise.resolve()}for(var s=0;s<i.forages.length;s++){var l=i.forages[s];l!==e&&o.push(l._initReady().catch(a))}var u=i.forages.slice(0);return e._ready=Promise.all(o).then((function(){return r.db=i.db,y(r)})).then((function(t){return r.db=t,w(r,e._defaultConfig.version)?b(r):t})).then((function(t){r.db=i.db=t,e._dbInfo=r;for(var n=0;n<u.length;n++){var o=u[n];o!==e&&(o._dbInfo.db=r.db,o._dbInfo.version=r.version)}})),e._ready}},{key:"probeSupport",get:function(){return function(){try{if(!h||!h.open)return!1;var t="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),e="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!t||e)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(r){return!1}}()}},{key:"getItem",value:function(t,e){var r=this;t=d(t);var n=new Promise((function(e,n){r.ready().then((function(){I(r._dbInfo,g,(function(i,o){if(i)return n(i);try{var a=o.objectStore(r._dbInfo.storeName).get(t);a.onsuccess=function(){var t=a.result;void 0===t&&(t=null),e(t)},a.onerror=function(){n(a.error)}}catch(s){n(s)}}))})).catch(n)}));return f(n,e),n}},{key:"setItem",value:function(t,e,r){var n=this;t=d(t);var i=new Promise((function(r,i){n.ready().then((function(){return n._dbInfo,e})).then((function(e){I(n._dbInfo,v,(function(o,a){if(o)return i(o);try{var s=a.objectStore(n._dbInfo.storeName);null===e&&(e=void 0);var l=s.put(e,t);a.oncomplete=function(){void 0===e&&(e=null),r(e)},a.onabort=a.onerror=function(){var t=l.error?l.error:l.transaction.error;i(t)}}catch(u){i(u)}}))})).catch(i)}));return f(i,r),i}},{key:"removeItem",value:function(t,e){var r=this;t=d(t);var n=new Promise((function(e,n){r.ready().then((function(){I(r._dbInfo,v,(function(i,o){if(i)return n(i);try{var a=o.objectStore(r._dbInfo.storeName).delete(t);o.oncomplete=function(){e()},o.onerror=function(){n(a.error)},o.onabort=function(){var t=a.error?a.error:a.transaction.error;n(t)}}catch(s){n(s)}}))})).catch(n)}));return f(n,e),n}},{key:"clear",value:function(t){var e=this,r=new Promise((function(t,r){e.ready().then((function(){I(e._dbInfo,v,(function(n,i){if(n)return r(n);try{var o=i.objectStore(e._dbInfo.storeName).clear();i.oncomplete=function(){t()},i.onabort=i.onerror=function(){var t=o.error?o.error:o.transaction.error;r(t)}}catch(a){r(a)}}))})).catch(r)}));return f(r,t),r}},{key:"length",value:function(t){var e=this,r=new Promise((function(t,r){e.ready().then((function(){I(e._dbInfo,g,(function(n,i){if(n)return r(n);try{var o=i.objectStore(e._dbInfo.storeName).count();o.onsuccess=function(){t(o.result)},o.onerror=function(){r(o.error)}}catch(a){r(a)}}))})).catch(r)}));return f(r,t),r}},{key:"all",value:function(t){var e=this,r=new Promise((function(t,r){e.ready().then((function(){I(e._dbInfo,g,(function(n,i){if(n)return r(n);try{var o=i.objectStore(e._dbInfo.storeName).openCursor(),a=[];o.onsuccess=function(){var e=o.result;e?(a.push({key:e.key,value:e.value}),e.continue()):t(a)},o.onerror=function(){r(o.error)}}catch(s){r(s)}}))})).catch(r)}));return f(r,t),r}},{key:"_fullyReady",value:function(t){var e=this,r=e._initReady().then((function(){var t=p[e._dbInfo.name];if(t&&t.dbReady)return t.dbReady}));return function(t,e,r){"function"==typeof e&&t.then(e),"function"==typeof r&&t.catch(r)}(r,t,t),r}}]),t}(),x=(r(25134),function(){function t(){(0,n.PA)(this,t)}return(0,n.qH)(t,[{key:"_initStorage",value:function(t){var e=t.name+"_"+t.storeName;return this.key=e,window[e]&&"object"===(0,n.Ac)(window[e])||(window[e]={}),this.store=window[e],Promise.resolve()}},{key:"getItem",value:function(t,e){var r=this.store[t];return void 0===r&&(r=null),this._internalPromise(e,r)}},{key:"setItem",value:function(t,e,r){return this.store[t]=e,this._internalPromise(r)}},{key:"removeItem",value:function(t,e){return delete this.store[t],this._internalPromise(e)}},{key:"clear",value:function(t){return this.store={},window[this.key]={},this._internalPromise(t)}},{key:"length",value:function(t){var e=Object.keys(this.store).length;return this._internalPromise(t,e)}},{key:"_internalPromise",value:function(t,e){var r=e?Promise.resolve(e):Promise.resolve();return f(r,t),r}},{key:"all",value:function(t){for(var e=[],r=Object.keys(this.store),n=0;n<r.length;n++){var i=r[n];e.push({key:i,value:this.store[i]})}return this._internalPromise(t,e)}},{key:"probeSupport",value:function(){return!0}}]),t}()),S=r(74976),T={description:"",name:"__PRE_CACHE__",storeName:"keyvaluepairs",version:1},A="__PRE_CACHE__KEYS",P=function(){function t(e,r){(0,n.PA)(this,t);var i=r===u.Rr.MEMORY?x:C;this._driver=new i,this._driver._initStorage(T).catch((function(){})),this._hasIdbForbidden=!1,this._maxCache=!e||e<=0?200:e,this.setMaxCache(this._maxCache),this._allCachedKeys={},this._allCachedTimeKeys={},this.getCachedKeysFromLocal(),this._readyPromise=new a.Z,this.init()}return(0,n.qH)(t,[{key:"getCachedKeysFromLocal",value:function(){var t=S.Z.getItem(A);if(t)for(var e=t.split("|"),r=0;r<e.length;r++){var n=e[r],i=this._getCacheKeyInfos(n),o=i.time,a=i.cachedKey;this._allCachedKeys[a]=1,this._allCachedTimeKeys[a]=o}}},{key:"_getCacheKeyInfos",value:function(t){var e,r=t.split("$");return 2===r.length&&(e=r[0],t=r[1]),{time:e,cachedKey:t}}},{key:"writeCachedKeysToLocal",value:function(t){var e=[];this._allCachedKeys={},this._allCachedTimeKeys={};for(var r=0;r<t.length;r++){var n=t[r].key,i=this._getCacheKeyInfos(n),o=i.time,a=i.cachedKey;this._allCachedKeys[a]=1,this._allCachedTimeKeys[a]=o,e.push(n)}var s=e.join("|");S.Z.setItem(A,s)}},{key:"init",value:function(){var t=this;this._driver.setItem("test","test").then((function(){})).catch((function(){t._hasIdbForbidden=!0})).finally((function(){t._driver.removeItem("test").catch((function(){})),t._hasIdbForbidden&&(t._driver=new x,t._driver._initStorage(T)),t._getAll(),t._readyPromise.resolve()}))}},{key:"_getAll",value:function(){var t=this;this._driver.all().then((function(e){t._cachedLength=e.length;var r=e.length-t._maxCache,n=e;if(r>0){var i=e.slice(0,r);n=e.slice(r);for(var o=0;o<i.length;o++)t.removeItem(i[o].key).then((function(){}))}t.writeCachedKeysToLocal(n)})).catch((function(){}))}},{key:"getItem",value:function(t,e){if(!this.hasItem(t))return Promise.resolve(!1);var r=this._getTimeKey(t).timeKey;return this._driver.getItem(r,e)}},{key:"setItem",value:function(t,e,r){var n=this;this._getTimeKey(t).timeKey&&this.removeItem(t);var i=(new Date).getTime();this._allCachedKeys[t]=1,this._allCachedTimeKeys[t]=i;var o=this._genTimeKey(t,i);return r=r?function(){n._getAll(),r()}:function(){n._getAll()},this._driver.setItem(o,e,r)}},{key:"_getTimeKey",value:function(t){var e=this._allCachedTimeKeys[t],r=t;return e&&(r=this._genTimeKey(t,e)),{timeKey:r,time:e}}},{key:"_genTimeKey",value:function(t,e){return"".concat(e).concat("$").concat(t)}},{key:"removeItem",value:function(t,e){var r=this._getTimeKey(t).timeKey,n=this._driver.removeItem(r,e);return delete this._allCachedKeys[t],delete this._allCachedTimeKeys[t],n}},{key:"hasItem",value:function(t){return!!this._allCachedKeys[t]}},{key:"clear",value:function(t){return this._driver.clear(t)}},{key:"length",value:function(t){return this._driver.length(t)}},{key:"setMaxCache",value:function(t){"number"==typeof t&&t>0&&(this._maxCache=t)}}]),t}(),D=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;(0,n.PA)(this,t),o()(this),this._preloadDataList=[],this._currentPreloadInst=null,this._dashPreloadList=[],this.autoPreload=e.autoPreload||!1,this._autoCheck=e.autoCheck||{enable:!1,interval:1e3},this._onPreloadNext=this.onPreloadNextReady.bind(this),this.on(u.CN,this._onPreloadNext),this._preloaderConfigs={},this.update(e,r,i),this._cacheInst=new P(e.preloadMaxCacheCount,e.preloadCacheType),this._preloadCacheProgress={},this._ptag_=!0,this._cachedDatas={},this._taskIntervalId=null}return(0,n.qH)(t,[{key:"startCheckTask",value:function(){var t=this,e=this._autoCheck,r=this._preloadDataList;(this._taskIntervalId&&(window.clearTimeout(this._taskIntervalId),this._taskIntervalId=null),0!==r.length)&&(this._checkIfCanPreload()&&this.onPreloadNext(),this._taskIntervalId=window.setTimeout((function(){t.startCheckTask()}),e.interval||1e3))}},{key:"stopCheckTask",value:function(){this._taskIntervalId&&(window.clearTimeout(this._taskIntervalId),this._taskIntervalId=null)}},{key:"_checkIfCanPreload",value:function(){if(null==this._currentPreloadInst&&this._preloadDataList.length>0){var t=this._preloadDataList[0].data;if(t.payload){var e=this._getProloaderKey(t),r=this._preloaderConfigs[e];if(r&&r.handlers){var n=r.handlers.checkIfCanPreload;return n?n(t):(this.stopCheckTask(),!1)}return this.stopCheckTask(),!1}}return!1}},{key:"_getProloaderKey",value:function(t){return t.vtype?t.vtype:"DEFAULT"}},{key:"update",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!r)throw new Error("PreloaderManager predictInst is null");var n=this._getProloaderKey(t);this._preloaderConfigs[n]={predictInst:r,readyPromise:r.init(t),handlers:e}}},{key:"cachedDatas",get:function(){return this._cachedDatas}},{key:"onCacheSegment",value:function(t){var e=t.vid,r=t.format,n=t.cacheKey,i=t.total,o=t.loaded,a=t.isInitSegment,s=t.mediaType,l=this.getProgressCacheKey(e,r,s),u=this._preloadCacheProgress[l];u||(u=this._preloadCacheProgress[l]={}),u[n]={total:i,loaded:o,isInitSegment:a}}},{key:"onCachePredict",value:function(t){var e=t.vid,r=t.data;e&&r&&(this._cachedDatas[e]=r)}},{key:"getProgressCacheKey",value:function(t,e,r){return"".concat(t,"-").concat(e,"-").concat(r)}},{key:"onPreloadNextReady",value:function(){this.onPreloadNext()}},{key:"onPreloadSegDone",value:function(){this.autoPreload&&this.emit(u.CN)}},{key:"onPreloadNext",value:function(){var t=this;if(null==this._currentPreloadInst&&this._preloadDataList.length>0){if(this._preloadDataList.length>0){var e=this._preloadDataList.shift().data;if(e.payload){var r=this._getProloaderKey(e),n=this._preloaderConfigs[r];if(!n)return;this._currentPreloadInst=new c(e,this,n,(function(e){t.onCacheSegment(e)}),(function(e){t.onCachePredict(e)})),this._currentPreloadInst.on(u.LB,this.onPreloadSegDone.bind(this)),this._currentPreloadInst.start().then((function(){t._currentPreloadInst.preloadSeg()})).catch((function(){t._currentPreloadInst=null}))}}}else null!=this._currentPreloadInst&&(this._currentPreloadInst.state===u.PO.IDLE?this._currentPreloadInst.preloadSeg():this._currentPreloadInst.state===u.PO.FINISH?(this._currentPreloadInst.destroy(),this._currentPreloadInst=null):this._currentPreloadInst.state===u.PO.PREPARE&&(this._currentPreloadInst.cnt++,this._currentPreloadInst.cnt>2&&(this._currentPreloadInst.destroy(),this._currentPreloadInst=null)))}},{key:"addDashPreloader",value:function(t){t&&t.data&&(this._preloadDataList.push(t),this.sort(this._preloadDataList),this.autoPreload&&this.emit(u.CN),this._autoCheck.enable&&!this._taskIntervalId&&this.startCheckTask())}},{key:"_addDashPreloader",value:function(t){t&&t.data&&this._preloadDataList.push(t)}},{key:"addDashPreloaderList",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.sort(t);for(var e=0;e<t.length;e++)this._addDashPreloader(t[e]);this._autoCheck.enable&&!this._taskIntervalId&&this.startCheckTask()}},{key:"sort",value:function(t){t.sort((function(t,e){return void 0===t.order&&void 0===t.order||t.order<e.order?-1:1}))}},{key:"destroy",value:function(){this.off(u.CN,this._onPreloadNext)}},{key:"cancelLoading",value:function(){this._currentPreloadInst&&(this._currentPreloadInst.cancelLoading(),this._currentPreloadInst=null),this._preloadDataList=[]}},{key:"preloadCacheProgress",value:function(t){var e=t.vid,r=t.format,n=t.mediaType,i=t.prelaodType,o=t.bitrate,a=t.set_duration,s=t.set_size,l=t.media_type,c=t.start_time,h=this.getProgressCacheKey(e,r,n),f=this._preloadCacheProgress[h];if(f){for(var d=Object.values(f),p=0,g=0,v=0,_=0,m=0,y=0;y<d.length;y++){var b=d[y];b.isInitSegment&&(p=b.total,v=b.loaded,_=b.loaded===b.total?u.x7.SUCCESS:u.x7.DOWNLOADING),g+=b.total,m+=b.loaded}return{media_type:l,preload_type:i,stream_bitrate:o,header_size:p,content_total_size:g,start_time:c||-1,state_info:{set_duration:a,set_size:s,current_header_download_size:v,current_content_download_size:m,header_download_state:_,content_download_state:m===g?u.x7.SUCCESS:u.x7.DOWNLOADING}}}return null}},{key:"getPreloadTaskInfos",value:function(){}},{key:"getItem",value:function(t,e){return this._cacheInst.getItem(t,e)}},{key:"setItem",value:function(t,e,r){return this._cacheInst.setItem(t,e,r)}},{key:"removeItem",value:function(t,e){return this.removeItem(t,e)}}],[{key:"getInstance",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=t.GLOBAL_KEY+(e.globalKey?e.globalKey:""),o=window[i];if(o&&o._ptag_)return o.update(e,r,n),o;var a=new t(e,r,n);return window[i]=a,a}}]),t}();D.GLOBAL_KEY="__preloadcontext__";var E=function(){function t(e){(0,n.PA)(this,t),o()(this),this.options=e,this.promisePolyfill(),this.before(),this.check(),this._preloadManager=D.getInstance(e,this.handlers,this.predictInst),this.loadingTasks=[]}return(0,n.qH)(t,[{key:"promisePolyfill",value:function(){Promise.prototype.finally||(Promise.prototype.finally={finally:function(t){var e=function(e){return Promise.resolve(t()).then(e)};return this.then((function(t){return e((function(){return t}))}),(function(t){return e((function(){return Promise.reject(t)}))}))}}.finally)}},{key:"before",value:function(){throw new Error("need")}},{key:"check",value:function(){if(!this.handlers)throw new Error("handlers null");if(!this.handlers.start||!this.handlers.onRequest)throw new Error("handlers callback null");if(!this.predictInst)throw new Error("predictInst null");if(!this.predictInst.__p__)throw new Error("predictInst need extends predictbase")}},{key:"preloadNext",value:function(){this._preloadManager.emit(u.CN)}},{key:"preloadManager",get:function(){return this._preloadManager}},{key:"start",value:function(t){throw new Error("start need implment, return Promise")}},{key:"cancelLoading",value:function(){for(var t=0;t<this.loadingTasks.length;t++)try{var e=this.loadingTasks[t];"function"==typeof e.cancel&&e.cancel()}catch(r){}this.loadingTasks=[],this._preloadManager.cancelLoading()}},{key:"addTasker",value:function(t){this.loadingTasks.push(t)}},{key:"removeTasker",value:function(t){var e=this;setTimeout((function(){for(var r=e.loadingTasks.length-1;r>-1;r--)if(e.loadingTasks[r]===t){e.loadingTasks.splice(r,1);break}}))}},{key:"addDashPreloader",value:function(t){this._preloadManager.addDashPreloader(t)}},{key:"addDashPreloaderList",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this._preloadManager.addDashPreloaderList(t)}}]),t}()},48164:function(t,e,r){"use strict";function n(){n=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,i=Object.defineProperty||function(t,e,r){t[e]=r.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(P){u=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var o=e&&e.prototype instanceof d?e:d,a=Object.create(o.prototype),s=new S(n||[]);return i(a,"_invoke",{value:k(t,r,s)}),a}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(P){return{type:"throw",arg:P}}}t.wrap=c;var f={};function d(){}function p(){}function g(){}var v={};u(v,a,(function(){return this}));var _=Object.getPrototypeOf,m=_&&_(_(T([])));m&&m!==e&&r.call(m,a)&&(v=m);var y=g.prototype=d.prototype=Object.create(v);function b(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){function n(i,o,a,s){var l=h(t[i],t,o);if("throw"!==l.type){var u=l.arg,c=u.value;return c&&"object"==typeof c&&r.call(c,"__await")?e.resolve(c.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(c).then((function(t){u.value=t,a(u)}),(function(t){return n("throw",t,a,s)}))}s(l.arg)}var o;i(this,"_invoke",{value:function(t,r){function i(){return new e((function(e,i){n(t,r,e,i)}))}return o=o?o.then(i,i):i()}})}function k(t,e,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return{value:void 0,done:!0}}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=I(a,r);if(s){if(s===f)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var l=h(t,e,r);if("normal"===l.type){if(n=r.done?"completed":"suspendedYield",l.arg===f)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(n="completed",r.method="throw",r.arg=l.arg)}}}function I(t,e){var r=e.method,n=t.iterator[r];if(void 0===n)return e.delegate=null,"throw"===r&&t.iterator.return&&(e.method="return",e.arg=void 0,I(t,e),"throw"===e.method)||"return"!==r&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+r+"' method")),f;var i=h(n,t.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,f;var o=i.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function C(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function x(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(C,this),this.reset(!0)}function T(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:A}}function A(){return{value:void 0,done:!0}}return p.prototype=g,i(y,"constructor",{value:g,configurable:!0}),i(g,"constructor",{value:p,configurable:!0}),p.displayName=u(g,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,u(t,l,"GeneratorFunction")),t.prototype=Object.create(y),t},t.awrap=function(t){return{__await:t}},b(w.prototype),u(w.prototype,s,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new w(c(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},b(y),u(y,l,"Generator"),u(y,a,(function(){return this})),u(y,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},t.values=T,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=r.call(o,"catchLoc"),l=r.call(o,"finallyLoc");if(s&&l){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),x(r),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;x(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:T(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),f}},t}function i(t,e,r,n,i,o,a){try{var s=t[o](a),l=s.value}catch(u){return void r(u)}s.done?e(l):Promise.resolve(l).then(n,i)}function o(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function s(t){i(a,n,o,s,l,"next",t)}function l(t){i(a,n,o,s,l,"throw",t)}s(void 0)}))}}function a(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,l(n.key),n)}}function s(t,e,r){return(e=l(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function l(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}r.d(e,{e:function(){return d}});r(20493),r(27780),r(16279),r(23594),r(43246),r(77734),r(57119),r(19604),r(28995),r(70803),r(6921),r(50415),r(43528),r(42639),r(66769),r(23442),r(34916),r(74989),r(67519),r(25134),r(1348),r(70440);var u=r(7186),c=r(99800),h=r(26215),f=new Map,d=function(){function t(e){var r=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.options=t.getDefaultConfig(),Object.keys(e).map((function(t){void 0!==e[t]&&null!==e[t]&&(r.options[t]=e[t])})),!this.options.productConfig||this.options.productConfig.app_id,this.loader=new u.mf(this.options),this.resetTrackeArgs(),this._lastFileInfo=null,this.lastfetchNodeTime=-1,this._lastRetFileKey=null,this._minUpdateNodeStep=this.options.ErrorTimeStep}var e,r,i,s,l;return e=t,r=[{key:"resetTrackeArgs",value:function(t){this.trackeArgs={fid:null,trace_id:null,req_times:(null==t?void 0:t.req_times)||0,resp_times:(null==t?void 0:t.resp_times)||0,token:null,node_num:this.options.node_num,client_info:this.options.client_info}}},{key:"getPCDNNode",value:function(t,e){var r,n=g(e),i=f.get(p(t,n)),o=new c.Q;return null==i||!i.nodes||(null==i||null===(r=i.nodes)||void 0===r?void 0:r.length)<1?this.fetchPCDNNode().then((function(t){!t&&(t=i),o.resolve(t)})).catch((function(t){o.reject(t)})):o.resolve(i),o}},{key:"removePCDNNode",value:function(t,e,r){var n=g(e),i=f.get(p(t,n)),o=null==i?void 0:i.nodes;o&&(r?i.nodes=o.filter((function(t){return t&&r.indexOf(t.url)<0})):o.shift(),f.set(p(t,n),i)),o&&o.length||this.fetchPCDNNode().then().catch((function(t){}))}},{key:"fetchPCDNNode",value:(l=o(n().mark((function e(r,i){var o,a,s,l,h,d,v,_,m,y,b,w;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.loader||(this.loader=new u.mf(this.options)),i?(i.byterate=g(i.bitrate),delete i.bitrate,this._lastFileInfo=i):i=this._lastFileInfo,i){e.next=4;break}return e.abrupt("return");case 4:if(o=!1,a=p(i.vid,i.byterate),this._lastRetFileKey!==a&&(this.resetTrackeArgs(),o=!0),!(Date.now()-this.lastfetchNodeTime<this._minUpdateNodeStep)||o){e.next=9;break}return e.abrupt("return");case 9:if(s=new c.Q,this.lastfetchNodeTime=Date.now(),this._lastRetFileKey=a,i.sfid?i.version=1:i.vid&&(i.version=2),this.options.withReferer&&(i.with_referer=this.options.withReferer),l=Object.assign(this.options.productConfig,{file_info:i},this.trackeArgs),h=JSON.stringify(l),!(this.trackeArgs.req_times>=this.options.maxCnt)){e.next=18;break}return e.abrupt("return");case 18:return this.trackeArgs.req_times+=1,e.prev=19,t.pcdn_tracker_request_cnt++,e.next=23,this.loader.load(r||this.options.trackerUrl,{body:h});case 23:d=e.sent,v=null,d&&(this.trackeArgs.resp_times+=1,m=8*i.byterate,d.done&&null!==(_=d.data)&&void 0!==_&&_.Result?(y=d.data.Result,(v=y.nodes)&&v.length>0?t.pcdn_tracker_success_cnt++:this._minUpdateNodeStep=this.options.NULLNodeTimeStep,v.map((function(t){t.vid=i.vid,t.bitrate=m})),b={nodes:v,fid:y.fid,vid:i.vid,trace_id:y.trace_id,bitrate:m},w=p(i.vid,i.byterate),f.set(w,b),this.trackeArgs.fid=y.fid,this.trackeArgs.trace_id=y.trace_id,this.trackeArgs.token=y.token,s.resolve(b)):(this._minUpdateNodeStep=this.options.ErrorTimeStep,s.reject(d))),e.next=33;break;case 28:e.prev=28,e.t0=e.catch(19),this._minUpdateNodeStep=this.options.ErrorTimeStep,s.reject(e.t0);case 33:return e.abrupt("return",s);case 34:case"end":return e.stop()}}),e,this,[[19,28]])}))),function(t,e){return l.apply(this,arguments)})}],i=[{key:"pluginName",get:function(){return"PCDN"}},{key:"pcdnReqCnt",get:function(){var e=t.pcdn_tracker_request_cnt,r=t.pcdn_tracker_success_cnt;return t.pcdn_tracker_request_cnt=0,t.pcdn_tracker_success_cnt=0,{pcdn_tracker_request_cnt:e,pcdn_tracker_failed_cnt:e-r}}},{key:"getDefaultConfig",value:function(){return{trackerUrl:"",loaderType:h.t.FETCH,responseType:h.U.JSON,mode:"cors",method:"POST",retry:0,retryDelay:3e3,timeout:5e3,node_num:5,client_info:null,maxCnt:30,withReferer:0,NULLNodeTimeStep:6e4,ErrorTimeStep:15e3}}},{key:"gainPCDNNode",value:(s=o(n().mark((function e(r,i,o,a){var s,l,h,f,d,p,v,_,m;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.getDefaultConfig(),Object.keys(i).map((function(t){void 0!==i[t]&&null!==i[t]&&(s[t]=i[t])})),!a||a.app_id,l=new c.Q,o?(o.byterate=g(o.bitrate),delete o.bitrate):l.reject("video fileInfo need set"),h=Object.assign(a,{file_info:o},{node_num:(null==i?void 0:i.node_num)||3}),f=JSON.stringify(h),d=new u.mf(s),e.prev=8,t.pcdn_tracker_request_cnt++,e.next=12,d.load(r,{body:f});case 12:(m=e.sent).done&&(null===(p=m.data)||void 0===p||null===(v=p.Result)||void 0===v||null===(_=v.nodes)||void 0===_?void 0:_.length)>0&&t.pcdn_tracker_success_cnt++,l.resolve(m),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(8),l.reject((null===e.t0||void 0===e.t0?void 0:e.t0.message)||"get pcdnNode error");case 20:return e.abrupt("return",l);case 21:case"end":return e.stop()}}),e,null,[[8,17]])}))),function(t,e,r,n){return s.apply(this,arguments)})}],r&&a(e.prototype,r),i&&a(e,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();function p(t,e){return t+"-"+e}function g(t){return Math.floor(t/8)}s(d,"pcdn_tracker_request_cnt",0),s(d,"pcdn_tracker_success_cnt",0)},94367:function(t,e,r){"use strict";function n(){n=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,i=Object.defineProperty||function(t,e,r){t[e]=r.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(P){u=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var o=e&&e.prototype instanceof d?e:d,a=Object.create(o.prototype),s=new S(n||[]);return i(a,"_invoke",{value:k(t,r,s)}),a}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(P){return{type:"throw",arg:P}}}t.wrap=c;var f={};function d(){}function p(){}function g(){}var v={};u(v,a,(function(){return this}));var _=Object.getPrototypeOf,m=_&&_(_(T([])));m&&m!==e&&r.call(m,a)&&(v=m);var y=g.prototype=d.prototype=Object.create(v);function b(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){function n(i,o,a,s){var l=h(t[i],t,o);if("throw"!==l.type){var u=l.arg,c=u.value;return c&&"object"==typeof c&&r.call(c,"__await")?e.resolve(c.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(c).then((function(t){u.value=t,a(u)}),(function(t){return n("throw",t,a,s)}))}s(l.arg)}var o;i(this,"_invoke",{value:function(t,r){function i(){return new e((function(e,i){n(t,r,e,i)}))}return o=o?o.then(i,i):i()}})}function k(t,e,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return{value:void 0,done:!0}}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=I(a,r);if(s){if(s===f)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var l=h(t,e,r);if("normal"===l.type){if(n=r.done?"completed":"suspendedYield",l.arg===f)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(n="completed",r.method="throw",r.arg=l.arg)}}}function I(t,e){var r=e.method,n=t.iterator[r];if(void 0===n)return e.delegate=null,"throw"===r&&t.iterator.return&&(e.method="return",e.arg=void 0,I(t,e),"throw"===e.method)||"return"!==r&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+r+"' method")),f;var i=h(n,t.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,f;var o=i.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function C(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function x(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(C,this),this.reset(!0)}function T(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:A}}function A(){return{value:void 0,done:!0}}return p.prototype=g,i(y,"constructor",{value:g,configurable:!0}),i(g,"constructor",{value:p,configurable:!0}),p.displayName=u(g,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,u(t,l,"GeneratorFunction")),t.prototype=Object.create(y),t},t.awrap=function(t){return{__await:t}},b(w.prototype),u(w.prototype,s,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new w(c(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},b(y),u(y,l,"Generator"),u(y,a,(function(){return this})),u(y,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},t.values=T,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=r.call(o,"catchLoc"),l=r.call(o,"finallyLoc");if(s&&l){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),x(r),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;x(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:T(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),f}},t}function i(t,e,r,n,i,o,a){try{var s=t[o](a),l=s.value}catch(u){return void r(u)}s.done?e(l):Promise.resolve(l).then(n,i)}function o(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function s(t){i(a,n,o,s,l,"next",t)}function l(t){i(a,n,o,s,l,"throw",t)}s(void 0)}))}}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,c(n.key),n)}}function l(t,e,r){return e&&s(t.prototype,e),r&&s(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function u(t,e,r){return(e=c(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function c(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}r.d(e,{x:function(){return o},PA:function(){return a},qH:function(){return l},_x:function(){return u},l5:function(){return n}})},4059:function(t,e,r){"use strict";r.d(e,{Q:function(){return i}});var n=r(94367),i=(r(67519),r(25134),function(){function t(e,r,i,o){var a=this;(0,n.PA)(this,t),this.config=t.getDefaultConfig(),Object.keys(o).map((function(t){void 0!==o[t]&&null!==o[t]&&(a.config[t]=o[t])})),this.duration=i,this.player=e,this.updateBitrate(r)}return(0,n.qH)(t,[{key:"updateBitrate",value:function(t){this.bitrate=t,this.bitrate||(this.bitrate=this.config.minBandwidth)}},{key:"getAdaptLoadDuration",value:function(){var t=this.player,e=this.config;if(!e.rangeControl)return-1;var r=(null==t?void 0:t.bufferedPoint)||null,n=r&&r.end?r.end-t.currentTime:0;return Math.max(e.rangeMaxDuration-n,e.rangeMinDuration)}},{key:"getAdaptCacheBuffer",value:function(){var t=this.player,e=this.config,r=this.bitrate;if(!e.targetCacheControl)return-1;var n=e.estPlayTime,i=n;e.estPTcontrol&&(i=Math.min(n,this.duration-((null==t?void 0:t.currentTime)||0)));var o=1024*(null==t?void 0:t.avgSpeed)||0,a=Math.max(e.safeFactor*o,e.minBandwidth);t&&t.avgSpeed&&(a=e.safeFactor*o);var s=r>0?Math.floor((1-a/r)*i):0;return s=e.minDangerThreshold+Math.max(s,0),Math.min(Math.max(e.cacheSafeFactor*s,e.minTargetCacheDur),e.maxTargetCacheDur)}}],[{key:"getDefaultConfig",value:function(){return{rangeMaxDuration:15,rangeMinDuration:5,rangeMinSize:409600,safeFactor:.1,cacheSafeFactor:3,minDangerThreshold:5,estPlayTime:12,minBandwidth:1e6,estPTcontrol:!1,minTargetCacheDur:30,maxTargetCacheDur:60,targetCacheControl:!1,rangeControl:!1}}}]),t}())},29554:function(t,e,r){"use strict";r.d(e,{F:function(){return i}});var n=r(94367),i=(r(67519),r(25134),function(){function t(e,r,i,o){var a=this;(0,n.PA)(this,t),this.config=t.getDefaultConfig(),Object.keys(o).map((function(t){void 0!==o[t]&&null!==o[t]&&(a.config[t]=o[t])})),this.duration=i,this.player=e,this.updateBitrate(r)}return(0,n.qH)(t,[{key:"updateBitrate",value:function(t){this.bitrate=t,this.bitrate||(this.bitrate=this.config.minBandwidth)}},{key:"getBuffer",value:function(){var t=this.player,e=(null==t?void 0:t.bufferedPoint)||null;return e&&e.end?e.end-t.currentTime:0}},{key:"getAdaptLoadDuration",value:function(){var t=this.config,e=this.duration;if(!t.rangeControl)return-1;var r=this.getBuffer(),n=e-r,i=Math.min(n,t.rangeMaxDuration-r);return Math.max(i,t.rangeMinDuration)}},{key:"getAdaptRangeSize",value:function(t){var e=this.config,r=this.bitrate,n=this.duration;if(!e.rangeControl)return-1;t||(t=this.getAdaptLoadDuration());var i=n-this.getBuffer(),o=Math.max(e.rangeMinSize,t*r/8),a=i*r/8;return o+e.rangeFloatSize>=a&&(o=a),Math.ceil(o)}},{key:"getAdaptCacheBuffer",value:function(){var t=this.player,e=this.config,r=this.bitrate;if(!e.targetCacheControl)return-1;var n=e.estPlayTime,i=n;e.estPTcontrol&&(i=Math.min(n,this.duration-((null==t?void 0:t.currentTime)||0)));var o=1024*(null==t?void 0:t.avgSpeed)||0,a=Math.max(e.safeFactor*o,e.minBandwidth);t&&t.avgSpeed&&(a=e.safeFactor*o);var s=r>0?Math.floor((1-a/r)*i):0;s=e.minDangerThreshold+Math.max(s,0);var l=Math.max(e.cacheSafeFactor*s,e.minTargetCacheDur);return Math.min(l,e.maxTargetCacheDur)}}],[{key:"getDefaultConfig",value:function(){return{rangeControl:!1,rangeMaxDuration:20,rangeMinDuration:5,rangeMinSize:409600,rangeFloatSize:10240,safeFactor:.1,cacheSafeFactor:3,minDangerThreshold:5,estPlayTime:12,minBandwidth:1e6,estPTcontrol:!1,minTargetCacheDur:30,maxTargetCacheDur:60,targetCacheControl:!1}}}]),t}())},38877:function(t,e,r){"use strict";r.d(e,{e:function(){return u}});var n=r(94367),i=(r(20493),r(27780),r(16279),r(23594),r(43246),r(77734),r(57119),r(19604),r(28995),r(70803),r(6921),r(50415),r(43528),r(42639),r(66769),r(23442),r(34916),r(74989),r(67519),r(25134),r(1348),r(70440),r(36117),r(44549)),o=r(8296),a=r(90429),s=function(){function t(e,r,i,o){var a=this;(0,n.PA)(this,t),this.config=t.getDefaultConfig(),Object.keys(o).map((function(t){void 0!==o[t]&&null!==o[t]&&(a.config[t]=o[t])})),this.duration=i,this.player=e,this.updateBitrate(r),this.curPCDNInBuffer=this.config.maxPCDNInBuffer,this.curPCDNOutBuffer=this.config.maxPCDNOutBuffer,this.PCDNChangeCnt=0}return(0,n.qH)(t,[{key:"updateBitrate",value:function(t){this.bitrate=t,this.bitrate||(this.bitrate=this.config.minBandwidth)}},{key:"getPCDNInBuffer",value:function(){var t=this.config,e=this.player,r=this.bitrate;if(!t.PCDNBufferControl)return null;var n=t.estPlayTime,i=n;t.estPTcontrol&&(i=Math.min(n,Math.max(0,this.duration-((null==e?void 0:e.currentTime)||0))));var o=t.safePCDNInFactor,a=t.minBandwidth,s=t.maxPCDNInBuffer,l=t.minPCDNInBuffer,u=o*Math.max(1024*(null==e?void 0:e.avgSpeedPCDN)||0,a),c=r>0?(1-u/r)*i:0;return this.curPCDNInBuffer=Math.min(s,Math.max(l,c)),this.curPCDNInBuffer}},{key:"getPCDNOutBuffer",value:function(){var t=this.config,e=this.player,r=this.bitrate;if(!t.PCDNBufferControl)return null;var n=t.estPlayTime,i=n;t.estPTcontrol&&(i=Math.min(n,Math.max(0,this.duration-((null==e?void 0:e.currentTime)||0))));var o=t.safePCDNOutFactor,a=t.minBandwidth,s=t.maxPCDNOutBuffer,l=t.minPCDNOutBuffer,u=o*Math.max(1024*(null==e?void 0:e.avgSpeedPCDN)||0,a),c=r>0?(1-u/r)*i:0;return this.curPCDNOutBuffer=Math.min(s,Math.max(l,c)),this.curPCDNOutBuffer}},{key:"getPCDNChangeCnt",value:function(){var t=this.config,e=t.PCDNCntControl,r=t.alpha,n=this.curPCDNInBuffer,i=this.player,o=(null==i?void 0:i.bufferedPoint)||null,a=o&&o.end?o.end-i.currentTime:0;e?a>n+(this.PCDNChangeCnt-1)*r&&this.PCDNChangeCnt++:a>=n&&this.PCDNChangeCnt<2&&this.PCDNChangeCnt++;return this.PCDNChangeCnt}}],[{key:"getDefaultConfig",value:function(){return{PCDNBufferControl:!1,PCDNCntControl:!1,estPTcontrol:!1,minPCDNInBuffer:8,maxPCDNInBuffer:12,minPCDNOutBuffer:3,maxPCDNOutBuffer:6,safePCDNInFactor:.1,safePCDNOutFactor:.4,alpha:.5,estPlayTime:12,minBandwidth:1e6}}}]),t}(),l=new Map,u=function(){function t(e,r,o,a){var l,u,c=this;(0,n.PA)(this,t),this.options=t.getDefaultConfig(),Object.keys(e).map((function(t){void 0!==e[t]&&null!==e[t]&&(c.options[t]=e[t])})),!this.options.productConfig||this.options.productConfig.app_id,this.loader=new i.mf(this.options),this.resetTrackeArgs(),this._lastFileInfo=null,this.lastfetchNodeTime=-1,this._lastRetFileKey=null,this._minUpdateNodeStep=this.options.ErrorTimeStep,null!==(l=this.options)&&void 0!==l&&null!==(u=l.adaptPCDNConfig)&&void 0!==u&&u.PCDNBufferControl&&(this.pcdnAdapt=new s(r,o,a,this.options.adaptPCDNConfig))}var e,r;return(0,n.qH)(t,[{key:"isOpenAdaptPCDN",get:function(){return!!this.pcdnAdapt}},{key:"curPCDNInBuffer",get:function(){return this.pcdnAdapt.curPCDNInBuffer}},{key:"getPCDNInBuffer",value:function(){var t;return null===(t=this.pcdnAdapt)||void 0===t?void 0:t.getPCDNInBuffer()}},{key:"curPCDNOutBuffer",get:function(){return this.pcdnAdapt.curPCDNOutBuffer}},{key:"getPCDNOutBuffer",value:function(){var t;return null===(t=this.pcdnAdapt)||void 0===t?void 0:t.getPCDNOutBuffer()}},{key:"curPCDNChangeCnt",get:function(){return this.pcdnAdapt.PCDNChangeCnt}},{key:"getPCDNChangeCnt",value:function(){var t;return null===(t=this.pcdnAdapt)||void 0===t?void 0:t.getPCDNChangeCnt()}},{key:"resetTrackeArgs",value:function(t){this.trackeArgs={fid:null,trace_id:null,req_times:(null==t?void 0:t.req_times)||0,resp_times:(null==t?void 0:t.resp_times)||0,token:null,node_num:this.options.node_num,client_info:this.options.client_info}}},{key:"getPCDNNode",value:function(t,e,r){var n,i=h(e),a=l.get(c(t,i)),s=new o.Q;return null==a||!a.nodes||(null==a||null===(n=a.nodes)||void 0===n?void 0:n.length)<1?this.fetchPCDNNode(null,null,r).then((function(t){s.resolve(t)})).catch((function(t){s.reject(t)})):(a.fromCache=!0,s.resolve(a)),s}},{key:"removePCDNNode",value:function(t,e,r){var n=h(e),i=l.get(c(t,n)),o=null==i?void 0:i.nodes;o&&(r?i.nodes=o.filter((function(t){return t&&r.indexOf(t.url)<0})):o.shift(),l.set(c(t,n),i)),o&&o.length||this.fetchPCDNNode().then().catch((function(){}))}},{key:"fetchPCDNNode",value:(r=(0,n.x)((0,n.l5)().mark((function e(r,a,s){var u,f,d,p,g,v,_,m,y,b,w,k,I,C,x,S,T;return(0,n.l5)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u=new o.Q,a){e.next=5;break}a=this._lastFileInfo,e.next=13;break;case 5:if(a.byterate=h(a.bitrate),!((null==(d=l.get(c(a.vid,a.byterate)))||null===(f=d.nodes)||void 0===f?void 0:f.length)>0)){e.next=11;break}return d.fromCache=!0,u.resolve(d),e.abrupt("return",u);case 11:delete a.bitrate,this._lastFileInfo=a;case 13:if(a){e.next=16;break}return u.resolve(null),e.abrupt("return",u);case 16:if(p=!1,g=c(a.vid,a.byterate),this._lastRetFileKey!==g&&(this.resetTrackeArgs(),p=!0),!(Date.now()-this.lastfetchNodeTime<this._minUpdateNodeStep)||p){e.next=22;break}return u.resolve(null),e.abrupt("return",u);case 22:if(this.lastfetchNodeTime=Date.now(),this._lastRetFileKey=g,a.sfid?a.version=1:a.vid&&(a.version=2),this.options.withReferer&&(a.with_referer=this.options.withReferer),v=Object.assign(this.options.productConfig,{file_info:a},this.trackeArgs,{req_id:s}),_=JSON.stringify(v),!(this.trackeArgs.req_times>=this.options.maxCnt)){e.next=31;break}return u.resolve(null),e.abrupt("return",u);case 31:return this.loader||(this.loader=new i.mf(this.options)),this.trackeArgs.req_times+=1,e.prev=33,t.pcdn_tracker_request_cnt++,e.next=37,this.loader.load(r||this.options.trackerUrl,{body:_});case 37:m=e.sent,y=null,m&&(this.trackeArgs.resp_times+=1,w=8*a.byterate,m.done&&null!==(b=m.data)&&void 0!==b&&b.Result?(k=m.data.Result,(y=k.nodes)&&y.length>0?t.pcdn_tracker_success_cnt++:this._minUpdateNodeStep=this.options.NULLNodeTimeStep,y.map((function(t){t.vid=a.vid,t.bitrate=w})),I=k.fid,C=k.trace_id,x=k.req_id,S={nodes:y,fid:I,vid:a.vid,trace_id:C,req_id:x,bitrate:w},T=c(a.vid,a.byterate),l.set(T,S),this.trackeArgs.fid=k.fid,this.trackeArgs.trace_id=k.trace_id,this.trackeArgs.token=k.token,u.resolve(S)):(this._minUpdateNodeStep=this.options.ErrorTimeStep,u.reject(m))),e.next=47;break;case 42:e.prev=42,e.t0=e.catch(33),this._minUpdateNodeStep=this.options.ErrorTimeStep,u.reject(e.t0);case 47:return e.abrupt("return",u);case 48:case"end":return e.stop()}}),e,this,[[33,42]])}))),function(t,e,n){return r.apply(this,arguments)})}],[{key:"pluginName",get:function(){return"PCDN"}},{key:"pcdnReqCnt",get:function(){var e=t.pcdn_tracker_request_cnt,r=t.pcdn_tracker_success_cnt;return t.pcdn_tracker_request_cnt=0,t.pcdn_tracker_success_cnt=0,{pcdn_tracker_request_cnt:e,pcdn_tracker_failed_cnt:e-r}}},{key:"getDefaultConfig",value:function(){return{trackerUrl:"",loaderType:a.t.FETCH,responseType:a.U.JSON,mode:"cors",method:"POST",retry:0,retryDelay:3e3,timeout:5e3,node_num:5,client_info:null,maxCnt:30,withReferer:0,NULLNodeTimeStep:6e4,ErrorTimeStep:15e3}}},{key:"gainPCDNNode",value:(e=(0,n.x)((0,n.l5)().mark((function e(r,a,s,l){var u,c,f,d,p,g,v,_,m;return(0,n.l5)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=t.getDefaultConfig(),Object.keys(a).map((function(t){void 0!==a[t]&&null!==a[t]&&(u[t]=a[t])})),!l||l.app_id,c=new o.Q,s?(s.byterate=h(s.bitrate),delete s.bitrate):c.reject("video fileInfo need set"),f=Object.assign(l,{file_info:s},{node_num:(null==a?void 0:a.node_num)||3}),d=JSON.stringify(f),p=new i.mf(u),e.prev=8,t.pcdn_tracker_request_cnt++,e.next=12,p.load(r,{body:d});case 12:(m=e.sent).done&&(null===(g=m.data)||void 0===g||null===(v=g.Result)||void 0===v||null===(_=v.nodes)||void 0===_?void 0:_.length)>0&&t.pcdn_tracker_success_cnt++,c.resolve(m),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(8),c.reject((null===e.t0||void 0===e.t0?void 0:e.t0.message)||"get pcdnNode error");case 20:return e.abrupt("return",c);case 21:case"end":return e.stop()}}),e,null,[[8,17]])}))),function(t,r,n,i){return e.apply(this,arguments)})}]),t}();function c(t,e){return"".concat(t,"-").concat(e)}function h(t){return Math.floor(t/8)}(0,n._x)(u,"pcdn_tracker_request_cnt",0),(0,n._x)(u,"pcdn_tracker_success_cnt",0)},82009:function(t,e,r){"use strict";r.d(e,{Z:function(){return n}});r(98921);function n(t,e,r){var n;return function(){var i=this,o=arguments,a=r&&!n;clearTimeout(n),n=setTimeout((function(){n=null,r||t.apply(i,o)}),e),a&&t.apply(i,o)}}},77717:function(t,e,r){"use strict";r.d(e,{Z:function(){return a}});var n=r(71940),i=r(13266),o=(r(27045),r(76673),r(2435),r(98921),function(){function t(){(0,n.Z)(this,t)}return(0,i.Z)(t,null,[{key:"install",value:function(){if(window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame,window.cancelAnimationFrame=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.cancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame,!window.requestAnimationFrame){var t=Date.now();window.requestAnimationFrame=function(e){var r=Date.now(),n=Math.max(16.7-(r-t),0),i=setTimeout(e,n);return t=r+n,i}}window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}}]),t}()),a=function(){function t(){(0,n.Z)(this,t),this.fps=0,this.isStoped=!0,this.ticks=[],this.isSupport=!0,this.maxFps=0,this.step=this._step.bind(this),this.rafId=null}return(0,i.Z)(t,[{key:"_step",value:function(t){var e=this.ticks;if(e.unshift(t),e.length>10){var r=e.pop();r&&(this.fps=Math.floor(1e4/(t-r)),this.updateFpsInfo())}this.isStoped||(this.rafId=window.requestAnimationFrame(this.step))}},{key:"updateFpsInfo",value:function(){this.fps>this.maxFps&&(this.maxFps=this.fps)}},{key:"start",value:function(){window.requestAnimationFrame!==undefined&&(this.isStoped=!1,this.rafId=window.requestAnimationFrame(this.step))}},{key:"stop",value:function(){window.cancelAnimationFrame(this.rafId),this.isStoped=!0}}],[{key:"install",value:function(){o.install()}}]),t}()},18409:function(t,e,r){"use strict";r.d(e,{Z:function(){return o}});var n=r(71940),i=r(13266),o=(r(98921),function(){function t(){(0,n.Z)(this,t),this.timeID=null,this.func=null}return(0,i.Z)(t,[{key:"repeat",value:function(t,e){this.timeID=1,this.repeatInterval(t,e)}},{key:"repeatInterval",value:function(t,e){var r=this;this.timeID&&(null===this.func&&(this.func=t),this.func===t&&(this.timeID&&clearTimeout(this.timeID),this.timeID=null,this.timeID=setTimeout((function(){t(),r.repeatInterval(t,e)}),e)))}},{key:"clear",value:function(){clearTimeout(this.timeID),this.timeID=null}}]),t}())},74976:function(t,e,r){"use strict";r.d(e,{Z:function(){return o}});r(90856);var n=i&&!function(){var t="_localstorage_support_test";try{return localStorage.setItem(t,!0),localStorage.removeItem(t),!1}catch(e){return!0}}();function i(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(t){return!1}}var o={length:n?localStorage.length:0,clear:function(t){try{for(var e=localStorage.length-1;e>=0;e--){var r=localStorage.key(e);0===r.indexOf(t)&&localStorage.removeItem(r)}}catch(n){}},getItem:function(t){try{return localStorage.getItem(t)}catch(e){return null}},key:function(t){try{return localStorage.key(t)}catch(e){return null}},setItem:function(t,e){try{localStorage.setItem(t,e)}catch(r){}},removeItem:function(t){try{localStorage.removeItem(t)}catch(e){}},isSupport:n}},58484:function(t,e,r){"use strict";r.d(e,{Z:function(){return o}});var n=r(71940),i=r(13266),o=(r(16279),r(41620),function(){function t(){var e,r;(0,n.Z)(this,t);var i=new Promise((function(t,n){e=t,r=n}));return i.resolve=e,i.reject=r,i}return(0,i.Z)(t,[{key:"resolve",value:function(t){}},{key:"reject",value:function(t){}}]),t}())},7107:function(t,e,r){"use strict";r.d(e,{Z:function(){return o}});var n=r(71940),i=r(13266),o=(r(98538),r(27181),r(53840),function(){function t(){(0,n.Z)(this,t)}return(0,i.Z)(t,null,[{key:"parse",value:function(e){var r=t.parseXmlString(e);return null!==r?t.parseDOMChildren(r):null}},{key:"parseXmlString",value:function(t){if(t===undefined)return null;var e,r=new window.DOMParser;try{(e=r.parseFromString(t,"text/xml")).getElementsByTagNameNS("*","parsererror").length>0&&(e=null)}catch(n){e=null}return e}},{key:"parseDOMChildren",value:function(e,r){if(e.nodeType===Node.DOCUMENT_NODE){for(var n={},i=e.childNodes,o=0;o<i.length;o++){var a=i[o];a.nodeType===Node.ELEMENT_NODE&&(n=t.parseDOMChildren(a))}return n}if(e.nodeType===Node.ELEMENT_NODE){for(var s={__cnt:0},l=[],u=e.childNodes,c=0;c<u.length;c++){var h=u[c],f=t.getNodeLocalName(h);if(h.nodeType!==Node.COMMENT_NODE){var d=r+"."+f;if(s.__cnt++,null==s[f]){var p=t.parseDOMChildren(h,d);if("#text"!==f||/[^\s]/.test(p)){var g={};g[f]=p,l.push(g)}s[f]=p,t.toArrayAccessForm(s,f)}else{null!=s[f]&&(s[f]instanceof Array||(s[f]=[s[f]],t.toArrayAccessForm(s,f,d)));var v=t.parseDOMChildren(h,d);if("#text"!==f||/[^\s]/.test(v)){var _={};_[f]=v,l.push(_)}s[f][s[f].length]=v}}}for(var m=0;m<e.attributes.length;m++){var y=e.attributes[m];s.__cnt++;var b=y.value;s[y.name]=b}var w=e.prefix;return null!=w&&""!==w&&(s.__cnt++,s.__prefix=w),null!=s["#text"]&&(s.__text=s["#text"],s.__text instanceof Array&&(s.__text=s.__text.join("\n")),delete s["#text"],delete s["#text_asArray"]),null!=s["#cdata-section"]&&(s.__cdata=s["#cdata-section"],delete s["#cdata-section"],delete s["#cdata-section_asArray"]),1===s.__cnt&&null!=s.__text?s=s.__text:1===s.__cnt&&null!=s.__cdata&&(s=s.__cdata),delete s.__cnt,s}if(e.nodeType===Node.TEXT_NODE||e.nodeType===Node.CDATA_SECTION_NODE)return e.nodeValue}},{key:"getNodeLocalName",value:function(t){var e=t.localName;return null==e&&(e=t.baseName),null!=e&&""!==e||(e=t.nodeName),e}},{key:"toArrayAccessForm",value:function(t,e){t[e]instanceof Array||(t[e]=[t[e]])}}]),t}())},4488:function(t){var e={utf8:{stringToBytes:function(t){return e.bin.stringToBytes(unescape(encodeURIComponent(t)))},bytesToString:function(t){return decodeURIComponent(escape(e.bin.bytesToString(t)))}},bin:{stringToBytes:function(t){for(var e=[],r=0;r<t.length;r++)e.push(255&t.charCodeAt(r));return e},bytesToString:function(t){for(var e=[],r=0;r<t.length;r++)e.push(String.fromCharCode(t[r]));return e.join("")}}};t.exports=e},79705:function(t,e){var r;!function(){"use strict";var n={}.hasOwnProperty;function i(){for(var t=[],e=0;e<arguments.length;e++){var r=arguments[e];if(r){var o=typeof r;if("string"===o||"number"===o)t.push(r);else if(Array.isArray(r)){if(r.length){var a=i.apply(null,r);a&&t.push(a)}}else if("object"===o)if(r.toString===Object.prototype.toString)for(var s in r)n.call(r,s)&&r[s]&&t.push(s);else t.push(r.toString())}}return t.join(" ")}t.exports?(i.default=i,t.exports=i):(r=function(){return i}.apply(e,[]))===undefined||(t.exports=r)}()},57284:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){for(var e=0,r=arguments.length,n=Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];var o=!0,a=!1,s=undefined;try{for(var l,u=n[Symbol.iterator]();!(o=(l=u.next()).done);o=!0){e+=l.value.length}}catch(m){a=!0,s=m}finally{try{!o&&u.return&&u.return()}finally{if(a)throw s}}var c=new t(e),h=0,f=!0,d=!1,p=undefined;try{for(var g,v=n[Symbol.iterator]();!(f=(g=v.next()).done);f=!0){var _=g.value;c.set(_,h),h+=_.length}}catch(m){d=!0,p=m}finally{try{!f&&v.return&&v.return()}finally{if(d)throw p}}return c}},82024:function(t,e,r){"use strict";var n,i=r(57284),o=(n=i)&&n.__esModule?n:{default:n};t.exports=o.default}}]);