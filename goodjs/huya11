(window.HUYA_MAIN_APP_WEBPACK_JSONP=window.HUYA_MAIN_APP_WEBPACK_JSONP||[]).push([[166],{499:function(t,i,e){"use strict";t.exports=e(500)},500:function(t,i,e){"use strict";var n=e(501),o=e(520);function s(t){return t&&"object"==typeof t&&"default"in t?t.default:t}var r,a=s(n),c=s(o);function d(){const t=navigator.userAgent,i="Win32"==navigator.platform||"Windows"==navigator.platform,e="Mac68K"==navigator.platform||"MacPPC"==navigator.platform||"Macintosh"==navigator.platform||"MacIntel"==navigator.platform;if(e)return r.Mac;if("X11"==navigator.platform&&!i&&!e)return r.Unix;if(String(navigator.platform).indexOf("Linux")>-1)return r.Linux;if(i){if(t.indexOf("Windows NT 5.0")>-1||t.indexOf("Windows 2000")>-1)return r.Win2000;if(t.indexOf("Windows NT 5.1")>-1||t.indexOf("Windows XP")>-1)return r.WinXP;if(t.indexOf("Windows NT 5.2")>-1||t.indexOf("Windows 2003")>-1)return r.Win2003;if(t.indexOf("Windows NT 6.0")>-1||t.indexOf("Windows Vista")>-1)return r.WinVista;if(t.indexOf("Windows NT 6.1")>-1||t.indexOf("Windows 7")>-1)return r.Win7;if(t.indexOf("Windows NT 10")>-1||t.indexOf("Windows 10")>-1)return r.Win10}return r.other}!function(t){t.Mac="Mac",t.Unix="Unix",t.Linux="Linux",t.Win2000="Win2000",t.WinXP="WinXP",t.Win2003="Win2003",t.WinVista="WinVista",t.Win7="Win7",t.Win10="Win10",t.other="other"}(r||(r={}));class f{constructor(t){this.list=[],this.len=0,this.push=(...t)=>{this.list.push(...t);const i=this.list.length;i>this.len&&(this.list=this.list.slice(i-this.len))},this.pop=()=>this.list.pop(),this.getListData=()=>this.list,this.len=t}}const p={appVersion:"",anchorId:"0",subsid:"0",appId:"200",isP2p:!1,deviceType:1};class l{constructor(t){this.moduleMap={},this.setFbModule=(t,i=0)=>(this.moduleMap[t]||(this.moduleMap[t]={},this.moduleMap[t][l.limitModule]=new f(i)),this.moduleMap[t]),this.getFbModule=t=>this.moduleMap[t],this.report=async t=>{const i={errorText:t.errorText,content:t.content,appVersion:this.initOpt.appVersion,anchorId:""+this.initOpt.anchorId,subsid:""+this.initOpt.subsid,isP2p:this.initOpt.isP2p,appId:""+this.initOpt.appId,deviceType:this.initOpt.deviceType},e=await function(t){const i=c.get("yyuid")||0,e=c.get("guid")||0,n=new FormData,o={fbType:t.errorText,fbDetails:t.content||t.errorText,uid:i,gid:e,device:d(),appVersion:t.appVersion,deviceType:t.deviceType||1,anchorId:t.anchorId,ssid:t.subsid,appId:t.appId,isp2p:t.isP2p?1:0};for(let[t,i]of Object.entries(o)){if("object"==typeof i)try{i=JSON.stringify(i)}catch(t){console.error("getFbId catch error",t)}n.append(t,""+i)}return a.post("//ffilelogapp.huya.com/addFeedBack",n).then(t=>{const{result:i,fbId:e}=t.data;if(1===i)return console.info("获取fbid成功"),e;console.info("获取fbid失败, result:",i)}).catch(t=>{console.error("获取fbid出错:",t)})}(i);if(e){const t=this.handleInfoData();if(await function(t){const{log:i={},feedbackId:e}=t;let n=0;try{n=function(t){const i=t.length;let e=0;for(let n=0;n<i;n++){const i=t.charCodeAt(n);i>=1&&i<=126||65376<=i&&i<=65439?e++:e+=2}return e}(JSON.stringify(i))}catch(t){console.error("getLog length error:",t)}const o={feedbackId:e,log:i,fileSize:n},s=new FormData;for(let[t,i]of Object.entries(o)){let e="";if("object"==typeof i)try{e=JSON.stringify(i)}catch(t){console.error("getFbId catch error",t)}else e=""+i;s.append(t,""+e)}return a.post("//ffilelogupload.huya.com/uploadStringLog",s).then(({data:t})=>{const{status:i}=t;if(200===i)return console.info("上传日志成功!"),!0;console.info("上传日志失败")}).catch(t=>{console.error("上传日志出错",t)})}({feedbackId:e,log:t}))return Promise.resolve({isSuccess:!0,info:"反馈成功"})}return Promise.reject({isSuccess:!1,info:"反馈失败"})},this.handleInfoData=()=>{const t=Object.keys(this.moduleMap),i={};return t.forEach(t=>{const e=this.moduleMap[t],n=Object.keys(e);i[t]={},n.forEach(e=>{i[t][e]=e===l.limitModule?this.moduleMap[t][e].getListData():this.moduleMap[t][e]})}),i},this.initOpt={...p,...t}}}l.limitModule="$$feedbackLimitModule",t.exports=l}}]);