var SAUpsellTrigger;(function(n){function f(n){var t=new RegExp("^https://(www.|cn.)?(bing.com|staging-bing-int.com)");return!n||!t.test(n)?!1:!0}function y(n){var t=new RegExp("^sapphirebing://");return!n||!t.test(n)?!1:!0}function p(n){var t=new RegExp("^[a-zA-Z0-9]{7,8}_[a-zA-Z0-9]{7,8}$"),i=new RegExp("^[a-zA-Z0-9]{7,8}$");return!n||!(t.test(n)||i.test(n))?!1:!0}function e(n,t,i,r){r===void 0&&(r="default");f(n)||(Log.Log("OpalUpsell_SAUpsellTriggers","InvalidFallbackLink","".concat(r,", ").concat(n)),n=l);y(t)||(Log.Log("OpalUpsell_SAUpsellTriggers","InvalidDeeplink","".concat(r,", ").concat(t)),t=a);p(i)||(Log.Log("OpalUpsell_SAUpsellTriggers","InvalidTracker","".concat(r,", ").concat(i)),i=v);var u="https://k5nc.adj.st/".concat(t.substring(15),"&adj_t=").concat(i,"&adjust_deep_link=").concat(encodeURIComponent(t),"&adj_redirect_ios=").concat(encodeURIComponent(n),"&adj_redirect_android=").concat(encodeURIComponent(n)),e=navigator.userAgent&&navigator.userAgent.toLocaleLowerCase().indexOf("android")!==-1?"android":"ios",o=e==="android"?2e3:500;setTimeout(function(){Log.Log("OpalUpsell_SAUpsellTriggers","JumpAdjust","".concat(r,",").concat(i,",").concat(u));window.location.href=u},0);setTimeout(function(){Log.Log("OpalUpsell_SAUpsellTriggers","JumpFallback","".concat(r,",").concat(i,",").concat(n));window.location.href=n},o)}function o(n,i){var r;return i===void 0&&(i=""),i&&((r=t[n])===null||r===void 0?void 0:r.hasOwnProperty(i))||(i="default"),t[n][i]}function s(n,t,i,r){return"sapphirebing://browser?url=".concat(encodeURIComponent(n),"&network=").concat(encodeURIComponent(t),"&campaign=").concat(encodeURIComponent(i),"&adgroup=").concat(encodeURIComponent(r))}function w(n){return f(location===null||location===void 0?void 0:location.origin)?location.origin+"/search?q="+n:"https://www.bing.com/search?q="+n}function b(){var n=new RegExp(/(sapphire|edge|huawei|edg|outlook|skype)/i),t=n.test(navigator.userAgent);return t?(Log.Log("OpalUpsell_SAUpsellTriggers","checkUserAgent","UserAgent cannot be first party apps"),!1):!0}function k(){var n="numberOfTimesRedirectedToSapphire",i="lastTimeRedirectedToSapphire",r=new Date,u=localStorage.getItem(i),f,e,t;if(u)if(f=new Date(u),e=r.toDateString()===f.toDateString(),e){if(t=parseInt(localStorage.getItem(n)||"0",10),t>=3)return Log.Log("OpalUpsell_SAUpsellTriggers","checkVisitCountValidity","MaxVisitsReached"),!1;localStorage.setItem(n,(t+1).toString())}else localStorage.setItem(n,"1");else localStorage.setItem(n,"1");return localStorage.setItem(i,r.toISOString()),!0}function d(){var n="sapphireRedirectionDisableOnce",i=localStorage.getItem(r),t;return!i||Date.now()-parseInt(i)>3e4?(localStorage.setItem(r,Date.now().toString()),!0):(t=localStorage.getItem(n),t&&t!=="false"?(localStorage.setItem(n,"false"),!0):(Log.Log("OpalUpsell_SAUpsellTriggers","canTriggerSearch","User redirection blocked, user tried to search within 30s cooldown"),localStorage.setItem(n,"true"),!1))}function g(){return k()&&b()&&d()}function nt(n,t,i){n===void 0&&(n="");t===void 0&&(t="");var r=o("query",t),u=i!==null&&i!==void 0?i:w(n),f=s(u,r.networkId,r.campaignId,r.adgroupId);e(u,f,r.tracker,"query")}function tt(n,t){if(n===void 0&&(n=""),t===void 0&&(t=""),!n){Log.Log("OpalUpsell_SAUpsellTriggers","InvalidParameter_Link","search ".concat(n));return}var i=o("search",t),r=n,u=s(r,i.networkId,i.campaignId,i.adgroupId);e(r,u,i.tracker,"search")}function it(n,t,r){var f,e,o,s;t===void 0&&(t="");f=new URL(i);e=new URLSearchParams(n.substring(n.indexOf("?")));e.forEach(function(n,t){f.searchParams.set(t,n)});f.searchParams.set("FORM",u(t));f.searchParams.set("sapattid",t);o=function(){Log.Log("OpalUpsell_SAUpsellTriggers","searchNativelyByApp","fallback callback triggered",!1,"PositionID",t);r?_w.open(n,r):_w.location.href=n};s=function(){return window.addEventListener("focus",o,{once:!0})};window.addEventListener("blur",s,{once:!0});Log.Log("OpalUpsell_SAUpsellTriggers","searchNativelyByApp","mobile native universal link triggered",!1,"PositionID",t);window.location.href=f.toString()}function rt(n,t,r,f){var h,c,e,s,o,l,a;if(t===void 0&&(t=""),e=new URL(i),n&&n.length>0)for(s=0;s<n.length;s++)o=n[s],(((h=o.id)===null||h===void 0?void 0:h.includes("sa"))||((c=o.id)===null||c===void 0?void 0:c.includes("sb_form_q")))&&o.name&&o.value&&e.searchParams.set(o.name,o.value);!e.searchParams.has("q")&&f&&e.searchParams.set("q",f);e.searchParams.set("FORM",u(t));e.searchParams.set("sapattid",t);l=function(){Log.Log("OpalUpsell_SAUpsellTriggers","queryNativelyByApp","fallback callback triggered",!1,"PositionID",t);r()};a=function(){return window.addEventListener("focus",l,{once:!0})};window.addEventListener("blur",a,{once:!0});Log.Log("OpalUpsell_SAUpsellTriggers","queryNativelyByApp","mobile native universal link triggered",!1,"PositionID",t);window.location.href=e.toString()}var t={query:{"default":{networkId:"125czop8_12hga57x",campaignId:"13w3avcz_13ld58ji",adgroupId:"",tracker:"13w3avcz_13ld58ji"},Bing_DirectOpen_HP:{networkId:"125czop8_12hga57x",campaignId:"13g24d1z_13nu7vh1",adgroupId:"139c298d_135xw5ht",tracker:"139c298d_135xw5ht"},Bing_DirectOpen_SERP_T1:{networkId:"125czop8_12hga57x",campaignId:"13g24d1z_13nu7vh1",adgroupId:"13frk971_135dxmp6",tracker:"13frk971_135dxmp6"},Bing_DirectOpen_SERP_T2:{networkId:"125czop8_12hga57x",campaignId:"13g24d1z_13nu7vh1",adgroupId:"13pi2mfj_138mwjjk",tracker:"13pi2mfj_138mwjjk"},Bing_DirectOpen_SERP_T3:{networkId:"125czop8_12hga57x",campaignId:"13g24d1z_13nu7vh1",adgroupId:"138jmzvg_13ty271x",tracker:"138jmzvg_13ty271x"}},search:{"default":{networkId:"125czop8_12hga57x",campaignId:"13w3avcz_13ld58ji",adgroupId:"",tracker:"13w3avcz_13ld58ji"}}},h="MB0039",c="MB0040",l="https://www.bing.com",a="sapphirebing://home",v="13w3avcz_13ld58ji",i="https://m.bing.com/search",r="lastSapphireRedirectionTimestamp",u=function(n){return n.indexOf("HP")>0?h:c};n.shouldRedirectToSapphire=g;n.queryByApp=nt;n.searchByApp=tt;n.searchNativelyByApp=it;n.queryNativelyByApp=rt})(SAUpsellTrigger||(SAUpsellTrigger={}))