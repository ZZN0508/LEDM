define("indexnew:component/gamebox/gamebox.js",["global","module","exports","require","indexnew:static/js/jquery.js","indexnew:static/js/jquery_easing.js","indexnew:static/js/config.js","indexnew:static/js/store.js","indexnew:static/js/format.js","indexnew:static/js/events.js","indexnew:static/js/browser.js","indexnew:static/js/log.js","indexnew:component/gamebox/gameboxcustomTemplate.js","indexnew:component/gamebox/common/index.js","indexnew:component/gamebox/hotRecommend/index.js","indexnew:component/gamebox/newGameRank/index.js","indexnew:component/gamebox/like/index.js","indexnew:component/gamebox/rightSource/index.js","indexnew:component/gamebox/kingPosition/index.js"],function(e,t,i,a,o,n,r,s,u,d,g,m,h,p,c,l,x,f,w){var y=o;y.getScript(location.protocol+"//sofire.bdstatic.com/js/dfxaf.js").done(function(){xaf.init({aid:"7343",dataApp:"eyJhcHBfa2V5IjoiNzM0MyIsImFwcF92aWV3IjoicHJvbW90ZSIsImJyb3dzZXJfdXJsIjoiaHR0cHM6Ly9zb2ZpcmUuYmFpZHUuY29tL2RhdGEvdWEvYWIuanNvbiIsImZvcm1fZGVzYyI6IiIsInNlbmRfaW50ZXJ2YWwiOjUwLCJzZW5kX21ldGhvZCI6M30="})});var v=r,G=s,_=u,b=d,T=v.get("userinfo")&&v.get("userinfo").islanding,B=g,S=m,D=h,j=p,I=c,L=l,k=x,U=f,O=w,H=y("#shortcut-box"),$=y("#feed_wrap"),C=y("#feed_news_wrap"),A=y("#header"),R=A.height(),W=y("#feed_wrap .layout-left-title"),E=y(".layout-left-title .item",$),M=y(".rightTip",H),N={entryUrl:"api/getgameboxindexdata",moduleUrl:"api/gameboxdata",recordUrl:"api/gamerecords",newplayedUrl:"api/getuserreporting",rightSourceUrl:"api/getgamedata"},J={1:"leisure",2:"pagegame",3:"active",4:"newgame"},P={entryIsWholeImg:!1,$imglist:null,$gameBox:null,$rightTipGame:null,$tips:null,$guideTips:null,animateInTime:500,animateOutTime:500,animateType:"linear",inoutAnimateTime:600,inOutAnimateType:"easeInOutCirc",guideType:1,reGuideGif:"",ifShowReGuideBox:!0,ifHitGamePortrait:!1,hoverGuideText:"",guideTimeDiff:86400,newGuide:{},operGuide:{},reGuide:{},packUpGuide:{},inParmas:{height:"425px",opacity:1,top:0,left:0},outParmas:{height:"36px",opacity:0,top:"425px",left:"93px"},showRightSource:function(e,t){var i=this,a=e.jump_url,o=_(U.rightSourceLinkTpl,{src:e.jump_imgurl,type:J[e.template_id],template:"template_id:"+e.template_id,url:a}),n=a&&!t;H.prepend(o),this.sendRightSourceShowLog(e);var r=y("#right-source-container",H),s=y(".right-source-container-off",r);r.click(function(t){if(n)return void(T||j.saveData(e,i.changeRightSourceKey));t&&t.preventDefault();var a=v.get("boxLock");return a?void i.gameBoxFixed(R):(v.set("boxLock",!0),void i.gameBoxOpen("rightSource"))}),s.click(function(e){B.ie?e.cancelBubble=!0:e.stopPropagation(),r.hide()})},showGameBox:function(e){this.initGameBoxData(e);var t=e.normal,i=e.hover;this.entryIsWholeImg=e.if_unify_icon_text;var a="",o="",n=0;this.entryIsWholeImg?(a="none",o="",n=-8):(a="",o="none",n=4);var r=_(D.entryTpl,{top:n,normalUrl:t&&t.iconUrl,normalText:t&&t.textUrl,hoverUrl:i&&i.iconUrl,hoverText:i&&i.textUrl,singleDisp:a,wholeDisp:o,normalWholeImg:t&&t.icon_textUrl});H.prepend(r),this.eleBindEvent();var s=j.getUrlParams()||{},u=s.source,d=G.get("gameBoxReload")||!1;(d||"game"===u)&&(v.set("boxLock",!0),d&&G.set("gameBoxReload",!1),this.gameBoxOpen("box")),b.on("hao123.feedtab.gameBox.open",this.gameBoxOpen,this),b.on("hao123.feedtab.gameBox.sendData",this.sendCacheData,this),this.gameBoxEntryShowLog()},initGameBoxData:function(e){if(this.reGuideGif=e.icon_gif,this.ifShowReGuideBox=1===e.if_show_gamebox,this.ifHitGamePortrait=e.hit_portrait,this.hoverGuideText=e.hover.text,O.playedGameDefaultIcon=e.fixed_default_icon,e.guide_info&&e.guide_info.length){var t=this;y.each(e.guide_info||[],function(e,i){if(i)switch(i.type){case 1:t.newGuide=i;break;case 2:t.reGuide=i;break;case 3:t.operGuide=i;break;case 4:t.packUpGuide=i}})}},sendCacheData:function(){var e=G.get("gameCacheList"),t=e&&e.length,i=G.get("gameNewGuide"),a=G.get("gameOperGuide"),o=[],n=[];i&&n.push(i),a&&n.push(a);for(var r=0;t>r;r++){var s=e[r],u={game_id:s.game_id,start_time:s.history};o.push(u)}var d={list:o,action_list:n};t||i||a?y.post(N.recordUrl,d,function(e){e&&e.result&&(G.remove("gameCacheList"),G.remove("gameNewGuide"),G.remove("gameOperGuide")),window.location.reload()},"json"):window.location.reload()},eleBindEvent:function(){var e=y(".rightTip.game-box",H),t=y(".rightTip-img",e),i=y(".game-box-tips-no",H),a=y(".game-box-tips-no-close",i),o=y(".game-box-tips-ch",e),n=y(".game-box-visit",e),r=this;if(r.$rightTipGame=e,r.$tips=i,r.$guideTips=o,T)r.getSigleModuleData({type:3},function(e){if(r.guideType=e.type,1===e.is_guide&&(e.type===r.newGuide.type&&r.entryAnimation(r.newGuideShow,r.newGuide.guide_text),e.type===r.operGuide.type&&r.entryAnimation(r.newGuideShow,r.operGuide.guide_text)),e.type===r.reGuide.type&&1===e.is_guide&&r.ifShowReGuideBox){var t=r.reGuideGif?r.reGuideGif:e.icon_url;r.revisitGuideShow(n,t,r.reGuide.guide_text)}});else{var s=G.get("playedHoverStatus")||!1,u=G.get("gameCacheList")||[],d=u&&u.length,g=j.transFormSeconds(+new Date);if(d)if(s&&r.ifShowReGuideBox){var m=r.reGuideGif?r.reGuideGif:u[0].icon_url;r.guideType=r.reGuide.type,r.revisitGuideShow(n,m,r.reGuide.guide_text)}else r.operGuideData(g);else r.newGuideData(g)}e.click(function(e){e&&e.preventDefault();var t=v.get("boxLock");return t?void r.gameBoxFixed(R):(v.set("boxLock",!0),void r.gameBoxOpen("box"))}),e.hover(function(){t.each(function(e,t){var i=y(t).attr("data-hover");y(t).attr("src",i)})},function(){t.each(function(e,t){var i=y(t).attr("data-src");y(t).attr("src",i)})}),a.click(function(e){e&&e.preventDefault();var t="";r.guideType===r.newGuide.type&&(t="gameNewGuide"),r.guideType===r.operGuide.type&&(t="gameOperGuide");var a=G.get(t);a&&!T&&(a.switch=!0,G.set(t,a)),i.hide()})},entryAnimation:function(e,t){function i(){a.animate({top:r.entryIsWholeImg?"-8px":"-4px"},600,function(){r.entryIsWholeImg||(o.addClass("game-box-top-img"),n.addClass("game-box-wipes-shake")),a.animate({top:r.entryIsWholeImg?"-8px":"4px"},700,function(){return r.entryIsWholeImg||(o.removeClass("game-box-top-img"),n.removeClass("game-box-wipes-shake")),1===s?(s=0,void(e&&e.bind(r)(t))):(++s,void i())})})}var a=y(".rightTip.game-box",H),o=y(".game-box-top",a),n=y(".game-box-wipes",a),r=this,s=0;i()},newGuideData:function(e){var t=G.get("gameNewGuide"),i=t&&t.create_time;i?e-i[0]>this.guideTimeDiff&&!t.switch&&i.length<3?(t.create_time.unshift(e),this.guideType=t.type,G.set("gameNewGuide",t),this.entryAnimation(this.newGuideShow,this.newGuide.guide_text)):this.operGuideData(e):(t={type:this.newGuide.type,create_time:[e],"switch":!1},this.guideType=this.newGuide.type,G.set("gameNewGuide",t),this.entryAnimation(this.newGuideShow,this.newGuide.guide_text))},operGuideData:function(e){var t=G.get("gameOperGuide"),i=t&&t.create_time;i?e-i[0]>this.guideTimeDiff&&!t.switch&&i.length<3&&(t.create_time.unshift(e),this.guideType=t.type,G.set("gameOperGuide",t),this.entryAnimation(this.newGuideShow,this.operGuide.guide_text)):(t={type:this.operGuide.type,create_time:[e],"switch":!1},this.guideType=this.operGuide.type,G.set("gameOperGuide",t),this.entryAnimation(this.newGuideShow,this.operGuide.guide_text))},newGuideShow:function(e){this.$tips&&this.$tips.show().find(".game-box-tips-no-text").text(e).parent().animate({right:"56px",opacity:1},500),j.guideAnimation(this.$tips),this.sendGameLog()},packUpGuideShow:function(e,t){e&&e.text(t).show(),j.guideAnimation(e),this.sendGameLog()},revisitGuideShow:function(e,t,i){var a=y("#right-source-container",H);a.addClass("rightTip-rightSource"),M.addClass("rightTip-init"),e&&t&&e.show(1500).find(".game-box-visit-img").attr("src",t).parent().animate({opacity:1},4e3,function(){e.find(".game-box-visit-tips").text(i).show().parent().animate({top:"-45px",opacity:0},2e3,function(){M.removeClass("rightTip-init"),a.removeClass("rightTip-rightSource"),e.hide()})}),this.sendGameLog()},gameBoxOpen:function(e){var t=this,i=G.get("gameCacheList"),a=i&&i.length,o={};T?o=t.getModuleData(5):a&&(O.playedHoverStatus=G.get("playedHoverStatus")||!1,o={title:O.playedGameTitle,gamelist:i.slice(0,5),jump_url:O.playedJumpUrl,hover_status:O.playedHoverStatus,is_show_more:i.length>5}),y.when(t.getModuleData(2),k.getLikeData(e),t.getModuleData(6),t.getModuleData(1),o).done(function(i,a,o,n,r){if(!(i&&a&&o&&n&&r))throw v.set("boxLock",!1),new Error("request data error");var s=i[0]&&i[0].result,u=a[0]&&a[0].result,d=o[0]&&o[0].result,g=n[0]&&n[0].result;if(O.playedData=T?r[0]&&r[0].result:r,!(s&&u&&d&&g&&O.playedData))return v.set("boxLock",!1),!1;var m=I.renderHotTpl(s),h=k.renderLikeTpl(u),p=L.renderNewGameRankTpl(d),c=O.renderGameTpl(O.playedData),l=O.renderKingKongTpl(g),x=_(D.boxTpl,{hotHeader:m.hotHeader,hotList:m.hotList,hotBtn:m.hotBtn,gameHeader:h.gameHeader,gameList:h.gameList,gameBottom:h.gameBottom,newGameHeader:p.newGameHeader,newGameList:p.gameList,ulWidth:c.ulWidth,ulLeft:c.ulLeft,playedList:c.gameList,isShowMore:c.isShowMore,moreUrl:c.moreUrl,playedModule:c.playedModule,kingkong:l,href:s.gamelist[0].jump_url});t.$gameBox&&t.$gameBox.remove(),C.prepend(x),t.$gameBox=y("#gameBox",C),t.gameBoxIn(e)}).fail(function(){throw v.set("boxLock",!1),new Error("request error")})},gameBoxIn:function(e){this.selectGameTab(e),I.initHotList(),this.bindEvent(),"rightSource"===e&&y(".game-item-0",this.$gameBox).delay(this.inoutAnimateTime).fadeOut(300).fadeIn(300).fadeOut(300).fadeIn(300),this.$gameBox.animate(this.inParmas,this.inoutAnimateTime,this.inOutAnimateType,function(){v.set("boxLock",!0)})},gameBoxOut:function(){var e=this;this.$gameBox.animate(this.outParmas,this.inoutAnimateTime,this.inOutAnimateType,function(){e.$gameBox.remove(),k.page=1,e.guideType=e.packUpGuide.type,e.packUpGuideShow(e.$guideTips,e.packUpGuide.guide_text),v.set("boxLock",!1)}),I.clearTimer()},changeRightSourceKey:function(e){var t=j.transFormSeconds(+new Date);return{game_id:e.game_id,game_name:e.game_name,icon_url:e.game_icon,jump_url:e.jump_url,history:[t]}},bindEvent:function(){var e=this,t=y("#gameBoxClose",this.$gameBox);t.click(function(t){t&&t.preventDefault(),e.gameBoxOut()}),I.bindEvent(),k.bindEvent(),L.bindEvent(),O.bindEvent(),b.on("hao123.feedtab.gameBox.close",this.gameBoxOut,this)},selectGameTab:function(e){var t=0,i=y(".layout-left-title .item[type='games']",$),a=this;t&&clearTimeout(t),t=setTimeout(function(){var t=i.attr("type");C.removeAttr("style");var o=W.height(),n=350,r=window.innerHeight-R-o+n;C.css("min-height",r+"px"),E.removeClass("active"),i.addClass("active"),a.gameBoxFixed(R);var s=v.get("type");e&&s!==t&&b.emit("hao123.feedtab.change",t)},300)},gameBoxFixed:function(e){var t=y("html, body"),i=t.scrollTop(),a=$.offset().top||0,o=a-e;i!==o&&t.animate({scrollTop:121>=i?o-22:o},300)},getEnteryInfo:function(){return y.getJSON(N.entryUrl,{t:+new Date})},getRightSourceInfo:function(e){return y.getJSON(N.rightSourceUrl,{t:+new Date,type:e})},getSigleModuleData:function(e,t){this.geBoxData(N.moduleUrl,e,t)},geBoxData:function(e,t,i){t.t=+new Date,y.getJSON(e,t,function(e){e&&e.result&&i&&i(e.result)})},getModuleData:function(e){var t={type:e,t:+new Date};return y.getJSON(N.moduleUrl,t)},gameBoxEntryShowLog:function(){var e={type:"show",value:"gameBoxEntry",game_islogin:T,hit_portrait:this.ifHitGamePortrait};S(e)},sendGameLog:function(){var e={type:"show",game_islogin:T,guide_type:this.guideType,hit_portrait:this.ifHitGamePortrait};S(e);var t="game_islogin:"+T+",guide_type:"+this.guideType+",hit_portrait:"+this.ifHitGamePortrait;this.$rightTipGame.attr("alog-custom",t),this.$tips.attr("alog-custom",t)},sendRightSourceShowLog:function(e){var t={type:"show",game_islogin:T,game_id:e.game_id,game_name:e.game_name,game_template_id:e.template_id};S(t)}};t.exports=P});