define.amd=!1,require.config({baseUrl:"/resource",paths:{text:"js/lib/requirejs-plugins/text"}}),$.extend(So.newsFlow,{logMark:"homecard",eventMark:"so.homecard",currNavCookieMark:"currCard",hotNewsFlag:"hot-news-card",$newsFlow:null,$realTimeNews:null,$cardSide:null,$cardContainer:null}),So.newsFlow.observerEvent={addHotNewsCard:So.newsFlow.eventMark+".addHotNewsCard",closeHotNewsCard:So.newsFlow.eventMark+".closeHotNewsCard",infoFlowClickTab:So.newsFlow.eventMark+".infoFlowClickTab",infoFlowTabFixed:So.newsFlow.eventMark+".infoFlowTabFixed",searchboxFixed:So.newsFlow.eventMark+".searchboxFixed",cancelSearchboxFixed:So.newsFlow.eventMark+".cancelSearchboxFixed"},require(["js/home/card/main"],function(){}),define("js/home/card/loader",function(){}),define("text",["module"],function(e){var t,n,r,i,s,o=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],u=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,a=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,f=typeof location!="undefined"&&location.href,l=f&&location.protocol&&location.protocol.replace(/\:/,""),c=f&&location.hostname,h=f&&(location.port||undefined),p={},d=e.config&&e.config()||{};t={version:"2.0.12",strip:function(e){if(e){e=e.replace(u,"");var t=e.match(a);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:d.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=o[t];try{e=new ActiveXObject(n)}catch(r){}if(e){o=[n];break}}return e},parseName:function(e){var t,n,r,i=!1,s=e.indexOf("."),o=e.indexOf("./")===0||e.indexOf("../")===0;return s!==-1&&(!o||s>1)?(t=e.substring(0,s),n=e.substring(s+1,e.length)):t=e,r=n||t,s=r.indexOf("!"),s!==-1&&(i=r.substring(s+1)==="strip",r=r.substring(0,s),n?n=r:t=r),{moduleName:t,ext:n,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,d.isBuild&&(p[e]=r),i(r)},load:function(e,n,r,i){if(i&&i.isBuild&&!i.inlineText){r();return}d.isBuild=i&&i.isBuild;var s=t.parseName(e),o=s.moduleName+(s.ext?"."+s.ext:""),u=n.toUrl(o),a=d.useXhr||t.useXhr;if(u.indexOf("empty:")===0){r();return}!f||a(u,l,c,h)?t.get(u,function(n){t.finishLoad(e,s.strip,n,r)},function(e){r.error&&r.error(e)}):n([o],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,n,r,i){if(p.hasOwnProperty(n)){var s=t.jsEscape(p[n]);r.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.ext?"."+o.ext:"",a=o.moduleName+u,f=r.toUrl(o.moduleName+u)+".js";t.load(a,r,function(n){var r=function(e){return i(f,e)};r.asModule=function(e,t){return i.asModule(e,f,t)},t.write(e,a,r,s)},s)}};if(d.env==="node"||!d.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node&&!process.versions["node-webkit"])n=require.nodeRequire("fs"),t.get=function(e,t,r){try{var i=n.readFileSync(e,"utf8");i.indexOf("\ufeff")===0&&(i=i.substring(1)),t(i)}catch(s){r&&r(s)}};else if(d.env==="xhr"||!d.env&&t.createXhr())t.get=function(e,n,r,i){var s=t.createXhr(),o;s.open("GET",e,!0);if(i)for(o in i)i.hasOwnProperty(o)&&s.setRequestHeader(o.toLowerCase(),i[o]);d.onXhr&&d.onXhr(s,e),s.onreadystatechange=function(t){var i,o;s.readyState===4&&(i=s.status||0,i>399&&i<600?(o=new Error(e+" HTTP status: "+i),o.xhr=s,r&&r(o)):n(s.responseText),d.onXhrComplete&&d.onXhrComplete(s,e))},s.send(null)};else if(d.env==="rhino"||!d.env&&typeof Packages!="undefined"&&typeof java!="undefined")t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),r!==null&&n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)};else if(d.env==="xpconnect"||!d.env&&typeof Components!="undefined"&&Components.classes&&Components.interfaces)r=Components.classes,i=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),s="@mozilla.org/windows-registry-key;1"in r,t.get=function(e,t){var n,o,u,a={};s&&(e=e.replace(/\//g,"\\")),u=new FileUtils.File(e);try{n=r["@mozilla.org/network/file-input-stream;1"].createInstance(i.nsIFileInputStream),n.init(u,1,0,!1),o=r["@mozilla.org/intl/converter-input-stream;1"].createInstance(i.nsIConverterInputStream),o.init(n,"utf-8",n.available(),i.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),o.readString(n.available(),a),o.close(),n.close(),t(a.value)}catch(f){throw new Error((u&&u.path||"")+": "+f)}};return t}),define("text!html/news-flow.html!strip",[],function(){return'<% if(tplType == \'tab\'){ %>\n<div class="top-tab">\n    <div class="fixed">\n        \n        <% for(var i = 0, len = data.length; i < len; i++){ %>\n        <a href="javascript:;" class="<%= i==0 ? \'selected\' : \'\' %>" data-log="tab" data-param="<%= data[i].param %>">\n            <%= data[i].txt %>\n            <% if (data[i].txt == \'\u5173\u6ce8\'){ %>\n                <span class="follow_reddot"></span>\n            <% } %>\n            <span class="line"></span>\n        </a>\n        <% } %>\n    </div>\n</div>\n<% }else if(tplType == \'news\'){ %>\n<li data-tpl="news" data-type="<%= type %>" data-from="news-<%= dataSource %><%= from ? \'-\' + from : \'\' %>"\n    class="respond <%= liClass %> <%= liCoversClass %>" data-ctitle="0" <%= attr %>>\n    <a data-log="link" href="<%= url %>" target="_blank" title="<%= So.lib.escapeHTML(titleFull) %>">\n        <!-- \u591a\u56fe\u6216\u65e0\u56fetitle-start -->\n        <% if(liCoversClass != "single-img"){ %>\n        <p data-log="title" class="sub-title"><%= title %></p>\n        <% } %>\n        <!-- \u591a\u56fe\u6216\u65e0\u56fetitle-end -->\n\n        <!-- \u56fe\u7247-start -->\n        <% if(covers.length > 0){ %>\n        <div class="img">\n            <% for(var i = 0, len = covers.length; i < len; i++){ %>\n            <span class="img-wrap<%= (i != 0 && len - 1 == i) ? \' last\' : \'\' %>">\n                <img onerror="NewsFlow.Tools.checkImg()" data-log="image" <%= covers[i].style %>\n                    width="<%= coversWidth %>px" height="<%= coversHeight %>px" src="<%= covers[i].src %>">\n                <div class="g-img-mask"></div>\n                <% if(type == "video"){ %>\n                <div class="play"></div>\n                <% } %>\n            </span>\n            <% } %>\n            <% if(corner){ %>\n            <div data-log="image" class="corner"><%= corner %></div>\n            <% } %>\n        </div>\n        <% } %>\n        <!-- \u56fe\u7247-end -->\n\n        <!-- \u5355\u56fetitle-start -->\n        <% if(liCoversClass == "single-img"){ %>\n        <div class="con">\n            <p data-log="title" class="sub-title short"><%= title %></p>\n            <p data-log="title" class="sub-title long"><%= titleLong %></p>\n            <% } %>\n            <!-- \u5355\u56fetitle-end -->\n\n            <p data-log="desc" class="desc">\n                <%= source %><%= followButton %><%= date %><%= playCount %><%= tag %></p>\n\n            <!-- \u5355\u56fetitle-start -->\n            <% if(liCoversClass == "single-img"){ %>\n        </div>\n        <% } %>\n        <!-- \u5355\u56fetitle-end -->\n\n    </a>\n    <div class="close"></div>\n</li>\n<% }else if(tplType == \'sad\'){ %>\n<!-- \u6b63\u5e38\u5e7f\u544a\uff1adata-from="sad" -->\n<!-- qcms\u8fd0\u8425\u4f4d\uff1adata-from="sad-qcms" -->\n<li data-from="<%= from %>" class="sad respond <%= liCoversClass %>" data-imptk="<%= imptk %>" data-clktk="<%= clktk %>"\n    data-clstk="<%= clstk %>" data-title="<%= titleFull %>" data-ctitle="0" data-video=\'<%= videoData %>\'>\n    <!-- \u5587\u53ed -->\n    <% if(type == "video"){ %>\n    <a href="javascript:;" class="horn"></a>\n    <a href="javascript:;" class="play"><i></i><span class="time"><%= duration %></span></a>\n    <% } %>\n\n    <a data-log="link" href="<%= url %>" data-href="<%= url %>" target="_blank" class="bg-url" rel="noopener"></a>\n\n    <!-- title\u5728\u9876\u90e8start\uff1a\u591a\u56fe \u89c6\u9891 \u5927\u56fe \u65b9\u56fe -->\n    <% if(type == "manyImg" || type == "video" || type == "bigImg"  || type == "squareImg"){ %>\n    <a data-log="title" href="<%= url %>" data-href="<%= url %>" target="_blank" class="sub-title"\n        rel="noopener"><%= title %></a>\n    <% } %>\n    <!-- title\u5728\u9876\u90e8end -->\n\n    <!-- \u56fe\u7247start -->\n    <div class="img">\n        <% for(var i = 0, len = img.length; i < len; i++){ %>\n        <a class="img-wrap <%= (i != 0 && len - 1 == i) ? \'last\' : \'\' %>" href="<%= img[i].url %>"\n            data-href="<%= img[i].url %>" target="_blank" rel="noopener">\n            <% if(type == "video"){ %>\n            <video muted src="<%= img[i].src %>" data-log="video" data-allowEndedLog="1" <%= img[i].style %>\n                height="<%= imgHeight %>px">\u60a8\u7684\u6d4f\u89c8\u5668\u4e0d\u652f\u6301 video \u6807\u7b7e\u3002</video>\n            <% }else{ %>\n            <img onerror="NewsFlowSad.Tools.checkImg()" data-log="image" <%= img[i].style %> width="<%= imgWidth %>px"\n                height="<%= imgHeight %>px" src="<%= img[i].src %>">\n                <div class="g-img-mask"></div>\n            <% } %>\n        </a>\n        <% } %>\n    </div>\n    <!-- \u56fe\u7247end -->\n\n    <a href="<%= url %>" data-href="<%= url %>" target="_blank" class="con" rel="noopener">\n        <!-- title\u5728\u53f3\u4fa7start\uff1a\u5355\u56fe -->\n        <% if(type == "singleImg"){ %>\n        <p data-log="title" class="sub-title"><%= title %></p>\n        <% } %>\n        <!-- title\u5728\u53f3\u4fa7end -->\n\n        <p data-log="desc" class="desc"><span><%= source %></span><%= sadTxt %></p>\n    </a>\n    <div class="close"></div>\n</li>\n<% }else if(tplType == \'noData\'){ %>\n<div class="no-more clearfix">\n    <hr size="1">\n    </hr>\n    <p>\u6ca1\u6709\u66f4\u591a\u5185\u5bb9\u4e86\u54e6 ~</p>\n</div>\n<% }else if(tplType == \'loading\'){ %>\n<div class="loading short"><i class="ico"></i>\u52a0\u8f7d\u4e2d...</div>\n<% }else if(tplType == \'retry\'){ %>\n<div class="retry"><i></i>\u52a0\u8f7d\u5931\u8d25\uff0c\u8bf7<a href="javascript:;">\u5237\u65b0\u91cd\u8bd5</a></div>\n<% }else if(tplType == \'gotoTop\'){ %>\n<div id="goto-top"><span></span></div>\n<% }else if(tplType == \'closeList\'){ %>\n<div class="close-list">\n    <div class="wrap">\n        <i></i>\n        <a href="javascript:;" data-val="5">\u4e0d\u611f\u5174\u8da3</a>\n        <a href="javascript:;" data-val="1">\u5185\u5bb9\u4e0d\u5b9c</a>\n        <a href="javascript:;" data-val="4">\u906e\u6321\u5e72\u6270</a>\n        <a href="javascript:;" data-val="2">\u5c4f\u853d\u6b64\u7c7b</a>\n    </div>\n</div>\n<% } %>'}),define("js/news-flow/recommend",[],function(){function i(t,n,i,s){var a=$("li[data-gnid="+n+"][data-recommended=1]");if(a.hasClass("flow-inline-recommend-mod"))return;var f=$(So.lib.template(r,{date:i,data:t,src:e,nlpv:s}));a.addClass("flow-inline-recommend-mod").append(f),f.find("a").on("click",function(e){var t=$(this),n={type:"click",dataType:t.index(),pos:+a.attr("data-news-rank"),p1:a.find("[data-log=link]").attr("title"),p2:a.find("[data-log=link]").attr("data-mdurl")||a.find("[data-log=link]").attr("href"),p3:t.text(),value:a.attr("data-gnid"),nlpv:s};o(n),e.stopPropagation()}),u()}function s(t,n){(function(t,n){$.ajax({url:"//api.ssl.so.com/kuaizixun_news_recommend",data:{title:t,gnid:n,src:e},method:"get",dataType:"jsonp",success:function(e){e&&e.data&&e.data.result&&$.isArray(e.data.result)&&e.data.result.length&&i(e.data.result,n,+(new Date),e.data.nlpv)}})})(t,n)}function o(t){So.lib.log("flow-inline-recommend",$.extend({_huid:So.lib.cookie.get("__huid")||"",src:e},t))}function u(){clearTimeout(t),t=setTimeout(function(){var e,t;$.each(So.newsFlow.$newsFlow.find("li[data-tpl=news]"),function(n,r){e=$(r);if(e.attr("data-send-recommend-showlog")==1||!So.lib.isVisible1(r))return;if(So.comm.pid=="home"&&$("#footer")[0].getBoundingClientRect().top-r.getBoundingClientRect().top<e.outerHeight()-10)return;if(!e.find(".flow-inline-recommend").length){e.attr("data-recommended")==1&&(e.attr({"data-send-recommend-showlog":1}),o({type:"allShow",p1:n}));return}t=[],$.each(e.find(".flow-inline-recommend a"),function(n,r){So.lib.isVisible($(r),!0,e.find(".flow-inline-recommend"))&&So.lib.isVisible1(r)&&t.push($(r).text())});if(!t.length)return;e.attr({"data-send-recommend-showlog":1,"data-news-rank":n});var i={type:"show",pos:n,p1:t.join("||"),p2:e.find("[data-log=link]").attr("data-mdurl")||e.find("[data-log=link]").attr("href"),p3:e.find(".flow-inline-recommend").attr("data-request-date"),value:e.attr("data-gnid"),nlpv:e.find(".flow-inline-recommend").attr("data-nlpv")};o(i),o({type:"allShow",p1:n})})},500)}function a(){$(window).off("scroll."+n).on("scroll."+n,u),So.lib.browser.isIE()&&So.lib.browser.isIE()<=9?$(window).off("focus."+n).on("focus."+n,u):$(document).off("visibilitychange."+n).on("visibilitychange."+n,u)}function f(){var e=So.newsFlow.$newsFlow.find("li[data-tpl=news]");$.each(e,function(e,t){var n=$(t);if(!n.attr("data-gnid"))return;(e==0||e==1||(e+2)%3==0)&&n.attr("data-recommended")!=1&&(n.attr("data-recommended",1),s(n.find("[data-log=link]").attr("title"),n.attr("data-gnid")))}),a()}var e,t,n=So.newsFlow.eventMark+".recommend",r='<div class="flow-inline-recommend" data-nlpv="<%= nlpv %>" data-request-date="<%= date %>"><span>\u4f60\u53ef\u80fd\u611f\u5174\u8da3\uff1a</span>                    <span>                        <% for (var i = 0, len = data.length; i < len; i++) { %>                        <a href="//www.so.com/s?src=<%= src %>&fr=<%= src %>&nlpv=<%= nlpv %>&q=<%= encodeURIComponent(data[i].query) %>" target="__blank"                        ><%= data[i].is_hot ? "<i></i>" : "" %><%= data[i].query %></a>                        <% } %>                    </span>                </div>';return function(){if(So.comm.pid=="home")So.lib.checkAbv(2242,2)&&(e="home_flow_queryrec",f());else if(So.lib.checkAbv(2212,1)||So.lib.checkAbv(2212,2))e="hotnews_rec_show",f()}}),function(){var e=3,t=0;broswerExternal={broswerAppCmd:function(e){var t=$.Deferred(),n=e||"exut",r="get"+n+"status";try{external.AppCmd(external.GetSID(window),"",r,"","",function(e,n){if(!e&&n){var r=JSON.parse(n),i=r.ti,s=r.ui,o={};i&&s&&i!==s?(o.title=i,o.url=s,t.resolve(o)):t.reject("repeat")}else t.reject()})}catch(i){t.reject()}return t},getData:function(n){var r=this,i=$.Deferred();return this.broswerAppCmd(n).then(function(e){i.resolve(e)},function(s){s==="repeat"?t<e?(t++,setTimeout(function(){r.getData(n).then(function(e){i.resolve(e)},function(){i.reject()})},100)):i.reject():i.reject()}),i}}}(),define("js/browser/index",function(){}),define("js/news-flow/flow",["js/browser/index"],function(){(function(){NewsFlow=function(e){var t=this,n={debugTxt:"",$newsFlow:So.newsFlow.$newsFlow,source:So.newsFlow.source||"papi",query:So.comm.q,type:So.newsFlow.type,from:So.newsFlow.from,logMark:So.newsFlow.logMark,eventMark:So.newsFlow.eventMark,logParam:{},guid:So.lib.getMid()||So.lib.cookie.get("__guid")||So.comm.guid,asc:"",template:"",currPage:1,requestPage:1,newsCount:10,gotoTopDis:700,retryGetDataTimes:1,showGotoTop:!0,alwaysShowFlow:!1,onlyShowSingleImg:!1,preventScrollLoad:!1,preferences:{},isShowTag:!1,isShowAtlas:!0,isShowVideo:!0,sourceParames:{},manyImg:{count:4,width:132,height:88,isShowCorner:!0},singleImg:{width:132,height:88,titleLength:78},atlasImg:{width:268,height:170},noImg:{titleLength:150},stopRender:!1,initCb:$.noop,scrollCb:$.noop,noDataCb:$.noop,neverDataCb:$.noop,addNewsCb:$.noop,removeFlowCb:$.noop,renderBeforeCb:$.noop,renderAfterCb:$.noop};So.comm.proxy_ads_conf["kuai_asc"]==1&&(n.guid=So.lib.cookie.get("__guid")||So.comm.guid,n.asc=So.lib.getASC()||""),t.options=$.extend(!0,{},n,e),t.noData=!1,t.currRetryGetDataTimes=0,t.$flowInner=t.options.$newsFlow.find("ul"),t.$loading=$(NewsFlow.Tools.template(t.options.template,{tplType:"loading"})),t.$gotoTop=$(NewsFlow.Tools.template(t.options.template,{tplType:"gotoTop"})),t.hasSendFollowButtonSrpLog=!1,t.init()},NewsFlow.Tools={getTxt:function(e){return So.lib.escapeHTML($("<p>"+e+"</p>").text())},cutStr:function(e,t){e=So.lib.unescapeHTML(So.lib.cutStr(e,t)),e=e.replace(/^(.*)(<|<b|<\/|<\/b)\.\.\.$/,"$1...");var n=e.indexOf("<b>"),r=e.indexOf("</b>");return n!=r&&(e=e.replace(/(.*)<b>([^<>]*?)\.\.\.$/,"$1<b>$2</b>...")),So.lib.escapeHTML(e)},checkImg:function(){var e=event.srcElement;$(e).remove(),e.onerror=null},formatSeconds:function(e){var t=[parseInt(e/60/60),parseInt(e/60%60),parseInt(e%60)];return t[0]===0&&t.shift(),t.join(":").replace(/\b(\d)\b/g,"0$1")},log:So.lib.log,observer:So.lib.observer,template:So.lib.template,isVisible:So.lib.isVisible1,getPicUrl:So.lib.getPicUrl,formatTime:So.lib.formatTime,sslReplace:So.lib.sslReplace,escapeHTML:So.lib.escapeHTML,unescapeHTML:So.lib.unescapeHTML,localStorage:So.lib.soLocalStorage},NewsFlow.prototype={Source:{papi:{getData:function(e){var t=this,n=t.options;if(t.noData)return;e=$.extend({noRender:!1,newsCount:n.newsCount,beforeCb:$.noop,afterCb:$.noop,failCb:$.noop},e);var r={q:n.query,from:n.from,so_type:n.type,n:e.newsCount,u:n.guid,v:1,sv:1,net:5,scene:1,device:2,f:"json_v1",c:"youlike",callfrom:"so",data_type:"jsonp",refer_scene:"so_7",sign:"360_e39369d1",abv:"",crec:So.lib.recls().info,recext:So.lib.cookie.get("recext"),asc:n.asc};$.ajax({url:"//papi.look.360.cn/mlist",data:r,type:"get",timeout:3e3,dataType:"jsonp",success:function(n){if(t.noData)return;if(n&&n.items&&n.items.length){e.beforeCb();var r=t.Source.papi.formatData.call(t,n.items,n.tc_show);r.length&&t.render(r,e.noRender),setTimeout(function(){e.afterCb(t)},0)}else t.setNoData(e),e.failCb(t)},error:function(){t.setNoData(e),e.failCb(t)}}),n.currPage++},formatData:function(e,t){var n=[],r={},i=this.options;for(var s=0,o=e.length;s<o;s++){r=e[s];if(r.from!="news"||r.attr.image_url==""||r.url==""||r.title=="")continue;var u="news",a=r.attr.image_url?r.attr.image_url.split(";"):[],f="",l="";if(r.ntag&&r.ntag.match(/y3:(.*?);/)){var c=r.ntag.match(/y3:(.*?);/)[1].split(":");l=c[c.length-1]}i.isShowAtlas&&r.s=="p"&&a.length>1&&(u="atlas");var h="";i.isShowVideo&&(r.s=="v"||r.s=="y")&&r.duration&&a.length==1&&(u="video",f=NewsFlow.Tools.formatSeconds(r.duration),h=+r.playcnt?"<span>"+r.playcnt+"\u6b21\u89c2\u770b</span>":""),n.push({type:u,playCount:h,liClass:"papi",date:r.showtime*1e3,title:r.title,from:r.from,url:r.url,source:r.attr.sitename,covers:a,corner:f,attr:['data-tc-show="'+t+'"','data-log-extend="'+r.tc_value+'"','data-gnid="'+r.gnid+'"'].join(" "),tag:l,zmt:r.zmt||""})}return n}},baoDian:{sid:"",timer:null,baodianPage:1,batch:{},delNewsCookie:"delNews",closeLog:function(e,t){var n=e.Source.baoDian,r=t.find("a[title]").attr("title"),i=NewsFlow.Tools.localStorage.getItem(n.delNewsCookie)||JSON.stringify([]);i=JSON.parse(i),i.length==20&&i.shift(),i.push(r),NewsFlow.Tools.localStorage.setItem(n.delNewsCookie,JSON.stringify(i))},clickLog:function(e,t){if(!t.attr("data-a"))return;var n=e.options,r=n.preferences,i=t.data("sid"),s=t.data("gnid"),o=t.data("style"),u={uid:n.guid,sign:r.sign,device:2,net:5,stype:"portal",t:+(new Date),sid:i,channel:n.$newsFlow.find(".top-tab a.selected").attr("data-param")||n.type,sqid:r.sqid,act:"click",where:"list",scene:1,url:t.attr("data-callbackUrl"),gnid:s,a:t.attr("data-a"),c:t.attr("data-c"),source:t.attr("data-src"),s:t.attr("data-s"),style:o,asc:n.asc};$.ajax({url:"//papi.look.360.cn/srv/c",data:u,type:"get",dataType:"jsonp"})},showLog:function(e){var t=e.Source.baoDian,n=e.options,r=n.preferences,i=300;clearTimeout(t.timer),t.timer=setTimeout(function(){$.each(n.$newsFlow.find("li[data-type='news']"),function(e,t){var s=$(t),o=s.attr("data-log"),u=s.data("sid");if(NewsFlow.Tools.isVisible(t,i)&&!s.data("isSend")&&o){var a={uid:n.guid,sign:r.sign,device:2,net:5,stype:"portal",t:+(new Date),sid:u,channel:n.$newsFlow.find(".top-tab a.selected").attr("data-param")||n.type,sqid:r.sqid,act:"real_show",where:"list",scene:1,func:"pc_news_realshow",url_pack:"["+o.toString()+"]",asc:n.asc};$.ajax({url:"//news.qhstatic.com/srv/c2",data:a,dataType:"jsonp",type:"get"}),s.data("isSend",1)}})},2e3)},countBatch:function(e){var t=e.Source.baoDian,n=e.options.type;!t.batch[n]&&(t.batch[n]=0),t.batch[n]++},getData:function(){var e=this,t=e.Source.baoDian,n=e.options.preferences;if(n.qid!==""){var r=JSON.parse(NewsFlow.Tools.localStorage.getItem("flow-sqid"));r&&r.guid&&r.guid==n.guid?(n.sqid=r.val,t.getFlowData(e)):t.getSqid(e)}else t.getFlowData(e)},getSqid:function(e){var t=e.Source.baoDian,n=e.options.preferences;$.ajax({url:"//u.api.look.360.cn/user/sqid",data:{u:n.guid,sign:n.sign,f:"jsonp",cq:n.Q,ct:n.T,device:2},type:"get",dataType:"jsonp",timeout:1e3,success:function(r){r&&r.data&&r.data.sqid?(NewsFlow.Tools.localStorage.setItem("flow-sqid",JSON.stringify({val:r.data.sqid,guid:n.guid})),e.sqid=r.data.sqid,t.getFlowData(e)):t.getFlowData(e)},error:function(){t.getFlowData(e)}})},getFlowData:function(e){var t=e.options,n=e.Source.baoDian,r=e.options.preferences,i={u:t.guid,n:10,sign:r.sign,c:t.type=="mylike"?"youlike":t.type,f:"jsonp",device:2,sv:1,net:5,v:1,scene:1,sqid:r.sqid,action:n.baodianPage==1?1:2,cur_enc:t.curEnc||"",cur_title:t.curTitle||"",cur_rawurl:t.curRawUrl||"",crec:So.lib.recls().info,recext:So.lib.cookie.get("recext"),asc:t.asc,q:t.query,from:t.from,callfrom:t.sourceParames.callfrom};$.ajax({url:"//papi.look.360.cn/mlist",data:i,type:"get",dataType:"jsonp",timeout:3e3,success:function(t){if(e.noData)return;if(t&&t.data&&t.data.res)if(t.data.res.length){n.countBatch(e),n.sid=t.sid;var r=e.Source.baoDian.formatData(e,t);r.length?e.render(r):e.setNoData(),n.showLog(e),n.baodianPage++}else e.setNoData()},error:function(){e.setNoData()}}),t.currPage++},formatData:function(e,t){var n=t.sid,r=t.data.res,i=[],s={},o=e.options.type,u=e.Source.baoDian,a=NewsFlow.Tools.localStorage.getItem(u.delNewsCookie);a=a?JSON.parse(a):[];for(var f=0,l=r.length;f<l;f++){s=r[f];var c="news";if(~$.inArray(s.t,a))continue;if(!~$.inArray(s.s,["t","p","q","y"]))continue;var h=[],p=s.gnid||"",d=s.style||"";h.push(p),h.push(s.a||""),h.push(s.c||""),h.push(s.source||""),h.push(s.s||""),h.push(d),h.push(2e3),h.push(e.sid||""),h=" data-log='"+JSON.stringify(h)+"'";var v=s.showtime*1e3,m="",g="",y="";if(s.a=="t"&&s.attr&&s.attr[0]&&s.attr[0].isdisplay=="1"&&s.attr[0].content=="\u7f6e\u9876"){var b=s.attr[0];v='<span style="color:#'+b.color+'">'+b.content+"</span>",m="to-front"}var w=s.i&&s.i.split("|")||[];s.s=="y"&&s.duration&&w.length==1&&(c="video",y=NewsFlow.Tools.formatSeconds(s.duration),g=+s.playcnt?"<span>"+s.playcnt+"\u6b21\u89c2\u770b</span>":"");var E={type:c,playCount:g,liClass:m,date:v,title:s.t,from:"",url:s.pcurl,source:s.f,covers:w,corner:y,coversCount:s.s=="p"&&s.pnum>=4?s.pnum:"",attr:'" data-sid="'+n+'" data-callbackUrl="'+s.u+'" data-gnid="'+p+'" data-style="'+d+'" data-a="'+s.a+'" data-c="'+s.c+'" data-src="'+s.source+'" data-s="'+s.s+'"'+h};E.zmt=s.zmt||"",s.zmt&&s.zmt.name&&(E.source=s.zmt.name),i.push(E)}return i}},focus:{getData:function(e){var t=this,n=t.options,r=parseInt((new Date).getTime()/1e3);if(t.noData)return;e=$.extend({noRender:!1,newsCount:n.newsCount,beforeCb:$.noop,afterCb:$.noop,failCb:$.noop},e);var i;So.comm.pid=="www"?i="360_e39369d1":(i="360_fc624efc",So.comm.src=="360ws_newtab_xhj"?i="360_806235bc":So.comm.src=="360se_wl_p_home"&&(i="360_6b0e5af1"));var s={sign:i,uid:n.guid,asc:n.asc,token:r+"|"+So.lib.md5(n.guid+"fdasof09vni234rk23b498uvo234eo14n123b12v31v23c1y23y1u"+r),f:"jsonp",page:Math.max(n.currPage,n.requestPage)};$.ajax({url:"https://user.360kuai.com/following/getFollowList",data:s,type:"get",timeout:5e3,dataType:"jsonp",success:function(r){if(t.noData)return;if(r&&r.data&&!r.data.res.length&&n.currPage==1&&n.neverDataCb){n.neverDataCb(t);return}if(r&&r.data&&r.data.res.length){e.beforeCb();var i=t.Source.focus.formatData.call(t,r.data.res);i.length&&t.render(i,e.noRender),setTimeout(function(){e.afterCb(t)},0)}else t.setNoData(e),e.failCb(t);n.currPage++},error:function(){if(n.currPage==1&&n.neverDataCb){n.neverDataCb(t);return}t.setNoData(e),e.failCb(t)}}),n.requestPage++},formatData:function(e){var t=[],n={};for(var r=0,i=e.length;r<i;r++){n=e[r];if(!n.t||!n.f||!n.pcurl||!n.p)continue;t.push({type:"news",liClass:"papi",date:n.p*1e3,title:n.t,from:n.f,url:n.pcurl,source:n.f,covers:n.i?n.i.split("|"):[]})}return t}}},clearUpData:function(e){var t=this,n=[],r={},i;for(var s=0,o=e.length;s<o;s++){i=e[s];var u=i.title,a=t.options,f=i.covers,l="";if(a.guid!=""&&i.zmt&&i.zmt.id&&i.zmt.is_followed&&i.zmt.name&&i.zmt.pic){var c=i.zmt.id,h=i.zmt.is_followed,p=i.zmt.name,d=i.zmt.pic,v=h=="1"?"res-news-flow-button-cancel-follow":"res-news-flow-button-follow",m=h=="1"?"\u5df2\u5173\u6ce8":"\u5173\u6ce8";l='<span class="'+v+'" data-zmt-id="'+c+'" data-zmt-is-followed="'+h+'" data-zmt-name="'+p+'" data-zmt-pic="'+d+'">'+m+"</span>"}r={dataSource:a.source,from:i.from,type:i.type,playCount:i.playCount,source:i.source,title:"",titleLong:u,titleFull:$.trim(NewsFlow.Tools.getTxt(u)),corner:i.corner,covers:[],coversWidth:0,coversHeight:0,liCoversClass:"",url:i.url,date:i.date,liClass:i.liClass+" "+i.type,attr:i.attr,tag:"",followButton:l},$.isNumeric(r.date)&&(r.date="<span>"+NewsFlow.Tools.formatTime(new Date(r.date),"yyyy-MM-dd hh:mm",1).replace(" 00:00","")+"</span>"),r.source&&(r.source='<span style="margin-right:5px">'+r.source+"</span>"),a.isShowTag&&i.tag&&(r.tag='<span class="vertical-line"></span><span class="tag-weak">'+i.tag+"</span>");if(i.type=="atlas"){r.covers=f.slice(0,2),r.coversWidth=a.atlasImg.width,r.coversHeight=a.atlasImg.height;for(var g=0,y=r.covers.length;g<y;g++){var b=NewsFlow.Tools.sslReplace(NewsFlow.Tools.getPicUrl(r.covers[g],"/dmt/"+r.coversWidth+"_"+r.coversHeight+"_"));r.covers[g]={style:' class="anim"',src:b}}r.title=u}else if(f.length>=a.manyImg.count&&!a.onlyShowSingleImg){a.manyImg.isShowCorner||(r.corner=""),r.covers=f.slice(0,a.manyImg.count),r.coversWidth=a.manyImg.width,r.coversHeight=a.manyImg.height;var w=r.coversWidth,E=r.coversHeight;window.devicePixelRatio>=2&&(w*=2,E*=2);for(var g=0,y=r.covers.length;g<y;g++){var b=NewsFlow.Tools.sslReplace(NewsFlow.Tools.getPicUrl(r.covers[g],"/dmt/"+w+"_"+E+"_"));r.covers[g]={style:' class="anim"',src:b}}r.title=u}else if(f.length>0){i.type!=="video"&&(r.corner=""),r.liCoversClass="single-img",r.covers=f.slice(0,1),r.coversWidth=a.singleImg.width,r.coversHeight=a.singleImg.height;var w=r.coversWidth,E=r.coversHeight;window.devicePixelRatio>=2&&(w*=2,E*=2);var b=NewsFlow.Tools.sslReplace(NewsFlow.Tools.getPicUrl(r.covers[0],"/dmt/"+w+"_"+E+"_"));r.covers[0]={style:' class="anim"',src:b},r.title=NewsFlow.Tools.cutStr(u,a.singleImg.titleLength)}else a.onlyShowSingleImg||(r.title=NewsFlow.Tools.cutStr(u,a.noImg.titleLength));r.title=NewsFlow.Tools.unescapeHTML(r.title),n.push(r)}return n},hideLoading:function(){var e=this;e.$loading.hide()},render:function(e,t){var n=this,r=n.options,i=r.eventMark;r.renderBeforeCb(n);if(n.stopRender)return;e=n.clearUpData(e);var s=[];for(var o=0;o<e.length;o++)s.push(NewsFlow.Tools.template(r.template,$.extend(e[o],{tplType:"news"})));n.$flowInner.append(s.join("")),n.activateFollowButton(),n.scrollLoad(),setTimeout(function(){r.renderAfterCb(n),!t&&NewsFlow.Tools.observer.publish(i+".rendered")},0),n.sendLog({type:"flow-ajax"})},getData:function(e){var t=this;t.Source[t.options.source].getData.call(this,e)},setNoData:function(e){var t=this,n=t.options,r=n.$newsFlow.find("li").length;if(t.currRetryGetDataTimes<n.retryGetDataTimes){t.currRetryGetDataTimes++,t.getData(e);return}if(t.noData)return;t.noData=!0,n.noDataCb(t,r),t.hideLoading(),r>0?t.$flowInner.after(NewsFlow.Tools.template(n.template,{tplType:"noData"})):n.$newsFlow.find(".retry").length||(t.$flowInner.after(NewsFlow.Tools.template(n.template,{tplType:"retry"})),n.$newsFlow.find(".loading").hide(),setTimeout(function(){n.$newsFlow.find(".retry a").on("click",function(){n.$newsFlow.find(".retry").remove(),So.comm.pid=="www"?n.$newsFlow.find(".loading.long").show():n.$newsFlow.find(".loading").show(),t.getData(),t.noData=!1})},0))},removeFlow:function(){var e=this,t=e.options;t.removeFlowCb(e);if(t.alwaysShowFlow==1)return;t.$newsFlow.remove()},gotoTop:function(){var e=this;if(!e.options.showGotoTop)return;$(window).scrollTop()>e.options.gotoTopDis?e.$gotoTop.fadeIn():e.$gotoTop.fadeOut()},scrollLoad:function(e){e=e||this;if(e.noData)return;var t=e.options,n=$(window),r=n.height();$(document).height()-n.scrollTop()-r<r&&(e.getData(),t.$newsFlow.find("li").length&&e.$loading.show())},sendLog:function(e){var t=this.options;NewsFlow.Tools.log(t.logMark,$.extend({p1:t.from,p2:t.source,datatype:t.type,abid:t.$newsFlow.attr("data-abtest-id")},e,t.logParam))},eventBind:function(){var e=this,t=e.options,n=$(window),r=t.eventMark,i=t.eventMark.replace(/\./g,""),s=t.$newsFlow,o=t.source,u,a=0;n.off("."+i+"WinScroll").on("scroll."+i+"WinScroll.haosou",function(i){if(!s.is(":visible")||e.noData)return;t.scrollCb(e),t.preventScrollLoad||(clearTimeout(u),u=setTimeout(function(){e.scrollLoad(e)},500)),t.showGotoTop&&e.gotoTop(),NewsFlow.Tools.observer.publish(r+".scroll",n.scrollTop()>a),a=n.scrollTop(),o==="baoDian"&&e.Source[o]&&e.Source[o].showLog&&e.Source[o].showLog(e)}),e.$gotoTop.on("click",function(){e.sendLog({type:"go-top"}),$("html, body").animate({scrollTop:0},300)}).appendTo($("body")),s.on("click",function(t){var n=$(t.target),i=n.closest('li[data-from^="news"]'),o=e.Source[e.options.source];if(!i.length)return;if(i.attr("data-tpl")=="news"){var u=So.newsFlow.$newsFlow.find("li[data-tpl=news]");$.each(u,function(e,t){$(t).attr("data-newsli-idx",e)}),So.newsFlow.clickedLiIdx=parseInt(i.attr("data-newsli-idx"))}if(n.is(".close-list a")){var a=o.closeLog;a&&a(e,i),e.sendLog({type:"close-news",value:n.attr("data-val")}),i.slideUp(100,function(){i.remove(),s.find("li").length||e.removeFlow(),NewsFlow.Tools.observer.publish(r+".flowHeightChange")}),e.addNews()}else if(n.closest("a").length){var f=function(t){e.sendLog({type:t,pos:i.index()+1,p3:i.attr("data-log-extend"),value:n.attr("data-log"),urls:i.find("a:eq(0)").attr("data-mdurl")||i.find("a:eq(0)").attr("href"),viewtype:i.find(".sub-title").text(),source:i.find(".tag").text(),template:i.attr("data-type")})},l=o.clickLog;l&&l(e,i);if(n.is(".desc .tag"))return f("flow-click-tag"),location.href="//www.so.com/s?src=soflow_tag&q="+encodeURIComponent(n.text()),!1;f("flow-click")}}).on("mouseenter","div.close",function(e){$(e.target).closest("li").addClass("curr"),s.find("div.close").removeClass("hover"),s.find(".close-list").remove(),$(this).addClass("hover").append(NewsFlow.Tools.template(t.template,{tplType:"closeList"}))}).on("mouseleave","div.close",function(e){var t=$(this);$(e.target).closest("li").removeClass("curr"),t.removeClass("hover").find(".close-list").remove()}),$("body").on("click",function(e){$(e.target).closest(".flow-follow-guider-tip-container-home1").length||$(".flow-follow-guider-tip-container-home1").remove()})},addNews:function(){var e=this,t=e.options;if(e.noData)return;t.addNewsCb!=$.noop?t.addNewsCb(e):e.scrollLoad()},subscribe:function(){var e=this,t=e.options.eventMark;NewsFlow.Tools.observer.subscribe(t+".addNews",function(){e.addNews()}),NewsFlow.Tools.observer.subscribe(t+".closeFlow",function(){e.removeFlow()})},activateFollowButton:function(){var e=this,t=this.options,n=function(e){var t="fdasof09vni234rk23b498uvo234eo14n123b12v31v23c1y23y1u",n=(new Date).getTime()/1e3,r=So.lib.md5(e+t+n);return n+"|"+r},r=function(e){var t=e.attr("data-isLoading");return typeof t=="undefined"||t=="0"?!1:!0},i=$("span[class^=res-news-flow-button]");if(i.length&&!e.hasSendFollowButtonSrpLog){var s=So.comm.pid=="www"?"news-flow":"homecard";So.lib.log(s,{type:"button-show",p2:t.source}),this.hasSendFollowButtonSrpLog=!0}i.unbind("mouseenter"),i.on("mouseenter",function(){var e=$(this);if(r(e))return!1;if($(".flow-follow-guider-tip-container").length||$(".flow-follow-guider-tip-container-home").length||$(".flow-follow-guider-tip-container-home1").length)return!1;if($(".flow-follow-error-tip-container"
).length)return!1;var t=e.closest("a[data-log='link']"),n=t.attr("title");typeof n!="undefined"&&(t.attr("data-title-temp",n),t.removeAttr("title"))}),i.unbind("mouseleave"),i.on("mouseleave",function(){var e=$(this);if(r(e))return!1;$(".res-news-flow-follow-msg-tip").remove();var t=e.closest("a[data-log='link']"),n=t.attr("data-title-temp");typeof n!="undefined"&&(t.attr("title",n),t.removeAttr("data-title-temp"))}),i.unbind("click"),i.on("click",function(){function a(r){c(e);var i=function(){h(e,r),f(r,0);var n=r==1?2:1;l(s,n),t.guid==""&&So.lib.log("news-flow",{type:"no-uid"})},a=t.preferences.sign||"360_fc624efc";So.comm.pid=="www"&&(a="360_e39369d1");var d={uid:t.guid,asc:t.asc,token:n(t.guid),"do":r,id:s,sign:a,device:2,net:5,scene:1,where:"list",name:o,pic:u,f:"jsonp"};$.ajax({url:"https://user.360kuai.com/following/add",data:d,method:"get",dataType:"jsonp",crossDomain:!0,timeout:2e4,success:function(t){t.data!=r?i():(f(r,1),l(s,r),r==1&&p(e))},error:function(){i()}})}function f(e,t){var n=t==0?"fail ":"",r=e==1?n+"like":n+"notlike",i=So.comm.pid=="www"?"news-flow":"homecard";So.lib.log(i,{type:r,mid:So.lib.getUnMid(So.comm.md||So.lib.cookie.get("__md"))})}function l(e,t){var n=$("span[class^=res-news-flow-][data-zmt-id='"+e+"']");n.attr("data-isLoading",0),t==1?(n.text("\u5df2\u5173\u6ce8"),n.attr("class","res-news-flow-button-cancel-follow"),n.attr("data-zmt-is-followed",1)):(n.text("\u5173\u6ce8"),n.attr("class","res-news-flow-button-follow"),n.attr("data-zmt-is-followed",0))}function c(e){var t=$("<div class='follow-button-loading-div'></div>");e.append(t),e.attr("class","res-news-flow-follow-loading"),e.attr("data-isLoading",1)}function h(e,t){$(".flow-follow-error-tip-container").remove(),errorMsg=t==1?"\u5173\u6ce8\u5931\u8d25\uff0c\u8bf7\u518d\u8bd5\u4e00\u6b21":"\u53d6\u6d88\u5173\u6ce8\u5931\u8d25\uff0c\u8bf7\u518d\u8bd5\u4e00\u6b21";var n=e.closest('li[data-from^="news-"]');n.css({overflow:"visible"});var r=$("<div class='flow-follow-error-tip-container'></div>"),i=$("<div class='tip-left-triangle'></div>"),s=$("<div class='error-tip-msg-panel'>"+errorMsg+"</div>");r.append(i),r.append(s);var o=e.position().top-2,u=e.position().left+48;r.css({top:o,left:u}),n.append(r),setTimeout(function(){n.css({overflow:"hidden"}),$(".flow-follow-error-tip-container").remove()},2e3)}function p(e){var t=So.lib.cookie.get("hasUseFollowBtn");if(typeof t=="undefined"){var n=1e3,r=new Date;r.setTime(r.getTime()+n*24*60*60*1e3);var i={expires:r};So.lib.cookie.set("hasUseFollowBtn",1,i);var s=e.closest('li[data-from^="news-"]');s.css({overflow:"visible"});var o=$("<div class='flow-follow-guider-tip-container'></div>"),u="";if(So.comm.pid=="www"){var a="\u5173\u6ce8\u540e\u53ef\u4ee5\u5728\u5c4f\u5e55\u53f3\u4e0a\u65b9\u201c\u6211\u7684\u5173\u6ce8\u201d\u4e2d\u770b\u5230\u66f4\u65b0\u5185\u5bb9\u5566~",f=$("<div class='tip-left-triangle'></div>"),l=$("<div class='guider-tip-msg-panel'>"+a+"</div>"),c=$("<a href='javascript:;' class='guider-tip-close-button'></a>");o.append(f),o.append(l),o.append(c),u=c}else if(So.comm.pid=="home"){o.attr("class","flow-follow-guider-tip-container-home1");var c=$('<div class="tip-close-btn"></div>');o.append(c),u=c}var h=e.position().top-2,p=e.position().left+48;o.css({top:h,left:p}),s.append(o),c.on("click",function(){s.css({overflow:"hidden"}),o.remove()}),o.show(),setTimeout(function(){s.css({overflow:"hidden"}),o.remove()},1e4)}}$(".flow-follow-guider-tip-container-home1").remove();var e=$(this);if(r(e))return!1;$(".res-news-flow-follow-msg-tip").remove(),$(".flow-follow-guider-tip-container").remove();var i=e.attr("data-zmt-is-followed"),s=e.attr("data-zmt-id"),o=e.attr("data-zmt-name"),u=e.attr("data-zmt-pic");return i==1?a(2):a(1),!1})},initFun:function(){var e=this,t=e.options;e.$flowInner.after(e.$loading),t.initCb(e),e.eventBind(),e.subscribe(),e.sendLog({type:"show"}),t.showGotoTop&&e.$gotoTop.appendTo($("body")),e.activateFollowButton()},init:function(){var e=this,t=So.comm.src;t=="360se_wl_p_home"&&window.broswerExternal?broswerExternal.getData().then(function(t){e.options.curEnc=1,e.options.curTitle=t.title,e.options.curRawUrl=t.url,e.initFun()},function(){e.initFun()}):e.initFun()}}})()}),function(){NewsFlowSad=function(e){var t=this,n={$newsFlow:So.newsFlow.$newsFlow,showId:So.newsFlow.showId,eventMark:So.newsFlow.eventMark,logMark:So.newsFlow.logMark,type:So.newsFlow.type,source:So.newsFlow.source,qcmsData:null,showQcmsData:!1,startPos:So.newsFlow.flowQcms.resultAdStart,step:So.newsFlow.flowQcms.resultAdStep,onlyShowSingleImg:!1,onlyShowSingleManyImg:!1,jumpShow:!0,guid:So.comm.guid,template:"",video:{height:88},bigImg:{width:268,height:88},squareImg:{count:4,width:132,height:132},bannerImg:{width:540,height:64},manyImg:{count:4,width:132,height:88},singleImg:{width:132,height:88,titleLength:100},insertCb:$.noop};t.options=$.extend(!0,{},n,e),t.currPos=t.options.startPos,t.html=[],t.page=1,t.timer,t.timerVideo,t.deck=!0,t.delCount=20,t.mouseDownTime=0,t.mouseUpTime=0,t.stopInsert=!1,t.init()},NewsFlowSad.Tools={checkImg:function(){var e=event.srcElement;$(e).remove(),e.onerror=null},formatSeconds:function(e){var t=[parseInt(e/60/60),parseInt(e/60%60),parseInt(e%60)];return t[0]===0&&t.shift(),t.join(":").replace(/\b(\d)\b/g,"0$1")},log:So.lib.log,cutStr:So.lib.cutStr,template:So.lib.template,observer:So.lib.observer,isVisible:So.lib.isVisible1,soLocalStorage:So.lib.soLocalStorage},NewsFlowSad.prototype={init:function(){var e=this;e.options.showQcmsData&&e.clearUpQcmsData(),e.bindEvent(),e.insert()},bindEvent:function(){var e=this,t=e.options.$newsFlow,n=e.options.eventMark,r;NewsFlowSad.Tools.observer.subscribe(n+".rendered",function(){e.insert(e)}),NewsFlowSad.Tools.observer.subscribe(n+".scroll",function(t){clearTimeout(r),r=setTimeout(function(){e.scrollEevent(e,t)},500)}),t.on("mousedown","li[data-from=sad]",function(){e.mouseDownTime=+(new Date)}).on("mouseup","li[data-from=sad]",function(t){e.mouseUpTime=+(new Date);var n=$(this),r=$(t.target),i=r.closest("a");if(i.length&&i.attr("data-href")){var s=Math.abs(parseInt(r.offset().left-n.offset().left+t.offsetX)),o=Math.abs(parseInt(r.offset().top-n.offset().top+t.offsetY));i.attr("href",e.macro(i.attr("data-href"),s,o,parseInt(n.width()),parseInt(n.outerHeight(!0)))),e.sendAdLog(e.macro(n.data("clktk"),s,o,parseInt(n.width()),parseInt(n.outerHeight(!0)))),e.sendLog({type:"sad-click",pos:n.index()+1,value:r.attr("data-log")})}}).on("click","li[data-from=sad] .close-list a",function(t){var r=$(this).closest("li"),i=$(t.target);r.data("clstk")&&e.sendAdLog(e.macroDel(r.data("clstk"),i.attr("data-val"),i.text())),NewsFlowSad.Tools.observer.publish(n+".addNews"),e.sendLog({type:"close-sad",pos:r.index()+1,value:i.attr("data-val")}),e.delAd(r)}).on("click","li[data-from=sad] .horn",function(n){var r=$(this).closest("li"),i=r.find("video")[0],s=$(n.target);s.hasClass("open")?(s.removeClass("open"),i.muted=!0,e.sendVideoLog(r,"click",n,6)):(t.find(".horn").removeClass("open"),s.addClass("open"),$.each(t.find("video"),function(e,t){t.muted=!0}),i.muted=!1,e.sendVideoLog(r,"click",n,5))}).on("click","li[data-from=sad] .play",function(t){var n=$(this),r=n.closest("li"),i=r.find("video")[0];$(i).attr("data-allowEndedLog",1),e.videoPlayTime(n,i),i.paused?(e.sendVideoLog(r,"start",t),i.play(),n.addClass("paused"),r.removeClass("manual-stop")):(e.sendVideoLog(r,"pause",t),i.pause(),n.removeClass("paused"),r.addClass("manual-stop"))}).on("click","li[data-from=sad]",function(t){var n=$(t.target);!n.closest(".play").length&&!n.closest(".horn").length&&e.sendVideoLog($(this),"click",t,2)}).on("click","li[data-from=sad-qcms]",function(t){var n=$(t.target),r=$(this);n.is(".close-list a")?(e.delAd(r),e.sendLog({type:"close-qcms-sad"})):n.closest("a").length&&e.sendLog({type:"sad-qcms-click",pos:r.index()+1,value:n.attr("data-log")})})},videoPlayTime:function(e,t){t.ontimeupdate=function(){e.find(".time").text(NewsFlowSad.Tools.formatSeconds(Math.floor(t.duration-t.currentTime)))}},calculateAdPos:function(e){var t=this,n=t.options;e?t.currPos=n.startPos:t.currPos=n.$newsFlow.find('li[data-from="sad"]:last').index()+n.step+1},delAd:function(e){var t=this,n=t.options.$newsFlow,r=t.options.eventMark;e.slideUp(100,function(){e.remove(),n.find("li").length||NewsFlowSad.Tools.observer.publish(r+".closeFlow"),NewsFlowSad.Tools.observer.publish(r+".flowHeightChange"),t.calculateAdPos()})},macroDel:function(e,t,n){return e.replace(/__DISLIKE_RULE_ID__|__DISLIKE_TAG__/g,function(e){return{__DISLIKE_RULE_ID__:t,__DISLIKE_TAG__:n}[e]})},macro:function(e,t,n,r,i){var s=this;return e.replace(/__OFFSET_X__|__OFFSET_Y__|__EVENT_TIME_START__|__EVENT_TIME_END__|__ADSPACE_W__|__ADSPACE_H__/g,function(e){return{__OFFSET_X__:t,__OFFSET_Y__:n,__EVENT_TIME_START__:s.mouseDownTime,__EVENT_TIME_END__:s.mouseUpTime,__ADSPACE_W__:r,__ADSPACE_H__:i}[e]})},macroVideo:function(e,t,n,r){var i=this;return e.replace(/__VIDEO_ACTION_ID__|__ADSIZE_TYPE__|__VIDEO_DURATION__|__VIDEO_TIME__/g,function(e){return{__VIDEO_ACTION_ID__:t,__ADSIZE_TYPE__:0,__VIDEO_DURATION__:parseInt(n),__VIDEO_TIME__:parseInt(r)}[e]})},clearUpQcmsData:function(){var e=this,t=e.options,n=t.qcmsData;if(!n)return;var r=NewsFlowSad.Tools.soLocalStorage.getItem("delAd");r=r?JSON.parse(r):[];if(!n||~$.inArray(n.title,r))return;r.push(n.title),NewsFlowSad.Tools.soLocalStorage.setItem("delAd",JSON.stringify(r));var i={from:"sad-qcms",curl:n.curl,isBanner:parseInt(n.isBanner),isShowAd:parseInt(n.isShowAd),title:n.title||"",desc:n.desc||"",src:n.src||""},s=!1;for(var o=0,u=n.imgs.length;o<u;o++)if(n.imgs[o].img==""||n.imgs[o].curl==""){s=!0;break}i.isBanner||s||t.onlyShowSingleImg?i.img=n.imgs[0].img:i.assets=n.imgs;if(i.img||i.assets)e.currPos=parseInt(n.pos);e.sendLog({type:"show-qcms-sad"}),e.clearUpData([i])},sendVideoLog:function(e,t,n,r){var i=this,s=e.find("video"),o=s[0],u="",a="",f={start:"vstarttk",pause:"vpausetk","continue":"vcontitk",complete:"vcomptk",click:"voptk"},l=+s.attr("data-duration")||0;t=="start"&&l&&(t="continue");var c=e.data("video")[f[t]];if(n){var h=$(n.target);u=h?Math.abs(parseInt(h.offset().left-e.offset().left+n.offsetX)):"",a=h?Math.abs(parseInt(h.offset().top-e.offset().top+n.offsetY)):""}s.attr("data-duration",o.currentTime+l),i.sendAdLog(i.macroVideo(i.macro(c,u,a,parseInt(e.width()),parseInt(e.outerHeight(!0))),r?r:"",s.attr("data-duration"),o.currentTime)),s.off("ended").on("ended",function(){s.attr("data-allowEndedLog")==1&&(i.sendVideoLog(e,"complete"),s.attr("data-allowEndedLog",0)),o.play()})},sendLog:function(e){var t=this.options;NewsFlowSad.Tools.log(t.logMark,$.extend({},{abid:t.$newsFlow.attr("data-abtest-id"),datatype:t.type,p2:t.source},e))},sendAdLog:function(e){if(!e)return;e=e.split("||"),window.sadLog={};var t;for(var n=0,r=e.length;n<r;n++)t="log_"+ +(new Date),sadLog[t]=new Image,sadLog[t].onload=sadLog[t].onerror=function(){delete sadLog[t]},sadLog[t].src=e[n]},imptkLog:function(e){e=e||this;var t=e.options;$.each(t.$newsFlow.find('li[data-from="sad"]'),function(t,n){var r=$(n);!r.data("imptked")&&NewsFlowSad.Tools.isVisible(r[0])&&(r.data("imptked",1),e.sendLog({type:"sad-show"}),e.sendAdLog(r.data("imptk")))})},scrollEevent:function(e,t){e=e||this;var n=e.options,r=!1;e.imptkLog(e),clearTimeout(e.timerVideo);var i=n.$newsFlow.find('li[data-from="sad"]');i=t?$(i.get().reverse()):i,e.timerVideo=setTimeout(function(){$.each(i,function(t,n){var i=$(n),s=i.find("video"),o=s[0],u=i.find(".play");if(!i.hasClass("manual-stop")&&s.length){var a=n.getBoundingClientRect();!r&&NewsFlowSad.Tools.isVisible(n)&&a.top>30&&$(window).height()-a.bottom>-100?(o.paused&&e.sendVideoLog(i,"start"),u.addClass("paused"),o.play(),e.videoPlayTime(u,o),r=!0):(!o.paused&&e.sendVideoLog(i,"pause"),u.removeClass("paused"),o.pause())}})},40)},insert:function(e){e=e||this;var t=e.html,n=e.currPos,r=e.options,i=r.step,s=r.$newsFlow;if(e.stopInsert)return;t.length<2&&(clearTimeout(e.timer),e.timer=setTimeout(function(){e.getData(e)},1e3)),s.find("li:not([class*=to-front])").length-(n+1)>=0&&t.length>0&&(s.find("li:not([class*=to-front]):eq("+n+")").before(t.shift()),e.deck&&r.jumpShow?(e.currPos+=i,e.deck=!1):(e.currPos+=i+1,e.deck=!0),e.insert(),e.scrollEevent(e,!1),r.insertCb())},clearUpData:function(e){var t=this,n=t.options,r={};for(var i=0,s=e.length;i<s;i++){var o=e[i].title;r={img:[],imgWidth:0,imgHeight:0,liCoversClass:"",url:e[i].curl,source:e[i].src,title:o,titleFull:o,imptk:e[i].imptk&&e[i].imptk.join("||"),clktk:e[i].clktk&&e[i].clktk.join("||"),clstk:e[i].clstk&&e[i].clstk.join("||"),from:"sad",sadTxt:e[i].src=="360\u641c\u7d22\u63a8\u8350"?"":'<span class="txt">\u5e7f\u544a</span>',type:"",duration:"00:00",videoData:JSON.stringify({vstarttk:e[i].vstarttk&&e[i].vstarttk.join("||")||"",vpausetk:e[i].vpausetk&&e[i].vpausetk.join("||")||"",vcontitk:e[i].vcontitk&&e[i].vcontitk.join("||")||"",vcomptk:e[i].vcomptk&&e[i].vcomptk.join("||")||"",voptk:e[i].voptk&&e[i].voptk.join("||")||""})};if(!n.onlyShowSingleImg&&!n.onlyShowSingleManyImg)switch(e[i].type){case 4:/msie (6|7|8|9)/gi.test(navigator.userAgent)?r.type="bigImg":r.type="video";break;case 3:r.type="bigImg";break;case 2:if(e[i].assets){var u=e[i].assets[0];u&&u.imgw&&u.imgh===u.imgw&&(r.type="squareImg")}}e[i].isShowAd===0&&(r.sadTxt=""),e[i].from&&(r.from=e[i].from,r.liCoversClass=r.from);var a=e[i].assets||[],f=e[i].img||"";if(r.type=="video"&&!n.onlyShowSingleManyImg)r.liCoversClass+=" sad-video",r.imgHeight=n.video.height,e[i].duration&&(r.duration=NewsFlowSad.Tools.formatSeconds(e[i].duration)),f=e[i].video,r.img[0]={style:"",url:r.url,src:f},r.title=NewsFlowSad.Tools.cutStr(o,44);else if(r.type=="bigImg"&&!n.onlyShowSingleManyImg)r.liCoversClass+=" big-img",r.imgWidth=n.bigImg.width,r.imgHeight=n.bigImg.height,f=e[i].img,r.img[0]={style:' class="anim"',url:r.url,src:f},r.title=NewsFlowSad.Tools.cutStr(o,44);else if(r.type=="squareImg"&&a.length>=n.squareImg.count&&!n.onlyShowSingleManyImg){r.liCoversClass+=" square-img",r.imgWidth=n.squareImg.width,r.imgHeight=n.squareImg.height;for(var l=0,c=n.squareImg.count;l<c;l++)r.img[l]={style:' class="anim"',url:a[l].curl,src:a[l].img}}else if(e[i].isBanner)r.liCoversClass+=" banner-img",r.imgWidth=n.bannerImg.width,r.imgHeight=n.bannerImg.height,r.img[0]={style:' class="anim"',url:r.url,src:f};else if(a.length>=n.manyImg.count&&!n.onlyShowSingleImg){r.type="manyImg",r.imgWidth=n.manyImg.width,r.imgHeight=n.manyImg.height;for(var l=0,c=n.manyImg.count;l<c;l++)r.img[l]={style:' class="anim"',url:a[l].curl,src:a[l].img}}else f&&(r.type="singleImg",r.liCoversClass+=" single-img",r.imgWidth=n.singleImg.width,r.imgHeight=n.singleImg.height,r.img[0]={style:' class="anim"',url:r.url,src:f},r.title=NewsFlowSad.Tools.cutStr(o,n.singleImg.titleLength));if(!r.img.length)continue;t.html.push(NewsFlowSad.Tools.template(n.template,$.extend(r,{tplType:"sad"})))}},getData:function(e){var t=8;~$.inArray(So.newsFlow.type,["weather","home","news"])&&So.lib.checkAbv(2432,"cpc_box_2")&&(t=5);var n=e.options;$.ajax({url:location.protocol=="https:"?"//show-g.mediav.com/s?scheme=https":"//show.g.mediav.com/s",type:"get",jsonp:"jsonp",dataType:"jsonp",data:{of:4,type:1,newf:1,impct:t,uid:n.guid,reqtimes:e.page,showid:n.showId,refurl:document.referrer,crec:So.lib.recls().ad,recext:So.lib.cookie.get("recext")},success:function(t){e.page++,t&&t.ads&&t.ads.length>0&&(e.clearUpData(t.ads),e.insert(e))}})},reset:function(e){var t=this;t.currPos=e.currPos,t.options.type=e.type,typeof e.stopInsert!="undefined"&&(t.stopInsert=e.stopInsert),t.bindEvent()}}}(),define("js/news-flow/sad",function(){}),function(){function r(t){So.lib.log("flow-click-recommend",$.extend({_huid:So.lib.cookie.get("__huid")||"",src:e},t))}function i(e){var t=[];return $.each(e.find(".flow-inline-click-rec-wrapper a"),function(n,r){So.lib.isVisible($(r),!1,e.find(".flow-inline-click-rec-wrapper"))&&t.push($(r).text())}),t.join("|")}if(So.lib.browser.isIE())return;var e="";if(So.comm.pid=="home")e="360so_feed_inline";else{var t={news:"360so_hotfeed_inline",weather:"360so_weatherfeed_inline",famous:"360so_personfeed_inline"};e=t[So.newsFlow.type]}var n='<div class="flow-inline-click-rec-wrapper" data-nlpv="<%= nlpv %>" data-ssid="<%= ssid %>">                    <div class="cnxh">\u731c\u4f60\u559c\u6b22\uff1a</div>                    <% for (var i = 0, len = data.length; i < len; i++) { %>                        <a href="//www.so.com/s?src=<%= src %>&nlpv=<%= nlpv %>&q=<%= encodeURIComponent(data[i].query) %>" target="_blank"><%= data[i].query %></a>                    <% } %>                </div>',s=function(){if(So.newsFlow.clickedLiIdx!=undefined&&So.newsFlow.clickedLiIdx!=-1){var t=So.newsFlow.$newsFlow.find("li[data-tpl=news]").eq(So.newsFlow.clickedLiIdx);if(t.find(".flow-inline-click-rec-wrapper").length)return;var s=$(".flow-inline-click-rec-wrapper");s.closest("li").css({"margin-bottom":0}),s.remove();var o=t.find("[data-log=link]").attr("title"),u=t.attr("data-gnid");$.ajax({url:"//api.ssl.so.com/kuaizixun_news_recommend",data:{title:o,gnid:u,src:"srp_newfeed_inline",qid:So.comm.user.qid,asc:So.lib.getASC(),huid:So.lib.cookie.get("__huid")||"",gen:0},method:"get",dataType:"jsonp",success:function(s){if(s.errno!=0||!s.result.length)return;if(t.find(".flow-inline-click-rec-wrapper").length)return;var o=s.result,a=s.nlpv,f=s.ssid,l=$(So.lib.template(n,{data:o,src:e,nlpv:a,ssid:f}));t.append(l);var c=l.outerHeight();l.css({bottom:-c+"px"}),t.css({overflow:"visible","margin-bottom":c+"px"});var h=t.find(".close"),p=h.css("z-index");h.hover(function(){h.css({"z-index":99})},function(){h.css({"z-index":p})});var d=t.find("[data-log=link]").attr("title"),v=t.find("[data-log=link]").attr("data-mdurl")||t.find("[data-log=link]").attr("href");l.find("a").on("mousedown",function(e){var t=$(this),n={type:"click",dataType:t.index(),pos:So.newsFlow.clickedLiIdx+1,p1:d,p2:v,p3:t.text(),value:u,nlpv:a,pssid:f};r(n),e.stopPropagation()});var m={type:"show",dataType:"",pos:So.newsFlow.clickedLiIdx+1,p1:d,p2:v,p3:i(t),value:u,nlpv:a,pssid:f};r(m);var g=$(window).height(),y=$("body").scrollTop()||$("html").scrollTop()||0,b=t.offset().top,w=t.height();if(g-b+y-w<60){var E=So.comm.pid=="home"?330:280;$("html").scrollTop(b-g+E)}}})}};$(document).on("visibilitychange.flowClickRec",function(){document.hidden||s()})}(),define("js/news-flow/flowClickRec",function(){}),define("js/home/card/news-flow",["text!html/news-flow.html!strip","js/news-flow/recommend","js/news-flow/flow","js/news-flow/sad","js/news-flow/flowClickRec"],function(e,t){function g(){var e=l.$gotoTop;if(e.is(":hidden"))return;var t=$("body").hasClass("widescreen")?20:10;e.css({left:i.offset().left+i.width()-s.scrollLeft()+t})}function y(){So.lib.observer.subscribe(a.infoFlowTabFixed,function(e){o=e.isOk});var e;s.on("resize",function(){clearTimeout(e),e=setTimeout(g,50)});var t;s.on("scroll",function(){clearTimeout(t),e=setTimeout(g,50)})}function b(){n.prepend(So.lib.template(e,{tplType:"tab",data:d})).find(".top-tab a").on("click",function(){var e=$(this),t=n.offset().top-76;f=e.attr("data-param"),n.off("click mouseenter mouseleave mousedown mouseup"),r.empty(),v==0&&(E(),f=="mylike"?(C(),N(f)):T(f)),e.addClass("selected").siblings().removeClass("selected"),$("#card_container").css({minHeight:s.height()-100}).find(".retry").remove(),v==0&&(o?s.scrollTop(t):$("html, body").animate({scrollTop:t},500),f!=="mylike"&&So.lib.log("homecard",{type:"click_"+f}))}),$("#res_news_flow .top-tab a.selected").removeClass("selected"),$("#res_news_flow .top-tab a:eq(1)").addClass("selected")}function w(){var e=$(window).height(),t=$("body").scrollTop()||$("html").scrollTop()||0;n.find("li[data-from^=news]").each(function(n,r){var i=$(r),s=i.offset().top,o=i.height();i.attr("data-log-gz")!=="1"&&s<t+e-o&&s-t>90&&(i.find("span[class^='res-news-flow-button-']").length&&So.lib.log("homecard",{type:"has-follow-button",ext:n}),i.attr("data-log-gz","1"))})}function E(){$(".focus-top-txt").remove(),$(".focus-top-title").remove(),$("#goto-top").remove(),$(".no-more").remove(),n.find(".loading").remove()}function S(t){var n={type:t,template:e,manyImg:{width:178,height:113},singleImg:{width:178,height:113}},r;if(So.newsFlow.adsQcmsData.length)for(var i=0;i<So.newsFlow.adsQcmsData.length;i++)if(So.newsFlow.adsQcmsData[i].isHome==1){r=So.newsFlow.adsQcmsData[i];break}c=new NewsFlowSad($.extend({showId:p,step:So.newsFlow.flowQcms.step,startPos:u,onlyShowSingleManyImg:!0,jumpShow:!1,showQcmsData:!0,qcmsData:r},n))}function x(){n.find(".card-loading").remove(),n.find(".loading.short").removeClass("short")}function T(n){var r={type:n,template:e,manyImg:{width:178,height:113},singleImg:{width:178,height:113}};l=new NewsFlow($.extend({debugTxt:"home.card",source:"baoDian",preferences:{Q:So.lib.cookie.get("Q"),T:So.lib.cookie.get("T"),guid:So.comm.guid,qid:So.comm.user.qid,sign:h,sqid:""},initCb:function(e){e.getData(),setTimeout(x,10)},renderAfterCb:function(e){x(),t()}},r)),c.reset({type:n,currPos:So.newsFlow.flowQcms.homeAdStart,stopInsert:!1})}function N(i){var s={type:i,template:e,manyImg:{width:178,height:113},singleImg:{width:178,height:113}};l=new NewsFlow($.extend({debugTxt:"home.card.focus",source:"focus",initCb:function(e){e.getData(),setTimeout(x,10)},renderAfterCb:function(e){x(),n.find(".close").hide(),t()},neverDataCb:function(){E(),r.before('<div class="focus-top-txt">\u60a8\u8fd8\u6ca1\u6709\u5173\u6ce8\u4f5c\u8005<br>\u5efa\u8bae\u60a8\u67e5\u770b\u201c\u70ed\u95e8\u8d44\u8baf\u63a8\u8350\u201d\uff0c\u9047\u89c1\u559c\u6b22\u7684\u5185\u5bb9\u53ef\u4ee5\u70b9\u51fb\u5173\u6ce8\uff5e</div>'),r.before('<div class="focus-top-title">\u70ed\u95e8\u8d44\u8baf\u63a8\u8350</div>'),n.off("click mouseenter mouseleave"),T(i)}},s)),c.reset({type:i,currPos:So.newsFlow.flowQcms.homeAdStart,stopInsert:!0})}function C(){if(m){var e="//user.360kuai.com/following/redDotCTime",t={sign:"360_e39369d1",uid:So.lib.getMid()||So.lib.cookie.get("__guid")||So.comm.guid,f:"jsonp"};So.comm.proxy_ads_conf["kuai_asc"]==1&&(t.uid=So.lib.cookie.get("__guid")||So.comm.guid,t.asc=So.lib.getASC()||""),$.ajax({url:e,data:t,method:"get",dataType:"jsonp",crossDomain:!0,success:function(e){$(".follow_reddot").css({visibility:"hidden"})},error:function(e){}})}So.lib.log("",{type:$("#my_kzx_flow_follow").data("redlike")?"click_red-mylike":"click_mylike",mod:"homecard"})}function k(){i=So.newsFlow.$cardContainer,n=So.newsFlow.$newsFlow,r=n.find("ul"),So.newsFlow.type="home",S(f||d[0].param),T(f||d[0].param),b(),y(),setTimeout(function(){w()},3e3,!0),So.lib.observer.subscribe(So.newsFlow.eventMark+".scroll",function(){w()})}var n,r,i,s=$(window),o=!1,u=So.newsFlow.flowQcms.homeAdStart,a=So.newsFlow.observerEvent,f,l,c,h="360_fc624efc",p="lDwum1";So.comm.src=="360ws_newtab_xhj"?h="360_806235bc":So.comm.src=="360se_wl_p_home"&&(h="360_6b0e5af1",p="5qugx5");var d=[{txt:"\u6211\u7684\u5173\u6ce8",param:"mylike"},{txt:"\u70ed\u70b9",param:"youlike"}],v=!1,m=So.lib.cookie.get("so-like-red")==2&&So.lib.cookie.get("hasUseFollowBtn")==1;return f="youlike",{init:k}}),define("js/home/card/real-news",[],function(){function c(){s.append('<span class="date">'+So.lib.formatTime2(new Date(t[0].updateTime.replace(/-/g,"/")))+"\u66f4\u65b0</span>"),t.length>f&&s.append('<a href="javascript:;" class="change"><span class="g-icon"></span>\u6362\u4e00\u6279</a>'),u=s.find(".change")}function h(i){if(!i){var s;u.off("click.realNew").on("click.realNew",function(){var e=u.find(".g-icon");a++,a==Math.ceil(t.length/f)&&(a=0),p(),e.addClass("re-circle"),clearTimeout(s),s=setTimeout(function(){e.removeClass("re-circle")},500)});var l=0,c;So.lib.observer.subscribe(r.infoFlowClickTab,function(){l=0}),e.off("scroll.realNew").on("scroll.realNew",function(){c=e.scrollTop(),c-l>2e3&&(u.trigger("click"),l=c)})}o.on("click","a",function(){So.lib.log(n,{type:"hotdot"})});var d;$(window).on("resize",function(){clearTimeout(d),setTimeout(function(){a=0,p(),h(!0)},50)})}function p(){$("body").hasClass("widescreen")?f=18:f=9,o.html(So.lib.template(Tpl.list,{data:t,page:a,count:f}))}function d(){if(!t.length){o.html(Tpl.noData);return}i=$("#real_time_news"),s=i.find(".title"),o=i.find(".list"),c(),p(),h()}var e=$(window),t=So.newsFlow.realTimeNewsData,n=So.newsFlow.logMark,r=So.newsFlow.observerEvent,i,s,o,u,a=0,f=9;if(!$("body").hasClass("widescreen")){var l=Math.floor(t.length/9);t.length=l*9}else{var l=Math.floor(t.length/18);t.length=l*18}return Tpl={list:["<% for(var i = page * count, len = (page + 1) * count; i < len; i++){ %>","<% if(!data[i]){ break; } %>",'<%= i % 9 == 0 ? "<div class=wrap>" : "" %>','<div class="item">',"<% if(data[i].ifnew == 2 && i ==0){  %>",'<i class="top"></i>',"<% }else{ %>",'<i class="num<%= (data[0].ifnew == 2 ? i : i + 1) %>"><%= (data[0].ifnew == 2 ? i : i + 1) %></i>',"<% } %>","<% if(data[i].url){ %>",'<a class="g-ellipsis" href="<%= data[i].url.replace("http://www.so.com", "https://www.so.com") %>" target="_blank" title="<%= So.lib.escapeHTML(data[i].title) %>"><%= So.lib.escapeHTML(data[i].title) %></a>',"<% }else{ %>",'<a class="g-ellipsis" href="/s?ie=utf-8&q=<%= encodeURIComponent(So.lib.unescapeHTML(data[i].keyword)) %>&src=home_hot" target="_blank" title="<%= So.lib.escapeHTML(data[i].title) %>"><%= So.lib.escapeHTML(data[i].title) %></a>',"<% } %>","<% if(data[i].face){ %>",'<img src="<%= So.lib.getPicUrl(data[i].face, "/dr/30_30_100") %>">',"<% }else{ %>","<% if(i < 3 && i != 0){ %>","<% if(data[i].rise == 1){ %>",'<span class="hot g-icon"></span>',"<% }else{ %>",'<span class="cold g-icon"></span>',"<% } %>","<% } %>","<% } %>","</div>",'<%= i % 9 == 8 ? "</div>" : "" %>',"<% } %>"].join(""),noData:'<div class="no-data">\u6682\u65e0\u6570\u636e~</div>'},{init:d}}),define("js/home/card/fixed-top",[],function(){function c(){e.width()<1124&&t.hasClass(s)?i.css({left:1124-e.width()-e.scrollLeft()}):i.css({left:""})}function h(){var n=f.find(".top-tab a").first();t.hasClass(l)?n.css({marginLeft:a.offset().left-e.scrollLeft()+21}):n.css({marginLeft:""})}function p(){function m(){t.hasClass(l)&&!v&&(t.removeClass(l),h())}var i,a=0,p,v=!1;So.lib.observer.subscribe(n.infoFlowClickTab,function(){v=!0}),e.on("scroll",function(){p=e.scrollTop(),p>=r.offset().top-21?(t.hasClass(s)||(So.lib.observer.publish(n.searchboxFixed),t.addClass(s),u.fadeIn(500),$("#input").blur()),r.find("#suggest-align").removeClass("sug-border"),r.find(".ac_wrap").hide()):t.hasClass(s)&&(u.hide(),t.removeClass(s),So.lib.observer.publish(n.cancelSearchboxFixed)),c();if(!d())return;p>=f.offset().top-o.height()-20?(So.lib.observer.publish(n.infoFlowTabFixed,{isOk:!0}),a>p?t.hasClass(l)||(t.addClass(l),h(),f.find(".fixed").hide().slideDown(200)):m()):(So.lib.observer.publish(n.infoFlowTabFixed,{isOk:!1}),m()),v=!1,setTimeout(function(){a=p},20)}).on("resize",function(){clearTimeout(i),i=setTimeout(function(){c(),d()&&h()},10)})}function d(){return So.newsFlow.isReadyHotNews&&So.newsFlow.$cardContainer.hasClass("curr-"+So.newsFlow.hotNewsFlag)?(f=So.newsFlow.$newsFlow,a=So.newsFlow.$cardContainer,!0):!1}function v(){i.wrap('<div class="fixed" />').prepend('<div class="fixed-logo" />'),setTimeout(function(){$("#input").focus()},0),o=r.find(".fixed"),r.css({height:r.height()}),u=r.find(".fixed-logo"),c(),d()&&h(),p()}if(!So.lib.soLocalStorage)return;var e=$(window),t=$("body"),n=So.newsFlow.observerEvent,r=$("#bd_search"),i=r.find("form"),s="search-input-fixed",o,u,a,f,l="infoflow-tab-fixed";v()}),function(e,t,n,r){var i={$wrapper:null,$container:e("body"),topDist:0,fixedClass:null,preScrollTop:0},s={$elem:null,options:{},currTopDist:0,innerHeight:0,freezeDist:0,$window:e(t),init:function(t,n){var r=this;r.$elem=e(n),r.options=e.extend({},i,t),r.currTopDist=r.options.topDist,r.freezeDist=r.options.$wrapper.offset().top-r.options.topDist,r.position(),r.$window.on("scroll",function(){r.position()}).on("resize",function(){setTimeout(function(){r.position(r)},60)})},reposition:function(){var e=this,t=e.options.$container.height()+e.options.$container.offset().top,n=t-e.$window.scrollTop(),r=e.currTopDist+e.$elem.height()-n;e.$elem.height()>=e.innerHeight&&r>0&&(e.currTopDist-=r,e.position())},position:function(t){var r=t||this,i=r.$window.scrollTop(),s=r.$window.height(),o=r.options.$container.height(),u={position:"",left:"",top:""},a={height:""};if(r.$elem.outerHeight(!0)>=o){r.$elem.css(u),r.options.$wrapper.css(a),r.$elem.removeClass(r.options.fixedClass);return}r.innerHeight=r.$elem.height(),i<r.freezeDist&&(r.freezeDist=r.options.$wrapper.offset().top-r.options.topDist);if(i>r.freezeDist&&o>r.innerHeight){var f=o+r.options.$container.offset().top;if(r.options.topDist+r.innerHeight>s-(e(n).height()-f))if(r.options.preScrollTop>i)r.currTopDist<=r.options.topDist&&(r.currTopDist=r.currTopDist+(r.options.preScrollTop-i));else{var l=r.currTopDist+r.innerHeight-s;l>0&&(r.currTopDist=r.currTopDist-(i-r.options.preScrollTop));var c=r.currTopDist+r.innerHeight,h=Math.min(f-i,s);l=r.currTopDist+r.innerHeight-s,l<=0&&c!=h&&(r.currTopDist=h-r.innerHeight)}else r.options.preScrollTop>i&&(r.currTopDist=r.currTopDist+(r.options.preScrollTop-i));u={position:So.web.feedback?"":"fixed",left:r.options.$wrapper.offset().left-r.$window.scrollLeft(),top:Math.min(r.currTopDist,r.options.topDist)},r.options.fixedClass&&r.$elem.addClass(r.options.fixedClass),a={height:r.$elem.outerHeight(!0)}}else r.options.fixedClass&&r.$elem.removeClass(r.options.fixedClass),r.currTopDist=r.options.topDist;r.$elem.css(u),r.options.$wrapper.css(a),r.options.preScrollTop=i}};e.fn.freezeSidebar=function(e){if(So.lib.browser.isIE()&&So.lib.browser.isIE()<8)return;Object.create||(Object.create=function(){function e(){}return function(t){if(arguments.length!=1)throw new Error("Object.create implementation only accepts one parameter.");return e.prototype=t,new e}}());var t=Object.create(s);return t.init(e,this),{reposition:function(){t.reposition()}}}}(jQuery,window,document),define("js/jqueryplus/freeze-sidebar",function(){}),define("js/home/card/main",["js/home/card/news-flow","js/home/card/real-news","js/home/card/fixed-top","js/jqueryplus/freeze-sidebar"],function(e,t){function l(){s.append(So.lib.template(f,{cardSwitch:u})),o=$("#card_container"),So.newsFlow.$cardContainer=o,i.addClass("has-card"),u.hotNews&&(o.addClass("curr-"+n.hotNewsFlag),o.find(".hot-news").css({display:"inline-block"}),h())}function h(){if(c)return;c=!0,So.newsFlow.$newsFlow=$("#res_news_flow"),So.newsFlow.$realTimeNews=$("#real_time_news"),So.newsFlow.$cardSide=$("#card_side"),e.init(),t.init(),So.newsFlow.isReadyHotNews=!0,$("#card_side_wrap").freezeSidebar({topDist:85,$container:So.newsFlow.$cardContainer,$wrapper:So.newsFlow.$cardSide})}function p(){var e={mid:So.comm.md};So.lib.observer.subscribe(r.addHotNewsCard,function(){var t=new Date;t.setFullYear(t.getFullYear()+1),So.lib.cookie.set(So.newsFlow.hotNewsFlag,1,{expires:t}),So.lib.cookie.set(So.newsFlow.currNavCookieMark,So.newsFlow.hotNewsFlag),So.lib.log("homecard",$.extend({type:"add-hot-news-card"},e)),location.reload()}),So.lib.observer.subscribe(r.closeHotNewsCard,function(){So.web.closeMask({title:"\u786e\u8ba4\u9690\u85cf\u8d44\u8baf\uff1f",desc:"\u4eb2\uff0c\u9690\u85cf\u8d44\u8baf\u540e\uff0c\u60a8\u5c06\u65e0\u6cd5\u7b2c\u4e00\u65f6\u95f4\u4e86\u89e3\u70ed\u70b9\u5566\u3002\u9690\u85cf\u540e\uff0c\u53ef\u5728\u5c4f\u5e55\u53f3\u4e0a\u89d2\uff0c\u70b9\u51fb\u201c\u663e\u793a\u8d44\u8baf\u201d\u5f00\u542f\u3002",sureTxt:"\u786e\u8ba4\u9690\u85cf",callback:function(){var e=new Date;e.setFullYear(e.getFullYear()+1),So.lib.cookie.set(So.newsFlow.hotNewsFlag,0,{expires:e}),So.lib.log(n.logMark,{type:"sure-close-card"})}}),So.lib.log("homecard",$.extend({type:"close-hot-news-card"},e))})}function d(){o.on("click",".card-close",function(e){So.lib.observer.publish(r.closeHotNewsCard)})}function v(){p();if(So.newsFlow.hotNewsStatus==21&&So.lib.cookie.get(So.newsFlow.hotNewsFlag)=="1"||So.newsFlow.hotNewsStatus!=21){if(So.lib.browser.isIE()&&So.lib.browser.isIE()<9||!u.hotNews)return;l(),d()}}if(!So.lib.soLocalStorage)return;var n=So.newsFlow,r=So.newsFlow.observerEvent,i=$("body"),s=$("#main"),o,u={hotNews:~$.inArray(So.newsFlow.hotNewsStatus,[0,20])?!1:!0};So.comm.flow_ad_show||(u.hotNews=!1);var a='<div class="card-loading"><p><span class="ico"></span>\u52a0\u8f7d\u4e2d...</p></div>',f=['<div id="card_container">','<div class="card-top-line"></div>','<div class="hot-news-card clearfix">','<div id="res_news_flow"><ul></ul>'+a+"</div>",'<div id="card_side">','<div id="card_side_wrap">','<div id="real_time_news">','<p class="title"><i></i></p>','<div class="list">'+a+"</div>",'<a href="//ranks.hao.360.com/?rank=hot&src=so_list" target="_blank" class="more">\u67e5\u770b\u66f4\u591a<i></i></a>',"</div>","</div>"
,"</div>","</div>","</div>"].join(""),c=!1;v()});