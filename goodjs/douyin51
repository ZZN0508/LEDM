"use strict";(self.webpackChunkdouyin_web=self.webpackChunkdouyin_web||[]).push([[2934],{92934:function(e,t,i){i.r(t),i.d(t,{default:function(){return Oe}});var n=i(46306);function r(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function o(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?r(Object(i),!0).forEach((function(t){u(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):r(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,h(n.key),n)}}function l(e,t,i){return t&&c(e.prototype,t),i&&c(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function u(e,t,i){return(t=h(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function h(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}i(36117),i(67519),i(25134),i(49209),i(16279),i(22528),i(49649),i(15837),i(27181),i(53840),i(41620),i(21454),i(49413),i(70873),i(82615),i(98538),i(64987),i(6881),i(61098),i(1348),i(17181),i(18904);var p="undefined"!=typeof window&&window.location.href.indexOf("loggerdebug")>-1;function d(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=0,i=0;i<e.length;i++){var n=e[i].end,r=e[i].begin;Number.isNaN(Number(n))||Number.isNaN(Number(r))||r<0||n<0||n<r||(t+=e[i].end-e[i].begin)}return t=parseInt(1e3*t,10)}function f(e){if(null==e||""===e||"string"!=typeof e)return"";var t=e.split("/"),i="";return t.length>3&&t[2]&&(i=t[2]),i}function g(e){var t={};if(e instanceof window.XMLHttpRequest)try{e.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach((function(e){var i=e.split(": "),n=i.shift(),r=i.join(": ");t[n]=r}))}catch(i){return t}return t}function _(e){for(var t,i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];p&&(t=console).log.apply(t,["[logger]",e].concat(n))}function v(){try{return Math.round(window.performance.now())}catch(e){return(new Date).getTime()}}function y(){return(new Date).getTime()}function m(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((function(i,n){try{e||n(new Error("url is undefined"));var r=v(),o=r,a={},s=new window.XMLHttpRequest;s.open("get",e),s.onreadystatechange=function(){2===s.readyState&&(a.headers=g(s),a.connectTime=v()-o,a.status=s.status,a.statusText=s.statusText,r=v())},s.onload=function(){i(a)},s.onprogress=function(e){var t,i=v()-r;t=parseInt(e.loaded/1e3/(i/1e3),10),a.speed=0|t,a.costTime=i},s.onerror=function(){a.status||(a.status=-1,a.costTime=v()-r),n(a)},s.ontimeout=function(){a.status||(a.status=-2,a.costTime=v()-r),i(a)},s.onabort=function(){i(a)},s.responseType="arraybuffer",s.timeout=t.timeout||1e4,s.setRequestHeader("Range","bytes=".concat(t.range||"0-1048576")),s.send()}catch(c){n(c)}}))}function b(e){return!e||window.location.href.indexOf(e)>-1}function S(e){return!!e&&/^blob:/.test(e)}var w={x_response_sinfo:"x-response-sinfo",x_response_cache:"x-response-cache",x_response_cinfo:"x-response-cinfo"};function E(e){if(!e)return{};var t={};return Object.keys(w).map((function(i){if(e[i]||"string"!=typeof w[i]){if(!e[i]&&w[i]instanceof Array){var n=w[i].filter((function(t){return void 0!==e[t]}));n.length>0?t[i]=e[n[0]]:t[i]=""}}else t[i]=e[w[i]]||""})),t}function k(e){return Object.prototype.toString.call(e).match(/([^\s.*]+)(?=]$)/g)[0]}function T(e,t){if(!e||!t)return!1;try{return Array.prototype.some.call(e.classList,(function(e){return e===t}))}catch(n){var i=e.className&&"object"===a(e.className)?e.getAttribute("class"):e.className;return i&&!!i.match(new RegExp("(\\s|^)".concat(t,"(\\s|$)")))}}function D(e){return"String"===k(e)?e.replace("P","p"):e?"Number"===k(e)?"".concat(e):void 0:""}function I(e){try{return JSON.stringify(e)}catch(t){return""}}var A=0,x=1,O=2;var C=[];"undefined"!=typeof window&&function(){try{new window.PerformanceObserver((function(e){var t=e.getEntriesByType("resource");C.length>30&&C.splice(0,C.length-30);for(var i=0;i<t.length;i++)C.push(t[i])})).observe({entryTypes:["resource"]})}catch(e){}}();var M="videoplayer_oneplay",L="videoplayer_oneopera",G="videoplayer_oneerror",P="videoplayer_oneevent",R="videoplayer_onetemp",B={data:1e3,runtime:1002,parse:1004,network:1003,no_error_handler:9997,custom_error:9998,other:9999,notSupport:1005},z={1:-499991,2:-499992,3:-499993,4:-499994,5:-499995},N=0,V=1,U=2,j=3,$=4,K=0,q=1,W=2,H=3,J=1,F=2,Q=3,Y=4,X=5,Z=6,ee=7,te="error_retry",ie="oneerror",ne="oneevent",re="onetemp",oe=0,ae=1,se=432e5,ce=36e5,le=["tag","subtag","device_type"],ue={NO_FULLSCREEN:0,FULLSCREEN:1,CSS:2};var he=function(){try{return"undefined"!=typeof localStorage&&"setItem"in window.localStorage&&!!window.localStorage.setItem}catch(e){return!1}}()&&!function(){var e="_localstorage_support_test";try{return window.localStorage.setItem(e,!0),window.localStorage.removeItem(e),!1}catch(t){return!0}}()?window.localStorage:{},pe="__xgplayerlogkey",de={set:function(e){try{var t=this.get();t.push(e),he.setItem(pe,JSON.stringify(t))}catch(i){}},get:function(){try{var e=he.getItem(pe);return e=e?JSON.parse(e):[]}catch(t){return[]}},remove:function(){try{he.removeItem(pe)}catch(e){}},clear:function(){try{he.clear()}catch(e){}}},fe=(i(13306),i(78677),[{key:"QQBrowser",reg:/(qqbrowser)\/([\d.]+)/},{key:"QIHU360EE",reg:/qihu 360ee/},{key:"QIHU360SE",reg:/qihu 360se/},{key:"2345Explorer",reg:/(2345explorer)\/([\d.]+)/},{key:"Sogou",reg:/(metasr)/},{key:"Wexin",reg:/(micromessenger)\/([\d.]+)/},{key:"Openlanguage",reg:/(openlanguage)\/([\d.]+)/},{key:"NewsArticle",reg:/(newsarticle)\/([\d.]+)/},{key:"VideoArticle",reg:/(videoarticle)\/([\d.]+)/},{key:"Hotsoon",reg:/(live_stream)_([\d.]+)/},{key:"Aweme",reg:/(aweme)_([\d.]+)/},{key:"Lark",reg:/(lark)\/([\d.]+)/},{key:"PlayStation",reg:/(playstation)/},{key:"BingPreview",reg:/(bingpreview)\/([\d.]+)/},{key:"Baiduspider",reg:/(baiduspider-render)\/([\d.]+)/},{key:"YandexBot",reg:/(yandexbot)\/([\d.]+)/},{key:"Chrome",reg:/(chrome)\/([\d.]+)/},{key:"Safari",reg:/(version)\/([\d.]+)\s*(safari)/}]),ge=[{key:"Trident",reg:/(rv:)([\d.]+)/},{key:"Trident",reg:/(msie)\s*([\d.]+)/}];var _e=["Baiduspider","YandexBot"];var ve="undefined"!=typeof navigator&&function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";e=e.toLocaleLowerCase();var t=/(iphone)/.test(e)||/(ipad)/.test(e),i=/(android)/.test(e),n=/(windows phone)/.test(e),r=t||i||n,o={isIOS:t,isAndroid:i,isMobile:r,isPC:!r,isPad:/(ipad)/.test(e)},a=function(){var e={isSupport:!1,mime:""};if("undefined"==typeof document)return e;var t=document.createElement("video");return"function"==typeof t.canPlayType?(["avc1.42E01E, mp4a.40.2","avc1.58A01E, mp4a.40.2","avc1.4D401E, mp4a.40.2","avc1.64001E, mp4a.40.2","avc1.42E01E","mp4v.20.8","avc1.42E01E, mp4a.40.2","avc1.58A01E, mp4a.40.2","avc1.4D401E, mp4a.40.2","avc1.64001E, mp4a.40.2","mp4v.20.8, mp4a.40.2","mp4v.20.240, mp4a.40.2"].map((function(i){"probably"===t.canPlayType('video/mp4; codecs="'.concat(i,'"'))&&(e.isSupport=!0,e.mime+="||".concat(i))})),e):(t=null,e)}();o.isSupportMP4=a.isSupport,o.mime=a.mime;var s="",c=0,l=[],u=fe;/trident/.test(e)&&(u=ge);for(var h=0;h<u.length;h++)if(l=u[h].reg.exec(e)){s=u[h].key,c=l.length>2?l[2]:"";break}if(s)o["is".concat(s)]=!0,o.name=s,o.appVersion=c;else{var p=function(){var e=navigator.mimeTypes;if(e){for(var t=0;t<e.length;t++){if(e[t].type&&e[t].type.indexOf("360")>-1)return!0;if(e[t].type&&e[t].type.indexOf("application/vnd.chromium.remoting-viewer")>-1)return!0;if(e[t].description&&e[t].description.indexOf("360")>-1)return!0}return!1}}();p&&(o.name="360EE")}return o.name&&"Trident"!==o.name&&/(trident)/.exec(e)&&(o.name=o.name?"".concat(o.name,"_Trident"):"Trident"),o.isSpider=function(e,t){var i=!1;return _e.map((function(t){t===e&&(i=!0)})),/spider/.test(t)&&(i=!0),i}(o.name,e),o}(navigator.userAgent);var ye=[1,1,1,1,1];function me(){return parseInt(ye.join(""),10)}ye[0]=ve.isSupportMP4?ye[1]+1:ye[1],ye[1]="undefined"!=typeof MediaSource&&MediaSource.isTypeSupported&&(MediaSource.isTypeSupported('video/mp4;codecs="hev1.1.6.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.2.4.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.3.E.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.4.10.L120.90"'))?ye[1]+1:ye[1],function(e){var t={supported:!1,smooth:!1,powerEfficient:!1};if(!e||"undefined"==typeof navigator)return Promise.resolve(t);if(navigator.mediaCapabilities&&navigator.mediaCapabilities.decodingInfo)return navigator.mediaCapabilities.decodingInfo(e);var i=e.video||{},n=e.audio||{};try{var r=MediaSource.isTypeSupported(i.contentType),o=MediaSource.isTypeSupported(n.contentType);return Promise.resolve({supported:r&&o,smooth:!1,powerEfficient:!1})}catch(a){return Promise.resolve(t)}}({type:"file",video:{contentType:'video/mp4;codecs="hev1.1.6.L120.90"',width:1920,height:1080,bitrate:1e4,framerate:30}}).then((function(e){e&&e.supported?ye[2]=ye[2]+1:ye[2]=1})).catch((function(){ye[2]=ye[2]-1}));var be={range:"0-1048576",timer:6e4,timeout:15e3},Se=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};s(this,e),Object.keys(be).map((function(e){void 0!==t[e]&&null!==t[e]||(t[e]=be[e])})),this.options=t,this._headers={},this.intervalId=null,this.ishangUp=!1,this._data={contentLength:0,statusText:"",status:-1,speed:0,costTime:0,connectTime:0,contentType:""},this.url=[]}return l(e,[{key:"setData",value:function(e){var t=this;if(Object.keys(e).map((function(i){"headers"!==i&&(t._data[i]=e[i])})),e.headers&&Object.keys(e.headers).length>0){this._headers=E(e.headers),e.headers["content-type"]&&(this._data.contentType=e.headers["content-type"]);var i=(e.headers["content-range"]||"").split("/");i&&i.length>1&&(this._data.contentLength=parseInt(i[1]))}}},{key:"contentLength",get:function(){return this._data.length||0}},{key:"trigger",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"start",n=this.options;this.url=e,!this.url||"start"!==i&&(this.ishangUp||this.intervalId)?_("task>>cant`t trigger url",this.ishangUp,this.intervalId):(_("task>>trigger url ",e),this.ishangUp=!0,this.intervalId&&this.clear(),this.intervalId=setTimeout((function(){t.clear()}),"start"===i?500:n.timer),m(this.url,{range:"start"===i?"0-1024":n.range,timeout:n.timeout}).then((function(e){_("getXhr>>check result ",e),t.setData(e||{}),t.ishangUp=!1})).catch((function(e){_("getXhr>>error ",e),t.ishangUp=!1,t._data.status=-1})))}},{key:"url",get:function(){return this.options.url},set:function(e){e&&(this.options.url=e)}},{key:"serverIp",get:function(){return this._headers.x_response_sinfo||""}},{key:"headers",get:function(){return this._headers||{}}},{key:"status",get:function(){return this._data.status||-1}},{key:"speed",get:function(){return this._data.speed}},{key:"clear",value:function(){clearTimeout(this.intervalId),this.intervalId=null}}]),e}();const we="0.11.34";_("xgVodLogger version is ".concat(we));var Ee,ke=(Ee="Object",function(e){return Object.prototype.toString.call(e)==="[object ".concat(Ee,"]")}),Te=1300,De="__tea_cache_tokens_".concat(Te),Ie="",Ae=null,xe=function(){function e(t,i){var n=this;if(s(this,e),u(this,"initializeUrlLog",(function(e){var t=e&&e.url?e.url:"String"===k(e)?e:"";"String"!==k(t)&&(t=""),n.urlLog={initial_url:t,initial_host:f(t),initial_ip:""}})),u(this,"onXgLogCache",(function(){var e,t=n._getLogCache();t&&(n._templog={vtype:null===(e=n.player)||void 0===e?void 0:e.vtype,log:t},n.onOneTemp())})),u(this,"onDegrade",(function(e){e&&(e.local_time=(new Date).getTime(),n.onOneEvent({end_type:"degrade"},e))})),u(this,"onMediaFormatError",(function(e){n.onOneEvent({end_type:"".concat(e.error_type||"","Error")})})),u(this,"onDrmTypeChange",(function(e){n.addIfExist("drm_type",{drm_type:e},n._options)})),u(this,"onReplayBtnClick",(function(){n.resetLoggerParams()})),u(this,"onBeforeDefinitionChange",(function(){n.resLogs.ldst=v(),n._endType="switch"})),u(this,"onDefinitionChange",(function(e){var t=e.from,i=e.to;n.changeResolution({from:t,to:i,startTime:n.resLogs.ldst,operaType:"switch"}),_("onDefinitionChange from:".concat(t,", to:").concat(i))})),u(this,"onDefiChangeSuccess",(function(){_("onDefinitionChangeSuccess"),n.updateVideoSize(),n.triggerTask("start")})),u(this,"onAbrChange",(function(e){var t=e.prev,i=e.cur,r=e.abrInfo;if(n.player.abrInstance){var o=n.player.abrInstance.eventInfo;_("abrChange",o),o.last_definition=t,o.now_definition=i,n.abrInfo.abr_event_info.video_switch.push(o),n.changeResolution({from:t,to:i,startTime:v(),operaType:"abr_switch",abrInfo:r})}})),u(this,"onAbrPrestallEnd",(function(e){n.abrInfo.abr_user_info.cancel_abr=e?1:0})),u(this,"onTimeUpdate",(function(){var e=n.playlogs,t=n.resLogs,i=n.player;if(n.errorLog.try_err_c=0,e.vt||1!==n.startStep||(e.vt=y(),_("onTimeUpdate: first frame inited","currentTime11:".concat(i.currentTime," vt-pt:").concat(e.vt-e.pt," vt-nt:").concat(e.vt-e.nt," vt-rt:").concat(e.vt-e.rt)),n.startStep=2),!t.initial_resolution){var r=i.currentDefitionFromPlayer&&i.currentDefitionFromPlayer.definition?i.currentDefitionFromPlayer.definition:i.config.defaultDefinition||"".concat(i.video.videoHeight,"p")||0;r=D(r),t.initial_resolution=r}t.final_resolution||(t.final_resolution=t.initial_resolution);var o=e.played.length;o<1?e.played.push({begin:i.currentTime,end:-1}):e.played[o-1].end=i.currentTime;var a=t.played.length;a<1?t.played.push({begin:i.currentTime,end:-1}):t.played[a-1].end=i.currentTime,n.lastVideoTime=i.currentTime||0})),u(this,"onVideoProgress",(function(){n.updateBuffers()})),u(this,"onCanplay",(function(){_("onCanplay","this.startStep:".concat(n.startStep," ").concat(y())),n.setVt()})),u(this,"onLoadeddata",(function(){_("onLoadeddata","this.startStep:".concat(n.startStep," ").concat(y())),n.setVt(),n.updateVideoSize()})),u(this,"onLoadStart",(function(){n.commonParams.web_url=location.href;var e=b(n.player.currentSrc);n.triggerTask("start"),_("onLoadStart","this.startStep:".concat(n.startStep," ").concat(y()," isSrcEmpty:").concat(e," player.src:").concat(n.player.src)),0!==n.startStep||e||"visible"!==document.visibilityState||n.setPt()})),u(this,"onDashStateChange",(function(e){_("onDashStateChange","this.startStep:".concat(n.startStep," ").concat(v()," state:").concat(e));var t=n.playlogs;if(n.startStep<2)switch(e){case"player_start":t.dash_pst=v();break;case"wasm_start":t.dash_wst=v();break;case"wasm_ready":t.dash_wrt=v();break;case"init_finished":t.dash_ift=v();break;case"core_start":t.dash_cst=v();break;case"start_play":t.dash_spt=v()}})),u(this,"onBufferedChange",(function(){var e=n.player.video&&n.player.video.buffered;if(e){var t=e.length;t>0&&e.end(t-1)+1>n.player.duration&&(n.bft=y())}})),u(this,"onPlayerInited",(function(){_("player init"),n._playerCreatedTime=y(),n.playlogs.rt=y()})),u(this,"onNotAutoPlay",(function(){_("onNotAutoPlay","autoplay:".concat(n.isAutoplay)),0===n.isAutoplay?n.isAutoplay=2:1===n.isAutoplay&&(n.isAutoplay=3)})),u(this,"onDashError",(function(e){e=e||{};var t=n.errorLog;t.last_errors.push(e.errorCode),t.accu_errc++,n.onOneError({errorType:e.errorTypeCode,code:e.errorCode,url:e.url||"",headers:e.headers||{}},0)})),u(this,"onPlayerError",(function(e){e=e||{};var t=n.errorLog,i=n.player;if(_("onPlayerError","this.player.type:".concat(n.player.type," this.player.replayRunning:").concat(n.player.replayRunning," isSupportMP4:").concat(ve.isSupportMP4," isPC:").concat(ve.isPC)),_("onPlayerError",e),n.load_state=H,n._endType="error",n.suspendWaitingStatus("onPlayerError"),"dash"!==i.type||!i.replayRunning){if(e.url||(e.url=n.player.currentSrc),ve.isPC&&!ve.isSupportMP4||ve.isSpider)return t.errc=z[5],t.errt=B.notSupport,n.onOneError({errorType:t.errt,code:t.errc,url:e.url,headers:e.headers||{},message:e.message||""},0),void(n._isOnePlayReport=!0);t.errt=e.errorTypeCode||(e.errorType&&B[e.errorType]?B[e.errorType]:9999),e.errorCode?t.errc=e.errorCode>0&&z[e.errorCode]?z[e.errorCode]:e.errorCode:e.code&&(t.errc=e.code>0&&z[e.code]?z[e.code]:e.code),t.last_errors.push(t.errc),0===t.fir_errc&&(t.fir_errc=t.errc),n.onOnePlay(J),n.onOneTemp(J),n.sendDegradeLog("playCatch_end",n.playlogs.degrade);var r=!1,o=e.mediaError;o&&n._options.needXhrCheck&&(4===o.code||2===o)&&(r=!0),n.onOneError({endState:ee,errorType:t.errt,code:t.errc,url:e.url,headers:e.headers||{},message:e.message||""},0,r),n.sendEventsQueue()}})),u(this,"onPlayInterfaceInfo",(function(e){_("onPlayInterfaceInfo",e);var t=n.errorLog,i=n.apiLog,r=n.playlogs;if(e&&Object.keys(e).map((function(t){"code"===t?i.vsc=e[t]:"message"===t?i.vsc_message=e.message||"success\uff0c\u89c6\u9891\u53ef\u6b63\u5e38\u64ad\u653e":i[t]=e[t]})),r.at=e.timestamep||(new Date).getTime(),(!e.error||-9988!==e.error.errc)&&(i.vsc=e.code||10,i.vsc_message=e.message||"success\uff0c\u89c6\u9891\u53ef\u6b63\u5e38\u64ad\u653e",e.error)){var o=e.error;t.errt=1e3,t.errc=o.errc||-9998,t.last_errors.push(o.errc||-9998),0===t.fir_errc&&(t.fir_errc=o.errc||-9998),t.accu_errc++,1===t.accu_errc&&(t.fir_errt=v()),n.onOneError({errorType:1e3,code:o.errc||-9998,url:"",headers:{}})}})),u(this,"onProgressEvent",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=n.netLog;if(e.speed){var i=e.speed>1e6?Math.floor(e.speed/1e3):e.speed;t.downloadSpeed=i,t.totalSpeed+=i,t.rqCount++}"oversize"!==e.type&&t.requestCount++,e.connectTime&&(t.connectCost=e.connectTime);var r=t.rqCount<7?100:e.costTime>=5e3?20:10;if(!("success"===e.type&&parseInt(100*Math.random(),10)<=r)){var a=function(e){var t={};try{e=e.replace(/^http:|^https:/,"");for(var i=C||[],n=function(n){if(i[n].name.replace(/^http:|^https:/,"")===e)return["domainLookupEnd","domainLookupStart","startTime","requestStart","responseEnd","responseStart","connectStart","connectEnd","fetchStart"].map((function(e){t[e]=Math.round(i[n][e])})),t.url=i[n].name,t.duration=Math.round(i[n].duration),t.domainDuration=t.domainLookupEnd-t.domainLookupStart,t.connectDuration=t.connectEnd-t.connectStart,"break"},r=i.length-1;r>=0&&"break"!==n(r);r--);return t}catch(o){return t}}(e.cdnUrl),s=e.xhr||{},c=e.type?"progress_".concat(e.type):"progress",l=e.headers;l||(l=g(s));var u=o(o({},l=E(l)),{},{download_speed:t.downloadSpeed,connect_cost:t.connectCost,c_dur:a.connectDuration||0,d_dur:a.domainDuration||0,r_dur:a.duration||0,rqtt:(new Date).getTime(),x_cache:l.x_response_cache||"",server_ip:l.x_response_sinfo});e.status?t.status=e.status:s&&s instanceof window.XMLHttpRequest&&(t.status=s.status||0),u.status=t.status;var h=e.cdnUrl||e.url;"error"===e.type&&n.merror.cdn.push(o(o({costTime:e.costTime,cur_play_pos:e.pos,cdn_url:h,cdn_host:f(h)},u),l)),n.onOneEvent({costTime:e.costTime,vid:e.vid,end_type:c,cur_play_pos:e.pos,cdn_url:h,cdn_host:f(h)},u,"error"===e.type?0:2)}})),u(this,"onNext",(function(){if(_("onNext:startStep:",n.startStep),n.startStep>0){if(n._reportInvalidVV(F))return;n.onOnePlay(F),n.onOneTemp(F),n.sendEventsQueue()}n.vtype=null,n.playlogs.lc=0,n.resetLoggerParams()})),u(this,"onNextEnded",(function(){var e=n.player,t=n.resLogs,i=D(e.config.defaultDefinition||"");t.initial_resolution=i,t.final_resolution=i})),u(this,"onXgLogWaiting",(function(e){var t=n.playlogs,i=n.resLogs,r=n.stall;if(n._options.checkByInnerLog&&0===e.type){_("onXgLogWaiting",e);var o=e.endType,a=e.costTime,s=e.start,c={download_speed:n.realSpeed,avg_speed:n.avgSpeed,mse_op:n.mp4MseOpLength,mp4_load_range:n.mp4LoadSegmentTimeRange,bitrate:n.curBitrate};if("waitingStart"===e.eventType)return n.onOneEvent({costTime:a,end_type:"waitstart"},c,2),void n.appendStallInfo("start",s);if("waitingEnd"===e.eventType){var l=v();_("onXgLogWaiting>>".concat(o,"|costTime:").concat(a,"  vt:").concat(t.vt)),n.appendStallInfo("end",l,o),t.bc++,n.checkInBuffer(n.player.currentTime)?(t.de_bu_acu_t+=a,t.dbc++):(t.nbc++,t.n_bu_acu_t+=a),i.bc++,t.bu_acu_t+=a,i.bu_acu_t+=a,r.end=n.cur_play_pos,r.cost=a,r.acc+=r.cost,1===r.sc&&(r.endf=n.cur_play_pos),n.onOneEvent({costTime:a,end_type:"waitend"},c,2)}}})),u(this,"onSeeking",(function(){if(!b(n.player.src)){var e=n.resLogs,t=n.playlogs,i=n.player,r=n.seekLog;_("onSeeking","currentTime:".concat(i.currentTime)),0===n.startStep&&n.setPt(),n.suspendWaitingStatus("seek"),n.isSeeking&&n.suspendSeekStatus("seek",!1),n.isSeeking=!0,t.played.push({begin:n.player.currentTime,end:-1}),e.played.push({begin:n.player.currentTime,end:-1}),r.lastSeekStartTime=v(),r.seekBefore=n.lastVideoTime.toString(),r.intervalId=setTimeout((function(){n.isSeeking&&n.suspendSeekStatus("seekTimeout",!0)}),6e4)}})),u(this,"onSeeked",(function(){b(n.player.src)||n.isSeeking&&n.suspendSeekStatus("seeked",!0)})),u(this,"onPlaying",(function(){n.suspendWaitingStatus("play"),n.load_state=q;var e=v();n.pauseLog.isPausing&&(n.pauseLog.isPausing=!1,n.pauseLog.pause_acu_t+=e-n.pauseLog.pause_start)})),u(this,"onPlayCatch",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{errorType:"",errorTypeCode:0,errorCode:0,url:"",headers:{},status:0};if(_("onPlayCatch",e,t),e){switch(e){case"mp42dash":n.vtype="DASH_2";break;case"dash2mp4":n.vtype="MP4_2";break;case"dash1mp4":n.vtype="MP4_1";break;default:n.vtype=e}var i=n.errorLog,r=n.playlogs;n.merror.playCatch.push(o({errc:t.errorCode,errt:t.errorType},t.headers)),n.setBr("playcatch"),i.accu_errc++,i.try_err_c++,i.fir_errc=t.errorCode,t.errorCode&&i.last_errors.push(t.errorCode),n.suspendWaitingStatus("playcatch"),n.sendDegradeLog("playCatch",r.degrade,{cdn_url:t.url}),r.degrade=e,n.onOneError({errorType:t.errorTypeCode,code:t.errorCode,url:t.url||"",status:t.httpCode||t.status,headers:t.headers||{},vid:t.vid||n.vid,preload_hit:t.preloadHit||0,preload_cached:t.preloadCached||0,endState:Z,costTime:t.costTime,message:t.errorMessage||t.message,interval_time:t.timerStep||0},0)}})),u(this,"onMediaExpied",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{errorType:"",errorTypeCode:0,errorCode:0,url:"",headers:{},status:0},t=n.errorLog,i=n.playlogs;_("onMediaExpied",e),n.suspendWaitingStatus("expied"),n.setBr("expied"),t.accu_errc++,t.try_err_c++,t.last_errors.push(e.errorCode),i.at=(new Date).getTime(),n.merror.expied.push(o({errorType:e.errorTypeCode||e.errorType,code:e.errorCode,url:e.url||"",status:e.status},E(e.headers||{}))),n.onOneError({errorType:e.errorTypeCode||e.errorType,code:e.errorCode,url:e.url||"",status:e.status,headers:e.headers||{}},0)})),u(this,"onLog",(function(e){_("onLog",e);var t=e.type;if(delete e.type,t)switch(t){case te:break;case re:n._templog||(n._templog={}),n._templog=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return Object.keys(t).map((function(n){var r,o;e[n]="append"===i?(r=e[n],o=t[n],!r||"string"!=typeof o&&"number"!=typeof o?o:"".concat(r," ").concat(o)):t[n]})),e}(n._templog,e.data,e.action),n._templog.preload_hit&&(n._cacheFile=ae);break;case ie:var i=n.errorLog;i.accu_errc++,i.try_err_c++,n.setBr("mp4error"),i.last_errors.push(e.code),n.onOneError(e,0);break;case ne:var r=function(e,t){var i={ext:e.ext||{},data:{}};return Object.keys(e).map((function(n){t[n]?i.data[t[n]]=e[n]:"ext"!==n&&(i.ext[n]=e[n])})),i}(e,{costTime:"costTime",vid:"vid",end_type:"end_type",pos:"cur_play_pos",cdnUrl:"cdn_url"});r.ext&&["start","end"].map((function(e){r.ext[e]&&(r.ext["ext_".concat(e)]=r.ext[e],delete r.ext[e])})),n.onOneEvent(r.data,r.ext,2)}})),u(this,"onPlay",(function(){_("onPlay","this.startStep :".concat(n.startStep," this.isEnded:").concat(n.isEnded)),n.isEnded&&(n.resetLoggerParams(),n.setPt())})),u(this,"onPause",(function(){_("onPause");var e=n.pauseLog;e.isPausing=!0,e.pause_start=v()})),u(this,"onWaiting",(function(){var e=n._options;n.updateCurBuffer("onWaiting"),e.checkByInnerLog||(_("onWaiting>","isSeeking:".concat(n.isSeeking," startStep:").concat(n.startStep," intervalId:").concat(n.stallIntervalId)),n.isSeeking||0===n.playlogs.vt||n.inWaitingStart>0||(n.stallIntervalId&&(window.clearTimeout(n.stallIntervalId),n.stallIntervalId=null),n.inWaitingStart=v(),n.waitStartTime=n.cur_play_pos,n.stallIntervalId=window.setTimeout((function(){var e=n.stall;_("this.stallIntervalId>>".concat(n.stallIntervalId," cost: ").concat(v()-n.inWaitingStart)),n._endType="wait",n.load_state=W,n.vtype.indexOf("MP4")>-1&&n.player.currentTime>10&&n.task&&(n.triggerTask("waiting",n.initial_url),n.requestCount++),e.start=n.waitStartTime,e.bc++,1===e.bc&&(e.startf=n.waitStartTime),window.clearTimeout(n.stallIntervalId),n.stallIntervalId=null,n.startWaitingStatus(n.inWaitingStart,v()-n.inWaitingStart),n.stallIntervalId=setTimeout((function(){n.inWaitingStart>0&&n.suspendWaitingStatus("timeout")}),6e4)}),200)))})),u(this,"onEnded",(function(){if(n.initial_url){_("onEnded","watchDur:".concat(n.watchDur," vt:").concat(n.vt," pt:").concat(n.pt)),n.isEnded=!0;var e=n.resLogs.df;n.changeResolution({from:e,to:e,startTime:v(),operaType:"leave_switch",endType:"ended"}),n.onOnePlay(Q),n.sendDegradeLog("playCatch_end",n.playlogs.degrade),n.onOneTemp(Q),n.sendEventsQueue(),n.playlogs.lc++}})),u(this,"onUnload",(function(){0!==n.startStep&&n.initial_url&&(n.onOneTemp(Y),n.sendDegradeLog("playCatch_end",n.playlogs.degrade),n._reportInvalidVV(Y)||n.onOnePlay(Y,!0))})),u(this,"onVisibilitychange",(function(){var e=n.playlogs.vt;"visible"===document.visibilityState&&(e||n.setPt())})),u(this,"onDestroy",(function(){_("onDestroy:this.startStep:".concat(n.startStep," initial_url:").concat(n.initial_url," ").concat(!!n.initial_url)),n.onOnePlay(X),n.startStep>0&&n.initial_url&&(n.onOneTemp(X),n.sendDegradeLog("playCatch_end",n.playlogs.degrade));var e=n.resLogs.df;n.changeResolution({from:e,to:e,startTime:v(),operaType:"leave_switch",endType:"destroy"}),n.sendEventsQueue(),ve.isPC?window.removeEventListener("beforeunload",n.onUnload):(ve.isMobile||ve.isPad)&&window.removeEventListener("pagehide",n.onUnload),document.removeEventListener("visibilitychange",n.onVisibilitychange),n.listeners.forEach((function(e){n.player.off(e.evt,e.handler)})),n.clearTimers(),n.player.off("destroy",n.onDestroy),n.task&&n.task.clear()})),u(this,"onOnePlay",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(_("onOnePlay _isOnePlayReport:".concat(n._isOnePlayReport," isLeave: ").concat(t," endState:").concat(e)),!n._isOnePlayReport){var i=n.errorLog,r=n.playlogs,a=n.abrInfo,s=n.resLogs,c=n.player,l=n.apiLog,u=n.pauseLog,h=n.stall,p=n.netLog,d=n.watchDur;n._isOnePlayReport=!0;var f=y(),g=n.getBufferTime(c),v=n.getFrameInfo(),m=n.getPerformance(),b=i.errc;n.setExt();var S=o(o(o(o({local_time:(new Date).getTime(),log_type:"video_playq",plugin_exception:0,player_create_exception:"",v:n.vid,initial_url:n.initial_url,initial_host:n.initial_host,initial_ip:n.curHeaders.x_response_sinfo||0,initial_type:n.initial_type},n.curHeaders),{},{initial_resolution:s.initial_resolution,final_resolution:s.final_resolution,pt:n.pt,prepare_start_time:r.nt,prepare_end_time:r.rt||y(),vt:n.vt,lt:n.lt,lpt:n.lpt,fvt:n.fvt,nvt:n.nvt,bft:n.bft,sc:n.seekLog.sc,sat:n.seekLog.sat,bc:n.bc,dbc:r.dbc||0,nbc:r.nbc||0,video_net_s:n.videoNetworkState,status:n.curStatus,first_buf_startt:h.startf,first_buf_endt:h.endf,lc:r.lc,bu_acu_t:n.bu_acu_t>se?0:n.bu_acu_t,de_bu_acu_t:r.de_bu_acu_t||0,n_bu_acu_t:r.n_bu_acu_t||0,pause_acu_t:u.pause_acu_t,cur_play_pos:n.cur_play_pos,load_state:n.load_state,play_speed:n.playbackRate,playback_state:n.playback_state,end_state:e,watch_dur:d>se?0:d,switch_resolution_c:n.switchResolutionCount,is_start_play_automatically:n.isAutoplay,start_time:n.start_time,finish:n.finish,errt:i.errt,errc:b,vsc:l.vsc,vsc_message:l.vsc_message,api_str:l.api_str,auth:l.auth||l.logid,width:n.videoWidth,height:n.videoHeight,vd:n.vd,video_length:parseInt(g.video,10),audio_length:parseInt(g.audio,10),df:n.resolution,lf:s.lf,play_c:0,player_created_t:n.player_created_t,fir_errt:i.fir_errt,fir_errc:i.fir_errc,lv_method:0,ldst:s.ldst,ldet:s.ldet,is_disable_short_seek:0,mute:n.mute,volume:n.volume,download_speed:n.realSpeed?n.realSpeed:n.task&&n.task.speed?n.task.speed:p.downloadSpeed,avg_speed:n.avgSpeed?n.avgSpeed:p.rqCount>0?parseInt(p.totalSpeed/p.rqCount,10):0,bitrate:n.curBitrate,preload_state:n.preloadState,preload_hit:n.preLoadData.hit||0,preload_cached:n.preLoadData.duration||n.preLoadData.byteLength||0,mdl_req_num:p.requestCount,watingcost:n.watingCost,br:r.br,fbrt:r.fbrt,try_err_c:i.try_err_c,accu_errc:i.accu_errc,dash_pst:n.dash_pst,dash_wst:n.dash_wst,dash_wrt:n.dash_wrt,dash_ift:n.dash_ift,dash_cst:n.dash_cst,dash_spt:n.dash_spt,dash_break:2===c.dashBufferBreak?1:0,merror:I(n.merror),ex:I(n.exInfo),perf:I(m),bufs:I(n.buffers.allBuffer),vs:s.vs,vds:s.vds,vps:s.vps},n.buffers.curBuffer),{},{degrade:r.degrade,cache_file:n._cacheFile},v),{},{fullScreen:n._getFullScreenType()});0!==n.vt&&(S.et=f);var w=n._logstrcache||n._getLogCache();if(0===S.fvt&&w&&(S.log=w,n._logstrcache=null),null!=c&&c.softDecoder&&(S.soft_decoder=c.softDecoder),c&&c.dashState&&(S.dash_state=c.dashState),c.abrInstance){var E=c.abrInstance;if(n.updateAbrInfo(a,E,c.playbackRate),E.getAbrVVStats){var k=E.getAbrVVStats();Object.keys(k).forEach((function(e){S[e]=k[e]}))}}if(a.abr_init_opts=c.config.autoBitrateOpts||{},S.abr_info=I(n.abrInfo),t){var T=!n._options.disableLocalCache;n.reportLog(M,S,T?1:0)}else n.reportLog(M,S)}})),u(this,"onOneEvent",(function(e){var t=e.costTime,i=e.vid,r=e.end_type,a=e.cur_play_pos,s=e.cdn_url,c=e.cdn_host,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},u=arguments.length>2?arguments[2]:void 0;_("onOneEvent",r);var h=n.buffers,p=h.curBuffer,d=h.allBuffer,f=n.getFrameInfo(),g=o(o({local_time:(new Date).getTime(),v:i||n.vid,cost_time:t,end_type:r||n.end_type,cdn_url:s||n.url,cdn_host:c||"",initial_type:n.initial_type,resolution:n.resolution,play_speed:n.playbackRate,first_frame_interval:v()-n.pt,last_switch_interval:n.getLastInterval("lastSwitchStartTime",n.resLogs,!1),last_seek_interval:n.updateSeekPt(!1),last_event_interval:n.getLastInterval("lastEventTime"),cur_play_pos:a||n.cur_play_pos,video_ready_s:n.videoReadyState,video_seeking:n.videoSeeking,video_paused:n.videoPaused,bufs:I(d),retry_count:n._retryCount,at:n.playlogs.at,bc:n.stall.bc,stay_seconds:parseInt(((new Date).getTime()-n.playlogs.at)/1e3,10),preload_state:n.preloadState,preload_hit:n.preLoadData.hit,preload_cached:n.preLoadData.duration||n.preLoadData.byteLength},p),f);r.indexOf("waitend")>=0&&t>3e3&&(g.log=n._getLogCache());var y=n.player,m=y.currentTime,b=y.duration-m;if(r.indexOf("waitstart")>=0&&b<=1){var S=g.local_time,w=g.v,E=g.cost_time,k=g.cdn_url,T=g.first_frame_interval,D=g.cur_play_pos,A=g.video_ready_s,x=g.video_seeking,O=g.video_paused,C=g.bufs,M=g.bc,L=g.preload_hit;n.reportLog(P,o({end_type:"longwait",local_time:S,v:w,cost_time:E,cdn_url:k,first_frame_interval:T,cur_play_pos:D,video_ready_s:A,video_seeking:x,video_paused:O,bufs:C,bc:M,preload_hit:L},p),u)}if("waitstart"===r&&"function"==typeof n._options.getPageFPS){var G=n._options.getPageFPS();g.cur_fps=G.curFPS||0,g.avg_fps=G.avgFPS||0}var R=n.player;R&&R.dashState&&(g.dash_state=n.player.dashState),Object.keys(l).forEach((function(e){g[e]=l[e]})),g.ex=I(n.getPlayerExt()),n.addIfExist("drm_type",n._options,g),n.reportLog(P,g,u)})),u(this,"onOneTemp",(function(){if(_("onOneTemp>>",!n._templog),n._templog){var e=n.player,t=n.playlogs,i=n.pauseLog,r=n.errorLog,a=n.resLogs,s=n.watchDur,c=o(o(o({local_time:(new Date).getTime()},n._templog),{},{v:n.vid,initial_type:n.initial_type,pt:n.pt,vt:n.vt,lt:n.lt,fvt:n.fvt,bc:n.bc,bu_acu_t:n.bu_acu_t>se?0:n.bu_acu_t,pause_acu_t:i.pause_acu_t,cur_play_pos:n.cur_play_pos,watch_dur:s>se?0:s,finish:n.finish,errt:r.errt,errc:r.errc,vd:n.vd,df:n.resolution,lf:a.lf,br:t.br,fbrt:t.fbrt,try_err_c:r.try_err_c,accu_errc:r.accu_errc,dash_break:2===e.dashBufferBreak?1:0,bufs:I(n.buffers.allBuffer),vs:a.vs,vds:a.vds,vps:a.vps},n.buffers.curBuffer),{},{degrade:t.degrade});0!==n.vt&&(c.et=y()),["drm_type","dynamic_type"].forEach((function(e){n.addIfExist(e,n._options,c)})),n.reportLog(R,c,0),n._templog=null}})),this.player=t,void 0===this.player||null===this.player)throw new Error("player is ".concat(this.player));if(i&&i.line_app_id){i.isTask&&(this.task=new Se),this.eventQueue=[],this._instanceCreateTime=(new Date).getTime(),i.codec_type=i.codec_type||"h264",this._envInfo=i.envInfo||{},this._options=i,!this._options.maxQueueCount&&(this._options.maxQueueCount=5),this.line_app_id=parseInt(i.line_app_id,10)||0,this.line_user_id=(i.line_user_id||"").toString(),this.playerCoreVersion=t.version,this.playerVersion=i.playerVersion,this.closeSeekLog=i.closeSeekLog||!1,this.start_time=1e3*(i.start_time||0),this._initial_resolution="",this.__vtype=null,this.__dt="",this.resetLoggerParams();try{this.initializeTracker(),this.sendLocalLog(),this.bindEvt(),_("logger constructor:".concat(this.player.video))}catch(r){}}}return l(e,[{key:"resetLoggerParams",value:function(){_("resetLoggerParams");var e=this.playlogs?this.playlogs.lc:0;this.playlogs={nt:y(),vt:0,rt:this.isEnded?y():0,at:0,pt:0,bu_acu_t:0,bc:0,br:0,fbrt:"",dbc:0,de_bu_acu_t:0,nbc:0,n_bu_acu_t:0,played:[{begin:0,end:-1}],dash_pst:0,dash_wst:0,dash_wrt:0,dash_ift:0,dash_cst:0,dash_spt:0,interruptCount:0,degrade:"none",lc:e},this.degradeLog={bu_acu_t:0,bc:0,watch_dur:0,hasSendEnd:!1},this.buffers={allBuffer:[],curBuffer:{buf_diff:0,buf_s_pos:0,buf_e_pos:0,buf_include:0}},this.netLog={downloadSpeed:0,requestCount:0,connectCost:0,totalSpeed:0,rqCount:0,status:0},this.merror={cdn:[],player:[],playCatch:[],expied:[]},this.exInfo={stall:[]},this._templog=null,this._isOnePlayReport=!1,this.startStep=0,this.bft=0,this.initializeLogDatas(),this.initializeUrlLog()}},{key:"initializeLogDatas",value:function(){this.startStep=0,this.inWaitingStart=0,this.waitStartTime=0,this.lastVideoTime=0,this._endType="",this._retryCount=0,this.lastOperaTime=-1,this.lastEventTime=-1,this.stallIntervalId=null,this.seekLog={intervalId:0,lastSeekStartTime:v(),seekBefore:0,sat:0,sc:0},this.resLogs={lastSwitchStartTime:-1,switch_count:0,abr_switch_count:0,initial_resolution:"",final_resolution:"",ldst:0,ldet:0,df:"",lf:"",played:[],bc:0,bu_acu_t:0,sc:0,sat:0,buf:0,lbuf:0,lplayed:0,vs:0,vds:0,vps:0,vis:0,bitrate:0},this.apiLog={code:0,message:"",logid:"",api:"",auth:"",error:{}},this.errorLog={accu_errc:0,try_err_c:0,errt:0,errc:0,fir_errt:0,fir_errc:ve.isSupportMP4?0:1005,last_errors:[]},this.pauseLog={pause_acu_t:0,isPausing:!1,pause_start:0},this.stall={sc:0,startf:0,endf:0,start:0,end:0,cost:0,acc:0},this._playerCreatedTime=0,this.load_state=K,this.lv_method=6,this.isSeeking=!1,this.isEnded=!1,this.startStep=0,this.isAutoplay=this.player.config&&this.player.config.autoplay?1:0,this.abrInfo={abr_general_info:{},abr_event_info:{video_switch:[],video_stall:[],video_exit:{}},abr_play_info:{start_play_time_ms:0,is_hint:0,playback_info:{internet_speed_record:[],play_bitrate_record:[],buffer_length_record:[],play_speed_record:[]}},abr_user_info:{cancel_abr:0},abr_init_opts:this.player.config.autoBitrateOpts||{}},this._cacheFile=oe}},{key:"initSessionId",value:function(){var e="0";try{e=window.localStorage.getItem(De).web_id||"0"}catch(t){e="0"}this._sessionId=function(e){var t=(new Date).getTime();try{e=parseInt(e)}catch(i){e=0}return t+=e,window.performance&&"function"==typeof window.performance.now&&(t+=window.performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var i=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"===e?i:3&i|8).toString(16)}))}(e),_("sessionId ".concat(this._sessionId))}},{key:"initializeTracker",value:function(){var e=this,t=this._options;if(window.__xgplayer_vod_log__)this.tracker=window.__xgplayer_vod_log__;else{this.tracker=window.__xgplayer_vod_log__=new Ae("tracker");var i=t.channel||"cn",n={app_id:"cn"===(i="va"===i||"sg"===i?i:"cn")?Te:1300===Te?323254:Te,channel:i,log:!1,disable_sdk_monitor:!0};t.channelDomain&&(n.channel_domain=t.channelDomain),n.enable_ab_test=!!t.enableAbTest,this.tracker.init(n)}this.initSessionId();var r=navigator?navigator.hardwareConcurrency:0,o=navigator?navigator.deviceMemory:0;this.commonParams={play_type:0,source_type:"vid",sdk_version:we,pc:this.playerCoreVersion,pv:this.playerVersion,line_app_id:this.line_app_id,line_user_id:this.line_user_id,app_version:t.appVersion||"",platform:ve.isPad?"pad":ve.isMobile?"mobile":"pc",cpu_core:Number(r)||0,memory_size:Number(o)||0,support:me(),webdriver:navigator&&navigator.webdriver?1:0,player_sessionid:this.sessionId,web_url:window.location.href,user_agent:navigator.userAgent},_("commonParams ",this.commonParams);var a={evtParams:this.commonParams,disable_auto_pv:!0};_("Browser.name ",ve.name),!ve.name||ve.isChrome||ve.isSafari||(a.browser=ve.name,ve.appVersion&&(a.browser_version=ve.appVersion)),this.line_user_id&&(a.user_unique_id=this.line_user_id,a.web_id=this.line_user_id),t.referrer&&(a.referrer=t.referrer,a.referrer_host=f(t.referrer)),t.ext&&Object.keys(t.ext).map((function(i){e.exInfo[i]=t.ext[i]})),this.tracker.config(a),this.tracker.start()}},{key:"resetDefiInfo",value:function(){var e=this.resLogs;e.played=[],e.bc=0,e.bu_acu_t=0,e.sc=0,e.sat=0}},{key:"sendLocalLog",value:function(){var e=this,t=de.get();de.remove(),t.map((function(t){Object.keys(t).map((function(i){if(_("sendLocalLog",i,t[i]),e.player){e.player.emit("abLog",i,t[i]);var n=e._options.sendLocalCallback;n&&"function"==typeof n&&n(i,t[i])}e._track(i,t[i])}))}))}},{key:"_track",value:function(e,t){"function"==typeof this.tracker?this.tracker(e,t):this.tracker.event(e,t)}},{key:"bindEvt",value:function(){var e=this;this.listeners=[{evt:"play",handler:this.onPlay},{evt:"playing",handler:this.onPlaying},{evt:"pause",handler:this.onPause},{evt:"waiting",handler:this.onWaiting},{evt:"playInterfaceInfo",handler:this.onPlayInterfaceInfo},{evt:"DRM_ERROR",handler:this.onDashError},{evt:"ended",handler:this.onEnded},{evt:"loadeddata",handler:this.onLoadeddata},{evt:"loadstart",handler:this.onLoadStart},{evt:"canplay",handler:this.onCanplay},{evt:"progress",handler:this.onVideoProgress},{evt:"dashStateChange",handler:this.onDashStateChange},{evt:"autoplay_was_prevented",handler:this.onNotAutoPlay},{evt:"seeking",handler:this.onSeeking},{evt:"seeked",handler:this.onSeeked},{evt:"complete",handler:this.onPlayerInited},{evt:"timeupdate",handler:this.onTimeUpdate},{evt:"bufferedChange",handler:this.onBufferedChange},{evt:"beforeDefinitionChange",handler:this.onBeforeDefinitionChange},{evt:"definitionChange",handler:this.onDefinitionChange},{evt:"definitionChangeSuccess",handler:this.onDefiChangeSuccess},{evt:"drmTypeChange",handler:this.onDrmTypeChange},{evt:"replayBtnClick",handler:this.onReplayBtnClick},{evt:"initialUrl",handler:this.initializeUrlLog},{evt:"ABR_CHANGE",handler:this.onAbrChange},{evt:"playCatch",handler:this.onPlayCatch},{evt:"log",handler:this.onLog},{evt:"ABR_PRESTALL_END",handler:this.onAbrPrestallEnd},{evt:"progress_event",handler:this.onProgressEvent},{evt:"logger_next",handler:this.onNext},{evt:"playnext",handler:this.onNext},{evt:"nextEnded",handler:this.onNextEnded},{evt:"media_format_error",handler:this.onMediaFormatError},{evt:"xglog",handler:this.onXgLogWaiting},{evt:"xglog_cache",handler:this.onXgLogCache},{evt:"degrade",handler:this.onDegrade}];var t=this.player.config.errorKey;_(">>>errorKey",t);var i={evt:"error",handler:this.onPlayerError};t&&(i.evt=t),this.listeners.push(i),this.listeners.forEach((function(t){e.player.on(t.evt,t.handler)})),this.bindUnload()}},{key:"_getLogCache",value:function(){var e,t,i=(null===(e=this.player)||void 0===e?void 0:e.logCache)||(null===(t=this.player)||void 0===t?void 0:t.getLogCache);return this._logstrcache=i,i}},{key:"addIfExist",value:function(e,t,i){if(ke(t)){var n=t[e];!(null==n)&&(i[e]=n)}}},{key:"changeResolution",value:function(e){var t=e.from,i=e.to,n=e.startTime,r=e.operaType,o=e.abrInfo,a=e.endType,s=void 0===a?"":a,c=this.resLogs;t=D(t),i=D(i),c.ldet=v(),c.df=i,c.lf=t,c.final_resolution=i,c.switch_count++;var l=c.ldet-n,u={bc:c.bc,bu_acu_t:c.bu_acu_t,sc:c.sc,sat:c.sat,watch_dur:d(c.played)};o&&(u.abrInfo=o),this.updateVds(),this.resetDefiInfo(),this._options.closeResolutionLog||this.onOneOperator({costTime:l,operaType:r,endType:s,stateBefore:t,stateAfter:i},u,0)}},{key:"getLastInterval",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=t[e],r=v(),o=-1===n?-1:r-n;return i&&(t[e]=r),o}},{key:"updateSeekPt",value:function(e){return this.getLastInterval("lastSeekStartTime",this.seekLog,e)}},{key:"_reportInvalidVV",value:function(e){return!!this._isInvaidVV()&&(this.onOneError({endState:e,errorType:9998,code:-1,url:this.player.currentSrc,headers:{}},0),this._isOnePlayReport=!0,!0)}},{key:"_isInvaidVV",value:function(){return 0===this.vt&&-1===this.curStatus}},{key:"bindUnload",value:function(){ve.isPC?window.addEventListener("beforeunload",this.onUnload):(ve.isMobile||ve.isPad)&&window.addEventListener("pagehide",this.onUnload),document.addEventListener("visibilitychange",this.onVisibilitychange),this.player.once("destroy",this.onDestroy)}},{key:"clearTimers",value:function(){var e=this.seekLog;e.intervalId&&window.clearTimeout(e.intervalId),this.stallIntervalId&&window.clearTimeout(this.stallIntervalId)}},{key:"sendDegradeLog",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"playCatch",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};_("sendDegradeLog",e,t,i);var n=this.degradeLog;if(!(n.hasSendEnd||"playCatch_end"===e&&"none"===t)){"playCatch_end"===e&&(n.hasSendEnd=!0);var r=this.bu_acu_t-n.bu_acu_t;this.onOneEvent({costTime:this.vd,vid:this.vid,end_type:e,cur_play_pos:this.player.currentTime,cdn_url:i.url},o({degrade:t,vt:this.vt,pt:this.pt,fvt:this.fvt,bc:this.bc-n.bc,bu_acu_t:r>se?0:r,watch_dur:this.watchDur-n.watch_dur},i),0)}}},{key:"_getFullScreenType",value:function(){return this.player.isFullscreen?ue.FULLSCREEN_TYPE:this.player.isCssfullScreen?ue.CSS:ue.NO_FULLSCREEN}},{key:"getBufferTime",value:function(e){var t=0,i=0,n=e.video&&e.video.buffered;if(n){for(var r=n.length,o=0,a=0;a<r;a++)o+=n.end(a)-n.start(a);t=i=1e3*o}return{video:t,audio:i}}},{key:"updateAbrInfo",value:function(e,t,i){e.abr_general_info=t.generalInfo,e.abr_event_info.video_exit={local_time_ms:(new Date).getTime(),buffer_length:t.bufferLength,internet_speed:t.downloadSpeed,now_bitrate:t.nowBitrate,play_speed:i},t.getAbrPlayInfo&&(e.abr_play_info=t.getAbrPlayInfo())}},{key:"getPerformance",value:function(){return this.player.performance||{}}},{key:"setExt",value:function(){var e=this,t=this.player.ext||{};t.performance&&delete t.performance,Object.keys(t).map((function(i){"performance"!==i&&(e.exInfo[i]=t[i])}))}},{key:"onOneOperator",value:function(e){var t=e.costTime,i=e.operaType,n=e.stateBefore,r=e.stateAfter,o=e.endType,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,c=this.getLastInterval("lastOperaTime"),l={local_time:(new Date).getTime(),v:this.vid,opera_type:i,state_before:n,state_after:r,cost_time:t,end_type:o||this.end_type,cdn_url:this.url,resolution:this.resolution,last_interval:c,bufs:I(this.buffers.allBuffer),cur_play_pos:this.cur_play_pos,retry_count:this._retryCount},u=this.player;u&&u.dashState&&(l.dash_state=this.player.dashState),Object.keys(a).forEach((function(e){l[e]=a[e]})),this.addIfExist("drm_type",this._options,l),this.reportLog(L,l,s)}},{key:"onOneError",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{errorType:0,code:0,url:"",headers:{},costTime:0,vid:"",message:"",preload_hit:0,preload_cached:0,interval_time:0},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];_("onOneError",t);var r=this.errorLog,a=this.apiLog,s=this.resLogs,c=this.player,l=this.playlogs,u=E(t.headers||{}),h=this.getPerformance(),p=t.code>0?0-t.code:t.code;this.setExt();var d=o(o(o({v:t.vid||this.vid,video_pos:this.cur_play_pos,local_time:(new Date).getTime(),cost_time:t&&t.costTime?t.costTime:0,errt:t.errorType,errc:p,es:this.es,cdn_url:t.url||this.url,bufs:I(this.buffers.allBuffer),resolution:s.final_resolution,last_errors:r.last_errors.join(";"),vsc:a.vsc,vsc_message:t.message||a.vsc_message,server_ip:u.x_response_sinfo||0,initial_url:this.initial_url,initial_host:this.initial_host},u),{},{cur_play_pos:this.cur_play_pos},this.buffers.curBuffer),{},{degrade:l.degrade,end_state:t.endState||J,preload_hit:t.preload_hit||0,preload_cached:t.preload_cached||0,ex:I(this.exInfo),pref:I(h),video_ready_s:this.videoReadyState,interval_time:t.interval_time||0});c&&c.dashState&&(d.dash_state=c.dashState);var f=this.player.currentSrc,g=S(f)?S(t.url)?this.initial_url:t.url:f,v={connectTime:0,status:0,statusText:"",isexpired:0,isBlob:S(f)?1:0};if(n&&"String"===k(g)){var y={};m(g,{range:"0-8",timeout:2e3}).then((function(e){_("getXhr>>check result ",e);var t=E(e.headers||{});d.server_ip=t.x_response_sinfo,y=o(o({},v),{},{statusText:e.statusText||"",status:e.status||0,connectTime:0|e.connectTime,sinfo:t.x_response_sinfo||"",cinfo:t.x_response_cinfo||""})})).catch((function(e){y=o(o({},v),{},{statusText:-2===e.status?"timeout":"error",status:e.status})})).finally((function(){var t=function(e){if(!e||"String"!==k(e))return 0;var t=0;try{var i=new RegExp("(\\?|&)x-tos-expires=([^&]*)(&|$)"),n=e.match(i);if(null!==n)t=parseInt(n[2],10);else{var r=e.split("/");r.length>5&&8===r[4].length&&(t=parseInt(r[4],16))}return t>0?t<parseInt((new Date).getTime()/1e3,10)?x:O:A}catch(o){return A}}(g);y.isexpired=t,d.net=I(y),e.reportLog(G,d,i)}))}else d.net=I(v),this.reportLog(G,d,i)}},{key:"reportLog",value:function(t,i,n){var r=this,o=this._options,a=this.player.ABTestTag,s=this.commonParams;i.dynamic_type=this.dynamicType;var c="Array"===k(o.absdkVersion)?o.absdkVersion.join(","):o.absdkVersion;i.absdkVersion=c||e.AB_SDK_VERSION,null!=a&&(i.abtest_tag=a);var l=this._options;if(i.codec_type=this.codecType,ke(l)&&(le.forEach((function(e){r.addIfExist(e,l,i)})),Object.keys(s).forEach((function(e){r.addIfExist(e,s,i)})),i.vtype=this.vtype),i.env_info=I(this._envInfo||{}),i.support=me(),i.visible="undefined"==typeof document?0:"visible"===document.visibilityState?1:0,1===n){var u={};return u[t]=i,void de.set(u)}2!==n?(this.player&&this.player.emit("abLog",t,i),this._track(t,i)):this.addEventsQueue(t,i)}},{key:"addEventsQueue",value:function(e,t){this.eventQueue.push({event:e,params:t}),this.eventQueue.length>=this._options.maxQueueCount&&this.sendEventsQueue()}},{key:"sendEventsQueue",value:function(){for(;this.eventQueue.length>0;){var e=this.eventQueue.pop();this._track(e.event,e.params)}}},{key:"startWaitingStatus",value:function(e,t){this.appendStallInfo("start",e),this.updateCurBuffer("startWaitingStatus"),this.onOneEvent({costTime:t,end_type:"waitstart"},{},2)}},{key:"triggerTask",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"start",t=arguments.length>1?arguments[1]:void 0;_("triggerTask>>",e),!b(t=t||this.player.src)&&this.vtype.indexOf("MP4")>-1&&this.task&&this.task.trigger(t,e)}},{key:"appendStallInfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"start",t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;this.exInfo.stall||(this.exInfo.stall=[]);var n=this.exInfo.stall;if("start"===e){n.length>6&&n.splice(0,n.length-6);var r=this.buffers.curBuffer;n.push({start:t,end:-1,endType:"waitstart",cost:0,cur:this.cur_play_pos,buf_s:r.buf_s_pos,buf_e:r.buf_e_pos,buf_i:r.buf_include})}else if("end"===e){var o=n.length-1;if(o<0)return;n[o].end<0&&(n[o].end=t,n[o].endType=i,n[o].cost=t-n[o].start)}_("appendStallInfo",n)}},{key:"suspendWaitingStatus",value:function(e){var t=v(),i=this.playlogs,n=this.resLogs,r=this.stall,o=this.inWaitingStart;if(!(o<=0||this.isSeeking||i.vt<=0)){if(_("suspendWaitingStatus>>".concat(e,"|costTime:").concat(t-o," isSeeking:").concat(this.isSeeking)),this.appendStallInfo("end",t,e),t-o>200){var a=t-this.inWaitingStart;if(i.bc++,this.checkInBuffer(this.player.currentTime)?(i.de_bu_acu_t+=a,i.dbc++):(i.nbc++,i.n_bu_acu_t+=a),n.bc++,i.bu_acu_t+=a,n.bu_acu_t+=a,r.end=this.cur_play_pos,r.cost=a,r.acc+=r.cost,1===r.sc&&(r.endf=this.cur_play_pos),this.player.abrInstance&&!this.isSeeking&&this.playlogs.vt){var s=this.player.abrInstance;this.abrInfo.abr_event_info.video_stall.push({local_time_ms:(new Date).getTime(),stall_duration:parseFloat((a/1e3).toFixed(2)),buffer_length:s.bufferLength,internet_speed:s.downloadSpeed,now_bitrate:s.nowBitrate,play_speed:this.player.playbackRate,is_abr:s.isCurrentInAbr?1:0})}this.onOneEvent({costTime:a,end_type:"waitend_".concat(e)||0},{},2)}this._endType="",this.load_state=q,this.inWaitingStart=0,this.waitStartTime=0,window.clearTimeout(this.stallIntervalId),this.stallIntervalId=null}}},{key:"suspendSeekStatus",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.isSeeking){var i=this.seekLog,n=this.resLogs,r=this.player,o=v()-i.lastSeekStartTime;_("suspendSeekStatus>>","".concat(e," currentTime:").concat(r.currentTime," costTime:").concat(o," sat:").concat(i.sat," resLogs.sat:").concat(n.sat)),i.intervalId&&window.clearTimeout(i.intervalId),i.intervalId=null,this.isSeeking=!1;var a=this._endType="seek",s=i.seekBefore,c=(r.currentTime||0).toString();i.sc++,i.sat+=o>ce?0:o,n.sc++,n.sat+=o>ce?0:o,this.updateSeekPt(!0),!this.closeSeekLog&&t&&this.onOneOperator({costTime:o,operaType:a,stateBefore:s,stateAfter:c,endType:e})}}},{key:"setPt",value:function(){var e=this.playlogs;this.startStep=1,!e.pt&&this.player.currentTime&&(this.isSeeking=!0),e.pt||(e.pt=y(),_("setPt","init pt :".concat(e.pt,", document.visibilityState:").concat(document.visibilityState)))}},{key:"setVt",value:function(){var e=this.playlogs;1===this.startStep&&(e.vt||(e.vt=y(),_("setVt: first frame inited","vt-pt:".concat(e.vt-e.pt," vt-nt:").concat(e.vt-e.nt))),this.startStep=2)}},{key:"setBr",value:function(e){var t=this.playlogs;t.vt>0&&(0===t.br&&(t.fbrt=e||""),t.br++)}},{key:"codecType",get:function(){var e=this.player;return e&&e.config&&e.config.codecType?e.config.codecType:this._options.codec_type||"h264"}},{key:"url",get:function(){var e=this.player;return e&&e.config?e.config.url:""}},{key:"vid",get:function(){var e=this.player;return e&&e.config?e.config.vid:""}},{key:"bc",get:function(){return this.playlogs.bc}},{key:"bu_acu_t",get:function(){return this.playlogs.bu_acu_t}},{key:"pt",get:function(){return this.playlogs.pt||y()}},{key:"vt",get:function(){var e=this.playlogs,t=e.vt;return e.pt>0?t:0}},{key:"fvt",get:function(){var e=this.playlogs,t=e.vt,i=e.pt,n=0;return t>0&&i>0&&(n=parseInt(t-i,10)),n>6e4?6e4:n}},{key:"nvt",get:function(){var e=this.playlogs,t=e.vt,i=e.nt;return t>0&&i>0?parseInt(t-i,10):0}},{key:"dash_pst",get:function(){return this.playlogs.dash_pst}},{key:"dash_wst",get:function(){return this.playlogs.dash_wst}},{key:"dash_wrt",get:function(){return this.playlogs.dash_wrt}},{key:"dash_ift",get:function(){return this.playlogs.dash_ift}},{key:"dash_cst",get:function(){return this.playlogs.dash_cst}},{key:"dash_spt",get:function(){return this.playlogs.dash_spt}},{key:"getFrameInfo",value:function(){if(this.player&&this.player.videoFrameInfo){var e=this.player.videoFrameInfo,t=e.dropped,i=e.corrupted,n=e.droppedRate;return{f_total:e.total,drop_count:t,drop_rate:parseInt(100*n,10),corrupted:i}}return{f_total:0,drop_count:0,drop_rate:0,corrupted:0}}},{key:"vd",get:function(){var e=this.player;return e.duration&&"number"==typeof e.duration&&e.duration>0?parseInt(1e3*e.duration,10):e.config.duration&&"number"==typeof e.config.duration?parseInt(1e3*e.config.duration,10):0}},{key:"cur_play_pos",get:function(){return parseInt(1e3*this.player.currentTime,10)}},{key:"volume",get:function(){return this.player.volume}},{key:"buffer_time",get:function(){var e=0;try{var t=this.player.getBufferedRange();e=t[1]-t[0]}catch(i){e=0}return e}},{key:"player_created_t",get:function(){return this._playerCreatedTime}},{key:"playbackRate",get:function(){return this.player.playbackRate}},{key:"mute",get:function(){return this.player.muted?0:1}},{key:"videoWidth",get:function(){var e=this.player;return e&&e.video?e.video.videoWidth:0}},{key:"videoHeight",get:function(){var e=this.player;return e&&e.video?e.video.videoHeight:0}},{key:"preload",get:function(){var e=this.player;return!(!e||!e.video)&&e.video.preload}},{key:"initial_url",get:function(){var e=this.player.currentSrc;return e.indexOf("blob:")>-1&&this.urlLog.initial_url?this.urlLog.initial_url:b(e)?"":e}},{key:"initial_host",get:function(){var e=this.player.currentSrc;return e.indexOf("blob:")>-1&&this.urlLog.initial_host?this.urlLog.initial_host:f(b(e)?"":e)}},{key:"curHeaders",get:function(){var e=this.player,t=this.task;return e&&e.__dash__&&e.__dash__.curReqVideoSegInfo?E(e.__dash__.curReqVideoSegInfo.headers||{}):t?t.headers:{}}},{key:"curStatus",get:function(){var e=this.task,t=this.vtype,i=this.netLog;return t.indexOf("MP4")>-1?e?e.status:0:i.status}},{key:"play_type",get:function(){return 0}},{key:"resolution",get:function(){var e=this.player.curDefinition;return e?"".concat(e.definition):this.resLogs.df}},{key:"sessionId",get:function(){return this._sessionId}},{key:"finish",get:function(){return this.isEnded?1:0}},{key:"end_type",get:function(){return this._endType}},{key:"avgSpeed",get:function(){return this.player&&this.player.avgSpeed?this.player.avgSpeed:0}},{key:"realSpeed",get:function(){return this.player&&this.player.realTimeSpeed?this.player.realTimeSpeed:0}},{key:"mp4MseOpLength",get:function(){if(!this.player||!this.player.plugins)return-1;var e=this.player.plugins.mp4encryptplayer;return e?e.opQueueLen||0:-1}},{key:"mp4LoadSegmentTimeRange",get:function(){if(!this.player||!this.player.plugins)return"";var e=this.player.plugins.mp4encryptplayer;return e?e.loadSegmentTimeRange.join(","):""}},{key:"preLoadData",get:function(){if(!this.player||!this.player.plugins)return[];var e=this.player.plugins.mp4encryptplayer;if(e&&e.preLoadData)return{hit:1,duration:e.preLoadData.duration,length:e.preLoadData.byteLength};var t=this.player.stat||{};if(t.preLoadData){var i=t.preLoadData.length;return{hit:i>0,length:i}}return{hit:0,duration:0,length:0}}},{key:"preloadState",get:function(){if(!this.player||!this.player.plugins)return 0;if("undefined"!=typeof this.player.preloadState)return this.player.preloadState||0;var e=this.player.plugins.mp4encryptplayer;return e&&e.preloadState?e.preloadState:0}},{key:"curBitrate",get:function(){var e=this.player,t=e.config,i=e.curDefinition;return i&&i.bitrate?i.bitrate:t.defaultBitrate?t.defaultBitrate:0}},{key:"videoReadyState",get:function(){var e=this.player;return e&&e.video?e.video.readyState:-1}},{key:"videoSeeking",get:function(){var e=this.player;return e&&e.video&&e.video.seeking?1:0}},{key:"videoPaused",get:function(){var e=this.player;return e&&e.video&&e.video.paused?1:0}},{key:"switchResolutionCount",get:function(){return this.resLogs.switch_count}},{key:"isError",get:function(){return this.player._isError||this.player.video.error}},{key:"isPlaying",get:function(){return T(this.player.root,"xgplayer-playing")}},{key:"isStop",get:function(){return T(this.player.root,"xgplayer-ended")||T(this.player.root,"xgplayer-nostart")}},{key:"isPause",get:function(){return T(this.player.root,"xgplayer-pause")}},{key:"isLoading",get:function(){return T(this.player.root,"xgplayer-isloading")}},{key:"es",get:function(){return this.isPlaying?"playing":"beforePlay"}},{key:"lt",get:function(){var e=0;return 0===this.vt&&(_("lt init",this.playlogs.lt),e=y()),e}},{key:"lpt",get:function(){return this.lt?this.lt-this.pt:0}},{key:"playback_state",get:function(){return this.isError?j:this.isStop?N:this.isPause?U:this.isLoading?$:V}},{key:"is_start_play_automatically",get:function(){return"".concat(this.isAutoplay)}},{key:"watchDur",get:function(){var e=this.player,t=this.playlogs,i=e.cumulateTime?e.cumulateTime:d(t.played);return i>=0?i:0}},{key:"vtype",get:function(){if(this.__vtype)return this.__vtype;var e=this.player?this.player.vtype||this.player.config.vtype:"";return e||(this.player.dash?"DASH":this._options.vtype||"MP4")},set:function(e){this.__vtype=e}},{key:"envInfo",get:function(){return this._envInfo},set:function(e){e&&(this._envInfo=e)}},{key:"getPlayerExt",value:function(){var e=this.player.ext;if(e)return e}},{key:"watingCost",get:function(){if(this.inWaitingStart>0){var e=v()-this.inWaitingStart;return e>ce?0:e}return 0}},{key:"videoNetworkState",get:function(){var e=this.player;return e&&e.video?e.video.networkState:-1}},{key:"eagleid",get:function(){var e=this.player;return e&&e.__dash__&&e.__dash__.curReqVideoSegInfo?(e.__dash__.curReqVideoSegInfo.headers||{}).eagleid:""}},{key:"initial_type",get:function(){var e=this.player.config||{};return e&&e.vodLogOpts&&void 0!==e.vodLogOpts.currentDashType?parseInt(e.vodLogOpts.currentDashType,10):-1}},{key:"dynamicType",get:function(){var e=this.player;return this.__dt?this.__dt:e&&e.__dash__&&e.__dash__.dash&&e.__dash__.dash.mpd?(this.__dt=e.__dash__.dash.mpd.dashType,this.__dt):""}},{key:"updateBuffers",value:function(){var e=this.player.buffered,t=[];if(!e||e.length<1)this.buffers.allBuffer=[];else{for(var i=0;i<e.length;i++){var n=parseInt(1e3*e.start(i),10),r=parseInt(1e3*e.end(i),10);t.push({s:n,e:r})}this.buffers.allBuffer=t}}},{key:"updateCurBuffer",value:function(e){var t=this.player,i=t.buffered,n=t.currentTime,r={buf_s_pos:0,buf_e_pos:0,buf_include:0,buf_diff:0};if(!i||i.length<1)return r;for(var o=-1,a=-1,s=parseInt(1e3*n,10),c=i.length-1;c>-1;c--){var l=parseInt(1e3*i.start(c),10),u=parseInt(1e3*i.end(c),10);if(s>=l&&s<=u){r.buf_include=1,r.buf_s_pos=l,r.buf_e_pos=u,r.buf_diff=u-s;break}s<l&&(o<0||l-s<o)?(o=l-s,a=c):s>u&&(o<0||s-u<o)&&(o=s-u,a=c)}1!==r.buf_include&&(a<0&&(a=i.length-1),r.buf_s_pos=parseInt(1e3*i.start(a),10),r.buf_e_pos=parseInt(1e3*i.end(a),10)),this.buffers.curBuffer=r}},{key:"checkInBuffer",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=this.player.buffered;if(!i)return!1;e=parseInt(1e3*e,10);for(var n=0;n<i.length;n++){var r=parseInt(1e3*i.start(n),10)+t,o=parseInt(1e3*i.end(n),10)+t;if(e>r&&e<o)return!0}return!1}},{key:"updateVideoSize",value:function(){var e=this._options,t=this.player,i=this.resLogs,n=0,r=0;if(t.__dash__&&t.__dash__.dash&&t.__dash__.dash.mpd.mediaList){var o=t.__dash__.dash.mpd.mediaList.video,a=o[o.selectedIdx];_("updateVideoSize\u300b\u300bvideoItem",a),r=a?a.bitrate||a.bandwidth:0,n=a?a.size:0}else{var s=this.player.curDefinition;s?(r=s.bitrate||t.config.bitrate||0,n=parseInt(s.bitrate*t.duration/8,10)):(n=e.videoSize||t.config.videoSize||0,r=e.bitrate||t.config.bitrate||0)}_("updateVideoSize","bitrate:".concat(r,", vs:").concat(n)),n&&(i.vs=n,i.vis=parseInt(n/t.duration,10),i.bitrate=r||i.vis)}},{key:"updateVds",value:function(){var e=this.resLogs,t=this.playlogs,i=this.player;if(0!==e.vis){for(var n=parseInt(d(t.played)/1e3,10),r=i.buffered,o=0,a=0;a<r.length;a++)o+=parseInt(r.end(a)-r.start(a),10);_("updateVds","pdur:".concat(n," bdur:").concat(o," \n         lbuf:").concat(e.lbuf," lplayed:").concat(e.lplayed," bitrate: ").concat(e.bitrate," vis:").concat(e.vis," vs:").concat(e.vs)),e.vps+=parseInt((n-e.lplayed)*e.vis,10),e.vds+=parseInt((o-e.lbuf)*e.vis,10),e.lplayed=n,e.lbuf=o}else _("updateVds","vis:".concat(e.vis))}}],[{key:"TEA_ID",get:function(){return Te},set:function(e){De="__tea_cache_tokens_".concat(Te=e)}},{key:"AB_SDK_VERSION",get:function(){return Ie},set:function(e){Ie="Array"===k(e)?e.join(","):e}},{key:"Collector",set:function(e){Ae=e}},{key:"defaultConfig",value:function(){return{line_app_id:"",line_user_id:"",isTask:!1,codec_type:"",playerCoreVersion:"",playerVersion:"",start_time:0,maxQueueCount:5,channel:"cn",channelDomain:"",absdkVersion:"",checkByInnerLog:!0,drm_type:0,vtype:"MP4",tag:"\u666e\u901a\u89c6\u9891",subtag:"",dynamic_type:"",sendLocalCallback:function(){},disableLocalCache:!1,closeResolutionLog:!1,closeSeekLog:!1,needXhrCheck:!1,envInfo:{}}}}]),e}();function Oe(e){if(e&&e.player){var t=e.player.config.vodLogOpts||{};e.player.vodLogger=new xe(e.player,t),e.player.plugins.xgVodLogger=e.player.vodLogger}else this.vodLogger=new xe(this,this.config.vodLogOpts||{})}xe.TEA_ID=1300,xe.Collector=n.Collector,Oe.pluginName="__xgVodLogger",Oe.playerConfig={},Oe.Collector=n.Collector,Oe.setABSdkVersion=function(e){xe.AB_SDK_VERSION=e}},46306:function(e,t,i){i.r(t),i.d(t,{Collector:function(){return at}});var n=function(){return(n=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function r(e){var t="function"==typeof Symbol&&e[Symbol.iterator],i=0;return t?t.call(e):{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}}}function o(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var n,r,o=i.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(e){r={error:e}}finally{try{n&&!n.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}return a}function a(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(o(arguments[t]));return e}var s,c=function(){function e(){this._hooks={},this._cache=[],this._hooksCache={}}return e.prototype.on=function(e,t){e&&t&&"function"==typeof t&&(this._hooks[e]||(this._hooks[e]=[]),this._hooks[e].push(t))},e.prototype.once=function(e,t){var i=this;e&&t&&"function"==typeof t&&this.on(e,(function n(r){t(r),i.off(e,n)}))},e.prototype.off=function(e,t){if(e&&this._hooks[e]&&this._hooks[e].length)if(t){var i=this._hooks[e].indexOf(t);-1!==i&&this._hooks[e].splice(i,1)}else this._hooks[e]=[]},e.prototype.emit=function(e,t,i){if(i){if(!e)return;-1!==this._cache.indexOf(i)?this._emit(e,t):(this._hooksCache.hasOwnProperty(i)||(this._hooksCache[i]={}),this._hooksCache[i].hasOwnProperty(e)||(this._hooksCache[i][e]=[]),this._hooksCache[i][e].push(t))}else this._emit(e,t)},e.prototype._emit=function(e,t){e&&this._hooks[e]&&this._hooks[e].length&&a(this._hooks[e]).forEach((function(e){try{e(t)}catch(e){}}))},e.prototype.set=function(e){e&&-1===this._cache.indexOf(e)&&this._cache.push(e)},e}(),l=function(e){return null!=e&&"[object Object]"==Object.prototype.toString.call(e)},u=function(e){return Array.isArray(e)},h=(s=+Date.now()+Number((""+Math.random()).slice(2,8)),function(){return s+=1}),p=function(e){return function(e,t,i){if("string"==typeof e&&"number"==typeof i){var n,r=[];i=i<=25?i:i%25;var o=String.fromCharCode(i+97);n=e.split(o);for(var a=0;a<n.length;a++){var s=parseInt(n[a],i);s=1*s^64;var c=String.fromCharCode(s);r.push(c)}return r.join("")}}(e,0,25)},d=function(e){navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)?window.addEventListener("pagehide",e,!1):window.addEventListener("beforeunload",e,!1)},f=function(e,t,i){var n=document.createElement("script");n.src=e,n.onerror=function(){i(e)},n.onload=function(){t()},document.getElementsByTagName("head")[0].appendChild(n)},g=function(){var e=0;return["hidden","msHidden","webkitHidden"].forEach((function(t){void 0!==document[t]&&(e=1)})),e},_=function(e){var t=document.createElement("a");return t.href=e,t},v=function(e){var t={};try{var i=_(e).search;if(!i)return t;(i=i.slice(1)).split("&").forEach((function(e){var i,n,r=e.split("=");r.length&&(i=r[0],n=r[1]);try{t[i]=decodeURIComponent(void 0===n?"":n)}catch(e){t[i]=n}}))}catch(e){}return t},y=function(e){for(var t=0,i=0,n=(e+="").length,r=0;r<n;r++)((t=31*t+e.charCodeAt(i++))>0x7fffffffffff||t<-0x800000000000)&&(t&=0xffffffffffff);return t<0&&(t+=0x7ffffffffffff),t};function m(e,t){return e(t={exports:{}},t.exports),t.exports}"undefined"!=typeof window||"undefined"!=typeof window?window:"undefined"!=typeof self&&self;var b,S,w=m((function(e,t){var i;i=function(){function e(){for(var e=0,t={};e<arguments.length;e++){var i=arguments[e];for(var n in i)t[n]=i[n]}return t}function t(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function i(n){function r(){}function o(t,i,o){if("undefined"!=typeof document){"number"==typeof(o=e({path:"/"},r.defaults,o)).expires&&(o.expires=new Date(1*new Date+864e5*o.expires)),o.expires=o.expires?o.expires.toUTCString():"";try{var a=JSON.stringify(i);/^[\{\[]/.test(a)&&(i=a)}catch(e){}i=n.write?n.write(i,t):encodeURIComponent(String(i)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var s="";for(var c in o)o[c]&&(s+="; "+c,!0!==o[c]&&(s+="="+o[c].split(";")[0]));return document.cookie=t+"="+i+s}}function a(e,i){if("undefined"!=typeof document){for(var r={},o=document.cookie?document.cookie.split("; "):[],a=0;a<o.length;a++){var s=o[a].split("="),c=s.slice(1).join("=");i||'"'!==c.charAt(0)||(c=c.slice(1,-1));try{var l=t(s[0]);if(c=(n.read||n)(c,l)||t(c),i)try{c=JSON.parse(c)}catch(e){}if(r[l]=c,e===l)break}catch(e){}}return e?r[e]:r}}return r.set=o,r.get=function(e){return a(e,!1)},r.getJSON=function(e){return a(e,!0)},r.remove=function(t,i){o(t,"",e(i,{expires:-1}))},r.defaults={},r.withConverter=i,r}((function(){}))},e.exports=i()})),E=function(e,t){try{return e?w.get(e,{domain:t||document.domain}):w.get()}catch(e){return""}},k=function(e,t,i,n){try{var r=n||document.domain,o=+new Date+(i||6048e5);w.set(e,t,{expires:new Date(o),path:"/",domain:r})}catch(e){}},T=function(){function e(){this.cache={}}return e.prototype.setItem=function(e,t){this.cache[e]=t},e.prototype.getItem=function(e){return this.cache[e]},e.prototype.removeItem=function(e){this.cache[e]=void 0},e.prototype.getCookie=function(e,t){return E(e,t)},e.prototype.setCookie=function(e,t,i,n){k(e,t,i,n)},e}(),D={getItem:function(e){try{var t=localStorage.getItem(e),i=t;try{t&&"string"==typeof t&&(i=JSON.parse(t))}catch(e){}return i||{}}catch(e){}return{}},setItem:function(e,t){try{var i="string"==typeof t?t:JSON.stringify(t);localStorage.setItem(e,i)}catch(e){}},removeItem:function(e){try{localStorage.removeItem(e)}catch(e){}},getCookie:function(e,t){return E(e,t)},setCookie:function(e,t,i,n){k(e,t,i,n)},isSupportLS:function(){try{return localStorage.setItem("_ranger-test-key","hi"),localStorage.getItem("_ranger-test-key"),localStorage.removeItem("_ranger-test-key"),!0}catch(n){return!1}}()},I={getItem:function(e){try{var t=sessionStorage.getItem(e),i=t;try{t&&"string"==typeof t&&(i=JSON.parse(t))}catch(e){}return i||{}}catch(e){}return{}},setItem:function(e,t){try{var i="string"==typeof t?t:JSON.stringify(t);sessionStorage.setItem(e,i)}catch(e){}},removeItem:function(e){try{sessionStorage.removeItem(e)}catch(e){}},getCookie:function(e,t){return E(e,t)},setCookie:function(e,t,i,n){k(e,t,i,n)},isSupportSession:function(){try{return sessionStorage.setItem("_ranger-test-key","hi"),sessionStorage.getItem("_ranger-test-key"),sessionStorage.removeItem("_ranger-test-key"),!0}catch(n){return!1}}()},A=function(){function e(e,t){this._storage=t&&"session"===t?I:!e&&D.isSupportLS?D:new T}return e.prototype.getItem=function(e){return this._storage.getItem(e)},e.prototype.setItem=function(e,t){this._storage.setItem(e,t)},e.prototype.getCookie=function(e,t){return this._storage.getCookie(e,t)},e.prototype.setCookie=function(e,t,i,n){this._storage.setCookie(e,t,i,n)},e.prototype.removeItem=function(e){this._storage.removeItem(e)},e}(),x=function(){function e(e,t,i){this.appid=e,this.domain=t,this.userAgent=window.navigator.userAgent,this.appVersion=window.navigator.appVersion,this.cookie_expire=i}return e.prototype.init=function(){var e=window.navigator.userAgent,t=window.navigator.language,i=document.referrer,n=i?_(i).hostname:"",r=v(window.location.href),o=/Mobile|htc|mini|Android|iP(ad|od|hone)/.test(this.appVersion)?"wap":"web";this.utm=function(e,t,i,n){var r=new A(!1),o=new A(!1,"session"),a=e?"_tea_utm_cache_"+e:"_tea_utm_cache",s=e?"_$utm_from_url_"+e:"_$utm_from_url",c={},l=["tr_shareuser","tr_admaster","tr_param1","tr_param2","tr_param3","tr_param4","$utm_from_url"],u={ad_id:Number(t.ad_id)||void 0,campaign_id:Number(t.campaign_id)||void 0,creative_id:Number(t.creative_id)||void 0,utm_source:t.utm_source,utm_medium:t.utm_medium,utm_campaign:t.utm_campaign,utm_term:t.utm_term,utm_content:t.utm_content,tr_shareuser:t.tr_shareuser,tr_admaster:t.tr_admaster,tr_param1:t.tr_param1,tr_param2:t.tr_param2,tr_param3:t.tr_param3,tr_param4:t.tr_param4};try{var h=!1;for(var p in u)u[p]&&(-1!==l.indexOf(p)?(c.hasOwnProperty("tracer_data")||(c.tracer_data={}),c.tracer_data[p]=u[p]):c[p]=u[p],h=!0);if(h)o.setItem(s,"1"),r.setCookie(a,JSON.stringify(c),n,i);else{var d=r.getCookie(a,i);d&&(c=JSON.parse(d))}o.getItem(s)&&(c.hasOwnProperty("tracer_data")||(c.tracer_data={}),c.tracer_data.$utm_from_url=1)}catch(e){return u}return c}(this.appid,r,this.domain,this.cookie_expire);var a=this.browser(),s=this.os();return{browser:a.browser,browser_version:a.browser_version,platform:o,os_name:s.os_name,os_version:s.os_version,userAgent:e,screen_width:window.screen&&window.screen.width,screen_height:window.screen&&window.screen.height,device_model:this.getDeviceModel(s.os_name),language:t,referrer:i,referrer_host:n,utm:this.utm,latest_data:this.last(i,n)}},e.prototype.last=function(e,t){var i="",n="",r="",o=location.hostname,a=!1;if(e&&t&&o!==t){i=e,n=t,a=!0;var s=v(e);s.keyword&&(r=s.keyword)}return{$latest_referrer:i,$latest_referrer_host:n,$latest_search_keyword:r,isLast:a}},e.prototype.browser=function(){var e,t,i="",n=""+parseFloat(this.appVersion),r=this.userAgent;return-1!==r.indexOf("Edge")||-1!==r.indexOf("Edg")?(i="Microsoft Edge",-1!==r.indexOf("Edge")?(e=r.indexOf("Edge"),n=r.substring(e+5)):(e=r.indexOf("Edg"),n=r.substring(e+4))):-1!==(e=r.indexOf("MSIE"))?(i="Microsoft Internet Explorer",n=r.substring(e+5)):-1!==(e=r.indexOf("Lark"))?(i="Lark",n=r.substring(e+5,e+11)):-1!==(e=r.indexOf("MetaSr"))?(i="sougoubrowser",n=r.substring(e+7,e+10)):-1!==r.indexOf("MQQBrowser")||-1!==r.indexOf("QQBrowser")?(i="qqbrowser",-1!==r.indexOf("MQQBrowser")?(e=r.indexOf("MQQBrowser"),n=r.substring(e+11,e+15)):-1!==r.indexOf("QQBrowser")&&(e=r.indexOf("QQBrowser"),n=r.substring(e+10,e+17))):-1!==r.indexOf("Chrome")?-1!==(e=r.indexOf("MicroMessenger"))?(i="weixin",n=r.substring(e+15,e+20)):-1!==(e=r.indexOf("360"))?(i="360browser",n=r.substring(r.indexOf("Chrome")+7)):-1!==r.indexOf("baidubrowser")||-1!==r.indexOf("BIDUBrowser")?(-1!==r.indexOf("baidubrowser")?(e=r.indexOf("baidubrowser"),n=r.substring(e+13,e+16)):-1!==r.indexOf("BIDUBrowser")&&(e=r.indexOf("BIDUBrowser"),n=r.substring(e+12,e+15)),i="baidubrowser"):-1!==(e=r.indexOf("xiaomi"))?-1!==r.indexOf("openlanguagexiaomi")?(i="openlanguage xiaomi",n=r.substring(e+7,e+13)):(i="xiaomi",n=r.substring(e-7,e-1)):-1!==(e=r.indexOf("TTWebView"))?(i="TTWebView",n=r.substring(e+10,e+23)):(-1!==(e=r.indexOf("Chrome"))||-1!==(e=r.indexOf("Chrome")))&&(i="Chrome",n=r.substring(e+7)):-1!==r.indexOf("Safari")?-1!==(e=r.indexOf("QQ"))?(i="qqbrowser",n=r.substring(e+10,e+16)):-1!==(e=r.indexOf("Safari"))&&(i="Safari",n=r.substring(e+7),-1!==(e=r.indexOf("Version"))&&(n=r.substring(e+8))):-1!==(e=r.indexOf("Firefox"))?(i="Firefox",n=r.substring(e+8)):-1!==(e=r.indexOf("MicroMessenger"))?(i="weixin",n=r.substring(e+15,e+20)):-1!==(e=r.indexOf("QQ"))&&(i="qqbrowser",n=r.substring(e+3,e+8)),-1!==(t=n.indexOf(";"))&&(n=n.substring(0,t)),-1!==(t=n.indexOf(" "))&&(n=n.substring(0,t)),-1!==(t=n.indexOf(")"))&&(n=n.substring(0,t)),{browser:i,browser_version:n}},e.prototype.os=function(){for(var e="",t="",i=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0|Windows NT 10.1)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Android",r:/Android/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/}],n=0;n<i.length;n++){var r=i[n];if(r.r.test(this.userAgent)){"Mac OS X"===(e=r.s)&&this.isNewIpad()&&(e="iOS");break}}var o,a,s=function(e,t){var i=e.exec(t);return i&&i[1]?i[1]:""},c=function(e,t){var i=RegExp("(?:^|[^A-Z0-9-_]|[^A-Z0-9-]_|sprd-)(?:"+e+")","i").exec(t);return i?i.slice(1)[0]:""};switch(/Windows/.test(e)&&(t=s(/Windows (.*)/,e),e="windows"),e){case"Mac OS X":t=c("Mac[ +]OS[ +]X(?:[ /](?:Version )?(\\d+(?:[_\\.]\\d+)+))?",this.userAgent),e="mac";break;case"Android":(a=s(/Android ([\.\_\d]+)/,o=this.userAgent))||(a=s(/Android\/([\.\_\d]+)/,o)),t=a,e="android";break;case"iOS":t=this.isNewIpad()?c("Mac[ +]OS[ +]X(?:[ /](?:Version )?(\\d+(?:[_\\.]\\d+)+))?",this.userAgent):(t=/OS (\d+)_(\d+)_?(\d+)?/.exec(this.appVersion))?t[1]+"."+t[2]+"."+(0|t[3]):"",e="ios"}return{os_name:e,os_version:t}},e.prototype.getDeviceModel=function(e){var t="";try{if("android"===e)navigator.userAgent.split(";").forEach((function(e){e.indexOf("Build/")>-1&&(t=e.slice(0,e.indexOf("Build/")))}));else if("ios"===e||"mac"===e||"windows"===e)if(this.isNewIpad())t="iPad";else{var i=navigator.userAgent.replace("Mozilla/5.0 (",""),n=i.indexOf(";");t=i.slice(0,n)}}catch(e){return t.trim()}return t.trim()},e.prototype.isNewIpad=function(){return void 0!==this.userAgent&&"MacIntel"===navigator.platform&&"number"==typeof navigator.maxTouchPoints&&navigator.maxTouchPoints>1},e}(),O={cn:"1fz22z22z1nz21z4mz4bz4bz22z1mz19z1jz1mz1ez4az1az22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k",va:"1fz22z22z1nz21z4mz4bz4bz22z1mz19z1jz1mz1ez4az1gz22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k",sg:"1fz22z22z1nz21z4mz4bz4bz22z1mz19z1jz1mz1ez4az22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k"},C={cn:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z4az28z1gz1hz1gz1cz18z1nz1gz4az1az1mz1k",sg:"1fz22z22z1nz21z4mz4bz4bz21z1ez18z1jz1gz49z1kz1az21z4az19z27z22z1cz1mz24z1cz20z21z1cz18z4az1az1mz1k",va:"1fz22z22z1nz21z4mz4bz4bz1kz18z1jz1gz24z18z49z1kz1az21z4az19z27z22z1cz1mz24z1cz20z21z1cz18z4az1az1mz1k"},M="5.0.47",L=function(){function e(e,t){this.collector=e,this.config=t,this.eventNameWhiteList=["__bav_page","__bav_beat","__bav_page_statistics","__bav_click","__bav_page_exposure"],this.paramsNameWhiteList=["$inactive","$inline","$target_uuid_list","$source_uuid","$is_spider","$source_id","$is_first_time","_staging_flag"],this.regStr=new RegExp("^[a-zA-Z0-9][a-z0-9A-Z_.-]{1,255}$")}return e.prototype.checkVerify=function(e){var t=this;if(!e||!e.length)return!1;var i=e[0];if(!i)return!1;var n=i.events,r=i.header;if(!n||!n.length)return!1;var o=!0;return n.forEach((function(e){if(!e)return o=!1,void(e.checkEvent="\u4e8b\u4ef6\u5f02\u5e38");t.checkEventName(e.event)||(o=!1,e.checkEvent="\u4e8b\u4ef6\u540d\u4e0d\u80fd\u4ee5 $ or __\u5f00\u5934"),t.checkEventParams(e.params)||(o=!1,e.checkParams="\u5c5e\u6027\u540d\u4e0d\u80fd\u4ee5 $ or __\u5f00\u5934")})),this.checkEventParams(r)||(o=!1),o},e.prototype.checkEventName=function(e){return!!e&&this.calculate(e,"event")},e.prototype.checkEventParams=function(e){var t=e;if("string"==typeof e&&(t=JSON.parse(t)),!Object.keys(t).length)return!0;for(var i in t)return!(!this.calculate(i,"params")||"string"==typeof t[i]&&t[i].length>1024);return!0},e.prototype.calculate=function(e,t){return-1!==("event"===t?this.eventNameWhiteList:this.paramsNameWhiteList).indexOf(e)||!new RegExp("^\\$").test(e)&&!new RegExp("^__").test(e)||!1},e}();!function(e){e.Init="init",e.Config="config",e.Start="start",e.Ready="ready",e.UnReady="un-ready",e.TokenComplete="token-complete",e.TokenStorage="token-storage",e.TokenFetch="token-fetch",e.TokenError="token-error",e.ConfigUuid="config-uuid",e.ConfigWebId="config-webid",e.ConfigDomain="config-domain",e.CustomWebId="custom-webid",e.TokenChange="token-change",e.TokenReset="token-reset",e.ConfigTransform="config-transform",e.EnvTransform="env-transform",e.SessionReset="session-reset",e.SessionResetTime="session-reset-time",e.Event="event",e.Events="events",e.EventNow="event-now",e.CleanEvents="clean-events",e.BeconEvent="becon-event",e.SubmitBefore="submit-before",e.SubmitScuess="submit-scuess",e.SubmitAfter="submit-after",e.SubmitError="submit-error",e.SubmitVerify="submit-verify",e.Stay="stay",e.ResetStay="reset-stay",e.StayReady="stay-ready",e.SetStay="set-stay",e.RouteChange="route-change",e.RouteReady="route-ready",e.Ab="ab",e.AbVar="ab-var",e.AbAllVars="ab-all-vars",e.AbConfig="ab-config",e.AbExternalVersion="ab-external-version",e.AbVersionChangeOn="ab-version-change-on",e.AbVersionChangeOff="ab-version-change-off",e.AbOpenLayer="ab-open-layer",e.AbCloseLayer="ab-close-layer",e.AbReady="ab-ready",e.AbComplete="ab-complete",e.AbTimeout="ab-timeout",e.Profile="profile",e.ProfileSet="profile-set",e.ProfileSetOnce="profile-set-once",e.ProfileUnset="profile-unset",e.ProfileIncrement="profile-increment",e.ProfileAppend="profile-append",e.ProfileClear="profile-clear",e.Autotrack="autotrack",e.AutotrackReady="autotrack-ready",e.CepReady="cep-ready",e.TracerReady="tracer-ready",e.sessionRecord="session-record",e.SessionRecordStart="session-record-start",e.SessionRecordPause="session-record-pause",e.SessionRecordEnd="session-record-end",e.SessionRecordReport="session-record-report"}(b||(b={})),function(e){e.DEBUGGER_MESSAGE="debugger-message",e.DEBUGGER_MESSAGE_SDK="debugger-message-sdk",e.DEBUGGER_MESSAGE_FETCH="debugger-message-fetch",e.DEBUGGER_MESSAGE_FETCH_RESULT="debugger-message-fetch-result",e.DEBUGGER_MESSAGE_EVENT="debugger-message-event",e.DEVTOOL_WEB_READY="devtool-web-ready"}(S||(S={}));var G=b,P=void 0,R=(new Date).getTimezoneOffset(),B=parseInt(""+-R/60,10),z=60*R,N=function(){function e(e,t){this.is_first_time=!0,this.configPersist=!1,this.initConfig=t,this.collect=e;var i=new x(t.app_id,t.cookie_domain||"",t.cookie_expire||7776e6).init();this.eventCheck=new L(e,t);var n="__tea_cache_first_"+t.app_id;this.configKey="__tea_cache_config_"+t.app_id,this.sessionStorage=new A(!1,"session"),this.localStorage=new A(!1,"local"),t.configPersist&&(this.configPersist=!0,this.storage=1===t.configPersist?this.sessionStorage:this.localStorage);var r=this.localStorage.getItem(n);r&&1==r?this.is_first_time=!1:(this.is_first_time=!0,this.localStorage.setItem(n,"1")),this.envInfo={user:{user_unique_id:P,user_type:P,user_id:P,user_is_auth:P,user_is_login:P,device_id:P,web_id:P,ip_addr_id:P,user_unique_id_type:P},header:{app_id:P,app_name:P,app_install_id:P,install_id:P,app_package:P,app_channel:P,app_version:P,ab_version:P,os_name:i.os_name,os_version:i.os_version,device_model:i.device_model,ab_client:P,traffic_type:P,client_ip:P,device_brand:P,os_api:P,access:P,language:i.language,region:P,app_language:P,app_region:P,creative_id:i.utm.creative_id,ad_id:i.utm.ad_id,campaign_id:i.utm.campaign_id,log_type:P,rnd:P,platform:i.platform,sdk_version:M,sdk_lib:"js",province:P,city:P,timezone:B,tz_offset:z,tz_name:P,sim_region:P,carrier:P,resolution:i.screen_width+"x"+i.screen_height,browser:i.browser,browser_version:i.browser_version,referrer:i.referrer,referrer_host:i.referrer_host,width:i.screen_width,height:i.screen_height,screen_width:i.screen_width,screen_height:i.screen_height,utm_term:i.utm.utm_term,utm_content:i.utm.utm_content,utm_source:i.utm.utm_source,utm_medium:i.utm.utm_medium,utm_campaign:i.utm.utm_campaign,tracer_data:JSON.stringify(i.utm.tracer_data),custom:{},wechat_unionid:P,wechat_openid:P}},this.ab_version="",this.evtParams={},this.reportErrorCallback=function(){},this.isLast=!1,this.setCustom(i),this.initDomain(),this.initABData()}return e.prototype.initDomain=function(){var e=this.initConfig.channel_domain;if(e)this.domain=e;else{var t=this.initConfig.channel;this.domain=p(C[t])}},e.prototype.setDomain=function(e){this.domain=e},e.prototype.getDomain=function(){return this.domain},e.prototype.initABData=function(){var e="__tea_sdk_ab_version_"+this.initConfig.app_id,t=null;if(this.initConfig.ab_cross){var i=this.localStorage.getCookie(e,this.initConfig.ab_cookie_domain);t=i?JSON.parse(i):null}else t=this.localStorage.getItem(e);this.setAbCache(t)},e.prototype.setAbCache=function(e){this.ab_cache=e},e.prototype.getAbCache=function(){return this.ab_cache},e.prototype.setAbVersion=function(e){this.ab_version=e},e.prototype.getAbVersion=function(){return this.ab_version},e.prototype.clearAbCache=function(){this.ab_version="",this.ab_cache={}},e.prototype.getUrl=function(e){var t="";switch(e){case"event":t=this.initConfig.report_url||"/list";break;case"webid":t="/webid";break;case"tobid":t="/tobid"}var i="";return this.initConfig.caller&&(i="?sdk_version="+M+"&sdk_name=web&app_id="+this.initConfig.app_id+"&caller="+this.initConfig.caller),""+this.getDomain()+t+i},e.prototype.setCustom=function(e){if(e&&e.latest_data&&e.latest_data.isLast)for(var t in delete e.latest_data.isLast,this.isLast=!0,e.latest_data)this.envInfo.header.custom[t]=e.latest_data[t]},e.prototype.set=function(e){var t=this;Object.keys(e).forEach((function(i){void 0!==e[i]&&null!==e[i]||t.delete(i);try{t.eventCheck.calculate(i,"config")}catch(n){}if("traffic_type"===i&&t.isLast&&(t.envInfo.header.custom.$latest_traffic_source_type=e[i]),"evtParams"===i)t.evtParams=n({},t.evtParams||{},e.evtParams||{});else if("_staging_flag"===i)t.evtParams=n({},t.evtParams||{},{_staging_flag:e._staging_flag});else if("reportErrorCallback"===i&&"function"==typeof e[i])t.reportErrorCallback=e[i];else{var r="",o="";if(i.indexOf(".")>-1){var a=i.split(".");r=a[0],o=a[1]}r?"user"===r||"header"===r?t.envInfo[r][o]=e[i]:t.envInfo.header.custom[o]=e[i]:Object.hasOwnProperty.call(t.envInfo.user,i)?["user_type","ip_addr_id"].indexOf(i)>-1?t.envInfo.user[i]=e[i]?Number(e[i]):e[i]:["user_id","web_id","user_unique_id","user_unique_id_type"].indexOf(i)>-1?t.envInfo.user[i]=e[i]?String(e[i]):e[i]:["user_is_auth","user_is_login"].indexOf(i)>-1?t.envInfo.user[i]=Boolean(e[i]):"device_id"===i&&(t.envInfo.user[i]=e[i]):Object.hasOwnProperty.call(t.envInfo.header,i)?t.envInfo.header[i]=e[i]:t.envInfo.header.custom[i]=e[i]}}))},e.prototype.get=function(e){try{return e?"evtParams"===e?this.evtParams:"reportErrorCallback"===e?this[e]:Object.hasOwnProperty.call(this.envInfo.user,e)?this.envInfo.user[e]:Object.hasOwnProperty.call(this.envInfo.header,e)?this.envInfo.header[e]:JSON.parse(JSON.stringify(this.envInfo[e])):JSON.parse(JSON.stringify(this.envInfo))}catch(e){this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"\u53d1\u751f\u4e86\u5f02\u5e38",level:"error",time:Date.now(),data:e.message})}},e.prototype.setStore=function(e){try{if(!this.configPersist)return;var t=this.storage.getItem(this.configKey)||{};if(t&&Object.keys(e).length){var i=Object.assign(e,t);this.storage.setItem(this.configKey,i)}}catch(e){this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"\u53d1\u751f\u4e86\u5f02\u5e38",level:"error",time:Date.now(),data:e.message})}},e.prototype.getStore=function(){try{if(!this.configPersist)return null;var e=this.storage.getItem(this.configKey)||{};return e&&Object.keys(e).length?e:null}catch(e){return this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"\u53d1\u751f\u4e86\u5f02\u5e38",level:"error",time:Date.now(),data:e.message}),null}},e.prototype.delete=function(e){try{if(!this.configPersist)return;var t=this.storage.getItem(this.configKey)||{};t&&Object.hasOwnProperty.call(t,e)&&(delete t[e],this.storage.setItem(this.configKey,t))}catch(e){this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"\u53d1\u751f\u4e86\u5f02\u5e38",level:"error",time:Date.now(),data:e.message})}},e}(),V=function(){function e(e,t){this.isLog=t||!1,this.name=e||""}return e.prototype.info=function(e){this.isLog},e.prototype.warn=function(e){this.isLog},e.prototype.error=function(e){this.isLog},e.prototype.throw=function(e){throw this.error(this.name),new Error(e)},e}(),U=function(){function e(){this.spiderBot=["Baiduspider","googlebot","360Spider","haosouspider","YoudaoBot","Sogou News Spider","Yisouspider","Googlebot","Headless","Applebot","Bingbot","PetalBot"]}return e.prototype.checkSpider=function(e){if(!e.enable_spider)return!1;var t=window.navigator.userAgent;if(!t)return!0;var i=!1;return this.spiderBot.forEach((function(e){-1!==t.indexOf(e)&&(i=!0)})),i},e}(),j=function(){function e(e,t){this.collect=e,this.native=t}var t=e.prototype;return t.bridgeInject=function(){try{return!!this.native&&!!AppLogBridge}catch(e){return!1}},t.bridgeReady=function(){var e=this;return new Promise((function(t,i){try{e.bridgeInject()?AppLogBridge.hasStarted((function(e){e?t(!0):i(!1)})):i(!1)}catch(e){i(!1)}}))},t.setNativeAppId=function(e){try{AppLogBridge.setNativeAppId(JSON.stringify(e))}catch(e){}},t.setConfig=function(e){var t=this;try{Object.keys(e).forEach((function(i){"user_unique_id"===i?t.setUserUniqueId(e[i]):e[i]?t.addHeaderInfo(i,e[i]):t.removeHeaderInfo(i)}))}catch(e){}},t.setUserUniqueId=function(e){try{AppLogBridge.setUserUniqueId(e)}catch(e){}},t.addHeaderInfo=function(e,t){try{AppLogBridge.addHeaderInfo(e,t)}catch(e){}},t.setHeaderInfo=function(e){try{AppLogBridge.setHeaderInfo(JSON.stringify(e))}catch(e){}},t.removeHeaderInfo=function(e){try{AppLogBridge.removeHeaderInfo(e)}catch(e){}},t.reportPv=function(e){this.onEventV3("predefine_pageview",e)},t.onEventV3=function(e,t){try{AppLogBridge.onEventV3(e,t),this.collect.emit(DebuggerMesssge.DEBUGGER_MESSAGE,{type:DebuggerMesssge.DEBUGGER_MESSAGE_EVENT,info:"bridge\u57cb\u70b9\u4e0a\u62a5",time:Date.now(),data:[{events:[{event:e,params:t}]}],code:200,status:"success"})}catch(e){}},t.profileSet=function(e){try{AppLogBridge.profileSet(e)}catch(e){}},t.profileSetOnce=function(e){try{AppLogBridge.profileSetOnce(e)}catch(e){}},t.profileIncrement=function(e){try{AppLogBridge.profileIncrement(e)}catch(e){}},t.profileUnset=function(e){try{AppLogBridge.profileUnset(e)}catch(e){}},t.profileAppend=function(e){try{AppLogBridge.profileAppend(e)}catch(e){}},e}(),$=500,K=5005;function q(e,t,i,n,r,o,a,s,c){try{var l=new XMLHttpRequest,u=s||"POST";l.open(u,""+e,!0),l.setRequestHeader("Content-Type","application/json; charset=utf-8"),a&&l.setRequestHeader("X-MCS-AppKey",""+a),n&&(l.withCredentials=!0),i&&(l.timeout=i,l.ontimeout=function(){o&&o(t,K)}),l.onload=function(){if(r){var e=null;if(l.responseText){try{e=JSON.parse(l.responseText)}catch(t){e={}}r(e,t)}}},l.onerror=function(){l.abort(),o&&o(t,$)},c?l.send(t):l.send(JSON.stringify(t))}catch(e){}}var W=function(e,t,i,n){try{var r,o=e.match(/\/v\d\//);r=o?o[0]:-1!==e.indexOf("/v1/")?"/v1/":"/v2/";var a=e.split(r)[0];if(!a)return void n(e,t,4001);t.forEach((function(r){var o=function(e){var t="";for(var i in e)e.hasOwnProperty(i)&&void 0!==e[i]&&(t+="&"+i+"="+encodeURIComponent(JSON.stringify(e[i])));return"&"===t[0]?t.slice(1):t}(r),s=new Image(1,1);s.onload=function(){s=null,i&&i()},s.onerror=function(){s=null,n&&n(e,t,4e3)},s.src=a+"/gif?"+o}))}catch(i){n&&n(e,t,4002,i.message)}},H=function(e,t,i,n,r,o,a,s){var c=window.navigator.userAgent;if(-1===window.navigator.appName.indexOf("Microsoft Internet Explorer")||-1===c.indexOf("MSIE 8.0")&&-1===c.indexOf("MSIE 9.0")){if(a)return window.navigator&&window.navigator.sendBeacon?void(window.navigator.sendBeacon(e,JSON.stringify(t))?r():o(e,t,4003)):void W(e,t,r,o)}else W(e,t,r,o);q(e,t,i,n,r,o,"","",s)},J=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},F=function(){function e(){}return e.prototype.apply=function(e,t){var i=this;this.collect=e,this.storage=new A(!1,"session"),this.sessionKey="__tea_session_id_"+t.app_id,this.expireTime=t.expireTime||18e5,this.disableSession=t.disable_session,this.disableSession||(this.setSessionId(),this.collect.on(G.SessionReset,(function(){i.resetSessionId()})),this.collect.on(G.SessionResetTime,(function(){i.updateSessionIdTime()})))},e.prototype.updateSessionIdTime=function(){var e=this.storage.getItem(this.sessionKey);if(e&&e.sessionId){var t=e.timestamp;Date.now()-t>this.expireTime?e={sessionId:J(),timestamp:Date.now()}:e.timestamp=Date.now(),this.storage.setItem(this.sessionKey,e),this.resetExpTime()}},e.prototype.setSessionId=function(){var e=this,t=this.storage.getItem(this.sessionKey);t&&t.sessionId?t.timestamp=Date.now():t={sessionId:J(),timestamp:Date.now()},this.storage.setItem(this.sessionKey,t),this.sessionExp=setInterval((function(){e.checkEXp()}),this.expireTime)},e.prototype.getSessionId=function(){var e=this.storage.getItem(this.sessionKey);return this.disableSession?"":e&&e.sessionId?e.sessionId:""},e.prototype.resetExpTime=function(){var e=this;this.sessionExp&&(clearInterval(this.sessionExp),this.sessionExp=setInterval((function(){e.checkEXp()}),this.expireTime))},e.prototype.resetSessionId=function(){var e={sessionId:J(),timestamp:Date.now()};this.storage.setItem(this.sessionKey,e)},e.prototype.checkEXp=function(){var e=this.storage.getItem(this.sessionKey);e&&e.sessionId&&Date.now()-e.timestamp+30>=this.expireTime&&(e={sessionId:J(),timestamp:Date.now()},this.storage.setItem(this.sessionKey,e))},e}(),Q=function(){function e(){this.eventLimit=50,this.enable_ttwebid=!1,this.eventCache=[],this.beconEventCache=[]}return e.prototype.apply=function(e,t){var i=this;this.collect=e,this.config=t,this.configManager=e.configManager,this.eventCheck=new L(e,t),this.cacheStorgae=new A(!0),this.localStorage=new A(!1),this.maxReport=t.max_report||10,this.reportTime=t.reportTime||t.report_time||30,this.timeout=t.timeout||1e5,this.enable_ttwebid=t.enable_ttwebid,this.reportUrl=this.configManager.getUrl("event"),this.eventKey="__tea_cache_events_"+this.configManager.get("app_id"),this.beconKey="__tea_cache_events_becon_"+this.configManager.get("app_id"),this.abKey="__tea_sdk_ab_version_"+this.configManager.get("app_id"),this.refer_key="__tea_cache_refer_"+this.configManager.get("app_id"),this.pageId=J(),this.collect.on(G.Ready,(function(){i.reportAll(!1)})),this.collect.on(G.ConfigDomain,(function(){i.reportUrl=i.configManager.getUrl("event")})),this.collect.on(G.Event,(function(e){i.event(e)})),this.collect.on(G.BeconEvent,(function(e){i.beconEvent(e)})),this.collect.on(G.CleanEvents,(function(){i.reportAll(!1)})),this.linster()},e.prototype.linster=function(){var e=this;window.addEventListener("unload",(function(){e.reportAll(!0)}),!1),d((function(){e.reportAll(!0)})),document.addEventListener("visibilitychange",(function(){"hidden"===document.visibilityState&&e.reportAll(!0)}),!1)},e.prototype.reportAll=function(e){this.report(e),this.reportBecon()},e.prototype.event=function(e){var t=this;try{var i=a(e,this.cacheStorgae.getItem(this.eventKey)||[]);if(this.cacheStorgae.setItem(this.eventKey,i),this.reportTimeout&&clearTimeout(this.reportTimeout),i.length>=this.maxReport)this.report(!1);else{var n=this.reportTime;this.reportTimeout=setTimeout((function(){t.report(!1),t.reportTimeout=null}),n)}}catch(e){this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"\u53d1\u751f\u4e86\u5f02\u5e38",level:"error",time:Date.now(),data:e.message})}},e.prototype.beconEvent=function(e){var t=a(e,this.cacheStorgae.getItem(this.beconKey)||[]);this.cacheStorgae.setItem(this.beconKey,t),this.collect.destroyInstance||this.collect.sdkStop||this.collect.tokenManager.getReady()&&this.collect.sdkReady&&(this.cacheStorgae.removeItem(this.beconKey),this.send(this.split(this.merge(t)),!0))},e.prototype.reportBecon=function(){if(!this.collect.destroyInstance&&!this.collect.sdkStop&&this.collect.tokenManager.getReady()&&this.collect.sdkReady){var e=this.cacheStorgae.getItem(this.beconKey)||[];e&&e.length&&(this.cacheStorgae.removeItem(this.beconKey),this.send(this.split(this.merge(e)),!0))}},e.prototype.report=function(e){if(!this.collect.destroyInstance&&!this.collect.sdkStop&&this.collect.tokenManager.getReady()&&this.collect.sdkReady){var t=this.cacheStorgae.getItem(this.eventKey)||[];t.length&&(this.cacheStorgae.removeItem(this.eventKey),this.sliceEvent(t,e))}},e.prototype.sliceEvent=function(e,t){if(e.length>this.eventLimit)for(var i=0;i<e.length;i+=this.eventLimit){var n;n=e.slice(i,i+this.eventLimit);var r=this.split(this.merge(n));this.send(r,t)}else r=this.split(this.merge(e)),this.send(r,t)},e.prototype.handleRefer=function(){var e="";if(this.config.spa||this.config.autotrack){var t=this.localStorage.getItem(this.refer_key)||{};e=t.routeChange?t.refer_key:document.referrer}else e=document.referrer;return e},e.prototype.merge=function(e,t){var i=this,r=this.configManager.get(),o=r.header,a=r.user;this.config.enable_pageid&&(o.custom.page_id=this.pageId),o.custom=JSON.stringify(o.custom);var s=this.configManager.get("evtParams"),c=this.configManager.get("user_unique_id_type"),l=e.map((function(e){try{Object.keys(s).length&&!t&&(e.params=n({},s,e.params)),c&&(e.params.$user_unique_id_type=c);var r=i.configManager.getAbCache();return r&&r.uuid&&r.uuid===a.user_unique_id&&i.configManager.getAbVersion()&&(e.ab_sdk_version=i.configManager.getAbVersion()),e.session_id=i.collect.sessionManager.getSessionId(),e.params=JSON.stringify(e.params),e}catch(n){return i.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"\u53d1\u751f\u4e86\u5f02\u5e38",level:"error",time:Date.now(),data:n.message}),e}})),u=JSON.parse(JSON.stringify({events:l,user:a,header:o}));u.local_time=Math.floor(Date.now()/1e3),u.user_unique_type=this.config.enable_ttwebid?this.config.user_unique_type:void 0,u.verbose=1;var h=[];return h.push(u),h},e.prototype.split=function(e){return e.map((function(e){var t=[];return t.push(e),t}))},e.prototype.send=function(e,t){var i=this;e.length&&(this.config.disable_track_event||e.forEach((function(e){try{var n=JSON.parse(JSON.stringify(e));i.config.filter&&(n=i.config.filter(n)),i.collect.eventFilter&&n&&(n=i.collect.eventFilter(n));var r=n||e,o=JSON.parse(JSON.stringify(r));if(i.eventCheck.checkVerify(o),!r.length)return;i.collect.emit(G.SubmitBefore,r),H(i.reportUrl,r,i.timeout,i.enable_ttwebid,(function(e,t){e&&0!==e.e?(i.collect.emit(G.SubmitError,{type:"f_data",eventData:t,errorCode:e.e,response:e}),i.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_EVENT,info:"\u57cb\u70b9\u4e0a\u62a5\u5931\u8d25",time:Date.now(),data:o,code:e.e,failType:"\u6570\u636e\u5f02\u5e38\u5931\u8d25",status:"fail"})):(i.collect.emit(G.SubmitScuess,{eventData:t,res:e}),i.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_EVENT,info:"\u57cb\u70b9\u4e0a\u62a5\u6210\u529f",time:Date.now(),data:o,code:200,status:"success"}))}),(function(e,t){i.configManager.get("reportErrorCallback")(e,t),i.collect.emit(G.SubmitError,{type:"f_net",eventData:e,errorCode:t}),i.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_EVENT,info:"\u57cb\u70b9\u4e0a\u62a5\u7f51\u7edc\u5f02\u5e38",time:Date.now(),data:o,code:t,failType:"\u7f51\u7edc\u5f02\u5e38\u5931\u8d25",status:"fail"})}),t,!1),i.collect.emit(G.SubmitAfter,r)}catch(e){i.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"\u53d1\u751f\u4e86\u5f02\u5e38",level:"error",time:Date.now(),data:e.message})}})))},e}(),Y=function(){return function e(t){return t?(t^16*Math.random()>>t/4).toString(10):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e)}().replace(/-/g,"").slice(0,19)},X=function(){function e(){this.cacheToken={},this.enableCookie=!1,this.enable_ttwebid=!1,this.enableCustomWebid=!1}return e.prototype.apply=function(e,t){var i=this;this.collect=e,this.config=t,this.configManager=this.collect.configManager,this.storage=new A(!1),this.tokenKey="__tea_cache_tokens_"+t.app_id,this.enable_ttwebid=t.enable_ttwebid,this.enableCustomWebid=t.enable_custom_webid,this.collect.on(G.ConfigUuid,(function(e){i.setUuid(e)})),this.collect.on(G.ConfigWebId,(function(e){i.setWebId(e)})),this.enableCookie=t.cross_subdomain,this.expiresTime=t.cookie_expire||6048e5,this.cookieDomain=t.cookie_domain||"",this.checkStorage()},e.prototype.checkStorage=function(){var e=this;if(this.enableCookie){var t=this.storage.getCookie(this.tokenKey,this.cookieDomain);this.cacheToken=t&&"string"==typeof t?JSON.parse(t):{}}else this.cacheToken=this.storage.getItem(this.tokenKey)||{};this.tokenType=this.cacheToken&&this.cacheToken._type_?this.cacheToken._type_:"default","custom"!==this.tokenType||this.enableCustomWebid?this.enableCustomWebid?this.collect.on(G.CustomWebId,(function(){e.tokenReady=!0,e.collect.emit(G.TokenComplete)})):this.checkEnv()||(this.enable_ttwebid?this.completeTtWid(this.cacheToken):this.check()):this.remoteWebid()},e.prototype.check=function(){this.cacheToken&&this.cacheToken.web_id?this.complete(this.cacheToken):this.config.disable_webid?this.complete({web_id:Y(),user_unique_id:this.configManager.get("user_unique_id")||Y()}):this.remoteWebid()},e.prototype.checkEnv=function(){var e=window.navigator.userAgent;if(-1!==e.indexOf("miniProgram")||-1!==e.indexOf("MiniProgram")){var t=v(window.location.href);return!(!t||!t.Web_ID||(this.complete({web_id:""+t.Web_ID,user_unique_id:this.configManager.get("user_unique_id")||""+t.Web_ID}),0))}return!1},e.prototype.remoteWebid=function(){var e=this,t=this.configManager.getUrl("webid"),i={app_key:this.config.app_key,app_id:this.config.app_id,url:location.href,user_agent:window.navigator.userAgent,referer:document.referrer,user_unique_id:""};this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK \u53d1\u8d77WEBID\u8bf7\u6c42",logType:"fetch",level:"info",time:Date.now(),data:i});var n=Y();q(t,i,3e5,!1,(function(t){var i;t&&0===t.e?(i=t.web_id,e.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"WEBID\u8bf7\u6c42\u6210\u529f",logType:"fetch",level:"info",time:Date.now(),data:t})):(i=n,e.collect.configManager.set({localWebId:n}),e.collect.emit(G.TokenError),e.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"WEBID\u8bf7\u6c42\u8fd4\u56de\u503c\u5f02\u5e38",logType:"fetch",level:"warn",time:Date.now(),data:t}),e.collect.logger.warn("appid: "+e.config.app_id+" get webid error, use local webid~")),e.complete({web_id:e.configManager.get("web_id")||i,user_unique_id:e.configManager.get("user_unique_id")||i})}),(function(){e.complete({web_id:e.configManager.get("web_id")||n,user_unique_id:e.configManager.get("user_unique_id")||n}),e.collect.configManager.set({localWebId:n}),e.collect.emit(G.TokenError),e.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"WEBID\u8bf7\u6c42\u7f51\u7edc\u5f02\u5e38",logType:"fetch",level:"error",time:Date.now(),data:null}),e.collect.logger.warn("appid: "+e.config.app_id+", get webid error, use local webid~")}))},e.prototype.complete=function(e){var t=e.web_id,i=e.user_unique_id;e.timestamp=Date.now(),this.collect.configManager.set({web_id:t,user_unique_id:i}),this.setStorage(e),this.tokenReady=!0,this.collect.emit(G.TokenComplete)},e.prototype.completeTtWid=function(e){var t=e.user_unique_id||"",i=this.configManager.get("user_unique_id");(i||t)&&this.configManager.set({user_unique_id:i||t}),this.setStorage(e),this.tokenReady=!0,this.collect.emit(G.TokenComplete)},e.prototype.setUuid=function(e){if(e&&-1===["null","undefined","Null","None"].indexOf(e)){var t=String(e),i=this.configManager.get("user_unique_id"),n=this.cacheToken&&this.cacheToken.user_unique_id;if(t===i&&t===n)return;this.configManager.set({user_unique_id:t}),this.cacheToken||(this.cacheToken={}),this.cacheToken.user_unique_id=t,this.cacheToken.timestamp=Date.now(),this.setStorage(this.cacheToken),this.collect.emit(G.TokenChange,"uuid"),this.collect.emit(G.SessionReset)}else this.clearUuid()},e.prototype.clearUuid=function(){this.config.enable_ttwebid||this.configManager.get("web_id")&&this.configManager.get("user_unique_id")!==this.configManager.get("web_id")&&(this.configManager.set({user_unique_id:this.configManager.get("web_id")}),this.cacheToken&&this.cacheToken.web_id&&(this.cacheToken.user_unique_id=this.cacheToken.web_id,this.cacheToken.timestamp=Date.now(),this.setStorage(this.cacheToken)),this.collect.emit(G.TokenReset,"uuid"))},e.prototype.setWebId=function(e){if(e&&!this.config.enable_ttwebid){this.cacheToken&&this.cacheToken.web_id?this.cacheToken.web_id!==e&&(this.cacheToken.user_unique_id=this.cacheToken.web_id===this.cacheToken.user_unique_id?e:this.cacheToken.user_unique_id,this.cacheToken.web_id=e):(this.cacheToken={},this.cacheToken.web_id=e,this.cacheToken.user_unique_id=e),this.cacheToken.timestamp=Date.now();var t=this.configManager.get("web_id"),i=this.configManager.get("user_unique_id");i&&i!==t||(this.configManager.set({user_unique_id:e}),this.collect.emit(G.TokenChange,"uuid")),t!==e&&(this.configManager.set({web_id:e}),this.collect.emit(G.TokenChange,"webid")),this.setStorage(this.cacheToken)}},e.prototype.setStorage=function(e){e._type_=this.enableCustomWebid?"custom":"default",delete e["diss".split("").reverse().join("")],this.enableCookie||this.enable_ttwebid?(this.storage.setCookie(this.tokenKey,e,this.expiresTime,this.cookieDomain),this.enable_ttwebid&&(delete e.web_id,this.storage.setItem(this.tokenKey,e))):this.storage.setItem(this.tokenKey,e),this.cacheToken=e},e.prototype.getReady=function(){return this.tokenReady},e.prototype.getTobId=function(){var e=this,t=this.configManager.getUrl("tobid");return new Promise((function(i){q(t,{app_id:e.config.app_id,user_unique_id:e.configManager.get("user_unique_id"),web_id:e.configManager.get("web_id"),user_unique_id_type:e.configManager.get("user_unique_id_type")},3e4,e.enable_ttwebid,(function(e){e&&0===e.e?i(e.tobid):i("")}),(function(){i("")}))}))},e}(),Z=function(){function e(e,t){this.devToolReady=!1,this.devToolOrigin="*",this.sendAlready=!1,this.eventVerifyReady=!1,this.collect=e,this.config=t,this.app_id=t.app_id;var i=e.adapters,n=i.storage,r=i.fetch;this.cacheStorgae=new n(!1,"session"),this.fetch=r,this.eventVerifyInfo=[],this.sdk_type=M.includes("tob")?"tob":"inner",this.filterEvent=["__bav_page","__bav_beat","__bav_page_statistics","__bav_click","__bav_page_exposure","bav2b_page","bav2b_beat","bav2b_page_statistics","bav2b_click","bav2b_page_exposure","_be_active","predefine_pageview","__profile_set","__profile_set_once","__profile_increment","__profile_unset","__profile_append","predefine_page_alive","predefine_page_close","abtest_exposure"],t.enable_debug&&this.load()}return e.prototype.loadScript=function(e){try{var t=document.createElement("script");t.src=e,t.onerror=function(){},t.onload=function(){},document.getElementsByTagName("body")[0].appendChild(t)}catch(e){}},e.prototype.load=function(){return e=this,void 0,i=function(){var e,t;return function(e,t){var i,n,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(r=2&o[0]?n.return:o[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,o[1])).done)return r;switch(n=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),e=v(window.location.href),1===this.getStorage()||e.open_devtool_web||parseInt(e.app_id)===this.app_id?(this.loadBaseInfo(),this.loadHook(),this.setStorage(),this.addLintener(),this.loadDebuggerModule(),this.loadDevTool(),[4,this.fetchEventInfo()]):[2];case 1:return t=i.sent(),this.sendData("devtool:web:verify",t.verifyStatus),this.eventVerifyInfo=t.data,[3,3];case 2:return i.sent(),[3,3];case 3:return[2]}}))},new((t=void 0)||(t=Promise))((function(n,r){function o(e){try{s(i.next(e))}catch(e){r(e)}}function a(e){try{s(i.throw(e))}catch(e){r(e)}}function s(e){e.done?n(e.value):new t((function(t){t(e.value)})).then(o,a)}s((i=i.apply(e,[])).next())}));var e,t,i},e.prototype.getStorage=function(){return this.cacheStorgae.getItem("__applog_devtool_web_"+this.app_id)},e.prototype.setStorage=function(){this.cacheStorgae.setItem("__applog_devtool_web_"+this.app_id,1)},e.prototype.loadDevTool=function(){this.loadScript("https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/devtool/debug-web.0.0.2.js")},e.prototype.loadBaseInfo=function(){var e=this;this.info=[{title:"\u57fa\u672c\u4fe1\u606f",type:1,infoName:{app_id:this.config.app_id,channel:this.config.channel,"\u4e0a\u62a5\u57df\u540d":this.collect.configManager.getDomain(),"SDK\u7248\u672c":M,"SDK\u5f15\u5165\u65b9\u5f0f":"npm"}},{title:"\u7528\u6237\u4fe1\u606f",type:2,infoName:{uuid:this.collect.configManager.get("user").user_unique_id||"",web_id:this.collect.configManager.get("user").web_id||"",ssid:"\u70b9\u51fb\u83b7\u53d6SSID"}},{title:"\u516c\u5171\u53c2\u6570\u4fe1\u606f",type:2,infoName:{"\u6d4f\u89c8\u5668":this.collect.configManager.get("browser"),"\u6d4f\u89c8\u5668\u7248\u672c":this.collect.configManager.get("browser_version"),"\u5e73\u53f0":this.collect.configManager.get("platform"),"\u8bbe\u5907\u578b\u53f7":this.collect.configManager.get("device_model"),"\u64cd\u4f5c\u7cfb\u7edf":this.collect.configManager.get("os_name"),"\u64cd\u4f5c\u7cfb\u7edf\u7248\u672c":this.collect.configManager.get("os_version"),"\u5c4f\u5e55\u5206\u8fa8\u7387":this.collect.configManager.get("resolution"),"\u6765\u6e90":this.collect.configManager.get("referrer"),"\u81ea\u5b9a\u4e49\u4fe1\u606f":""}},{title:"\u914d\u7f6e\u4fe1\u606f",type:3,infoName:{"\u5168\u57cb\u70b9":!!this.config.autotrack,"\u505c\u7559\u65f6\u957f":!!this.config.enable_stay_duration}},{title:"A/B\u914d\u7f6e\u4fe1\u606f",type:4,infoName:{"A/B\u5b9e\u9a8c":!!this.config.enable_ab_test}},{title:"\u5ba2\u6237\u7aef\u4fe1\u606f",type:3,infoName:{"\u6253\u901a\u5f00\u5173":!!this.config.Native}}],this.log=[],this.event=[],this.collect.on(G.Ready,(function(){e.info[1].infoName.uuid=e.collect.configManager.get("user").user_unique_id,e.info[1].infoName.web_id=e.collect.configManager.get("user").web_id,e.info[2].infoName["\u81ea\u5b9a\u4e49\u4fe1\u606f"]=JSON.stringify(e.collect.configManager.get("custom")),e.config.enable_ab_test&&(e.info[4].infoName["\u5df2\u66dd\u5149VID"]=e.collect.configManager.getAbVersion(),e.info[4].infoName["A/B\u57df\u540d"]=e.config.ab_channel_domain||p(O[e.config.channel]),e.info[4].infoName["\u5168\u90e8\u914d\u7f6e"]=e.collect.configManager.getAbData()),e.config.Native&&(e.info[5].infoName["\u662f\u5426\u6253\u901a"]=!!e.collect.bridgeReport)}))},e.prototype.loadHook=function(){var e=this;this.collect.stop(),this.collect.on(S.DEBUGGER_MESSAGE,(function(t){switch(t.type){case S.DEBUGGER_MESSAGE_SDK:var i={time:t.time,type:t.logType||"sdk",level:t.level,name:t.info,show:!0,levelShow:!0,needDesc:!!t.data};return t.data&&(i.desc={content:JSON.stringify(t.data)}),e.updateLog(i),t.secType&&"AB"===t.secType?(e.info[4].infoName["\u5df2\u66dd\u5149VID"]=e.collect.configManager.getAbVersion(),e.info[4].infoName["\u5168\u90e8\u914d\u7f6e"]=e.collect.configManager.getAbData()):"USER"===t.secType&&(e.info[1].infoName.uuid=e.collect.configManager.get("user").user_unique_id,e.info[1].infoName.web_id=e.collect.configManager.get("user").web_id),void e.updateInfo();case S.DEBUGGER_MESSAGE_EVENT:if(t.data&&t.data.length){var n=t.data[0],r=n.events,o=n.header;if(o.custom=JSON.parse(o.custom),!r.length)return;r.forEach((function(i){i.checkShow=!0,i.searchShow=!0,i.type=-1!==e.filterEvent.indexOf(i.event)?"sdk":"cus",i.type=e.collect.bridgeReport?"bridge":i.type,i.params=JSON.parse(i.params),"fail"===t.status&&(i.info={message:"code: "+t.code+"\uff0c msg: "+t.failType},i.failType=t.failType);var n=!1,r=!1,o=[];e.eventVerifyInfo&&e.eventVerifyInfo.length&&(e.eventVerifyInfo.forEach((function(e){e.eventStatus=!1})),e.eventVerifyInfo.forEach((function(t){i.event===t.name&&(r=!0,n=!0,i.verifyStatus=t.status,Object.keys(i.params).forEach((function(n){if("event_index"!==n){var a={};a.paramsKey=n,a.paramsKeyValue=i.params[""+n],a.paramsStatus=!1,a.paramsStatusInfo="\u5c5e\u6027\u672a\u5f55\u5165",t.params.forEach((function(t){n===t.name&&(t.checked=!0,typeof i.params[""+n]!==e.formatParamsType(t.value_type)?a.paramsStatusInfo="\u5c5e\u6027\u7c7b\u578b\u9519\u8bef\uff0c\u5e94\u4e3a"+e.formatParamsType(t.value_type):(a.paramsStatus=!0,a.paramsStatusInfo=""))})),o.push(a),a.paramsStatusInfo&&(r=!1)}})),t.params.forEach((function(e){e.checked||(r=!1,o.push({paramsKey:e.name,paramsStatus:!1,paramsStatusInfo:"\u7f3a\u5c11\u5c5e\u6027"+e.name}))})))}))),i.reportStatus="success"===t.status,i.paramsInfo=o,i.eventStatus=r&&"success"===t.status,i.eventRecord=n})),e.updateEvent(n)}return}}))},e.prototype.formatParamsType=function(e){switch(e){case 0:return"string";case 1:case 2:return"number";case 3:return"boolean"}},e.prototype.fetchEventInfo=function(){var e=this;try{return new Promise((function(t){var i=p("1fz22z22z1nz21z4mz4bz4bz18z1nz1nz1jz1mz1ez1fz1mz1kz1cz4az19z27z22z1cz1bz18z1lz1az1cz4az1lz1cz22z4bz18z1nz1nz1jz1mz1ez1bz1cz24z22z1mz1mz1jz21z4bz1mz1nz1cz1lz18z1nz1gz4bz24z4dz4bz18z1nz1nz16z1jz1mz1ez16z1kz1cz22z18")+"?app_id="+e.app_id+"&t="+e.sdk_type+"&nc=false";e.fetch(i,null,3e3,!1,(function(i){e.eventVerifyReady=!0,e.collect.reStart(),t({data:i.data,verifyStatus:!0})}),(function(){e.eventVerifyReady=!0,e.collect.reStart(),t({data:[],verifyStatus:!1})}),"","GET")}))}catch(e){return{data:[],verifyStatus:!1}}},e.prototype.addLintener=function(){var e=this;window.addEventListener("message",(function(t){if(t.origin===location.origin){if(t&&t.data&&"devtool:web:ready"===t.data.type){if(e.devToolOrigin=t.origin,e.devToolReady=!0,e.sendAlready)return;e.sendData("devtool:web:init",{info:e.info,log:e.log,event:e.event,appid:e.app_id}),e.sendAlready=!0}t&&t.data&&"devtool:web:ssid"===t.data.type&&e.collect.getToken((function(t){e.info[1].infoName.ssid=t.tobid,e.updateInfo()}))}}))},e.prototype.sendData=function(e,t){try{var i={type:e,payload:t};(window.opener||window.parent).postMessage(i,this.devToolOrigin)}catch(e){}},e.prototype.updateInfo=function(){this.devToolReady&&this.sendData("devtool:web:info",this.info)},e.prototype.updateLog=function(e){this.devToolReady?this.sendData("devtool:web:log",e):this.log.push(e)},e.prototype.updateEvent=function(e){this.devToolReady||this.eventVerifyReady?this.sendData("devtool:web:event",e):this.event.push(e)},e.prototype.loadDebuggerModule=function(){var e=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style");t.appendChild(document.createTextNode("#debugger-applog-web {\n      position: fixed;\n      width: 50px;\n      height: 50px;\n      background-image: url('https://lf-cdn-tos.bytescm.com/obj/static/log-sdk/collect/devtool/applog.png');;\n      bottom: 5%;\n      right: 10%;\n      cursor: pointer;\n      z-index:100;\n      background-size: 50px;\n    }")),e.appendChild(t);var i=document.createElement("div");i.innerHTML='<div id="debugger-applog-web" class="debugger-applog-web"></div>';var n=document.createElement("div");n.innerHTML='<div id="debugger-container" class="debugger-container"></div>',document.getElementsByTagName("body")[0].appendChild(i),document.getElementsByTagName("body")[0].appendChild(n),document.getElementById("debugger-applog-web").addEventListener("click",(function(){(window.opener||window.parent).postMessage({type:"devtool:web:open-draw"},location.origin)}))},e}(),ee=function(){function e(e){this.disableAutoPageView=!1,this.bridgeReport=!1,this.staging=!1,this.pluginInstances=[],this.sended=!1,this.started=!1,this.destroyInstance=!1,this.sdkReady=!1,this.adapters={},this.loadType="base",this.sdkStop=!1,this.name=e,this.hook=new c,this.remotePlugin=new Map,this.Types=G,this.adapters.fetch=q,this.adapters.storage=A,this.loadType="full"}return e.usePlugin=function(t,i,n){if(i){for(var r=!1,o=0,a=e.plugins.length;o<a;o++)if(e.plugins[o].name===i){e.plugins[o].plugin=t,e.plugins[o].options=n||{},r=!0;break}r||e.plugins.push({name:i,plugin:t,options:n})}else e.plugins.push({plugin:t})},e.prototype.usePlugin=function(e,t,i){e&&("full"===this.loadType&&this.remotePlugin.get(e)||(t?"string"==typeof t?this.remotePlugin.get(e)||this.remotePlugin.set(e,{src:t,call:i}):this.remotePlugin.get(e)||this.remotePlugin.set(e,{instance:t}):this.remotePlugin.get(e)||this.remotePlugin.set(e,"sdk")))},e.prototype.init=function(t){var i,n=this;this.logger=new V(this.name,t.log),this.inited?this.logger.warn("[instance: "+this.name+"], every instance's api: init,  can be call only one time!"):t&&l(t)?t.app_id&&"number"==typeof(i=t.app_id)&&!isNaN(i)?!t.app_key||function(e){return"string"==typeof e}(t.app_key)?(t.channel_domain||-1!==["cn","sg","va"].indexOf(t.channel)||(this.logger.warn("channel must be `cn`, `sg`,`va` !"),t.channel="cn"),this.spider=new U,this.spider.checkSpider(t)?this.logger.warn("your env may be a spider, can not report!"):(this.appBridge=new j(this,t.enable_native),this.bridgeReport=this.appBridge.bridgeInject(),this.configManager=new N(this,t),this.debugger=new Z(this,t),this.initConfig=t,this.emit(G.Init),this.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK \u6267\u884cINIT",data:t,level:"info",time:Date.now()}),t.disable_auto_pv&&(this.disableAutoPageView=!0),this.bridgeReport||(this.configManager.set({app_id:t.app_id}),this.eventManager=new Q,this.tokenManager=new X,this.sessionManager=new F,Promise.all([new Promise((function(e){n.once(G.TokenComplete,(function(){e(!0)}))})),new Promise((function(e){n.once(G.Start,(function(){e(!0)}))}))]).then((function(){try{e.plugins.reduce((function(e,t){var i=t.plugin,r=t.options,o=Object.assign(n.initConfig,r),a=new i;return a.apply(n,o),e.push(a),e}),n.pluginInstances)}catch(t){n.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"\u53d1\u751f\u4e86\u5f02\u5e38",level:"error",time:Date.now(),data:t.message})}n.sdkReady=!0,n.emit(G.Ready),n.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK \u521d\u59cb\u5316\u5b8c\u6210",time:Date.now(),level:"info",data:n.configManager.get("user")}),n.logger.info("appid: "+t.app_id+", userInfo:"+JSON.stringify(n.configManager.get("user"))),n.logger.info("appid: "+t.app_id+", sdk is ready, version type is "+n.loadType+", version is "+M+", you can report now !!!"),t.disable_auto_pv&&(n.disableAutoPageView=!0);try{"full"===n.loadType&&(t.enable_ab_test||t.autotrack)&&(window.opener||window.parent).postMessage("[tea-sdk]ready","*")}catch(t){n.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"\u53d1\u751f\u4e86\u5f02\u5e38",level:"error",time:Date.now(),data:t.message})}n.pageView(),n.on(G.TokenChange,(function(e){"webid"===e&&n.pageView(),n.logger.info("appid: "+t.app_id+" token change, new userInfo:"+JSON.stringify(n.configManager.get("user"))),n.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK \u8bbe\u7f6e\u4e86\u7528\u6237\u4fe1\u606f",time:Date.now(),secType:"USER",level:"info",data:n.configManager.get("user")})})),n.on(G.TokenReset,(function(){n.logger.info("appid: "+t.app_id+" token reset, new userInfo:"+JSON.stringify(n.configManager.get("user"))),n.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK \u91cd\u7f6e\u4e86\u7528\u6237\u4fe1\u606f",time:Date.now(),secType:"USER",level:"info",data:n.configManager.get("user")})})),n.on(G.RouteChange,(function(e){e.init||t.disable_route_report||n.pageView()}))})),this.tokenManager.apply(this,t),this.eventManager.apply(this,t),this.sessionManager.apply(this,t)),this.inited=!0)):this.logger.warn("app_key param is error, must be string, please check!"):this.logger.warn("app_id param is error, must be number, please check!"):this.logger.warn("init params error,please check!")},e.prototype.config=function(e){if(this.inited)if(e&&l(e))if(this.bridgeReport)this.appBridge.setConfig(e);else{e._staging_flag&&1===e._staging_flag&&(this.staging=!0),e.disable_auto_pv&&(this.disableAutoPageView=!0,delete e.disable_auto_pv);var t=n({},e),i=this.initConfig.configPersist||this.initConfig.config_persist||!1;if(this.initConfig&&i){var r=this.configManager.getStore();r&&(t=Object.assign(r,e)),this.configManager.setStore(e)}t.web_id,t.user_unique_id;var o=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&(i[n[r]]=e[n[r]])}return i}(t,["web_id","user_unique_id"]);this.configManager.set(o),t.hasOwnProperty("web_id")&&this.emit(G.ConfigWebId,t.web_id),t.hasOwnProperty("user_unique_id")&&this.emit(G.ConfigUuid,t.user_unique_id),this.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK \u6267\u884cCONFIG",level:"info",time:Date.now(),data:t})}else this.logger.warn("config params is error, please check");else this.logger.warn("config must be use after function init")},e.prototype.setUserUniqueID=function(e){this.config({user_unique_id:e})},e.prototype.setHeaderInfo=function(e,t){var i={};i[e]=t,this.config(i)},e.prototype.removeHeaderInfo=function(e){var t={};t[e]=void 0,this.config(t)},e.prototype.setDomain=function(e){this.configManager&&this.configManager.setDomain(e),this.emit(G.ConfigDomain)},e.prototype.getConfig=function(e){return this.configManager.get(e)},e.prototype.send=function(){this.start()},e.prototype.start=function(){this.inited&&!this.sended&&(this.sended=!0,this.started=!0,this.emit(G.Start),this.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK \u6267\u884cSTART",level:"info",time:Date.now()}),this.bridgeReport&&(this.pageView(),this.emit(G.Ready)))},e.prototype.event=function(e,t){var i=this;try{var n=[];if(Array.isArray(e))e.forEach((function(e){var t=i.processEvent(e[0],e[1]||{});t&&n.push(t)}));else{var r=this.processEvent(e,t);if(!r)return;n.push(r)}this.bridgeReport?n.forEach((function(e){var t=e.event,n=e.params;i.appBridge.onEventV3(t,JSON.stringify(n))})):n.length&&(this.emit(G.Event,n),this.emit(G.SessionResetTime))}catch(e){this.logger.warn("something error, please check"),this.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"\u53d1\u751f\u4e86\u5f02\u5e38",level:"error",time:Date.now(),data:e.message})}},e.prototype.beconEvent=function(e,t){if(Array.isArray(e))this.logger.warn("beconEvent not support batch report, please check");else{var i=[],n=this.processEvent(e,t||{});n&&(i.push(n),i.length&&(this.emit(G.BeconEvent,i),this.emit(G.SessionResetTime)))}},e.prototype.processEvent=function(e,t){void 0===t&&(t={});try{if(!e)return this.logger.warn("eventName is null\uff0c please check"),null;var i=e;/^event\./.test(e)&&(i=e.slice(6));var n=t;"object"!=typeof n&&(n={}),n.profile?delete n.profile:n.event_index=h();var r=void 0;return n.local_ms?(r=n.local_ms,delete n.local_ms):r=+new Date,{event:i,params:n,local_time_ms:r,is_bav:this.initConfig&&this.initConfig.autotrack?1:0}}catch(i){return this.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"\u53d1\u751f\u4e86\u5f02\u5e38",level:"error",time:Date.now(),data:i.message}),{event:e,params:t}}},e.prototype.filterEvent=function(e){this.eventFilter=e},e.prototype.on=function(e,t){this.hook.on(e,t)},e.prototype.once=function(e,t){this.hook.once(e,t)},e.prototype.off=function(e,t){this.hook.off(e,t)},e.prototype.emit=function(e,t,i){this.hook.emit(e,t,i)},e.prototype.set=function(e){this.hook.set(e)},e.prototype.stop=function(){this.sdkStop=!0},e.prototype.reStart=function(){this.sdkStop=!1},e.prototype.pageView=function(){this.disableAutoPageView||this.predefinePageView()},e.prototype.predefinePageView=function(e){if(void 0===e&&(e={}),this.inited){var t={title:document.title||location.pathname,url:location.href,url_path:location.pathname,time:Date.now(),referrer:window.document.referrer,$is_first_time:""+(this.configManager&&this.configManager.is_first_time||!1)},i=n({},t,e);this.event("predefine_pageview",i)}},e.prototype.clearEventCache=function(){this.emit(G.CleanEvents)},e.prototype.setWebIDviaUnionID=function(e){if(e){var t=y(e);this.config({web_id:""+t,wechat_unionid:e}),this.emit(G.CustomWebId)}},e.prototype.setWebId=function(e){this.config({web_id:""+e})},e.prototype.setWebIDviaOpenID=function(e){if(e){var t=y(e);this.config({web_id:""+t,wechat_openid:e}),this.emit(G.CustomWebId)}},e.prototype.setNativeAppId=function(e){this.bridgeReport&&this.appBridge.setNativeAppId(e)},e.prototype.resetStayDuration=function(e,t,i){this.emit(G.ResetStay,{url_path:e,title:t,url:i},G.Stay)},e.prototype.resetStayParams=function(e,t,i){void 0===e&&(e=""),void 0===t&&(t=""),void 0===i&&(i=""),this.emit(G.SetStay,{url_path:e,title:t,url:i},G.Stay)},e.prototype.getToken=function(e,t){var i=this;if(this.inited){var r=!1,o=function(t){if(!r){r=!0;var o=i.configManager.get().user;return t&&(o.tobid=t,o["diss".split("").reverse().join("")]=t),e(n({},o))}},a=function(){i.tokenManager.getTobId().then((function(e){o(e)}))};this.sdkReady?a():(t&&setTimeout((function(){o()}),t),this.on(G.Ready,(function(){a()})))}},e.prototype.profileSet=function(e){this.bridgeReport?this.appBridge.profileSet(JSON.stringify(e)):this.emit(G.ProfileSet,e,G.Profile),this.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK \u6267\u884cprofileSet",level:"info",time:Date.now(),data:e})},e.prototype.profileSetOnce=function(e){this.bridgeReport?this.appBridge.profileSetOnce(JSON.stringify(e)):this.emit(G.ProfileSetOnce,e,G.Profile),this.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK \u6267\u884cprofileSetOnce",level:"info",time:Date.now(),data:e})},e.prototype.profileIncrement=function(e){this.bridgeReport?this.appBridge.profileIncrement(JSON.stringify(e)):this.emit(G.ProfileIncrement,e,G.Profile),this.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK \u6267\u884cprofileIncrement",level:"info",time:Date.now(),data:e})},e.prototype.profileUnset=function(e){this.bridgeReport?this.appBridge.profileUnset(e):this.emit(G.ProfileUnset,e,G.Profile),this.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK \u6267\u884cprofileUnset",level:"info",time:Date.now(),data:e})},e.prototype.profileAppend=function(e){this.bridgeReport?this.appBridge.profileAppend(JSON.stringify(e)):this.emit(G.ProfileAppend,e,G.Profile),this.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK \u6267\u884cprofileAppend",level:"info",time:Date.now(),data:e})},e.prototype.setExternalAbVersion=function(e){this.emit(G.AbExternalVersion,"string"==typeof e&&e?(""+e).trim():null,G.Ab)},e.prototype.getVar=function(e,t,i){this.emit(G.AbVar,{name:e,defaultValue:t,callback:i},G.Ab)},e.prototype.getABconfig=function(e,t){this.emit(G.AbConfig,{params:e,callback:t},G.Ab)},e.prototype.getAbSdkVersion=function(){return this.configManager.getAbVersion()},e.prototype.onAbSdkVersionChange=function(e){var t=this;return this.emit(G.AbVersionChangeOn,e,G.Ab),function(){t.emit(G.AbVersionChangeOff,e,G.Ab)}},e.prototype.offAbSdkVersionChange=function(e){this.emit(G.AbVersionChangeOff,e,G.Ab)},e.prototype.openOverlayer=function(){this.emit(G.AbOpenLayer,"",G.Ab)},e.prototype.closeOverlayer=function(){this.emit(G.AbCloseLayer,"",G.Ab)},e.prototype.getAllVars=function(e){this.emit(G.AbAllVars,e,G.Ab)},e.prototype.autoInitializationRangers=function(e){var t,i,n,r,o,a,s,c;i=(t=e).app_id,n=t.channel,r=t.onTokenReady,o=C[n]+"/webid",a=new A(!1),s="__tea_cache_tokens_"+i,(c=a.getItem(s))&&c.web_id?r(c.web_id):H(o,{app_key:"",app_id:i,url:location.href,user_agent:window.navigator.userAgent,referer:document.referrer},3e3,!1,(function(e){if(e&&0===e.e){r(e.web_id);var t={web_id:e.web_id,user_unique_id:e.web_id,timestamp:Date.now()};a.setItem(s,t)}else r("")}),(function(){r("")}),!0)},e.prototype.destoryInstace=function(){this.destroyInstance||(this.destroyInstance=!0,this.off(G.TokenComplete))},e.plugins=[],e}(),te="__rangers_ab_style__",ie={},ne=[],re=function(e){e.length&&e.forEach((function(e){ne.push(e)}))};function oe(e,t,i,n){var r=e&&e.source||window.opener||window.parent,o=e&&e.origin||n||"*",a={type:t,payload:i};r.postMessage(JSON.stringify(a),o)}function ae(e,t){ie[e]=ie[e]||[],ie[e].push(t)}function se(e){if(ne.some((function(e){return"*"===e}))||ne.some((function(t){return e.origin.indexOf(t)>-1}))){var t=e.data;if("string"==typeof e.data)try{t=JSON.parse(e.data)}catch(e){t=void 0}if(!t)return;var i=t.type,n=t.payload;ie[i]&&ie[i].forEach((function(t){"function"==typeof t&&t(e,n)}))}}function ce(e,t){var i=n({},e);delete i.filter,(window.opener||window.parent).postMessage({type:"tea:sdk:info",config:i,version:t},"*"),window.addEventListener("message",se,!1)}var le,ue="",he=!1;function pe(e){var t=e.event,i=e.editorUrl;e.collectInstance,e.fromSession,he||(he=!0,f(i,(function(){oe(t,"abEditorScriptloadSuccess")}),(function(){t&&oe(t,"abEditorScriptloadError"),he=!1})))}!function(e){e[e.Var=0]="Var",e[e.All=1]="All"}(le||(le={}));var de=function(){function e(){this.fetchStatus="no",this.refreshFetchStatus="complete",this.versions=[],this.extVersions=[],this.mulilinkVersions=[],this.enable_multilink=!1,this.enable_ab_visual=!1,this.editMode=!1,this.callbacks=[],this.data=null,this.changeListener=new Map,this.readyStatus=!1,this.exposureCache=[]}return e.prototype.apply=function(e,t){var i=this;if(this.collect=e,this.config=t,this.config.enable_ab_test){var n=t.enable_multilink,r=t.ab_channel_domain,o=t.enable_ab_visual,a=t.ab_cross,s=t.ab_cookie_domain,c=r||p(O[t.channel||"cn"]),l=e.adapters,u=l.storage,h=l.fetch;this.cacheStorgae=new u(!1),this.fetch=h,this.enable_multilink=n,this.enable_ab_visual=o,this.abKey="__tea_sdk_ab_version_"+t.app_id,this.ab_cross=a,this.ab_cookie_domain=s||"",this.fetchUrl=c+"/service/2/abtest_config/",this.reportUrl=""+e.configManager.getUrl("event"),this.exposureLimit=t.exposure_limit||20,this.ab_batch_time=t.ab_batch_time||500;var d=this.collect.Types;this.types=d,this.collect.on(d.TokenChange,(function(e){"uuid"===e&&i.readyStatus&&(i.clearCache(),i.fetchAB())})),this.collect.on(d.TokenReset,(function(e){"uuid"===e&&i.readyStatus&&(i.clearCache(),i.fetchAB())})),this.collect.on(d.AbVar,(function(e){var t=e.name,n=e.defaultValue,r=e.callback;i.getVar(t,n,r)})),this.collect.on(d.AbAllVars,(function(e){i.getAllVars(e)})),this.collect.on(d.AbConfig,(function(e){var t=e.params,n=e.callback;i.getABconfig(t,n)})),this.collect.on(d.AbExternalVersion,(function(e){i.setExternalAbVersion(e)})),this.collect.on(d.AbOpenLayer,(function(){i.openOverlayer()})),this.collect.on(d.AbCloseLayer,(function(){i.closeOverlayer()})),this.collect.on(d.AbVersionChangeOn,(function(e){i.changeListener.set(e,e)})),this.collect.on(d.AbVersionChangeOff,(function(e){i.changeListener.get(e)&&i.changeListener.delete(e)})),this.loadMode(),(this.enable_ab_visual||this.enable_multilink)&&this.openOverlayer(this.config.multilink_timeout_ms||500),this.checkLocal(),this.ready("ab"),this.readyStatus||(this.fetchAB(),this.readyStatus=!0),this.collect.emit(d.AbReady)}},e.prototype.ready=function(e){var t=this;if(this.collect.set(e),this.collect.hook._hooksCache.hasOwnProperty(e)){var i=this.collect.hook._hooksCache[e];if(!Object.keys(i).length)return;var n=function(e){i[e].length&&i[e].forEach((function(i){t.collect.hook.emit(e,i)}))};for(var r in i)n(r)}},e.prototype.loadMode=function(){var e,t,i=function(){try{return JSON.parse(atob(window.name))||void 0}catch(e){return}}(),n="";if(i){var r=i.scenario,o=i.href;r?(this.editMode=!0,n=r):!o||-1===o.indexOf("datatester")&&-1===o.indexOf("visual-editor")||(this.editMode=!0,n="visual-editor")}this.enable_ab_visual&&(function(e,t){window.TEAVisualEditor=window.TEAVisualEditor||{},re(["*"]);var i,n="";ce(t,M);var r="";try{var o=window.performance.getEntriesByType("resource");if(o&&o.length&&(o.forEach((function(e){"script"===e.initiatorType&&e.name&&-1!==e.name.indexOf("collect")&&(r=e.name)})),r||document.currentScript&&(r=document.currentScript.src),r&&(i=r.split("/"))&&i.length)){n="https:/";for(var a=2;a<i.length&&a!==i.length-1;a++)n=n+"/"+i[a];n+="/visual-ab-core"}}catch(e){}ae("tea:openVisualABEditor",(function(i){var r=i.data;if("string"==typeof i.data)try{r=JSON.parse(i.data)}catch(e){r=void 0}if(r){var o=r.lang;if(r.appId!==t.app_id)return void oe(i,"appIdError");var a=r.version;ue=a&&n?n+(a?"."+a:".1.0.1")+".js?query="+Date.now():"https://lf-cdn-tos.bytescm.com/obj/static/log-sdk/collect/visual-ab-core.js?query="+Date.now(),window.TEAVisualEditor.lang=o,window.TEAVisualEditor.__ab_domin=t.channel_domain||"",pe({event:i,editorUrl:ue,collectInstance:e})}}))}(this.collect,this.config),"visual-editor"===n)?this.collect.destoryInstace():this.enable_multilink&&(e=this.collect,t=this.config,window.TEAVisualEditor=window.TEAVisualEditor||{},window.TEAVisualEditor.appId=t.app_id,ae("tea:openTesterEventInspector",(function(t){var i=t.data;if("string"==typeof t.data)try{i=JSON.parse(t.data)}catch(e){i=void 0}if(i){var n=i.referrer,r=i.lang,o=i.appId;window.TEAVisualEditor.__editor_ajax_domain=n||"",window.TEAVisualEditor.__ab_appId=o||"",window.TEAVisualEditor.lang=r||"",pe({event:t,editorUrl:"https://lf3-data.volccdn.com/obj/data-static/log-sdk/collect/tester-event-inspector.js?query="+Date.now(),collectInstance:e})}})))},e.prototype.checkLocal=function(){var e=this.getABCache(),t=e.ab_version,i=e.ab_ext_version,n=e.ab_version_multilink,r=e.data,o=this.checkFromUrl();o?this.mulilinkVersions.push(o):this.mulilinkVersions=n||[],this.extVersions=i||[],this.versions=t||[],this.data=r;var a=this.versions.concat(this.extVersions);this.enable_multilink&&(a=a.concat(this.mulilinkVersions)),this.configVersions(a.join(","))},e.prototype.checkFromUrl=function(){var e=v(window.location.href);return e&&e.vid?e.vid:""},e.prototype.updateVersions=function(){var e=this.extVersions.length?this.versions.concat(this.extVersions):this.versions;this.enable_multilink&&(e=e.concat(this.mulilinkVersions)),this.configVersions(e.join(",")),this.updateABCache(),this.changeListener.size>0&&this.changeListener.forEach((function(t){"function"==typeof t&&t(e)}))},e.prototype.configVersions=function(e){this.collect.configManager.setAbVersion(e)},e.prototype.getVar=function(e,t,i){if(!e)throw new Error("variable must not be empty");if(void 0===t)throw new Error("variable no default value");if("function"!=typeof i)throw new Error("callback must be a function");var n={name:e,defaultValue:t,callback:i,type:le.Var};"complete"===this.fetchStatus&&"complete"===this.refreshFetchStatus?this.getRealVar(n,e):this.callbacks.push(n)},e.prototype.getRealVar=function(e,t){var i=e.name,n=e.defaultValue,r=e.callback,o=this.data;if(o){if(l(o[i])){var a=o[i].vid;return"$ab_url"===t?this.mulilinkVersions.includes(a)||this.mulilinkVersions.push(a):this.versions.includes(a)||this.versions.push(a),this.updateVersions(),this.fechEvent(a,t,n),r(o[i].val),void this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"SDK \u66dd\u5149\u4e86\u5b9e\u9a8c"+i,level:"info",time:Date.now(),data:o[i]})}this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"SDK \u8c03\u7528getVar",level:"info",time:Date.now(),data:n}),r(n)}else r(n)},e.prototype.getAllVars=function(e){if("function"!=typeof e)throw new Error("callback must be a function");var t={callback:e,type:le.All};"complete"===this.fetchStatus&&"complete"===this.refreshFetchStatus?this.getRealAllVars(t):this.callbacks.push(t)},e.prototype.getRealAllVars=function(e){(0,e.callback)(this.data?JSON.parse(JSON.stringify(this.data)):{}),this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"SDK \u8c03\u7528getAllVars",level:"info",time:Date.now(),data:this.data})},e.prototype.fechEvent=function(e,t,i){try{if(this.config.disable_track_event)return;if(!e)return;var n=this.collect.configManager.get(),r=n.header,o=n.user,a=this.getABCache();if(a&&a.uuid&&a.uuid!==o.user_unique_id)return;var s={event:"abtest_exposure",ab_sdk_version:""+e,params:JSON.stringify({app_id:this.config.appId,ab_url:"$ab_url"===t?i:window.location.href}),local_time_ms:Date.now()};r.custom=JSON.stringify(r.custom);var c={events:[s],user:o,header:r};"$ab_url"===t&&window.navigator.sendBeacon?window.navigator.sendBeacon(this.reportUrl,JSON.stringify([c])):this.reportExposure(c)}catch(e){this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"\u53d1\u751f\u4e86\u5f02\u5e38",level:"error",time:Date.now(),data:e.message})}},e.prototype.reportExposure=function(e){var t=this;this.exposureCache.push(e),this.reportTimeout&&clearTimeout(this.reportTimeout),this.exposureCache.length>=this.exposureLimit?this.report():this.reportTimeout=setTimeout((function(){t.report(),clearTimeout(t.reportTimeout)}),this.ab_batch_time)},e.prototype.report=function(){var e=this;this.fetch(this.reportUrl,this.exposureCache,2e4),this.exposureCache.forEach((function(t){e.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_EVENT,info:"\u57cb\u70b9\u4e0a\u62a5\u6210\u529f",time:Date.now(),data:[t],code:200,status:"success"})})),this.exposureCache=[]},e.prototype.setExternalAbVersion=function(e){this.extVersions=[e],this.updateVersions()},e.prototype.getABconfig=function(e,t){var i=Object.keys(e);i&&i.length&&this.collect.configManager.set(e),this.fetchAB(t)},e.prototype.get=function(e){if(this.ab_cross){var t=this.cacheStorgae.getCookie(e,this.ab_cookie_domain);return t?JSON.parse(t):{}}return this.cacheStorgae.getItem(e)},e.prototype.set=function(e,t){this.ab_cross?this.cacheStorgae.setCookie(e,t,2592e6,this.ab_cookie_domain):this.cacheStorgae.setItem(e,t),this.collect.configManager.setAbCache(t)},e.prototype.getABCache=function(e){var t={ab_version:[],ab_ext_version:[],ab_version_multilink:[],data:null,timestamp:+new Date,uuid:""};return t=this.get(this.abKey)||t,e?t[e]:t},e.prototype.updateABCache=function(){var e=this.getABCache();e.ab_version_multilink=this.mulilinkVersions,e.ab_ext_version=this.extVersions,e.ab_version=this.versions,e.timestamp=Date.now(),this.set(this.abKey,e)},e.prototype.setAbCache=function(e){var t=this.getABCache();t.data=this.data,t.uuid=e,t.timestamp=Date.now(),this.set(this.abKey,t)},e.prototype.clearCache=function(){this.refreshFetchStatus="ing",this.data={},this.extVersions=[],this.mulilinkVersions=[],this.versions=[],this.collect.configManager.clearAbCache()},e.prototype.openOverlayer=function(e){var t=this;if(function(){if(!document.getElementById(te)){var e="body { opacity: 0 !important; }",t=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.id=te,i.type="text/css",i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e)),t.appendChild(i)}}(),e)var i=setTimeout((function(){t.closeOverlayer(),clearTimeout(i)}),e)},e.prototype.closeOverlayer=function(){var e;(e=document.getElementById(te))&&e.parentElement.removeChild(e)},e.prototype.fetchComplete=function(e,t){var i=this;try{if(e&&"[object Object]"==Object.prototype.toString.call(e)){this.data=e,this.setAbCache(t);var n=[];Object.keys(e).forEach((function(t){var i=e[t].vid;i&&n.push(i)})),this.versions=this.versions.filter((function(e){return n.includes(e)}));var r=e.$ab_url,o=e.$ab_modification;if(o&&o.val&&this.enable_ab_visual){if(this.collect.destroyInstance)return;this.getVar("$ab_modification",window.location.href,(function(){var e;e=o.val,window.TEAVisualEditor=window.TEAVisualEditor||{},window.TEAVisualEditor.__ab_config=e,f("https://lf-cdn-tos.bytescm.com/obj/static/log-sdk/collect/visual-ab-loader.js?query="+Date.now(),(function(){}),(function(){})),i.closeOverlayer()}))}else if(r&&this.enable_multilink){this.mulilinkVersions=this.mulilinkVersions.filter((function(e){return n.includes(e)}));var a=r.val,s=r.vid;a&&s&&this.getVar("$ab_url",a,(function(){i.editMode||(a!==window.location.href?setTimeout((function(){if(!i.collect.destroyInstance){var e=""+a;e=-1===e.indexOf("http")?"https://"+e:e,_(e).host!==location.host?e=e+"&vid="+s:window.history.replaceState("","",e),window.location.href=e}}),100):i.closeOverlayer())}))}this.updateVersions()}else this.closeOverlayer();this.callbacks.forEach((function(e){return i[e.type===le.Var?"getRealVar":"getRealAllVars"](e,"")})),this.callbacks=[]}catch(e){}},e.prototype.fetchAB=function(e){var t=this,i=this.collect.configManager.get(),r={header:n({aid:this.config.app_id},i.user||{},i.header||{},{ab_sdk_version:this.collect.configManager.getAbVersion(),ab_url:window.location.href})};this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK \u53d1\u8d77AB\u5b9e\u9a8c\u8bf7\u6c42",level:"info",logType:"fetch",time:Date.now(),data:r}),this.fetch(this.fetchUrl,r,this.config.ab_timeout||3e3,!1,(function(n){t.fetchStatus="complete",t.refreshFetchStatus="complete";var r=n.data;"success"===n.message?(t.fetchComplete(r,i.user.user_unique_id),e&&e(r)):(t.fetchComplete(null,i.user.user_unique_id),e&&e(null)),t.collect.emit(t.types.AbComplete,r),t.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"AB\u5b9e\u9a8c\u8bf7\u6c42\u6210\u529f",level:"info",logType:"fetch",time:Date.now(),data:r})}),(function(){t.fetchStatus="complete",t.refreshFetchStatus="complete",t.fetchComplete(null,i.user.user_unique_id),t.collect.emit(t.types.AbTimeout),e&&e(null),t.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"AB\u5b9e\u9a8c\u8bf7\u6c42\u7f51\u7edc\u5f02\u5e38",level:"error",logType:"fetch",time:Date.now()})}))},e.prototype.filterUrl=function(e){try{var t="";-1!==e.indexOf("&multilink=true")?t="&multilink=true[\0-\xff]*":-1!==e.indexOf("?multilink=true")&&(t="\\?multilink=true[\0-\xff]*");var i=new RegExp(t,"g");e=e.replace(i,"")}catch(e){}return e},e}(),fe=function(){function e(){}return e.prototype.apply=function(e,t){var i=this;if(e.adapters.fetch,t.event_verify_url&&"string"==typeof t.event_verify_url&&(this.url=t.event_verify_url+"/v1/list_test",this.url)){var n=e.Types;e.on(n.SubmitBefore,(function(e){window.navigator.sendBeacon(i.url,JSON.stringify(e))}))}},e}(),ge=function(){function e(e,t){this.maxDuration=432e5,this.aliveDTime=6e4,this.options={aliveName:"predefine_page_alive",params:{}},this.collect=e,this.config=t,this.pageStartTime=Date.now(),this.sessionStartTime=this.pageStartTime,this.timerHandler=null,l(t.enable_stay_duration)&&(this.options=Object.assign(this.options,t.enable_stay_duration))}return e.prototype.setParams=function(e,t,i){this.set_path=e,this.set_url=i,this.set_title=t},e.prototype.enable=function(e,t,i){this.url_path=e,this.url=i,this.title=t,this.disableCallback=this.enablePageAlive()},e.prototype.disable=function(){this.disableCallback(),this.pageStartTime=Date.now()},e.prototype.sendEvent=function(e,t){void 0===t&&(t=!1);var i=t?this.aliveDTime:Date.now()-this.sessionStartTime;i<0||i>this.aliveDTime||Date.now()-this.pageStartTime>this.maxDuration||(this.collect.beconEvent(this.options.aliveName,n({url_path:this.getParams("url_path"),title:this.getParams("title"),url:this.getParams("url"),duration:i,is_support_visibility_change:g(),startTime:this.sessionStartTime,hidden:document.visibilityState,leave:e},this.options.params)),this.sessionStartTime=Date.now())},e.prototype.getParams=function(e){switch(e){case"url_path":return this.set_path||this.url_path||location.pathname;case"title":return this.set_title||this.title||document.title||location.pathname;case"url":return this.set_url||this.url||location.href}},e.prototype.setUpTimer=function(){var e=this;return this.timerHandler&&clearInterval(this.timerHandler),setInterval((function(){Date.now()-e.sessionStartTime>e.aliveDTime&&e.sendEvent(!1,!0)}),1e3)},e.prototype.visibilitychange=function(){"hidden"===document.visibilityState?this.timerHandler&&(clearInterval(this.timerHandler),this.sendEvent(!1)):"visible"===document.visibilityState&&(this.sessionStartTime=Date.now(),this.timerHandler=this.setUpTimer())},e.prototype.beforeunload=function(){document.hidden||this.sendEvent(!0)},e.prototype.enablePageAlive=function(){var e=this;this.timerHandler=this.setUpTimer();var t=this.visibilitychange.bind(this),i=this.beforeunload.bind(this);return document.addEventListener("visibilitychange",t),window.addEventListener("pagehide",i),function(){e.beforeunload(),document.removeEventListener("visibilitychange",t),window.removeEventListener("pagehide",i)}},e}(),_e=function(){function e(e,t){var i=this;this.maxDuration=432e5,this.aliveDTime=6e4,this.options={closeName:"predefine_page_close",params:{}},this.visibilitychange=function(){"hidden"===document.visibilityState?i.activeEndTime=Date.now():"visible"===document.visibilityState&&(i.activeEndTime&&(i.totalTime+=i.activeEndTime-i.activeStartTime,i.activeTimes+=1),i.activeEndTime=void 0,i.activeStartTime=Date.now())},this.beforeunload=function(){if(i.totalTime+=(i.activeEndTime||Date.now())-i.activeStartTime,i.config.autotrack)try{window.sessionStorage.setItem("_tea_cache_duration",JSON.stringify({duration:i.totalTime,page_title:document.title||location.pathname}))}catch(e){}i.sendEventPageClose()},this.collect=e,this.config=t,this.maxDuration=t.maxDuration||t.max_duration||864e5,this.pageStartTime=Date.now(),l(t.enable_stay_duration)&&(this.options=Object.assign(this.options,t.enable_stay_duration)),this.resetData()}return e.prototype.setParams=function(e,t,i){this.set_path=e,this.set_url=i,this.set_title=t},e.prototype.resetParams=function(e,t,i){this.url_path=e,this.url=i,this.title=t},e.prototype.enable=function(e,t,i){this.url_path=e,this.url=i,this.title=t,this.disableCallback=this.enablePageClose()},e.prototype.disable=function(){this.disableCallback()},e.prototype.resetData=function(){this.activeStartTime=void 0===this.activeStartTime?this.pageStartTime:Date.now(),this.activeEndTime=void 0,this.activeTimes=1,this.totalTime=0,this.resetParams(location.pathname,location.href,document.title)},e.prototype.sendEventPageClose=function(){var e=Date.now()-this.pageStartTime;this.totalTime<0||e<0||this.totalTime>=this.maxDuration||(this.collect.beconEvent(this.options.closeName,n({url_path:this.getParams("url_path"),title:this.getParams("title"),url:this.getParams("url"),active_times:this.activeTimes,duration:this.totalTime,total_duration:e,is_support_visibility_change:g()},this.options.params)),this.pageStartTime=Date.now(),this.resetData())},e.prototype.getParams=function(e){switch(e){case"url_path":return this.set_path||this.url_path||location.pathname;case"title":return this.set_title||this.title||document.title||location.pathname;case"url":return this.set_url||this.url||location.href}},e.prototype.enablePageClose=function(){var e=this,t=this.visibilitychange.bind(this),i=this.beforeunload.bind(this);return document.addEventListener("visibilitychange",t),window.addEventListener("pagehide",i),function(){e.beforeunload(),document.removeEventListener("visibilitychange",t),window.removeEventListener("pagehide",i)}},e}(),ve=function(){function e(){}return e.prototype.apply=function(e,t){var i=this;if(this.collect=e,this.config=t,this.config.enable_stay_duration){this.title=document.title||location.pathname,this.url=location.href,this.url_path=location.pathname,this.pageAlive=new ge(e,t),this.pageClose=new _e(e,t);var n=this.collect.Types;this.collect.on(n.ResetStay,(function(e){var t=e.url_path,n=e.title,r=e.url;i.resetStayDuration(t,n,r)})),this.collect.on(n.RouteChange,(function(e){e.init||t.disable_route_report||i.resetStayDuration()})),this.collect.on(n.SetStay,(function(e){var t=e.url_path,n=e.title,r=e.url;i.setStayParmas(t,n,r)})),this.enable(this.url_path,this.title,this.url),this.ready(n.Stay),this.collect.emit(n.StayReady)}},e.prototype.ready=function(e){var t=this;if(this.collect.set(e),this.collect.hook._hooksCache.hasOwnProperty(e)){var i=this.collect.hook._hooksCache[e];if(!Object.keys(i).length)return;var n=function(e){i[e].length&&i[e].forEach((function(i){t.collect.hook.emit(e,i)}))};for(var r in i)n(r)}},e.prototype.enable=function(e,t,i){this.pageAlive.enable(e,t,i),this.pageClose.enable(e,t,i)},e.prototype.disable=function(){this.pageAlive.disable(),this.pageClose.disable()},e.prototype.setStayParmas=function(e,t,i){void 0===e&&(e=""),void 0===t&&(t=""),void 0===i&&(i=""),this.pageAlive.setParams(e,t,i),this.pageClose.setParams(e,t,i),this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK \u6267\u884c resetStayParams",level:"info",time:Date.now(),data:{url_path:e,title:t,url:i}})},e.prototype.reset=function(e,t,i){this.disable(),this.enable(e,t,i)},e.prototype.resetStayDuration=function(e,t,i){this.reset(e,t,i),this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"SDK \u6267\u884c resetStayDuration",level:"info",time:Date.now(),data:{url_path:e,title:t,url:i}})},e}(),ye=function(){function e(){}return e.prototype.apply=function(e,t){var i=this;this.collect=e,this.config=t,this.duration=6e4,this.reportUrl=e.configManager.getDomain()+"/profile/list";var n=e.Types,r=e.adapters.fetch;this.eventCheck=new L(e,t),this.fetch=r,this.cache={},this.collect.on(n.ProfileSet,(function(e){i.setProfile(e)})),this.collect.on(n.ProfileSetOnce,(function(e){i.setOnceProfile(e)})),this.collect.on(n.ProfileUnset,(function(e){i.unsetProfile(e)})),this.collect.on(n.ProfileIncrement,(function(e){i.incrementProfile(e)})),this.collect.on(n.ProfileAppend,(function(e){i.appendProfile(e)})),this.collect.on(n.ProfileClear,(function(){i.cache={}})),this.ready(n.Profile)},e.prototype.ready=function(e){var t=this;if(this.collect.set(e),this.collect.hook._hooksCache.hasOwnProperty(e)){var i=this.collect.hook._hooksCache[e];if(!Object.keys(i).length)return;var n=function(e){i[e].length&&i[e].forEach((function(i){t.collect.hook.emit(e,i)}))};for(var r in i)n(r)}},e.prototype.report=function(e,t){void 0===t&&(t={});try{if(this.config.disable_track_event)return;var i=[];i.push(this.collect.processEvent(e,t));var n=this.collect.eventManager.merge(i);this.fetch(this.reportUrl,n),this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_EVENT,info:"\u57cb\u70b9\u4e0a\u62a5\u6210\u529f",time:Date.now(),data:n,code:200,status:"success"})}catch(e){this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"\u53d1\u751f\u4e86\u5f02\u5e38",level:"error",time:Date.now(),data:e.message})}},e.prototype.setProfile=function(e){var t=this.formatParams(e);t&&Object.keys(t).length&&(this.pushCache(t),this.report("__profile_set",n({},t,{profile:!0})))},e.prototype.setOnceProfile=function(e){var t=this.formatParams(e,!0);t&&Object.keys(t).length&&(this.pushCache(t),this.report("__profile_set_once",n({},t,{profile:!0})))},e.prototype.incrementProfile=function(e){e&&this.report("__profile_increment",n({},e,{profile:!0}))},e.prototype.unsetProfile=function(e){if(e){var t={};t[e]="1",this.report("__profile_unset",n({},t,{profile:!0}))}},e.prototype.appendProfile=function(e){if(e){var t={};for(var i in e)("string"==typeof e[i]||"Array"===Object.prototype.toString.call(e[i]).slice(8,-1))&&(t[i]=e[i]);Object.keys(t).length&&this.report("__profile_append",n({},t,{profile:!0}))}},e.prototype.pushCache=function(e){var t=this;Object.keys(e).forEach((function(i){t.cache[i]={val:t.clone(e[i]),timestamp:Date.now()}}))},e.prototype.formatParams=function(e,t){var i=this;void 0===t&&(t=!1);try{if(!e||"[object Object]"!==Object.prototype.toString.call(e))return;var n={};for(var r in e)("string"==typeof e[r]||"number"==typeof e[r]||"Array"===Object.prototype.toString.call(e[r]).slice(8,-1))&&(n[r]=e[r]);var o=Object.keys(n);if(!o.length)return;if(!this.eventCheck.checkEventParams(n))return;var a=Date.now();return o.filter((function(n){var r=i.cache[n];return t?!r:!(r&&i.compare(r.val,e[n])&&a-r.timestamp<i.duration)})).reduce((function(e,t){return e[t]=n[t],e}),{})}catch(e){this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"\u53d1\u751f\u4e86\u5f02\u5e38",level:"error",time:Date.now(),data:e.message})}},e.prototype.compare=function(e,t){try{return JSON.stringify(e)===JSON.stringify(t)}catch(e){return this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"\u53d1\u751f\u4e86\u5f02\u5e38",level:"error",time:Date.now(),data:e.message}),!1}},e.prototype.clone=function(t){try{return JSON.parse(JSON.stringify(t))}catch(e){return this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"\u53d1\u751f\u4e86\u5f02\u5e38",level:"error",time:Date.now(),data:e.message}),t}},e.prototype.unReady=function(){},e}(),me=function(){function e(){var e=this;this.setInterval=function(){e.clearIntervalFunc=function(e,t){void 0===e&&(e=function(){}),void 0===t&&(t=1e3);var i,n=Date.now()+t;return i=window.setTimeout((function r(){var o=Date.now()-n;e(),n+=t,i=window.setTimeout(r,Math.max(0,t-o))}),t),function(){window.clearTimeout(i)}}((function(){e.isSessionhasEvent&&e.endCurrentSession()}),e.sessionInterval)},this.clearInterval=function(){e.clearIntervalFunc&&e.clearIntervalFunc()}}return e.prototype.apply=function(e,t){var i=this;if(this.collect=e,!t.disable_heartbeat){this.sessionInterval=6e4,this.startTime=0,this.lastTime=0,this.setInterval();var n=this.collect.Types;this.collect.on(n.SessionReset,(function(){i.process()}))}},e.prototype.endCurrentSession=function(){this.collect.event("_be_active",{start_time:this.startTime,end_time:this.lastTime,url:window.location.href,referrer:window.document.referrer,title:document.title||location.pathname}),this.isSessionhasEvent=!1,this.startTime=0},e.prototype.process=function(){this.isSessionhasEvent||(this.isSessionhasEvent=!0,this.startTime=+new Date);var e=this.lastTime||+new Date;this.lastTime=+new Date,this.lastTime-e>this.sessionInterval&&(this.clearInterval(),this.endCurrentSession(),this.setInterval())},e}(),be=function(){function e(){}return e.prototype.apply=function(e,t){var i=this;if(this.collect=e,this.config=t,!this.config.channel_domain){var n=e.adapters.fetch;if(this.fetch=n,!t.disable_track_event&&!t.disable_sdk_monitor){this.url=e.configManager.getUrl("event");var r=this.collect.Types;this.collect.on(r.Ready,(function(){i.sdkOnload()})),this.collect.on(r.SubmitError,(function(e){var t=e.type,n=e.eventData,r=e.errorCode;"f_data"===t&&i.sdkError(n,r)}))}}},e.prototype.sdkOnload=function(){var e=this;try{var t=this.collect.configManager.get(),i=t.header,n=t.user,r=i.app_id,o=i.app_name,a=i.sdk_version,s=n.web_id,c={events:[{event:"onload",params:JSON.stringify({app_id:r,app_name:o||"",sdk_version:a,sdk_type:"npm",sdk_config:this.config,sdk_desc:"TOC",url:location.href}),local_time_ms:Date.now()}],user:{user_unique_id:s},header:{}};setTimeout((function(){e.fetch(e.url,[c],3e4,!1,(function(){}),(function(){}),"566f58151b0ed37e")}),16)}catch(e){}},e.prototype.sdkError=function(e,t){var i=this;try{var n=e[0],r=n.user,o=n.header,a=[];e.forEach((function(e){e.events.forEach((function(e){a.push(e)}))}));var s={events:a.map((function(e){return{event:"on_error",params:JSON.stringify({error_code:t,app_id:o.app_id,app_name:o.app_name||"",error_event:e.event,sdk_version:o.sdk_version,local_time_ms:e.local_time_ms,tea_event_index:Date.now(),params:e.params,header:JSON.stringify(o),user:JSON.stringify(r)}),local_time_ms:Date.now()}})),user:{user_unique_id:r.user_unique_id},header:{}};setTimeout((function(){i.fetch(i.url,[s],3e4,!1,(function(){}),(function(){}),"566f58151b0ed37e")}),16)}catch(e){}},e}();function Se(e,t){if(void 0===t&&(t="list"),!e)return!1;if(t&&"list"===t){if(["LI","TR","DL"].includes(e.nodeName))return!0;if(e.dataset&&e.dataset.hasOwnProperty("teaIdx"))return!0;if(e.hasAttribute&&e.hasAttribute("data-tea-idx"))return!0}else{if(["A","BUTTON"].includes(e.nodeName))return!0;if(e.dataset&&e.dataset.hasOwnProperty("teaContainer"))return!0;if(e.hasAttribute&&e.hasAttribute("data-tea-container"))return!0}return!1}function we(e){for(var t=e;t&&!Se(t,"container");){if("HTML"===t.nodeName||"BODY"===t.nodeName)return e;t=t.parentElement}return t||e}function Ee(e){var t="";return 3===e.nodeType?t=e.textContent.trim():e.dataset&&e.dataset.hasOwnProperty("teaTitle")||e.hasAttribute("ata-tea-title")?t=e.getAttribute("data-tea-title"):e.hasAttribute("title")?t=e.getAttribute("title"):"INPUT"===e.nodeName&&["button","submit"].includes(e.getAttribute("type"))?t=e.getAttribute("value"):"IMG"===e.nodeName&&e.getAttribute("alt")&&(t=e.getAttribute("alt")),t.slice(0,200)}var ke=function(e,t){return e.hasAttribute?e.hasAttribute(t):e.attributes?!(!e.attributes[t]||!e.attributes[t].specified):void 0},Te=function(e,t){if("string"==typeof t)return ke(e,t);if(u(t)){for(var i=!1,n=0;n<t.length;n++)if(ke(e,t[n])){i=!0;break}return i}},De=function(e,t){var i={};if("string"==typeof t)ke(e,t)&&(i.attrs=e.getAttribute(t));else if(u(t))for(var n=0;n<t.length;n++)ke(e,t[n])&&(i[t[n]]=e.getAttribute(t[n]));return i},Ie=function(){function e(e,t,i){var r=this;this.statistics=!1,this.pageView=!1,this.clickEvent=function(e){(function(e,t){if(window.innerHeight,window.innerWidth,1!==e.nodeType)return!1;if(!t.svg&&function(e){if("svg"===e.tagName.toLowerCase())return!0;for(var t=e.parentElement,i=!1;t;)"svg"===t.tagName.toLowerCase()?(t=null,i=!0):t=t.parentElement;return i}(e))return!1;if(["HTML","BODY"].includes(e.tagName.toUpperCase()))return!1;var i=e;return!("none"===i.style.display||!Se(i,"container")&&!function(e){if(e.children.length){var t=e.children;return![].slice.call(t).some((function(e){return e.children.length>0}))}return!0}(i)&&!t.svg)})(e.target,r.options)&&r.eventHandel({eventType:"dom",eventName:"click"},e)},this.changeEvent=function(e){r.eventHandel({eventType:"dom",eventName:"change"},e)},this.submitEvent=function(e){r.eventHandel({eventType:"dom",eventName:"submit"},e)},this.getPageViewEvent=function(e,t){t&&"pushState"===t&&r.eventHandel({eventType:"dom",eventName:"beat"},n({beat_type:0},e)),r.eventHandel({eventType:"dom",eventName:"page_view"},e)},this.getPageLoadEvent=function(e){r.eventHandel({eventType:"dom",eventName:"page_statistics"},{lcp:e})},this.config=i.getConfig().eventConfig,this.collect=t,this.options=e,this.beatTime=e.beat}return e.prototype.init=function(e){this.eventHandel=e;var t=this.config.mode;this.addListener(t)},e.prototype.addListener=function(e){var t=this;if("proxy-capturing"===e){if(this.config.click&&window.document.addEventListener("click",this.clickEvent,!0),this.config.change&&window.document.addEventListener("change",this.changeEvent,!0),this.config.submit&&window.document.addEventListener("submit",this.submitEvent,!0),this.config.pv){this.collect.on("route-change",(function(e){var i=e.config,n=e.name;t.getPageViewEvent(i,n),t.pageView=!0}));var i=setTimeout((function(){t.pageView||(t.getPageViewEvent(t.getDefaultConfig()),t.pageView=!0,clearTimeout(i))}),2e3)}if(this.config.beat){try{"complete"===document.readyState?this.beatEvent(this.beatTime):window.addEventListener("load",(function(){t.beatEvent(t.beatTime)}));var n=0,r=null;window.addEventListener("scroll",(function(){clearTimeout(r),r=setTimeout(o,500),n=document.documentElement.scrollTop||document.body.scrollTop}));var o=function(){(document.documentElement.scrollTop||document.body.scrollTop)==n&&t.eventHandel({eventType:"dom",eventName:"beat"},{beat_type:1})}}catch(e){}try{var a=window.performance&&window.performance.getEntriesByType("paint");if(a&&a.length){new PerformanceObserver((function(e){var i=e.getEntries(),n=i[i.length-1],r=n.renderTime||n.loadTime;t.statistics||(t.getPageLoadEvent(r),t.statistics=!0)})).observe({entryTypes:["largest-contentful-paint"]});var s=setTimeout((function(){t.statistics||(t.getPageLoadEvent(a[0].startTime||0),t.statistics=!0,clearTimeout(s))}),2e3)}else this.getPageLoadEvent(0)}catch(e){this.getPageLoadEvent(0)}}}},e.prototype.removeListener=function(){window.document.removeEventListener("click",this.clickEvent,!0),window.document.removeEventListener("change",this.changeEvent,!0),window.document.removeEventListener("submit",this.submitEvent,!0)},e.prototype.beatEvent=function(e){var t=this;try{var i;this.eventHandel({eventType:"dom",eventName:"beat"},{beat_type:3}),this.beatTime&&(i=setInterval((function(){t.eventHandel({eventType:"dom",eventName:"beat"},{beat_type:2})}),e)),d((function(){t.eventHandel({eventType:"dom",eventName:"beat",eventSend:"becon"},{beat_type:0}),t.beatTime&&clearInterval(i)}))}catch(e){}},e.prototype.getDefaultConfig=function(){return{is_html:1,url:location.href,referrer:document.referrer,page_key:location.href,refer_page_key:document.referrer,page_title:document.title||location.pathname,page_manual_key:"",refer_page_manual_key:"",refer_page_title:"",page_path:location.pathname,page_host:location.host}},e}(),Ae={eventConfig:{mode:"proxy-capturing",submit:!1,click:!0,change:!1,pv:!0,beat:!0,hashTag:!1,impr:!1},scoutConfig:{mode:"xpath"}},xe=function(){function e(e,t){this.config=e,this.config.eventConfig=Object.assign(this.config.eventConfig,t)}return e.prototype.getConfig=function(){return this.config},e.prototype.setConfig=function(e){return this.config=e},e}();function Oe(e,t,i,n){var r={},o=function(e){if(e){var t=e.getBoundingClientRect(),i=t.width,n=t.height;return{left:t.left,top:t.top,element_width:i,element_height:n}}}(t),a=function(e,t){void 0===e&&(e={}),void 0===t&&(t={});var i=e.clientX,n=e.clientY,r=t.left,o=t.top,a=i-r>=0?i-r:0,s=n-o>=0?n-o:0;return{touch_x:Math.floor(a),touch_y:Math.floor(s)}}(e,o),s=o.element_width,c=o.element_height,l=a.touch_x,u=a.touch_y,h=function(e){for(var t=[];null!==e.parentElement;)t.push(e),e=e.parentElement;var i=[],n=[];return t.forEach((function(e){var t=function(e){if(null===e)return{str:"",index:0};var t=0,i=e.parentElement;if(i)for(var n=i.children,r=0;r<n.length&&n[r]!==e;r++)n[r].nodeName===e.nodeName&&t++;return{str:[e.nodeName.toLowerCase(),Se(e,"list")?"[]":""].join(""),index:t}}(e),r=t.str,o=t.index;i.unshift(r),n.unshift(o)})),{element_path:"/"+i.join("/"),positions:n}}(t),p=h.element_path,d=h.positions,f=function(e){var t=we(e),i=[];return function e(t){var n=Ee(t);if(n&&-1===i.indexOf(n)&&i.push(n),t.childNodes.length>0)for(var r=t.childNodes,o=0;o<r.length;o++)8!==r[o].nodeType&&e(r[o])}(t),i}(t),g=window.performance.timing.navigationStart,_=Date.now()-g,v=d.map((function(e){return""+e})),y=null;if(window.TEAVisualEditor&&window.TEAVisualEditor.getOriginXpath&&(y=window.TEAVisualEditor.getOriginXpath({xpath:p,positions:v})),r.element_path=y&&y.xpath||p,r.positions=y&&y.positions||v,n&&!n.text&&(r.texts=f,r.element_title=function(e){var t=we(e),i="";return function e(t){var n=Ee(t);if(n&&(i+=n),t.childNodes.length>0)for(var r=t.childNodes,o=0;o<r.length;o++)3===r[o].nodeType&&e(r[o])}(t),i}(t)),r.element_id=t.getAttribute("id")||"",r.element_class_name=t.getAttribute("class")||"",r.element_type=t.nodeType,r.element_width=Math.floor(s),r.element_height=Math.floor(c),r.touch_x=l,r.touch_y=u,r.page_manual_key="",r.elememt_manual_key="",r.since_page_start_ms=_,r.page_start_ms=g,r.page_path=location.pathname,r.page_host=location.host,i.track_attr&&function(e,t){return!!Te(e,t)}(t,i.track_attr)){var m=De(t,i.track_attr);for(var b in m)r[b]=m[b]}var S=we(t);return"A"===S.tagName&&(r.href=S.getAttribute("href")),"IMG"===t.tagName&&(r.src=t.getAttribute("src")),r}var Ce=function(e,t,i,r,o){return n({event:e},Oe(t,i,r,o),{is_html:1,page_key:window.location.href,page_title:document.title})},Me=function(){function e(e,t){this.ignore={text:!1},this.initConfig=e,this.options=t,this.eventName=t&&"tea"===t.custom?{click:"__bav_click",page:"__bav_page",beat:"__bav_beat",static:"__bav_page_statistics",exposure:"__bav_page_exposure"}:{click:"bav2b_click",page:"bav2b_page",beat:"bav2b_beat",static:"bav2b_page_statistics",exposure:"bav2b_exposure"},t&&!1===t.text&&(this.ignore.text=!0),t&&t.exposure&&t.exposure.eventName&&(this.eventName.exposure=t.exposure.eventName)}return e.prototype.handleEvent=function(e,t){try{if(function(e){for(var t=e;t&&t.parentNode;){if(t.hasAttribute("data-tea-ignore"))return!0;if("HTML"===t.nodeName||"body"===t.nodeName)return!1;t=t.parentNode}return!1}(e.target))return null;var i="bav2b_click";switch(t){case"click":return i=this.eventName.click,Ce(i,e,e.target,this.options,this.ignore);case"exposure":return i=this.eventName.exposure,Ce(i,e,e.target,this.options,this.ignore);case"change":return n({},Ce(i="bav2b_change",e,e.target,this.options),function(e,t){try{if("bav2b_change"===e)return t.hasAttribute("data-tea-track")?{value:t.value}:{}}catch(e){return{}}}(i,e.target));case"submit":return Ce(i="bav2b_submit",e,e.target,this.options)}}catch(n){return null}},e.prototype.handleViewEvent=function(e){e.event=this.eventName.page,e.page_title=document.title,e.page_total_width=window.innerWidth,e.page_total_height=window.innerHeight;try{var t=window.sessionStorage.getItem("_tea_cache_duration");if(t){var i=JSON.parse(t);e.refer_page_duration_ms=i?i.duration:""}e.scroll_width=document.documentElement.scrollLeft?document.documentElement.scrollLeft+window.innerWidth:window.innerWidth,e.scroll_height=document.documentElement.scrollTop?document.documentElement.scrollTop+window.innerHeight:window.innerHeight,e.page_start_ms=window.performance.timing.navigationStart}catch(e){}return e},e.prototype.handleStatisticsEvent=function(e){var t={};t.event=this.eventName.static,t.is_html=1,t.page_key=location.href,t.refer_page_key=document.referrer||"",t.page_title=document.title,t.page_manual_key=this.initConfig.autotrack.page_manual_key||"",t.refer_page_manual_key="";try{var i=e.lcp,n=window.performance.timing,r=n.loadEventEnd-n.navigationStart;t.page_init_cost_ms=parseInt(i||(r>0?r:0)),t.page_start_ms=n.navigationStart}catch(e){}return t},e.prototype.handleBeadtEvent=function(e){e.event=this.eventName.beat,e.page_key=window.location.href,e.is_html=1,e.page_title=document.title,e.page_manual_key=this.initConfig.autotrack.page_manual_key||"";try{e.page_viewport_width=window.innerWidth,e.page_viewport_height=window.innerHeight,e.page_total_width=document.documentElement.scrollWidth,e.page_total_height=document.documentElement.scrollHeight,e.scroll_width=document.documentElement.scrollLeft+window.innerWidth,e.scroll_height=document.documentElement.scrollTop+window.innerHeight,e.since_page_start_ms=Date.now()-window.performance.timing.navigationStart,e.page_start_ms=window.performance.timing.navigationStart}catch(e){}return e},e}(),Le=function(){function e(e){this.collect=e,this.eventNameList=["report_click_event","report_change_event","report_submit_event","report_exposure_event","report_page_view_event","report_page_statistics_event","report_beat_event"]}return e.prototype.send=function(e,t){var i=e.eventSend,n=t.event;delete t.event,i&&"becon"===i?this.collect.beconEvent(n,t):this.collect.event(n,t)},e.prototype.get=function(e,t){var i=Object.assign({headers:{"content-type":"application/json"},method:"GET"},t);fetch(e,i)},e.prototype.post=function(e,t){var i=Object.assign({headers:{"content-type":"application/json"},method:"POST"},t);fetch(e,i)},e}(),Ge="_TEA_VE_OPEN",Pe="_TEA_VE_APIHOST",Re="lang",Be="_VISUAL_EDITOR_V",ze="_VISUAL_EDITOR_U";function Ne(){try{var e=window.TEAVisualEditor.lang=window.TEAVisualEditor.lang||w.get(Re),t=window.TEAVisualEditor.__editor_ajax_domain=window.TEAVisualEditor.__editor_ajax_domain||w.get(Pe),i=window.TEAVisualEditor.__editor_verison=window.TEAVisualEditor.__editor_verison||w.get(Be),n=window.TEAVisualEditor.__editor_url=window.TEAVisualEditor.__editor_url||w.get(ze),r=+new Date,o=new Date(r+18e5);w.set(Ge,"1",{expires:o}),w.set(Pe,t,{expires:o}),w.set(ze,n,{expires:o}),w.set(Re,e,{expires:o}),w.set(Be,i||"",{expires:o})}catch(e){}}var Ve=!1;function Ue(e){var t=e.event,i=e.editorUrl,n=e.autoTrackInstance;Ve||(Ve=!0,f(i,(function(){oe(t,"editorScriptloadSuccess"),n.destroy()}),(function(){t&&oe(t,"editorScriptloadError"),Ve=!1})))}var je,$e=function(){function e(e){this._instance=null,this._intersection=e,this.init()}return e.prototype.init=function(){var e=this;this._instance=new MutationObserver((function(t){t.forEach((function(t){"attributes"===t.type&&e.attributeChangeObserve(t),"childList"===t.type&&e.modifyNodeObserve(t)}))})),this._instance.observe(document.body,{childList:!0,attributes:!0,subtree:!0,attributeOldValue:!1})},e.prototype.attributeChangeObserve=function(e){e.target.hasAttribute("data-exposure")?this.exposureAdd(e,"mutation"):this.exposureRemove(e)},e.prototype.modifyNodeObserve=function(e){var t=this;Array.prototype.forEach.call(e.addedNodes,(function(e){1===e.nodeType&&e.hasAttribute("data-exposure")&&t.exposureAdd(e,"intersect"),t.mapChild(e,t.exposureAdd)})),Array.prototype.forEach.call(e.removedNodes,(function(e){1===e.nodeType&&e.hasAttribute("data-exposure")&&t.exposureRemove(e),t.mapChild(e,t.exposureRemove)}))},e.prototype.mapChild=function(e,t){var i=this;1===e.nodeType&&e.children.length&&Array.prototype.forEach.call(e.children,(function(e){1===e.nodeType&&e.hasAttribute("data-exposure")&&t(e),i.mapChild(e,t)}))},e.prototype.exposureAdd=function(e,t){this._intersection.exposureAdd(e,t)},e.prototype.exposureRemove=function(e){this._intersection.exposureRemove(e)},e._exposure_observer=null,e}(),Ke=function(){function e(t,i){this.count=1,this.instance=this.buildObserver(),this.observeMap=e._observer_map,t.autotrack.exposure.ratio?this.Ratio=t.autotrack.exposure.ratio:0===t.autotrack.exposure.ratio?this.Ratio=0:this.Ratio=.5,this.EventHandle=i}return e.prototype.buildObserver=function(){var t=this;if(!e._observer_instance)return IntersectionObserver&&(e._observer_instance=new IntersectionObserver((function(e){e.forEach((function(e){t.observeMap.get(e.target._observeId)&&t.exposureEvent(e)}))}),{threshold:[.01,.25,.5,.75,1]})),e._observer_instance},e.prototype.exposureAdd=function(e,t){var i=e;"mutation"===t&&(i=e.target);var n=i._observeId;if(n||this.observeMap.has(n)){if(!1===i.visible){var r=i.getBoundingClientRect(),o=r.top,a=r.left,s=r.right,c=r.bottom;o>=0&&c<=window.innerHeight&&a>=0&&s<=window.innerWidth&&(i.visible=!0,this.EventHandle({eventType:"dom",eventName:"exposure"},e))}}else i._observeId=this.count,i.visible=!1,this.observeMap.set(this.count,i),this.observe(i),this.count++},e.prototype.exposureRemove=function(e){this.observeMap.has(e._observeId)&&(this.observeMap.delete(e._observeId),this.unobserve(e))},e.prototype.exposureEvent=function(e){if(e.intersectionRatio>=this.Ratio&&e.isIntersecting){if("0"===e.target.style.opacity||"hidden"===e.target.style.visibility)return;if(!0===e.target.visible)return;e.target.visible=!0,this.EventHandle({eventType:"dom",eventName:"exposure"},e)}else e.target.visible=!1},e.prototype.observe=function(e){this.instance.observe(e)},e.prototype.unobserve=function(e){this.instance.unobserve(e)},e._observer_instance=null,e._observer_map=new Map,e}(),qe=function(){function e(e,t){e.autotrack&&e.autotrack.exposure&&(this._intersection=new Ke(e,t),this._observer=new $e(this._intersection),this.initObserver())}return e.prototype.initObserver=function(){var e=this;Array.prototype.forEach.call(document.querySelectorAll("[data-exposure]"),(function(t){e._intersection.exposureAdd(t,"intersect")}))},e}(),We={hashTag:!1,impr:!1},He=function(){function e(){}return e.prototype.apply=function(e,t){if(this.autoTrackStart=!1,this.collect=e,this.config=t,t.autotrack){var i=e.Types;t.autotrack&&t.autotrack.collect_url&&!t.autotrack.collect_url()||(this.ready(i.Autotrack),this.collect.emit(i.AutotrackReady))}},e.prototype.ready=function(e){this.collect.set(e);var t=this.config.autotrack;t="object"==typeof t?t:{},t=Object.assign(We,t),this.destroyed=!1,this.options=t,this.Config=new xe(Ae,this.options),this.Exposure=new qe(this.config,this.handle.bind(this)),this.Listener=new Ie(t,this.collect,this.Config),this.EventHandle=new Me(this.config,t),this.Request=new Le(this.collect),this.autoTrackStart=!0,this.init(),function(e,t){window.TEAVisualEditor=window.TEAVisualEditor||{};var i="",n="https://lf-cdn-tos.bytescm.com/obj/static/log-sdk/collect/visual-editor-rangers.js?query="+Date.now();window.TEAVisualEditor.appId=t.app_id;var r=t.channel_domain,o="";if(re(["*"]),r){var a,s="";try{var c=window.performance.getEntriesByType("resource");if(c&&c.length&&(c.forEach((function(e){"script"===e.initiatorType&&e.name&&-1!==e.name.indexOf("collect")&&(s=e.name)})),s&&(a=s.split("/"))&&a.length)){o="https:/";for(var l=2;l<a.length&&l!==a.length-1;l++)o=o+"/"+a[l];if(o&&o.indexOf("/5.0")){var u=o.split("/5.0");o=u[0]||o}}}catch(e){}}if(ce(t,M),"1"===w.get(Ge)){var h=function(){var e=w.get(Pe);try{e=JSON.parse(e)}catch(e){}return e}(),p="";h&&(window.TEAVisualEditor.__editor_ajax_domain=h,p=w.get(ze)),Ue({event:null,editorUrl:p||n,autoTrackInstance:e}),Ne()}else try{ae("tea:openVisualEditor",(function(t){var a=t.data;if("string"==typeof t.data)try{a=JSON.parse(t.data)}catch(e){a=void 0}if(a){var s=a.referrer,c=a.lang;if(s&&(window.TEAVisualEditor.__editor_ajax_domain=s),i=n,r){var l=a.version;i=o?o+(l?"/visual-editor-rangers-v"+l:"/visual-editor-rangers-v1.0.0")+".js":n,window.TEAVisualEditor.__editor_verison=l}window.TEAVisualEditor.__editor_url=i,window.TEAVisualEditor.lang=c,Ue({event:t,editorUrl:i,autoTrackInstance:e}),Ne()}})),window.TEAVisualEditor.openAutotrackEditor=function(){Ue({event:null,editorUrl:window.TEAVisualEditor.__editor_url,autoTrackInstance:e})}}catch(e){}try{ae("tea:openHeatMapCore",(function(i){var n=i.data.app_id;n&&n!==t.app_id||Ue({event:i,editorUrl:"https://lf-cdn-tos.bytescm.com/obj/static/log-sdk/collect/heatmap-core.js?query="+Date.now(),autoTrackInstance:e})}))}catch(e){}}(this,this.config)},e.prototype.init=function(){this.Listener.init(this.handle.bind(this));try{"base"===this.collect.loadType&&(window.opener||window.parent).postMessage("[tea-sdk]ready","*")}catch(e){}},e.prototype.handle=function(e,t){"dom"===e.eventType&&this.handleDom(e,t)},e.prototype.handleDom=function(e,t){try{var i=e.eventName;if("click"===i||"exposure"===i||"change"===i||"submit"===i){var n=this.EventHandle.handleEvent(t,i);null!==n&&this.Request.send({eventType:"custom",eventName:"report_"+i+"_event",extra:{methods:"GET"}},n)}else if("page_view"===i||"page_statistics"===i){var r;r="page_view"===i?this.EventHandle.handleViewEvent(t):this.EventHandle.handleStatisticsEvent(t),this.Request.send({eventType:"custom",eventName:"report_${eventName}_event",extra:{methods:"GET"}},r)}else if("beat"===i){var o=this.EventHandle.handleBeadtEvent(t),a=e.eventSend;this.Request.send({eventType:"custom",eventName:"report_${eventName}_event",extra:{methods:"GET"},eventSend:a},o)}}catch(e){}},e.prototype.destroy=function(){this.autoTrackStart&&(this.autoTrackStart=!1,this.Listener.removeListener())},e}();!function(e){e.Net="net",e.FailNet="f_net",e.FailData="f_data"}(je||(je={}));var Je={pv:["predefine_pageview"],sdk:["_be_active","predefine_page_alive","predefine_page_close","__profile_set","__profile_set_once","__profile_increment","__profile_unset","__profile_append"],autotrack:["bav2b_click","bav2b_page","bav2b_beat","bav2b_page_statistics","__bav_click","__bav_page","__bav_beat","__bav_page_statistics"]},Fe=function(){function e(){}return e.prototype.apply=function(e,t){var i=this;if(this.ready=t.app_id&&t.enable_tracer&&!t.disable_track_event,this.ready){this.limit={pv:1,sdk:3,autotrack:3,log:3},this.errorCode={f_net:0,f_data:0},this.tracerCache=new Map,this.collect=e,this.appid=t.app_id,this.reportUrl=e.configManager.getUrl("event");var n=this.collect.Types,r=e.adapters.fetch;this.fetch=r,this.collect.on(n.Event,(function(){i.addCount("log")})),this.collect.on(n.SubmitError,(function(e){var t=e.type,n=e.eventDate,r=e.errorCode,o=e.response;i.addErrorCount(n,t,r,o)})),this.listener(),this.collect.emit(n.TracerReady)}},e.prototype.addCount=function(e,t,i){void 0===t&&(t="net"),void 0===i&&(i=1);try{this.tracerCache||(this.tracerCache=new Map);var n=void 0;if(this.tracerCache.has(e))(r=this.tracerCache.get(e)).has(t)?(n=r.get(t).params.count,n++,r.set(t,this.processTracer(n,e,t))):(n=i,r.set(t,this.processTracer(i,e,t)));else{var r=new Map;n=i,r.set(t,this.processTracer(i,e,t)),this.tracerCache.set(e,r)}"net"===t&&n>=this.limit[e]&&this.report(!1)}catch(e){}},e.prototype.addErrorCount=function(e,t,i,n){var r=this;try{if(e&&e.length){var o=e[0].events;o&&o.length&&("f_data"===t?(n&&n.hasOwnProperty("sc")?this.addCount("log",t,o.length-n.sc):this.addCount("log",t,o.length),this.errorCode[t]=i):o.forEach((function(e){var n="log";for(var o in Je)if(-1!==Je[o].indexOf(e.event)){n=o;break}r.addCount(n,t,1),r.errorCode[t]=i})))}}catch(e){}},e.prototype.report=function(e){if(this.tracerCache){var t=[];this.tracerCache.forEach((function(e){e.forEach((function(e){t.push(e)}))})),t&&t.length&&this.sendTracer(t,e)}},e.prototype.sendTracer=function(e,t){try{var i=this.collect.eventManager.merge(e);t&&window.navigator.sendBeacon?window.navigator.sendBeacon(this.reportUrl,JSON.stringify(i)):this.fetch(this.reportUrl,i),this.tracerCache=null}catch(e){}},e.prototype.processTracer=function(e,t,i){var n={count:e,state:i,key:t,params_for_special:"applog_trace",aid:this.appid,platform:"web",_staging_flag:1,sdk_version:M};"f_net"!==i&&"f_data"!==i||(n.errorCode=this.errorCode[i]);var r=this.collect.processEvent("applog_trace",n);if(r&&r.event)return delete r.is_bav,r},e.prototype.listener=function(){var e=this;document.addEventListener("visibilitychange",(function(){"hidden"===document.visibilityState&&e.leavePage()})),d((function(){e.leavePage()}))},e.prototype.leavePage=function(){this.report(!0)},e}(),Qe=m((function(e,t){e.exports=function(){var e="millisecond",t="second",i="minute",n="hour",r="day",o="week",a="month",s="quarter",c="year",l="date",u="Invalid Date",h=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,p=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,d={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},f=function(e,t,i){var n=String(e);return!n||n.length>=t?e:""+Array(t+1-n.length).join(i)+e},g={s:f,z:function(e){var t=-e.utcOffset(),i=Math.abs(t),n=Math.floor(i/60),r=i%60;return(t<=0?"+":"-")+f(n,2,"0")+":"+f(r,2,"0")},m:function e(t,i){if(t.date()<i.date())return-e(i,t);var n=12*(i.year()-t.year())+(i.month()-t.month()),r=t.clone().add(n,a),o=i-r<0,s=t.clone().add(n+(o?-1:1),a);return+(-(n+(i-r)/(o?r-s:s-r))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(u){return{M:a,y:c,w:o,d:r,D:l,h:n,m:i,s:t,ms:e,Q:s}[u]||String(u||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},_="en",v={};v[_]=d;var y=function(e){return e instanceof w},m=function(e,t,i){var n;if(!e)return _;if("string"==typeof e)v[e]&&(n=e),t&&(v[e]=t,n=e);else{var r=e.name;v[r]=e,n=r}return!i&&n&&(_=n),n||!i&&_},b=function(e,t){if(y(e))return e.clone();var i="object"==typeof t?t:{};return i.date=e,i.args=arguments,new w(i)},S=g;S.l=m,S.i=y,S.w=function(e,t){return b(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var w=function(){function d(e){this.$L=m(e.locale,null,!0),this.parse(e)}var f=d.prototype;return f.parse=function(e){this.$d=function(e){var t=e.date,i=e.utc;if(null===t)return new Date(NaN);if(S.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var n=t.match(h);if(n){var r=n[2]-1||0,o=(n[7]||"0").substring(0,3);return i?new Date(Date.UTC(n[1],r,n[3]||1,n[4]||0,n[5]||0,n[6]||0,o)):new Date(n[1],r,n[3]||1,n[4]||0,n[5]||0,n[6]||0,o)}}return new Date(t)}(e),this.$x=e.x||{},this.init()},f.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},f.$utils=function(){return S},f.isValid=function(){return!(this.$d.toString()===u)},f.isSame=function(e,t){var i=b(e);return this.startOf(t)<=i&&i<=this.endOf(t)},f.isAfter=function(e,t){return b(e)<this.startOf(t)},f.isBefore=function(e,t){return this.endOf(t)<b(e)},f.$g=function(e,t,i){return S.u(e)?this[t]:this.set(i,e)},f.unix=function(){return Math.floor(this.valueOf()/1e3)},f.valueOf=function(){return this.$d.getTime()},f.startOf=function(e,s){var u=this,h=!!S.u(s)||s,p=S.p(e),d=function(e,t){var i=S.w(u.$u?Date.UTC(u.$y,t,e):new Date(u.$y,t,e),u);return h?i:i.endOf(r)},f=function(e,t){return S.w(u.toDate()[e].apply(u.toDate("s"),(h?[0,0,0,0]:[23,59,59,999]).slice(t)),u)},g=this.$W,_=this.$M,v=this.$D,y="set"+(this.$u?"UTC":"");switch(p){case c:return h?d(1,0):d(31,11);case a:return h?d(1,_):d(0,_+1);case o:var m=this.$locale().weekStart||0,b=(g<m?g+7:g)-m;return d(h?v-b:v+(6-b),_);case r:case l:return f(y+"Hours",0);case n:return f(y+"Minutes",1);case i:return f(y+"Seconds",2);case t:return f(y+"Milliseconds",3);default:return this.clone()}},f.endOf=function(e){return this.startOf(e,!1)},f.$set=function(o,s){var u,h=S.p(o),p="set"+(this.$u?"UTC":""),d=(u={},u[r]=p+"Date",u[l]=p+"Date",u[a]=p+"Month",u[c]=p+"FullYear",u[n]=p+"Hours",u[i]=p+"Minutes",u[t]=p+"Seconds",u[e]=p+"Milliseconds",u)[h],f=h===r?this.$D+(s-this.$W):s;if(h===a||h===c){var g=this.clone().set(l,1);g.$d[d](f),g.init(),this.$d=g.set(l,Math.min(this.$D,g.daysInMonth())).$d}else d&&this.$d[d](f);return this.init(),this},f.set=function(e,t){return this.clone().$set(e,t)},f.get=function(e){return this[S.p(e)]()},f.add=function(e,s){var l,u=this;e=Number(e);var h=S.p(s),p=function(t){var i=b(u);return S.w(i.date(i.date()+Math.round(t*e)),u)};if(h===a)return this.set(a,this.$M+e);if(h===c)return this.set(c,this.$y+e);if(h===r)return p(1);if(h===o)return p(7);var d=(l={},l[i]=6e4,l[n]=36e5,l[t]=1e3,l)[h]||1,f=this.$d.getTime()+e*d;return S.w(f,this)},f.subtract=function(e,t){return this.add(-1*e,t)},f.format=function(e){var t=this,i=this.$locale();if(!this.isValid())return i.invalidDate||u;var n=e||"YYYY-MM-DDTHH:mm:ssZ",r=S.z(this),o=this.$H,a=this.$m,s=this.$M,c=i.weekdays,l=i.months,h=function(e,i,r,o){return e&&(e[i]||e(t,n))||r[i].substr(0,o)},d=function(e){return S.s(o%12||12,e,"0")},f=i.meridiem||function(e,t,i){var n=e<12?"AM":"PM";return i?n.toLowerCase():n},g={YY:String(this.$y).slice(-2),YYYY:this.$y,M:s+1,MM:S.s(s+1,2,"0"),MMM:h(i.monthsShort,s,l,3),MMMM:h(l,s),D:this.$D,DD:S.s(this.$D,2,"0"),d:String(this.$W),dd:h(i.weekdaysMin,this.$W,c,2),ddd:h(i.weekdaysShort,this.$W,c,3),dddd:c[this.$W],H:String(o),HH:S.s(o,2,"0"),h:d(1),hh:d(2),a:f(o,a,!0),A:f(o,a,!1),m:String(a),mm:S.s(a,2,"0"),s:String(this.$s),ss:S.s(this.$s,2,"0"),SSS:S.s(this.$ms,3,"0"),Z:r};return n.replace(p,(function(e,t){return t||g[e]||r.replace(":","")}))},f.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},f.diff=function(e,l,u){var h,p=S.p(l),d=b(e),f=6e4*(d.utcOffset()-this.utcOffset()),g=this-d,_=S.m(this,d);return _=(h={},h[c]=_/12,h[a]=_,h[s]=_/3,h[o]=(g-f)/6048e5,h[r]=(g-f)/864e5,h[n]=g/36e5,h[i]=g/6e4,h[t]=g/1e3,h)[p]||g,u?_:S.a(_)},f.daysInMonth=function(){return this.endOf(a).$D},f.$locale=function(){return v[this.$L]},f.locale=function(e,t){if(!e)return this.$L;var i=this.clone(),n=m(e,t,!0);return n&&(i.$L=n),i},f.clone=function(){return S.w(this.$d,this)},f.toDate=function(){return new Date(this.valueOf())},f.toJSON=function(){return this.isValid()?this.toISOString():null},f.toISOString=function(){return this.$d.toISOString()},f.toString=function(){return this.$d.toUTCString()},d}(),E=w.prototype;return b.prototype=E,[["$ms",e],["$s",t],["$m",i],["$H",n],["$W",r],["$M",a],["$y",c],["$D",l]].forEach((function(e){E[e[1]]=function(t){return this.$g(t,e[0],e[1])}})),b.extend=function(e,t){return e.$i||(e(t,w,b),e.$i=!0),b},b.locale=m,b.isDayjs=y,b.unix=function(e){return b(1e3*e)},b.en=v[_],b.Ls=v,b.p={},b}()})),Ye=m((function(e,t){var i,n,r,o,a,s,c,l,u,h,p,d,f,g,_,v,y;e.exports=(a=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,l=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/,u={years:s=31536e6,months:c=2592e6,days:o=864e5,hours:r=36e5,minutes:6e4,seconds:1e3,milliseconds:1,weeks:6048e5},h=function(e){return e instanceof y},p=function(e,t,i){return new y(e,i,t.$l)},d=function(e){return n.p(e)+"s"},f=function(e){return e<0},g=function(e){return f(e)?Math.ceil(e):Math.floor(e)},_=function(e){return Math.abs(e)},v=function(e,t){return e?f(e)?{negative:!0,format:""+_(e)+t}:{negative:!1,format:""+e+t}:{negative:!1,format:""}},y=function(){function e(e,t,i){var n=this;if(this.$d={},this.$l=i,void 0===e&&(this.$ms=0,this.parseFromMilliseconds()),t)return p(e*u[d(t)],this);if("number"==typeof e)return this.$ms=e,this.parseFromMilliseconds(),this;if("object"==typeof e)return Object.keys(e).forEach((function(t){n.$d[d(t)]=e[t]})),this.calMilliseconds(),this;if("string"==typeof e){var r=e.match(l);if(r){var o=r.slice(2).map((function(e){return Number(e)}));return this.$d.years=o[0],this.$d.months=o[1],this.$d.weeks=o[2],this.$d.days=o[3],this.$d.hours=o[4],this.$d.minutes=o[5],this.$d.seconds=o[6],this.calMilliseconds(),this}}return this}var t=e.prototype;return t.calMilliseconds=function(){var e=this;this.$ms=Object.keys(this.$d).reduce((function(t,i){return t+(e.$d[i]||0)*u[i]}),0)},t.parseFromMilliseconds=function(){var e=this.$ms;this.$d.years=g(e/s),e%=s,this.$d.months=g(e/c),e%=c,this.$d.days=g(e/o),e%=o,this.$d.hours=g(e/r),e%=r,this.$d.minutes=g(e/6e4),e%=6e4,this.$d.seconds=g(e/1e3),e%=1e3,this.$d.milliseconds=e},t.toISOString=function(){var e=v(this.$d.years,"Y"),t=v(this.$d.months,"M"),i=+this.$d.days||0;this.$d.weeks&&(i+=7*this.$d.weeks);var n=v(i,"D"),r=v(this.$d.hours,"H"),o=v(this.$d.minutes,"M"),a=this.$d.seconds||0;this.$d.milliseconds&&(a+=this.$d.milliseconds/1e3);var s=v(a,"S"),c=e.negative||t.negative||n.negative||r.negative||o.negative||s.negative,l=r.format||o.format||s.format?"T":"",u=(c?"-":"")+"P"+e.format+t.format+n.format+l+r.format+o.format+s.format;return"P"===u||"-P"===u?"P0D":u},t.toJSON=function(){return this.toISOString()},t.format=function(e){var t=e||"YYYY-MM-DDTHH:mm:ss",i={Y:this.$d.years,YY:n.s(this.$d.years,2,"0"),YYYY:n.s(this.$d.years,4,"0"),M:this.$d.months,MM:n.s(this.$d.months,2,"0"),D:this.$d.days,DD:n.s(this.$d.days,2,"0"),H:this.$d.hours,HH:n.s(this.$d.hours,2,"0"),m:this.$d.minutes,mm:n.s(this.$d.minutes,2,"0"),s:this.$d.seconds,ss:n.s(this.$d.seconds,2,"0"),SSS:n.s(this.$d.milliseconds,3,"0")};return t.replace(a,(function(e,t){return t||String(i[e])}))},t.as=function(e){return this.$ms/u[d(e)]},t.get=function(e){var t=this.$ms,i=d(e);return"milliseconds"===i?t%=1e3:t="weeks"===i?g(t/u[i]):this.$d[i],0===t?0:t},t.add=function(e,t,i){var n;return n=t?e*u[d(t)]:h(e)?e.$ms:p(e,this).$ms,p(this.$ms+n*(i?-1:1),this)},t.subtract=function(e,t){return this.add(e,t,!0)},t.locale=function(e){var t=this.clone();return t.$l=e,t},t.clone=function(){return p(this.$ms,this)},t.humanize=function(e){return i().add(this.$ms,"ms").locale(this.$l).fromNow(!e)},t.milliseconds=function(){return this.get("milliseconds")},t.asMilliseconds=function(){return this.as("milliseconds")},t.seconds=function(){return this.get("seconds")},t.asSeconds=function(){return this.as("seconds")},t.minutes=function(){return this.get("minutes")},t.asMinutes=function(){return this.as("minutes")},t.hours=function(){return this.get("hours")},t.asHours=function(){return this.as("hours")},t.days=function(){return this.get("days")},t.asDays=function(){return this.as("days")},t.weeks=function(){return this.get("weeks")},t.asWeeks=function(){return this.as("weeks")},t.months=function(){return this.get("months")},t.asMonths=function(){return this.as("months")},t.years=function(){return this.get("years")},t.asYears=function(){return this.as("years")},e}(),function(e,t,r){i=r,n=r().$utils(),r.duration=function(e,t){var i=r.locale();return p(e,{$l:i},t)},r.isDuration=h;var o=t.prototype.add,a=t.prototype.subtract;t.prototype.add=function(e,t){return h(e)&&(e=e.asMilliseconds()),o.bind(this)(e,t)},t.prototype.subtract=function(e,t){return h(e)&&(e=e.asMilliseconds()),a.bind(this)(e,t)}})}));Qe.extend(Ye);var Xe=["__cep_sdk_onboard","__cep_trigger_sdk","_be_active"],Ze=["and","or","not"],et=function(){function e(){this.support=!0,this.currentPlan=1,this.shouldSendEvent=!1,this.staing=!1,this.test=!1,this.cepReady=!1,this.eventCache=[]}return e.prototype.apply=function(e,t){var i=this;if(this.collect=e,this.config=t,this.config.cep){var n=e.adapters,r=n.fetch,o=n.storage,a=e.Types;this.types=a,this.storage=new o(!1),this.fetch=r,this.configManager=e.configManager,this.url=t.cep_url?""+t.cep_url:e.configManager.getDomain()+"/service/2/cep_settings/",this.reportUrl=e.configManager.getUrl("event"),this.key="__tea_cep_plan_"+t.app_id,this.quotasKey="__tea_cep_plan_quotas_"+t.app_id,this.isWait=!1,this.eventCache=[],this.test=e.configManager.staging,this.collect.on(a.SubmitAfter,(function(e){i.matchEvent(e)})),this.init()}},e.prototype.init=function(){var e=this,t=!0,i=0,n=0,r=0,o=!1,a=this.storage.getItem(this.key)||{};if(a&&Object.keys(a).length&&(o=!0,i=a.last_update_time,n=a.fetch_interval,r=a.config_version||0,t=Date.now()-i>1e3*n),t){var s=this.configManager.get(),c=s.header,l=s.user;this.fetch(this.url,{header:c,user:l,local_time:Date.now(),config_version:r},1e4,!1,(function(t){t&&0===t.code?(a.fetch_interval=t.fetch_interval,a.data=t.data,a.last_update_time=Date.now(),a.config_version=t.config_version,e.clearQuotas(),e.initState(t.data),e.storage.setItem(e.key,a),t.data.forEach((function(t){e.event("__cep_sdk_onboard",t.plan_id)}))):304!==t.code&&400!==t.code||!o||(a.last_update_time=Date.now(),e.storage.setItem(e.key,a),e.initState(a.data))}),(function(){o?(e.planData=a.data,e.initState(a.data)):e.support=!1}))}else a.last_update_time=Date.now(),this.storage.setItem(this.key,a),this.initState(a.data)},e.prototype.initState=function(e){var t=this;e&&e.length&&(this.stateArray=new Map,this.waitArray=new Map,this.planData=e,e.forEach((function(e){var i=new Map;if(e.pattern&&e.pattern.events){var n=1===e.pattern.events.length;e.pattern.events.forEach((function(e){i.set(e.id,{id:e.id,isMatch:!1,event:null,after:e.after||null,connection:e.connection||null,window:e.window||null,matchTime:0,initTime:Date.now(),singleRule:n})})),t.stateArray.set(e.plan_id,{patternState:i,singleRule:n,pattern:{aid:e.aid,biz_id:e.biz_id,end_time:e.end_time,start_time:e.start_time,web_sdk_version:e.web_sdk_version,stage:e.stage},quotas:e.quotas})}})),this.cepReady=!0,this.dealCache(),this.collect.emit(this.types.CepReady))},e.prototype.check=function(e){var t=Date.now();return!(Date.now()>1e3*e.end_time)&&(!(t<1e3*e.start_time||t>1e3*e.end_time)&&(this.staing="testing"===e.staing,!(M<e.web_sdk_version&&(this.support=!1,1))))},e.prototype.dealCache=function(){var e=this;if(this.eventCache.length){var t=1;this.eventCache.forEach((function(i){e.matchEvent(i),t++})),t===this.eventCache.length&&(this.eventCache=[])}},e.prototype.matchEvent=function(e){if(this.support&&(!this.staing||this.test)&&e&&e.length)try{if(!this.cepReady)return void this.eventCache.push(e);var t=e[0],i=t.header,n=t.user,r=t.events;r.length&&r.reverse();for(var o=0;o<r.length;o++){var a=r[o].event;if(-1!==Xe.indexOf(a))return!1;this.matchRule(i,n,r[o])}}catch(e){return void this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"\u53d1\u751f\u4e86\u5f02\u5e38",level:"error",time:Date.now(),data:e.message})}},e.prototype.matchRule=function(e,t,i){try{for(var n=0;n<this.planData.length;n++){var r=this.planData[n],o=r.plan_id;if(this.check(r)&&this.checkQuotas(o)&&r.pattern&&r.pattern.events)for(var a=r.pattern.events,s=0;s<a.length;s++)if(this.rule(e,t,i,a[s].condition)){var c=this.stateArray.get(o).patternState,l=c.get(a[s].id);if(this.stateArray.get(o).singleRule){this.changeStatus(o,a[s].id,i),this.publish([i],o,a[s].id);break}if(!l.isMatch){l.after&&c.get(l.after).isMatch?this.changeStatus(o,a[s].id,i):l.after||this.changeStatus(o,a[s].id,i);break}}}this.statusCheck()}catch(e){return void this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"\u53d1\u751f\u4e86\u5f02\u5e38",level:"error",time:Date.now(),data:e.message})}},e.prototype.changeStatus=function(e,t,i){var n=this.stateArray.get(e),r=n.patternState.get(t);r.isMatch=!0,r.event=i,r.matchTime=i.local_time_ms||Date.now(),n.patternState.set(t,r),this.stateArray.set(e,n)},e.prototype.statusCheck=function(){var e,t,i,n;try{for(var a=r(this.stateArray),s=a.next();!s.done;s=a.next()){var c=o(s.value,2),l=c[0],u=c[1],h=u.patternState;if(u.isSingle)break;try{for(var p=r(h),d=p.next();!d.done;d=p.next()){var f=o(d.value,2),g=f[0],_=f[1];if(_.after&&(!_.after||h.get(_.after).isMatch)){if("NOT_FOLLOWED_BY"===_.connection){_.isMatch?this.reset(l,g):Date.now()-h.get(_.after).matchTime>_.window?this.publish([h.get(_.after).event,_.event],l,g):this.startWait(l,g,_);break}_.isMatch?_.matchTime-h.get(_.after).matchTime<=_.window?this.publish([h.get(_.after).event,_.event],l,g):this.reset(l,g):Date.now()-h.get(_.after).matchTime>_.window?this.reset(l,g):this.startWait(l,g,_);break}}}catch(e){i={error:e}}finally{try{d&&!d.done&&(n=p.return)&&n.call(p)}finally{if(i)throw i.error}}}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}},e.prototype.startWait=function(e,t,i){var n=this;try{this.waitArray.get(e)||this.waitArray.set(e,new Map);var r=this.waitArray.get(e);if(!r.get(t)){var o=setTimeout((function(){var r=n.stateArray.get(e).patternState,o=r.get(t);if("NOT_FOLLOWED_BY"===o.connection)!o.isMatch&&r.get(o.after).isMatch||o.matchTime-r.get(o.after).matchTime>i.window?((a=n.waitArray.get(e).get(t)).triggerWait=!0,n.waitArray.set(e,n.waitArray.get(e).set(t,a)),n.publish([r.get(o.after).event],e,t)):n.reset(e,t);else if("FOLLOWED_BY"===o.connection){var a;o.isMatch&&r.get(o.after).isMatch?((a=n.waitArray.get(e).get(t)).triggerWait=!0,n.waitArray.set(e,n.waitArray.get(e).set(t,a)),n.publish([r.get(o.after).event],e,t)):n.reset(e,t)}}),i.window);r.set(t,{waitFn:o,triggerWait:!1}),this.waitArray.set(e,r)}}catch(e){this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"\u53d1\u751f\u4e86\u5f02\u5e38",level:"error",time:Date.now(),data:e.message})}},e.prototype.rule=function(e,t,i,n){var r=this;try{var o=i.event,a=i.params;if(a=JSON.parse(a),-1!==Ze.indexOf(n.op)){if(n.conditions&&n.conditions.length){var s=n.conditions,c=0,l=new Map;l.set(c,{op:n.op,result:void 0,resultList:[],resultKey:[],resultLength:s.length}),function i(n,s){for(var u=0;u<n.length;u++)if(c++,-1!==Ze.indexOf(n[u].op)&&n[u].hasOwnProperty("conditions"))l.set(c,{op:n[u].op,result:void 0,fatherKey:s,resultList:[],resultKey:[],resultLength:n[u].conditions.length}),i(n[u].conditions,c);else{var h=r.scope(n[u].key),p=h.scope,d=h.key,f=h.key2,g=p?"header"===p?f?JSON.parse(e[f])[d]:e[d]:"user"===p?t[d]:a[d]:o,_=r.calculate(n[u].op,g,n[u].value);l.set(c,{op:n[u].op,result:_,fatherKey:s})}}(s,c);for(var u=l.get(0);void 0===u.result||u.resultList.length<u.resultLength;)l.forEach((function(e,t){if(void 0!==e.result&&void 0!==e.fatherKey){var i=l.get(e.fatherKey);i.resultList.length<i.resultLength&&-1===i.resultKey.indexOf(t)&&(i.resultKey.push(t),i.resultList.push(e.result),l.set(e.fatherKey,i))}})),l.forEach((function(e){e.resultList&&e.resultList.length===e.resultLength&&("and"===e.op&&(e.result=-1===e.resultList.indexOf(!1)),"or"===e.op&&(e.result=-1!==e.resultList.indexOf(!0)))}));return l.get(0).result}return!1}var h=this.scope(n.key),p=h.scope,d=h.key,f=h.key2,g=p?"header"===p?f?JSON.parse(e[f])[d]:e[d]:"user"===p?t[d]:a[d]:o;return this.calculate(n.op,g,n.value)}catch(e){return this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"\u53d1\u751f\u4e86\u5f02\u5e38",level:"error",time:Date.now(),data:e.message}),!1}},e.prototype.publish=function(e,t,i){try{var n=this.configManager.get().user,r={biz_id:this.stateArray.get(t).pattern.biz_id,plan_id:t,uid:n.user_id||"",did:n.device_id||"",uuid:n.user_unique_id,events:e,extra:{url:window.location.href}};this.collect.emit("__cep_match",r),(window.opener||window.parent).postMessage({type:"__cep_match",data:r},"*"),this.event("__cep_trigger_sdk",t),this.addQuotas(t),this.reset(t,i)}catch(e){return void this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"\u53d1\u751f\u4e86\u5f02\u5e38",level:"error",time:Date.now(),data:e.message})}},e.prototype.addQuotas=function(e){var t=this.stateArray.get(e).quotas;if(t&&t.length){var i=this.storage.getItem(this.quotasKey)||{};i[e]||(i[e]={value:0,lastTime:Date.now()});var n=i[e].value;0===n&&(i[e].lastTime=Date.now()),i[e].value=n+1,this.storage.setItem(this.quotasKey,i)}},e.prototype.checkQuotas=function(e){var t=this.stateArray.get(e).quotas,i=this.storage.getItem(this.quotasKey)||{};if(i[e]||(i[e]={value:0,lastTime:Date.now()}),t&&t.length){var n=t[0].granularity,r=t[0].value;if("per_keyid"!==t[0].type)return!0;var o=this.release(n);return"all"===o?!(i[e].value>=r):Date.now()-i[e].lastTime>=o?(i[e].value=0,i[e].lastTime=Date.now(),this.storage.setItem(this.quotasKey,i),!0):!(i[e].value>=r)}return!0},e.prototype.clearQuotas=function(){this.storage.setItem(this.quotasKey,null)},e.prototype.release=function(e){if("all"===e)return e;var t=Qe.duration(e);return t?t.asMilliseconds():"all"},e.prototype.reset=function(e,t){var i=this.stateArray.get(e);if(i.singleRule){var n=i.patternState.get(t);n.isMatch=!1,n.event=null,n.matchTime=0,n.initTime=Date.now(),i.patternState.set(t,n)}else i.patternState.forEach((function(e){e.isMatch=!1,e.event=null,e.matchTime=0,e.initTime=Date.now()}));this.stateArray.set(e,i);var r=this.waitArray.get(e);r&&r.get(t)&&(clearTimeout(r.get(t).waitFn),r.delete(t))},e.prototype.event=function(e,t){try{var i={event:e,params:JSON.stringify({plan_id:t||"",biz_id:this.stateArray.get(t).pattern.biz_id}),local_time_ms:Date.now()},n=this.configManager.get(),r=n.header,o=n.user;r.custom=JSON.stringify(r.custom);var a={events:[i],user:o,header:r};this.fetch(this.reportUrl,[a])}catch(e){return void this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"\u53d1\u751f\u4e86\u5f02\u5e38",level:"error",time:Date.now(),data:e.message})}},e.prototype.scope=function(e){var t="",i="";if(e.indexOf(".")>-1){var n=e.split(".");t=n[0],e=n[1],"header"===t&&"custom"===e&&(e=n[2],i=n[1])}return{scope:t,key:e,key2:i}},e.prototype.calculate=function(e,t,i){try{if("="===e)return t===i;if(-1!==["=","<",">",">=","<=","!="].indexOf(e))switch(e){case"=":return t===i;case"<":return t<i;case">":return t>i;case">=":return t>=i;case"<=":return t<=i;case"!=":return t!==i}else{if(-1!==["in","contains"].indexOf(e))return-1!==i.indexOf(t);if(-1!==["is not null","is null"].indexOf(e))return"is null"===e?null==t:null!=t;if(-1!==["startswith","endswith"].indexOf(e)){if("startswith"===e)return 0===t.indexOf(i);var n=t.length-i.length;return t.substr(n,i.length)===i}}}catch(e){return this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"\u53d1\u751f\u4e86\u5f02\u5e38",level:"error",time:Date.now(),data:e.message}),!1}},e}(),tt={autotrack:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/autotrack.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/autotrack.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/autotrack.js"},object:"LogAutoTrack"},ab:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/ab.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/ab.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/ab.js"},object:"LogAb"},stay:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/stay.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/stay.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/stay.js"},object:"LogStay"},route:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/route.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/route.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/route.js"},object:"LogRoute"},cep:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/cep.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/cep.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/cep.js"},object:"LogCep"},tracer:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/tracer.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/tracer.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/tracer.js"},object:"LogTracer"},visual:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/visual.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/visual.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/visual.js"},object:"LogVisual"}},it="undefined"!=typeof window?(window.LogPluginObject||(window.LogPluginObject={}),window.LogPluginObject):null,nt=function(){function e(){}return e.prototype.apply=function(e,t){this._plugin={},this.config=t,this.collect=e,this.channel=t.channel||"cn",this.loadExtend()},e.prototype.loadExtend=function(){var e=this;try{this.collect.remotePlugin.forEach((function(t,i){if("sdk"===t){if(tt.hasOwnProperty(i)){var n=tt[i].object,r=tt[i].src[e.channel]+"?query="+Date.now();e.exist(i,n,r)}}else"object"==typeof t&&(t.src?e.exist(i,t.call,t.src):e.process(i,t.instance,"INSTANCE"))}))}catch(e){this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"\u53d1\u751f\u4e86\u5f02\u5e38",level:"error",time:Date.now(),data:e.message})}},e.prototype.exist=function(e,t,i){var n=this;it[t]?this.process(e,it[t]):this.loadPlugin(e,i,(function(){n.process(e,it[t])}),(function(){}))},e.prototype.process=function(e,t,i){try{if(i){var n=new t;n.apply&&n.apply(this.collect,this.config)}else t&&t(this.collect,this.config)}catch(t){this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"\u53d1\u751f\u4e86\u5f02\u5e38",level:"error",time:Date.now(),data:t.message})}},e.prototype.loadPlugin=function(e,t,i,n){var r=this;try{var o=document.createElement("script");o.src=t,this._plugin[e]||(this._plugin[e]=[]),this._plugin[e].push(i),o.onerror=function(){n(t)},o.onload=function(){r._plugin[e].forEach((function(e){e()}))},document.getElementsByTagName("head")[0].appendChild(o)}catch(e){this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"\u53d1\u751f\u4e86\u5f02\u5e38",level:"error",time:Date.now(),data:e.message})}},e}(),rt=function(){function e(){this.autotrack=!1,this.spa=!1,this.cache={},this.allowHash=!1}return e.prototype.apply=function(e,t){if(t.spa||t.autotrack){var i=e.Types;this.collect=e,this.config=t,this.appid=t.app_id,this.allowHash=t.allow_hash,this.fncArray=new Map,this.setKey(),this.setLocation(),this.hack(),this.init(),this.listener(),e.emit(i.RouteReady)}},e.prototype.setKey=function(){var e=this.collect.adapters.storage;this.storage=new e(!1),this.cache_key="__tea_cache_refer_"+this.appid,this.cache={refer_key:location.href,refer_title:document.title||location.pathname,refer_manual_key:"",routeChange:!1},this.config.autotrack&&"object"==typeof this.config.autotrack&&this.config.autotrack.page_manual_key&&(this.cache.refer_manual_key=this.config.autotrack.page_manual_key),this.storage.setItem(this.cache_key,this.cache)},e.prototype.hack=function(){var e=this,t=window.history.pushState;history.pushState=function(i){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];"function"==typeof history.onpushstate&&history.onpushstate({state:i});var o=t.call.apply(t,a([history,i],n));if(e.lastLocation!==location.href){var s=e.getPopStateChangeEventData();return e.lastLocation=location.href,e.setReferCache(e.lastLocation),e.sendPv(s,"pushState"),o}};var i=history.replaceState;history.replaceState=function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];"function"==typeof history.onreplacestate&&history.onreplacestate({state:t});var o=i.call.apply(i,a([history,t],n));if(e.lastLocation!==location.href){var s=e.getPopStateChangeEventData();return e.lastLocation=location.href,e.setReferCache(e.lastLocation),e.sendPv(s),o}}},e.prototype.setLocation=function(){"undefined"!=typeof window&&(this.lastLocation=window.location.href)},e.prototype.init=function(){var e=this.getPopStateChangeEventData();this.collect.emit("route-change",{config:e,init:!0})},e.prototype.listener=function(){var e=this,t=null;window.addEventListener("hashchange",(function(i){if(e.lastLocation!==window.location.href&&(clearTimeout(t),e.allowHash)){e.lastLocation=window.location.href;var n=e.getPopStateChangeEventData();e.setReferCache(e.lastLocation),e.sendPv(n)}})),window.addEventListener("popstate",(function(i){e.lastLocation!==window.location.href&&(t=setTimeout((function(){e.lastLocation=window.location.href;var t=e.getPopStateChangeEventData();e.setReferCache(e.lastLocation),e.sendPv(t)}),10))}))},e.prototype.getPopStateChangeEventData=function(){var e=this.pageConfig();return e.is_back=0,e},e.prototype.pageConfig=function(){try{var e,t=this.storage.getItem(this.cache_key)||{},i=this.storage.getItem("__tea_cache_first_"+this.appid);return e=!i||1!=i,{is_html:1,url:location.href,referrer:this.handleRefer(),page_key:location.href,refer_page_key:this.handleRefer(),page_title:document.title||location.pathname,page_manual_key:this.config.autotrack&&this.config.autotrack.page_manual_key||"",refer_page_manual_key:t&&t.refer_manual_key||"",refer_page_title:t&&t.refer_title||"",page_path:location.pathname,page_host:location.host,is_first_time:""+e}}catch(t){return this.collect.emit(S.DEBUGGER_MESSAGE,{type:S.DEBUGGER_MESSAGE_SDK,info:"\u53d1\u751f\u4e86\u5f02\u5e38",level:"error",time:Date.now(),data:t.message}),{}}},e.prototype.sendPv=function(e,t){this.collect.emit("route-change",{config:e,init:!1})},e.prototype.handleRefer=function(){var e=this.storage.getItem()||{};return e.routeChange?e.refer_key:document.referrer},e.prototype.setReferCache=function(e){var t=this.storage.getItem(this.cache_key)||{};t.refer_key=e,t.routeChange=!0,this.storage.setItem(this.cache_key,t)},e}();ee.usePlugin(nt,"extend"),ee.usePlugin(de,"ab"),ee.usePlugin(ve,"stay"),ee.usePlugin(He,"autotrack"),ee.usePlugin(fe,"et"),ee.usePlugin(ye,"profile"),ee.usePlugin(et,"cep"),ee.usePlugin(me,"heartbeat"),ee.usePlugin(be,"monitor"),ee.usePlugin(rt,"route"),ee.usePlugin(Fe,"tracer");var ot=new ee("default"),at=ee;t.default=ot},49209:function(e,t,i){var n=i(19191),r=i(49509).charAt,o=i(32826),a=i(75293),s=i(52464);n({target:"String",proto:!0,forced:!0},{at:function(e){var t=s(o(this)),i=t.length,n=a(e),c=n>=0?n:i+n;return c<0||c>=i?undefined:r(t,c)}})}}]);