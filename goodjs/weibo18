(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-77f0cd56"],{"94b7":function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{class:t.$style.box},[i("woo-panel",{attrs:{border:"bottom"}},[i("woo-box",{attrs:{align:"center",justify:"between"}},[i("woo-tab",{class:[t.hasnav?"wbpro-tab1":t.$style.tabnonav],attrs:{animate:t.hasnav,"animate-duration":500}},t._l(t.tabs,(function(e,s){return i("woo-tab-item",{key:s,attrs:{index:s,cur:t.type===s||t.fasle},nativeOn:{click:function(e){return e.stopPropagation(),t.changeTab(s)}}},[i("div",{class:[t.hasnav&&"wbpro-tab1-item"],domProps:{textContent:t._s(e)}})])})),1),i("woo-button",{class:[t.$style.btn3,!t.hasnav&&t.$style.btnhasnav],attrs:{sort:"line",size:"s",kind:"default",round:!1},nativeOn:{click:function(e){return t.schedulePubliser(e)}}},[t._v(" 发布定时微博 ")])],1)],1),i("div",{class:t.$style.listbox},[i("Scroll",{attrs:{data:t.list,isLoading:t.isLoading,isRetry:t.isRetry,isEmpty:t.isEmpty,skeleton:!0},on:{loadMoreData:t.loadMoreData},scopedSlots:t._u([{key:"content",fn:function(e){var s=e.item,a=e.index;return[0===t.type?i("div",{class:t.$style.wrap},[s.trans?[i("div",{key:a,class:t.$style.wrap},[i("woo-box",{class:t.$style.item,attrs:{align:"center"}},[s.cover_url?i("woo-picture",{class:t.$style.pic,attrs:{src:s.cover_url,alt:"等比图"}}):t._e(),i("woo-box-item",{class:t.$style.con,attrs:{align:"center"}},[i("div",{class:t.$style.cut2,domProps:{textContent:t._s(t.handleText(s.text))}}),i("div",{staticClass:"wbpro-textcut",class:[t.$style.h4,t.$style.cls1]},[t._v(" 发布时间："+t._s(t._f("dayMoment")(s.schedule_timestamp))+" ")])]),i("woo-box",{class:[t.$style.h4,t.$style.cls1,t.$style.right],attrs:{justify:"end"}},[t._v(" 视频转码中 ")])],1),i("woo-divider",{class:t.$style.line})],1)]:i("woo-box",{class:t.$style.item,attrs:{align:"center"}},[t.imageUrl(s)?i("woo-picture",{class:t.$style.pic,attrs:{src:t.imageUrl(s),alt:"等比图"}}):t._e(),i("woo-box-item",{class:t.$style.con,attrs:{align:"center"}},[i("div",{class:t.$style.cut2,domProps:{textContent:t._s(t.handleText(s.text))}}),i("div",{staticClass:"wbpro-textcut",class:[t.$style.h4,t.$style.cls1]},[t._v(" 发布时间："+t._s(t._f("dayMoment")(s.schedule_at))+" ")])]),i("woo-box",{class:t.$style.right,attrs:{justify:"end"}},[t.showVideoVoteBtn(s)?i("woo-button",{class:t.$style.btn1,attrs:{sort:"line",kind:"primary",size:"s",round:!1},nativeOn:{click:function(e){return e.stopPropagation(),t.addVote(s,a)}}},[t._v("添加视频投票")]):t._e(),i("woo-button",{class:t.$style.btn1,attrs:{sort:"line",kind:"primary",size:"s",round:!1},nativeOn:{click:function(e){return e.stopPropagation(),t.edit(s,a)}}},[t._v("编辑微博")]),i("woo-button",{class:t.$style.btn1,attrs:{sort:"line",kind:"primary",size:"s",round:!1},nativeOn:{click:function(e){return e.stopPropagation(),t.send(s,a)}}},[t._v("立即发送")]),i("woo-button",{class:t.$style.btn2,attrs:{sort:"line",kind:"primary",size:"s",round:!1},nativeOn:{click:function(e){return e.stopPropagation(),t.destory(s,a)}}},[t._v("删除")])],1)],1),i("woo-divider",{class:t.$style.line})],2):t._e(),1===t.type?i("div",{class:t.$style.wrap},[i("woo-box",{class:t.$style.item,attrs:{align:"center"}},[s.thumbnail_pic?i("woo-picture",{class:t.$style.pic,attrs:{src:s.thumbnail_pic,alt:"等比图"}}):t._e(),i("woo-box-item",{class:t.$style.con,attrs:{align:"center"}},[i("div",{class:t.$style.cut2,domProps:{textContent:t._s(s.text)}}),i("div",{staticClass:"wbpro-textcut",class:[t.$style.h4,t.$style.cls2]},[t._v(" 失败原因："+t._s(s.error_info.error+"("+s.error_info.error_code+")")+" ")])]),i("woo-box",{class:t.$style.right,attrs:{justify:"end"}},[i("woo-button",{class:t.$style.btn1,attrs:{sort:"line",kind:"primary",size:"s",round:!1},nativeOn:{click:function(e){return e.stopPropagation(),t.edit(s,a)}}},[t._v("编辑微博")]),i("woo-button",{class:t.$style.btn2,attrs:{sort:"line",kind:"primary",size:"s",round:!1},nativeOn:{click:function(e){return e.stopPropagation(),t.destory(s,a)}}},[t._v("删除")])],1)],1),i("woo-divider",{class:t.$style.line})],1):t._e()]}}])})],1)],1)},a=[],n=(i("99af"),i("7db0"),i("caad"),i("c975"),i("d81d"),i("a434"),i("a9e3"),i("d3b7"),i("ac1f"),i("5377"),i("2532"),i("1276"),i("96cf"),i("1da1")),o=i("5530"),c=i("6701"),r=i("92e8"),d=i("4328"),l=i.n(d),u=i("2f62"),_={data:function(){return{tabs:["待发送","发送失败"],list:[],transcoding_media:[],isLoading:!1,isEmpty:!1,isRetry:!1,max_id:"",type:0}},created:function(){this.actionLog({uicode:"20000369"}),this.$Bus.$on("videoVoteAdded",this.videoVoteAdded)},beforeDestroy:function(){this.$Bus.$off("videoVoteAdded",this.videoVoteAdded)},components:{Scroll:c["a"]},filters:{dayMoment:function(t){var e=new Date(t),i=e.getMonth()+1,s=e.getDate(),a=e.getHours()<10?"0"+e.getHours():e.getHours(),n=e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes(),o=e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds(),c=i+"月"+s+"日 "+a+":"+n+":"+o;return c}},computed:Object(o["a"])(Object(o["a"])({},Object(u["c"])(["config"])),{},{hasnav:function(){return"0"!==this.$route.query.hasnav}}),watch:{$route:function(t){}},methods:{updateUrl:function(t){var e=this;return new Promise(function(){var i=Object(n["a"])(regeneratorRuntime.mark((function i(s){var a,n,o;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(!e.ssigHook){i.next=7;break}return i.next=3,e.ssigHook.call(e);case 3:a=i.sent,s(a),i.next=15;break;case 7:return i.next=9,e.$http.post("/ajax/multimedia/createCert");case 9:if(n=i.sent,!(n.data.ok>0&&n.data.result)){i.next=15;break}return i.next=13,e.$http.get("/ajax/multimedia/getSsigUrl",{params:{url:t}});case 13:o=i.sent,o.data.ok>0&&o.data.data&&s(o.data.data.url);case 15:s();case 16:case"end":return i.stop()}}),i)})));return function(t){return i.apply(this,arguments)}}())},addVote:function(t){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function i(){var s,a,n,o,c,r,d;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return s={},a=t.url_objects,n=a.find((function(t){return t.object&&"video"===t.object.object_type})),o=n.object.object,c=o.url,i.next=7,e.updateUrl(c);case 7:r=i.sent,r?(d=o.id&&o.id.split(":")[1],s.media_id=d,s.id=t.schedule_id,s.duration=o.duration,s.stream_url=r,s.orientation=o.video_orientation,s.poster=o.image&&o.image.url||o.screenshots[1],e.$Bus.$emit("showVideoEditor",s)):e.$_w_toast({type:"warn",message:"该视频不支持添加投票"});case 9:case"end":return i.stop()}}),i)})))()},handleText:function(t){return Object(r["a"])(t,!0)},videoVoteAdded:function(t){var e=this;this.list.map((function(i){t===i.schedule_id&&e.$set(i,"added",!0)}))},showVideoVoteBtn:function(t){var e=this.config&&this.config.flags&&this.config.flags.can_create_vote;if(!e||t.added)return!1;if(!t.url_objects)return!1;var i=t.url_objects,s=i.find((function(t){return t.object&&"video"===t.object.object_type}));if(s&&s.object&&s.object.object&&s.object.object.url){var a=s.object_id,n=s.object.object,o=!n.author_mid,c=n.duration,r=a&&-1===a.indexOf("1022:100161")||-1===a.indexOf("1022:230282"),d=n&&n.extension&&n.extension.extension&&n.extension.extension.vote_is_show;return 1!==d&&r&&o&&c>=10}},imageUrl:function(t){var e={};if(t.url_objects){var i=t.url_objects;e=i.find((function(t){return t.object&&"video"===t.object.object_type}))}return t.thumbnail_pic||e&&e.object&&e.object.object&&e.object.object.image&&e.object.object.image.url||e&&e.object&&e.object.object&&e.object.object.screenshots[1]},loadMoreData:function(){this.query()},query:function(){var t=this;this.isLoading=!0,this.isRetry=!1,this.isEmpty=!1;var e={type:this.type,max_id:this.max_id};this.$http.get("/ajax/statuses/schedule/list?"+l.a.stringify(e)).then((function(e){if(t.isLoading=!1,e.data&&e.data.data){var i,s,a;t.max_id=e.data.data.max_id;var n,o,c=e.data.data.statuses;if(null===(i=e.data)||void 0===i||null===(s=i.data)||void 0===s||null===(a=s.transcoding_media)||void 0===a?void 0:a.length)t.transcoding_media=null===(n=e.data)||void 0===n||null===(o=n.data)||void 0===o?void 0:o.transcoding_media,t.transcoding_media.map((function(t){t.trans=1})),c=t.transcoding_media.concat(c);t.list=t.list.concat(c),t.list.map((function(t){t.id=t.schedule_id})),t.isLoading=!0,t.max_id||(t.isEmpty=!0,t.isLoading=!1),0===t.list.length&&(t.isEmpty=!0,t.isLoading=!1)}else t.isLoading=!1}))},changeTab:function(t){this.type=t,this.max_id="",this.list=[],this.loadMoreData();var e=this.$route.query;this.$router.push({query:Object(o["a"])({type:t},e)})},send:function(t,e){var i=this;this.$_w_dialog({type:"confirm",title:"确认立即发送？",message:"这条微博将取消定时状态，并立即发布",action:function(){i.$http.post("/ajax/statuses/schedule/upload_immediately",{schedule_id:t.schedule_id}).then((function(t){t.data&&t.data.data&&t.data.data.result&&(i.list.splice(e,e+1),0===i.list.length&&(i.isEmpty=!0),i.$_w_toast({type:"success",message:"发布成功"}))}))}})},destory:function(t,e){var i=this;this.$_w_dialog({type:"confirm",title:"确认删除？",message:"删除之后将不可恢复",action:function(){i.$http.post("/ajax/statuses/schedule/destory",{schedule_id:t.schedule_id}).then((function(t){t.data&&t.data.data&&t.data.data.result&&(i.list.splice(e,1),0===i.list.length&&(i.isEmpty=!0),i.$_w_toast({type:"success",message:"删除成功"}))}))}})},handleMix:function(t){if(t.mix_media_ids)return{items:t.mix_media_ids.map((function(e){if(t.pic_ids.includes(e))return{type:"pic",id:e,data:{bmiddle:{url:t.bmiddle_pic.split(",").find((function(t){return t.includes(e)}))}}};var i,s=t.url_objects.find((function(t){return t.object_id==="1034:".concat(e)}));return{type:"video",id:"1034:".concat(e),duration:null===s||void 0===s||null===(i=s.object)||void 0===i?void 0:i.object.duration,data:{object_type:"video",short_url:s.object.object.url,page_pic:s.object.object.image.url,media_info:{media_id:e}}}}))}},edit:function(t,e){var i,s,a,n,c,r,d={};d.mix_media_info=this.handleMix(t),this.$Bus.$emit("showModalPublish",{action:"schedule",title:"编辑微博",data:Object(o["a"])({videoImage:"video"===(null===t||void 0===t||null===(i=t.url_objects)||void 0===i||null===(s=i[0])||void 0===s||null===(a=s.object)||void 0===a||null===(n=a.object)||void 0===n?void 0:n.object_type)&&t.url_objects[0].object.object.image.url&&!t.mix_media_ids,content:t.longText?t.longText.longTextContent:t.text,visable:0,schedule_id:t.schedule_id,schedule_timestamp:Number(new Date(t.schedule_at).getTime()),pic_id:t.pic_ids,pic_infos:t.pic_infos,is_paid:t.is_paid,ai_assistant_comment_type:null===t||void 0===t||null===(c=t.comment_manage_info)||void 0===c?void 0:c.ai_assistant_comment_type,approval_comment_type:null===t||void 0===t||null===(r=t.comment_manage_info)||void 0===r?void 0:r.approval_comment_type,callback:{callback:this.editFun,index:e},actLogData:{page:"qPublisher"}},d)})},editFun:function(t,e){var i=this;this.$nextTick((function(){e.id=e.schedule_id,1===Number(i.$route.query.type)?(i.list.splice(t,1),0===i.list.length&&(i.isEmpty=!0)):i.list.splice(t,1,e)}))},schedulePubliser:function(){this.$Bus.$emit("showModalPublish",{action:"timer",title:"发布定时微博",data:{callback:{callback:this.addFun},actLogData:{page:"qPublisher"}}})},addFun:function(t){var e=this;this.$nextTick((function(){t.schedule_id&&(t.id=t.schedule_id,e.list.unshift(t))}))}},mounted:function(){this.changeTab(this.$route.query.type?Number(this.$route.query.type):0)}},h=_,b=i("96ae"),p=i("2877");function m(t){this["$style"]=b["default"].locals||b["default"]}var f=Object(p["a"])(h,s,a,!1,m,null,null);e["default"]=f.exports},"96ae":function(t,e,i){"use strict";var s=i("d45b"),a=i.n(s);e["default"]=a.a},d45b:function(t,e,i){t.exports={cut2:"Schedule_cut2_1iari",box:"Schedule_box_2sz0t",listbox:"Schedule_listbox_1ffOT",pic:"Schedule_pic_2BUMf",wrap:"Schedule_wrap_2bA6n",line:"Schedule_line_2OPPj",item:"Schedule_item_1EUl_",item2:"Schedule_item2_CDXLh",right:"Schedule_right_1_iDx",btn1:"Schedule_btn1_RGLl6",btn12:"Schedule_btn12_y6SQV",btn2:"Schedule_btn2_2qBSs",btn3:"Schedule_btn3_1LLLN",con:"Schedule_con_1S8_7",h4:"Schedule_h4_2H_sk",cls1:"Schedule_cls1_yTlgw",cls2:"Schedule_cls2_QUIF8",mar1:"Schedule_mar1_2Py07",tab:"Schedule_tab_ktg8H",tab2:"Schedule_tab2_3q0Dj",tab2in:"Schedule_tab2in_3EIyJ",cur:"Schedule_cur_3Gept",tit:"Schedule_tit_2u2ZI",radio:"Schedule_radio_IrwNV",back:"Schedule_back_1-3fC",btnhasnav:"Schedule_btnhasnav__NQQv",tabnonav:"Schedule_tabnonav_aQdRI"}}}]);