$(function(){$("#CIDX a").on("click",function(){var j=$(".search-input").val();var i=$(".search-input").attr("placeholder");if(!!j==true&&j!=i){$(this).attr("href","//kns.cnki.net/kns/brief/default_result.aspx?code=CIDX&kw="+encodeURIComponent(j))}});a();function a(){backBtn=$(".back-top");var i=500;$(window).on("load scroll",function(){if($(window).scrollTop()>i){backBtn.removeClass("hidden")}else{backBtn.addClass("hidden")}});backBtn.click(function(){dur=backBtn.offset().top/10;$("body,html").animate({scrollTop:0},dur);return false})}e();function e(){var l=0;topBanner=$(".banner-main-img");topBControls=$(".ui-controls");var i=topBanner.find("li").length;topBControls.find("li").click(function(){$(this).addClass("current").siblings().removeClass("current");topBanner.find("li").eq($(this).index()).fadeIn(300).siblings().fadeOut(300);l=$(this).index()});var j=function(){topBControls.find("li").eq(l).addClass("current").siblings().removeClass("current");topBanner.find("li").eq(l).fadeIn(300).siblings().fadeOut(300)};var k=null;k=setInterval(function(){l++;if(l>=i){l=0}j()},3000);$(".banner-main").hover(function(){clearInterval(k)},function(){k=setInterval(function(){l++;if(l>=i){l=0}j()},3000)})}$("#rollImg-1").slideBox({duration:0.5,easing:"linear",delay:5,hideClickBar:false,clickBarRadius:8});$("#rollImg-2").slideBox({duration:0.5,easing:"linear",delay:5,hideClickBar:false,clickBarRadius:8});defaultLoadPageJsonInfo();$(".search-tab").find("li").click(function(){_index=$(this).parent().find("li").index(this);$(this).parents(".wrapper").removeClass("section1 section2 section3").addClass("section"+(_index+1));$(this).addClass("on").siblings().removeClass("on");$(".banner").find("li").eq(_index).fadeIn(1000).siblings().fadeOut(1000);$(".input-box").removeClass("fullinput");if($(this).attr("val")=="doc"){$("#txt_SearchText").attr("placeholder","中文文献、外文文献")}else{if($(this).attr("val")=="ref"){$("#txt_SearchText").attr("placeholder","请输入被引文献的特征词")}else{$("#txt_SearchText").attr("placeholder","")}}if($(this).attr("val")=="ele"){$("#highSearch").parent().addClass("one")}else{$("#highSearch").parent().removeClass("one")}if($(this).attr("val")=="ref"){$("#curdbcode").val("CRLD")}else{var i=f();if(!!i==false){if($(this).attr("val")=="ele"){$("#curdbcode").val("CRFD");i="CRFD";$(".option-list .zsy li:first").addClass("selected")}else{$("#curdbcode").val("SCDB");i="SCDB";$("#CJFQ,#CDMD,#CIPD,#CCND,#CISD,#SNAD,#BDZK,#CCJD").addClass("selected")}}if(i.indexOf(",")>0){$("#curdbcode").val("SCDB")}else{$("#curdbcode").val(i)}if(i=="CRFD"){$(".input-box").addClass("fullinput");$("#txt_SearchText").attr("placeholder","请输入检索词...")}else{if(i=="IMAGE"){$(".input-box").addClass("fullinput");$("#txt_SearchText").attr("placeholder","图片检索，请输入关键词")}else{if(i=="CSYD"){$(".input-box").addClass("fullinput");$("#txt_SearchText").attr("placeholder","检索指标、条目、资讯和资料")}}}}defaultLoadPageJsonInfo();inputFunc($("#txt_SearchText"))});g(".sort","cur");function g(j,i){$(j).mouseenter(function(){$selectList=$(this).find(".sort-list");$selectList.show();$selectList.find("a").click(function(){$selectList.siblings().find("span").html($(this).text());$("#txt_sug").val($(this).text());$(".sort-list").find("li").removeClass(i);$(this).parent().addClass(i);$selectList.hide()})}).mouseleave(function(){$selectList.hide()})}$(".option-list").find("li>i").click(function(){$(this).parent().toggleClass("selected")});$("#js-gallery").royalSlider({arrowsNav:false,fadeinLoadedSlide:true,controlNavigationSpacing:0,controlNavigation:"thumbnails",thumbs:{appendSpan:true,firstMargin:true,autoCenter:true,fitInViewport:true,orientation:"vertical",spacing:0,paddingBottom:0},keyboardNavEnabled:true,imageScaleMode:"fill",imageAlignCenter:true,slidesSpacing:0,loop:false,loopRewind:true,numImagesToPreload:3,autoScaleSlider:true,autoScaleSliderWidth:680,autoScaleSliderHeight:345});inputFunc($("#txt_SearchText"));$(".search-btn").click(function(){var m=$.trim($(".search-input").val());var l=$(".search-input").attr("placeholder");if(!!m==false||m==l){alert("请输入检索内容！");return false}selectedValue=$("#DBFieldBox .sort-default span").text();var i=f(1);if(i=="CRDD"){window.open("https://cidian.cnki.net/urtpweb/result?sysid=112&s=vs1&f=vs1&v="+encodeURIComponent(m),"cnkiSearch");return false}if(i=="IMAGE"){window.open("https://image.cnki.net/Result.aspx?n="+encodeURIComponent(m),"cnkiSearch");return false}if(i=="CSYD"){window.open("//data.cnki.net/valueSearch/index?ky="+encodeURIComponent(m),"cnkiSearch");return false}if(i=="CRFD"){window.open("https://gongjushu.cnki.net/RBook/Search/SimpleSearch?range=TOTAL&opt=0&key="+encodeURIComponent(m)+"&c=1","cnkiSearch");return false}if(i=="CRPD"){window.open("https://gongjushu.cnki.net/rbook/science?kw="+encodeURIComponent(m),"cnkiSearch");return false}if(i=="CRMD"){window.open("https://gongjushu.cnki.net/rbook/handbook?kw="+encodeURIComponent(m),"cnkiSearch");return false}if(i=="ECPD"){window.open("https://baike.cnki.net/#/result?kw="+encodeURIComponent(m)+"&option=0","cnkiSearch");return false}if(i=="CRLD"){var k="https://ref.cnki.net/REF/AdvSearch/Index?colName="+encodeURIComponent(selectedValue)+"&colValue="+encodeURIComponent(m)+"&isJump=true";if($("#userid").length>0){k=k+"&uid="+$("#userid").val()}window.open(k,"cnkiSearch");return false}if(i=="CIDX"){var j="https://kns.cnki.net/kns/brief/default_result.aspx?code="+i;var m=$(".search-input").val();var l=$(".search-input").attr("placeholder");if(!!m==true&&m!=l){j="https://kns.cnki.net/kns/brief/default_result.aspx?code="+i+"&kw="+encodeURIComponent(m)}window.open(j,"cnkiSearch");return false}if(!!i==false){alert("请选择数据库！");return false}c(i,m)});function d(i,j){if(i&&j){i=i.toUpperCase();var k="SCOD,CISD,SNAD";if(k.indexOf(i)>=0){if(j.indexOf("SU")>=0){return j.replace("SU","FT")}}}return j}function c(p,j){var n=0;n=$(".sort-list .cur").attr("value");var i="https://kns.cnki.net/starter";var q=h(p);timeStamp=new Date().getTime();var o={rc:f(),kw:j,rt:b(f()),fd:n};var k=$("#formpost");if(k.length==0){k=$("<form id='formpost'></form>")}else{$("#formpost").html("")}k.attr("action",i);k.attr("method","get");k.attr("target","_self");var l;for(l in o){var m=$("<input type='hidden' name='"+l+"' />");m.attr("value",o[l]);k.append(m)}k.appendTo("body");k.css("display","none");k.submit()}$(".search-input").bind("keydown",function(i){if(i.which==13){i.preventDefault();$(".search-btn").click();return false}});$("#highSearch").click(function(l){var l=l||window.event;if(l.preventDefault){l.preventDefault()}else{l.returnValue==false}var i=f(1);var k=$.trim($(".search-input").val());var j=$(".search-input").attr("placeholder");if(k==j){k=""}if(i=="CRLD"){window.open("https://ref.cnki.net/REF/AdvSearch","highsearch")}else{if(i.indexOf(",")>0){window.open("https://kns.cnki.net/starter/advanced?rt=crossdb&rc="+encodeURIComponent(i),"highsearch")}else{i=h(i);restype=b(i);window.open("https://kns.cnki.net/starter/advanced?rt="+restype+"&rc="+encodeURIComponent(i),"highsearch")}}});function b(i){if(!i){return"crossdb"}i=i.toUpperCase();if(i=="CJFQ"||i=="CFLQ"||i=="CJFD"||i=="CCJD"||i=="WWJD"){return"journal"}else{if(i=="CDFD"||i=="CMFD"||i=="CDMD"){return"dissertation"}else{if(i=="CPFD"||i=="IPFD"||i=="CIPD"||i=="CFLP"||i=="WWPD"){return"conference"}else{if(i=="CCND"){return"newspaper"}else{if(i=="CYFD"){return"almanac"}else{if(i=="SCOD"||i=="SCPD"||i=="SOPD"){return"patent"}else{if(i=="CISD"||i=="SCSF"||i=="SCHF"||i=="SCSD"||i=="SOSD"){return"standard"}else{if(i=="SNAD"){return"achievements"}else{if(i=="BDZK"||i=="WBFD"||i=="WWBD"){return"bookchapters"}else{return"crossdb"}}}}}}}}}}function f(j){var k="";var l=".option-list .wx li.selected";var m=$(".searchmain .search-tab .on").attr("val");if(!!m&&m=="ele"){l=".option-list .zsy li.selected"}else{if(!!m&&m=="ref"){l=""}}var i=0;if(!!l){$(l).each(function(o){var n=$(this).attr("val");if(!!n){i++;k=k+","+n}})}if(k.length>1){k=k.substring(1,k.length)}if(!!m&&m=="ref"){k="CRLD"}if(j){if(k.toUpperCase()=="CDFD,CMFD"&&i==1){k="CDMD"}else{if(k.toUpperCase()=="CPFD,IPFD"&&i==1){k="CIPD"}}}if(k.indexOf(",")>0){k=k+",CCVD";if(k.indexOf("CJFQ")>=0){k=k+",CJFN"}}return k}function h(i){var j=i.indexOf(",")>0?"":i;if(j.toUpperCase()=="SCDB"){j=""}if(j.toUpperCase()=="CJFQ"){j="CFLQ"}if(j.toUpperCase()=="CIPD"){j="CFLP"}return j}$(".ai-btn").click(function(k){var k=k||window.event;if(k.preventDefault){k.preventDefault()}else{k.returnValue==false}var j=$.trim($(".search-input").val());var i=$(".search-input").attr("placeholder");if(j==i){j=""}window.open("https://aiplus.cnki.net/aiplus/direct?question="+encodeURIComponent(j)+"&type=fulllib","aiSearch")})});function isLoginByCookie(){var a=false;if(getUInfoFromECP("uname")!=""){a=true}return a}function IpLogin(){$.ajax({url:"//login.cnki.net/toplogin/api/loginapi/IpLogin2",type:"get",dataType:"jsonp",jsonp:"callback",success:function(a){if(a==1){LayInitComplete()}},error:function(){}})}function setLoginState(){setTimeout(function(){if(isLoginByCookie()){LayInitComplete()}},500)}function getUInfoFromECP(o){if(!o){return""}var ecpjosn=GetCookie("Ecp_LoginStuts");if(ecpjosn){ecpjosn=decodeURIComponent(ecpjosn);var ecpjosntype=eval("("+ecpjosn+")");switch(o){case"uname":return ecpjosntype.UserName;case"utype":return ecpjosntype.UserType;case"sname":return decodeURI(decodeURIComponent(ecpjosntype.ShowName));case"buname":return ecpjosntype.BUserName;case"butype":return ecpjosntype.BUserType;case"bsname":return decodeURI(decodeURIComponent(ecpjosntype.BShowName));default:return""}}return""}function GetCookie(a){var b="[;]*[s]*"+a+"=([^;]*)";var c=new RegExp(b);if(c.test(document.cookie)){return RegExp["$1"]}else{return""}}function LayInitComplete(){}function defaultLoadPageJsonInfo(){var a=$("#curdbcode").val();FillSearchSelectN(a)}function FillSearchSelect(e){var f=$("#DBFieldList li.cur a").text();var h="";var g=$("#DBFieldList");if(g){if(!!fieldJson){var d=null;for(var a=0;a<fieldJson.length;a++){if(fieldJson[a].key==e){d=fieldJson[a];break}}$(g).empty();if(d){h=d.value[0].key;var c=d.value.length;for(var b=0;b<c;b++){addOptionToUl(g,d.value[b].value,d.value[b].key,b)}SetLiSelected(g,f)}}}SetSelect()}function addOptionToUl(d,c,b,e){var f=$(d);if(f&&b!=""){var a="";if(e==0){a='<li class="cur" val="'+e+'" field="'+c+'"><a href="javascript:void(0);">'+b+"</a></li>"}else{a='<li val="'+e+'" field="'+c+'"><a href="javascript:void(0);">'+b+"</a></li>"}f.append(a)}}function FillSearchSelectN(h){var j=$("#DBFieldList li.cur a").text();var l="";var b=$("#DBFieldList");if(b){if(!!fieldJsonN){var e=null;for(var a=0;a<fieldJsonN.length;a++){if(fieldJsonN[a].Key.toLowerCase()==h.toLowerCase()){e=fieldJsonN[a];break}}$(b).empty();if(e){var f="";for(var c=0;c<e.Value.length;c++){f+="<ul>";if(e.Value[c].ColName){f+="<li class='tit'>"+e.Value[c].ColName+"</li>"}for(var d=0;d<e.Value[c].FieldList.length;d++){var g=e.Value[c].FieldList[d].Value;var k=g;if(g.indexOf("$")>0){k=g.substring(0,g.indexOf("$"))}if(d==0){f+=" <li class='cur' name='defult' value="+k+"><a value="+g+">"+e.Value[c].FieldList[d].Text+"</a></li>"}else{f+=" <li value="+k+"><a value="+g+">"+e.Value[c].FieldList[d].Text+"</a></li>"}}f+="</ul>"}$(b).html(f);SetLiSelected(b,j)}}}SetSelect()}function SetLiSelected(a,c){$(a).parent().show();var d=$(a).find("li");if(!!d==false){return false}d.removeClass("cur");var b=d.first();if(d.eq(0).hasClass("tit")){b=d.eq(1)}if(b){b.addClass("cur");$("#DBFieldBox .sort-default span").text(b.find("a").text());$("#txt_sug").val(b.find("a").text())}else{$(a).parent().hide()}}function SetSelect(){var a=$("#DBFieldList");if(a==undefined){return false}if(!!a.find("li")==false||a.find("li").length<=0){$("#DBFieldBox").hide();$(".input-box").addClass("fullinput")}else{$("#DBFieldBox").show();$(".input-box").removeClass("fullinput")}}function CrossDb(a){$("#txt_SearchText").attr("placeholder","中文文献、外文文献");if($(a).is(".selected")){ClearExpertPart()}GetSelectDb(a);defaultLoadPageJsonInfo();inputFunc($("#txt_SearchText"))}function ClearExpertPart(){$("#CLKD").removeClass("selected");$("#gwkt,#scef,#kjbg,#cgxx").removeClass("selected")}function SingleDb(d){$(".input-box").removeClass("fullinput");searchInput=$("#txt_SearchText");var b=".option-list .wx";var c=$(".searchmain .search-tab .on").attr("val");if(!!c&&c=="ele"){searchInput.attr("placeholder","");b=".option-list .zsy"}else{if(!!c&&c=="ref"){searchInput.attr("placeholder","请输入被引文献的特征词");b=""}else{searchInput.attr("placeholder","中文文献、外文文献")}}if($(d).is(".selected")){$(b).find("li").not($(d)).removeClass("selected")}GetSelectDb(d);defaultLoadPageJsonInfo();var a=$("#curdbcode").val();switch(a){case"CRPD":case"CRDD":case"CRMD":case"CRFD":$(".input-box").addClass("fullinput");searchInput.attr("placeholder","请输入检索词...");break;case"IMAGE":$(".input-box").addClass("fullinput");searchInput.attr("placeholder","图片检索，请输入关键词");break;case"CSYD":$(".input-box").addClass("fullinput");searchInput.attr("placeholder","检索指标、条目、资讯和资料");break;default:searchInput.attr("placeholder","");break}inputFunc($("#txt_SearchText"))}function LinkDb(b,a){$("#gwkt,#scef,#kjbg,#cgxx,#CLKD").removeClass("selected");$("#ywk").addClass("selected");window.open(a,"cnkiSearch")}function GetSelectDb(c){var a=$(c).parent().find(".selected");if($(c).parent().parent().hasClass("wx")){a=$(c).closest(".wx").find(".selected")}if(!!a&&a.length>1){$("#curdbcode").val("SCDB")}else{if(!!a&&a.length==1){var b=a.attr("id");$("#curdbcode").val(b)}else{$("#curdbcode").val("")}}}function inputFunc(a){setInput(a,"#7d7d7d",a.attr("placeholder"));a.focus(function(){setInput(a,"#000","")}).blur(function(){setInput(a,"#7d7d7d",a.attr("placeholder"))})}function setInput(d,c,a){arrPlaceholder=["","中文文献、外文文献","请输入您的问题（支持自然语言或关键词提问，自动从文献挖掘答案）","请输入被引文献的特征词","图片检索，请输入关键词","检索指标、条目、资讯和资料","请输入问题关键词，如：糖尿病治疗","请输入您想查询的主题（智能挖掘文献内部知识元信息）","请输入检索词..."];for(var b in arrPlaceholder){if(d.val()==arrPlaceholder[b]){d.css("color",c);d.val(a)}}}function CheckTerminalType(){try{var a=document.referrer;if(a&&a.toLowerCase().indexOf("wap.cnki.net")>-1){return}var d=navigator.userAgent;var b=d.toLowerCase();if(b.indexOf("android")>-1||b.indexOf("iphone")>-1){location.href="https://wap.cnki.net/touch/web/guide"}}catch(c){}}jQuery.fn.popCenter=function(c){defaults=$.extend({isReomvePop:true,closeBtns:[],btns:[]},c);var e=this,b=true;$mask=$('<div class="pop-mask"></div>');e.after($mask);$mask.css({height:$(document.body).outerHeight(true)});e.slideDown();_Width=parseInt(e.outerWidth());_Height=parseInt(e.outerHeight());function a(){leftPos=parseInt(($(window).width()/2)-(_Width/2));topPos=parseInt(($(window).height()/2)-(_Height/2));if($(window).width()<_Width){leftPos=0}if($(window).height()<_Height){topPos=0}e.show().css({top:$(".header").height()+2})}if(b){$(document).on("click",function(f){$tar=$(f.target);if($tar.closest($mask).length==1){$(document).off("click");d(e)}for(var g in defaults.closeBtns){if($tar.closest(defaults.closeBtns[g]).length==1){$(document).off("click");d(e)}}for(var h in defaults.btns){if($tar.closest(defaults.btns[h]).length==1){$(document).off("click");d(e)}}})}function d(f){if(defaults.isReomvePop){f.remove()}else{f.hide()}$mask.remove();b=false;return false}$(window).on("resize scroll",function(){if(b){}return})};$(function(){var a=$(".notice-box");$(".new-entrance,.new-entrance-bottom").click(function(b){b.preventDefault();$("html,body").scrollTop(0).animate({scrollTop:0});a.popCenter({isReomvePop:false,closeBtns:[".btn-close"]})})});