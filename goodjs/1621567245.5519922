!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("JS Ads for Publishers",[],t):"object"==typeof exports?exports["JS Ads for Publishers"]=t():e["JS Ads for Publishers"]=t()}(self,(function(){return function(){var e={808:function(e,t,n){var r,i;!function(s){if(void 0===(i="function"==typeof(r=s)?r.call(t,n,t,e):r)||(e.exports=i),!0,e.exports=s(),!!0){var o=window.Cookies,a=window.Cookies=s();a.noConflict=function(){return window.Cookies=o,a}}}((function(){function e(){for(var e=0,t={};e<arguments.length;e++){var n=arguments[e];for(var r in n)t[r]=n[r]}return t}function t(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function n(r){function i(){}function s(t,n,s){if("undefined"!=typeof document){"number"==typeof(s=e({path:"/"},i.defaults,s)).expires&&(s.expires=new Date(1*new Date+864e5*s.expires)),s.expires=s.expires?s.expires.toUTCString():"";try{var o=JSON.stringify(n);/^[\{\[]/.test(o)&&(n=o)}catch(e){}n=r.write?r.write(n,t):encodeURIComponent(String(n)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var a="";for(var c in s)s[c]&&(a+="; "+c,!0!==s[c]&&(a+="="+s[c].split(";")[0]));return document.cookie=t+"="+n+a}}function o(e,n){if("undefined"!=typeof document){for(var i={},s=document.cookie?document.cookie.split("; "):[],o=0;o<s.length;o++){var a=s[o].split("="),c=a.slice(1).join("=");n||'"'!==c.charAt(0)||(c=c.slice(1,-1));try{var d=t(a[0]);if(c=(r.read||r)(c,d)||t(c),n)try{c=JSON.parse(c)}catch(e){}if(i[d]=c,e===d)break}catch(e){}}return e?i[e]:i}}return i.set=s,i.get=function(e){return o(e,!1)},i.getJSON=function(e){return o(e,!0)},i.remove=function(t,n){s(t,"",e(n,{expires:-1}))},i.defaults={},i.withConverter=n,i}((function(){}))}))}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var s=t[r]={exports:{}};return e[r](s,s.exports,n),s.exports}n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};return function(){"use strict";var e,t;n.r(r),function(e){e.popunderTriggered="popunderTriggered",e.embeddedAdsLoaded="embeddedAdsLoaded",e.embeddedAdsError="embeddedAdsError",e.embeddedAdsSpotLoaded="embeddedAdsSpotLoaded",e.embeddedAdsSpotFailed="embeddedAdsSpotFailed",e.embeddedAdsSpotDefaultLoaded="embeddedAdsSpotDefaultLoaded",e.embeddedAdsDebuggerUpdate="embeddedAdsDebuggerUpdate"}(e||(e={})),function(e){e[e.Low=99]="Low",e[e.Medium=550]="Medium",e[e.High=720]="High",e[e.VeryHight=1080]="VeryHight"}(t||(t={}));var i=n(808);const s={adBaseURL:`${location.protocol}//{ENV}/{METHOD}`,adClassNameContext:"adsbytrafficjunkycontext",cookies:{deliveryServer:{name:"TJDeliveryServer"},env:{name:"TJAdsUrl"}},videoFormats:["video/mp4","video/webm","video/ogg"]};class o{}var a,c;o.getEnv=e=>{const t=i.get(s.cookies.env.name),n=".trafficjunky.net";return t?`${t}${n}`:e||`ads${n}`},o.getDeliveryServer=()=>i.get(s.cookies.deliveryServer.name),function(e){e.context_pornstar="context_pornstar",e.context_category="context_category",e.context_tag="context_tag",e.context_page_type="context_page_type",e.info="info",e.category="category",e.search="search",e.site="site"}(a||(a={})),function(e){e.site_id="site_id",e.hb_guid="hc",e.version="t_version",e.platform="device_type",e.client_ip="clientIP",e.segment="segment",e.custom_param="",e.delivery_server="",e.refresh_times="",e.refresh_delay="",e.retry="",e.bg_color="",e.default_image="",e.default_url="",e.domain_rewrite="",e.fail_url="",e.spot_ssp="",e.spot_new=""}(c||(c={}));class d{createURL(e,t=!1){const n=e.specificParams.domain_rewrite;let r=s.adBaseURL;r=r.replace("{ENV}",o.getEnv(n)),r=r.replace("{METHOD}",this.getMethod(e,t)),t?(r+=`?zone_id=${e.spotId}&redirect=1&format=popunder`,r+=`&clientType=${encodeURIComponent(String(e.specificParams.platform))}`):(r+=`?data=${encodeURIComponent(`[{"spots":[{"zone":${e.spotId}}]}]`)}`,r+="&clientType=mobile"),r+=this.getChannelsParameters(e.channelParams),r+=this.getSpecificParameters(e.specificParams,t);const i=o.getDeliveryServer();return i&&(r+=`&delivery-server=${i}`),n&&(r+=`&dm=${encodeURIComponent(n)}`),r+=`&_=${Date.now()}`,e.specificParams.custom_param&&(r+=e.specificParams.custom_param),r}getSpecificParams(e,t){const n=Object.assign(Object.assign({},t),e),r={};for(const e in n)e in c&&(r[e]=n[e]);return r}getChannelParams(e,t){const n=Object.assign(Object.assign({},t),e),r={};for(const e in n)e in a&&(r[e]=n[e]);return r}getAdContextAttributes(){const e=document.querySelector(`meta[name="${s.adClassNameContext}"]`);return e?u.getDataAttributes(e):null}getChannelsParameters(e){let t="";if(!e)return t;for(const n in e)a[n]&&e[n]&&(t+=`&channel[${n}]=${encodeURIComponent(e[n])}`);return t}getSpecificParameters(e,t){let n="";for(const r in e){if(!c[r]||!e[r])continue;const i=this.getSpecificParameterValue(e,t,r);n+=`&${c[r]}=${encodeURIComponent(i)}`}return n}getSpecificParameterValue(e,t,n){return"platform"!==n||t||"pc"!==e[n]?e[n]:"tablet"}getMethod(e,t){return"true"===e.specificParams.spot_ssp?"deep-ssp":t?"ads":"ads_batch"}}class l{static log(t,n){l.logs[t]||(l.logs[t]=[]),n&&(n.logTime=new Date(Date.now())),l.logs[t].push(n);const r=JSON.parse(JSON.stringify(this.debug()));window.postMessage({debug:r,name:t,type:e.embeddedAdsDebuggerUpdate},"*")}static getSpots(){const t={};for(const n in l.logs){-1!==[e.embeddedAdsSpotDefaultLoaded,e.embeddedAdsSpotFailed,e.embeddedAdsSpotLoaded].indexOf(n)&&l.populateMapForEvent(n,t)}return l.populateSpots(t)}static populateSpots(t){const n={};for(const r in t){n[r]||(n[r]={});const i=t[r][e.embeddedAdsSpotFailed];this.populateSpotsPerRefreshed(n[r],i,"failed");const s=t[r][e.embeddedAdsSpotDefaultLoaded];this.populateSpotsPerRefreshed(n[r],s,"default_loaded");const o=t[r][e.embeddedAdsSpotLoaded];this.populateSpotsPerRefreshed(n[r],o,"loaded")}return this.formatSpots(n)}static formatSpots(e){const t={};for(const n in e){t[n]=[];for(const r in e[n])t[n].push(e[n][r])}return t}static populateMapForEvent(e,t){for(let n=0;n<l.logs[e].length;n++){const r=l.logs[e][n].ad;t[r.refreshed]||(t[r.refreshed]={}),t[r.refreshed][e]||(t[r.refreshed][e]={}),t[r.refreshed][e][r.uuid]={container:l.logs[e][n].container,spotId:r.spotId}}}static populateSpotsPerRefreshed(e,t,n){if(t)for(const r in t)e[r]={container:t[r].container,spotId:t[r].spotId,status:n}}static getHBSpots(){const e=document.querySelectorAll("script[src*='/ads_batch']");for(let t=0;t<e.length;t++){const n=String(e[t].getAttribute("src")),r=l.getHBSpotsFromScript(n);if(r)return r}return null}static getHBSpotsFromScript(e){try{if(!e||-1===e.indexOf("?"))return null;e=e.substring(e.indexOf("?"));const t=new URLSearchParams(e);if(!t.get("hb"))return null;const n=JSON.parse(t.get("data"))[0].spots,r=[];for(let e=0;e<n.length;e++)r.push(n[e].zone);return r}catch(e){return null}}}l.logs={},l.debug=()=>({context:l.adContextAttributes,events:l.logs,hbSpots:l.getHBSpots(),spots:l.getSpots()});class u{static connectionInfo(){return navigator.connection||navigator.mozConnection||navigator.webkitConnection}static getNearestAvailableQuality(e,t){const n=Number(t);let r=Object.keys(e);if(0===r.length)return null;r=r.filter((t=>"progressive"===e[t].delivery)),r=r.filter((t=>{const n=e[t];return!!n.type&&["video/mp4","video/webm","video/ogg"].includes(n.type)}));return r.sort(((e,t)=>{const r=Number(e),i=Number(t);return isNaN(r)?1:isNaN(i)?-1:Math.abs(n-r)-Math.abs(n-i)}))[0]}}u.createDOMElement=(e,t={})=>{const n=document.createElement(e);for(const e in t)n.setAttribute(e,t[e]);return n},u.getDataAttributes=e=>{var t,n;const r=[].filter.call(e.attributes,(e=>/^data-/.test(e.name))),i={};for(const e in r){const s=null===(t=r[e].name)||void 0===t?void 0:t.replace("data-","").replace(/-/g,"_"),o=null===(n=r[e].value)||void 0===n?void 0:n.trim();o&&s&&(i[s]=u.sanitize(o))}return i},u.isLeftButton=e=>1===(e.which||e.button),u.isAdBlock=()=>{const e=document.createElement("div");e.innerHTML="&nbsp;",e.className="adsbox";let t=!1;try{document.body.appendChild(e),t=0===document.getElementsByClassName("adsbox")[0].offsetHeight,document.body.removeChild(e)}catch(e){t=!0}return t||!window.tjEmbeddedAdsLoaded},u.dispatchTjEvent=(t,n)=>{const r=document.createEvent("Event");r.initEvent(t,!1,!0),n&&(r.detail=n),document.dispatchEvent(r),l.log(t,n),t===e.embeddedAdsSpotFailed&&u.sendFailEvent(n)},u.sendFailEvent=e=>{var t;const n=(new d).getAdContextAttributes();if(!n||!n.fail_url)return;if(0===e.status)return;const r=new XMLHttpRequest;r.open("POST",n.fail_url),r.send(JSON.stringify({pageUrl:window.location.href,retryCounter:e.retried,tjAdData:null!==(t=e.request.response)&&void 0!==t?t:"",tjAdRequestUrl:e.request.url,tjResponseCode:e.request.status,tjResponseTime:e.request.duration,tjZoneID:e.ad.spotId}))},u.getQuality=()=>{const e=u.connectionInfo();return e?e.downlink<.3?t.Low:e.downlink<.7?t.Medium:t.High:t.Medium},u.sanitize=e=>{const t={"<":"&lt;",">":"&gt;"};return e.replace(/[<>]/gi,(e=>t[e]))};var h=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class p{static dispatchError(t){p.dispatch(e.embeddedAdsError,null,{error:JSON.stringify(t,Object.getOwnPropertyNames(t))})}}p.createInlineStyle=(e,t=!1)=>{let n="";for(const t in e){let r="";";"!==e[t].substr(e[t].length-1)&&(r=";"),n+=`${t}:${e[t]}${r}`}return t&&(n=n.replace(/!important/g,"").replace(/;/g,"!important;")),n},p.getElementByTag=(e,t)=>e.tagName===t.toUpperCase()?e:e.querySelector(t),p.getElementBySpotId=(e,t)=>h(void 0,void 0,void 0,(function*(){const n=`.${e}[data-source-id="${t}"], .${e}[data-spot-id="${t}"]`;let r=0;for(;!document.querySelector(n);){if(r++>20)return null;yield new Promise((e=>requestAnimationFrame(e)))}return document.querySelector(n)})),p.dispatch=(e,t=null,n={})=>{u.dispatchTjEvent(e,p.getEventParams(t,n))},p.getEventParams=(e=null,t={})=>(e&&(t=Object.assign({ad:Object.assign({},e.params),channelParams:e.channelParams,container:e.containerElement,request:Object.assign(Object.assign({},e.request),{duration:Date.now()-Number(e.request.duration)}),specificParams:e.specificParams},t)),t),p.getUUID=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}));const m={adClassName:"adsbytrafficjunky",botttomAdName:"tjBottomAd",closeImageURL:`${location.protocol}//static.trafficjunky.com/delivery/img/close.png`,cookies:{bottom:{expiry:48e4,name:"TJBottomClose"},fail:{name:"TJAdsFail"},server:{expiry:36e5,name:"RLBNSERVERID"}},defaults:{bg_color:"transparent",platform:"mobile"},idSync:{scriptUrl:"https://static.trafficjunky.com/invocation/idsync/production/idsync.min.js",sites:["tube8","pornhub","youporn","redtube","xtube"]}};class f{static createURL(e,t=!1){return f.adService.createURL(e,t)}static getSpecificParams(e,t){return f.adService.getSpecificParams(e,t)}static getChannelParams(e,t){return f.adService.getChannelParams(e,t)}static getAdContextAttributes(){const e=f.adService.getAdContextAttributes();return l.adContextAttributes=e,e}}f.adService=new d;const g={"background-color":"#000000",border:"none",display:"block",margin:"0 auto",overflow:"hidden"},v={border:"none",display:"block",height:"100%",left:"0","margin-left":"auto","margin-right":"auto",position:"absolute",right:"0",top:"0","vertical-align":"middle",width:"100%"},y={overflow:"hidden",position:"relative"},b={"-ms-transform":"translateX(-50%)",bottom:"0px",display:"block",left:"50%",position:"fixed",transform:"translateX(-50%)","z-index":"9999"},w={background:`url(${m.closeImageURL})`,"background-repeat":"no-repeat",cursor:"pointer",height:"20px",position:"absolute",right:"-10px",top:"-10px",width:"20px"},S={overflow:"hidden",position:"relative"},A={left:"0",position:"absolute",top:"0",width:"100%"};class x{}x.fixSrcDoc=e=>{var t,n,r;if("srcdoc"in document.createElement("iframe"))return;if("IFRAME"!==e.tagName&&(e=e.querySelector("iframe")),!e)return;const i=e,s=null==i?void 0:i.getAttribute("srcdoc");s&&(null===(t=i.contentWindow)||void 0===t||t.document.open(),null===(n=i.contentWindow)||void 0===n||n.document.write(s),null===(r=i.contentWindow)||void 0===r||r.document.close())},x.fixMobileVideoAd=e=>{if(!e)return e;const t=e.indexOf('<div class="adtool_video_ad"');return-1!==t&&(e=`${e.substr(0,t)}\n\t\t\t<script src='//cdn11.contentabc.com/delivery/mobile_video/adtool_mobile_video_player_min.js'><\/script>\n\t\t\t${e.substr(t)}`),e};var C=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class P extends class{constructor(e,t){this.channelParams={},this.specificParams={},this.request={},this.getParams=e=>({height:String(e.height),refreshed:0,spotId:e.source_id?Number(e.source_id):Number(e.spot_id),type:String(e.type),uuid:p.getUUID(),width:String(e.width)}),this.setChannelAndSpecificParams=(e,t)=>{this.specificParams=f.getSpecificParams(e,t),this.channelParams=f.getChannelParams(e,t);for(const e in m.defaults)this.specificParams[e]||(this.specificParams[e]=m.defaults[e])},this.params=this.getParams(e),this.setChannelAndSpecificParams(e,t)}}{constructor(t,n,r){super(n,r),this.createWithDefaultIfFail=(t,n)=>C(this,void 0,void 0,(function*(){const r=Number(this.specificParams.retry)||0;this.request.defaultAd=!1;for(let n=0;n<r+1;n++){const r=yield t();if(r)return r;p.dispatch(e.embeddedAdsSpotFailed,this,{retried:n})}return this.createDefaultAd(n)})),this.createDefaultAd=e=>{if(!this.specificParams.default_image||!this.specificParams.default_url)return null;(e=e||Object.assign({height:this.params.height,width:this.params.width},g))["background-color"]=this.specificParams.bg_color;const t=u.createDOMElement("img",{src:this.specificParams.default_image,style:p.createInlineStyle(e)}),n=u.createDOMElement("a",{"data-embeddedadsfallback":"true","data-height":this.params.height,"data-spot-id":this.params.spotId,"data-width":this.params.width,href:this.specificParams.default_url,target:"_blank"});return n.appendChild(t),this.request.defaultAd=!0,n},this.containerElement=t,this.refresh()}refresh(){const e=Number(this.specificParams.refresh_delay),t=Number(this.specificParams.refresh_times);if(!e||!t)return;let n=0;this.interval=window.setInterval((()=>{++n>=t&&window.clearInterval(this.interval),this.params.refreshed++,"function"==typeof this.revert&&this.revert(),this.run()}),1e3*e)}reload(){window.clearInterval(this.interval),"function"==typeof this.revert&&this.revert(),this.run(),this.refresh()}run(){return C(this,void 0,void 0,(function*(){if(!this.checkIfCreatable())return!1;this.request.duration=Date.now();const t=yield this.create();if(!t||!document.body.contains(this.containerElement))return"function"==typeof this.revert&&this.revert(),!1;this.insertIntoDOM(t),this.removeInvocationCode(),this.containerElement=t,x.fixSrcDoc(t);const n=this.request.defaultAd?e.embeddedAdsSpotDefaultLoaded:e.embeddedAdsSpotLoaded;return p.dispatch(n,this),!0}))}checkIfCreatable(){return!(!this.containerElement||!this.containerElement.parentNode)&&document.body.contains(this.containerElement)}insertIntoDOM(e){this.containerElement&&this.containerElement.parentNode&&this.containerElement.parentNode.insertBefore(e,this.containerElement.nextSibling)}removeInvocationCode(){this.containerElement&&this.containerElement.parentNode&&this.containerElement.parentNode.removeChild(this.containerElement)}}class E{static wasClosed(){return Boolean(i.get(m.cookies.bottom.name))}static isTestFail(){return Boolean(i.get(m.cookies.fail.name))}static close(){const e=new Date(Date.now()+m.cookies.bottom.expiry);i.set(m.cookies.bottom.name,"1",{expires:e,secure:!0})}}E.setDeliveryServer=e=>{if(!e)return;const t=new Date(Date.now()+m.cookies.server.expiry);i.set(m.cookies.server.name,e,{expires:t,secure:!0})};class k{static getHBAd(e){const t=window.tjPreloadAds[e.params.spotId],n=E.isTestFail()?null:t.response;return e.request.duration=Date.now()-t.duration,e.request.url=t.url,e.request.status=t.status,e.request.response=t.response,delete window.tjPreloadAds[e.params.spotId],(new Y).load(),new Promise((e=>e(n)))}static verifyResponse(e,t,n){return t.request.url=n,t.request.status=e.status,t.request.response=e.responseText,!window.XDomainRequest&&200!==e.status||!e.responseText||E.isTestFail()?null:e.responseText}}k.makeRequest=e=>window.tjPreloadAds&&window.tjPreloadAds[e.params.spotId]?k.getHBAd(e):new Promise((t=>{const n=window.XDomainRequest?new window.XDomainRequest:new XMLHttpRequest,r=f.createURL({channelParams:e.channelParams,specificParams:e.specificParams,spotId:e.params.spotId});n.onload=n.onerror=n.ontimeout=()=>{t(k.verifyResponse(n,e,r))},n.onprogress=()=>{},n.open("GET",r),n.timeout=1e4,n.send()}));var D,j,I=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class _{static create(e,t,n){return I(this,void 0,void 0,(function*(){let r=n;return r||(r=yield _.getJSONFromContent(e)),_.createSync(e,t,r)}))}static createSync(e,t,n){const r=_.createIframe(e,t);return _.inject(r,e,n)}static inject(e,t,n){const r=n;if(!r)return null;const i=_.getHTMLfromJSON(r);return i?(t.request.data=r,e.setAttribute("srcdoc",i),e):null}}_.wrap=(e,t,n)=>{const r=_.createIframe(e,n);return r.setAttribute("srcdoc",t.outerHTML),r},_.createIframe=(e,t)=>{(t=t||Object.assign({},g))["background-color"]=e.specificParams.bg_color;return u.createDOMElement("iframe",{allowtransparency:"true","data-embeddedads":"true","data-spot-id":e.params.spotId,height:e.params.height,marginheight:"0",marginwidth:"0",scrolling:"no",style:p.createInlineStyle(t,!0),width:e.params.width})},_.getJSONFromContent=e=>I(void 0,void 0,void 0,(function*(){const t=yield k.makeRequest(e);if(!t)return null;try{return JSON.parse(t)[0]}catch(e){return null}})),_.getHTMLfromJSON=e=>{let t="";return e.full_html?t=e.full_html:e.html&&(t=e.html),x.fixMobileVideoAd(t)};class O{constructor(e,t){this.create=()=>_.createSync(this.baseAd,void 0,this.json),this.baseAd=e,this.json=t}}class T{constructor(e,t){this.lastPlayPos=0,this.currentPlayPos=0,this.bufferingDetected=!1,this.video=e.firstChild,this.mediaFiles=t,this.setQuality(u.getQuality()),Object.keys(this.mediaFiles).length>1&&setInterval(this.checkBuffering,50)}checkBuffering(){if(!this.video)return;this.currentPlayPos=this.video.currentTime;this.isBuffering(.03)&&(this.bufferingDetected=!0),this.isBuffering(.03,!0)&&(this.bufferingDetected=!1),this.lastPlayPos=this.currentPlayPos}isBuffering(e,t=!1){return!!this.video.paused&&(t?this.bufferingDetected&&this.currentPlayPos>this.lastPlayPos+e:!this.bufferingDetected&&this.currentPlayPos<this.lastPlayPos+e)}setQuality(e){let t=this.mediaFiles[e];if(!t){const n=u.getNearestAvailableQuality(this.mediaFiles,e);if(!n)return;t=this.mediaFiles[n]}t&&(this.video.src=t.url)}}class N{getValue(e,t,n=null){let r=null;const i=e.querySelectorAll(t);for(let e=0;e<i.length;e++){const t=i[e],s=this.strip(t.textContent);if(s&&(!n||n&&s!==n)){r=s;break}}return r}strip(e){return e?e.replace("<![CDATA[","").replace("]]>","").trim():null}}!function(e){e.Start="start",e.FirstQuartile="firstQuartile",e.Midpoint="midpoint",e.ThirdQuartile="thirdQuartile",e.Complete="complete",e.Mute="mute",e.Unmute="unmute",e.Pause="pause",e.Resume="resume",e.Fullscreen="fullscreen",e.Skip="skip",e.Click="click",e.Impression="impression"}(D||(D={}));class M extends N{get(e){const t={},n=e.querySelectorAll("TrackingEvents Tracking");for(let e=0;e<n.length;e++){const r=n[e],i=r.getAttribute("event"),s=r,o=this.strip(s.textContent);this.addEventUrl(t,i,o)}return 0!==Object.keys(t).length?t:null}addEventUrl(e,t,n){t&&n&&D[t.charAt(0).toUpperCase()+t.slice(1)]&&(e[t]||(e[t]=[]),e[t].push(n))}}class L extends N{get(e){if(!(e=e.querySelectorAll("VideoClicks")[0]))return null;const t=this.getValue(e,"VideoClicks ClickThrough");if(!t)return null;const n=[],r=e.querySelectorAll("VideoClicks ClickTracking");for(let e=0;e<r.length;e++){const t=r[e],i=this.strip(t.textContent);i&&n.push(i)}return{clickThrough:t,clickTracking:n}}}class R extends N{get(e){const t={},n=e.querySelectorAll("MediaFiles MediaFile");for(let e=0;e<n.length;e++){const r=n[e],i=r,o=this.strip(i.textContent),a=Number(r.getAttribute("height")),c=r.getAttribute("type"),d=c&&s.videoFormats.includes(c);o&&d&&(t[a]={bitrate:Number(r.getAttribute("bitrate")),delivery:r.getAttribute("delivery"),height:a,type:c,url:o,width:Number(r.getAttribute("width"))})}return t}}class q extends N{constructor(){super(...arguments),this.getWithVideoClicksEvents=e=>{e.events||(e.events={});let t=e.events[D.Click]||[];return t=[...t,...e.videoClicks.clickTracking],e.events[D.Click]=t,e}}get(e){const t=[],n=e.querySelectorAll("Creatives Creative");for(let e=0;e<n.length;e++){let r=n[e];const i=r.getAttribute("AdID");if(r=r.querySelectorAll("Linear")[0],!r)continue;const s=this.getCreative(r,i);s&&t.push(this.getWithVideoClicksEvents(s))}return t.length?t:null}getCompanion(e){if(!e.querySelector("Creatives Creative CompanionAds Companion"))return null;const t=this.getValue(e,"StaticResource");return t?{clickThrough:this.getValue(e,"CompanionClickThrough"),clickTracking:this.getValue(e,"CompanionClickTracking"),staticRessource:t}:null}getCreative(e,t){const n=(new L).get(e),r=(new R).get(e);return n&&Object.keys(r).length?{duration:this.getValue(e,"Duration"),events:(new M).get(e),id:t,mediaFiles:r,videoClicks:n}:null}}class F extends N{get(e){const t=new q,n=t.get(e),r=t.getCompanion(e);return n?{adSystem:this.getValue(e,"AdSystem"),companion:r,creatives:n}:null}}class B extends O{constructor(){super(...arguments),this.create=()=>{try{const e=this.stringToVAST();if(!e)return null;this.vast=e,this.baseAd.request.data=this.json;const t=this.createVideo(),n=this.createOverlay(),r=this.createWrapper(t,n);return new T(t,this.vast.creatives[0].mediaFiles),_.wrap(this.baseAd,r)}catch(e){return null}},this.getEventScript=(e,t)=>{if(!t)return null;const n=u.createDOMElement("script");return n.innerHTML=`document.getElementById('${e}').onclick = function() { \n\t\t\t\t\t\t\t\tvar xhr = new XMLHttpRequest(); \n\t\t\t\t\t\t\t\txhr.open('GET', '${t}'); \n\t\t\t\t\t\t\t\txhr.send(); \n\t\t\t\t\t\t    };`,n}}createWrapper(e,t){const{width:n,height:r}=this.baseAd.params,i=p.createInlineStyle(Object.assign(Object.assign({},S),{height:r,width:n})),s=u.createDOMElement("div",{style:i});return s.appendChild(e),t&&s.appendChild(t),s}createOverlay(){if(!this.vast.companion)return null;const{staticRessource:e,clickThrough:t,clickTracking:n}=this.vast.companion,r=u.createDOMElement("img",{src:e,style:p.createInlineStyle(A)});if(!t)return r;const i=u.createDOMElement("a",{href:t,id:"overlay",target:"_blank"}),s=this.getEventScript("overlay",n);return i.appendChild(r),s&&i.appendChild(s),i}createVideo(){const e=u.createDOMElement("video",{autoplay:!0,loop:!0,muted:"muted",playsinline:"",preload:"auto",style:"width: 100%"});e.muted=!0,e.volume=0;const{clickThrough:t,clickTracking:n}=this.vast.creatives[0].videoClicks,r=u.createDOMElement("a",{href:t,id:"video",target:"_blank"}),i=this.getEventScript("video",n[0]);return r.appendChild(e),i&&r.appendChild(i),r}stringToVAST(){const e=(new DOMParser).parseFromString(this.json.full_html,"application/xml").querySelectorAll("InLine")[0];return e?(new F).get(e):null}}!function(e){e.AdaptiveVideo="adaptive_video",e.Video="video",e.Iframe="iframe",e.Image="image",e.VideoBanner="video_banner",e.Static="static"}(j||(j={}));class U{constructor(){this.create=(e,t)=>t.media_type===j.VideoBanner?new B(e,t):new O(e,t)}}var $=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class V extends P{constructor(){super(...arguments),this.create=()=>$(this,void 0,void 0,(function*(){return yield this.createWithDefaultIfFail(this.getIframeAd)})),this.getIframeAd=()=>$(this,void 0,void 0,(function*(){const e=yield _.getJSONFromContent(this);if(!e)return null;const t=(new U).create(this,e);return t?t.create():null}))}}var H=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class J extends P{constructor(){super(...arguments),this.createBottomAdElement=()=>H(this,void 0,void 0,(function*(){const e=yield this.createWithDefaultIfFail((()=>_.create(this)));if(!e)return null;const t=this.createContainer(),n=p.createInlineStyle({height:`${this.params.height}`,width:`${this.params.width}`}),r=u.createDOMElement("div",{style:n});return r.appendChild(this.createCloseButton(t)),r.appendChild(e),t.appendChild(r),t})),this.createCloseButton=e=>{const t=u.createDOMElement("div");return t.setAttribute("style",p.createInlineStyle(w)),t.onclick=()=>{document.body.removeChild(e),E.close()},t},this.createContainer=()=>{const e=u.createDOMElement("div",{id:m.botttomAdName});return e.setAttribute("style",p.createInlineStyle(b)),e}}create(){return H(this,void 0,void 0,(function*(){return window.tjBottomAdLoaded=!0,yield this.createBottomAdElement()}))}insertIntoDOM(e){document.body.appendChild(e)}checkIfCreatable(){return!E.wasClosed()&&!window.tjBottomAdLoaded&&super.checkIfCreatable()}revert(){delete window.tjBottomAdLoaded}}var W=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class Q extends P{constructor(){super(...arguments),this.create=()=>W(this,void 0,void 0,(function*(){const e=Object.assign(Object.assign({},v),{"min-height":`${this.params.height}`}),t=yield this.createWithDefaultIfFail((()=>_.create(this,e)),e);return t?this.createResponsiveWrapper(t):null})),this.createResponsiveWrapper=e=>{const t=Number(this.params.width.slice(0,-2)),n=Number(this.params.height.slice(0,-2)),r=Math.floor(n/t*100),i=p.createInlineStyle(Object.assign(Object.assign({},y),{"padding-top":`${r}%`}),!0),s=u.createDOMElement("div",{style:i});return s.appendChild(e),s}}}class X{constructor(){this.create=(e,t,n)=>"bottom"===t.type?new J(e,t,n):"responsive"===t.type?new Q(e,t,n):new V(e,t,n)}}var z=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class G{constructor(){this.sync=e=>z(this,void 0,void 0,(function*(){if(this.verify(e)&&!window.tjIdSyncSynced){window.tjIdSyncSynced=!0;try{const e=yield this.get();if(!e)return;e.set_TJ_uid().fp_get().sync()}catch(e){}}})),this.get=()=>z(this,void 0,void 0,(function*(){return new Promise((e=>{if(window.idsync)return e(window.idsync);const t=document.createElement("script");t.defer=!0,t.src=`${m.idSync.scriptUrl}?v=${this.getCacheVersion()}`,t.onload=t.onerror=()=>e(window.idsync),document.body.insertAdjacentElement("beforeend",t)}))})),this.getCacheVersion=()=>{const e=new Date;return new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0).getTime()},this.verify=e=>{if(!e)return!1;const t=e.site,n="publisher"===e.invocation_type;return!(-1===m.idSync.sites.indexOf(t)&&!n)&&-1===window.navigator.userAgent.indexOf("MSIE")}}}var Z=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class Y{constructor(){this.idSyncService=new G,this.preload=()=>{if(!window.tjPreloadAds)return;const e=f.getAdContextAttributes();for(const t in window.tjPreloadAds)"response"in window.tjPreloadAds[t]&&(window.tjPreloadAds[t].loaded||(window.tjPreloadAds[t].loaded=!0,new Promise((()=>Z(this,void 0,void 0,(function*(){const n=yield p.getElementBySpotId(m.adClassName,t);n&&this.run(n,e)}))))))},this.load=()=>{const e=document.getElementsByClassName(m.adClassName),t=f.getAdContextAttributes(),n=[];this.idSyncService.sync(t);for(let r=0;r<e.length;r++){const i=this.run(e[r],t);i&&n.push(i)}return Promise.all(n)},this.reload=e=>{const t=Y.ads[e];if(t)for(const e in t)t[e].reload()},this.run=(e,t)=>{const n=u.getDataAttributes(e);if(!this.canCreate(n))return null;e.setAttribute("data-loading","true");const r=(new X).create(e,n,t);return Y.ads[r.params.spotId]||(Y.ads[r.params.spotId]=[]),Y.ads[r.params.spotId].push(r),r.run()},this.verifyAttributes=e=>!(!this.verify(e,["source_id"])&&!this.verify(e,["spot_id"]))&&this.verify(e,["height","width"]),this.verify=(e,t)=>{let n=!0;for(let r=0;r<t.length;r++)e[t[r]]||(n=!1);return n},this.setDeliveryServer=()=>{const e=f.getAdContextAttributes();E.setDeliveryServer(null==e?void 0:e.delivery_server)}}init(){window.tjLoadEmbeddedAds=this.load,window.tjPreloadEmbeddedAds=this.preload,window.tjReloadEmbeddedAdsSpot=this.reload,window.tjDebug=l.debug,this.setDeliveryServer()}canCreate(e){if(e.loading)return!1;if(!this.verifyAttributes(e))return!1;const t=e.spot_id;return!(window.tjPreloadAds&&window.tjPreloadAds[t]&&!window.tjPreloadAds[t].loaded)}}Y.ads={};class K{constructor(){this.embeddedAdsService=new Y}init(){if(window.tjEmbeddedAdsLoaded)return!1;try{window.tjEmbeddedAdsLoaded=!0,this.sendLoadedEvent(),this.launch()}catch(e){return p.dispatchError(e),!1}return!0}launch(){this.embeddedAdsService.init(),this.embeddedAdsService.preload(),"loading"!==document.readyState?this.embeddedAdsService.load():document.addEventListener("DOMContentLoaded",(()=>{try{this.embeddedAdsService.load()}catch(e){p.dispatchError(e)}}))}sendLoadedEvent(){let t={};if(void 0!==window.tjEmbeddedAdsDuration){const e=void 0!==window.tjPreloadAds?Object.assign({},window.tjPreloadAds):null;t={duration:Date.now()-window.tjEmbeddedAdsDuration,tjPreloadAds:e}}u.dispatchTjEvent(e.embeddedAdsLoaded,t)}}(new K).init()}(),r}()}));