"use strict";(self.webpackChunkheifetz=self.webpackChunkheifetz||[]).push([[8368],{35570:function(e,t){var n=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;t.Z=function(e){return n.test(e)}},88197:function(e,t,n){n.d(t,{g:function(){return r},v:function(){return i}});var r=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise(function(t){return setTimeout(t,e)})};function i(e){var t=[];return e.reduce(function(e,n){return e.then(function(){return n().then(function(e){t.push(e)})})},Promise.resolve()).then(function(){return t})}},30256:function(e,t,n){var r=n(55164),i=n(85879),a=n(43384),o=n(84871),c=n.n(o);t.Z=function(e){return c()(function(t){var n=(0,a.Q4)().trackEvent;return(0,i.tZ)(e,(0,r._)({trackEvent:n},t))},e)}},89774:function(e,t,n){var r=n(53778),i=n(7407);t.Z=function(){return(0,r.useSelector)(i.Xj)}},96955:function(e,t,n){var r=n(55164),i=n(57477),a=n(71728),o=n(94009),c=n(85879),s=n(83697),l=n(95548),u=n.n(l),d=n(87363),p=n(87641),h=n(47842),f=n(38889),m=n(67689),g=function(e){var t=e.title,n=e.content,l=e.ok,u=e.cancel,m=e.onOk,g=e.onCancel,v=e.disabled,S=(0,a._)(e,["title","content","ok","cancel","onOk","onCancel","disabled"]),y=(0,o._)((0,d.useState)(!0),2),Z=y[0],w=y[1],E=(0,o._)((0,d.useState)(!1),2),C=E[0],k=E[1],_=function(e){return function(){w(!1),k(!0),e()}},b=(0,s.n)();return(0,c.tZ)(h.Z,(0,i._)((0,r._)({closeButton:null,maskClosable:!1,hotKeyClosable:!1,css:[{overflow:"hidden",maxWidth:"96vw",".Modal-content":{margin:0,padding:0}},b.Mobile&&{width:320,borderRadius:12,boxShadow:""}]},S),{children:Z&&(0,c.BX)(p.Box,{px:"36px",py:"24px",children:[t&&(0,c.tZ)(p.Text,{fontSize:"18px",lineHeight:"28px",fontWeight:"bold",textAlign:"center",children:t}),n&&(0,c.tZ)(p.Text,{mt:t?"16px":"0",fontSize:"14px",lineHeight:"normal",color:"GBK03A",maxHeight:"calc(67vh - 100px)",css:{wordBreak:"break-all",overflowY:"auto",WebkitOverflowScrolling:"touch",marginRight:-10,paddingRight:10},children:n}),(0,c.BX)(p.Flex,{mt:"16px",css:{button:{padding:0,flex:1,height:36,lineHeight:1,fontSize:15,borderRadius:4,":active":{opacity:.6}}},justifyContent:"center",fontWeight:"bold",children:[u&&(0,c.tZ)(f.ZP,{css:{marginRight:4},onClick:_(g),children:u}),(0,c.tZ)(f.ZP,{preset:"primary",color:"blue",css:{maxWidth:"60%"},onClick:_(m),disabled:v||C,children:l})]})]})}))};t.Z=function(){var e=(0,m.Z)(),t=e.addInstance,n=e.removeInstance,i=function(e){return setTimeout(function(){return n(e)},300)};return{alert:function(e){var n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=o.title,l=o.ok,d=(0,a._)(o,["title","ok"]);return new Promise(function(i){t(n=(0,c.tZ)(g,(0,r._)({content:e,title:s,ok:l||"确定",onOk:i,css:{textAlign:"center"}},d),u()("modal")))}).finally(function(){return i(n)})},confirm:function(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=r.title,o=r.ok,s=r.cancel,l=r.disabled;return new Promise(function(r,i){t(n=(0,c.tZ)(g,{content:e,title:a,ok:o||"确定",onOk:r,cancel:s||"取消",onCancel:i,disabled:l},u()("modal")))}).finally(function(){return i(n)})}}}},10757:function(e,t,n){n.d(t,{Z:function(){return w}});var r=n(20857),i=n(22107),a=n(94707),o=n(87320),c=n(86325),s=n(55164),l=n(71728),u=n(85626),d=n(85879),p=n(11738),h=n(26115),f=n(92769),m=n.n(f),g=n(14168),v=n.n(g),S=n(87363),y=n(38889),Z=n(34150),w=function(e){(0,c._)(n,e);var t=(0,u._)(n);function n(e){var a;return(0,i._)(this,n),a=t.call(this,e),(0,o._)((0,r._)(a),"handleSwitchPasswordInputType",function(){a.setState(function(e){return{inputType:"password"===e.inputType?"text":"password"}})}),(0,o._)((0,r._)(a),"handleChange",function(e){!!e!==a.state.hasValue&&a.setState({hasValue:!!e}),a.props.onChange(e)}),a.state={hasValue:!!e.defaultValue,inputType:e.defaultType},a}return(0,a._)(n,[{key:"render",value:function(){var e=m()(this.props,["onChange","defaultType"]),t=e.switchDisabled,n=e.placeholderPrefix,r=(0,l._)(e,["switchDisabled","placeholderPrefix"]),i=this.state,a=i.inputType,o=i.hasValue;return(0,d.BX)("div",{className:"SignFlow-password",children:[(0,d.tZ)(Z.Z,(0,s._)({name:"password",inputClassName:"password"===a&&o?"SignFlow-passwordInput":"",type:a,placeholder:"".concat(n||"","密码"),onChange:this.handleChange,errorMessageClassName:"SignFlow-passwordErrorMask",validations:[{type:"required",message:"请输入密码",className:"SignFlow-requiredPasswordErrorMask"}]},r)),!t&&(0,d.tZ)(y.ZP,{className:"SignFlow-switchPassword",tabIndex:-1,preset:"plain",onClick:this.handleSwitchPasswordInputType,icon:"password"===a?p.Z:h.Z})]})}}]),n}(S.Component);(0,o._)(w,"propTypes",{onChange:v().func.isRequired,switchDisabled:v().bool,defaultType:v().string}),(0,o._)(w,"defaultProps",{defaultType:"password"})},60261:function(e,t,n){n.d(t,{Z:function(){return tB}});var r=n(55164),i=n(71728),a=n(85879),o=n(69383),c=n(20857),s=n(22107),l=n(94707),u=n(87320),d=n(86325),p=n(85626),h=n(70877),f=n(6080),m=n(54231),g=n(87363),v=n.n(g),S=n(30851),y=Object.assign;function Z(e){var t;return v().createElement(S.Z,y(y({width:"24",height:"24",viewBox:"0 0 24 24"},e),{className:"function"==typeof(t=e.className)?t():"ZDI ZDI--CheckCircle24"+(t?" "+t:"")}),v().createElement("g",{fillRule:"evenodd",clipRule:"evenodd"},v().createElement("path",{d:"M12 20.5a8.5 8.5 0 1 0 0-17 8.5 8.5 0 0 0 0 17Zm0 1.5c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10Z"}),v().createElement("path",{d:"M10.414 15.175a.75.75 0 0 1 0-1.06L15.16 9.37a.75.75 0 0 1 1.06 1.06l-4.744 4.745a.75.75 0 0 1-1.06 0Z"}),v().createElement("path",{d:"M7.78 11.48a.75.75 0 0 1 1.061 0l2.634 2.634a.75.75 0 0 1-1.06 1.061L7.78 12.541a.75.75 0 0 1 0-1.06Z"})))}var w=Object.assign;function E(e){var t;return v().createElement(S.Z,w(w({width:"24",height:"24",viewBox:"0 0 24 24"},e),{className:"function"==typeof(t=e.className)?t():"ZDI ZDI--ExclamationCircle24"+(t?" "+t:"")}),v().createElement("path",{fillRule:"evenodd",d:"M12 20.5a8.5 8.5 0 1 0 0-17 8.5 8.5 0 0 0 0 17Zm0 1.5c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10Z",clipRule:"evenodd"}),v().createElement("path",{fillRule:"evenodd",d:"M12 7a.75.75 0 0 1 .75.75v5a.75.75 0 0 1-1.5 0v-5A.75.75 0 0 1 12 7Z",clipRule:"evenodd"}),v().createElement("path",{d:"M13 16a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"}))}var C=n(25628),k=n.n(C),_=n(14168),b=n.n(_),T=n(53778),N=n(86616),B=n(87641),x=n(94057),R=n(80714),I=n(30256),D=n(68900),P=n(63315),M=n(9338),L=n(94009),z=n(55846),A=n(29229),U=n(7835),V=n(65733),q=n(76867),Q=n(43384),X=(0,N.withRouter)((0,g.memo)(function(e){var t,r,i,c,s,l,u,d,p,f,m,v,S,y,w,C,_=e.className,b=e.router,N=(0,g.useMemo)(function(){return["/signin","/signup"].includes(b.location.pathname)},[b]),x=(r=(t=(0,L._)((0,g.useState)({type:"init"}),2))[0],i=t[1],s=(c=(0,L._)((0,g.useState)(""),2))[0],l=c[1],d=(u=(0,L._)((0,g.useState)(null),2))[0],p=u[1],f=(0,Q.Q4)().trackEvent,m=(0,g.useRef)(null),v=(0,T.useDispatch)(),S=(0,V.Z)(function(){return v((0,P.L1)())}),y=(0,V.Z)(function(e){return v((0,P.gf)({token:e}))}),w=(0,V.Z)(function(){return p(null)}),C=(0,V.Z)((0,M._)(function(){var e,t,n;return(0,z.__generator)(this,function(r){switch(r.label){case 0:return w(),l(""),i({type:"init"}),[4,S()];case 1:return t=(e=r.sent().payload).token,n=e.link,m.current=t,l(n),p(2e3),[2]}})})),(0,q.Z)((0,M._)(function(){var e,t,n,r,a;return(0,z.__generator)(this,function(o){switch(o.label){case 0:e=m.current,o.label=1;case 1:return o.trys.push([1,3,,4]),[4,y(e)];case 2:if(0===(t=o.sent().payload).status)return[2];if(1===t.status)return i({type:"success"}),[2];if(t.newToken&&5===t.status)return m.current=t.newToken.token,l(t.newToken.link),[2];return t.accessToken&&!N&&(null==f||f({block:"qrcode_loginSuccess"})),[3,4];case 3:return n=o.sent(),w(),(null==n?void 0:null===(r=n.payload)||void 0===r?void 0:r.code)===40321&&i({type:"error",errorMessage:null==n?void 0:null===(a=n.payload)||void 0===a?void 0:a.message}),[3,4];case 4:return[2]}})}),d),(0,U.Z)(function(){return C(),function(){return w()}}),{step:r,link:s,toggleReset:C,cancel:w}),R=x.step,I=x.link,D=x.toggleReset,X=(0,A.Z)(function(){return n.e(8141).then(n.bind(n,98141))});(0,U.Z)(function(){N&&o.Z.trackCardShow(null,{id:9214,name:"d"})});var F=null;return F="init"===R.type?(0,a.BX)("div",{className:"Qrcode-content",children:[(0,a.tZ)("div",{className:"Qrcode-img",children:I&&X?(0,a.tZ)(X,{fgColor:"#0F88EB",bgColor:"#fff",className:"Qrcode-qrcode",size:120,value:I,alt:"二维码",imageSettings:{height:30,width:30,src:"https://picx.zhimg.com/v2-9e41ea16bdfbe9cf4896617ecad5b4ca.png"}}):(0,a.tZ)(h.Z,{count:3})}),(0,a.tZ)("div",{className:"Qrcode-guide-message",children:(0,a.tZ)(B.Box,{mt:"24px",color:"GBK03A",fontSize:14,fontWeight:"bold",lineHeight:"20px",children:"其他扫码方式：微信"})})]}):"success"===R.type?(0,a.BX)(a.HY,{children:[(0,a.BX)("div",{className:"Qrcode-content Qrcode-success",children:[(0,a.tZ)("div",{className:"Qrcode-scanResultStatus",children:(0,a.tZ)(Z,{fill:"#2db370",size:58})}),(0,a.tZ)("p",{className:"Qrcode-scanResultTips",children:"扫描成功"}),(0,a.tZ)("p",{children:"请在手机上「确认登录」"})]}),(0,a.tZ)("div",{className:"Qrcode-cutButton",children:(0,a.tZ)("span",{role:"button",tabIndex:0,onClick:D,children:"返回二维码"})})]}):(0,a.BX)("div",{className:"Qrcode-content Qrcode-failure",children:[(0,a.tZ)("div",{children:(0,a.tZ)(E,{fill:"#ffaa00",size:58})}),(0,a.tZ)("p",{children:R.errorMessage})]}),(0,a.BX)("div",{className:k()("Qrcode-container",_),children:[(0,a.tZ)(B.Box,{color:"GBK03A",fontSize:16,fontWeight:"bold",lineHeight:"23px",children:"打开知乎App"}),(0,a.tZ)(B.Box,{mt:"8px",mb:"24px",color:"GBK03A",fontSize:14,lineHeight:"20px",children:"在「我的页」左上角打开扫一扫"}),F]})})),F=function(e){(0,d._)(n,e);var t=(0,p._)(n);function n(e){var r;return(0,s._)(this,n),r=t.call(this,e),(0,u._)((0,c._)(r),"cancelCheckQrcodeScanStatus",function(){r.timer&&window.clearInterval(r.timer)}),(0,u._)((0,c._)(r),"checkQrcodeScanStatus",function(e){var t=r.props,n=t.checkQrcodeScanStatus,i=t.trackEvent,a=t.isSignPage;r.timer=setInterval(function(){n({token:e}).then(function(e){var t;(null===(t=e.payload)||void 0===t?void 0:t.accessToken)&&!a&&(null==i||i({block:"qrcode_loginSuccess"}))})},2e3)}),(0,u._)((0,c._)(r),"handleChangeStatus",function(e,t){r.setState({status:e}),"init"!==e||t||r.getToken(),m.ZP.increment("logIn.qrcode.".concat(e,".count"),.001)}),r.state={type:"password",status:"init",errorMessage:"",guideTypeSymbol:"d"},r}return(0,l._)(n,[{key:"componentDidMount",value:function(){var e=this.props.isInSignPage,t=this.state.guideTypeSymbol;e&&o.Z.trackCardShow(null,{id:9214,name:t}),this.getToken()}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=this.props,n=t.qrcodeLoginToken,r=t.qrcodeLoginScanStatus,i=e.qrcodeLoginToken,a=e.qrcodeLoginScanStatus,o=e.qrcodeLoginError,c=e.qrcodeLoginReturnNewToken;""!==i&&n!==i?(this.cancelCheckQrcodeScanStatus(),"init"!==this.state.status&&this.handleChangeStatus("init",!0),this.checkQrcodeScanStatus(i)):r!==a?2!==a&&this.handleChangeStatus(1===a?"success":"init",c||1===r&&0===a):o&&o.code&&(this.cancelCheckQrcodeScanStatus(),40321===o.code&&this.setState({status:"error",errorMessage:o.message}))}},{key:"componentWillUnmount",value:function(){this.cancelCheckQrcodeScanStatus()}},{key:"getToken",value:function(){return this.props.getQrcodeLoginToken()}},{key:"render",value:function(){var e=this,t=this.props,n=t.className,r=t.qrcodeLoginToken,i=t.isInSignPage,o=t.isBlockType,c=this.state,s=c.status,l=c.errorMessage,u=c.guideTypeSymbol,d=null;return d="init"===s?(0,a.BX)("div",{className:"Qrcode-content",children:[(0,a.tZ)("div",{className:"Qrcode-img",children:r?(0,a.tZ)("img",{className:"Qrcode-qrcode",width:"150",height:"150",src:"//".concat(R.Z.wwwHost,"/api/v3/account/api/login/qrcode/").concat(r,"/image").concat(i?"?utm_campaign=internal&utm_medium=qr&utm_source=login&utm_term=force_launch&utm_content=qrscan".concat(u):""),alt:"二维码"}):(0,a.tZ)(h.Z,{count:3})}),(0,a.BX)("div",{className:"Qrcode-guide-message",children:[o&&(0,a.tZ)("div",{className:"Qrcode-title",children:"扫码登录"}),(0,a.tZ)(B.Box,{mt:"24px",color:"GBK03A",fontSize:14,fontWeight:"bold",lineHeight:"20px",children:"其他扫码方式：微信"})]})]}):"success"===s?(0,a.BX)(a.HY,{children:[(0,a.BX)("div",{className:"Qrcode-content Qrcode-success",children:[(0,a.tZ)("div",{className:"Qrcode-scanResultStatus",children:(0,a.tZ)(Z,{fill:"#2db370",size:58})}),(0,a.tZ)("p",{className:"Qrcode-scanResultTips",children:"扫描成功"}),(0,a.tZ)("p",{children:"请在手机上「确认登录」"})]}),(0,a.tZ)("div",{className:"Qrcode-cutButton",children:(0,a.tZ)("span",{role:"button",tabIndex:0,onClick:function(){return e.handleChangeStatus("init")},children:"返回二维码"})})]}):(0,a.BX)("div",{className:"Qrcode-content Qrcode-failure",children:[(0,a.tZ)("div",{className:k()({"Qrcode-scanResultStatus":o}),children:(0,a.tZ)(E,{fill:"#ffaa00",size:58})}),o&&(0,a.tZ)("p",{className:"Qrcode-scanResultTips",children:"扫描失败"}),(0,a.tZ)("p",{children:l})]}),(0,a.BX)("div",{className:k()("Qrcode-container",n),children:[(0,a.tZ)(B.Box,{color:"GBK03A",fontSize:16,fontWeight:"bold",lineHeight:"23px",children:"打开知乎App"}),(0,a.tZ)(B.Box,{mt:"8px",mb:"24px",color:"GBK03A",fontSize:14,lineHeight:"20px",children:"在「我的页」左上角打开扫一扫"}),d]})}}]),n}(g.Component);(0,u._)(F,"propTypes",{type:b().string,isShowPasswordLogin:b().bool,getQrcodeLoginToken:b().func,checkQrcodeScanStatus:b().func,isInSignPage:b().bool,isBlockType:b().bool}),(0,u._)(F,"defaultProps",{qrcodeLoginToken:"",qrcodeLoginScanStatus:"",isBlockType:!1});var W=(0,x.compose)(N.withRouter,I.Z,(0,T.connect)(function(e,t){var n=e.login;return{qrcodeLoginToken:n.qrcodeLoginToken,qrcodeLoginTokenExpires:n.qrcodeLoginTokenExpires,qrcodeLoginScanStatus:n.qrcodeLoginScanStatus,qrcodeLoginError:n.qrcodeLoginError,qrcodeLoginReturnNewToken:n.qrcodeLoginReturnNewToken,edition:(0,D.cM)(e),isSignPage:["/signin","/signup"].includes(t.router.location.pathname)}},{getQrcodeLoginToken:P.L1,checkQrcodeScanStatus:P.gf}))(F),O=function(e){var t="1"===(0,f.c)("use_qrcode_login_v2",{mock:"1"})?X:W;return(0,a.tZ)(t,(0,r._)({},e))},H=n(57477),G=n(97476),j=function(e){return{padding:"4px 10px",border:"1px solid #EBEBEB",borderRadius:"29px",fontSize:"12px",color:e.colors.GBK03A,lineHeight:"19px",":hover":{background:e.colors.GBK10A},display:"inline-block"}},K=function(e){var t=e.isQRCodeShown,n=e.onQRCodeLinkClick,o=e.zaClickId,c=e.isInSignPage,s=(0,i._)(e,["isQRCodeShown","onQRCodeLinkClick","zaClickId","isInSignPage"]),l=c?"Button":"Popup";return(0,a.BX)(B.Flex,(0,H._)((0,r._)({fontSize:14,color:"GBL01A",height:"60px",alignItems:"center",justifyContent:"center",css:{boxSizing:"border-box",margin:"26px 0 22px"}},s),{children:[(0,a.tZ)(B.Box,{children:(0,a.tZ)(Q.$U,{as:B.Button,zaType:l,zaAction:"Close",zaModuleId:"pc_web_login_download_zhihu_app",css:j,bg:"unset",fontWeight:"inherit",mr:"8px",onClick:n,children:void 0!==t&&t?"关闭二维码":"下载知乎App"})}),(0,a.tZ)(B.Box,{css:{whiteSpace:"nowrap"},children:(0,a.tZ)(Q.$U,{as:B.Link,zaType:l,zaModuleId:"pc_web_login_open_institution_account",href:"/org/signup",css:j,mr:"8px","data-za-detail-view-id":o,children:"开通机构号"})}),(0,a.tZ)(B.Box,{css:{whiteSpace:"nowrap"},children:(0,a.tZ)(Q.$U,{as:B.Button,zaType:l,zaModuleId:"pc_web_login_accessibility_mode",css:j,bg:"unset",fontWeight:"inherit",onClick:G.Gb,"data-za-detail-view-id":o,children:"无障碍模式"})})]}))},$=n(45842),Y=n(36798),J=n(66263),ee=n(87843),et=n(67927),en=n(54674),er=n(38889),ei=function(e){var t=e.onBack,n=e.data,r=n.phoneNo,i=n.code,o=n.targetNo,c=e.onSubmit;return(0,a.BX)("div",{className:"MobileSMSIdentify",children:[(0,a.BX)("div",{className:"MobileSMSIdentify-nav",children:[(0,a.tZ)(en.e,{onClick:t,size:36,fill:"#808080",center:!0}),(0,a.tZ)("div",{children:"身份验证"})]}),(0,a.BX)("div",{className:"MobileSMSIdentify-tip",children:["请用手机号\xa0",r.slice(0,-8),"****",r.slice(-4),"\xa0编辑发送短信后，返回本页面继续操作"]}),(0,a.BX)("div",{className:"MobileSMSIdentify-content",children:[(0,a.BX)("div",{children:["编辑短信",(0,a.tZ)("span",{children:i})]}),(0,a.BX)("div",{children:["发送到",(0,a.tZ)("span",{children:o})]})]}),(0,a.tZ)(er.ZP,{className:"MobileSMSIdentify-submit",preset:"primary",color:"blue",onClick:c,children:"短信已发送，点击校验"})]})},ea=function(e){var t=e.onBack,n=e.data,r=n.phoneNo,i=n.code,o=n.targetNo,c=e.onSubmit;return(0,a.BX)("div",{className:"SMSIdentify",children:[(0,a.BX)("div",{className:"SMSIdentify-back",role:"button",tabIndex:0,onClick:t,children:[(0,a.tZ)(en.e,{fill:"#8590a6",size:36,center:!0}),"返回"]}),(0,a.tZ)("div",{className:"SMSIdentify-title",children:"身份验证"}),(0,a.BX)("div",{className:"SMSIdentify-tip",children:["请用手机号\xa0",r.slice(0,-8),"****",r.slice(-4),"\xa0发送短信"]}),(0,a.BX)("div",{className:"SMSIdentify-content",children:[(0,a.BX)("div",{children:["短信内容",(0,a.tZ)("span",{children:i})]}),(0,a.BX)("div",{children:["发送到号码",(0,a.tZ)("span",{children:o})]})]}),(0,a.tZ)("div",{className:"SMSIdentify-submitTip",children:"发送完成后，请点击下方按钮进行校验"}),(0,a.tZ)(er.ZP,{className:"SMSIdentify-submit",preset:"primary",color:"blue",onClick:c,children:"我已发送"})]})},eo=(0,T.connect)(null,{getSMSIdentify:P.O,postSMSIdentify:P.qo,showNotification:et.c0})(function(e){var t=e.getSMSIdentify,n=e.postSMSIdentify,r=e.showNotification,i=e.onBack,c=e.phoneNo,s=(0,L._)((0,g.useState)({code:"",phoneNo:"",targetNo:""}),2),l=s[0],u=s[1];(0,g.useEffect)(function(){o.Z.trackCardShow(null,{id:5935})},[]),(0,g.useEffect)(function(){c&&t(c).then(function(e){var t=e.payload;t&&u(t)}).catch(function(e){var t=e.payload;t&&u(t)})},[t,c]);var d=R.Z.isMobileEntry?ei:ea;return(0,a.tZ)(d,{onBack:i,onSubmit:function(){o.Z.trackEvent(null,{id:23456}),n(c).then(function(e){var t=e.payload;o.Z.trackEvent(null,{id:6729,action:"Click",name:t.success?"通过":"失败"}),t.success?i():r("没有收到短信，请稍后重试","red")})},data:l})}),ec=n(15030),es=n(61763),el=n(51070),eu=n.n(el),ed=function(e,t,n){var r=(0,V.Z)(t);(0,g.useEffect)(function(){return eu().bind(e,r,n),function(){eu().unbind(e)}},[JSON.stringify(e),r,n])},ep=n(13737),eh=n(71670),ef=function(e){var t=e.type,n=e.captchaV2,r=(0,T.useDispatch)();return(0,V.Z)(function(){"qrcode"!==t&&(n&&r((0,ep.o5)()),r((0,ep.il)("captcha_sign_in")))})},em=n(57045),eg=n(79855),ev=n(96955),eS=n(88197),ey=v().memo(v().forwardRef(function(e,t){var n,r=e.onReady,i=e.onVerify,o=e.onClose,c=(0,T.useSelector)(function(e){return e.captcha}).v2,s=(0,g.useRef)(null),l=(0,ev.Z)(),u=null==c?void 0:null===(n=c.script)||void 0===n?void 0:n[1],d=(0,g.useRef)(null),p=(0,g.useRef)(),h=(0,g.useRef)(),f=(0,L._)((0,g.useState)("init"),2),m=f[0],v=f[1];(0,g.useEffect)(function(){if(null==c?void 0:c.script){var e=u?em.parse(null==u?void 0:u.split("?")[1]).captchaId:"0";return d.current&&d.current!==e?(l.confirm("页面将自动刷新，请在刷新后重试",{title:"验证码已过期",ok:"刷新"}).then(function(){location.reload()}).catch(function(){s.current&&clearTimeout(s.current)}),s.current=setTimeout(function(){location.reload()},5e3)):d.current=e,function(){s.current&&clearTimeout(s.current)}}},[c,u,l]),(0,g.useImperativeHandle)(t,function(){return{get required(){return!!c},get ready(){return!!h.current},get type(){var e;return(null===(e=h.current)||void 0===e?void 0:e.type)||"vendor"},show:function(){var e;null===(e=h.current)||void 0===e||e.show()},close:function(){var e;return null===(e=h.current)||void 0===e?void 0:e.close()},refresh:function(){var e;return null===(e=h.current)||void 0===e?void 0:e.refresh()}}});var S=(0,V.Z)(function(e){if(!(null===(t=e.script)||void 0===t?void 0:t.length)){v("bypass");return}v("loading");var t,n=e.script.map(function(e){return function(){return(0,eg.v)(e)}});(0,eS.v)(n).then(function(){return v("mount"),window.ZS_CAP.init({element:p.current,callback:function(e){null==i||i(e)},enableClose:!0,onClose:o})}).then(function(e){h.current=e,v("ready"),null==r||r()}).catch(function(e){var t;return null===(t=window.Raven)||void 0===t?void 0:t.captureException(e)})});return(0,g.useEffect)(function(){c&&"init"===m&&S(c)},[c,m,S]),c?(0,a.tZ)("div",{ref:p}):null})),eZ=function(e){var t=e.type,n=e.captchaV2Ref,r=e.onVerify,i=e.lastSubmittedTimestamp,o=(0,T.useDispatch)(),c=(0,eh.h)(),s=c.continueActionRef,l=ef({type:t,captchaV2:c.captchaV2});return(0,g.useEffect)(function(){l(),m.ZP.increment("logIn.captcha.request.count",.001)},[l]),ed(["esc"],function(){var e;null===(e=n.current)||void 0===e||e.close()}),(0,g.useEffect)(function(){if(i&&-1!==i){var e;console.log("captcha refresh!"),null===(e=n.current)||void 0===e||e.refresh()}},[i,n]),(0,a.tZ)(ey,{ref:n,onVerify:function(e){if((0,ec._)(e,Error))return m.ZP.increment("logIn.captcha.wrong.count"),o((0,et.c0)(e.message||"验证失败","red"));if(!(null==e?void 0:e.type)||!(null==e?void 0:e.result))return o((0,et.c0)("错误的验证方式","red"));var t=e.result;o((0,ep.PI)(JSON.stringify(t),!0,"captcha_sign_in")).then(function(e){var t,i,a=e.payload;(null==a?void 0:a.success)&&(null==r||r({result:"success"}),(null==s?void 0:s.current)&&(null===(i=s.current)||void 0===i||i.call(s)),null===(t=n.current)||void 0===t||t.close())}).catch(function(e){var t,i;if(null==r||r({result:"fail"}),(null==e?void 0:e.name)==="ResponseError"&&(null===(t=e.payload)||void 0===t?void 0:t.code)===120001){o((0,et.c0)("页面已过期，请刷新页面重试","red"));return}throw o((0,et.c0)((0,es.n$)(e),"red")),null===(i=n.current)||void 0===i||i.refresh(),e}).finally(function(){s&&(s.current=null)})},onClose:function(){if(!i){var e;console.log("captcha refresh!"),null===(e=n.current)||void 0===e||e.refresh()}}})},ew=n(89630),eE=void 0,eC=function(e){var t=e.smsBackUpName,n=e.smsBackUpDisplay,r=e.isOverSea,i=e.smsType,c=e.type,s=e.containerType,l=(0,eh.h)(),u=l.handleChangeType,d=l.setState,p=(0,V.Z)(function(){o.Z.trackEvent(event.currentTarget,{id:4947}),o.Z.trackEvent(eE,{action:"Click",element:"Button",element_name:"ResetPassword"}),window.open("".concat(J.i7,"/account/password_reset"),"_blank")}),h=(0,V.Z)(function(e){o.Z.trackEvent(e.currentTarget,{id:4941}),d({smsType:"text"===i?"voice":"text",smsBackUpName:"text"===i?"短信":"语音",reStartTime:Date.now()})}),f={configMap:{containerType:(0,ew.l)(s)}};return(0,a.BX)("div",{className:"Login-options",children:[(0,a.tZ)(Q.$U,{as:er.ZP,zaText:r?"邮箱账号登录":"海外手机号登录",zaType:"Button",zaAction:"Expand",extra:f,preset:"plain",className:"Login-switchType",onClick:function(){"digits"!==c&&u(r?"email":"oversea")},children:"digits"!==c&&(r?"邮箱账号登录":"海外手机号登录")}),(0,a.tZ)(er.ZP,{preset:"plain",className:"Login-cannotLogin",onClick:"digits"===c?h:p,children:"digits"===c?n&&(0,a.BX)(Q.Wi,{zaType:"Text",zaText:"免密码登录",extra:f,children:["获取",t,"验证码"]},"noPassword"):(0,a.tZ)(Q.Wi,{zaType:"Text",zaText:"密码登录",extra:f,children:"忘记密码"},"forgetPassword")})]})};function ek(e){return"Enter"===e.key||" "===e.key||"Enter"===e.code||"Space"===e.code||13===e.keyCode||32===e.keyCode}var e_=function(e){var t=e.type,n=(0,eh.h)().handleChangeType;return(0,a.BX)("div",{className:"SignFlow-tabs",children:[(0,a.tZ)(Q.$U,{as:"div",zaText:"免密码登录",zaType:"Button",zaAction:"Save",className:k()("SignFlow-tab",{"SignFlow-tab--active":"digits"===t}),role:"button",tabIndex:0,onClick:function(){"digits"!==t&&n("digits")},onKeyDown:function(e){ek(e)&&"digits"!==t&&n("digits")},children:"验证码登录"}),(0,a.tZ)(Q.$U,{as:"div",zaText:"密码登录",zaType:"Button",zaAction:"Save",className:k()("SignFlow-tab",{"SignFlow-tab--active":"password"===t}),role:"button",tabIndex:0,onClick:function(){"password"!==t&&n("password")},onKeyDown:function(e){ek(e)&&"password"!==t&&n("password")},children:"密码登录"})]})},eb=n(49899),eT=n(10757),eN=n(29102),eB=function(e){var t=e.handleRegister,n=e.setState,r=e.usernameServerError,i=e.passwordServerError,o=e.submitDisabled,c=(0,T.useDispatch)(),s=(0,V.Z)(function(e){return function(t){return n((0,u._)({},e,t))}});return(0,a.BX)(ee.Z,{className:"SignFlow-setting",onSubmit:t,children:[(0,a.BX)("div",{role:"button",tabIndex:0,className:"SignFlow-back",onClick:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return c(P.S7.apply(void 0,(0,eb._)(t)))},children:[(0,a.tZ)(en.e,{center:!0,size:28,fill:"#8590a6"}),"返回"]}),(0,a.tZ)("div",{className:"SignFlow-settingTitle",children:"设置用户名和密码"}),(0,a.tZ)(eN.Z,{name:"fullname",placeholder:"用户名",onChange:s("fullname"),manualValidateError:r}),(0,a.tZ)(eT.Z,{onChange:s("password"),placeholderPrefix:"8 位数字或字母",defaultType:"text",manualValidateError:i}),(0,a.tZ)(er.ZP,{type:"submit",className:"SignFlow-submitButton",preset:"primary",color:"blue",disabled:o,children:"进入知乎"})]},"setting")},ex=function(e){var t=e.submitDisabled,n=e.type,r=e.containerType,i=(0,g.useMemo)(function(){return"password"!==n&&R.Z.allowSignUp?"登录/注册":"登录"},[n]);return(0,a.tZ)(Q.$U,{as:er.ZP,zaText:"登录",zaType:"Button",zaAction:"Signin",extra:{configMap:{containerType:(0,ew.l)(r),signinType:n}},type:"submit",className:"SignFlow-submitButton",preset:"primary",color:"blue",disabled:t,children:i})},eR=n(80487),eI=function(e){var t=e.type,n=e.isOversea,o=e.supportedCountriesShown,c=e.selectedCountry,s=e.username,l=e.usernameServerError,u=e.customErrorInputMap,d=(void 0===u?{}:u).username,p=(0,i._)(e,["type","isOversea","supportedCountriesShown","selectedCountry","username","usernameServerError","customErrorInputMap"]),h=(0,eh.h)().handleChange;return(0,a.tZ)(eR.Z,(0,r._)({type:"digits"===t||o?"digits":"password",supportedCountriesShown:"digits"===t||n,onChange:function(e){return h("username",e)},onSelect:function(e){return h("selectedCountry",e)},defaultSelectedCountry:c,manualValidateError:l||d,defaultValue:s},p))},eD=n(79065),eP=n(25773),eM=n(25669),eL=n(34150);function ez(){var e=(0,eD._)([""," 秒后可重发"]);return ez=function(){return e},e}var eA=function(e){(0,d._)(n,e);var t=(0,p._)(n);function n(){return(0,s._)(this,n),t.apply(this,arguments)}return(0,l._)(n,[{key:"render",value:function(){var e,t=this.props,n=t.countDownEvent,o=t.countDownEndEvent,c=t.startAtOnce,s=t.interceptTime,l=t.isEmail,u=t.reStartTime,d=t.smsType,p=(0,i._)(t,["countDownEvent","countDownEndEvent","startAtOnce","interceptTime","isEmail","reStartTime","smsType"]);return e=l?"邮箱":"voice"===d?"语音":"短信",(0,a.BX)("div",{className:"SignFlow SignFlow-smsInputContainer",children:[(0,a.tZ)(eL.Z,(0,r._)({name:"digits",className:"SignFlow-smsInput",type:"tel",smsType:d,errorMessageClassName:"SignFlow-smsInputErrorMessage",placeholder:"输入 6 位".concat(e,"验证码"),validations:[{type:"required",message:"请输入".concat(e,"验证码"),className:"SignFlow-smsInputRequiredErrorMask"}]},p)),(0,a.tZ)(eP.Z,{className:"SignFlow-smsInputButton",preset:"plain",initialText:"获取".concat(e,"验证码"),resetText:"重新获取".concat(e,"验证码"),countingText:(0,eM.Z)(ez(),"count"),startAtOnce:c,event:n,countDownEndEvent:o,interceptTime:s,reStartTime:u})]})}}]),n}(g.Component);(0,u._)(eA,"propTypes",{countDownEvent:b().func.isRequired,startAtOnce:b().bool,interceptTime:b().number,reStartTime:b().number,isEmail:b().bool,countDownEndEvent:b().func,smsType:b().string}),(0,u._)(eA,"defaultProps",{startAtOnce:!1,isEmail:!1});var eU=function(e){var t=e.type,n=e.smsInputInterceptTime,o=e.digitsServerError,c=e.smsType,s=e.reStartTime,l=e.passwordServerError,u=e.password,d=(0,i._)(e,["type","smsInputInterceptTime","digitsServerError","smsType","reStartTime","passwordServerError","password"]),p=(0,eh.h)(),h=p.handleSendDigits,f=p.setState,m=(0,V.Z)(function(){f({smsBackUpDisplay:!0})}),g=(0,V.Z)(function(e){return f({digits:e})}),v=(0,V.Z)(function(e){return f({password:e})});return(0,a.BX)(a.HY,{children:["digits"===t&&(0,a.tZ)(a.HY,{children:(0,a.tZ)(eA,(0,r._)({countDownEvent:h,countDownEndEvent:m,interceptTime:n,manualValidateError:o,smsType:c,reStartTime:s,onChange:g},d))}),"password"===t&&(0,a.tZ)(a.HY,{children:(0,a.tZ)(eT.Z,(0,r._)({onChange:v,manualValidateError:l,defaultValue:u},d))})]})},eV={username:null,password:null,captcha:null,digits:null},eq={UPDATE_STATE:"UPDATE_STATE"},eQ=function(e){return{smsType:"text",smsBackUpName:"语音",smsBackUpDisplay:!0,reStartTime:-1,supportedCountriesShown:!1,selectedCountry:e.selectedCountry,username:e.username,password:e.password,fullname:"",customErrorInputMap:(0,r._)({},eV),submitDisabled:!1,lastSubmittedTimestamp:-1}},eX=function(e,t){var n=t.type,i=t.callback;if(n===eq.UPDATE_STATE){var a=t.payload;return i&&i(e),(0,r._)({},e,a)}return e},eF=n(82865),eW=n(72925),eO=function(e){var t=e.registerConfirmSucceeded,n=e.loginConfirmSucceeded,i=e.sendDigitsError,a=e.nextUrl,o=e.username,c=e.isInSignPage,s=e.loginConfirmError,l=e.setState,u=e.loginUnregisteredError,d=e.loginBindWechatError,p=e.type,h=e.verification,f=(0,T.useDispatch)();(0,g.useEffect)(function(){!s||u||d||(f((0,ep.hU)(p)),f((0,ep.il)()))},[s,u,d,l,f,p]),(0,g.useEffect)(function(){(n||t)&&((0,eW.N)(o),(null==h?void 0:h.isZombie)&&(0,eF.dq)(h),a?location.href=a:c?location.href="/":location.reload())},[n,t]),(0,g.useEffect)(function(){if(i||!1===n){var e=i?{smsInputInterceptTime:Date.now()}:{};l((0,H._)((0,r._)({},e),{captchaValidated:!1,captchaNeeded:!0}))}},[i,n]),(0,g.useEffect)(function(){i&&null===s&&l({smsBackUpDisplay:!0})},[i])},eH=function(e){var t=e.setState,n=(0,T.useDispatch)();return(0,V.Z)(function(e,r){n((0,P.S7)()),t((0,u._)({},e,r))})},eG=n(35570),ej=function(e){var t=e.props,n=e.setState,r=e.state,i=t.onChangeType,a=t.type,c=t.captchaV2,s=(0,T.useDispatch)(),l=r.username,u=ef({props:t});return(0,V.Z)(function(e){s((0,P.S7)()),i(e),("qrcode"===e||"password"===e)&&o.Z.trackEvent(null,{action:"Click",name:"qrcode"===e?"使用二维码登录":"使用密码登录"},{account:{type:"Zhihu"}}),"qrcode"!==e&&(n({username:"password"===a&&(0,eG.Z)(l)?"":l,smsBackUpDisplay:!0}),c||u())})},eK=n(72238),e$=function(e){e&&(e.addEventListener("focus",function(e){e.target.style.boxShadow="0 0 0 2px #ffffff, 0 0 0 4px rgb(0 102 255 / 30%)"},!0),e.addEventListener("blur",function(e){e.target.style.boxShadow="none"},!0))},eY=function(e){var t=document.createElement("button");return t.style.position="absolute",t.style.top="15px",t.style.right="15px",t.style.fontSize="16px",t.innerText="✕",t.setAttribute("tabindex","0"),t.addEventListener("click",e),e$(t),t},eJ=function(e){var t=e.querySelector(".yidun_modal__title");t.setAttribute("tabindex","-1"),t.innerText="请完成安全验证，可使用语音验证",t.addEventListener("focus",function(){t.style.outline="none"}),setTimeout(function(){t.focus()},500)},e0=function(e){e.querySelector(".yidun_tips").removeAttribute("aria-live")},e1=function(e){var t=document.querySelectorAll(".yidun_modal"),n=eY(function(){var t;return null===(t=e.current)||void 0===t?void 0:t.close()});Array.from(t).forEach(function(e){e.appendChild(n),e0(e),eJ(e)})},e2=function(e){var t=e.props,n=e.captchaV2Ref,r=t.captchaValidated,i=t.captchaNeeded;return(0,V.Z)(function(){if(!r&&i){var e;if(null===(e=n.current)||void 0===e?void 0:e.required)return n.current.show(),e1(n),Promise.resolve(!1);console.warn("Captcha is unavailable.")}return Promise.resolve(!0)})},e5=function(e){var t=e.props,n=e.captchaV2Ref,r=e.continueActionRef,i=e.setState,a=e.selectedCountry.code,o=e.username,c=e.fullname,s=e.digits,l=e.password,u=(0,T.useDispatch)(),d=e2({props:t,captchaV2Ref:n});return(0,V.Z)(function(){var e=function(){u((0,eK.cP)({source:"com.zhihu.web",registerType:"phone_digits",phoneNo:"".concat(a).concat(o),fullname:c,digits:s,password:l}))};r&&(r.current=e),i({submitDisabled:!0}),d().then(function(t){return t&&e()}).finally(function(){return i({submitDisabled:!1})})})};function e7(e,t){if(!e)return{};var n=e=e.trim(),r=(0,eG.Z)(e);if(!r){var i,a={hasCode:(i=e).startsWith("+")||i.startsWith("00"),parsedPhoneNo:i.startsWith("00")?"+".concat(i.slice(2)):i},o=a.hasCode,c=a.parsedPhoneNo;n=o?c:"".concat(t).concat(e)}return{value:n,isEmail:r}}var e4=function(e){var t=e.customErrorInputMap,n=e.smsType,i=e.selectedCountry.code,a=e.username,o=e.testPhoneNo,c=e.captchaV2Ref,s=e.runBeforeResetValidateResult,l=e.setState,u=e.captchaNeeded,d=e.continueActionRef,p=(0,T.useDispatch)();return(0,V.Z)(function(e,h){return s(function(){if(!o()){l({customErrorInputMap:(0,H._)((0,r._)({},t),{username:a?"请输入正确的手机号":"请输入手机号"}),smsInputInterceptTime:Date.now()});return}var e,s=e7(a,i).value,f=function(){p((0,P.Yu)(s,n)),l({smsBackUpDisplay:!1})};if(a&&!u){f();return}if(u&&(null===(e=c.current)||void 0===e?void 0:e.required))return c.current.show(),e1(c),d.current=function(){f(),h()},!1;l({customErrorInputMap:(0,H._)((0,r._)({},t),{username:a?"":"请输入手机号"})})},!u)})},e3=n(82452),e8=n(29065),e6=void 0,e9=function(e){var t=e.props,n=e.setState,i=e.runBeforeResetValidateResult,a=e.runBeforeCheckCaptcha,c=e.testPhoneNo,s=e.continueActionRef,l=e.selectedCountry,u=e.captcha,d=e.customErrorInputMap,p=e.username,h=e.trackLoginSuccess,f=t.type,g=t.isOverSea,v=t.nextUrl,S=(0,T.useDispatch)();return(0,V.Z)(function(e){o.Z.trackEvent(e6,{id:4948}),i(function(){if(("digits"===f||g)&&!c()){n({customErrorInputMap:(0,H._)((0,r._)({},d),{username:p?"请输入正确的手机号":"请输入手机号"}),smsInputInterceptTime:Date.now()});return}m.ZP.increment("logIn.clickLogInBtn.count",.1);var t=function(){var t=(0,e3.tL)(v),i=t.utm_source,a=t.utm_medium,o=(0,H._)((0,r._)({},e),{username:e7(e.username,l.code).value,captcha:u,utmSource:i,refSource:a});n({lastSubmittedTimestamp:Date.now()}),S((0,P.uJ)((0,e8.Z)(f,o))).then(function(e){var t;(null===(t=e.payload)||void 0===t?void 0:t.accessToken)&&(null==h||h())})};s.current=t,a().then(function(e){e&&t()}).finally(function(){return n({submitDisabled:!1})})})})},te=function(e){var t=e.loginConfirmError,n=e.sendDigitsError,r=e.registerValidateErrors,i=(0,g.useMemo)(function(){var e=t||{};return{loginUsernameServerError:e.username,passwordServerError:e.password,digitsServerError:e.digits,captchaServerError:e.captcha,undefinedLoginError:e.unknown,validateDigitsError:e.validateDigitsError}},[t]),a=i.loginUsernameServerError,o=i.passwordServerError,c=i.digitsServerError,s=i.captchaServerError,l=i.undefinedLoginError,u=i.validateDigitsError,d=(0,g.useMemo)(function(){var e=n||{};return{sendDigitsUsernameServerError:e.username,undefinedDigitsError:e.unknown}},[n]),p=d.sendDigitsUsernameServerError,h=d.undefinedDigitsError,f=(0,g.useMemo)(function(){var e=r||{},t=e.fullname,n=(void 0===t?{}:t).message,i=e.password;return{fullnameError:n,registerPasswordServerError:(void 0===i?{}:i).message}},[r]),m=f.fullnameError,v=f.registerPasswordServerError;return{usernameServerError:p||a,passwordServerError:o||v,digitsServerError:c||u,captchaServerError:s,fullnameError:m,undefinedLoginError:l,undefinedDigitsError:h}},tt=function(e){var t=e.setState,n=(0,T.useDispatch)();return(0,V.Z)(function(e,i){return n((0,P.S7)()),t({customErrorInputMap:(0,r._)({},eV),validationResult:{needsRefresh:!1,timestamp:Date.now()}},e),i})},tn=function(e){var t=e.state,n=t.selectedCountry.code,r=t.username;return(0,V.Z)(function(){return"+86"!==n||/^\d{11}$/.test(r)})},tr=function(e){var t=e.isInSignPage,n=e.type,r=e.isOversea,i=e.needSMSIdentify,o=e.captchaV2,c=e.registerConfirmSucceeded,s=e.loginConfirmSucceeded,l=e.nextUrl,u=e.captchaNeeded,d=e.loginUnregisteredError,p=e.loginConfirmError,h=e.isSignPage,f=e.selectClassName,m=e.verification,v=e.containerType,S=(0,T.useDispatch)(),y=(0,L._)((0,g.useReducer)(eX,e,eQ),2),Z=y[0],w=y[1],E=Z.selectedCountry,C=Z.username,k=Z.supportedCountriesShown,_=Z.customErrorInputMap,b=Z.smsInputInterceptTime,N=Z.smsType,B=Z.reStartTime,x=Z.password,R=Z.smsBackUpDisplay,I=Z.smsBackUpName,D=Z.submitDisabled,M=Z.captcha,z=Z.fullname,A=Z.digits,U=Z.lastSubmittedTimestamp,q=(0,g.useRef)(null),X=(0,g.useRef)(null),F=(0,g.useRef)(null),W=(0,Q.Q4)().trackEvent,H=(0,V.Z)(function(){h||W({block:"".concat(n,"_loginSuccess")})}),G=(0,V.Z)(function(e,t){return w({type:eq.UPDATE_STATE,payload:e,callback:t})}),j=te(e),K=j.usernameServerError,$=j.digitsServerError,Y=j.passwordServerError,J=j.undefinedLoginError,en=j.undefinedDigitsError;(0,g.useEffect)(function(){(J||en)&&S((0,et.c0)(J||en,"red"))},[S,J,en]);var er=ej({props:e,state:Z,setState:G,rootRef:F}),ei=eH({setState:G}),ea=tn({state:Z}),ec=tt({setState:G}),es=e4({customErrorInputMap:_,smsType:N,selectedCountry:E,username:C,runBeforeResetValidateResult:ec,testPhoneNo:ea,setState:G,captchaNeeded:u,captchaV2Ref:X,continueActionRef:q}),el=e2({props:e,captchaV2Ref:X}),eu=e9({props:e,selectedCountry:E,captcha:M,setState:G,runBeforeResetValidateResult:ec,runBeforeCheckCaptcha:el,testPhoneNo:ea,continueActionRef:q,customErrorInputMap:_,username:C,trackLoginSuccess:H});eO({registerConfirmSucceeded:c,loginConfirmSucceeded:s,nextUrl:l,username:C,isInSignPage:t,loginConfirmError:p,setState:G,loginUnregisteredError:d,verification:m});var ed=e5({props:e,captchaV2Ref:X,continueActionRef:q,setState:G,selectedCountry:E,username:C,fullname:z,digits:A,password:x});if(i)return(0,a.tZ)(eo,{ref:F,onBack:function(){return S((0,P.S7)())},phoneNo:"".concat(E.code).concat(C)});var ep=null;if("qrcode"===n){var ef=(0,a.tZ)(Q.Wi,{zaType:"Text",zaText:"二维码登录",extra:{configMap:{containerType:"登录页"}},children:(0,a.tZ)(O,{ref:F,isInSignPage:t,className:"SignInQrcode",onChangeType:function(){return er("password")},trackLoginSuccess:H})});ep=h?ef:(0,a.tZ)(Q.Wi,{zaType:"Popup",zaBlock:n,children:ef},n)}else if(d&&"digits"==n)ep=(0,a.tZ)(eB,{handleRegister:ed,setState:G,submitDisabled:D,usernameServerError:K,passwordServerError:Y});else{var em=(0,a.BX)(ee.Z,{className:"SignFlow Login-content",onSubmit:eu,children:[(0,a.tZ)(e_,{type:n}),(0,a.tZ)(eI,{type:n,isOversea:r,supportedCountriesShown:k,selectedCountry:E,username:C,usernameServerError:K,customErrorInputMap:_,targetClassName:"username-input"}),(0,a.tZ)(eU,{type:n,smsInputInterceptTime:b,digitsServerError:$,smsType:N,reStartTime:B,passwordServerError:Y,password:x,targetClassName:"username-input"}),(0,a.tZ)(eC,{type:n,isOverSea:r,smsBackUpName:I,smsBackUpDisplay:R,smsType:N,containerType:v}),(0,a.tZ)(eZ,{type:n,captchaV2Ref:X,lastSubmittedTimestamp:U}),(0,a.tZ)(ex,{submitDisabled:D,type:n,containerType:v})]});ep=h?(0,a.tZ)(Q.Wi,{zaType:"Popup",zaBlock:n,children:em},n):em}return(0,a.tZ)(eh.l,{handleChangeType:er,setState:G,dispatch:w,selectClassName:f,handleChange:ei,testPhoneNo:ea,handleSendDigits:es,continueActionRef:q,captchaNeeded:u,captchaV2:o,children:ep})};tr.propTypes={validateAndLogin:b().func,resetLoginValidateResult:b().func,loginConfirmSucceeded:b().bool,loginConfirmError:b().object,selectClassName:b().string,sendDigitsError:b().object,captchaNeeded:b().bool,selectedCountry:b().object,username:b().string,password:b().string,type:b().oneOf(["password","digits","qrcode"]),onChangeType:b().func,isInSignPage:b().bool},tr.defaultProps={selectedCountry:{name:"中国",code:"+86"},username:"",password:""};var ti=(0,T.connect)(function(e){var t=e.captcha,n=t.captchaNeeded,r=t.captchaValidated,i=t.v2,a=e.login,o=a.loginConfirmSucceeded,c=a.loginConfirmError,s=a.sendDigitsError,l=a.needSMSIdentify,u=a.loginUnregisteredError,d=a.verification,p=e.register;return{loginConfirmSucceeded:o,loginConfirmError:c,sendDigitsError:s,loginUnregisteredError:u,captchaNeeded:n,captchaValidated:r,registerValidateErrors:p.registerValidateErrors,registerConfirmError:p.registerConfirmError,registerConfirmSucceeded:p.registerConfirmSucceeded,needSMSIdentify:l,captchaV2:i,verification:d}})(tr),ta=function(e){(0,d._)(n,e);var t=(0,p._)(n);function n(){var e;return(0,s._)(this,n),e=t.apply(this,arguments),(0,u._)((0,c._)(e),"state",{type:e.props.showQrcodeFirst?"qrcode":"digits",isOversea:!1,passwordType:"email"}),(0,u._)((0,c._)(e),"handleSwitchLoginType",function(t){if("email"===t||"oversea"===t){e.setState({type:"password",isOversea:"oversea"===t,passwordType:t});return}e.setState({type:t}),m.ZP.increment("logIn.type.switchTo.".concat(t,".count"),.001)}),e}return(0,l._)(n,[{key:"renderNotification",value:function(){var e=this.props,t=e.notification,n=e.account,i=n.isAppealed,o=n.spamLevel,c=i||o?J.Wy:J.If,s=null;return s=6===o?(0,H._)((0,r._)({},t),{theme:"red"}):t,(0,a.tZ)(Y.Z,{notification:s.global,delay:c,className:"AppHeader-notification"})}},{key:"render",value:function(){var e=this.props,t=e.nextUrl,n=e.isInSignPage,r=e.isSignPage,i=e.selectClassName,o=e.containerType,c=this.state,s=c.type,l=c.isOversea;return(0,a.BX)(a.HY,{children:[(0,a.tZ)(ti,{containerType:o,type:s,isInSignPage:n,isOversea:l,onChangeType:this.handleSwitchLoginType,nextUrl:t,isSignPage:r,selectClassName:void 0===i?"Select-popoverTarget":i}),this.renderNotification()]})}}]),n}(g.Component);(0,u._)(ta,"propTypes",{nextUrl:b().string,isInSignPage:b().bool,selectClassName:b().string});var to=(0,x.compose)(N.withRouter,(0,T.connect)(function(e,t){var n=t.showQrcode,r=t.showQrcodeFirst;return{showQrcodeFirst:(void 0===n||n)&&r,notification:e.notification,account:e.account,isSignPage:["/signin","/signup"].includes(t.router.location.pathname)}}))(ta),tc=n(83697),ts=n(45913),tl=n(77813),tu=n(78603),td=n(81897),tp=n.n(td),th=n(89774),tf=n(65357),tm={sina:"Weibo",qq:"QQ",wechat:"Wechat"},tg="/oauth/account_callback",tv={qqconn:"/oauth/redirect/login/qqconn?next=",sina:"/oauth/redirect/login/sina?next=",wechat:"/oauth/redirect/login/wechat?next="},tS=function(e){(0,d._)(n,e);var t=(0,p._)(n);function n(){var e;return(0,s._)(this,n),e=t.apply(this,arguments),(0,u._)((0,c._)(e),"handleCallbackMessage",function(t){var n=t.origin,r=t.data;/(\.)?(zhihu|vzuu)\.(com|dev)/.test(n)&&r&&(e.unsubscribeCallback(),e.accountCallback(r))}),(0,u._)((0,c._)(e),"accountCallback",function(t){var n=e.props.dispatch,r=t.login,i=t.verification,a=t.is_register;if(e.dbg&&alert("收到跨窗口消息:  ".concat(JSON.stringify(t))),void 0!==a){var o=t.code,c=t.msg;if("200"===o){(0,tf.Ww)(),n((0,et.c0)("注册成功！")),setTimeout(function(){return e.reload()},1e3);return}n((0,et.c0)(c||"网络存在异常，请您稍后再试","red"));return}(null==i?void 0:i.isZombie)&&(0,eF.dq)(i),r&&((0,eW.N)(e.clickedServiceName),e.handleLogSocialLoginSuccess(),e.reload())}),(0,u._)((0,c._)(e),"handleBuildSocialAuthLink",function(t){e.clickedServiceName=t,e.handleLogSingleSocialButtonClick(t),m.ZP.increment("logIn.clickSocial.".concat(t,".count"),.1);var n=tv[t],r=(0,e3.tL)(),i=r.utm_source,a=r.utm_medium;"sina"===t&&/WindowsWechat/.test(navigator.userAgent)?location.href="https://www.zhihu.com".concat(n).concat(tg,"&from=").concat(encodeURIComponent(e.parseNextInfoFromUrl())):(e.subscribeCallback(),window.open("https://www.zhihu.com".concat(n).concat(tg).concat(i?"&utm_source=".concat(i):"","&ref_source=").concat(a),"_blank","top=200,left=400,width=600,height=550,directories=no,menubar=no,toolbar=no"))}),(0,u._)((0,c._)(e),"handleEntranceButtonClick",function(t){e.props.onEntranceButtonClick&&e.props.onEntranceButtonClick(t),e.handleLogSocialLogin(),e.setState(function(e){return{socialButtonExpanded:!e.socialButtonExpanded}})}),(0,u._)((0,c._)(e),"parseNextInfoFromUrl",function(){var t=e.props.router.location.query.next,n="/";if(t)try{n=decodeURIComponent(t)}catch(e){n=unescape(t)}return n}),e}return(0,l._)(n,[{key:"componentDidMount",value:function(){if(document.referrer.startsWith("https://www.zhihu.com/oauth/callback/sina")){var e=tp().get("atoken"),t=tp().get("accountcallback");if(e&&t){var n=JSON.parse(decodeURIComponent(t));if(!n)return;var r=n.fullname,i=n.type;(0,this.props.onRegister)({fullname:r,socialType:i})}}}},{key:"componentWillUnmount",value:function(){this.unsubscribeCallback()}},{key:"dbg",get:function(){return this.props.office&&"undefined"!=typeof window&&localStorage.getItem("dbg")}},{key:"subscribeCallback",value:function(){window.addEventListener("message",this.handleCallbackMessage,!1),window.NWEB={accountCallback:this.accountCallback},this.domain=document.domain,document.domain="zhihu.com"}},{key:"unsubscribeCallback",value:function(){if(window.removeEventListener("message",this.handleCallbackMessage,!1),window.NWEB&&"www.zhihu.com"===location.host){try{document.domain=this.domain}catch(e){}delete window.NWEB}}},{key:"reload",value:function(){var e=this.parseNextInfoFromUrl();e?location.href=e:location.reload()}},{key:"handleLogSocialLogin",value:function(){o.Z.trackEvent(this,{action:"Click",element:"Button",element_name:"SNSSignIn"})}},{key:"handleLogSingleSocialButtonClick",value:function(e){var t;t={type:tm[e]},o.Z.trackEvent(this,{action:"SignIn",element:"Button",element_name:void 0},{account:t})}},{key:"handleLogSocialLoginSuccess",value:function(){var e,t=this.props,n=t.router,r=t.trackEvent;["/signin","/signup"].includes(n.location.pathname)||r({block:"".concat(this.clickedServiceName,"_loginSuccess")}),e=this.clickedServiceName,o.Z.trackEvent(this,{id:236,action:"StatusReport",element_name:void 0},{status:{result:"Success",event:{action:"SignIn",element:"Button"}},account:e})}},{key:"render",value:function(){var e=this;return(0,a.tZ)("div",{className:"Login-socialLogin",children:(0,a.BX)("span",{className:"Login-socialButtonGroup",children:[(0,a.tZ)(Q.$U,{as:er.ZP,zaText:"微信第三方登录",zaType:"Button",zaAction:"OpenUrl",extra:{link:{url:"https://open.weixin.qq.com/connect/qrconnect"}},className:"Login-socialButton",preset:"plain",onClick:function(){return e.handleBuildSocialAuthLink("wechat")},children:(0,a.tZ)(ts.ZP,{})}),(0,a.tZ)(Q.$U,{as:er.ZP,zaText:"QQ第三方登录",zaType:"Button",zaAction:"OpenUrl",extra:{link:{url:"https://graph.qq.com/oauth2.0/show"}},className:"Login-socialButton",preset:"plain",onClick:function(){return e.handleBuildSocialAuthLink("qqconn")},children:(0,a.tZ)(tl.ZP,{fill:"#50C8FD"})}),(0,a.tZ)(Q.$U,{as:er.ZP,zaText:"微博第三方登录",zaType:"Button",zaAction:"OpenUrl",extra:{link:{url:"https://api.weibo.com/oauth2/authorize"}},className:"Login-socialButton",preset:"plain",onClick:function(){return e.handleBuildSocialAuthLink("sina")},children:(0,a.tZ)(tu.ZP,{})})]})})}}]),n}(g.Component);(0,u._)(tS,"propTypes",{onRegister:b().func.isRequired,onEntranceButtonClick:b().func});var ty=(0,x.compose)(N.withRouter,I.Z)(tS);function tZ(e){var t=(0,tc.n)(),n=(0,T.useDispatch)(),i=(0,th.Z)();return/bux/.test(t.origin)?null:(0,a.tZ)(ty,(0,H._)((0,r._)({},e),{dispatch:n,office:i}))}n(61026);var tw=n(71525),tE=n(45564);function tC(e){var t,n,r,i,a,o,c,s,l=e.captchaNeeded,u=e.sendDigitsError,d=e.registerConfirmError;return n=(t={captchaNeeded:l,sendDigitsError:u}).captchaNeeded,r=t.sendDigitsError,i=(0,T.useDispatch)(),a=(0,tE.Z)(r),(0,g.useEffect)(function(){r&&!a&&(n?i((0,ep.hU)()):i((0,ep.il)("captcha_sign_in")))},[i,r,a,n]),o=(0,T.useDispatch)(),c=(d||{}).unknown,s=(0,tE.Z)(c),(0,g.useEffect)(function(){s!==c&&o((0,et.c0)(c,"red"))},[o,c,s]),null}var tk={phoneNoError:null,fullnameError:null,digitsError:null},t_=function(e){(0,d._)(n,e);var t=(0,p._)(n);function n(){var e;return(0,s._)(this,n),e=t.apply(this,arguments),(0,u._)((0,c._)(e),"state",{fullname:e.props.defaultFullname||"",avatarPath:"",phoneNo:"",digits:"",captcha:"",isRegister:null,smsBackUpDisplay:!0,smsType:"text",selectedCountry:{name:"中国",code:"+86"},smsInputInterceptTime:-1,reStartTime:-1,customErrorInputMap:(0,r._)({},tk),validationResult:{}}),(0,u._)((0,c._)(e),"captchaV2Ref",(0,g.createRef)()),(0,u._)((0,c._)(e),"getSocialInfo",function(t){var n=t||e.props,r=n.getSocialInfo,i=n.socialType;i&&r(i).then(function(t){var n=t.payload,r=n.name,i=n.profileImageUrl;e.setState({avatarPath:i.split("/").reverse()[0],fullname:r})})}),(0,u._)((0,c._)(e),"testPhoneNo",function(){var t=e.state,n=t.selectedCountry.code,r=t.phoneNo;return"+86"!==n||/^\d{11}$/.test(r)}),(0,u._)((0,c._)(e),"handleChange",function(t){return function(n){e.setState((0,u._)({},t,n))}}),(0,u._)((0,c._)(e),"handleBackUpDigits",function(){e.setState({smsType:"text"===e.state.smsType?"voice":"text",reStartTime:Date.now()})}),(0,u._)((0,c._)(e),"handleCountDownEndEvent",function(){e.setState({smsBackUpDisplay:!0})}),(0,u._)((0,c._)(e),"parseServerError",function(t){var n=t||e.props,r=n.registerValidateErrors,i=n.loginConfirmError,a=n.registerConfirmError,o=n.sendDigitsError,c=i||{},s=c.username,l=c.password,u=c.digits,d=c.captcha,p=a||{},h=p.username,f=p.password,m=p.digits,g=o||{},v=g.username,S=g.captcha,y=(r||{}).fullname;return{usernameServerError:s||v,passwordServerError:l||f,digitsServerError:u||m,captchaServerError:d||S,fullnameServerError:(void 0===y?{}:y).message||h}}),(0,u._)((0,c._)(e),"runBeforeCheckCaptcha",function(t){var n=e.props,i=n.captchaNeeded,a=n.captchaValidated,o=e.state.phoneNo;if(!o||!e.testPhoneNo()){e.setState({customErrorInputMap:(0,H._)((0,r._)({},e.state.customErrorInputMap),{phoneNoError:o?"请输入正确的手机号":"请输入手机号"}),smsInputInterceptTime:Date.now()});return}if(i&&!a){e.showCaptcha(),e1(e.captchaV2Ref);return}t()}),(0,u._)((0,c._)(e),"runBeforeResetValidateResult",function(t){e.setState({customErrorInputMap:(0,r._)({},tk)},function(){t()})}),(0,u._)((0,c._)(e),"handleSendDigits",function(t,n){return e.countDownStart=n,e.runBeforeCheckCaptcha(e.sendDigits),!1}),(0,u._)((0,c._)(e),"sendDigits",function(){var t,n=e.state,r=n.selectedCountry,i=n.phoneNo,a=n.smsType,o=e.props.sendLoginDigits;null===(t=e.countDownStart)||void 0===t||t.call(e),e.props.validateRegisterForm({phoneNo:"".concat(r.code).concat(i)}).then(function(t){var n=t.payload;e.setState({smsBackUpDisplay:!1,isRegister:!(n.phoneNo&&n.phoneNo.code===J.Dm)}),o("".concat(r.code).concat(i),a)})}),(0,u._)((0,c._)(e),"handleSubmit",function(){e.runBeforeCheckCaptcha(function(){e.runBeforeResetValidateResult(function(){var t=e.state,n=t.selectedCountry,i=t.phoneNo,a=t.digits,o=t.isRegister,c=t.fullname,s=t.avatarPath,l=e.props,u=l.validateAndLogin,d=l.validateAndRegister,p=l.nextUrl,h=l.socialType,f=(0,e3.tL)(p),m=f.utm_source,g=f.utm_medium;if(o){d((0,r._)({source:"com.zhihu.web",registerType:"phone_digits",phoneNo:"".concat(n.code).concat(i),fullname:c,digits:a,refSource:g,utmSource:m},s&&{avatarPath:s},h&&{socialRegisterType:h}));return}u((0,e8.Z)("digits",{username:"".concat(n.code).concat(i),digits:a,refSource:g,utmSource:m}))})})}),(0,u._)((0,c._)(e),"onVerify",function(t){"success"===t.result&&e.sendDigits()}),(0,u._)((0,c._)(e),"showCaptcha",function(){var t;null===(t=e.captchaV2Ref.current)||void 0===t||t.show(),e.props.showNotification(e.state.validationResult.message,"red")}),e}return(0,l._)(n,[{key:"componentDidMount",value:function(){if(!tp().get("atoken")){this.props.onResetRegister();return}this.getSocialInfo();var e=tp().get("accountcallback");if(!this.state.fullname&&e){var t=JSON.parse(decodeURIComponent(e));this.setState({fullname:t.fullname})}}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=this.props,n=t.nextUrl,i=t.socialType,a=t.defaultFullname,o=t.sendDigitsError,c=t.loginConfirmError,s=t.loginConfirmSucceeded,l=t.registerConfirmSucceeded,u=e.socialType,d=e.defaultFullname,p=e.sendDigitsError,h=e.loginConfirmError,f=e.loginConfirmSucceeded,m=e.registerConfirmSucceeded;if(!i&&u&&this.getSocialInfo(e),a!==d&&this.setState({fullname:d}),!s&&f||!l&&m){n?location.href=n:location.reload();return}if(!c&&h&&h.validateDigitsError&&this.setState({customErrorInputMap:(0,H._)((0,r._)({},this.state.customErrorInputMap),{digitsError:h.validateDigitsError}),smsInputInterceptTime:Date.now()}),!o&&p){var g=this.parseServerError(e).captchaServerError;this.setState({validationResult:{message:g},smsInputInterceptTime:Date.now()})}}},{key:"render",value:function(){var e=this.state,t=e.smsInputInterceptTime,n=e.customErrorInputMap,r=e.smsBackUpDisplay,i=e.reStartTime,o=e.isRegister,c=e.smsType,s=e.fullname,l=this.props,u=l.onResetRegister,d=l.captchaNeeded,p=l.sendDigitsError,h=l.registerConfirmError,f=n.phoneNoError,m=n.digitsError,g=this.parseServerError(),v=g.usernameServerError,S=g.fullnameServerError,y=g.digitsServerError,Z=(0,a.BX)(ee.Z,{className:"Register-content",onSubmit:this.handleSubmit,children:[(0,a.tZ)(tC,{captchaNeeded:d,sendDigitsError:p,registerConfirmError:h}),(0,a.tZ)("div",{className:"Register-socialHeader",children:(0,a.BX)("div",{className:"Register-socialTitle",children:[(0,a.tZ)(er.ZP,{onClick:u,children:(0,a.tZ)(tw.ZP,{})}),"绑定手机"]})},"header"),(0,a.tZ)(eN.Z,{className:k()("Register-socialName",{"Register-hiddenSocialName":!o}),name:"fullname",placeholder:"用户名",value:s,onChange:this.handleChange("fullname"),manualValidateError:S,validations:[],targetClassName:"username-input"},"fullname"),(0,a.tZ)(eR.Z,{type:"register",onChange:this.handleChange("phoneNo"),onSelect:this.handleChange("selectedCountry"),manualValidateError:f||v,targetClassName:"username-input"}),(0,a.tZ)(eZ,{captchaV2Ref:this.captchaV2Ref,onVerify:this.onVerify}),(0,a.tZ)(eA,{smsType:c,reStartTime:i,onChange:this.handleChange("digits"),countDownEvent:this.handleSendDigits,countDownEndEvent:this.handleCountDownEndEvent,interceptTime:t,manualValidateError:m||y,targetClassName:"username-input"}),(0,a.tZ)("div",{className:k()("Register-smsBackUp",{"Register-hiddenSmsBackUp":!r}),children:(0,a.BX)("span",{role:"button",tabIndex:0,onClick:this.handleBackUpDigits,children:["获取","text"===c?"语音":"短信","验证码"]})}),(0,a.tZ)(er.ZP,{className:"Register-submitButton",type:"submit",preset:"primary",color:"blue",children:"进入知乎"})]});return(0,a.tZ)(eh.l,{children:Z})}}]),n}(g.Component),tb=(0,T.connect)(function(e){var t=e.captcha,n=t.captchaNeeded,r=t.captchaValidated,i=e.register,a=i.registerConfirmError,o=i.registerValidateErrors,c=i.registerConfirmSucceeded,s=e.login,l=s.loginConfirmSucceeded,u=s.validateDigitsError,d=s.loginConfirmError;return{captchaNeeded:n,captchaValidated:r,sendDigitsError:s.sendDigitsError,registerConfirmError:a,registerValidateErrors:o,registerConfirmSucceeded:c,loginConfirmSucceeded:l,validateDigitsError:u,loginConfirmError:d}},{showNotification:et.c0,sendLoginDigits:P.Yu,validateAndLogin:P.uJ,validateAndRegister:eK.cP,getSocialInfo:eK.Gz,validateRegisterForm:eK.To})(t_),tT=function(e){(0,d._)(n,e);var t=(0,p._)(n);function n(){var e;return(0,s._)(this,n),e=t.apply(this,arguments),(0,u._)((0,c._)(e),"state",{showHeader:!0,fullname:"",socialType:""}),(0,u._)((0,c._)(e),"changeSignType",function(t){e.props.onChangeSignType(t),e.handleSetShowHeader(!0)}),(0,u._)((0,c._)(e),"handleSetShowHeader",function(t){e.setState({showHeader:t})}),(0,u._)((0,c._)(e),"handleSocialRegister",function(t){var n=t.fullname,r=t.socialType;e.props.onChangeSignType("register"),e.setState({fullname:n,socialType:r,showHeader:!1})}),(0,u._)((0,c._)(e),"handleResetRegister",function(){e.props.onChangeSignType("login"),e.setState({fullname:"",socialType:"",showHeader:!0})}),(0,u._)((0,c._)(e),"renderLine",function(){return(0,a.BX)(B.Flex,{css:{margin:"0 24px 12px",alignItems:"center"},children:[(0,a.tZ)(B.Box,{sx:{borderTop:"1px solid",borderColor:"GBK09A",width:"124px"}}),(0,a.tZ)(B.Text,{color:"GBK06A",fontSize:12,mx:16,width:72,overflow:"hidden",lineHeight:"17px",css:{whiteSpace:"nowrap"},children:"其他方式登录"}),(0,a.tZ)(B.Box,{sx:{borderTop:"1px solid",borderColor:"GBK09A",width:"124px"}})]})}),e}return(0,l._)(n,[{key:"componentDidMount",value:function(){var e=this.props,t=e.nextUrl;e.isLogin&&(location.href=t||"/")}},{key:"render",value:function(){var e=this.state,t=e.fullname,n=e.socialType,r=this.props,i=r.nextUrl,o=r.isInSignPage,c=r.signType,s=r.showQrcodeFirst,l=r.containerType,u=o?B.Card:B.Box;return(0,a.BX)(u,{bg:"background",width:400,css:{overflow:"hidden",boxShadow:"none"},children:["login"===c?(0,a.tZ)("div",{className:"SignContainer-content",children:(0,a.tZ)("div",{className:"SignContainer-inner",children:(0,a.tZ)(to,{containerType:l,showQrcodeFirst:s,nextUrl:i,isInSignPage:o})})}):(0,a.tZ)(tb,{socialType:n,nextUrl:i,defaultFullname:t,onResetRegister:this.handleResetRegister}),"login"===c&&(0,a.BX)(a.HY,{children:[this.renderLine(),(0,a.tZ)(tZ,{onRegister:this.handleSocialRegister}),(0,a.BX)("div",{className:"SignContainer-tip",children:[R.Z.allowSignUp?"未注册手机验证后自动登录，注册即代表同意":"手机验证后自动登录，登录即代表同意",(0,a.tZ)("a",{href:"https://www.zhihu.com/term/zhihu-terms",children:"《知乎协议》"}),(0,a.tZ)("a",{href:"https://www.zhihu.com/term/privacy",children:"《隐私保护指引》"})]})]})]})}}]),n}(g.Component),tN=(0,$.Z)(tT);function tB(e){var t=e.signType,n=e.handleQRCodeLinkClick,c=e.isInSignPage,s=e.showQrcode,l=(0,i._)(e,["signType","handleQRCodeLinkClick","isInSignPage","showQrcode"]);return(0,a.BX)("div",{className:"signQr-container",children:[(0,a.BX)("div",{className:"signQr-leftContainer",children:[(0,a.tZ)(O,{className:"smallVersion"}),(0,a.tZ)(K,{zaClickId:c?4943:8270,isInSignPage:c,isQRCodeShown:s,onQRCodeLinkClick:function(e){n(!s),c?s&&o.Z.trackEvent(e.currentTarget,{id:4945}):o.Z.trackEvent(e.currentTarget,{id:s?8272:8271})}})]}),(0,a.tZ)("div",{className:"signQr-rightContainer",children:(0,a.tZ)(tN,(0,r._)({signType:t,isInSignPage:c},l))})]})}},29102:function(e,t,n){var r=n(22107),i=n(94707),a=n(87320),o=n(86325),c=n(55164),s=n(71728),l=n(85626),u=n(85879),d=n(14168),p=n.n(d),h=n(87363),f=n(34150),m=function(e){(0,o._)(n,e);var t=(0,l._)(n);function n(){return(0,r._)(this,n),t.apply(this,arguments)}return(0,i._)(n,[{key:"render",value:function(){var e=this.props,t=e.onChange,n=e.validations,r=(0,s._)(e,["onChange","validations"]);return(0,u.tZ)(f.Z,(0,c._)({className:"SignFlow-username",onChange:t,validations:n||[{type:"required",message:"请输入用户名"}]},r))}}]),n}(h.Component);(0,a._)(m,"propTypes",{onChange:p().func.isRequired}),t.Z=m},89630:function(e,t,n){n.d(t,{W:function(){return r},l:function(){return i}});var r="SignContainerModal";function i(e){return e===r?"登录框":"登录页"}},61026:function(e,t,n){var r=n(20857),i=n(22107),a=n(94707),o=n(87320),c=n(86325),s=n(55164),l=n(85626),u=n(85879),d=n(87363),p=n(53778),h=n(94057),f=n(38889),m=n(45842),g=n(71670),v=n(87843),S=n(72238),y=n(80487),Z=n(10757),w=n(29102),E={phoneNoError:null,fullnameError:null,passwordError:null,digitsError:null},C=function(e){(0,c._)(n,e);var t=(0,l._)(n);function n(){var e;return(0,i._)(this,n),e=t.apply(this,arguments),(0,o._)((0,r._)(e),"state",{email:"",password:"",fullname:"",customErrorInputMap:(0,s._)({},E)}),(0,o._)((0,r._)(e),"handleChange",function(t){return function(n){e.setState((0,o._)({},t,n))}}),(0,o._)((0,r._)(e),"handleSubmit",function(){var t=e.props,n=t.validateAndRegister;(0,t.resetRegisterValidateResult)();var r=e.state;n({source:"com.zhihu.web",registerType:"email",email:r.email,password:r.password,fullname:r.fullname})}),e}return(0,a._)(n,[{key:"componentDidMount",value:function(){this.props.isLogin&&(location.href="https://www.zhihu.com/logout?next=/email-register")}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=this.props.registerConfirmSucceeded,n=e.registerConfirmSucceeded;!t&&n&&(location.href="/")}},{key:"render",value:function(){var e=this.props.registerValidateErrors,t=e.email,n=(void 0===t?{}:t).message,r=e.fullname,i=(void 0===r?{}:r).message,a=e.password,o=(void 0===a?{}:a).message;return(0,u.tZ)(g.l,{children:(0,u.BX)(v.Z,{className:"SignContainer-content EmailRegister",onSubmit:this.handleSubmit,children:[(0,u.tZ)(w.Z,{onChange:this.handleChange("fullname"),name:"fullname",placeholder:"用户名",manualValidateError:i}),(0,u.tZ)(y.Z,{type:"register",placeholder:"输入邮箱",onChange:this.handleChange("email"),manualValidateError:n,supportedCountriesShown:!1}),(0,u.tZ)(Z.Z,{onChange:this.handleChange("password"),manualValidateError:o}),(0,u.tZ)(f.ZP,{className:"EmailRegister-submitButton",preset:"primary",color:"blue",type:"submit",children:"注册"})]})})}}]),n}(d.Component);t.Z=(0,h.compose)(m.Z,(0,p.connect)(function(e){var t=e.register;return{registerValidateErrors:t.registerValidateErrors,registerConfirmSucceeded:t.registerConfirmSucceeded}},{validateAndRegister:S.cP,resetRegisterValidateResult:S.mA}))(C)},71525:function(e,t,n){n.d(t,{ZP:function(){return c}});var r=n(87363),i=n.n(r),a=n(30851),o=Object.assign;function c(e){var t;return i().createElement(a.Z,o(o({width:"16",height:"16",viewBox:"0 0 16 16"},e),{className:"function"==typeof(t=e.className)?t():"ZDI ZDI--ArrowLeft16"+(t?" "+t:"")}),i().createElement("path",{fillRule:"evenodd",d:"M11.46 1.54a.65.65 0 0 1 0 .92L5.92 8l5.54 5.54a.65.65 0 1 1-.92.92L4.73 8.648a.917.917 0 0 1 0-1.296L10.54 1.54a.65.65 0 0 1 .92 0Z",clipRule:"evenodd"}))}},54674:function(e,t,n){n.d(t,{Z:function(){return c},e:function(){return s}});var r=n(87363),i=n.n(r),a=n(30851),o=Object.assign;function c(e){var t;return i().createElement(a.Z,o(o({width:"24",height:"24",viewBox:"0 0 24 24"},e),{className:"function"==typeof(t=e.className)?t():"ZDI ZDI--ArrowLeftSmall24"+(t?" "+t:"")}),i().createElement("path",{fillRule:"evenodd",d:"m10.752 12 4.025-3.78a.684.684 0 0 0 0-1.01.796.796 0 0 0-1.075 0l-4.42 4.15a.866.866 0 0 0 0 1.28l4.42 4.15a.796.796 0 0 0 1.075 0 .684.684 0 0 0 0-1.01L10.752 12Z",clipRule:"evenodd"}))}function s(e){return i().createElement(c,o(o({},e),{className:function(){return"Zi Zi--ArrowLeft"+(e.className?" "+e.className:"")}}))}},11738:function(e,t,n){n.d(t,{Z:function(){return c}});var r=n(87363),i=n.n(r),a=n(30851),o=Object.assign;function c(e){var t;return i().createElement(a.Z,o(o({width:"24",height:"24",viewBox:"0 0 24 24"},e),{className:"function"==typeof(t=e.className)?t():"ZDI ZDI--EyeAlt24"+(t?" "+t:"")}),i().createElement("path",{fillRule:"evenodd",d:"M11.95 15.8a3.75 3.75 0 1 0 0-7.5 3.75 3.75 0 0 0 0 7.5Zm2.25-3.75a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Z",clipRule:"evenodd"}),i().createElement("path",{fillRule:"evenodd",d:"M23 12c0 2.804-5 9-11 9S1 14.804 1 12c0-2.804 4-9 11-9s11 6.196 11 9Zm-1.5 0c0 .32-.168.961-.674 1.84-.485.84-1.205 1.765-2.109 2.624C16.887 18.202 14.488 19.5 12 19.5c-2.488 0-4.887-1.298-6.717-3.036-.904-.859-1.624-1.784-2.109-2.624C2.668 12.96 2.5 12.32 2.5 12c0-.388.153-1.067.578-1.922a10.196 10.196 0 0 1 1.865-2.576C6.59 5.832 8.973 4.5 12 4.5s5.41 1.332 7.058 3.002a10.196 10.196 0 0 1 1.864 2.576c.425.855.578 1.534.578 1.922Z",clipRule:"evenodd"}))}},26115:function(e,t,n){n.d(t,{Z:function(){return c}});var r=n(87363),i=n.n(r),a=n(30851),o=Object.assign;function c(e){var t;return i().createElement(a.Z,o(o({width:"24",height:"24",viewBox:"0 0 24 24"},e),{className:"function"==typeof(t=e.className)?t():"ZDI ZDI--EyeSlash24"+(t?" "+t:"")}),i().createElement("path",{fillRule:"evenodd",d:"M7.517 4.474c1.206-.453 2.608-.724 4.234-.724 6.036 0 8.834 3.715 9.985 6.161a5.255 5.255 0 0 1-.393 5.219 11.207 11.207 0 0 1-3.027 3.036.75.75 0 1 1-.835-1.245c.058-.04.115-.078.171-.118a9.704 9.704 0 0 0 2.447-2.511 3.755 3.755 0 0 0 .28-3.742c-1.003-2.131-3.374-5.3-8.628-5.3-1.456 0-2.679.242-3.706.628a.75.75 0 1 1-.528-1.404ZM5.498 6.382a.75.75 0 0 1-.07 1.059c-1.126.987-1.854 2.148-2.306 3.105a3.756 3.756 0 0 0 .281 3.749c1.206 1.787 3.71 4.26 8.348 4.26 1.237 0 2.315-.175 3.253-.462a.75.75 0 1 1 .438 1.435c-1.084.33-2.31.527-3.69.527-5.28 0-8.198-2.855-9.592-4.921a5.256 5.256 0 0 1-.394-5.228c.513-1.09 1.353-2.435 2.674-3.593a.75.75 0 0 1 1.058.07Z",clipRule:"evenodd"}),i().createElement("path",{fillRule:"evenodd",d:"M20.048 20.012a.75.75 0 0 1-1.06.036l-15.5-14.5a.75.75 0 0 1 1.025-1.096l15.5 14.5a.75.75 0 0 1 .035 1.06Z",clipRule:"evenodd"}),i().createElement("path",{fillRule:"evenodd",d:"M9.559 11.535c-.203 1.067.554 2.164 1.808 2.374a2.36 2.36 0 0 0 1.707-.36.75.75 0 0 1 1.043.191.75.75 0 0 1-.215 1.04 3.893 3.893 0 0 1-2.816.602c-1.984-.331-3.381-2.13-3.007-4.094.06-.311.16-.607.297-.881a.768.768 0 0 1 1.01-.358.733.733 0 0 1 .338.995 1.908 1.908 0 0 0-.165.491Zm1.219-2.362a.769.769 0 0 1 .716-.797c.302-.02.61-.007.92.045 1.784.299 3.086 1.775 3.066 3.501a.77.77 0 0 1-.762.754.73.73 0 0 1-.744-.74c.011-.948-.72-1.854-1.842-2.041a2.427 2.427 0 0 0-.566-.028.732.732 0 0 1-.788-.694Z",clipRule:"evenodd"}))}},77813:function(e,t,n){n.d(t,{Ao:function(){return s},ZP:function(){return c}});var r=n(87363),i=n.n(r),a=n(30851),o=Object.assign;function c(e){var t;return i().createElement(a.Z,o(o({width:"24",height:"24",viewBox:"0 0 24 24"},e),{className:"function"==typeof(t=e.className)?t():"ZDI ZDI--Qq24"+(t?" "+t:"")}),i().createElement("path",{fillRule:"evenodd",d:"M12.003 2c-2.265 0-6.29 1.364-6.29 7.325v1.195S3.55 14.96 3.55 17.474c0 .665.17 1.025.281 1.025.114 0 .902-.483 1.748-2.072 0 0-.18 2.197 1.904 3.967 0 0-1.77.495-1.77 1.182 0 .686 4.078.43 6.29 0 2.239.425 6.288.687 6.288 0 0-.688-1.77-1.182-1.77-1.182 2.086-1.77 1.906-3.967 1.906-3.967.845 1.588 1.634 2.072 1.746 2.072.111 0 .283-.36.283-1.025 0-2.514-2.165-6.954-2.165-6.954V9.325C18.29 3.364 14.268 2 12.003 2Z",clipRule:"evenodd"}))}function s(e){return i().createElement(c,o(o({},e),{className:function(){return"Zi Zi--QQ"+(e.className?" "+e.className:"")}}))}},45913:function(e,t,n){n.d(t,{F3:function(){return l},ZP:function(){return c},vU:function(){return s}});var r=n(87363),i=n.n(r),a=n(30851),o=Object.assign;function c(e){var t;return i().createElement(a.Z,o(o({width:"24",height:"24",fill:"none",viewBox:"0 0 24 24"},e),{className:"function"==typeof(t=e.className)?t():"ZDI ZDI--Wechat24"+(t?" "+t:"")}),i().createElement("path",{fill:"#07C160",d:"M20.314 18.59c1.333-.968 2.186-2.397 2.186-3.986 0-2.91-2.833-5.27-6.325-5.27-3.494 0-6.325 2.36-6.325 5.27 0 2.911 2.831 5.271 6.325 5.271.698.001 1.393-.096 2.064-.288l.186-.029c.122 0 .232.038.336.097l1.386.8.12.04a.21.21 0 0 0 .212-.211l-.034-.154-.285-1.063-.023-.135a.42.42 0 0 1 .177-.343ZM9.09 3.513C4.9 3.514 1.5 6.346 1.5 9.84c0 1.905 1.022 3.622 2.622 4.781a.505.505 0 0 1 .213.412l-.026.16-.343 1.276-.04.185c0 .14.113.254.252.254l.146-.047 1.663-.96a.793.793 0 0 1 .403-.116l.222.032c.806.231 1.64.348 2.478.348l.417-.01a4.888 4.888 0 0 1-.255-1.55c0-3.186 3.1-5.77 6.923-5.77l.411.011c-.57-3.02-3.71-5.332-7.494-5.332Zm4.976 10.248a.843.843 0 1 1 0-1.685.843.843 0 0 1 0 1.684v.001Zm4.217 0a.843.843 0 1 1 0-1.685.843.843 0 0 1 0 1.684v.001ZM6.561 8.827a1.012 1.012 0 1 1 0-2.023 1.012 1.012 0 0 1 0 2.023Zm5.061 0a1.012 1.012 0 1 1 0-2.023 1.012 1.012 0 0 1 0 2.023Z",clipRule:"evenodd"}))}function s(e){return i().createElement(c,o(o({},e),{className:function(){return"Zi Zi--WeChatMessage"+(e.className?" "+e.className:"")}}))}function l(e){return i().createElement(c,o(o({},e),{className:function(){return"Zi Zi--WeChat"+(e.className?" "+e.className:"")}}))}},78603:function(e,t,n){n.d(t,{ZP:function(){return c},kH:function(){return s}});var r=n(87363),i=n.n(r),a=n(30851),o=Object.assign;function c(e){var t;return i().createElement(a.Z,o(o({width:"24",height:"24",fill:"none",viewBox:"0 0 24 24"},e),{className:"function"==typeof(t=e.className)?t():"ZDI ZDI--Weibo24"+(t?" "+t:"")}),i().createElement("path",{fill:"#FB6622",d:"M15.518 3.06c8.834-.854 7.395 7.732 7.394 7.731-.625 1.44-1.673.31-1.673.31.596-7.52-5.692-6.33-5.692-6.33-.898-1.067-.03-1.71-.03-1.71Zm4.13 6.985c-.66 1.01-1.376.126-1.375.126.205-3.179-2.396-2.598-2.396-2.598-.72-.765-.091-1.346-.091-1.346 4.882-.55 3.863 3.818 3.863 3.818ZM5.318 7.52s4.615-3.86 6.443-1.328c0 0 .662 1.08-.111 2.797.003-.003 3.723-1.96 5.408.16 0 0 .848 1.094-.191 2.648 0 0 2.918-.099 2.918 2.715 0 2.811-4.104 6.44-9.315 6.44-5.214 0-8.026-2.092-8.596-3.102 0 0-3.475-4.495 3.444-10.33Zm10.448 7.792s.232-4.41-5.71-4.207c-6.652.231-6.58 4.654-6.58 4.654.022.39.098 3.713 5.843 3.713 5.98 0 6.447-4.16 6.447-4.16Zm-9.882.86s-.06-3.632 3.804-3.56c3.412.06 3.206 3.164 3.206 3.164s-.026 2.98-3.684 2.98c-3.288 0-3.326-2.584-3.326-2.584Zm2.528 1.037c.672 0 1.212-.447 1.212-.998 0-.55-.543-.998-1.212-.998-.672 0-1.215.447-1.215.998 0 .551.546.998 1.215.998Z",clipRule:"evenodd"}))}function s(e){return i().createElement(c,o(o({},e),{className:function(){return"Zi Zi--Weibo"+(e.className?" "+e.className:"")}}))}}}]);
//# sourceMappingURL=shared-1dffcf43329e08de9bcf385e1895bae6667163e6.cd8eb551fb91841cbf1e.js.map