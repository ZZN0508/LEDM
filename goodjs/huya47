(window.HUYA_MAIN_APP_WEBPACK_JSONP=window.HUYA_MAIN_APP_WEBPACK_JSONP||[]).push([[227],{1304:function(e,i,t){"use strict";t.r(i);t(29);var a=t(5),n=t(342),r=t(383),s=t(187),l=$("#wrap-preview");if(l.length>0){0,Object(n.a)({type:"GET",dataType:"json",url:"//".concat("live.cdn.huya.com","/liveHttpUI/getHomeUpcomingRecommend"),data:{ePlatform:1},cache:!0}).then((function(e){var i=e.vUpcoming;if(!i.length)throw new Error("data empty");var t=function(e){return e.map((function(e){var i=e.iEventID,t=e.sTitle,a=e.sDigest,n=e.sPicUrl,r=e.sClickUrl,s=e.iUpTime,l=e.tProfile,p=l.lUid,c=l.sNick,o=(l.sAvatar180,l.lProfileRoom),d=l.sPrivateHost;l.lActivityCount;return{clickUrl:r,digest:a,eventId:i,liveState:e.iIsLive,nick:c,picUrl:n,privateHost:d,profileRoom:o,title:t,uid:p,upTime:s}}))}(i.slice(0,10));Object(r.a)(l,t);var n=$("#js-preview-box"),p=$(window);n.find("img").lazyload();var c=Object(a.throttle)((function(){p.scrollTop()>=500&&(c.cancel(),p.off("scroll",c),n.find("img").trigger("appear"),r.a.init((function(e){s.a.on("resize",e)})))}),60);p.on("scroll",c),c()})).catch((function(e){l.append('<p style="text-align: center; color: #666;">暂无节目~</p>')}))}},190:function(e,i,t){},310:function(e,i,t){"use strict";t.r(i);t(29);var a=t(10),n=t(383),r=(t(190),new a.a),s=$("#wrap-preview"),l=JSON.parse($("#data-preview").html());Object(n.a)(s,l),n.a.init((function(e){r.on("resize",(function(i){$("#js-preview-box").css("height",i+"px"),$("#js-preview-box").find(".preview-bd").css("height",i-43+"px"),e()}))}));var p=$("#js-preview-box");p.find("img").lazyload(),p.find("img").trigger("appear"),i.default=r},383:function(e,i,t){"use strict";t(476);function a(){this.initialize.apply(this,arguments)}function n(){this.initialize.apply(this,arguments),this._bindEvent()}function r(){this.initialize.apply(this,arguments)}function s(e,i){var a=i;function n(e){e*=1e3;var i=new Date,t=+new Date(i.getFullYear()+"/"+i.getMonth()+"/"+i.getDate()),a=new Date(e),n=(a.getHours()<10?"0":"")+a.getHours()+":"+(a.getMinutes()<10?"0":"")+a.getMinutes(),r=(a.getDate()<10?"0":"")+a.getDate()+"日";return e-t<864e5?r="今天":e-t>864e5&&e-t<1728e5&&(r="明天"),r+n}e.html(function(e){return t(478)({formatTime:n,obj:e})}(a))}a.prototype={initialize:function(e){this.yyUid=window.HUYA_UTIL&&HUYA_UTIL.getCookieVal("udb_uid")||0;var i=this;this.ajaxObj={stateUrl:"//upevent.huya.com/getSubscribeState",subscribeUrl:TT.app.main+"member/index.php?m=Upcoming&do=subscribe"},this.$elementId=$(e.elementId);var a,s={mouseWheelSpeed:20,verticalGutter:0,isOutsideNotPrevent:!1};e.respondFn&&(a=function(){e.respondFn((function(){var e=$(".preview-wrap").data("jsp");e?e.reinitialise():i.jScrollPaneElement=$(".preview-wrap").jScrollPane(s)}))},$.isFunction($.fn.jScrollPane)?(i.jScrollPaneElement=$(".preview-wrap").jScrollPane(s),a()):t.e(77).then(t.t.bind(null,345,7)).then((function(){i.jScrollPaneElement=$(".preview-wrap").jScrollPane(s),a()}))),this.assignSub=new n(this),this.cancelSub=new r(this),this.getSubscribeState(),this.bindEvent(),window.DUYA_SUB&&DUYA_SUB.subscribe("INDEX_LIVE_NOTICE",this.setLiveState)},setLiveState:function(e,i){var t=$('[data-event-id="'+i+'"]'),a=t.data("url");t.hasClass("isLive")||(t.removeClass("normal isOrder").addClass("isLive"),t.find("a").attr({href:a,target:"_blank"}),t.find(".preview-time").text("正在直播"),t.find(".preview-btn-icon").text("看直播"),t.find(".preview-btn").attr({title:"",eid:"click/program/"+i,eid_desc:"点击/节目/节目"+i}))},getSubscribeState:function(){if(!this.yyUid)return!1;var e=this,i=this.$elementId.find(".preview-item");var t,a=(t=[],i.each((function(){t.push(this.getAttribute("data-event-id"))})),t.join(","));this.getData(this.ajaxObj.stateUrl,{event_ids:a,uid:this.yyUid},(function(t){if(0==t.code&&t.data&&t.data.length>0){var a={};for(var n in t.data){var r=t.data[n];a["id_"+r.iEventID]=r}s=a,i.each((function(i,t){var a=$(t);if(!a.hasClass("isLive")){var n=a[0].getAttribute("data-event-id");1==s["id_"+n].bSubscribe?e.currState=e.assignSub:e.currState=e.cancelSub,e.currState.btnStatus(a)}}))}var s}))},bindEvent:function(){var e=this;this.$elementId.on("mouseenter",".preview-item",(function(){var e=$(this);e.hasClass("on")||e.addClass("on").siblings().removeClass("on")})),this.$elementId.on("click",".preview-btn",(function(){var i=$(this);NAV_UTIL.checkLogin((function(){var t=i.parents(".preview-item");if(t.hasClass("isLive"))return!1;var a=i.data("eventId"),n=t.hasClass("normal")?1:0;1==n?e.currState=e.assignSub:0==n&&(e.currState=e.cancelSub),e.currState.change(a,i)}))})),$(".preview-list").on("mousemove",".preview-item",(function(i){if(!($(this).find(".preview-digest-textarea").length<1)){var t=$(this).find(".preview-digest-textarea").val();e.digest.show($(this),t,i)}})).on("mouseleave",".preview-item",(function(i){e.digest.hide()})),$(".preview-list").on("mousemove",".preview-btn",(function(i){return e.digest.hide(),!1}))},digest:{view:null,show:function(e,i,t){this.view||(this.view=$('<div class="preview-digest" id="js-preview-digest"><h2 class="preview-digest-title">节目简介</h2><p class="preview-digest-content"></p></div>').appendTo("body")),this.view.find(".preview-digest-content").text(HUYA_UTIL.unescape(HUYA_UTIL.unescape(i))),this.tip(e,i,t)},tip:function(e,i,t){var a=$("#js-preview-digest").outerWidth(),n=$("#js-preview-digest").outerHeight(),r=t.pageX+10,s=t.pageY+10;r>$(document).width()-a-21&&(r=$(document).width()-a-21),s>$(document).height()-n&&(s=$(document).height()-n),this.view.css({left:r,top:s}).show()},hide:function(){this.view&&this.view.hide()}},getData:function(e,i,t){$.ajax({url:e,type:"GET",dataType:"jsonp",data:i}).done((function(e){t&&t(e)}))},destroy:function(){this.jScrollPaneElement&&this.jScrollPaneElement.data("jsp").destroy(),this.$elementId.off(),window.DUYA_SUB&&DUYA_SUB.unsubscribe("INDEX_LIVE_NOTICE")}},n.prototype={initialize:function(e){this.parentSub=e,this.previewDialogLayer=null},btnStatus:function(e){e.addClass("isOrder").removeClass("normal"),e.find(".preview-btn-icon").text("已预订"),e.find(".preview-btn").attr({title:"点击取消预订",eid:"click/program/cancel",eid_desc:"点击/节目/取消预约"})},change:function(e,i){var a=this;function n(){var e=this,a=i.parents(".preview-item"),n=t(477);this.previewDialogLayer?this.previewDialogLayer.open():t.e(10).then(t.bind(null,28)).then((function(i){var t=i.default;e.previewDialogLayer=t.layer({view:n(),zIndex:10001}),$(".j_preview-dialog-pic").qrcode({render:"Microsoft Internet Explorer"==navigator.appName?"table":"canvas",text:"https://a.app.qq.com/o/simple.jsp?pkgname=com.duowan.kiwi",width:131,height:131})})),this.btnStatus(a)}this.parentSub.getData(this.parentSub.ajaxObj.subscribeUrl,{eid:e,subscribe:1,uid:this.parentSub.yyUid},(function(e){0==e.status&&n.call(a)}))},_bindEvent:function(){var e=this;$(document).on("click.preview-dialog",".preview-dialog-close",(function(){e.previewDialogLayer.hide()}))},destroy:function(){$(document).off("click.preview-dialog")}},r.prototype={initialize:function(e){this.parentSub=e},btnStatus:function(e){e.removeClass("isOrder").addClass("normal"),e.find(".preview-btn-icon").text("预订"),e.find(".preview-btn").attr({title:"点击预订",eid:"click/program/book",eid_desc:"点击/节目/预约"})},change:function(e,i){var t=this;function a(){var e=i.parents(".preview-item"),t=$('<i class="prview-cancel-tip">已取消</i>').appendTo(i),a=setTimeout((function(){t.animate({opacity:0},(function(){t.remove(),clearTimeout(a)}))}),1e3);this.btnStatus(e)}this.parentSub.getData(this.parentSub.ajaxObj.subscribeUrl,{eid:e,subscribe:0,uid:this.parentSub.yyUid},(function(e){0==e.status&&a.call(t)}))}},s.init=function(e){new a({elementId:"#js-preview-box",respondFn:e})},i.a=s},478:function(module,exports){module.exports=function anonymous(locals,escapeFn,include,rethrow){rethrow=rethrow||function(e,i,t,a,n){var r=i.split("\n"),s=Math.max(a-3,0),l=Math.min(r.length,a+3),p=n(t),c=r.slice(s,l).map((function(e,i){var t=i+s+1;return(t==a?" >> ":"    ")+t+"| "+e})).join("\n");throw e.path=p,e.message=(p||"ejs")+":"+a+"\n"+c+"\n\n"+e.message,e},escapeFn=escapeFn||function(e){return null==e?"":String(e).replace(_MATCH_HTML,encode_char)};var _ENCODE_HTML_RULES={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},_MATCH_HTML=/[&<>'"]/g;function encode_char(e){return _ENCODE_HTML_RULES[e]||e}var __line=1,__lines='<% if(obj){ %>\n    <ul class="preview-list">\x3c!--  li 有 normal isOrder isLive 三种类，liveState有三种0，1，2状态,对应未开播,正在开播，停播  --\x3e\n        <%\n        var obj = obj.splice(0, 10);\n        for( var key = 0; key<obj.length; key++){\n            var value = obj[key];\n\n            var liveStateClass = \'normal\';\n            var previewText = \'预订\';\n            \n            if(value[\'liveState\'] == 1){\n                liveStateClass =\'isLive\';\n                previewText = \'看直播\';\n            }\n\n            var url = value[\'clickUrl\'] ? value[\'clickUrl\'] : (\'https://hdpage.huya.com/live/webMainActivity/index?id=\' + value[\'eventId\']);\n            var roomUrl = (TT.app.main + TT.createRoomHost(value["privateHost"], value["profileRoom"], value["yyid"]));\n        %>\n        <li class="preview-item <%= liveStateClass %> <% if(key == 0){ %> on preview-item-first <% } %> " data-event-id="<%= value[\'eventId\'] %>" data-url="<%= url %>">\n            <i class="preview-line"></i>\n            <i class="preview-circle"></i>\n            <div class="preview-main">\n                <p class="preview-text">\n                    <span class="preview-time">\n                        <%= value[\'liveState\'] == 1 ? \'正在直播\' : formatTime(value[\'upTime\']) %>\n                    </span>\n                    <a class="preview-link clickstat" target="_blank" href="<%= value[\'liveState\'] == 1 ? roomUrl : url %>" eid="click/program/<%= value[\'eventId\'] %>" eid_desc="点击/节目/节目<%= value[\'eventId\'] %>"><%= HUYA_UTIL.unescape(HUYA_UTIL.unescape(value[\'title\'])) %></a>\n                </p>\n                <div class="preview-pic-box clearfix">\n                    <a class="preview-pic-link clickstat" target="_blank" href="<%= value[\'liveState\'] == 1 ? roomUrl : url %>" eid="click/program/<%= value[\'eventId\'] %>" eid_desc="点击/节目/节目<%= value[\'eventId\'] %>">\n                        <img data-original="<%= TT.trimUrl(value[\'picUrl\']) %>" src="//a.msstatic.com/huya/main/assets/img/default/195x70.jpg" data-default-img="195x70" alt="<%= value[\'title\'] %>预告">\n                    </a>\n                    <a class="preview-btn clickstat" data-event-id="<%= value[\'eventId\'] %>" <% if(value[\'liveState\'] == 1 ){ %> target="_blank" href="<%= roomUrl %>" eid="click/program/<%= value[\'eventId\'] %>" eid_desc="点击/节目/节目<%= value[\'eventId\'] %>" <% }else{  %>  eid="click/program/book" eid_desc="点击/节目/预约" title="点击预订"  <% } %>>\n                        <span class="preview-btn-icon"><%= previewText %></span>\n                    </a>\n                </div>\n            </div>\n            <% if(value[\'digest\']){ %>\n            <textarea class="preview-digest-textarea"><%= value[\'digest\'] %></textarea>\n            <% } %>\n        </li>\n        <% } %>\n    </ul>\n<% } %>',__filename="widget/program-preview/program-preview.tmpl";try{var __output="";function __append(e){null!=e&&(__output+=e)}with(locals||{})if(obj){__append('\n    <ul class="preview-list">\x3c!--  li 有 normal isOrder isLive 三种类，liveState有三种0，1，2状态,对应未开播,正在开播，停播  --\x3e\n        '),__line=3;for(var obj=obj.splice(0,10),key=0;key<obj.length;key++){var value=obj[key],liveStateClass="normal",previewText="预订";1==value.liveState&&(liveStateClass="isLive",previewText="看直播");var url=value.clickUrl?value.clickUrl:"https://hdpage.huya.com/live/webMainActivity/index?id="+value.eventId,roomUrl=TT.app.main+TT.createRoomHost(value.privateHost,value.profileRoom,value.yyid);__line=18,__append('\n        <li class="preview-item '),__line=19,__append(escapeFn(liveStateClass)),__append(" "),0==key&&__append(" on preview-item-first "),__append(' " data-event-id="'),__append(escapeFn(value.eventId)),__append('" data-url="'),__append(escapeFn(url)),__append('">\n            <i class="preview-line"></i>\n            <i class="preview-circle"></i>\n            <div class="preview-main">\n                <p class="preview-text">\n                    <span class="preview-time">\n                        '),__line=25,__append(escapeFn(1==value.liveState?"正在直播":formatTime(value.upTime))),__append('\n                    </span>\n                    <a class="preview-link clickstat" target="_blank" href="'),__line=27,__append(escapeFn(1==value.liveState?roomUrl:url)),__append('" eid="click/program/'),__append(escapeFn(value.eventId)),__append('" eid_desc="点击/节目/节目'),__append(escapeFn(value.eventId)),__append('">'),__append(escapeFn(HUYA_UTIL.unescape(HUYA_UTIL.unescape(value.title)))),__append('</a>\n                </p>\n                <div class="preview-pic-box clearfix">\n                    <a class="preview-pic-link clickstat" target="_blank" href="'),__line=30,__append(escapeFn(1==value.liveState?roomUrl:url)),__append('" eid="click/program/'),__append(escapeFn(value.eventId)),__append('" eid_desc="点击/节目/节目'),__append(escapeFn(value.eventId)),__append('">\n                        <img data-original="'),__line=31,__append(escapeFn(TT.trimUrl(value.picUrl))),__append('" src="//a.msstatic.com/huya/main/assets/img/default/195x70.jpg" data-default-img="195x70" alt="'),__append(escapeFn(value.title)),__append('预告">\n                    </a>\n                    <a class="preview-btn clickstat" data-event-id="'),__line=33,__append(escapeFn(value.eventId)),__append('" '),1==value.liveState?(__append(' target="_blank" href="'),__append(escapeFn(roomUrl)),__append('" eid="click/program/'),__append(escapeFn(value.eventId)),__append('" eid_desc="点击/节目/节目'),__append(escapeFn(value.eventId)),__append('" ')):__append('  eid="click/program/book" eid_desc="点击/节目/预约" title="点击预订"  '),__append('>\n                        <span class="preview-btn-icon">'),__line=34,__append(escapeFn(previewText)),__append("</span>\n                    </a>\n                </div>\n            </div>\n            "),__line=38,value.digest&&(__append('\n            <textarea class="preview-digest-textarea">'),__line=39,__append(escapeFn(value.digest)),__append("</textarea>\n            "),__line=40),__append("\n        </li>\n        "),__line=42}__append("\n    </ul>\n"),__line=44}return __output}catch(e){rethrow(e,__lines,__filename,__line,escapeFn)}}}}]);