!function(){"use strict";function r(t,i,n){this.i=t,this.n=i,this.o=n,this.type="browser"}var e=[["edge",/Edge\/([0-9._]+)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9.]+)(?:\s|$)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["safari",/Version\/([0-9\._]+).*Safari/]],n=function(t){var n,s,i=(s=null,(n=t)&&e.some(function(t){var i=t[0];return!!(t=t[1].exec(n))&&(s=[i,t],!0)}),s);if(!i)return null;var h=i[0];return(i=(t=i[1])[1]&&t[1].split(/[._]/).slice(0,3))?i.length<3&&(i=i.concat(function(t){for(var i=[],n=0;n<t;n++)i.push("0");return i}(3-i.length))):i=[],t=i.join("."),new r(h,t,i)}(navigator.userAgent),h={n:"1.0.3",c:n,f:"https:"===location.protocol,a:location.protocol,l:navigator.userAgent,p:"undefined"!=typeof window&&"undefined"!=typeof document&&"undefined"!=typeof navigator,d:function(){try{return"function"==typeof fetch&&"function"==typeof Response&&Response.prototype.hasOwnProperty("body")&&"function"==typeof ReadableStream&&ReadableStream.prototype.hasOwnProperty("getReader")}catch(t){return!1}}(),y:function(){try{var t=new XMLHttpRequest;t.open("GET","https://example.com",!0);var i="arraybuffer";return t.responseType=i,t.responseType===i&&"function"==typeof t.setRequestHeader&&"function"==typeof t.getResponseHeader&&"function"==typeof t.getAllResponseHeaders}catch(t){return!1}}(),m:function(){if(n&&"firefox"===n.i&&Number(n.o[0])<68)try{var t=new XMLHttpRequest;t.open("GET","https://example.com",!0);var i="moz-chunked-arraybuffer";return t.responseType=i,t.responseType===i}catch(t){return!1}return!1}(),w:function(){try{return"function"==typeof Uint8Array&&"function"==typeof Uint8Array.prototype.set&&"function"==typeof Uint8Array.prototype.subarray}catch(t){return!1}}(),_:function(){try{return"function"==typeof AbortController&&"function"==typeof AbortSignal&&"function"==typeof Request&&Request.prototype.hasOwnProperty("signal")}catch(t){return!1}}(),O:function(){try{return"function"==typeof Promise&&"function"==typeof Promise.resolve}catch(t){return!1}}()},t="xy.cdn.huya.com",i="sdk1xyajs-data.xycdn.com";function o(t){return"number"==typeof t}function u(t,i){return void 0===i&&(i=0),i=Math.pow(10,i),Math.round(t*i)/i}function s(t,i){void 0===i&&(i=1e3),this.S={},this.g=t,this.M=i}function c(t){this.R=0,this.x=0,this.T=0,this.A=0,this.D=0,this.L=0,this.N=t}function f(){this.P={}}function a(t){this.j=new s(5,200),this.k=0,this.H=new v,this.J={},this.q=[],this.U=0,this.X=Date.now(),this.C=0,this.G=0,this.F=!1,this.I=2800,this.$=1800,this.z=t.media||t.video||t.audio,this.B=!!t.withCredentials,this.V=t.mediaType,this.W=this.Y(t.url),t=h.n.split("-")[0],this.K="hhl_"+t,this.Q="xyvp_cfg_hhl",this.Z=l(),this.tt()}s.prototype.nt=function(t){var i=Math.floor(Date.now()/this.M);this.st(i),this.S[i]+=t},s.prototype.ht=function(){var i=this,n=Math.floor(Date.now()/this.M);this.st(n);var s=0,h=0;return Object.keys(this.S).forEach(function(t){Number(t)!==n&&(s+=i.S[t],h++)}),0===h?0:s/h*(1e3/this.M)},s.prototype.st=function(i){var n=this;Object.keys(this.S).forEach(function(t){Number(t)+n.g<=i&&delete n.S[t]});for(var t=i;t>i-this.g;t--)void 0===this.S[t]&&(this.S[t]=0)},c.prototype.rt=function(t){var i=this.N.ot;if(0===i||1===i||2===i)return t.ut;if(3===i||4===i)return t.ct;switch(this.L){case 0:return t.ct;case 104:case 109:return t.ft;case 7:case 8:case 9:case 101:case 105:case 106:case 112:case 6:return t.at;default:return t.vt}},c.prototype.lt=function(){var t=Math.round(this.T-this.R);return this.R=this.T,t},c.prototype.dt=function(){var t=Math.round(this.A-this.x);return this.x=this.A,t},c.prototype.yt=function(){this.mt=Date.now(),this.wt=void 0,this.D=0,this._t=void 0,this.L=0},c.prototype.bt=function(t,i){var n=Date.now();this.D=t,this._t=i,this.mt&&(this.A+=n-this.mt),this.wt=n},c.prototype.Ot=function(){var t=Date.now();this.wt&&(this.A+=t-this.wt),this.wt=t},c.prototype.St=function(t){this.T+=t.length},c.prototype.gt=function(t){this.Mt=t},f.prototype.set=function(t,i){this.P[t]=i},f.prototype.get=function(t){return this.P[t]},f.prototype.has=function(t){return t in this.P},f.prototype.remove=function(t){delete this.P[t]},f.prototype.clear=function(){for(var t=Object.keys(this.P),i=t.length;i--;)this.remove(t[i])},f.prototype.forEach=function(t){for(var i=Object.keys(this.P),n=0,s=i.length;n<s;n++){var h=i[n];t(this.P[h],h)}},f.prototype.size=function(){return Object.keys(this.P).length};var v=function(t){function i(){t.apply(this,arguments)}return t&&(i.__proto__=t),((i.prototype=Object.create(t&&t.prototype)).constructor=i).prototype.Rt=function(){var i=[];return this.forEach(function(t){2===t.ot&&i.push(t)}),i},i.prototype.xt=function(){var i=[];return this.forEach(function(t){3!==t.ot&&4!==t.ot||i.push(t)}),i},i}(f),l=function(){for(var t="",i=1;i<=32;i++)t+=Math.floor(16*Math.random()).toString(16),8!==i&&12!==i&&16!==i&&20!==i||(t+="-");return t};function p(t,i,n){void 0===n&&(n=!1),this.Tt=0,this.At=!1,this.Et=0,this.Dt=t,this.Lt=i,this.At=n}function d(t){var n=this;this.Nt=0,this.Pt=0,this.jt=0,this.kt=0,this.Ht=0,this.Jt=[],this.qt=[],this.Ut=0,this.Xt=!1,this.Ct=Date.now(),this.Gt=!0,this.Ft=t,this.Ft.gt=function(t,i){n.It(i)},this.$t=p.At(50,this.zt.bind(this))}a.prototype.Y=function(t){if(!t)return t;var i=new URL(t),n="",s=i.searchParams.get("ratio");return s&&(n+="_ratio="+s),(t=i.searchParams.get("codec"))&&(n+="_codec="+t),i.pathname=i.pathname.replace(".flv",n+".flv"),i.toString()},a.prototype.Bt=function(t){localStorage.setItem(this.Q,JSON.stringify(t))},a.prototype.tt=function(){var t,i=localStorage.getItem(this.Q);if(i){try{t=JSON.parse(i)}catch(t){return}this.Vt(t)}},a.prototype.Vt=function(t){var i;t&&(i=t.requestTimeout,t=t.receiveTimeout,o(i)&&500<i&&(this.I=i),o(t)&&500<t&&(this.$=t))},a.prototype.Wt=function(){return this.z?u(this.z.duration,6):0},a.prototype.Yt=function(){if(!this.z)return 0;var t=this.z.buffered,i=this.z.currentTime||.2;try{for(var n=0,s=t.length;n<s;n++)if(i>=t.start(n)&&i<t.end(n))return u(t.end(n)-i,6)}catch(t){}return 0},a.prototype.Kt=function(t){if(!this.z)return 0;for(var i=this.z.buffered,n=0,s=i.length;n<s;n++)if(t>=i.start(n)&&t<i.end(n))return i.end(n);return 0},a.prototype.Qt=function(){return this.z?u(this.z.currentTime,6):0},a.prototype.Zt=function(){return this.z?this.ti(this.z.buffered):""},a.prototype.ii=function(){return!!this.z&&this.z.seeking},a.prototype.ni=function(){return!!this.z&&this.z.paused&&1<this.z.readyState},a.prototype.si=function(){return!!this.z&&this.z.ended},a.prototype.hi=function(t){if(!this.z)return!1;for(var i=this.z.buffered,n=0;n<i.length;n++)if(t>=i.start(n)&&t<i.end(n))return!0;return!1},a.prototype.ti=function(t){for(var i=[],n=0,s=t.length;n<s;n++){var h=u(t.start(n),6),r=u(t.end(n),6);i.push(h+"~"+r)}return i.toString()},a.prototype.ri=function(t){return t.toJSON=function(){return{stack:this.stack,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,code:this.code}},t},a.prototype.ei=function(){this.H.clear()},p.At=function(t,i){return new p(t,i,!0)},p.prototype.oi=function(){return 0!==this.Tt},p.prototype.ui=function(){var t=this;this.Tt=setTimeout(function(){t.Et+=1,"function"==typeof t.Lt&&t.Lt(),0!==t.Tt&&(t.Tt=0,t.At&&t.ui())},this.Dt)},p.prototype.fi=function(){this.oi()||this.ui()},p.prototype.ai=function(){clearTimeout(this.Tt),this.Tt=0};var y=h.a+"//"+i+"/o_live_h5sdk";function m(t){this.Ft=t,this.vi=new d(t),this.vi.li()}function w(t){var i=this;this.Ft=t,this.di=null,this.$t=p.At(15e3,this.yi.bind(this));var n=new XMLHttpRequest;n.onerror=function(){i.mi("network error")},n.ontimeout=function(){i.mi("timeout 8000")},n.onload=function(){if(200===n.status){var t={};try{t=JSON.parse(n.response)}catch(t){return void i.mi(t.toString())}i.wi(t)}else i.mi("unexpect http status: "+n.status)},this._i=n,this.Gt=!0,this.bi=!1}d.prototype.ei=function(){this.Oi(),this.$t.ai(),this.Gt=!0},d.prototype.fi=function(){this.Gt=!1,this.$t.oi()||this.$t.fi()},d.prototype.ai=function(){this.Oi(),this.Gt=!0},d.prototype.Si=function(t){this.Xt=!1,this.Ft.G+=t-Math.max(this.Ht,this.kt)},d.prototype.gi=function(t){this.Xt=!0,this.Ht=t,this.Ft.C+=1},d.prototype.li=function(){var t=this.Mi("one"),i={se:~~h.p,fs:~~h.d,xa:~~h.y,mc:~~h.m,ta:~~h.w,as:~~h._,pm:~~h.O},i={ls:"init",ci:JSON.stringify(i),b:h.c?h.c.i:void 0,bv:h.c?h.c.n:void 0};this.Ri(y,this.xi(t,i))},d.prototype.It=function(t){var i=this.Mi("one"),t={ls:"err",et:t.type,e:t.error,cr:t.reason,ee:t.extra,pn:t.target};this.Ri(y,this.xi(i,t))},d.prototype.zt=function(){var t=this.Ft,i=this.$t.Et;i%3==0&&this.Ti(),i%20==0&&(this.Jt.push(1e3*t.Yt()),this.qt.push(t.j.ht())),i%300==0&&this.Oi()},d.prototype.Ti=function(){var t=this.Ft,i=t.Qt();0<i&&i===this.Ut&&t.F&&!t.ni()&&!t.ii()&&t.Yt()<4?!1===this.Xt&&this.gi(Date.now()):!0===this.Xt&&this.Si(Date.now()),this.Ut=i},d.prototype.Ai=function(t){return{h:t.Ei,s:t.ot,b:t.Di.T,t:t.Di.A,r:t.Di.L}},d.prototype.Oi=function(){var t,i,n,s,h,r,e,o,u,c=this;this.Gt||(u=this.Ft,(o=Date.now())-this.Ct<1e3||(this.Ct=o,(t=u.U-this.jt)<0&&(t=0),this.Xt&&(u.G+=o-Math.max(this.Ht,this.kt)),i=u.C-this.Pt,n=u.G-this.Nt,this.Pt=u.C,this.Nt=u.G,this.jt=u.U,this.kt=o,0===this.Jt.length&&this.Jt.push(1e3*u.Yt()),s=this.Li(),h=this.Ni(s),this.Jt=[],0===this.qt.length&&this.qt.push(u.j.ht()),r=this.Pi(),this.qt=[],0!==t&&(e=[],u.H.forEach(function(t){return e.push(c.Ai(t))}),u.q.forEach(function(t){return e.push(c.Ai(t))}),u.q=[],o=this.Mi("cycle"),u={it:n,ic:i,db:t,bla:s,bld:h,spa:r,pt:u.Qt(),ps:JSON.stringify(e)},this.Ri(y,this.xi(o,u)))))},d.prototype.Ri=function(t,i){var n=new XMLHttpRequest;n.open("POST",t,!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.send(i)},d.prototype.Mi=function(t){var i=this.Ft;return{act:t,v:h.n,ua:h.l,pi:i.Z,u:i.W?i.W.split("?")[0]:""}},d.prototype.xi=function(t,i){return this.ji(t)+"&"+this.ji(i)},d.prototype.ji=function(n){var s=[];return Object.keys(n).forEach(function(t){var i=n[t];"string"!=typeof i&&"number"!=typeof i||s.push(t+"="+encodeURIComponent(i))}),s.join("&")},d.prototype.Li=function(){var t=this.Jt,i=t.length;if(0===i)return 0;var n=0;return t.forEach(function(t){n+=t}),Math.floor(n/i)},d.prototype.Ni=function(i){var t=this.Jt,n=t.length;if(0===n)return 0;var s=0;return t.forEach(function(t){s+=Math.abs(t-i)*Math.abs(t-i)}),Math.floor(Math.sqrt(s/n))},d.prototype.Pi=function(){var t=this.qt,i=t.length;if(0===i)return 0;var n=0;return t.forEach(function(t){n+=t}),Math.floor(n/i)},m.prototype.ei=function(){this.vi.ei(),this.ki()},m.prototype.Hi=function(){this.Ji(),this.vi.fi()},m.prototype.qi=function(){this.vi.ai(),this.ki()},m.prototype.Ji=function(){var t=this.Ft.z;t&&(t.addEventListener("error",this.gt=this.gt.bind(this)),t.addEventListener("timeupdate",this.Ui=this.Ui.bind(this)))},m.prototype.ki=function(){var t=this.Ft.z;t&&(t.removeEventListener("error",this.gt),t.removeEventListener("timeupdate",this.Ui))},m.prototype.gt=function(){var t=this.Ft,i=t.z;i&&i.error?t.gt(this,{type:"forbidden",error:"media error",extra:i.error.code+", "+i.error.message}):t.gt(this,{type:"forbidden",error:"media error"})},m.prototype.Ui=function(){this.Ft.F=!0};var _=h.a+"//"+t+"/h5huya/getseeds";function b(t,i){this.message=t,this.status=i,this.name="ResponseStatusError"}w.prototype.ei=function(){this.di=null,this.Gt=!0,this.bi=!1,this.$t.ai(),this._i.abort()},w.prototype.fi=function(){this.Gt=!1,this.$t.oi()||(this.yi(),this.$t.fi())},w.prototype.ai=function(){this.Gt=!0},w.prototype.yi=function(){var t,i;this.Gt||this.bi||this.Ft.ni()||this.Ft.si()||(t={id:this.Ft.Z,url:this.Ft.W,version:h.n,protocol:h.a.split(":")[0],peer_status:this.Xi()},this.bi=!0,(i=this._i).open("POST",_,!0),i.timeout=8e3,i.send(JSON.stringify(t)))},w.prototype.mi=function(t,i){this.bi=!1,this.Ft.gt(this,{type:"request dispatcher",error:t,extra:i})},w.prototype.wi=function(t){var i=this.bi=!1,n=[];t&&(3===t.Cmd&&(i=!0),(t=t[h.a.split(":")[0]])&&t.forEach(function(t){n.push({Ei:t.hostname,Ci:t.type,Gi:t.peerIp,Fi:t.ossPort,W:h.a+"//"+t.addr})})),this.di&&this.di(n,i)},w.prototype.Xi=function(){var n=this.Ft,s=[];return n.H.forEach(function(t){var i={hostname:t.Ei,type:t.Ci,peerIp:t.Gi,ossPort:t.Fi,traffic:t.Di.lt(),period:t.Di.dt(),status:t.Di.rt(w.Ii),reason:t.Di.L};s.push(i),5===t.ot&&(n.H.remove(t.Ei),n.q.push(t))}),s},w.Ii={ut:0,ct:1,ft:2,at:4,vt:10},(i=function(){this.$i={}}).prototype.addListener=function(t,i){if("function"!=typeof i)throw new TypeError('The "listener" argument must be of type Function.');void 0===this.$i[t]&&(this.$i[t]=[]),this.$i[t].push(i)},i.prototype.emit=function(t){for(var i=[],n=arguments.length-1;0<n--;)i[n]=arguments[n+1];var s=this.$i[t];if(s&&0!==s.length)for(var h=0,r=s.length;h<r;h++)s[h].apply(this,i)},i.prototype.removeListener=function(t,i){if("function"!=typeof i)throw new TypeError('The "listener" argument must be of type Function.');var n=this.$i[t];n&&(n.splice(n.indexOf(i),1),0===n.length&&delete this.$i[t])},i.prototype.removeAllListeners=function(t){t?delete this.$i[t]:this.$i={}},i.prototype.on=function(t,i){this.addListener(t,i)},i.prototype.off=function(t,i){t?i?this.removeListener(t,i):this.removeAllListeners(t):this.removeAllListeners()},(t=function(t,i){this.Bi=!1,this.bt=null,this.Ot=null,this.St=null,this.Vi=null,this.gt=null,this.Ft=t,this.W=i}).prototype.zi=function(){this.bt=null,this.St=null,this.Vi=null,this.gt=null};var O=function(n){function t(t,i){n.call(this,t,i),this.Wi=null,t.k=1}return n&&(t.__proto__=n),((t.prototype=Object.create(n&&n.prototype)).constructor=t).prototype.Yi=function(){var t,i,s=this;this.Bi||(t={method:"GET",mode:"cors",redirect:"follow",referrerPolicy:"no-referrer-when-downgrade"},this.Ft.B&&(t.credentials="include"),h._&&(this.Ki=new AbortController,(i=this.Ki.signal).onabort=function(){s.Qi&&s.Qi()},t.signal=i),fetch(this.W,t).then(function(t){if(s.Wi=t.body&&t.body.getReader(),s.Bi)s.Zi();else{var n;if(s.bt&&(n={},t.headers.forEach(function(t,i){n[i.toLowerCase()]=t}),s.bt(t.status,t.statusText,n)),!s.Wi)throw new ReferenceError("body is "+t.body+", reader is "+s.Wi);s.tn()}}).catch(function(t){s.mi(t)}))},t.prototype.in=function(){var i=this;this.Bi=!0,this.zi();var t=new Promise(function(t){return i.Qi=t});return this.Ki?this.Ki.abort():this.Zi(),t},t.prototype.Zi=function(){var t=this;this.Wi&&this.Wi.cancel().then(function(){t.Qi&&t.Qi()}).catch(function(){})},t.prototype.mi=function(t){this.Bi||"AbortError"===t.name||this.gt&&this.gt(t)},t.prototype.tn=function(){var i=this;this.Wi&&this.Wi.read().then(function(t){if(!i.Bi){if(t.done)return i.Vi&&i.Vi(),void i.zi();i.Ot&&i.Ot(),i.St&&i.St(t.value),i.tn()}}).catch(function(t){i.mi(t)})},t}(t),S=function(n){function t(t,i){n.call(this,t,i),this._i=new XMLHttpRequest,t.k=2}return n&&(t.__proto__=n),((t.prototype=Object.create(n&&n.prototype)).constructor=t).prototype.Yi=function(){var t,h=this;this.Bi||((t=this._i).open("GET",this.W,!0),t.responseType="moz-chunked-arraybuffer",this.Ft.B&&(t.withCredentials=!0),t.onreadystatechange=function(t){var n,i=t.target;if(2===i.readyState&&h.bt){var s=(t=i.getAllResponseHeaders(),n={},t&&t.trim().split(/[\r\n]+/).forEach(function(t){var i=t.split(":");(t=i.shift())&&(i=i.join(":").trim(),n[t.trim().toLowerCase()]=i)}),n);try{h.bt(i.status,i.statusText,s)}catch(t){h.gt&&h.gt(t)}}},t.onprogress=function(t){t=t.target,h.Ot&&h.Ot(),h.St&&h.St(new Uint8Array(t.response))},t.onerror=function(){h.gt&&h.gt(new TypeError("XHR error"))},t.onload=function(){h.Vi&&h.Vi(),h.zi()},t.send())},t.prototype.in=function(){this.Bi=!0,this.zi();var t=this._i;return t.onreadystatechange=null,t.onprogress=null,t.onerror=null,t.onload=null,t.abort(),Promise.resolve()},t}(t);function g(t){this.message=t,this.name="ResponseHeaderError"}function M(t,i){this.message=t,this.externalError=i,this.name="ExternalError"}function R(t,i,n){var s=this;void 0===i&&(i=3),void 0===n&&(n=5e3),this.nn=0,this.Ft=t,this.sn=i,this.hn=n,this.$t=new p(this.hn,this.rn.bind(this));var h=new XMLHttpRequest;h.onerror=function(){s.mi("network error")},h.ontimeout=function(){s.mi("timeout 8000")},h.onload=function(){if(200===h.status){var t={};try{t=JSON.parse(h.response)}catch(t){return void s.mi(t+"")}s.wi(t)}else s.mi("unexpect http status: "+h.status)},this._i=h,this.en=T+"?version="+t.K}b.prototype.toString=function(){return this.name+": "+this.message},g.prototype.toString=function(){return this.name+": "+this.message},M.prototype.toString=function(){return this.name+": "+this.message+". "+JSON.stringify(this.externalError)};var x=function(n){function t(t,i){n.call(this),this.Ft=i,this.ot=0,this.W=t.W,this.Ei=t.Ei,this.Ci=t.Ci,this.Gi=t.Gi,this.Fi=t.Fi,this.Di=new c(this),this.un=null}return n&&(t.__proto__=n),((t.prototype=Object.create(n&&n.prototype)).constructor=t).prototype.Hi=function(){0===this.ot&&(this.ot=2)},t.prototype.Yi=function(){var t,i;2===this.ot&&(t=this.Ft,i=this.cn(this.W),(i=new(h.m?S:O)(t,i)).bt=this.bt.bind(this),i.Ot=this.Ot.bind(this),i.St=this.St.bind(this),i.Vi=this.Vi.bind(this),i.gt=this.gt.bind(this),i.Yi(),this.un=i,this.ot=3,this.Di.yt())},t.prototype.in=function(t){void 0===t&&(t=0);var i=this.ot;3!==i&&4!==i||(this.Di.L=t,this.fn(),this.zi(),this.ot=2)},t.prototype.qi=function(t){void 0===t&&(t=0),5!==this.ot&&(this.Di.L=t,this.fn(),this.zi(),this.ot=5)},t.prototype.fn=function(){var t,i,n=this.Di,s=this.Ft;0!==n.L&&(3!==this.ot&&4!==this.ot||(t="",i="state: "+this.ot+", status: "+n.D+", headers: "+JSON.stringify(n._t),this.un&&(i=i+", url: "+this.un.W),n.Mt&&(t=n.Mt+"",i="details: "+JSON.stringify(n.Mt)+", "+i),s.gt(this,{type:"pipe abort",error:t,reason:n.L,extra:i,target:this.Ei})))},t.prototype.zi=function(){var t=this;this.un&&(this.un.in().then(function(){t.un||t.emit("0",{an:"2",vn:t})}),this.un=null)},t.prototype.bt=function(t,i,n){if(3===this.ot&&this.un){if(this.Di.bt(t,n),t<200||299<t&&304!==t)throw new b(t+" "+i,t);this.ot=4,this.emit("0",{an:"11",vn:this})}},t.prototype.Ot=function(){4===this.ot&&this.un&&this.Di.Ot()},t.prototype.St=function(t){4===this.ot&&this.un&&(this.Di.St(t),this.emit("0",{ln:t,an:"9",vn:this}))},t.prototype.Vi=function(){4===this.ot&&this.un&&(this.ot=2,this.un=null,this.emit("0",{an:"10",vn:this}))},t.prototype.gt=function(t){var i;3!==this.ot&&4!==this.ot||!this.un||(this.Di.gt(this.Ft.ri(t)),i=0,t instanceof M?i=120:t instanceof b?i=105:t instanceof g?i=106:3===this.ot?i=101:4===this.ot&&(i=100),this.qi(i))},t.prototype.cn=function(t){var i=this.Ft.dn;return void 0===i?t:((t=new URL(t)).searchParams.set("xy_dts",i+""),t.toString())},t}(i),T=h.a+"//h5conf-open.xycdn.com/psdk_param";function A(t){this.Ft=t,this.St=null,this.Vi=null,this.yn=null,this.mn=null,this.wn=null,this._n=new w(t),this._n.di=this.di.bind(this),this.$t=p.At(200,this.zt.bind(this)),this.Gt=!0,this.bn=new R(t),this.bn.rn()}R.prototype.mi=function(t){this.Ft.gt(this,{type:"load config",error:t,extra:"count: "+this.nn}),this.nn<this.sn&&(this.nn+=1,this.$t.fi())},R.prototype.wi=function(t){this.Ft.Bt(t)},R.prototype.rn=function(){if("watch"!==this.Ft.V){var t=this._i;try{t.open("GET",this.en,!0),t.timeout=8e3,t.send()}catch(t){this.mi(t.toString())}}},R.prototype.ei=function(){this.$t.ai(),this._i.abort(),this.nn=0},A.prototype.ei=function(){this.St=null,this.Vi=null,this.yn=null,this.mn=null,this.wn=null,this.Gt=!0,this.$t.ai(),this.bn.ei(),this._n.ei(),this.Ft.H.forEach(function(t){return t.qi()})},A.prototype.Hi=function(){this.Ft,this.Gt=!1,this.Yi(),this.$t.fi()},A.prototype.qi=function(){this.Gt=!0,this.$t.ai(),this.Ft.H.forEach(function(t){return t.qi()})},A.prototype.fi=function(){this._n.fi()},A.prototype.ai=function(){this._n.ai()},A.prototype.zt=function(){this.Yi(),this.On()},A.prototype.On=function(){var i=this;this.Ft.H.forEach(function(t){return i.Sn(t)})},A.prototype.Sn=function(t){var i,n=Date.now(),s=this.Ft;3===t.ot?((i=t.Di.mt)?n-i:0)>=s.I&&t.qi(7):4!==t.ot||((i=t.Di.wt)?n-i:0)>=s.$&&t.qi(104)},A.prototype.Yi=function(){this.gn()},A.prototype.gn=function(){var t=this.Ft,i=[],n=!1;t.H.forEach(function(t){2===t.ot?i.push(t):3!==t.ot&&4!==t.ot||(n=!0)}),0!==i.length&&(n||this.Mn(i[0]))},A.prototype.Mn=function(t){2===t.ot&&t.Yi()},A.prototype.di=function(t,i){var n=this,s=this.Ft;i?s.H.forEach(function(t){4===t.ot&&(t.qi(113),n.wn&&n.wn())}):(t.forEach(function(t){var i;s.H.has(t.Ei)?s.H.get(t.Ei).W=t.W:((i=new x(t,s)).on("0",n.Rn.bind(n)),s.H.set(t.Ei,i),t.Ei in s.J?i.qi(s.J[t.Ei]):i.Hi())}),t=s.H.Rt(),0===s.H.xt().length&&0<t.length&&this.yn&&this.yn())},A.prototype.xn=function(){var i=this.Ft;try{this.Vi&&this.Vi()}catch(t){throw new M("catch an error when execute onEnd",i.ri(t))}},A.prototype.Tn=function(t){var i=this.Ft;try{this.St&&this.St(t)}catch(t){throw new M("catch an error when execute onData",i.ri(t))}},A.prototype.Rn=function(t){switch(t.an){case"9":this.An(t);break;case"10":this.En(t);break;case"11":this.Dn(t);break;case"2":this.Ln(t)}},A.prototype.Dn=function(t){},A.prototype.An=function(t){var i=this.Ft,n=(t.vn,t.ln.length);i.j.nt(n),i.U+=n,this.Tn(t.ln)},A.prototype.En=function(t){t=t.vn,this.xn(),this.Ft.Nn({event:"LOAD_STOP",status:t.Di.D||-1,message:t.Di.L})},A.prototype.Ln=function(t){var i;this.Gt||(t=100!==(t=(i=t.vn).Di.L)&&104!==t&&120!==t?"LOAD_FAIL":"LOAD_STOP",this.Ft.Nn({event:t,status:i.Di.D,message:i.Di.L}))};var E=function(s){function t(t){var i=this;void 0===t&&(t={}),s.call(this),this.readyState=0;var n=this.Ft=new a(t);n.Nn=function(t){n.gt(i,{type:"failed",error:"status: "+t.status,reason:t.message,extra:Date.now()-n.X+"ms after init"}),i.close(),i.emit(t.event,{status:t.status,message:t.message})},this.Pn=new m(n),(t=this.jn=new A(n)).St=function(t){i.emit("DATA",t.buffer)},t.Vi=function(){i.readyState=0},t.yn=function(){i.emit("GATHER_SUC")},t.mn=function(){i.emit("GATHER_FAIL")},t.wn=function(){i.close(),i.emit("LOAD_STOP",{status:-2,message:"temporarily closed"})}}return s&&(t.__proto__=s),((t.prototype=Object.create(s&&s.prototype)).constructor=t).isSupported=function(){return h.p&&h.w&&(h.d||h.m)},t.version=function(){return h.n},t.prototype.setConfig=function(t){var i,n;2!==this.readyState&&(i=this.Ft,(n=t.media||t.video||t.audio)instanceof HTMLMediaElement&&(i.z=n),t.url&&(i.W=i.Y(t.url)),o(t.startDts)&&(i.dn=t.startDts))},t.prototype.start=function(){2!==this.readyState&&this.jn.fi()},t.prototype.stop=function(){2!==this.readyState&&this.jn.ai()},t.prototype.open=function(t){1!==this.readyState&&2!==this.readyState&&(this.readyState=1,this.Pn.Hi(),this.jn.Hi())},t.prototype.close=function(){0!==this.readyState&&2!==this.readyState&&(this.readyState=0,this.Pn.qi(),this.jn.qi())},t.prototype.dispose=function(){this.readyState=2,this.jn.ei(),this.Pn.ei(),this.Ft.ei()},t}(i);(i=function(t){this.kn=null;var i=this.kn=new E;this.on=this.kn.on.bind(i),this.off=this.kn.off.bind(i)}).prototype.setVideo=function(t){this.kn&&this.kn.setConfig({media:t})},i.prototype.startPeerGather=function(t){this.kn&&(this.kn.setConfig({url:t}),this.kn.start())},i.prototype.stopPeerGather=function(){this.kn&&this.kn.stop()},i.prototype.refreshUrl=function(t){this.kn&&t&&this.kn.setConfig({url:t})},i.prototype.startLoad=function(t,i){var n;this.kn&&(t&&(n={url:t},"object"==typeof(t=i)&&null!==t&&o(i.startDts)&&(n.startDts=i.startDts),this.kn.setConfig(n)),this.kn.open())},i.prototype.stopLoad=function(){this.kn&&this.kn.close()},i.prototype.destroy=function(){this.kn&&(this.kn.dispose(),this.kn=null)},window.xyvp={XYLive:E,Loader:i}}();