!function(e){var t={};function i(s){if(t[s])return t[s].exports;var r=t[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(s,r,function(t){return e[t]}.bind(null,r));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s="CvKd")}({"91eE":function(e,t){function i(e){return function(e){if(Array.isArray(e))return e}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return s(e,t)}(e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,s=new Array(t);i<t;i++)s[i]=e[i];return s}function r(){return(r="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var s=a(e,t);if(s){var r=Object.getOwnPropertyDescriptor(s,t);return r.get?r.get.call(arguments.length<3?e:i):r.value}}).apply(this,arguments)}function a(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=c(e)););return e}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&o(e,t)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,s=c(e);if(t){var r=c(this).constructor;i=Reflect.construct(s,arguments,r)}else i=s.apply(this,arguments);return l(this,i)}}function l(e,t){if(t&&("object"===_(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return d(e)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function m(e,t,i){return t&&f(e.prototype,t),i&&f(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function _(e){return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e){var t={};function i(s){if(t[s])return t[s].exports;var r=t[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==_(e)&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(s,r,function(t){return e[t]}.bind(null,r));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=38)}([function(e,t,i){"use strict";var s=i(10),r=i(5),a=i(2),n=99;function o(){return r.a.getDateTimeStr()+" "}var h=!1,u={_data:[],_length:0,debug:function(){var e=o(),t=Array.apply(null,arguments);t[0]=e+t[0],n<=-1&&console.log.apply(console,t)},log:function(e){var t=o(),i=Array.apply(null,arguments);i[0]=t+i[0],n<=0&&console.log.apply(console,i),u.record(i,"log")},info:function(e){var t=o(),i=Array.apply(null,arguments);i[0]=t+i[0],n<=1&&console.info.apply(console,i),u.record(i,"info")},warn:function(e){var t=o(),i=Array.apply(null,arguments);i[0]=t+i[0],n<=2&&console.warn.apply(console,i),u.record(i,"warn")},error:function(e){var t=o(),i=Array.apply(null,arguments);i[0]=t+i[0],n<=3&&console.error.apply(console,i),u.record(i,"error")},group:function(e){var t=o(),i=Array.apply(null,arguments);if(i[0]=t+i[0],n<=1){var s=console.groupCollapsed||console.group||console.log;s.apply(console,i)}u.record(i,"group")},groupEnd:function(){console.groupEnd&&console.groupEnd.apply(console)},setLevel:function(e){e!=n&&(console.log(o()+" set log level from "+n+" to "+e),n=e)},getLevel:function(){return n},record:function(e,t){var i=a.a.logMaxLen||1e3;u._length===i+100&&(u._data.splice(0,100),u._length=i);var s=0,r=(e.shift()||"").toString();for(r=r.replace(/\%c/gi,(function(e,t){return s++,""}));s--&&e.length;)e.shift();for(var n=0,o=e.length;n<o;n++)"object"==_(e[n])&&(e[n]="");e.unshift(r);var h=e.join(" ");u._length++,u._data.push("[".concat(t,"]").concat(h))},getLog:function(){return h||(h=!0,u._data.unshift(s.a.platform+" "+s.a.name+" "+s.a.version.string)),u._data},logcss:function(e,t,i){var s="font-weight:900";return e&&(s+=";color:"+e),t&&(s+=";background:"+t),i&&(s+=";border:3px solid "+i),s},padNum:function(e,t){var i=e.toString().length,s=Math.max(0,t-i);return"0".repeat(s)+e}};t.a=u},function(e,t,i){"use strict";t.a={KEY_VALUE:"value",KEY_STR:"str",KEY_DIM:"dim",K:"k",LIVE_TYPE:{FLV:0,P2P:1,HLS:2},HEART_TYPE:{START:0,CONTINUS:1,END:2},DIM_COM:{P2P:"p2p",OEXP:"oexp",STREAM_URL:"stream_url",CDNDOMAIN:"cdndomain",STREAM:"stream",CDNP_CONNECT_IP:"cdnp_connect_ip",CDNP_CONNECTED:"cdnp_connected",CDP_ID:"cdp_id",USER_WAN_IP:"user_wan_ip",VIDEO_LOGIN_FAIL:"video_login_fail",ORIGINAL_BITRATE:"original_bitrate",BROWSER_NAME:"browser_name",BROWSER_VERSION:"browser_version",BROWSER_KERNEL:"browser_kernel",BROWSER_KERNEL_VERSION:"browser_kernel_version",OS_NAME:"os_name",OS_VERSION:"os_version",RENDER_INFO:"render_info",SPHD_TYPE:"sphd_type",DPI:"dpi",CDNIP:"cdnip",AUTO_BITRATE:"auto_bitrate",P2P_COOL_FLAG:"p2p_cool_flag",MP_EXPERIMENT:"mp_experiment",ACT_LOAD_TYPE:"act_load_type",STREAM_INDEX:"stream_index",OBS_RENDER_MODE:"obs_render_mode",PLAYER_TYPE:"player_type",LIVE_TYPE:"live_type",STREAM_TYPE:"stream_type",HLS_TYPE:"hls_type",VR_ENABLE:"vr_enable",VR_MODE:"vr_mode",CODEC_TYPE:"codec_type",CDN_CIP:"cdn_cip",CDN_SIP:"cdn_sip",ALT_SVC:"alt_svc",QUIC:"quic",START_TYPE:"start_type",PCDN_ORIGIN:"pcdn_origin",CLI_ISP:"cli_isp",CLI_PROV:"cli_prov",SUB_PCDN_STATE:"sub_pcdn_state",STREAM_TOTAL_DURATION:"stream_total_duration",CODERATE_BPS:"coderatebps",VOD_CODERATE:"vod_coderate",PLAYBACK_RATE:"playbackrate",ANCHOR_UID:"anchoruid",FLV_PCDN_STATE:"flv_pcdn_state",H265:"h265",V_DECODEC:"v_decodec",V_RECV_FRAME:"v_recv_frames",V_TO_DECODE_FRAMES:"v_to_decode_frames",V_DECODE_FRAME:"v_decode_frames",V_PLAY_FRAME:"v_play_frame",V_TO_PLAY_FRAME:"v_to_play_frames",A_RENDER_SILENCE_TIME:"a_render_silence_time",SUB_CHANGE_STATE:"sub_change_state",FORCE_SUB_TYPE:"force_sub_type",MUTE_DATA:"mute_data",VISIBILITY_STATE:"visibility_state",SESSION_ID:"session_id",VIDEO_MIN_BUF:"video_min_buf",AUTO_VERSION:"auto_version",MSE_PLAYER:"mse_player",DECODE_HARDWARE_ACCELERATION:"decode_hardware_acceleration",HARDWARE_CONCURRENCY:"hardware_concurrency",START_CODERATEBPS:"start_coderatebps",DEFAULT_BITRATEBPS:"default_bitratebps",MEMORY_BITRATEBPS:"memory_bitratebps",RECOMMEND_BITRATEBPS:"recommend_bitratebps",AUTO_USER_TAGS:"auto_user_tags",AUTO_OPEN:"auto_open",V_RECV_FRAMES:"v_recv_frames",H265_SUPPORT_REASON:"h265_support_reason",PLACE:"place",PULLSTREAM_REASOM:"pullstream_reason",VIDEO_PAUSE_BUFFERS:"video_pause_buffers",VIDEO_PAUSE_CONTINUE_BUFFERS:"video_pause_continue_buffers",HARDDECODE:"harddecode",DECODE_SUPPORT:"deocode_support",IS_TIE_STREAM:"is_tie_stream",IS_REDIRECT:"is_redirect",CLOSE_EXTSTREAM:"close_extstream",MOSAIC_DATA:"mosaic_data",PCDN_IAAS:"pcdn_iaas",P2P_TO_FLV_DOMAIN:"p2p_to_flv_domain",DECODE_CAPABILITY:"decode_capability",WEBCODECS_BACK_REASON:"webcodecs_back_reason",STREAM_FORMAT:"stream_format",IS_MUTE:"is_mute",IS_MOSAIC:"is_mosaic",I_GPU:"i_gpu",P_IAAS_INFO:"p_iaas_info",UA:"ua",IAAS_BW_INFO:"iaas_bw_info",IS_PAID_ROOM:"is_paid_room",SUB_STATA_INFO:"sub_state_info",PSUB_PROXY_INFO:"psub_proxy_info"},DIM_CORE:{CREATE_TIME:"create_time",VIDEO_BAD_QUALITY_OLD:"video_bad_quality_old",VIDEO_BAD_QUALITY:"video_bad_quality",VIDEO_BAD_REASON:"video_bad_reason",USER_PROPERTY:"user_property",HEART_TYPE:"heart_type",SIGNAL_USER_PROPERTY:"signal_user_property",VTDAVG:"vtdavg",VTDMAX:"vtdmax",ATDAVG:"atdavg",ATDMAX:"atdmax",VRTADE:"vrtade",VRTADEMAX:"vrtademax",VATRDE:"vatrde",VATRDEMAX:"vatrdemax",ARTADE:"artade",ARTADEMAX:"artademax",AATRDE:"aatrde",AATRDEMAX:"aatrdemax",VRDFPS:"vrdfps",VRCFPS:"vrcfps",VDF:"vdf",PFPS:"pfps",PFPSMAX:"pfpsmax",PFPSMIN:"pfpsmin",VRBQ:"vrbq",VRBQC:"vrbqc",VRBQD:"vrbqd",AVSDA:"avsda",AVSDM:"avsdm",AVEFS:"avefs",VIDEO_H265_BAD_QUALITY:"video_h265_bad_quality",AUTO_U_REASON:"auto_u_reason",AUTO_D_REASON:"auto_down_reason",AUTO_HEART_TYPE:"auto_heart_type",AUTO_CODEC_CHANGE_TYPE:"auto_codec_change_type",AUTO_BAD_REASON:"auto_bad_reason",AUTO_BAD_MIN_REASON:"auto_bad_min_reason",DISPATCH_ID:"dispatch_id",PCDN_SVR_ISP:"pcdn_svr_isp",PCDN_SVR_AREA:"pcdn_svr_area",UNOPEND_CPFLV_BW:"unopend_cpflv_bw",NORETURN_CPFLV_BW:"noreturn_cpflv_bw",UNSUPPORT_CPFLV_BW:"unsupport_cpflv_bw",LOAD_LIB_CPFLV_BW:"load_lib_cpflv_bw",GATHER_CPFLV_BW:"gather_cpflv_bw",GATHER_FAIL_CPFLV_BW:"gather_fail_cpflv_bw",LOAD_SUC_CPFLV_BW:"load_suc_cpflv_bw",ERROR_CPFLV_BW:"error_cpflv_bw"},PCDN_DATA:{GET_PCDN_URL_TOTAL_CNT:"get_pcdn_url_total_cnt",GET_PCDN_URL_SUCCESS:"get_pcdn_url_success",GET_PCDN_URL_SUC_FREETIME:"get_pcdn_url_suc_freetime",GET_PCDN_ERR_NOT_REACHED:"get_pcdn_err_not_reached",GET_PCDN_ERR_OVER_RUN:"get_pcdn_err_over_run",GET_PCDN_ERR_OVER_RUN_FREETIME:"get_pcdn_err_over_run_freetime",GET_PCDN_ERR_NOT_COVERD:"get_pcdn_err_not_coverd",GET_PCDN_ERR_OTHER:"get_pcdn_err_other",GET_PCDN_ERROR_REQ:"get_pcdn_err_req",GET_SUBS_URL_ERROR_CNT:"get_subs_url_error_cnt",GET_PCDN_DATA_TIME:"get_pcdn_data_time",GET_PCDN_DATA_TIME_CNT:"get_pcdn_data_time_cnt",GET_PCDN_SUBS_URL_TIME:"get_pcdn_subs_url_time",GET_PCDN_SUBS_URL_TIME_CNT:"get_pcdn_subs_url_time_cnt",GET_CDN_DATA_TIME:"get_cdn_data_time",GET_CDN_DATA_TIME_CNT:"get_cdn_data_time_cnt",PCDN_REPEAT_BW:"pcdn_repeat_bw",USE_PCDN:"use_pcdn"},DIM_LINK_STA:{name:"link_sta",CONNECT_SUC:"cns",HAS_DATA:"hd",DATA_ENOUGH:"de",AUDIO_CONFIG:"acf",VIDEO_CONFIG:"vcf",VIDEO_IFRAME:"vif",VIDEO_FRAME:"vf",AUDIO_FRAME:"af",NO_SLICE_DATA:"nsd",H265:"h265"},DIM_LINK_SAM:{name:"link_sam",AUDIO_DTS:"ad",VIDEO_DTS:"vd",AUDIO_RATE:"ar",VIDEO_RATE:"vr",AUDIO_WAIT_PUSH:"awp",VIDEO_WAIT_PUSH:"vwp",AUDIO_WAIT_REASON:"awr",VIDEO_WAIT_REASON:"vwr",AUDIO_WAIT_GAP:"awg",VIDEO_WAIT_GAP:"vwg",VIDEO_DROP_FRAMES:"vdf",VIDEO_AUDIO_GAP:"vag",VIDEO_BUFFER_EMPTY_TIME:"vbet",VIDEO_BUFFER_EMPTY_COUNT:"vbec",SPEED:"sp"},DIM_H265_SAM:{name:"h265_sam",decode_fps:"decode_fps",render_fps:"render_fps",frame_list_len:"frame_list_len"},DIM_EXT:{CDN_IP:"cdn_ip"},CORE:{name:"yspwl.web.live.user.heart20",HTD:"htd",AUDIO_CNT:"audio_cnt",BIG_AUDIO_CNT:"big_audio_cnt",STAT_BW:"stat_bw",CDN_TOTAL_BW:"cdn_total_bw",CDN_VALID_BW:"cdn_valid_bw",CDN_REPEAT_BW:"cdn_repeat_bw",P2P_TOTAL_BW:"p2p_total_bw",P2P_REPEAT_BW:"p2p_repeat_bw",P2P_VALID_BW:"p2p_valid_bw",RANGE_TOTAL_BW:"range_total_bw",RANGE_VALID_BW:"range_valid_bw",PEER_RANGE_TOTAL_BW:"peer_range_total_bw",PEER_RANGE_VALID_BW:"peer_range_valid_bw",PEER_RANGE_REPEAT_BW:"peer_range_repeat_bw",DEFAULT_BW:"default_bw",FAST_BW:"fast_bw",PATCH_BW:"patch_bw",COMPETE_BW:"compete_bw",FIXED_BW:"fixed_bw",FORCE_BW:"force_bw",SIGNAL_UP_BW:"signal_up_bw",SIGNAL_DOWN_BW:"signal_down_bw",ENC_FLOW:"enc_flow",DEC_FLOW:"dec_flow",DEC_OK_CNT:"dec_ok_cnt",DEC_FAIL_CNT:"dec_fail_cnt",BUFFER_LENGTH:"buffer_length",PLAY_DELAY:"play_delay",DELAY_ANCHOR:"delay_anchor",DELAY_SERVER:"delay_server",DELAY_NET:"delay_net",SVR_DELAY_INFOS:"svr_delay_infos",DELAY_NODE_INFO:"delay_node_info",SVR_LAST_P_DELAY:"svr_last_p_delay",UPLOADER_TYPE:"uploader_type",ENCODER_SOURCE:"encoder_source",OBS_FPS:"obs_fps",OBS_UPLOAD_TS:"obs_upload_ts",VIDEO_BLOCK_COUNT:"video_block_count",VIDEO_BLOCK_DURATION:"video_block_duration",VIDEO_BAD_BUFFER:"video_bad_buffer",VIDEO_CONTINUE_BUFFER:"video_continue_buffer",PRTTCNT:"prttcnt",PRSUCNT:"prsucnt",PRNNCnt:"prnncnt",PRTOCNT:"prtocnt",PRFTCNT:"prftcnt",PRFSCNT:"prfscnt",PRNPID:"prnpid",PRNSDK:"prnsdk",PRNPUB:"prnpub",PRNSUB:"prnsub",PRNPEER:"prnpeer",PRNSTREAM:"prnstream",PRNLATE:"prnlate",PRNRTT:"prnrtt",PRNNONE:"prnnone",AUTO_SWITCH_CNT:"auto_switch_cnt",AUTO_SWITCH_SAME_CNT:"auto_switch_same_cnt",AUTO_BAD_QUALITY:"auto_bad_quality",AUTO_BAD_QUALITY_UP:"auto_bad_quality_up",AUTO_BAD_DURATION:"auto_bad_duration",AUTO_BAD_DURATION_UP:"auto_bad_duration_up",AUTO_BAD_SWITCH:"auto_bad_switch",AUTO_BAD_SWITCH_SAME:"auto_bad_switch_same",AUTO_BAD_SWITCH_UP:"auto_bad_switch_up",AUTO_BAD_DONE:"auto_bad_done",AUTO_BAD_BUFFER:"auto_bad_buffer",AUTO_CONTINUE_BUFFER:"auto_continue_buffer",PCDN_TOTAL_BW:"pcdn_total_bw",PCDN_FREETIME_BW:"pcdn_freetime_bw",PCDN_REALTIME_BW:"pcdn_realtime_bw",SWITCH_CDN_CNT:"switch_cdn_cnt",GET_STREAM_CNT:"get_stream_cnt",GET_STREAM_ERROR_CNT:"get_stream_error_cnt",GET_STREAM_LINK_ERROR_CNT:"get_stream_link_error_cnt",GET_STREAM_LINK_TIMEOUT_CNT:"get_stream_link_timeout_cnt",GET_STREAM_LOW_DATA_CNT:"get_stream_low_data_cnt",REAL_KBPS_SAMPLE:"real_kbps_sample",REAL_FLAC_KBPS_SAMPLE:"real_flac_kbps_sample",RECV_TOTAL_SAMPLE:"recv_total_sample",RECV_LAN_SAMPLE:"recv_lan_sample",HAS_PUNCH_NODES:"has_punch_nodes",HAS_PUNCH_NODES_SDKV2:"has_punch_nodes_sdkv2",HAS_PUNCH_NODES_WEBV2:"has_punch_nodes_webv2",HAS_PUNCH_NODES_MEDIA:"has_punch_nodes_media",HAS_PUNCH_NODES_SIGNAL:"has_punch_nodes_signal",FORWARD_REJECT_CNT:"forward_reject_cnt",FRAME_BUFFER_DELAY:"frame_buffer_delay",STREAM_BUFFERED:"stream_buffered",RANGE_SIP_SUC_CNT:"range_sip_suc_cnt",RANGE_SIP_DIF_CNT:"range_sip_dif_cnt",RANGE_REQ_CNT:"range_req_cnt",RANGE_RSP_CNT:"range_rsp_cnt",RANGE_CONNECT_TIME:"range_connect_time",RANGE_RSP_TIME:"range_rsp_time",VISIBILITY_HIDDEN_TIME:"visibility_hidden_time",VIDEO_PERFPAUSE_CONTINUE_CNT:"video_perfpause_continue_cnt",VIDEO_PERFPAUSE_CNT:"video_perfpause_cnt",FULL_CDN_CNT:"full_cdn_cnt",SUB_CDN_CNT:"sub_cdn_cnt",PATCH_CDN_CNT:"patch_cdn_cnt"},VIDEO_LINK:{PVSSC:"pvssc",PVFSC:"pvfsc",PVLSC:"pvlsc",PVLFC:"pvlfc",PVPFC:"pvpfc",PVPTC:"pvptc",PVPAFC:"pvpafc",PVRFC:"pvrfc"},UPDOWN_INFO:{name:"updown_info",UPLINK_BW:"uplink_bw",DOWNLINK_BW:"downlink_bw",UPLINK_CNT:"uplink_cnt",UPLINK_LIMIT_CNT:"uplink_limit_cnt"},SIGNAL_HEART20:{name:"yspwl.web.live.signal.heart20",STREAM_NAME:"stream_name",STREAM_DELAY:"stream_delay",FULL_FRAME_NUM:"full_frame_num",LOST_FRAME_NUM:"lost_frame_num",P2P_FLOW_DANMU:"p2p_flow_danmu",P2P_FLOW_EMPTY:"p2p_flow_empty",RESEND_TOTAL_CNT:"resend_total_cnt",RESEND_TIMEOUT_CNT:"resend_timeout_cnt",RESEND_ERROR_CNT:"resend_error_cnt",MIN_DELAY:"min_delay",MAX_DELAY:"max_delay",AVE_DELAY:"ave_delay",SER_2_REC_DELAY:"ser_2_rec_delay",REC_2_MERGE_DELAY:"rec_2_merge_delay",MERGE_2_NOTIFY_DELAY:"merge_2_notify_delay",CDN_FLOW_DANMU_VALID:"cdn_flow_danmu_valid",CDN_FLOW_DANMU_TOTAL:"cdn_flow_danmu_total",CDN_FLOW_EMPTY_VALID:"cdn_flow_empty_valid",CDN_FLOW_EMPTY_TOTAL:"cdn_flow_empty_total"},HLS_INFO:{name:"hls_info",M3U8_CNT:"m3u8_cnt",M3U8_SUC_CNT:"m3u8_suc_cnt",M3U8_FAIL_CNT:"m3u8_fail_cnt",M3U8_EMPTY_CNT:"m3u8_empty_cnt",M3U8_WRONG_CNT:"m3u8_wrong_cnt",M3U8_TIMEOUT_CNT:"m3u8_timeout_cnt",TS_CNT:"ts_cnt",TS_SUC_CNT:"ts_suc_cnt",TS_FAIL_CNT:"ts_fail_cnt",TS_TIMEOUT_CNT:"ts_timeout_cnt",TS_OPEN_AVG:"ts_open_avg",TS_LOADED_AVG:"ts_loaded_avg",TS_SPEED_AVG:"ts_speed_avg",TS_SIZE_AVG:"ts_size_avg"},FRAME_INFO:{name:"frame_info",LATE_SEQS:"late_seqs",LOSS_FRAMES:"loss_frames",PLAY_FRAMES:"play_frames",DTS_JUMPPAUSE_CNT:"dts_jumppause_cnt",SKIP_PAUSE_CNT:"skip_pause_cnt",EMPTY_FRAMES:"empty_frames",FULL_RATIO:"full_ratio"},SUB_INFO:{name:"sub_info",TOTAL_CNT:"total_cnt",SUCC_CNT:"succ_cnt",FAIL_CNT:"fail_cnt",TIMEOUT_CNT:"timeout_cnt",KICK_CNT:"kick_cnt",TRY_CNT:"try_cnt",CMP_TOTAL_CNT:"cmp_total_cnt",CMP_SUCC_CNT:"cmp_succ_cnt",CMP_FAIL_CNT:"cmp_fail_cnt",CMP_TIMEOUT_CNT:"cmp_timeout_cnt",FORCE_CNT:"force_cnt"},PUNCH_INFO:{name:"punch_info",TOTAL_CNT:"total_cnt",VALID_CNT:"valid_cnt",TRY_CNT:"try_cnt",SUCC_CNT:"succ_cnt",BACK_CNT:"back_cnt",BACK_SUCC_CNT:"back_succ_cnt",BACK_TRY_CNT:"back_try_cnt"},PUNCH_BACK_RET:{name:"punch_back_ret"},RESEND_INFO:{name:"resend_info",RESEND_CNT:"resend_cnt",TIMEOUT_CNT:"timeout_cnt",ERROR_CNT:"error_cnt",SLICE_CNT:"slice_cnt",RESPOND_CNT:"respond_cnt",LATE_CNT:"late_cnt",MISS_CNT:"miss_cnt",REPEAT_CNT:"repeat_cnt",REPEAT_SUCC_CNT:"repeat_succ_cnt",REPEAT_FAIL_CNT:"repeat_fail_cnt",LIMIT_CNT:"limit_cnt"},SUBSTREAM_INFO:{name:"substream_info",FIXED_CNT:"fixed_cnt",FORCE_CNT:"force_cnt",COMPETE_CNT:"compete_cnt"},FORCESUB_REASON:{name:"forcesub_reason",NOPEER_CNT:"nopeer_cnt",SUBEND_CNT:"subend_cnt",TIMEOUT_CNT:"timeout_cnt"},SUB_RETURN:{sub_name:"sub_return",switch_name:"switch_return",last_name:"last_return"},NONODE_RETURN:{name:"nonode_return",PRESENTER_CNT:"presenter_cnt",UPLINK_LESS_CNT:"uplink_less_cnt",PULL_SAME_CNT:"pull_same_cnt",SUBED_CNT:"subed_cnt",COOL_CNT:"cool_cnt",DELAY_CNT:"delay_cnt",RTT_CNT:"rtt_cnt",LATE_CNT:"late_cnt",FAST_CNT:"fast_cnt",NONE_CNT:"none_cnt"},AUTO_INFO:{name:"auto_info",UP_CNT:"up_cnt",DOWN_CNT:"down_cnt",BACK_CNT:"back_cnt"},P2P_TCP_TYPE:{name:"p2p_tcp_type"},P2P_TCP_STATE:{name:"p2p_tcp_state"},PCDN_BW_DATA:{name:"pcdn_bw_data"},AI_CONTROL_DATA:{name:"ai_control_data",AI_P2P_CNT:"ai_p2p_cnt",AI_FLV_CNT:"ai_flv_cnt",AI_P2P_TIMEOUT_CNT:"ai_p2p_timeout_cnt",AI_FLV_TIMEOUT_CNT:"ai_flv_timeout_cnt",AI_P2P_ERROR_CNT:"ai_p2p_error_cnt",AI_FLV_ERROR_CNT:"ai_flv_error_cnt",AI_P2P_SWITCH_CNT:"ai_p2p_switch_cnt",AI_FLV_SWITCH_CNT:"ai_flv_switch_cnt",AI_P2P_NOT_SWITCH_CNT:"ai_p2p_not_switch_cnt",AI_FLV_NOT_SWITCH_CNT:"ai_flv_not_switch_cnt",AI_FLV_ERROR_SWITCH_CNT:"ai_flv_error_switch_cnt",AI_FLV_ERROR_NOT_SWITCH_CNT:"ai_flv_error_not_switch_cnt：flv",AI_START_P2P_CNT:"ai_start_p2p_cnt",AI_START_FLV_CNT:"ai_start_flv_cnt"},ACT:{name:"yspwl.web.live.user.act",field:"act_type",SWITCH_BITRATE:"switch_bitrate",SWITCH_AUTO:"switch_auto",SWITCH_LINE:"switch_line",SWITCH_PTS:"switch_pts",FAST_SAMPLE:"fast_sample",NO_PICTURE:"no_picture",NO_PICTURE_ALL:"no_picture_all",NO_PICTURE_P2P:"no_picture_p2p",LINK_STA:"link_sta",HLS_PLAY_SUCC:"hls_play_succ",HLS_LOAD_SUCC:"hls_load_succ",P2P_PLAY_FAIL:"p2p_play_fail",P2P_LOAD_VIDEO:"p2p_load_video",P2P_RESTART:"p2p_restart",TCP_NO_SLICE:"tcp_no_slice",TCP_OPEN_TIME:"tcp_open_time",HTTP_CODE_:"http_code_",TCP_TIMEOUT:"tcp_timeout",P2P_COOLING:"p2p_cooling",CONNECT_VIDEO_TS:"connect_video_ts",RECV_VIDEO_TS:"recv_video_ts",FIRST_VIDEO_PKG_TS:"first_video_pkg_ts",FIRST_VIDEO_IFRAME_TS:"first_video_iframe_ts",VIDEO_IFRAME_TS:"video_iframe_ts",FIRST_VIDEO_RENDER_TS:"first_video_render_ts",VIDEO_PLAYED_TS:"video_played_ts",VIDEO_LOAD_TS:"video_load_ts",VIDEO_LOAD_SEG:"video_load_seg",VIDEO_LOAD_TS_ALL:"video_load_ts_all",VIDEO_GET_VP_TS:"video_get_vp_ts",VIDEO_LOGIN_TS:"video_login_ts",LOAD_M3U8_TS:"load_m3u8_ts",FIRST_FRAG_LOAD_TS:"first_frag_load_ts",FIRST_FRAG_LOADED_TS:"first_frag_loaded_ts",FIRST_FRAG_SIZE:"first_frag_size",SIGNAL_TURN_BACK:"signal_turn_back",SWITCH_COST:"switch_cost",OB_BG_DURATION:"ob_bg_duration",LOAD_P2PLIB_ERROR:"load_p2plib_error",LOAD_PCDNLIB_ERROR:"load_pcdnlib_error",PCDN_TO_CDN:"pcdn_to_cdn",MUTE_STATUS:"mute_status",NO_PICTURE2:"no_picture2",H265_WORKER_LOAD_TS:"h265_worker_load_ts",H265_STATUS:"h265_status",MOSAIC_STATUS:"mosaic_status",AI_P2P_FLV_SWITCH:"ai_p2p_flv_switch",BLOCK_BAD:"block_bad",SWITCH_AUDIO_RES:"switch_audio_res"},VOD_ACT:{name:"yspwl.web.vod.user.act"},VOD_CORE:{name:"yspwl.web.vod.user.heart20",AV1_SVR:"av1_svr",AV1_SPT:"av1_spt",AV1_USE:"av1_use",VOD_BAD_QUALITY:"vod_bad_quality",VOD_BAD_REASON:"vod_bad_reason",VOD_NO_PICTURE:"vod_no_picture",VOD_NO_PICTURE_REASON:"vod_no_picture_reason",VOD_DTS_JUMP:"vod_dts_jump",VOD_BLOCK_COUNT:"vod_block_count",VOD_BLOCK_DURATION:"vod_block_duration",M3U8_FILE_BW:"m3u8_file_bw",TS_PLAY_TIME:"ts_play_time",TS_SIZE:"ts_size",VOD_PCDN_STATE:"vod_pcdn_state",VIDEO_H265_BAD_QUALITY:"video_h265_bad_quality"},VOD_DIM_CORE:{TS_START_TIME:"ts_start_time",TS_END_TIME:"ts_end_time"},VOD_DIM_COM:{VOD_VIDEOSOURCEID:"vod_videosourceid",VOD_CODERATE:"vod_coderate",VODANCHORID:"vodanchorid",STREAMTYPE:"streamtype",RESOURCE_TYPE:"resource_type",HAS_302:"has_302",VOD_FIRST_TS:"vod_first_ts",SGUID:"sguid",M3U8_FILE_BW:"m3u8_file_bw",VOD_AB_SWITCH:"vod_ab_switch",CREATE_TIME:"create_time",VOD_PLACE:"vod_place",VOD_MP4_SIZE:"vod_mp4_size",VOD_DURATION:"vod_duration",VOD_NO_PICTURE_REASON:"vod_no_picture_reason",LINE:"line",BACKUP_FIELD1:"backup_field1",BACKUP_FIELD2:"backup_field2",BACKUP_FIELD3:"backup_field3",BACKUP_FIELD4:"backup_field4",BACKUP_FIELD5:"backup_field5",BACKUP_FIELD6:"backup_field6"},VOD_EXT_COM:{VID:"vid",CLIENT:"client",PID:"pid",BITRATE:"bitrate",DEFINITION:"definition",SCENE:"scene"},ROOM_HEART60:{name:"yspwl.web.liveroom.user.heart1",SESSION_ID:"session_id",NOW_TS:"now_ts",MAX_NO_RENDER_DU:"max_no_render_du",NO_RENDER_DURATION:"no_render_duration",REPEAT_PIC_TS:"repeat_pic_ts"}}},function(e,t,i){"use strict";var s=i(3),r=i(4),a=i(9),n=i(0),o=i(6),h=i(10),u=new(function(){function e(){Object(s.a)(this,e),this.pushGop=!1,this.jitBufLen=3e3,this.jitMaxBufLen=4e3,this.jitMinBufLen=2e3,this.resendPlayThreshold=1500,this.mutilLinkConfig=[[0,4e3],[8,4]],this.resendModeConfig=[[0,2e3],[1,2]],this.resendMode=1,this.resendWaitLimitList={500:2500,2e3:2500,4e3:2500,8e3:2500,1e4:2500,12e3:2500,2e4:2500},this.sliceListLengthMaxList={500:1e3,2e3:25e3,8e3:1e4,1e4:12500,2e4:25e3},this.noUrgentResentBuffer=2e3,this.latency=[[3e3,2e3,4e3,2e3],[1e3,500,1500,1e3]],this.jitTest=[2e3,5e3,1500],this.jitPid=[],this.hlsJitCfg=[6e3,4e3,8e3],this.hlsUseFetch=100,this.obsUseFull=0,this.obsFullRatio=1,this.obsBgRatio=0,this.obsFaceRatio=0,this.obsSrAudio=1,this.obsFrame=0,this.obsSyncTs=50,this.obsSeekTs=200,this.obsSeekJumpTs=0,this.obsRateTs=10,this.baseSubs=10,this.urgentResend=1,this.urgentResendAudio=1,this.crossPunchPloy=1,this.crossClientPer="all|all:100",this.crossClientUpBwMod=1,this.syncMob=1,this.noSignalNode=1,this.crossCdn=1,this.crossLineSub="all",this.punchWan="",this.p2pWssLines="all",this.connectTotalTime=6e3,this.connectTimeout=2e3,this.connectPcdnTimeout=4e3,this.flowTimeout=2e3,this.flowRetryTimes=3,this.renderTimeout=3e3,this.noDataTimeout=4e3,this.noSliceTimeout=1e4,this.noPcdnDataTimeout=2e3,this.testResender=0,this.maxResendTimes=3,this.resendDelayTs=400,this.patchSubTs=500,this.http2Channel="",this.rangeNums=256,this.deleteH264Aud=[],this.useChangeRate=[],this.freeBufferBitrate=15e3,this.needCooling=1,this.needQueue=0,this.queueTime=500,this.punchedCoolingTime=1e4,this.delayCloseNum=200,this.punchTimeout=7e3,this.maxPunchedCnt=50,this.maxPunchedCntMore=60,this.maxNodeCnt=50,this.maxPunchedCntSdk=10,this.punchBackCooling=2e4,this.punchIgnoreTime=3e4,this.coefficient=8,this.trySubNum=5,this.trySubTime=7e3,this.fastTime=5e3,this.lostSeqTime=6,this.sliceLate=1e3,this.sliceFast=1500,this.sliceConstraints=6e3,this.sliceConstraintBad=8e3,this.pubSelectorConstraint=0,this.badDelay=1e3,this.emuteDelay=2200,this.switchDelay=500,this.aliveTimeout=1e3,this.resubTime=3e4,this.sliceTimeout=1e3,this.maxPeerStreamNum=7,this.maxPeerStreamNum20M=4,this.maxUplinkBw=6e3,this.closeUids=[],this.closeSub=0,this.closeSubRooms=[],this.closeAllUids=[],this.p2pMediaCfg="all|all:100",this.p2pSignalCfg="all|all:100",this.ignoreUids=[1259515661837,1354740567,2368274334,1706479145,2367547387,1099531787526,1827824615,1531433300,1680925919,2227875499,2272316519,367138632,1677942333,157525e4,1610145122,1199534013894,813535483,1259553301717,570184355,679257140,1067459140,2222971974,1279514601966,1199577571975,294636272,518969542,745373351,1199515480194,1199568157971,1199517808234,1430972471,1356299405,1724691,10748220,1199525977184,2176998321,1099531752788,1487476672,1199536349047,1259525634703,17363578,1191588902,1629021815,124902116,1705516953,1199536199401,1120785052,1852594244,2285403183,1199526826004,2250967121,2208606321],this.flvEmptyAudioFrame=1,this.sendHeartBeatAlone=0,this.signalNoCdnp=[],this.switchSeamLessLine=0,this.isProduce=!0,this.coderates=[[15e3,0,8e3,5,5,230,1,20],[8e3,0,4e3,5,5,230,5,10],[6e3,0,4e3,5,5,170,5,10],[4e3,0,4e3,5,5,120,5,10],[3e3,0,4e3,5,5,80,5,10],[0,0,4e3,5,5,50,5,10]],this.seaSubNums=[],this.swapdomain={},this.iP2PType=2,this.danmuZipPids=[],this.randomPercent=1e4,this.frameBufLen=[2500,1500,1500,3500],this.bufferMode=2,this.bufferConfig=[],this.urgentResendTime=1500,this.forceSkipFrameTime=3900,this.frameTimeout=3e3,this.p2pBuffer=[3500,2500,4500],this.p2pOpenBrowsers=["opera"],this.jitCfg=[[15e3,4e3,3e3,5e3],[0,3e3,2e3,4e3]],this.jitCfgPid=[],this.jitJump=[2e4,8e3],this.jitLowLatency=2e3,this.jitLow=[1500,1e3,2e3],this.safariPlayDelay=500,this.safariFirstLoad=!0,this.jitAB=[],this.waitAudio=1,this._isFrameBuffer=-1,this.isSubUseHttps=1,this.usePcdn=1,this.pcdnSubsConfig=[1,1,1],this.notUsePcdnUids=[],this.isPcdnReportErr=0,this.pcdnNoDataMod=2,this.pcdnSlowTime=2,this.pcdnSlowCoolTime=6e4,this.pcdnSowCnt=5,this.isMute=1,this.muteCfg=[1e4],this.isAutoNoPicture=0,this.playbackrateMin=.95,this.playbackrateMax=1.05,this.pcdnFlv=1,this.isAiP2PToFlv=1,this.randomAIP2PFlvPercent=Math.floor(1e4*Math.random()),this.aiRandomPercent=5e3,this.aiABRandomPercent=2e3,this.aiUids=[],this.aiBlackUids=[],this.aiBlackLines=[],this.aiBlack2Uids=[],this.isAutoH265=0,this.renderDelta=300,this.h265Config=[[[2e3,4e3],[4e4,4e4]],[4e3,2e3,1300,1e3,500],75,[[500,1e3,1300,2e3,4e3],[3,3,3,3,4]],30,3,[!0,!0]],this.h265MseConfig=[1,[86],[500,1e3,1300,2e3,4e3],[],[[500,1e3,1300,2e3,4e3],[5,5,5,5,5],[],[]],1],this.h265MseChromeConfig=[107,3e4,4,0,1],this.wcs265BlackUids=[],this.wcsGBlackIds=[],this.hardH265UidList=[],this.h265MseWhiteBlackUids=[[],[]],this.h265BlackUids=[],this.replayH265BlackUids=[],this.whiteH265Uids=[[],1],this.h265NoPushVideoDis=1e4,this.randomH265Percent=Math.floor(1e4*Math.random()),this.h265PercentConfig=1e5,this.enableAiMosaic=1,this.aiMosaicUis=[],this.aiRequestInterval=5e3,this.aiBathRequestInterval=3e4,this.aiBufferEmptyRequestInterval=3e5,this.playerdata={profileP2POpt:""},this.isCommonAb=1,this.aiP2PFlvConfig=[5e3,5],this.closePcdnBitrate=8e4,this.closePcdn500=0,this.setVideoCTCfg=[-100,1500,1e4],this.sliceQuantityPerSecond=1,this.useNewPloy=1,this.minPlayout=170,this.maxPlayout=500,this.playoutUids=[],this.isMuteAct=0,this.useAV1=!1,this.useAV1PidList=[],this.useAV1LinesAndBitRates=[[],0],this.isClosePlayBackRate=1,this.pcdnAbConnectData=[0,[1e3,2e3,3e3,4e3]],this.isForceUseWorker=0,this.platform=o.a.PLATFORM_TYPE_NAME.web,this.av1PercentConfig=5e3,this.isConfigSupportH265=1,this.isVodSupportH265=0,this.abUseAv1=1,this.platform=o.a.PLATFORM_TYPE_NAME.web,this.h265GameIds=[!0,[]],this.isNoVideoReport=0,this.simdAbPercentConfig=5e3,this.vodAbSwitch=0,this.dropFrameAb=0,this.useNewParser=1,this.maxGop=3e3,this.autoCfg={close:0,closeLines:[],closePids:[],upGap:0,downGap:15e3,backGap:15e3,upPer:.8,downPer:.3,downNowPer:.2,waitPer:.8,downBitrate:2e3,slow:.85,bufCnt:10,sucPer:.9,sampleTime:200,minTime:1e4,maxTime:3e5,sysTime:1e4,evalTime:300,highRate:4e3,badBuf:2e3,badCnt:3,badS:[1e4,3],badL:[6e4,5],noRederTime:12e4,monitorTime:15e3},this.continueBufferDeltaStart=6e3,this.continueBufferDeltaEnd=3e3,this.autoBufferScore=1e3,this.autoConnectScore=500,this.autoFirstScore=500,this.autoPtsScore=500,this.force_auto_count=9999,this.force_auto_effective_time=2592e5,this.autoReportCfg=[1,3,0,1],this.autoReportSea=0,this.isWebAutoAB=0,this.maxBitRate=500,this.recSysExpiredTime=6e4,this.autoDownTimer=0,this.autoDownMaxBitrate=1,this.minFps=24,this.dropTime=0,this.perfBitrate=2e3,this.perfCnt=1,this.perfBuf=2e3,this.p2p302Config=[[[6,1,0,1]],1],this.sdkCloseAutoAi=0,this.closeP2PConfig=[1,1],this.enableAutoCloseP2P=1,this.isCloseVodPcdn=0,this.is265VideoLoadTs=1,this.isSendPlaybackLoadTime=0,this.vodPcdnOpenBuffer=1e4,this.vodPcdnCloseBuffer=7e3,this.vodPcdnCoolTime=6e4,this.vodPcdnBufferCfg=[[1e4,7e3,6e4],[],[]],this.perfBlockCfg=[2e3,3e3,6e3],this.vodPcdnStatCfg=[0],this.vodAv1Cfg="all|all:100",this.vodAv1Cd=6e4,this.vodAv1CdCnt=5,this.vodAv1CloseCfg=[[[4e3,8],[1300,2]],[4e3,4]],this.vodAv1UseFirst=1,this.vodUseBackupField=[1,1,1,1,1,1,0],this.vodDtsFixCfg=[0,0],this.vodRetryTime=5e3,this.blockBadCfg=[800,1],this.perfWin7kaCfg=[2e3,3],this.openWebcodec=1,this.webCodecBlackUids=[],this.webCodecsAnchoruids=[],this.webCodecCfg=[4,8e3,2e3,1,1500,[2e3,1e4,2e4]],this.webCodecAVDeltaCfg=[5e3,2e3],this.noNextWcsTimeUids=[],this.useNextWcsTime=1,this.repairSameDtsCfg="",this.repairSameDts=0,this.useNewCdnp=1,this.shieldAudioCfg=[1,3e3,6e3,15e3,15e3,3e3],this.useCdnpFixed="all|all:100",this.signalClose="",this.signalExperiment=0,this.signalRangeGap="all|all:1000",this.signalSubGap="all|all:1000",this.signalBaseIndexExp=0,this.signalBaseIndexExpCfg="",this.signalBaseIndexMode=3,this.signalBaseIndexCfg="all|all:3",this.fakeHdrCfg=[{auid:[1346609715,1099531728402,1560173863,1544838475,1544838388],bitrateMap:{4100:17200,4200:17100,20100:19200}}],this.signalSliceCache="all|all:750",this.signalSliceDispatch="all|all:750",this.signalOpenExp="",this.signalOpen=-1,this.statLv=[1,1,0,1,0,2,0,1,1,0,2,1,1,1,1,1,0],this.statCfg="all|all:100",this.mediaRangeGap="all|all:200",this.mediaSubGap="all|all:500",this.mediaBaseIndexExp=0,this.mediaBaseIndexExpCfg="",this.mediaBaseIndexMode=1,this.mediaBaseIndexCfg="all|all:3",this.mediaSliceCache="all|all:750",this.mediaSliceDispatch="all|all:750",this.dropFrameUids=[1],this.dropFrameDts=[1e4,2e4],this.usePullPunch="all|all:100",this.closeLowBufResend="",this.renderStat=[0],this.pause500Cfg=[300,[]],this.closePause500=0,this.recvProcesser=0,this.recvCfg="all|all:100",this.isQQSoft=1,this.isWin7WcsSoft=1,this.isLimitNaluType=1,this.isCloseMseDrop=0,this.isAutoWcsReport=1,this.avHeaderChangeCfg=[[],0,300,1e4],this.avHeaderChangeStatCfg=[[],3e3,1],this.enableHvcc=1,this.videoMaxGap=2e4,this.iaasCfg=[1,1,3,.3,4e3,600,200,5e3,5,.4],this.iaasCfgWhiteAuids=[0,[]],this.iaasCfgBlackAuids=[],this.iaasCloseGather=1,this.p2pSubSdkV2=0,this.p2pSubSdkCfg="all|all:0",this.h265BlackBrows=[],this.wcsSoftBrows=[],this.wcsBlackBrowVers=[],this.p2pBlackBrowVers=[],this.pcdnBlackBrowVers=[],this.wasm265BlackBrowVers=[],this.mse265BlackBrowVers=[],this.wcs265BlackBrowVers=[],this.wcs264BlackBrowVers=[],this.bitrateBrowHard265Cfg=[0,4e3,[]],this.wcsSoft264Uids=[],this.popSize0Brows=[],this.paidAnchoruids=[],this.mobVBlockCfg=1,this.wasmCloseCfg=[0,[]],this.p2pRangePeerMode=1,this.rtPeerMax=0,this.rtPeerPer=0,this.rtPeerCfg=[[15e3,0,0],[0,1,0]],this.rtPeerTimeCfg=[[1,[[15e3,500]]]],this.rtPeerTimeout=400,this.rtPeerPRN=0,this.rtPeerSelectorCfg="all|all:100",this.rtPeerSelector=!1,this.fastTimeCfg="all|all:100",this.useFastTime=!1,this.logMaxLen=2e3}return Object(r.a)(e,[{key:"initRTPeerCfg",value:function(e){for(var t=this.rtPeerCfg,i=0;i<t.length;i++)if(e>=t[i][0]){this.rtPeerMax=t[i][1],this.rtPeerPer=t[i][2],n.a.log("Config.initRTPeerCfg bitrate=".concat(e," rtPeerMax=").concat(this.rtPeerMax," rtPeerPer=").concat(this.rtPeerPer));break}}},{key:"getAvHeaderChangeStat",value:function(e){for(var t=this.avHeaderChangeStatCfg[0],i=!1,s=0;s<t.length;s++)t[s]==e&&(i=!0);return 1==this.avHeaderChangeStatCfg[2]&&(i=!0),i}},{key:"initOpen",value:function(e,t,i,s){a.b.isOpen(this[i],e,t,!1)?this[s]=1:this[s]=0}},{key:"initByBitrate",value:function(e){if(this.initRTPeerCfg(e),this.maxPeerStreamNum=e>=1e4?this.maxPeerStreamNum20M:7,this.resendMode=1,this.resendModeConfig&&this.resendModeConfig[0].length===this.resendModeConfig[1].length)for(var t=this.resendModeConfig[0].length-1;t>=0;t--)if(e>=this.resendModeConfig[0][t]){this.resendMode=this.resendModeConfig[1][t];break}}},{key:"isAutoClose",value:function(e,t){if(1===this.autoCfg.close||-1!==this.autoCfg.closeLines.indexOf(Number(e)))return!0;for(var i=this.autoCfg.closePids.length,s=0;s<i;s++){var r=this.autoCfg.closePids[s];if(Number(r.pid)===Number(t))return!r.hasOwnProperty("lines")||-1!==r.lines.indexOf(e)}return!1}},{key:"initRepaireSameDtsCfg",value:function(e){"all"===this.repairSameDtsCfg||-1!==this.repairSameDtsCfg.indexOf(e)?this.repairSameDts=1:this.repairSameDts=0,n.a.log("Config.initRepaireSameDtsCfg=".concat(this.repairSameDts))}},{key:"setLowLatency",value:function(e){e&&e.setJitter(this.jitLow[0],this.jitLow[1],this.jitLow[2])}},{key:"setJitterCfg",value:function(e,t,i){this.setJitterAB(e,t,i)||this.setJitterByPid(e,t,i)||this.setJitterByRate(e,i,this.jitCfg)}},{key:"setJitterAB",value:function(e,t,i){if(this.jitAB.length>0){var s=this.jitAB[0],r=this.jitAB[1],a=this.jitAB[2];if("all"===s||-1!==s.indexOf(t+"")){var o=this.getGroupNum(a.length);return n.a.log("setJitterAB name=".concat(r," group=").concat(o)),this.setJitterByRate(e,i,a[o]),!0}}return!1}},{key:"getGroupNum",value:function(e){for(var t=1e4*Math.random(),i=e-1;i<e;i--)if(t>1e4/e*i)return i;return 0}},{key:"setJitterByPid",value:function(e,t,i){for(var s=0;s<this.jitCfgPid.length;s++){var r=this.jitCfgPid[s];if(-1!==r[0].indexOf(t+""))return n.a.log("setJitterByPid"),this.setJitterByRate(e,i,r[1]),!0}return!1}},{key:"setJitterByRate",value:function(e,t,i){for(var s=0;s<i.length;s++){var r=i[s];if(t>=r[0])return e&&e.setJitter(r[1],r[2],r[3]),!0}return!1}},{key:"init",value:function(e){if(e){Object.assign(this,e);var t=["p2pWssLines","http2Channel","crossLineSub","punchWan","repairSameDtsCfg","signalClose","signalRangeGap","signalSubGap","signalBaseIndexCfg","signalBaseIndexExpCfg","useCdnpFixed","signalSliceCache","signalSliceDispatch","mediaRangeGap","mediaSubGap","mediaBaseIndexCfg","mediaBaseIndexExpCfg","mediaSliceCache","mediaSliceDispatch","usePullPunch","closeLowBufResend","statCfg","signalOpenExp","recvCfg","vodAv1Cfg","platform","crossClientPer","p2pSubSdkCfg","p2pMediaCfg","p2pSignalCfg","fastTimeCfg","rtPeerTimeCfg","rtPeerSelectorCfg"];n.a.group("Configs");var i=["Configs:"];for(var s in this){var r=this[s];"string"==typeof r&&("pushGop"==s?r=!!Number(r):"coderates"==s||"testCoderates"==s||"swapdomain"==s?(r=r.replace(/[↵\s+\n]/gm,""),r=JSON.parse(r)):-1===t.indexOf(s)&&(r=Number(r))),this[s]=r,"object"==_(r)&&(r=JSON.stringify(r)),s=a.b.padStrLen(s,18,!1),i.push("\t"+s+" => "+r)}n.a.log(i.join("\n")),n.a.groupEnd(),n.a.log("Config",this)}}},{key:"setAiP2PToFlv",value:function(e){this.isAiP2PToFlv=e}},{key:"setUseAV1",value:function(e){var t=this.useAV1PidList,i=e.presenterUid,s=!1,r=this.useAV1LinesAndBitRates[0],a=this.useAV1LinesAndBitRates[1];t.forEach((function(e){i&&e.toString()==i.toString()&&(s=!0)})),s&&(r.forEach((function(t){t==e.lineType&&(s=!1)})),e.curBitrate<Number(a)&&(s=!1)),this.useAV1=s,s&&(this.autoCfg.close=1)}},{key:"isCloseP2P",value:function(e){return e&&this.closeUids&&-1!==this.closeUids.indexOf(e)}},{key:"isClosePidMediaP2P",value:function(e,t){return!a.b.isOpen(this.p2pMediaCfg,e,t,!1)}},{key:"isClosePidSignalP2P",value:function(e,t){return!a.b.isOpen(this.p2pSignalCfg,e,t,!1)}},{key:"isCloseP2PBroVer",value:function(){var e=h.a.version.major;return e&&this.p2pBlackBrowVers&&-1!==this.p2pBlackBrowVers.indexOf(e)}},{key:"isClosePcdnBroVer",value:function(){var e=h.a.version.major;return e&&this.pcdnBlackBrowVers&&-1!==this.pcdnBlackBrowVers.indexOf(e)}},{key:"getEnableAiMosaic",value:function(e){return!!this.enableAiMosaic}},{key:"setMute",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.isMute=e}},{key:"setUseAuto",value:function(e){e&&(this.isConfigSupportH265=0)}},{key:"getEnableJumpBuffer",value:function(){var e=h.a.version.major>=90;return h.a.chrome&&e||"firefox"===h.a.name}},{key:"isCloseAllFuncs",value:function(e){return-1!==this.ignoreUids.indexOf(Number(e))||this.closeAllUids&&-1!==this.closeAllUids.indexOf(Number(e))}},{key:"setVodPcdnConfig",value:function(e){var t=this,i=e.vid,s=e.anchoruid,r=e.useVodPcdnAbCfg;if(i||s){if(void 0!==r&&r&&this.vodPcdnBufferCfg[0].length>=3)return this.vodPcdnOpenBuffer=this.vodPcdnBufferCfg[0][0],this.vodPcdnCloseBuffer=this.vodPcdnBufferCfg[0][1],void(this.vodPcdnCoolTime=this.vodPcdnBufferCfg[0][2]);var a=function(e,i){e.some((function(e){return!(e.length<4&&e[3].length<=0)&&(e[3].indexOf(i)>=0?(t.vodPcdnOpenBuffer=e[0],t.vodPcdnCloseBuffer=e[1],t.vodPcdnCoolTime=e[2],!0):void 0)}))};this.vodPcdnBufferCfg[1].length>0&&4===this.vodPcdnBufferCfg[1][0].length&&a(this.vodPcdnBufferCfg[1],Number(s)),this.vodPcdnBufferCfg[2].length>0&&4===this.vodPcdnBufferCfg[2][0].length&&a(this.vodPcdnBufferCfg[2],String(i))}}},{key:"enableWebCodec",value:function(){this.openWebcodec=1}},{key:"getFakeHdrBitrate",value:function(e,t){var i=null;this.fakeHdrCfg.some((function(t){return t.auid.indexOf(Number(e))>=0&&(i=t.bitrateMap,!0)}));var s=t;i&&(s=i[t]||s);return s}},{key:"setClosePause500",value:function(e){var t=this.pause500Cfg[1];t.length>0&&-1!=t.indexOf(Number(e))&&(n.a.log("Config.closePause500Report"),this.closePause500=1)}},{key:"setEnableIaas",value:function(e,t,i){1==this.iaasCfgWhiteAuids[0]&&(this.iaasCfg[0]=0,-1!=this.iaasCfgWhiteAuids[1].indexOf(Number(t.presenterUid))&&(this.iaasCfg[0]=1)),-1!=this.iaasCfgBlackAuids.indexOf(Number(t.presenterUid))&&(this.iaasCfg[0]=0)}},{key:"isFrameBuffer",get:function(){return 2}}]),e}());t.a=u},function(e,t,i){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}i.d(t,"a",(function(){return s}))},function(e,t,i){"use strict";function s(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function r(e,t,i){return t&&s(e.prototype,t),i&&s(e,i),e}i.d(t,"a",(function(){return r}))},function(e,t,i){"use strict";function s(e,t){var i=e.toString().length,s=Math.max(0,t-i),r="";if(s>0)for(var a=0;a<s;a++)r+="0";return r+e}var r=0,a={now:function(){if(void 0!==window.performance){var e=window.performance;if(void 0!==e.now)return~~e.now();if(void 0!==e.webkitNow)return~~e.webkitNow();if(void 0!==e.mozNow)return~~e.mozNow();if(void 0!==e.msNow)return~~e.msNow()}0===r&&(r=Date.now()-1);var t=Date.now()-r;return t>4294967295?(r+=4294967295,t-4294967295):t},utc:function(){return Math.round(Date.now()/1e3)},getDateStr:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:NaN,t=null,i=(t=e?new Date(e):new Date).getFullYear(),r=s(t.getMonth()+1,2),a=s(t.getDate(),2);return"".concat(i,"-").concat(r,"-").concat(a)},getTimeStr:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:NaN,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=null,r=s((i=e?new Date(e):new Date).getHours(),2),a=s(i.getMinutes(),2),n=s(i.getSeconds(),2),o="".concat(r,":").concat(a,":").concat(n);if(t){var h=s(i.getMilliseconds(),3);o+="."+h}return o},getDateTimeStr:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:NaN,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=null,r=(i=e?new Date(e):new Date).getFullYear(),a=s(i.getMonth()+1,2),n=s(i.getDate(),2),o=s(i.getHours(),2),h=s(i.getMinutes(),2),u=s(i.getSeconds(),2),l="".concat(r,"-").concat(a,"-").concat(n," ").concat(o,":").concat(h,":").concat(u);if(t){var d=s(i.getMilliseconds(),3);l+="."+d}return l}};t.a=a},function(e,t,i){"use strict";var s=i(13),r={SLICE_SPEED:12.5,MAX_PACKET_CNT:1e4,SWITCH_INTERVAL:10,MAX_DELAY:66e4,DEFAULT_DELAY:65535,SUBSCRIBE_TIMEOUT:1e4,PUNCH_BACK_COOLING:2e4,PUNCH_IGNORE_TIME:3e5,SUB_TIMEOUT:5e3,RESUB_TIMEOUT:3e4,STREAM_DELAY:2e3,EMULATE_DELAY:1800,MAX_DEPTH:1,PROXY_NUM:3,MAX_PEER_STREAM_NUM:8,MAX_PUSH_NUM:3,MAX_PULL_NUM:3,SLICE_DELAY:100,SLICE_LATE:50,SLICE_FAST:50,SLICE_TIMEOUT:2e3,SWITCH_DELAY:500,StreamType:{NONE:0,FORCE:1,FIXED:2,COMPETE:3,PEER:4},LeaveReason:{PING_DIF:1,RESET:2},DEL_REASON:{CHANNEL_CLOSE:1,CHANNEL_ERROR:2,NODE_LEAVE:3,SERVER_REJECT:5,PEER_ERROR:6,PEER_TIMEOUT:7,PING_TIMEOUT:8,OTHER_SID:9,EMPTY_SLICE:10,SUB_TIMEOUT:11,SUB_FAIL_TIMES:12,NODE_REJECT:13,DIF_CDNP:14,PEER_HANDLER_ERR:15},PERIOD:{UPLINK_CALC:10,CHECK_SEED:20,GET_NODE:5},SubType:{SUBSCRIBE_FORCE:0,SUBSCRIBE_NORMAL:1},LoadVideoTimeoutReason:{FLV_DISCONNECTED:0,FLV_CONNECTED:1,FLV_CONNECT_ERROR:2,FLV_RECV_DATA:3,FLV_DATA_INVALID:4,FLV_STARTPLAY:5,FLV_PLAYERROR:6,HLS_DISCONNECTED:7,HLS_LOADMANIFEST_ERROR:8,HLS_LOADMANIFEST_SUCCESS:9,HLS_LOADFRAMENT:10,HLS_LOADFRAMENT_ERROR:11,HLS_LOADFRAMENT_SUCCESS:12,HLS_PLAY_ERROR:13},SubResCode:{ACCEPT_SUBSCRIBE:0,EMPTY_UPLOAD_NUM:1,DETECT_SUBSCRIBE_CYCLE:2,EMPTY_PEER_INFO:3,SUBSCRIBE_UPLINK_NOT_ENOUGH:4,PUBLISHER_KICK_OFF:5,NOT_SUBSCRIBER:6,INVALID_SUB_STREAM:7,ACCEPT_BY_SUBSCRIBER_UPLINK:9,INVALID_STREAMID:10,SERVER_EMPTY_BW:11,PUBLISHER_LEAVE:12,DIFFERENT_VIDEO_PROXY:13,OLD_VERSION_REQ:14,INVALID_TREE_DEPTH:15,INVALID_MAX_SUBSTREAM_NUM:16,STREAM_LATE:17,DEPTH_LARGE:18,STREAM_LIMIT:19,SLICE_LARGE:20,NOT_FOUND_PKG:21,KICK_OUT:22,SELF_WORST:23,SLICE_LATE:24,SLICE_FAST:25,RESTART:26,RESET:27,DIF_BASE_SUBS:28},VIDEO_COMPETE_UID:4294967295,VIDEO_FORCE_UID:0,VIDEO_FIXED_UID:-1,VIDEO_DEFAULT_UID:-2,isProxyUid:function(e){return e===r.VIDEO_COMPETE_UID||e===r.VIDEO_FORCE_UID||e===r.VIDEO_FIXED_UID||e===r.VIDEO_DEFAULT_UID},isCompete:function(e){return e===r.VIDEO_COMPETE_UID},isForce:function(e){return e===r.VIDEO_FORCE_UID},isFixed:function(e){return e===r.VIDEO_FIXED_UID},isDefault:function(e){return e===r.VIDEO_DEFAULT_UID},isSliceJumpFromPeer:function(e,t){return t.isFromPeer&&e>0&&t.seq-e>10*r.LOST_SEQ_NUM},offerReject:{REASON_NOTSTART:1,REASON_PUNCHFAILED_CD:2,REASON_PUNCHED_FULL:3,REASON_QUOTA_EXHAUST:4,REASON_VERSION:5,REASON_DIF_LINE:6,REASON_FAIL:7,REASON_IGNORE:8,REASON_HAS_NODE:9,REASON_WAITING:10,REASON_OTHER:100},offerRejectTime:12e4,punchBackRet:{SUC:0,DIF_STREAM:1,CLOSING:2,COOLING:3,REQUEST:4,REJECT:5},restartReason:{RANGE_SEQ_MAX:1,RANGE_SEQ_LARGE:2,CDN_JUMP:3,PLAYER_NO_DATA:4,LOST_SEQ:5,CONNECT:6,WORKER_ERROR:7,MULTI_CDN:8,FLV_TO_P2P:9,PLAYER_ERROR:10,PLAYER_DISPOSE:11,LOST_SEQ_JUMP:12},turnToFlvReason:{FULL_PLAY_FAIL:1,FULL_CONNECT_TIMEOUT:2,SUB_CONNECT_TIMEOUT:3,FULL_NO_DATA:4,SUB_NO_DATA:5,P2P_ARGS_ERROR:6,P2P_COOLING:7,FLV_TO_P2P_FAIL:8,FLV_TO_P2P_FULL_STREAM_COMPLETE:9,FULL_ERROR:10,FULL_CLOSE:11,SUB_ERROR:12,SUB_CLOSE:13,RESTART_TIMES:14,SIGNAL_TIMEOUT:15,PROBE_TIMEOUT:16,PROBE_ERROR:17,NO_DATA_TIMEOUT:18,IS_NOT_FIRST_FETCH:19,VIDEO_BUFFER_EMPTY:20,PLAY_TIMEOUT:21,NOT_SUPPORT_P2P:22},userProperty:{SERVER_CLOSE:1,CLIENT_CLOSE:2,BROWSER_UN_SUPPORT:3,FLASH:4,UNKNOW:5,P2P:6,FIRST_FULL_CONNECT_TIMEOUT:7,FIRST_FULL_PLAY_FAIL:8,FIRST_FULL_NO_DATA:17,RESTART_RANGE_MAX:9,RESTART_RANGE_LARGE:10,RESTART_CONNECT:11,RESTART_MUTI_CDN:12,RESTART_PLAYER_NO_DATA:13,RESTART_PLAYER_ERROR:14,SUB_NO_DATA:15,SUB_CONNECT_TIMEOUT:16,P2P_ARGS_ERROR:18,FLV_TO_P2P:19,LOST_SEQ:20,P2P_COOLING:21,IS_NOT_FIRST_FETCH:22,VIDEO_BUFFER_EMPTY:23},h265TurnToH264Reason:{DECODE_ERROR:1,RENDER_ERROR:2},pauseReason:{FLV_NO_BUFF:1,FLV_UNKNOW_PAUSE:2,FLV_NET_SLOW:3,P2P_NO_BUFF:4,P2P_UNKNOW_PAUSE:5,P2P_FULL_LOADER_NO_DATA:10,P2P_FULL_LOADER_CONNECT_FAIL:11,P2P_SUB_LOADER_NO_DATA:12,P2P_SUB_LOADER_CONNECT_FAIL:13,FLV_NO_DATA:14,P2P_NO_SLICE:15,P2P_RESEND_SKIP_FRAME:20,P2P_RESEND_TOOLATE:21,P2P_RESEND_TIMEOUT:22,P2P_RESEND_ERROR:23,P2P_RESEND_MISSING:24,P2P_DTS_JUMP:25,P2P_NET_SLOW:26},DataType:{SIGNALLING:0,PING:1,SLICE:2},LOST_SEQ_NUM:4e3,BAD_REASONS:{UNKNOW:100,SUB_LINK:1,DOWN_LINK:2,RANGE_MISS:3,RANGE_RECV_TIMEOUT:4,FRAME_SEQ_LOST:5,BUFFER_JUMP:6,TIMESTAMP_JUMP:7,FRAME_VIDEO_JUMP:8,FRAME_AUDIO_JUMP:9,FRAME_DROP:10,PERFORMANCE:11},initConfig:function(e,t){for(var i=t.coderates,a=null,n=0;n<i.length;n++)if(a=i[n],e>Number(a[0])){r.PROXY_NUM=Number(a[1]),r.SLICE_DELAY=Number(a[2]),r.MAX_PUSH_NUM=Number(a[3]),r.MAX_PULL_NUM=Number(a[4]),r.SLICE_LARGE=Number(a[5]);break}r.MAX_PEER_STREAM_NUM=Number(t.maxPeerStreamNum)||8;var o=r.SLICE_SPEED*s.a.baseSubs*(e/1e3);r.SLICE_LATE=parseInt(o*((Number(t.sliceLate)||1e3)/1e3)),r.SLICE_FAST=parseInt(o*((Number(t.sliceFast)||2e3)/1e3)),r.STREAM_DELAY=Number(t.badDelay)||2e3,r.EMULATE_DELAY=Number(t.emuteDelay)||1800,r.RESUB_TIMEOUT=Number(t.resubTime)||3e4,r.SLICE_TIMEOUT=Number(t.sliceTimeout)||2e3,r.SWITCH_DELAY=Number(t.switchDelay)||500},HLS_LOAD_TYPE:{FETCH:1,XHR:2},LATENCY_MODEL_TYPE:{NONE:0,CONTROL_MODEL:2,RTC_MODEL:4,TOPSPEED_MODEL:99},PLATFORM_TYPE:{web:100,mini_app:102,wap:103,huya_liveshareh5:104,adr:2,ios:3},PLATFORM_TYPE_NAME:{web:"web",wap:"wap"},H5_ERROR_CODE:{VIDEO_ERROR:-1e3,PLAY_TIMEOUT:-1001},VISIBILITY_STATE:{VISIBLE:"visible",HIDDEN:"hidden",PRERENDER:"prerender"},PCDN_OPEN_BUFFER:1e4,PCDN_CLOSE_BUFFER:7e3,PCDN_COOL_TIME:6e4,PLAYER_CORE_TYPE:{MSE:1,WEBCODECS:2}};t.a=r},function(e,t,i){"use strict";function s(e,t){var i=e.toString().length,s=Math.max(0,t-i),r="";if(s>0)for(var a=0;a<s;a++)r+="0";return r+e}i.r(t);var r=new(function(){function e(){p(this,e),this.logArr=[]}return m(e,[{key:"getNow",value:function(){return null!=typeof performance?performance.now():Date.now()}},{key:"log",value:function(){for(var e,t="[".concat((e=new Date).getFullYear(),"-").concat(s(e.getMonth()+1,2),"-").concat(s(e.getDate(),2)," ").concat(s(e.getHours(),2),":").concat(s(e.getMinutes(),2),":").concat(s(e.getSeconds(),2),".")+s(e.getMilliseconds(),3)+"][w-webcodecs]",i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];r[0]=t+r[0],this.logArr.push(r)}},{key:"postMessage",value:function(e,t){var i={type:e};t&&(i.data=t),self.postMessage(i)}}]),e}());t.default=r},function(e,t,i){"use strict";i.d(t,"c",(function(){return s})),i.d(t,"b",(function(){return r})),i.d(t,"d",(function(){return a})),i.d(t,"e",(function(){return n})),i.d(t,"a",(function(){return o}));var s={START:1,POSTFRAME:2,RESIZE:3,CLOSE:4,VISIBILITYCHANGE:5,AUDIOSAMPLES:6,VIDEOSAMPLES:7,AVCCONFIG:8,AVCPPS:9,AVCSPS:10,AACCONFIG:11,UPDATE_VIDEOFPS:12,SET_PLAY_MINBUFFER:13,SET_JITTER:14,SET_USE_SOFTACCELERATION:15,LOCAL_CONFIG:16,PAUSE_VIDEO_DECODE:17,PAUSE_AUDIO_DECODE:18,ENABLE_DISCARD_VIDEO:19,SET_AUDIO_WRITER:20,UPDATE_CURBITRATE:21,INIT_CONFIG:22,AVCVPS:23,RECV_FPS:24,FAST_OVER:25,LOG_CFG:26,UPDATE_SOFTACCELERATION:27},r={WEBGLPLAY:1,STAT:2,PAUSE:3,WORKERSHAREBUFFER:4,RENDERERROR:5,LOG:6,AUDIODECODEDFRAME:7,VIDEODECODEERROR:8,AUDIODECODEERROR:9,INTERVAL:10,WOREKR_READY:11,TURN_TO_WEBCODECS_SOFT:12,AUDIO_PLAY:13,AUDIORENDERERROR:14,SOFT_TURN_TO_MSE:15,AUDIO_FRAME_DECODED:16,DECODE_COST:17,DECODE_DTS:18,WAIT_KEY_FRAME:19,SET_FRAME_PAUSE:20,SET_FRMAE_RESUME:21,RENDER_FPS_PAUSE:22,AUDIO_FORMAT_ERROR:23},a={VIDEODECODEERROR:1,AUDIODECODEERROR:2,VIDEORENDEERROR:3,VIDEOFAST:4,AUDIOFAST:5,WORKERERROR:6,AUDIORENDERERROR:7,NOT_SUPPORT_MEDIASRTREAMTRACK:8,DISABLE_HARDWARE_ACCELERATION:9,SOFT_TURN_TO_MSE:10,WIN_PERF_INSUFFICIENT:11,RETRY_MAX_TIMES:12,DECODE_COST:13,DECODE_DTS:14,BROWSER_NOT_SUPPORTED:15,IS_PUREAUDIO:16,ANGLE_NULL:17,DECODE_ERROR_COOL:18,CHROME_H265_RENDER_INFO_EMPTY:19,IS_NOT_SUPPORT_CONFIGURE:20,IS_NOT_SUPPORT_OS:21,AUDIO_DATA_NAN:22,AUDIO_FORMAT_ERROR:23,AUDIO_DATA_MUTE:24,IS_NOT_SUPPORT_CATEGORY:25},n={VIDEO_PTS:0,VIDEO_RENDER_NUMS:1,VIDEO_NOT_RENDERD_BUFFER:2,AUDIO_TODECODE_NUMS:3,VIDEO_TODECODE_NUMS:4,AUDIO_DECODE_NUMS:5,VIDEO_DECODE_NUMS:6,VIDEO_DECODED_DELAY:7,VIDEO_READY_TO_RENDER_LIST_LEN:8,VIDEO_BUFFER_LEN:9,VIDEO_THROW_FRAME_FPS:11,AUDIO_DTS:12,AUDIO_RENDER_NUMS:13,VIDEO_DECODE_DISCARD_NUMS:14},o={AUDIO_DECODED_BUFFER:15,PAUSE_STATUS:16,AUDIO_DECODED_BUFFER_LEN:17,VIDEO_REAL_FPS:18,IS_SHIELD_AUDIO:19,FRAME_BUFFER_LEN:20}},function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));var s=i(3),r=i(4),a=i(24),n=i(2),o=i(20),h=(i(0),i(10)),u=i(21),l=i(1),d=function(){function e(){Object(s.a)(this,e)}return Object(r.a)(e,null,[{key:"turnStr",value:function(e,t,i){for(var s=e.toString(t),r=s.length;r<i;r++)s="0"+s;return s}},{key:"rotl64",value:function(t,i){var s=e.turnStr(t,2,64),r=s.substring(0,32),a=s.substring(32),n=a.substr(i,32-i)+a.substr(0,i);return parseInt(r+n,2)}},{key:"rotr64",value:function(t,i){var s=e.turnStr(t,2,64),r=s.substring(0,32),a=s.substring(32),n=a.substr(32-i,i)+a.substr(0,32-i);return parseInt(r+n,2)}},{key:"rotUid",value:function(t,i){return 0===t&&(t="1234"+e.turnStr(parseInt(9999*Math.random()),10,4)),isNaN(i)&&(i=0),t=parseInt(t),i=parseInt(i),e.rotl64(t,8)}},{key:"revertUid",value:function(t,i){return t=parseInt(t),e.rotr64(t,8)}},{key:"inet_ntoa",value:function(e){var t,i,s,r=new Uint8Array(4),a=new DataView(r.buffer);return a.setUint32(0,e),t=a.getUint8(0),i=a.getUint8(1),s=a.getUint8(2),a.getUint8(3)+"."+s+"."+i+"."+t}},{key:"ip2uint",value:function(e){for(var t=0,i=e.split("."),s=0;s<i.length;s++)t|=Number(i[s])<<8*s;return t<0&&(t+=4294967296),t}},{key:"isBiggerUint",value:function(e,t){return e!==t&&(e>t?e-t<2147483647:!(t-e<2147483647))}},{key:"isEqualOrBiggerUint",value:function(e,t){return e===t||(e>t?e-t<2147483647:!(t-e<2147483647))}},{key:"isUintMax",value:function(e){return 4294967295===e}},{key:"isUint64Max",value:function(e){return 0x10000000000000000===e}},{key:"getQueryString",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),s=(t||window.location.search.substr(1)).match(i);return null!=s?unescape(s[2]):null}},{key:"printHexBytes",value:function(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=new DataView(e.buffer),s=t?10:0,r=[];s<i.byteLength;){var a=i.getUint8(s++);(a=a.toString(16).toUpperCase()).length<2&&(a="0"+a),r.push(a,"\t"),s%10==0&&r.push("\n")}console.log(r.join("")+"\tsize:",i.byteLength)}},{key:"getCookie",value:function(e){for(var t=e+"=",i=document.cookie.split(";"),s=0,r=i.length;s<r;s++){var a=i[s].trim();if(0==a.indexOf(t))return a.substr(t.length)}return""}},{key:"formatByteSize",value:function(e){var t=e/1024;return t>1024?(t/=1024).toFixed(1)+"MB":t.toFixed(1)+"KB"}},{key:"padStrLen",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e.length>=t)return e;var s=" ".repeat(t-e.length);return i?s+e:e+s}},{key:"xhr",value:function(e,t,i,s,r){var a=new XMLHttpRequest;a.overrideMimeType("text/plain; charset=x-user-defined"),a.addEventListener("readystatechange",(function e(){4===a.readyState&&(200===a.status||304===a.status?s(a.response):r(a.status),a.removeEventListener("readystatechange",e),a=void 0)})),a.open(t,e,!0),a.send(i)}},{key:"getAv1Random",value:function(e,t){if(!e)return!1;var i=localStorage.av1PresentUid,s=e.presenterUid;localStorage.randomAv1Percent&&i==s||(localStorage.randomAv1Percent=Math.floor(1e4*Math.random()));var r=Number(localStorage.randomAv1Percent);return localStorage.av1PresentUid=e.presenterUid,r<t}},{key:"is64bitSoftware",value:function(){return-1!=navigator.userAgent.indexOf("Macintosh")||-1!=navigator.userAgent.indexOf("x64")}},{key:"isGameIdSupport265",value:function(e,t){if(e[0])return!0;var i=!1;return e[1].map((function(e){t&&t.toString()==e.toString()&&(i=!0)})),i}},{key:"unescapeHTML",value:function(e){return(e=""+e).replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/&#39;/g,"'").replace("↵","")}},{key:"getSdkAbRandom",value:function(e,t){var i=localStorage.abPresentUid;localStorage.randomAbPercent&&i==e.presenterUid||(localStorage.randomAbPercent=Math.floor(1e4*Math.random()));var s=Number(localStorage.randomAbPercent);return localStorage.abPresentUid=e.presenterUid,s<t}},{key:"removeUrlParam",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!e)return e;var i=e.split("?"),s=i[0],r=i.length>1?i[1]:"";if(!r)return e;for(var a={},n=r.split("&"),o=0;o<n.length;o++)n[o]=n[o].split("="),a[n[o][0]]=n[o][1];return t.forEach((function(e){r.indexOf(e)>-1&&delete a[e]})),s+JSON.stringify(a).replace(/[\"\{\}]/g,"").replace(/\:/g,"=").replace(/\,/g,"&")}},{key:"removeUrlAllParam",value:function(e){return e?e.split("?")[0]:e}},{key:"isWebCodecsSupported",value:function(){return!("undefined"==typeof VideoDecoder||"undefined"==typeof SharedArrayBuffer||"undefined"==typeof Atomics)&&navigator.hardwareConcurrency>=n.a.webCodecCfg[0]}},{key:"isWebcodecsBrowserSupported",value:function(){var e=navigator.userAgent.toLowerCase(),t=-1!=e.indexOf("yabrowser")||-1!=e.indexOf("yowser");return"opera"!=h.a.name&&!t}},{key:"checkWebCodec",value:function(t,i,s){if(s&&!u.a.isMseSupportedHevc())return!1;var r=t.presenterUid,a=(t.uid,t.curBitrate);n.a.webCodecsAnchoruids.indexOf(Number(r))>=0&&n.a.enableWebCodec();var d=a<=n.a.webCodecCfg[1],c=n.a.openWebcodec&&d,p=o.a.os||"",f=o.a.osVersion||"";if("windows"==p.toLocaleLowerCase()&&Number(f)>=10&&-1!==h.a.name.indexOf("edg")&&h.a.version.major>=n.a.h265MseChromeConfig[0]&&s||"windows"==p.toLocaleLowerCase()&&Number(f)>=10&&-1!==h.a.name.indexOf("chrome")&&h.a.version.major>=n.a.h265MseChromeConfig[0]&&s?c=!0:s&&(c=!1),-1!==n.a.wcs265BlackUids.indexOf(Number(t.uid))&&(c=!1),n.a.webCodecBlackUids.indexOf(Number(r))>=0&&(c=!1),-1!=n.a.wcsBlackBrowVers.indexOf(h.a.version.major)&&(c=!1,i.setComDim(l.a.DIM_COM.WEBCODECS_BACK_REASON,26)),-1!==n.a.wcs265BlackBrowVers.indexOf(h.a.version.major)&&s){c=!1;var m=n.a.bitrateBrowHard265Cfg[0],_=n.a.bitrateBrowHard265Cfg[1],y=n.a.bitrateBrowHard265Cfg[2];1==m&&t.curBitrate<=_&&-1!==y.indexOf(h.a.version.major)&&(c=!0),c||i.setComDim(l.a.DIM_COM.WEBCODECS_BACK_REASON,27)}return-1===n.a.wcs264BlackBrowVers.indexOf(h.a.version.major)||s||(c=!1,i.setComDim(l.a.DIM_COM.WEBCODECS_BACK_REASON,28)),c=c&&e.isWebCodecsSupported(),1==Number(localStorage._forceWebcodecs)&&(c=!0),1==Number(localStorage._forceMse)&&(c=!1),c}},{key:"getDecodeMod",value:function(e,t,i){var s="mseh";return e?s="wcs":t?s="wasm":i&&(s="chrome"==h.a.name&&h.a.version.major>104||"safari"==h.a.name?"mseh":"mses"),s}},{key:"getDMod",value:function(e,t){return"mseh"!==e&&"wcs"!==e&&"wasm"!==e&&"mses"!==e&&(e="unknow"),t=Number(t),isNaN(t)&&(t=0),"".concat(e,"-").concat(t)}},{key:"checkDMod",value:function(t,i,s){return-1===t.indexOf("&dMod=")&&(t+=-1===t.indexOf("?")?"?":"&",t+="dMod=".concat(e.getDMod(i,s))),t}},{key:"getAv1Support",value:function(e,t,i,s){var r=5;return e&&(r=t?i?2:s?3:4:1),r}},{key:"getSupportMod",value:function(t,i,s,r){var a=u.a.isMseSupportedHevc(),o=a&&h.a.chrome&&h.a.version.major>=n.a.h265MseChromeConfig[0],l=0;if(s&&(l|=64),3!==r&&4!==r||(l|=128),e.isWebCodecsSupported()&&(l|=1),t&&(l|=2),o&&(l|=8,e.isWebCodecsSupported()&&(l|=16)),a){var d=n.a.h265MseConfig[1];if(d.length>0){var c=h.a.version.major;h.a.chrome&&d.indexOf(c)>=0&&(l|=4)}}return i&&(l|=32),l}},{key:"isOpen",value:function(t,i,s){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=e.getCfgValue(t,i,s);return-1===a?r:100*Math.random()<a}},{key:"getCfgValue",value:function(t,i,s){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1;i+="|",s="line"+s+":";for(var a=(t+="").split(","),n="",o="",h=a.length,u=0;u<h;u++){var l=a[u];-1!==l.indexOf(i)?n=l.replace(i,""):-1!==l.indexOf("all|")&&(o=l.replace("all|",""))}var d=r,c=r;return""!==n&&(d=e.getLineValue(n,s,r)),""!==o&&(c=e.getLineValue(o,s,r)),d!==r?d:c!==r?c:r}},{key:"getLineValue",value:function(t,i){for(var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,r=t.split("_"),a=r.length,n=s,o=s,h=0;h<a;h++){var u=r[h];-1!==u.indexOf("all")?n=e.getValue(u,s):-1!==u.indexOf(i)&&(o=e.getValue(u,s))}return o!==s?o:n!==s?n:s}},{key:"getValue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,i=t,s=e.split(":");return s.length>1&&(i=parseInt(s[1]),isNaN(i)&&(i=t)),i}},{key:"getBrowserHidden",value:function(){return document.hidden||document.webkitHidden||document.mozHidden||document.msHidden}},{key:"isMseSupportedHevc",value:function(){return u.a.isMseSupportedHevc()}}]),e}();function c(e){return atob(e)}Object(a.a)(d,"indateLocalStorage",{set:function(e,t,i){var s={value:t,expirse:new Date(i).getTime()};localStorage[e]=JSON.stringify(s)},get:function(e){var t=JSON.parse(localStorage[e]);if(null!==t){if(!(null!=t.expirse&&t.expirse<(new Date).getTime()))return t.value;delete localStorage[e]}return null},update:function(e,t){var i=JSON.parse(localStorage[e]);i&&(i.value=t,localStorage[e]=JSON.stringify(i))}}),d.IntMax=2147483647,d.IntMin=-2147483647,d.UintMax=4294967295,t.b=d},function(e,t,i){"use strict";var s={};self||(self=window),function(){var e=self.navigator.userAgent.toLowerCase(),t=/(edge)\/([\w.]+)/.exec(e)||/(edg)\/([\w.]+)/.exec(e)||/(opr)[\/]([\w.]+)/.exec(e)||/(chrome)[ \/]([\w.]+)/.exec(e)||/(iemobile)[\/]([\w.]+)/.exec(e)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(e)||[],i=/(ipad)/.exec(e)||/(ipod)/.exec(e)||/(windows phone)/.exec(e)||/(iphone)/.exec(e)||/(kindle)/.exec(e)||/(android)/.exec(e)||/(windows)/.exec(e)||/(mac)/.exec(e)||/(linux)/.exec(e)||/(cros)/.exec(e)||[],r={browser:t[5]||t[3]||t[1]||"",version:t[2]||t[4]||"0",majorVersion:t[4]||t[2]||"0",platform:i[0]||""},a={};if(r.browser){a[r.browser]=!0;var n=r.majorVersion.split(".");a.version={major:parseInt(r.majorVersion,10),string:r.version,majorVersion:r.majorVersion},n.length>1&&(a.version.minor=parseInt(n[1],10)),n.length>2&&(a.version.build=parseInt(n[2],10))}for(var o in r.platform&&(a[r.platform]=!0),(a.chrome||a.opr||a.safari)&&(a.webkit=!0),(a.rv||a.iemobile)&&(a.rv&&delete a.rv,r.browser="msie",a.msie=!0),a.edge&&(delete a.edge,r.browser="msedge",a.chrome=!0),a.edg&&(delete a.edg,r.browser="msedge",a.chrome=!0),a.opr&&(r.browser="opera",a.opera=!0),a.safari&&a.android&&(r.browser="android",a.android=!0),a.name=r.browser,a.platform=r.platform,s)s.hasOwnProperty(o)&&delete s[o];Object.assign(s,a)}(),s.version||(s.version={major:0,minor:0,build:0,string:"0.0.0"}),t.a=s},function(e,t,i){"use strict";function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}i.d(t,"a",(function(){return s}))},function(e,t,i){"use strict";function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}i.d(t,"a",(function(){return s}))},function(e,t,i){"use strict";var s=i(3),r=i(4),a=i(0),n=new(function(){function e(){Object(s.a)(this,e),this.sdkVersion=2308081438,this.version=1100,this.baseSubs=10,this.uid=0,this.sGuid="",this.roomId=0,this.uuid=0,this.convertUid=0,this.appId=66,this.appid=66,this.p2pCooling=!1,this.flvTryToP2P=0}return Object(r.a)(e,[{key:"initUUId",value:function(){0===this.uuid&&(this.uuid=Number((Date.now()%1e10*1e3+(1e3*Math.random()|0))%4294967295));var e=Number(localStorage.appid);e&&(this.appid=e,a.a.warn("--- test appid "+e+" ---",this))}},{key:"getAnonymouUid",value:function(){var e=Number(localStorage.sdk_anonymousuid);return e||(e=Number((Date.now()%1e10*1e3+(1e3*Math.random()|0))%4294967295),localStorage.sdk_anonymousuid=e),e}}]),e}());t.a=n},function(e,t,i){"use strict";i.d(t,"a",(function(){return h}));var s=i(11);function r(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function a(e){return(a="function"==typeof Symbol&&"symbol"==_(Symbol.iterator)?function(e){return _(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":_(e)})(e)}var n=i(12);function o(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?Object(n.a)(e):t}function h(e){return function(){var t,i=Object(s.a)(e);if(r()){var a=Object(s.a)(this).constructor;t=Reflect.construct(i,arguments,a)}else t=i.apply(this,arguments);return o(this,t)}}},function(e,t,i){"use strict";function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}i.d(t,"a",(function(){return r}))},function(e,t,i){"use strict";i.r(t),i.d(t,"WebCodecsErrType",(function(){return s})),i.d(t,"ReceiveMessageType",(function(){return r})),i.d(t,"ToMainMessageType",(function(){return a})),i.d(t,"StoreWorkerType",(function(){return n})),i.d(t,"MainSharedBufferType",(function(){return o}));var s={VIDEODECODEERROR:1,AUDIODECODEERROR:2,VIDEORENDEERROR:3,VIDEOFAST:4,AUDIOFAST:5,WORKERERROR:6},r={START:1,POSTFRAME:2,RESIZE:3,COLSE:4,VISIBILITYCHANGE:5,AUDIOSAMPLES:6,VIDEOSAMPLES:7,AVCCONFIG:8,AVCPPS:9,AVCSPS:10,AACCONFIG:11,UPDATE_VIDEOFPS:12,SET_PLAY_MINBUFFER:13,SET_JITTER:14,SET_USE_SOFTACCELERATION:15,LOCAL_CONFIG:16,PAUSE_VIDEO_DECODE:17,PAUSE_AUDIO_DECODE:18,ENABLE_DISCARD_VIDEO:19,SET_AUDIO_WRITER:20,UPDATE_CURBITRATE:21,INIT_CONFIG:22,AVCVPS:23,RECV_FPS:24,FAST_OVER:25,LOG_CFG:26,UPDATE_SOFTACCELERATION:27},a={WebGLPLAY:1,STAT:2,PAUSE:3,WORKERSHAREBUFFER:4,VIDEORENDERERROR:5,LOG:6,AUDIODECODEDFRAME:7,VIDEODECODEERROR:8,AUDIODECODEERROR:9,INTERVAL:10,WOREKR_READY:11,TURN_TO_WEBCODECS_SOFT:12,AUDIO_PLAY:13,AUDIORENDERERROR:14,SOFT_TURN_TO_MSE:15,AUDIO_FRAME_DECODED:16,DECODE_COST:17,DECODE_DTS:18,WAIT_KEY_FRAME:19,SET_FRAME_PAUSE:20,SET_FRMAE_RESUME:21,RENDER_FPS_PAUSE:22,AUDIO_FORMAT_ERROR:23},n={VIDEO_PTS:0,VIDEO_RENDER_NUMS:1,VIDEO_NOT_RENDERD_BUFFER:2,AUDIO_TODECODE_NUMS:3,VIDEO_TODECODE_NUMS:4,AUDIO_DECODE_NUMS:5,VIDEO_DECODE_NUMS:6,VIDEO_DECODED_DELAY:7,VIDEO_READY_TO_RENDER_LIST_LEN:8,VIDEO_BUFFER_LEN:9,VIDEO_THROW_FRAME_FPS:11,AUDIO_DTS:12,AUDIO_RENDER_NUMS:13,VIDEO_DECODE_DISCARD_NUMS:14},o={AUDIO_DECODED_BUFFER:15,PAUSE_STATUS:16,AUDIO_DECODED_BUFFER_LEN:17,VIDEO_REAL_FPS:18,IS_SHIELD_AUDIO:19,FRAME_BUFFER_LEN:20}},function(e,t,i){"use strict";i.r(t);var s={},r={setTaf:function(e){return s=e}};t.default=r,r.UserId=function(){this.lUid=0,this.sGuid="",this.sToken="",this.sHuYaUA="",this.sCookie="",this.iTokenType=0},r.UserId.prototype._clone=function(){return new r.UserId},r.UserId.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.UserId.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.UserId.prototype.writeTo=function(e){e.writeInt64(0,this.lUid),e.writeString(1,this.sGuid),e.writeString(2,this.sToken),e.writeString(3,this.sHuYaUA),e.writeString(4,this.sCookie),e.writeInt32(5,this.iTokenType)},r.UserId.prototype.readFrom=function(e){this.lUid=e.readInt64(0,!1,this.lUid),this.sGuid=e.readString(1,!1,this.sGuid),this.sToken=e.readString(2,!1,this.sToken),this.sHuYaUA=e.readString(3,!1,this.sHuYaUA),this.sCookie=e.readString(4,!1,this.sCookie),this.iTokenType=e.readInt32(5,!1,this.iTokenType)},r.VideoGatewayProxy2VGPingReq=function(){this.lLocalTime=0},r.VideoGatewayProxy2VGPingReq.prototype._clone=function(){return new r.VideoGatewayProxy2VGPingReq},r.VideoGatewayProxy2VGPingReq.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.VideoGatewayProxy2VGPingReq.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.VideoGatewayProxy2VGPingReq.prototype.writeTo=function(e){e.writeInt64(0,this.lLocalTime)},r.VideoGatewayProxy2VGPingReq.prototype.readFrom=function(e){this.lLocalTime=e.readInt64(0,!1,this.lLocalTime)},r.VideoGatewayProxy2VGPingRsp=function(){this.lLocalTime=0},r.VideoGatewayProxy2VGPingRsp.prototype._clone=function(){return new r.VideoGatewayProxy2VGPingRsp},r.VideoGatewayProxy2VGPingRsp.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.VideoGatewayProxy2VGPingRsp.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.VideoGatewayProxy2VGPingRsp.prototype.writeTo=function(e){e.writeInt64(0,this.lLocalTime)},r.VideoGatewayProxy2VGPingRsp.prototype.readFrom=function(e){this.lLocalTime=e.readInt64(0,!1,this.lLocalTime)},r.GetInfoFromVGReq=function(){this.lUid=0,this.iServiceType=0,this.iClientType=0,this.iClientIp=0,this.iTerminalType=0,this.iRequestVPType=0,this.sMsg=new s.BinBuffer,this.iUri=0,this.sProtoName="",this.lSid=0,this.vStreamName=new s.Vector(new s.STRING),this.tId=new r.UserId},r.GetInfoFromVGReq.prototype._clone=function(){return new r.GetInfoFromVGReq},r.GetInfoFromVGReq.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.GetInfoFromVGReq.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.GetInfoFromVGReq.prototype.writeTo=function(e){e.writeInt64(0,this.lUid),e.writeInt32(1,this.iServiceType),e.writeInt32(2,this.iClientType),e.writeInt64(3,this.iClientIp),e.writeInt32(4,this.iTerminalType),e.writeInt32(5,this.iRequestVPType),e.writeBytes(6,this.sMsg),e.writeInt64(7,this.iUri),e.writeString(8,this.sProtoName),e.writeInt64(9,this.lSid),e.writeVector(10,this.vStreamName),e.writeStruct(11,this.tId)},r.GetInfoFromVGReq.prototype.readFrom=function(e){this.lUid=e.readInt64(0,!1,this.lUid),this.iServiceType=e.readInt32(1,!1,this.iServiceType),this.iClientType=e.readInt32(2,!1,this.iClientType),this.iClientIp=e.readInt64(3,!1,this.iClientIp),this.iTerminalType=e.readInt32(4,!1,this.iTerminalType),this.iRequestVPType=e.readInt32(5,!1,this.iRequestVPType),this.sMsg=e.readBytes(6,!1,this.sMsg),this.iUri=e.readInt64(7,!1,this.iUri),this.sProtoName=e.readString(8,!1,this.sProtoName),this.lSid=e.readInt64(9,!1,this.lSid),this.vStreamName=e.readVector(10,!1,this.vStreamName),this.tId=e.readStruct(11,!1,this.tId)},r.GetInfoFromVGRsp=function(){this.lUid=0,this.ServerId=0,this.sMsg=new s.BinBuffer,this.iUri=0,this.sProtoName=""},r.GetInfoFromVGRsp.prototype._clone=function(){return new r.GetInfoFromVGRsp},r.GetInfoFromVGRsp.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.GetInfoFromVGRsp.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.GetInfoFromVGRsp.prototype.writeTo=function(e){e.writeInt64(0,this.lUid),e.writeInt64(1,this.ServerId),e.writeBytes(2,this.sMsg),e.writeInt64(3,this.iUri),e.writeString(4,this.sProtoName)},r.GetInfoFromVGRsp.prototype.readFrom=function(e){this.lUid=e.readInt64(0,!1,this.lUid),this.ServerId=e.readInt64(1,!1,this.ServerId),this.sMsg=e.readBytes(2,!1,this.sMsg),this.iUri=e.readInt64(3,!1,this.iUri),this.sProtoName=e.readString(4,!1,this.sProtoName)},r.GetCdnTokenExReq=function(){this.sFlvUrl="",this.sStreamName="",this.iLoopTime=0,this.tId=new r.UserId,this.iAppId=66},r.GetCdnTokenExReq.prototype._clone=function(){return new r.GetCdnTokenExReq},r.GetCdnTokenExReq.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.GetCdnTokenExReq.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.GetCdnTokenExReq.prototype.writeTo=function(e){e.writeString(0,this.sFlvUrl),e.writeString(1,this.sStreamName),e.writeInt32(2,this.iLoopTime),e.writeStruct(3,this.tId),e.writeInt32(4,this.iAppId)},r.GetCdnTokenExReq.prototype.readFrom=function(e){this.sFlvUrl=e.readString(0,!1,this.sFlvUrl),this.sStreamName=e.readString(1,!1,this.sStreamName),this.iLoopTime=e.readInt32(2,!1,this.iLoopTime),this.tId=e.readStruct(3,!1,this.tId),this.iAppId=e.readInt32(4,!1,this.iAppId)},r.GetCdnTokenExRsp=function(){this.sFlvToken="",this.iExpireTime=0},r.GetCdnTokenExRsp.prototype._clone=function(){return new r.GetCdnTokenExRsp},r.GetCdnTokenExRsp.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.GetCdnTokenExRsp.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.GetCdnTokenExRsp.prototype.writeTo=function(e){e.writeString(0,this.sFlvToken),e.writeInt32(1,this.iExpireTime)},r.GetCdnTokenExRsp.prototype.readFrom=function(e){this.sFlvToken=e.readString(0,!1,this.sFlvToken),this.iExpireTime=e.readInt32(1,!1,this.iExpireTime)},r.LiveScenarioType={ECommon_Live:0,EAudio_Only:1,EVideo_Only:2,ELink_Live:3},r.LimitedStreamInfo=function(){this.iVerMin=0,this.iVerMax=0,this.sCdnType="",this.iIsMaster=0,this.lChannelId=0,this.lSubChannelId=0,this.lPresenterUid=0,this.sStreamName="",this.sFlvUrl="",this.sFlvUrlSuffix="",this.sFlvAntiCode="",this.sHlsUrl="",this.sHlsUrlSuffix="",this.sHlsAntiCode="",this.iLineIndex=0,this.iIsMultiStream=0,this.iPCPriorityRate=0,this.iWebPriorityRate=0,this.iMobilePriorityRate=0,this.vFlvIPList=new s.Vector(new s.STRING),this.iIsP2PSupport=0,this.sP2pUrl="",this.sP2pUrlSuffix="",this.sP2pAntiCode="",this.lFreeFlag=0},r.LimitedStreamInfo.prototype._clone=function(){return new r.LimitedStreamInfo},r.LimitedStreamInfo.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.LimitedStreamInfo.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.LimitedStreamInfo.prototype.writeTo=function(e){e.writeInt32(0,this.iVerMin),e.writeInt32(1,this.iVerMax),e.writeString(2,this.sCdnType),e.writeInt32(3,this.iIsMaster),e.writeInt64(4,this.lChannelId),e.writeInt64(5,this.lSubChannelId),e.writeInt64(6,this.lPresenterUid),e.writeString(7,this.sStreamName),e.writeString(8,this.sFlvUrl),e.writeString(9,this.sFlvUrlSuffix),e.writeString(10,this.sFlvAntiCode),e.writeString(11,this.sHlsUrl),e.writeString(12,this.sHlsUrlSuffix),e.writeString(13,this.sHlsAntiCode),e.writeInt32(14,this.iLineIndex),e.writeInt32(15,this.iIsMultiStream),e.writeInt32(16,this.iPCPriorityRate),e.writeInt32(17,this.iWebPriorityRate),e.writeInt32(18,this.iMobilePriorityRate),e.writeVector(19,this.vFlvIPList),e.writeInt32(20,this.iIsP2PSupport),e.writeString(21,this.sP2pUrl),e.writeString(22,this.sP2pUrlSuffix),e.writeString(23,this.sP2pAntiCode),e.writeInt64(24,this.lFreeFlag)},r.LimitedStreamInfo.prototype.readFrom=function(e){this.iVerMin=e.readInt32(0,!1,this.iVerMin),this.iVerMax=e.readInt32(1,!1,this.iVerMax),this.sCdnType=e.readString(2,!1,this.sCdnType),this.iIsMaster=e.readInt32(3,!1,this.iIsMaster),this.lChannelId=e.readInt64(4,!1,this.lChannelId),this.lSubChannelId=e.readInt64(5,!1,this.lSubChannelId),this.lPresenterUid=e.readInt64(6,!1,this.lPresenterUid),this.sStreamName=e.readString(7,!1,this.sStreamName),this.sFlvUrl=e.readString(8,!1,this.sFlvUrl),this.sFlvUrlSuffix=e.readString(9,!1,this.sFlvUrlSuffix),this.sFlvAntiCode=e.readString(10,!1,this.sFlvAntiCode),this.sHlsUrl=e.readString(11,!1,this.sHlsUrl),this.sHlsUrlSuffix=e.readString(12,!1,this.sHlsUrlSuffix),this.sHlsAntiCode=e.readString(13,!1,this.sHlsAntiCode),this.iLineIndex=e.readInt32(14,!1,this.iLineIndex),this.iIsMultiStream=e.readInt32(15,!1,this.iIsMultiStream),this.iPCPriorityRate=e.readInt32(16,!1,this.iPCPriorityRate),this.iWebPriorityRate=e.readInt32(17,!1,this.iWebPriorityRate),this.iMobilePriorityRate=e.readInt32(18,!1,this.iMobilePriorityRate),this.vFlvIPList=e.readVector(19,!1,this.vFlvIPList),this.iIsP2PSupport=e.readInt32(20,!1,this.iIsP2PSupport),this.sP2pUrl=e.readString(21,!1,this.sP2pUrl),this.sP2pUrlSuffix=e.readString(22,!1,this.sP2pUrlSuffix),this.sP2pAntiCode=e.readString(23,!1,this.sP2pAntiCode),this.lFreeFlag=e.readInt64(24,!1,this.lFreeFlag)},r.ClassifiedStreamInfoPack=function(){this.iLiveScenarioType=0,this.vStreamInfo=new s.Vector(new r.LimitedStreamInfo),this.vCdnList=new s.Vector(new s.STRING),this.lLiveId=0,this.sLinkGroupId="",this.mStreamRatioWeb=new s.Map(new s.STRING,new s.INT32),this.mStreamRatioPC=new s.Map(new s.STRING,new s.INT32),this.mStreamRatioMobile=new s.Map(new s.STRING,new s.INT32)},r.ClassifiedStreamInfoPack.prototype._clone=function(){return new r.ClassifiedStreamInfoPack},r.ClassifiedStreamInfoPack.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.ClassifiedStreamInfoPack.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.ClassifiedStreamInfoPack.prototype.writeTo=function(e){e.writeInt32(0,this.iLiveScenarioType),e.writeVector(1,this.vStreamInfo),e.writeVector(2,this.vCdnList),e.writeInt64(3,this.lLiveId),e.writeString(4,this.sLinkGroupId),e.writeMap(5,this.mStreamRatioWeb),e.writeMap(6,this.mStreamRatioPC),e.writeMap(7,this.mStreamRatioMobile)},r.ClassifiedStreamInfoPack.prototype.readFrom=function(e){this.iLiveScenarioType=e.readInt32(0,!1,this.iLiveScenarioType),this.vStreamInfo=e.readVector(1,!1,this.vStreamInfo),this.vCdnList=e.readVector(2,!1,this.vCdnList),this.lLiveId=e.readInt64(3,!1,this.lLiveId),this.sLinkGroupId=e.readString(4,!1,this.sLinkGroupId),this.mStreamRatioWeb=e.readMap(5,!1,this.mStreamRatioWeb),this.mStreamRatioPC=e.readMap(6,!1,this.mStreamRatioPC),this.mStreamRatioMobile=e.readMap(7,!1,this.mStreamRatioMobile)},r.LivingStreamInfoNotice=function(){this.lPresenterUid=0,this.lLiveId=0,this.mStreamInfo=new s.Map(new s.INT32,new r.ClassifiedStreamInfoPack)},r.LivingStreamInfoNotice.prototype._clone=function(){return new r.LivingStreamInfoNotice},r.LivingStreamInfoNotice.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.LivingStreamInfoNotice.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.LivingStreamInfoNotice.prototype.writeTo=function(e){e.writeInt64(0,this.lPresenterUid),e.writeInt64(1,this.lLiveId),e.writeMap(2,this.mStreamInfo)},r.LivingStreamInfoNotice.prototype.readFrom=function(e){this.lPresenterUid=e.readInt64(0,!1,this.lPresenterUid),this.lLiveId=e.readInt64(1,!1,this.lLiveId),this.mStreamInfo=e.readMap(2,!1,this.mStreamInfo)},r.LivingStreamEndNotice=function(){this.sStreamName="",this.sCdnType="",this.iLineIndex=0,this.lLiveId=0,this.iLiveScenarioType=0},r.LivingStreamEndNotice.prototype._clone=function(){return new r.LivingStreamEndNotice},r.LivingStreamEndNotice.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.LivingStreamEndNotice.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.LivingStreamEndNotice.prototype.writeTo=function(e){e.writeString(0,this.sStreamName),e.writeString(1,this.sCdnType),e.writeInt32(2,this.iLineIndex),e.writeInt64(3,this.lLiveId),e.writeInt32(4,this.iLiveScenarioType)},r.LivingStreamEndNotice.prototype.readFrom=function(e){this.sStreamName=e.readString(0,!1,this.sStreamName),this.sCdnType=e.readString(1,!1,this.sCdnType),this.iLineIndex=e.readInt32(2,!1,this.iLineIndex),this.lLiveId=e.readInt64(3,!1,this.lLiveId),this.iLiveScenarioType=e.readInt32(4,!1,this.iLiveScenarioType)},r.GetLivingStreamInfoReq=function(){this.tId=new r.UserId,this.lTopSid=0,this.lSubSid=0,this.lPresenterUid=0,this.sTraceSource=""},r.GetLivingStreamInfoReq.prototype._clone=function(){return new r.GetLivingStreamInfoReq},r.GetLivingStreamInfoReq.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.GetLivingStreamInfoReq.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.GetLivingStreamInfoReq.prototype.writeTo=function(e){e.writeStruct(0,this.tId),e.writeInt64(1,this.lTopSid),e.writeInt64(2,this.lSubSid),e.writeInt64(3,this.lPresenterUid),e.writeString(4,this.sTraceSource)},r.GetLivingStreamInfoReq.prototype.readFrom=function(e){this.tId=e.readStruct(0,!1,this.tId),this.lTopSid=e.readInt64(1,!1,this.lTopSid),this.lSubSid=e.readInt64(2,!1,this.lSubSid),this.lPresenterUid=e.readInt64(3,!1,this.lPresenterUid),this.sTraceSource=e.readString(4,!1,this.sTraceSource)},r.GetLivingStreamInfoRsp=function(){this.bIsLiving=0,this.tNotice=new r.LivingStreamInfoNotice,this.bIsSelfLiving=0},r.GetLivingStreamInfoRsp.prototype._clone=function(){return new r.GetLivingStreamInfoRsp},r.GetLivingStreamInfoRsp.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.GetLivingStreamInfoRsp.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.GetLivingStreamInfoRsp.prototype.writeTo=function(e){e.writeInt32(0,this.bIsLiving),e.writeStruct(1,this.tNotice),e.writeInt32(2,this.bIsSelfLiving)},r.GetLivingStreamInfoRsp.prototype.readFrom=function(e){this.bIsLiving=e.readInt32(0,!1,this.bIsLiving),this.tNotice=e.readStruct(1,!1,this.tNotice),this.bIsSelfLiving=e.readInt32(2,!1,this.bIsSelfLiving)},r.VideoClientReportReq=function(){this.iReportType=0,this.sReportString="",this.sMsg=new s.BinBuffer,this.lUid=0},r.VideoClientReportReq.prototype._clone=function(){return new r.VideoClientReportReq},r.VideoClientReportReq.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.VideoClientReportReq.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.VideoClientReportReq.prototype.writeTo=function(e){e.writeInt32(0,this.iReportType),e.writeString(1,this.sReportString),e.writeBytes(2,this.sMsg),e.writeInt64(3,this.lUid)},r.VideoClientReportReq.prototype.readFrom=function(e){this.iReportType=e.readInt32(0,!1,this.iReportType),this.sReportString=e.readString(1,!1,this.sReportString),this.sMsg=e.readBytes(2,!1,this.sMsg),this.lUid=e.readInt64(3,!1,this.lUid)},r.LiveMeetingSyncNotice=function(){this.tStat=new r.MeetingStat,this.vSeats=new s.Vector(new r.MeetingSeat),this.iVersion=0,this.sMessage=""},r.LiveMeetingSyncNotice.prototype._clone=function(){return new r.LiveMeetingSyncNotice},r.LiveMeetingSyncNotice.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.LiveMeetingSyncNotice.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.LiveMeetingSyncNotice.prototype.writeTo=function(e){e.writeStruct(0,this.tStat),e.writeVector(1,this.vSeats),e.writeInt32(2,this.iVersion),e.writeString(3,this.sMessage)},r.LiveMeetingSyncNotice.prototype.readFrom=function(e){this.tStat=e.readStruct(0,!1,this.tStat),this.vSeats=e.readVector(1,!1,this.vSeats),this.iVersion=e.readInt32(2,!1,this.iVersion),this.sMessage=e.readString(3,!1,this.sMessage)},r.MeetingStat=function(){this.lPresenterUid=0,this.sPresenterNick="",this.sPresenterAvatarUrl="",this.mpContext=new s.Map(new s.STRING,new s.STRING),this.iVersion=0,this.iCurAction=0,this.sPassword="",this.lSessionId=0,this.vApplyList=new s.Vector(new r.ApplyUser),this.iState=0,this.iSilence=0,this.iActiveTime=0,this.iLastSyncTime=0,this.mpUserSession=new s.Map(new s.INT64,new s.STRING),this.iBeginTime=0,this.iPresenterGender=0,this.tTransferRoom=new r.TransferLiveRoomState,this.iMode=0,this.iModeV2=0},r.MeetingStat.prototype._clone=function(){return new r.MeetingStat},r.MeetingStat.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.MeetingStat.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.MeetingStat.prototype.writeTo=function(e){e.writeInt64(0,this.lPresenterUid),e.writeString(1,this.sPresenterNick),e.writeString(2,this.sPresenterAvatarUrl),e.writeMap(4,this.mpContext),e.writeInt32(5,this.iVersion),e.writeInt32(6,this.iCurAction),e.writeString(7,this.sPassword),e.writeInt64(8,this.lSessionId),e.writeVector(9,this.vApplyList),e.writeInt32(10,this.iState),e.writeInt32(11,this.iSilence),e.writeInt32(12,this.iActiveTime),e.writeInt32(13,this.iLastSyncTime),e.writeMap(14,this.mpUserSession),e.writeInt32(15,this.iBeginTime),e.writeInt32(16,this.iPresenterGender),e.writeStruct(17,this.tTransferRoom),e.writeInt32(18,this.iMode),e.writeInt32(19,this.iModeV2)},r.MeetingSeat=function(){this.mpContext=new s.Map(new s.STRING,new s.STRING),this.iPos=0,this.iLocked=0,this.lUid=0,this.sNick="",this.sAvatarUrl="",this.iMute=0,this.iVersion=0,this.iCurAction=0,this.iActiveTime=0,this.iSilence=0,this.iGender=0,this.lOfferSeatTimeStamp=0,this.iSilenceTime=0,this.iMuteTime=0,this.iSeatType=0,this.iSeatTypeV2=0,this.sSeatUrl="",this.sCharm="",this.sName="",this.sSourceUrl=""},r.MeetingSeat.prototype._clone=function(){return new r.MeetingSeat},r.MeetingSeat.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.MeetingSeat.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.MeetingSeat.prototype.writeTo=function(e){e.writeMap(0,this.mpContext),e.writeInt32(1,this.iPos),e.writeInt32(2,this.iLocked),e.writeInt64(3,this.lUid),e.writeString(4,this.sNick),e.writeString(5,this.sAvatarUrl),e.writeInt32(7,this.iMute),e.writeInt32(8,this.iVersion),e.writeInt32(9,this.iCurAction),e.writeInt32(10,this.iActiveTime),e.writeInt32(11,this.iSilence),e.writeInt32(12,this.iGender),e.writeInt64(13,this.lOfferSeatTimeStamp),e.writeInt32(14,this.iSilenceTime),e.writeInt32(15,this.iMuteTime),e.writeInt32(16,this.iSeatType),e.writeInt32(17,this.iSeatTypeV2),e.writeString(18,this.sSeatUrl),e.writeString(19,this.sCharm),e.writeString(20,this.sName),e.writeString(21,this.sSourceUrl)},r.MeetingSeat.prototype.readFrom=function(e){this.mpContext=e.readMap(0,!1,this.mpContext),this.iPos=e.readInt32(1,!1,this.iPos),this.iLocked=e.readInt32(2,!1,this.iLocked),this.lUid=e.readInt64(3,!1,this.lUid),this.sNick=e.readString(4,!1,this.sNick),this.sAvatarUrl=e.readString(5,!1,this.sAvatarUrl),this.iMute=e.readInt32(7,!1,this.iMute),this.iVersion=e.readInt32(8,!1,this.iVersion),this.iCurAction=e.readInt32(9,!1,this.iCurAction),this.iActiveTime=e.readInt32(10,!1,this.iActiveTime),this.iSilence=e.readInt32(11,!1,this.iSilence),this.iGender=e.readInt32(12,!1,this.iGender),this.lOfferSeatTimeStamp=e.readInt64(13,!1,this.lOfferSeatTimeStamp),this.iSilenceTime=e.readInt32(14,!1,this.iSilenceTime),this.iMuteTime=e.readInt32(15,!1,this.iMuteTime),this.iSeatType=e.readInt32(16,!1,this.iSeatType),this.iSeatTypeV2=e.readInt32(17,!1,this.iSeatTypeV2),this.sSeatUrl=e.readString(18,!1,this.sSeatUrl),this.sCharm=e.readString(19,!1,this.sCharm),this.sName=e.readString(20,!1,this.sName),this.sSourceUrl=e.readString(21,!1,this.sSourceUrl)},r.ApplyUser=function(){this.lUid=0,this.sNick="",this.sAvatarUrl="",this.lActiveTime=0,this.mpContext=new s.Map(new s.STRING,new s.STRING),this.iGender=0,this.sStreamName="",this.iSeatType=0},r.ApplyUser.prototype._clone=function(){return new r.ApplyUser},r.ApplyUser.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.ApplyUser.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.ApplyUser.prototype.writeTo=function(e){e.writeInt64(0,this.lUid),e.writeString(1,this.sNick),e.writeString(2,this.sAvatarUrl),e.writeInt64(3,this.lActiveTime),e.writeMap(4,this.mpContext),e.writeInt32(5,this.iGender),e.writeString(6,this.sStreamName),e.writeInt32(7,this.iSeatType)},r.ApplyUser.prototype.readFrom=function(e){this.lUid=e.readInt64(0,!1,this.lUid),this.sNick=e.readString(1,!1,this.sNick),this.sAvatarUrl=e.readString(2,!1,this.sAvatarUrl),this.lActiveTime=e.readInt64(3,!1,this.lActiveTime),this.mpContext=e.readMap(4,!1,this.mpContext),this.iGender=e.readInt32(5,!1,this.iGender),this.sStreamName=e.readString(6,!1,this.sStreamName),this.iSeatType=e.readInt32(7,!1,this.iSeatType)},r.TransferLiveRoomState=function(){this.lTargetUid=0,this.iInviteTime=0,this.iTokeOverTime=0,this.iBeginLiveTime=0,this.lNewLiveId=0,this.iInviteExpire=0,this.iState=0,this.iResult=0,this.iSuccessTime=0,this.sTargetNick=""},r.TransferLiveRoomState.prototype._clone=function(){return new r.TransferLiveRoomState},r.TransferLiveRoomState.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.TransferLiveRoomState.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.TransferLiveRoomState.prototype.writeTo=function(e){e.writeInt64(0,this.lTargetUid),e.writeInt32(1,this.iInviteTime),e.writeInt32(2,this.iTokeOverTime),e.writeInt32(3,this.iBeginLiveTime),e.writeInt64(4,this.lNewLiveId),e.writeInt32(5,this.iInviteExpire),e.writeInt32(6,this.iState),e.writeInt32(7,this.iResult),e.writeInt32(8,this.iSuccessTime),e.writeString(9,this.sTargetNick)},r.TransferLiveRoomState.prototype.readFrom=function(e){this.lTargetUid=e.readInt64(0,!1,this.lTargetUid),this.iInviteTime=e.readInt32(1,!1,this.iInviteTime),this.iTokeOverTime=e.readInt32(2,!1,this.iTokeOverTime),this.iBeginLiveTime=e.readInt32(3,!1,this.iBeginLiveTime),this.lNewLiveId=e.readInt64(4,!1,this.lNewLiveId),this.iInviteExpire=e.readInt32(5,!1,this.iInviteExpire),this.iState=e.readInt32(6,!1,this.iState),this.iResult=e.readInt32(7,!1,this.iResult),this.iSuccessTime=e.readInt32(8,!1,this.iSuccessTime),this.sTargetNick=e.readString(9,!1,this.sTargetNick)},r.GetP2PStreamInfoReq=function(){this.lUid=0,this.sStreamName="",this.iP2PType=0,this.sClientUA=""},r.GetP2PStreamInfoReq.prototype._clone=function(){return new r.GetP2PStreamInfoReq},r.GetP2PStreamInfoReq.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.GetP2PStreamInfoReq.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.GetP2PStreamInfoReq.prototype.writeTo=function(e){e.writeInt64(0,this.lUid),e.writeString(1,this.sStreamName),e.writeInt32(2,this.iP2PType),e.writeString(3,this.sClientUA)},r.GetP2PStreamInfoReq.prototype.readFrom=function(e){this.lUid=e.readInt64(0,!1,this.lUid),this.sStreamName=e.readString(1,!1,this.sStreamName),this.iP2PType=e.readInt32(2,!1,this.iP2PType),this.sClientUA=e.readString(3,!1,this.sClientUA)},r.GetP2PStreamInfoRsp=function(){this.lUid=0,this.sStreamName="",this.iP2PType=0,this.sP2PToken="",this.iP2PExpireTime=0,this.sP2PUrl="",this.sCodecType="",this.sCdnBrand="",this.mpOption=new s.Map(new s.INT16,new s.INT64),this.line=0},r.GetP2PStreamInfoRsp.prototype._clone=function(){return new r.GetP2PStreamInfoRsp},r.GetP2PStreamInfoRsp.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.GetP2PStreamInfoRsp.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.GetP2PStreamInfoRsp.prototype.writeTo=function(e){e.writeInt64(0,this.lUid),e.writeString(1,this.sStreamName),e.writeInt32(2,this.iP2PType),e.writeString(3,this.sP2PToken),e.writeInt32(4,this.iP2PExpireTime),e.writeString(5,this.sP2PUrl),e.writeString(6,this.sCodecType),e.writeString(7,this.sCdnBrand),e.writeMap(8,this.mpOption),e.writeUInt8(9,this.line)},r.GetP2PStreamInfoRsp.prototype.readFrom=function(e){this.lUid=e.readInt64(0,!1,this.lUid),this.sStreamName=e.readString(1,!1,this.sStreamName),this.iP2PType=e.readInt32(2,!1,this.iP2PType),this.sP2PToken=e.readString(3,!1,this.sP2PToken),this.iP2PExpireTime=e.readInt32(4,!1,this.iP2PExpireTime),this.sP2PUrl=e.readString(5,!1,this.sP2PUrl),this.sCodecType=e.readString(6,!1,this.sCodecType),this.sCdnBrand=e.readString(7,!1,this.sCdnBrand),this.mpOption=e.readMap(8,!1,this.mpOption),this.line=e.readUInt8(9,!1,this.line)},r.GetP2PStreamTokenExReq=function(){this.sStreamName="",this.iLoopTime=0},r.GetP2PStreamTokenExReq.prototype._clone=function(){return new r.GetP2PStreamTokenExReq},r.GetP2PStreamTokenExReq.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.GetP2PStreamTokenExReq.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.GetP2PStreamTokenExReq.prototype.writeTo=function(e){e.writeString(0,this.sStreamName),e.writeInt32(1,this.iLoopTime)},r.GetP2PStreamTokenExReq.prototype.readFrom=function(e){this.sStreamName=e.readString(0,!1,this.sStreamName),this.iLoopTime=e.readInt32(1,!1,this.iLoopTime)},r.GetP2PStreamTokenExRsp=function(){this.sP2PToken="",this.iExpireTime=0},r.GetP2PStreamTokenExRsp.prototype._clone=function(){return new r.GetP2PStreamTokenExRsp},r.GetP2PStreamTokenExRsp.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.GetP2PStreamTokenExRsp.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.GetP2PStreamTokenExRsp.prototype.writeTo=function(e){e.writeString(0,this.sP2PToken),e.writeInt32(1,this.iExpireTime)},r.GetP2PStreamTokenExRsp.prototype.readFrom=function(e){this.sP2PToken=e.readString(0,!1,this.sP2PToken),this.iExpireTime=e.readInt32(1,!1,this.iExpireTime)},r.HttpDnsItem=function(){this.vIp=new s.Vector(new s.STRING),this.iExpireTime=0,this.vIpv6=new s.Vector(new s.STRING)},r.HttpDnsItem.prototype._clone=function(){return new r.HttpDnsItem},r.HttpDnsItem.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.HttpDnsItem.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.HttpDnsItem.prototype.writeTo=function(e){e.writeVector(0,this.vIp),e.writeInt64(1,this.iExpireTime),e.writeVector(2,this.vIpv6)},r.HttpDnsItem.prototype.readFrom=function(e){this.vIp=e.readVector(0,!1,this.vIp),this.iExpireTime=e.readInt64(1,!1,this.iExpireTime),this.vIpv6=e.readVector(2,!1,this.vIpv6)},r.QueryHttpDnsReq=function(){this.lUid=0,this.sUA="",this.vDomain=new s.Vector(new s.STRING),this.sAppSrc=""},r.QueryHttpDnsReq.prototype._clone=function(){return new r.QueryHttpDnsReq},r.QueryHttpDnsReq.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.QueryHttpDnsReq.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.QueryHttpDnsReq.prototype.writeTo=function(e){e.writeInt64(0,this.lUid),e.writeString(1,this.sUA),e.writeVector(2,this.vDomain),e.writeString(3,this.sAppSrc)},r.QueryHttpDnsReq.prototype.readFrom=function(e){this.lUid=e.readInt64(0,!1,this.lUid),this.sUA=e.readString(1,!1,this.sUA),this.vDomain=e.readVector(2,!1,this.vDomain),this.sAppSrc=e.readString(3,!1,this.sAppSrc)},r.QueryHttpDnsRsp=function(){this.mDomain2Ip=new s.Map(new s.STRING,new r.HttpDnsItem)},r.QueryHttpDnsRsp.prototype._clone=function(){return new r.QueryHttpDnsRsp},r.QueryHttpDnsRsp.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.QueryHttpDnsRsp.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.QueryHttpDnsRsp.prototype.writeTo=function(e){e.writeMap(0,this.mDomain2Ip)},r.QueryHttpDnsRsp.prototype.readFrom=function(e){this.mDomain2Ip=e.readMap(0,!1,this.mDomain2Ip)},r.WSTimeSyncReq=function(){this.sGuid="",this.lClientTime=0},r.WSTimeSyncReq.prototype._clone=function(){return new r.WSTimeSyncReq},r.WSTimeSyncReq.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.WSTimeSyncReq.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.WSTimeSyncReq.prototype.writeTo=function(e){e.writeString(0,this.sGuid),e.writeInt64(1,this.lClientTime)},r.WSTimeSyncReq.prototype.readFrom=function(e){this.sGuid=e.readString(0,!1,this.sGuid),this.lClientTime=e.readInt64(1,!1,this.lClientTime)},r.WSTimeSyncRsp=function(){this.lServerTime=0},r.WSTimeSyncRsp.prototype._clone=function(){return new r.WSTimeSyncRsp},r.WSTimeSyncRsp.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.WSTimeSyncRsp.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.WSTimeSyncRsp.prototype.writeTo=function(e){e.writeInt64(0,this.lServerTime)},r.WSTimeSyncRsp.prototype.readFrom=function(e){this.lServerTime=e.readInt64(0,!1,this.lServerTime)},r.MediaUserId=function(){this.lUid=0,this.sGuid="",this.sToken="",this.sUA="",this.sCookie="",this.iTokenType=0,this.iAppid=0,this.bAnonymous=0,this.sStrUid=""},r.MediaUserId.prototype._clone=function(){return new r.MediaUserId},r.MediaUserId.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.MediaUserId.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.MediaUserId.prototype.writeTo=function(e){e.writeInt64(0,this.lUid),e.writeString(1,this.sGuid),e.writeString(2,this.sToken),e.writeString(3,this.sUA),e.writeString(4,this.sCookie),e.writeInt32(5,this.iTokenType),e.writeInt32(6,this.iAppid),e.writeInt32(7,this.bAnonymous),e.writeString(8,this.sStrUid)},r.MediaUserId.prototype.readFrom=function(e){this.lUid=e.readInt64(0,!1,this.lUid),this.sGuid=e.readString(1,!1,this.sGuid),this.sToken=e.readString(2,!1,this.sToken),this.sUA=e.readString(3,!1,this.sUA),this.sCookie=e.readString(4,!1,this.sCookie),this.iTokenType=e.readInt32(5,!1,this.iTokenType),this.iAppid=e.readInt32(6,!1,this.iAppid),this.bAnonymous=e.readInt32(7,!1,this.bAnonymous),this.sStrUid=e.readString(8,!1,this.sStrUid)},r.LoginVerifyReq=function(){this.tId=new r.MediaUserId,this.iCookieDeadTime=0},r.LoginVerifyReq.prototype._clone=function(){return new r.LoginVerifyReq},r.LoginVerifyReq.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.LoginVerifyReq.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.LoginVerifyReq.prototype.writeTo=function(e){e.writeStruct(0,this.tId),e.writeInt32(1,this.iCookieDeadTime)},r.LoginVerifyReq.prototype.readFrom=function(e){this.tId=e.readStruct(0,!1,this.tId),this.iCookieDeadTime=e.readInt32(1,!1,this.iCookieDeadTime)},r.LoginVerifyRsp=function(){this.iResCode=0,this.lUid=0,this.sCookie="",this.sUid="",this.iAppId=0},r.LoginVerifyRsp.prototype._clone=function(){return new r.LoginVerifyRsp},r.LoginVerifyRsp.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.LoginVerifyRsp.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.LoginVerifyRsp.prototype.writeTo=function(e){e.writeInt32(0,this.iResCode),e.writeInt64(1,this.lUid),e.writeString(2,this.sCookie),e.writeString(3,this.sUid),e.writeInt32(4,this.iAppId)},r.LoginVerifyRsp.prototype.readFrom=function(e){this.iResCode=e.readInt32(0,!1,this.iResCode),this.lUid=e.readInt64(1,!1,this.lUid),this.sCookie=e.readString(2,!1,this.sCookie),this.sUid=e.readString(3,!1,this.sUid),this.iAppId=e.readInt32(4,!1,this.iAppId)},r.JoinMediaGroupReq=function(){this.tId=new r.MediaUserId,this.vGroupId=new s.Vector(new s.STRING)},r.JoinMediaGroupReq.prototype._clone=function(){return new r.JoinMediaGroupReq},r.JoinMediaGroupReq.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.JoinMediaGroupReq.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.JoinMediaGroupReq.prototype.writeTo=function(e){e.writeStruct(0,this.tId),e.writeVector(1,this.vGroupId)},r.JoinMediaGroupReq.prototype.readFrom=function(e){this.tId=e.readStruct(0,!1,this.tId),this.vGroupId=e.readVector(1,!1,this.vGroupId)},r.JoinMediaGroupRsp=function(){this.iCode=0,this.sMsg="",this.vGroupId=new s.Vector(new s.STRING)},r.JoinMediaGroupRsp.prototype._clone=function(){return new r.JoinMediaGroupRsp},r.JoinMediaGroupRsp.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.JoinMediaGroupRsp.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.JoinMediaGroupRsp.prototype.writeTo=function(e){e.writeInt32(0,this.iCode),e.writeString(1,this.sMsg),e.writeVector(2,this.vGroupId)},r.JoinMediaGroupRsp.prototype.readFrom=function(e){this.iCode=e.readInt32(0,!1,this.iCode),this.sMsg=e.readString(1,!1,this.sMsg),this.vGroupId=e.readVector(2,!1,this.vGroupId)},r.QuitMediaGroupReq=function(){this.tId=new r.MediaUserId,this.vGroupId=new s.Vector(new s.STRING)},r.QuitMediaGroupReq.prototype._clone=function(){return new r.QuitMediaGroupReq},r.QuitMediaGroupReq.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.QuitMediaGroupReq.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.QuitMediaGroupReq.prototype.writeTo=function(e){e.writeStruct(0,this.tId),e.writeVector(1,this.vGroupId)},r.QuitMediaGroupReq.prototype.readFrom=function(e){this.tId=e.readStruct(0,!1,this.tId),this.vGroupId=e.readVector(1,!1,this.vGroupId)},r.QuitMediaGroupRsp=function(){this.iCode=0,this.sMsg="",this.vGroupId=new s.Vector(new s.STRING)},r.QuitMediaGroupRsp.prototype._clone=function(){return new r.QuitMediaGroupRsp},r.QuitMediaGroupRsp.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.QuitMediaGroupRsp.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.QuitMediaGroupRsp.prototype.writeTo=function(e){e.writeInt32(0,this.iCode),e.writeString(1,this.sMsg),e.writeVector(2,this.vGroupId)},r.QuitMediaGroupRsp.prototype.readFrom=function(e){this.iCode=e.readInt32(0,!1,this.iCode),this.sMsg=e.readString(1,!1,this.sMsg),this.vGroupId=e.readVector(2,!1,this.vGroupId)},r.ikk=1,r.skk="123",r.eIType={k4AM:10001,k6AM:10002},r.EM_PCDN_MODE={E_PcdnMode_Min:0,E_PcdnMode_P2pHttpSubstream:1,E_PcdnMode_P2pOutsideSdkSubstream:2,E_PcdnMode_FlvHttpFullstream:3,E_PcdnMode_FlvOutsideSdkFullstream:4,E_PcdnMode_Max:255},r.EM_BUSI_TYPE={E_BusiType_Min:0,E_BusiType_Live:1,E_BusiType_Max:255},r.EM_CLINET_TYPE={E_CLIENT_MIN:0,E_CLIENT_PC:1,E_CLIENT_ADR:2,E_CLIENT_IOS:3,E_CLIENT_WEB:4,E_CLIENT_MAX:255},r.ERR_CODE_FOR_HY_PCDNGW_CLIENT_RSP={E_SUCCESS:0,E_HYGW_ERR:1,E_PCDNGW_40X:2,E_PCDNGW_50X:3,E_PCDNGW_TIO:4,E_PCDNGW_RSPERR:5,E_CLIREQ_ERR:6,E_PCDN_OFF:7,E_LIMIT_FLOWS:8},r.MyReq=function(){this.name="",this.opt="",this.mMap=new s.Map(new s.STRING,new s.STRING)},r.MyReq.prototype._clone=function(){return new r.MyReq},r.MyReq.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.MyReq.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.MyReq.prototype.writeTo=function(e){e.writeString(0,this.name),e.writeString(1,this.opt),e.writeMap(2,this.mMap)},r.MyReq.prototype.readFrom=function(e){this.name=e.readString(0,!1,this.name),this.opt=e.readString(1,!1,this.opt),this.mMap=e.readMap(2,!1,this.mMap)},r.MyRsp=function(){this.value=0,this.origin=new r.MyReq,this.types=new s.Vector(new s.INT32),this.eType=0},r.MyRsp.prototype._clone=function(){return new r.MyRsp},r.MyRsp.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.MyRsp.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.MyRsp.prototype.writeTo=function(e){e.writeInt32(0,this.value),e.writeStruct(1,this.origin),e.writeVector(2,this.types),e.writeInt32(3,this.eType)},r.MyRsp.prototype.readFrom=function(e){this.value=e.readInt32(0,!1,this.value),this.origin=e.readStruct(1,!1,this.origin),this.types=e.readVector(2,!1,this.types),this.eType=e.readInt32(3,!1,this.eType)},r.ClientQueryPcdnScheduleReq=function(){this.lReqTs=0,this.lUid=0,this.sGuid="",this.lAnchorUid=0,this.iCdnLine=0,this.iCliType=0,this.lBucketPara=0,this.vPcdnMode=new s.Vector(new s.INT32),this.iBusiType=0,this.sStreamName="",this.mPcdnModeCliSupportPcdns=new s.Map(new s.INT32,new s.Vector(new s.STRING))},r.ClientQueryPcdnScheduleReq.prototype._clone=function(){return new r.ClientQueryPcdnScheduleReq},r.ClientQueryPcdnScheduleReq.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.ClientQueryPcdnScheduleReq.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.ClientQueryPcdnScheduleReq.prototype.writeTo=function(e){e.writeInt64(0,this.lReqTs),e.writeInt64(1,this.lUid),e.writeString(2,this.sGuid),e.writeInt64(3,this.lAnchorUid),e.writeInt32(4,this.iCdnLine),e.writeInt32(5,this.iCliType),e.writeInt64(6,this.lBucketPara),e.writeVector(30,this.vPcdnMode),e.writeInt32(31,this.iBusiType),e.writeString(32,this.sStreamName),e.writeMap(100,this.mPcdnModeCliSupportPcdns)},r.ClientQueryPcdnScheduleReq.prototype.readFrom=function(e){this.lReqTs=e.readInt64(0,!1,this.lReqTs),this.lUid=e.readInt64(1,!1,this.lUid),this.sGuid=e.readString(2,!1,this.sGuid),this.lAnchorUid=e.readInt64(3,!1,this.lAnchorUid),this.iCdnLine=e.readInt32(4,!1,this.iCdnLine),this.iCliType=e.readInt32(5,!1,this.iCliType),this.lBucketPara=e.readInt64(6,!1,this.lBucketPara),this.vPcdnMode=e.readVector(30,!1,this.vPcdnMode),this.iBusiType=e.readInt32(31,!1,this.iBusiType),this.sStreamName=e.readString(32,!1,this.sStreamName),this.mPcdnModeCliSupportPcdns=e.readMap(100,!1,this.mPcdnModeCliSupportPcdns)},r.ClientQueryPcdnScheduleRsp=function(){this.lReqTs=0,this.lRspTs=0,this.iErrCode=0,this.mPcdnModeSwitch=new s.Map(new s.INT32,new s.INT32),this.cliProv="",this.cliIsp="",this.lUid=0,this.iCdnLine=0,this.sStreamName="",this.mPcdnModePcdnName=new s.Map(new s.INT32,new s.STRING)},r.ClientQueryPcdnScheduleRsp.prototype._clone=function(){return new r.ClientQueryPcdnScheduleRsp},r.ClientQueryPcdnScheduleRsp.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.ClientQueryPcdnScheduleRsp.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.ClientQueryPcdnScheduleRsp.prototype.writeTo=function(e){e.writeInt64(0,this.lReqTs),e.writeInt64(1,this.lRspTs),e.writeInt32(2,this.iErrCode),e.writeMap(10,this.mPcdnModeSwitch),e.writeString(30,this.cliProv),e.writeString(31,this.cliIsp),e.writeInt64(100,this.lUid),e.writeInt32(101,this.iCdnLine),e.writeString(102,this.sStreamName),e.writeMap(200,this.mPcdnModePcdnName)},r.ClientQueryPcdnScheduleRsp.prototype.readFrom=function(e){this.lReqTs=e.readInt64(0,!1,this.lReqTs),this.lRspTs=e.readInt64(1,!1,this.lRspTs),this.iErrCode=e.readInt32(2,!1,this.iErrCode),this.mPcdnModeSwitch=e.readMap(10,!1,this.mPcdnModeSwitch),this.cliProv=e.readString(30,!1,this.cliProv),this.cliIsp=e.readString(31,!1,this.cliIsp),this.lUid=e.readInt64(100,!1,this.lUid),this.iCdnLine=e.readInt32(101,!1,this.iCdnLine),this.sStreamName=e.readString(102,!1,this.sStreamName),this.mPcdnModePcdnName=e.readMap(200,!1,this.mPcdnModePcdnName)},r.ClientGetStunAndPcdnProxyReq=function(){this.lReqTs=0,this.lUid=0,this.sStreamname="",this.iBaseSubs=0,this.vSub=new s.Vector(new s.INT32),this.sGuid="",this.lAnchorUid=0,this.iCdnLine=0,this.iCliType=0,this.lBucketPara=0,this.iBusiType=0,this.curPcdnName=""},r.ClientGetStunAndPcdnProxyReq.prototype._clone=function(){return new r.ClientGetStunAndPcdnProxyReq},r.ClientGetStunAndPcdnProxyReq.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.ClientGetStunAndPcdnProxyReq.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.ClientGetStunAndPcdnProxyReq.prototype.writeTo=function(e){e.writeInt64(0,this.lReqTs),e.writeInt64(1,this.lUid),e.writeString(2,this.sStreamname),e.writeInt32(3,this.iBaseSubs),e.writeVector(4,this.vSub),e.writeString(5,this.sGuid),e.writeInt64(6,this.lAnchorUid),e.writeInt32(7,this.iCdnLine),e.writeInt32(8,this.iCliType),e.writeInt64(9,this.lBucketPara),e.writeInt32(10,this.iBusiType),e.writeString(11,this.curPcdnName)},r.ClientGetStunAndPcdnProxyReq.prototype.readFrom=function(e){this.lReqTs=e.readInt64(0,!1,this.lReqTs),this.lUid=e.readInt64(1,!1,this.lUid),this.sStreamname=e.readString(2,!1,this.sStreamname),this.iBaseSubs=e.readInt32(3,!1,this.iBaseSubs),this.vSub=e.readVector(4,!1,this.vSub),this.sGuid=e.readString(5,!1,this.sGuid),this.lAnchorUid=e.readInt64(6,!1,this.lAnchorUid),this.iCdnLine=e.readInt32(7,!1,this.iCdnLine),this.iCliType=e.readInt32(8,!1,this.iCliType),this.lBucketPara=e.readInt64(9,!1,this.lBucketPara),this.iBusiType=e.readInt32(10,!1,this.iBusiType),this.curPcdnName=e.readString(11,!1,this.curPcdnName)},r.PCdnProxyUrl=function(){this.sProtocol="",this.vUrl=new s.Vector(new s.STRING),this.iStatusPcdn=0,this.iPcdnThresholdHotDegreeIn=-1,this.iPcdnThresholdHotDegreeKick=-1,this.iPcdnNowHotDegree=-1,this.iPcdnNowPullstreamUcnt=-1,this.iPcdnNowGetpcdnUcnt=-1},r.PCdnProxyUrl.prototype._clone=function(){return new r.PCdnProxyUrl},r.PCdnProxyUrl.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.PCdnProxyUrl.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.PCdnProxyUrl.prototype.writeTo=function(e){e.writeString(0,this.sProtocol),e.writeVector(2,this.vUrl),e.writeInt32(3,this.iStatusPcdn),e.writeInt32(10,this.iPcdnThresholdHotDegreeIn),e.writeInt32(11,this.iPcdnThresholdHotDegreeKick),e.writeInt32(12,this.iPcdnNowHotDegree),e.writeInt32(13,this.iPcdnNowPullstreamUcnt),e.writeInt32(14,this.iPcdnNowGetpcdnUcnt)},r.PCdnProxyUrl.prototype.readFrom=function(e){this.sProtocol=e.readString(0,!1,this.sProtocol),this.vUrl=e.readVector(2,!1,this.vUrl),this.iStatusPcdn=e.readInt32(3,!1,this.iStatusPcdn),this.iPcdnThresholdHotDegreeIn=e.readInt32(10,!1,this.iPcdnThresholdHotDegreeIn),this.iPcdnThresholdHotDegreeKick=e.readInt32(11,!1,this.iPcdnThresholdHotDegreeKick),this.iPcdnNowHotDegree=e.readInt32(12,!1,this.iPcdnNowHotDegree),this.iPcdnNowPullstreamUcnt=e.readInt32(13,!1,this.iPcdnNowPullstreamUcnt),this.iPcdnNowGetpcdnUcnt=e.readInt32(14,!1,this.iPcdnNowGetpcdnUcnt)},r.ClientGetStunAndPcdnProxyRsp=function(){this.lReqTs=0,this.lRspTs=0,this.lUid=0,this.sStreamname="",this.iErrCode=0,this.iBaseSubs=0,this.mSubToPullStreamUrl=new s.Map(new s.INT32,new s.Map(new s.STRING,new r.PCdnProxyUrl)),this.cliProv="",this.cliIsp="",this.pcdnName="",this.iCdnLine=0,this.sPcdnIsp="",this.sPcdnArea=""},r.ClientGetStunAndPcdnProxyRsp.prototype._clone=function(){return new r.ClientGetStunAndPcdnProxyRsp},r.ClientGetStunAndPcdnProxyRsp.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.ClientGetStunAndPcdnProxyRsp.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.ClientGetStunAndPcdnProxyRsp.prototype.writeTo=function(e){e.writeInt64(0,this.lReqTs),e.writeInt64(1,this.lRspTs),e.writeInt64(2,this.lUid),e.writeString(3,this.sStreamname),e.writeInt32(4,this.iErrCode),e.writeInt32(5,this.iBaseSubs),e.writeMap(12,this.mSubToPullStreamUrl),e.writeString(13,this.cliProv),e.writeString(14,this.cliIsp),e.writeString(15,this.pcdnName),e.writeInt32(100,this.iCdnLine),e.writeString(200,this.sPcdnIsp),e.writeString(201,this.sPcdnArea)},r.ClientGetStunAndPcdnProxyRsp.prototype.readFrom=function(e){this.lReqTs=e.readInt64(0,!1,this.lReqTs),this.lRspTs=e.readInt64(1,!1,this.lRspTs),this.lUid=e.readInt64(2,!1,this.lUid),this.sStreamname=e.readString(3,!1,this.sStreamname),this.iErrCode=e.readInt32(4,!1,this.iErrCode),this.iBaseSubs=e.readInt32(5,!1,this.iBaseSubs),this.mSubToPullStreamUrl=e.readMap(12,!1,this.mSubToPullStreamUrl),this.cliProv=e.readString(13,!1,this.cliProv),this.cliIsp=e.readString(14,!1,this.cliIsp),this.pcdnName=e.readString(15,!1,this.pcdnName),this.iCdnLine=e.readInt32(100,!1,this.iCdnLine),this.sPcdnIsp=e.readString(200,!1,this.sPcdnIsp),this.sPcdnArea=e.readString(201,!1,this.sPcdnArea)},r.ClientGetPcdnP2pOutsideSdkSubstreamInfoReq=function(){this.lReqTs=0,this.lUid=0,this.sGuid="",this.lAnchorUid=0,this.iCdnLine=0,this.sStreamname="",this.iBaseSubs=0,this.vSub=new s.Vector(new s.INT32),this.iCliType=0,this.lBucketPara=0,this.iBusiType=0,this.vCliSupportPcdns=new s.Vector(new s.STRING),this.curPcdnName=""},r.ClientGetPcdnP2pOutsideSdkSubstreamInfoReq.prototype._clone=function(){return new r.ClientGetPcdnP2pOutsideSdkSubstreamInfoReq},r.ClientGetPcdnP2pOutsideSdkSubstreamInfoReq.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.ClientGetPcdnP2pOutsideSdkSubstreamInfoReq.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.ClientGetPcdnP2pOutsideSdkSubstreamInfoReq.prototype.writeTo=function(e){e.writeInt64(0,this.lReqTs),e.writeInt64(1,this.lUid),e.writeString(2,this.sGuid),e.writeInt64(3,this.lAnchorUid),e.writeInt32(4,this.iCdnLine),e.writeString(5,this.sStreamname),e.writeInt32(6,this.iBaseSubs),e.writeVector(7,this.vSub),e.writeInt32(8,this.iCliType),e.writeInt64(9,this.lBucketPara),e.writeInt32(10,this.iBusiType),e.writeVector(11,this.vCliSupportPcdns),e.writeString(12,this.curPcdnName)},r.ClientGetPcdnP2pOutsideSdkSubstreamInfoReq.prototype.readFrom=function(e){this.lReqTs=e.readInt64(0,!1,this.lReqTs),this.lUid=e.readInt64(1,!1,this.lUid),this.sGuid=e.readString(2,!1,this.sGuid),this.lAnchorUid=e.readInt64(3,!1,this.lAnchorUid),this.iCdnLine=e.readInt32(4,!1,this.iCdnLine),this.sStreamname=e.readString(5,!1,this.sStreamname),this.iBaseSubs=e.readInt32(6,!1,this.iBaseSubs),this.vSub=e.readVector(7,!1,this.vSub),this.iCliType=e.readInt32(8,!1,this.iCliType),this.lBucketPara=e.readInt64(9,!1,this.lBucketPara),this.iBusiType=e.readInt32(10,!1,this.iBusiType),this.vCliSupportPcdns=e.readVector(11,!1,this.vCliSupportPcdns),this.curPcdnName=e.readString(12,!1,this.curPcdnName)},r.ClientGetPcdnP2pOutsideSdkSubstreamInfoRsp=function(){this.lReqTs=0,this.lRspTs=0,this.iErrCode=0,this.sPcdnName="",this.mP2pSubstreamUrl=new s.Map(new s.INT32,new s.STRING),this.cliProv="",this.cliIsp="",this.lUid=0,this.iCdnLine=0,this.sStreamname=""},r.ClientGetPcdnP2pOutsideSdkSubstreamInfoRsp.prototype._clone=function(){return new r.ClientGetPcdnP2pOutsideSdkSubstreamInfoRsp},r.ClientGetPcdnP2pOutsideSdkSubstreamInfoRsp.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.ClientGetPcdnP2pOutsideSdkSubstreamInfoRsp.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.ClientGetPcdnP2pOutsideSdkSubstreamInfoRsp.prototype.writeTo=function(e){e.writeInt64(0,this.lReqTs),e.writeInt64(1,this.lRspTs),e.writeInt32(2,this.iErrCode),e.writeString(10,this.sPcdnName),e.writeMap(11,this.mP2pSubstreamUrl),e.writeString(30,this.cliProv),e.writeString(31,this.cliIsp),e.writeInt64(100,this.lUid),e.writeInt32(101,this.iCdnLine),e.writeString(102,this.sStreamname)},r.ClientGetPcdnP2pOutsideSdkSubstreamInfoRsp.prototype.readFrom=function(e){this.lReqTs=e.readInt64(0,!1,this.lReqTs),this.lRspTs=e.readInt64(1,!1,this.lRspTs),this.iErrCode=e.readInt32(2,!1,this.iErrCode),this.sPcdnName=e.readString(10,!1,this.sPcdnName),this.mP2pSubstreamUrl=e.readMap(11,!1,this.mP2pSubstreamUrl),this.cliProv=e.readString(30,!1,this.cliProv),this.cliIsp=e.readString(31,!1,this.cliIsp),this.lUid=e.readInt64(100,!1,this.lUid),this.iCdnLine=e.readInt32(101,!1,this.iCdnLine),this.sStreamname=e.readString(102,!1,this.sStreamname)},r.ClientGetPcdnFlvOutsideSdkFullstreamInfoReq=function(){this.lReqTs=0,this.lUid=0,this.sGuid="",this.lAnchorUid=0,this.iCdnLine=0,this.sStreamName="",this.iRatio=0,this.sCodec="",this.iCliType=0,this.lBucketPara=0,this.iBusiType=0,this.vCliSupportPcdns=new s.Vector(new s.STRING),this.curPcdnName=""},r.ClientGetPcdnFlvOutsideSdkFullstreamInfoReq.prototype._clone=function(){return new r.ClientGetPcdnFlvOutsideSdkFullstreamInfoReq},r.ClientGetPcdnFlvOutsideSdkFullstreamInfoReq.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.ClientGetPcdnFlvOutsideSdkFullstreamInfoReq.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.ClientGetPcdnFlvOutsideSdkFullstreamInfoReq.prototype.writeTo=function(e){e.writeInt64(0,this.lReqTs),e.writeInt64(1,this.lUid),e.writeString(2,this.sGuid),e.writeInt64(3,this.lAnchorUid),e.writeInt32(4,this.iCdnLine),e.writeString(5,this.sStreamName),e.writeInt32(6,this.iRatio),e.writeString(7,this.sCodec),e.writeInt32(8,this.iCliType),e.writeInt64(9,this.lBucketPara),e.writeInt32(10,this.iBusiType),e.writeVector(11,this.vCliSupportPcdns),e.writeString(12,this.curPcdnName)},r.ClientGetPcdnFlvOutsideSdkFullstreamInfoReq.prototype.readFrom=function(e){this.lReqTs=e.readInt64(0,!1,this.lReqTs),this.lUid=e.readInt64(1,!1,this.lUid),this.sGuid=e.readString(2,!1,this.sGuid),this.lAnchorUid=e.readInt64(3,!1,this.lAnchorUid),this.iCdnLine=e.readInt32(4,!1,this.iCdnLine),this.sStreamName=e.readString(5,!1,this.sStreamName),this.iRatio=e.readInt32(6,!1,this.iRatio),this.sCodec=e.readString(7,!1,this.sCodec),this.iCliType=e.readInt32(8,!1,this.iCliType),this.lBucketPara=e.readInt64(9,!1,this.lBucketPara),this.iBusiType=e.readInt32(10,!1,this.iBusiType),this.vCliSupportPcdns=e.readVector(11,!1,this.vCliSupportPcdns),this.curPcdnName=e.readString(12,!1,this.curPcdnName)},r.ClientGetPcdnFlvOutsideSdkFullstreamInfoRsp=function(){this.lReqTs=0,this.lRspTs=0,this.iErrCode=0,this.sPcdnName="",this.sFlvFullstreamUrl="",this.cliProv="",this.cliIsp="",this.lUid=0,this.iCdnLine=0,this.sStreamName="",this.iRatio=0,this.sTransUid=""},r.ClientGetPcdnFlvOutsideSdkFullstreamInfoRsp.prototype._clone=function(){return new r.ClientGetPcdnFlvOutsideSdkFullstreamInfoRsp},r.ClientGetPcdnFlvOutsideSdkFullstreamInfoRsp.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.ClientGetPcdnFlvOutsideSdkFullstreamInfoRsp.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.ClientGetPcdnFlvOutsideSdkFullstreamInfoRsp.prototype.writeTo=function(e){e.writeInt64(0,this.lReqTs),e.writeInt64(1,this.lRspTs),e.writeInt32(2,this.iErrCode),e.writeString(10,this.sPcdnName),e.writeString(11,this.sFlvFullstreamUrl),e.writeString(30,this.cliProv),e.writeString(31,this.cliIsp),e.writeInt64(100,this.lUid),e.writeInt32(101,this.iCdnLine),e.writeString(102,this.sStreamName),e.writeInt32(103,this.iRatio),e.writeString(104,this.sTransUid)},r.ClientGetPcdnFlvOutsideSdkFullstreamInfoRsp.prototype.readFrom=function(e){this.lReqTs=e.readInt64(0,!1,this.lReqTs),this.lRspTs=e.readInt64(1,!1,this.lRspTs),this.iErrCode=e.readInt32(2,!1,this.iErrCode),this.sPcdnName=e.readString(10,!1,this.sPcdnName),this.sFlvFullstreamUrl=e.readString(11,!1,this.sFlvFullstreamUrl),this.cliProv=e.readString(30,!1,this.cliProv),this.cliIsp=e.readString(31,!1,this.cliIsp),this.lUid=e.readInt64(100,!1,this.lUid),this.iCdnLine=e.readInt32(101,!1,this.iCdnLine),this.sStreamName=e.readString(102,!1,this.sStreamName),this.iRatio=e.readInt32(103,!1,this.iRatio),this.sTransUid=e.readString(104,!1,this.sTransUid)},r.RecSysInfo=function(){this.sAnchorUid="",this.sRoomId="",this.sDispatchId="",this.iScene=0,this.sStrategy="",this.lServerTs=0,this.lAction=0,this.sActionReason="",this.sActValue=""},r.RecSysInfo.prototype._clone=function(){return new r.RecSysInfo},r.RecSysInfo.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.RecSysInfo.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.RecSysInfo.prototype.writeTo=function(e){e.writeString(0,this.sAnchorUid),e.writeString(1,this.sRoomId),e.writeString(2,this.sDispatchId),e.writeInt32(3,this.iScene),e.writeString(4,this.sStrategy),e.writeInt64(5,this.lServerTs),e.writeInt64(6,this.lAction),e.writeString(7,this.sActionReason),e.writeString(8,this.sActValue)},r.RecSysInfo.prototype.readFrom=function(e){this.sAnchorUid=e.readString(0,!1,this.sAnchorUid),this.sRoomId=e.readString(1,!1,this.sRoomId),this.sDispatchId=e.readString(2,!1,this.sDispatchId),this.iScene=e.readInt32(3,!1,this.iScene),this.sStrategy=e.readString(4,!1,this.sStrategy),this.lServerTs=e.readInt64(5,!1,this.lServerTs),this.lAction=e.readInt64(6,!1,this.lAction),this.sActionReason=e.readString(7,!1,this.sActionReason),this.sActValue=e.readString(8,!1,this.sActValue)},r.RecSysReq=function(){this.tId=new r.MediaUserId,this.sAnchorUid="",this.sRoomId="",this.sDispatchId="",this.iScene=0,this.bDebug=0,this.sNet="",this.sSdkVer="",this.mAppendInfo=new s.Map(new s.STRING,new s.STRING)},r.RecSysReq.prototype._clone=function(){return new r.RecSysReq},r.RecSysReq.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.RecSysReq.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.RecSysReq.prototype.writeTo=function(e){e.writeStruct(0,this.tId),e.writeString(1,this.sAnchorUid),e.writeString(2,this.sRoomId),e.writeString(3,this.sDispatchId),e.writeInt32(4,this.iScene),e.writeInt32(5,this.bDebug),e.writeString(6,this.sNet),e.writeString(7,this.sSdkVer),e.writeMap(8,this.mAppendInfo)},r.RecSysReq.prototype.readFrom=function(e){this.tId=e.readStruct(0,!1,this.tId),this.sAnchorUid=e.readString(1,!1,this.sAnchorUid),this.sRoomId=e.readString(2,!1,this.sRoomId),this.sDispatchId=e.readString(3,!1,this.sDispatchId),this.iScene=e.readInt32(4,!1,this.iScene),this.bDebug=e.readInt32(5,!1,this.bDebug),this.sNet=e.readString(6,!1,this.sNet),this.sSdkVer=e.readString(7,!1,this.sSdkVer),this.mAppendInfo=e.readMap(8,!1,this.mAppendInfo)},r.RecSysRsp=function(){this.iStatus=0,this.sError="",this.tRecSysInfo=new r.RecSysInfo},r.RecSysRsp.prototype._clone=function(){return new r.RecSysRsp},r.RecSysRsp.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.RecSysRsp.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.RecSysRsp.prototype.writeTo=function(e){e.writeInt32(0,this.iStatus),e.writeString(1,this.sError),e.writeStruct(2,this.tRecSysInfo)},r.RecSysRsp.prototype.readFrom=function(e){this.iStatus=e.readInt32(0,!1,this.iStatus),this.sError=e.readString(1,!1,this.sError),this.tRecSysInfo=e.readStruct(2,!1,this.tRecSysInfo)},r.RecSysNotice=function(){this.tRecSysInfo=new r.RecSysInfo},r.RecSysNotice.prototype._clone=function(){return new r.RecSysNotice},r.RecSysNotice.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.RecSysNotice.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.RecSysNotice.prototype.writeTo=function(e){e.writeStruct(0,this.tRecSysInfo)},r.RecSysNotice.prototype.readFrom=function(e){this.tRecSysInfo=e.readStruct(0,!1,this.tRecSysInfo)},r.VodUrlRange=function(){this.sUrl="",this.sRange="",this.index=0},r.VodUrlRange.prototype._clone=function(){return new r.VodUrlRange},r.VodUrlRange.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.VodUrlRange.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.VodUrlRange.prototype.writeTo=function(e){e.writeString(0,this.sUrl),e.writeString(1,this.sRange),e.writeInt64(2,this.index)},r.VodUrlRange.prototype.readFrom=function(e){this.sUrl=e.readString(0,!1,this.sUrl),this.sRange=e.readString(1,!1,this.sRange),this.index=e.readInt64(2,!1,this.index)},r.VodPcdnProxyUrl=function(){this.reqKey=new r.VodUrlRange,this.iStatusPcdn=0,this.iVodPcdnHotDegreeIn=-1,this.iVodPcdnHotDegreeNow=-1,this.vUrls=new s.Vector(new s.STRING)},r.VodPcdnProxyUrl.prototype._clone=function(){return new r.VodPcdnProxyUrl},r.VodPcdnProxyUrl.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.VodPcdnProxyUrl.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.VodPcdnProxyUrl.prototype.writeTo=function(e){e.writeStruct(0,this.reqKey),e.writeInt32(1,this.iStatusPcdn),e.writeInt32(2,this.iVodPcdnHotDegreeIn),e.writeInt32(3,this.iVodPcdnHotDegreeNow),e.writeVector(4,this.vUrls)},r.VodPcdnProxyUrl.prototype.readFrom=function(e){this.reqKey=e.readStruct(0,!1,this.reqKey),this.iStatusPcdn=e.readInt32(1,!1,this.iStatusPcdn),this.iVodPcdnHotDegreeIn=e.readInt32(2,!1,this.iVodPcdnHotDegreeIn),this.iVodPcdnHotDegreeNow=e.readInt32(3,!1,this.iVodPcdnHotDegreeNow),this.vUrls=e.readVector(4,!1,this.vUrls)},r.ClientGetVodPcdnProxyReq=function(){this.appid=0,this.lReqTs=0,this.lUid=0,this.sGuid="",this.iCliType=0,this.lBucketPara=0,this.sOrigUrl="",this.vKeys=new s.Vector(new r.VodUrlRange)},r.ClientGetVodPcdnProxyReq.prototype._clone=function(){return new r.ClientGetVodPcdnProxyReq},r.ClientGetVodPcdnProxyReq.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.ClientGetVodPcdnProxyReq.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.ClientGetVodPcdnProxyReq.prototype.writeTo=function(e){e.writeInt32(0,this.appid),e.writeInt64(1,this.lReqTs),e.writeInt64(2,this.lUid),e.writeString(3,this.sGuid),e.writeInt32(4,this.iCliType),e.writeInt64(5,this.lBucketPara),e.writeString(6,this.sOrigUrl),e.writeVector(7,this.vKeys)},r.ClientGetVodPcdnProxyReq.prototype.readFrom=function(e){this.appid=e.readInt32(0,!1,this.appid),this.lReqTs=e.readInt64(1,!1,this.lReqTs),this.lUid=e.readInt64(2,!1,this.lUid),this.sGuid=e.readString(3,!1,this.sGuid),this.iCliType=e.readInt32(4,!1,this.iCliType),this.lBucketPara=e.readInt64(5,!1,this.lBucketPara),this.sOrigUrl=e.readString(6,!1,this.sOrigUrl),this.vKeys=e.readVector(7,!1,this.vKeys)},r.ClientGetVodPcdnProxyReqRsp=function(){this.appid=0,this.lReqTs=0,this.lRspTs=0,this.lUid=0,this.sOrigUrl="",this.iErrCode=0,this.vPcdnUrls=new s.Vector(new r.VodPcdnProxyUrl),this.cliProv="",this.cliIsp="",this.pcdnName="",this.sPcdnIsp="",this.sPcdnArea=""},r.ClientGetVodPcdnProxyReqRsp.prototype._clone=function(){return new r.ClientGetVodPcdnProxyReqRsp},r.ClientGetVodPcdnProxyReqRsp.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.ClientGetVodPcdnProxyReqRsp.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.ClientGetVodPcdnProxyReqRsp.prototype.writeTo=function(e){e.writeInt32(0,this.appid),e.writeInt64(1,this.lReqTs),e.writeInt64(2,this.lRspTs),e.writeInt64(3,this.lUid),e.writeString(4,this.sOrigUrl),e.writeInt32(5,this.iErrCode),e.writeVector(6,this.vPcdnUrls),e.writeString(7,this.cliProv),e.writeString(8,this.cliIsp),e.writeString(9,this.pcdnName),e.writeString(10,this.sPcdnIsp),e.writeString(11,this.sPcdnArea)},r.ClientGetVodPcdnProxyReqRsp.prototype.readFrom=function(e){this.appid=e.readInt32(0,!1,this.appid),this.lReqTs=e.readInt64(1,!1,this.lReqTs),this.lRspTs=e.readInt64(2,!1,this.lRspTs),this.lUid=e.readInt64(3,!1,this.lUid),this.sOrigUrl=e.readString(4,!1,this.sOrigUrl),this.iErrCode=e.readInt32(5,!1,this.iErrCode),this.vPcdnUrls=e.readVector(6,!1,this.vPcdnUrls),this.cliProv=e.readString(7,!1,this.cliProv),this.cliIsp=e.readString(8,!1,this.cliIsp),this.pcdnName=e.readString(9,!1,this.pcdnName),this.sPcdnIsp=e.readString(10,!1,this.sPcdnIsp),this.sPcdnArea=e.readString(11,!1,this.sPcdnArea)},r.GetVideoHisUponReq=function(){this.lUid=0,this.lLiveId=0,this.tId=new r.UserId},r.GetVideoHisUponReq.prototype._clone=function(){return new r.GetVideoHisUponReq},r.GetVideoHisUponReq.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.GetVideoHisUponReq.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.GetVideoHisUponReq.prototype.writeTo=function(e){e.writeInt64(0,this.lUid),e.writeInt64(1,this.lLiveId),e.writeStruct(2,this.tId)},r.GetVideoHisUponReq.prototype.readFrom=function(e){this.lUid=e.readInt64(0,!1,this.lUid),this.lLiveId=e.readInt64(1,!1,this.lLiveId),this.tId=e.readStruct(2,!1,this.tId)},r.GetVideoHisUponRsp=function(){this.lUid=0,this.vHistoryList=new s.Vector(new r.GameLiveHlsInfo)},r.GetVideoHisUponRsp.prototype._clone=function(){return new r.GetVideoHisUponRsp},r.GetVideoHisUponRsp.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.GetVideoHisUponRsp.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.GetVideoHisUponRsp.prototype.writeTo=function(e){e.writeInt64(0,this.lUid),e.writeVector(1,this.vHistoryList)},r.GetVideoHisUponRsp.prototype.readFrom=function(e){this.lUid=e.readInt64(0,!1,this.lUid),this.vHistoryList=e.readVector(1,!1,this.vHistoryList)},r.ImgplusABTestNotice=function(){this.lPid=0,this.iAppid=0,this.iSwitch=0},r.ImgplusABTestNotice.prototype._clone=function(){return new r.ImgplusABTestNotice},r.ImgplusABTestNotice.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.ImgplusABTestNotice.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.ImgplusABTestNotice.prototype.writeTo=function(e){e.writeInt64(0,this.lPid),e.writeInt32(1,this.iAppid),e.writeInt32(2,this.iSwitch)},r.ImgplusABTestNotice.prototype.readFrom=function(e){this.lPid=e.readInt64(0,!1,this.lPid),this.iAppid=e.readInt32(1,!1,this.iAppid),this.iSwitch=e.readInt32(2,!1,this.iSwitch)},r.MediaUserId=function(){this.lUid=0,this.sGuid="",this.sToken="",this.sUA="",this.sCookie="",this.iAppid=0,this.sStrUid="",this.sUAppId="",this.iNetType=127},r.MediaUserId.prototype._clone=function(){return new r.MediaUserId},r.MediaUserId.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.MediaUserId.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.MediaUserId.prototype.writeTo=function(e){e.writeInt64(0,this.lUid),e.writeString(1,this.sGuid),e.writeString(2,this.sToken),e.writeString(3,this.sUA),e.writeString(4,this.sCookie),e.writeInt32(6,this.iAppid),e.writeString(8,this.sStrUid),e.writeString(9,this.sUAppId),e.writeInt32(10,this.iNetType)},r.MediaUserId.prototype.readFrom=function(e){this.lUid=e.readInt64(0,!1,this.lUid),this.sGuid=e.readString(1,!1,this.sGuid),this.sToken=e.readString(2,!1,this.sToken),this.sUA=e.readString(3,!1,this.sUA),this.sCookie=e.readString(4,!1,this.sCookie),this.iAppid=e.readInt32(6,!1,this.iAppid),this.sStrUid=e.readString(8,!1,this.sStrUid),this.sUAppId=e.readString(9,!1,this.sUAppId),this.iNetType=e.readInt32(10,!1,this.iNetType)},r.MediaResolution=function(){this.iWidth=0,this.iHeight=0},r.MediaResolution.prototype._clone=function(){return new r.MediaResolution},r.MediaResolution.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.MediaResolution.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.MediaResolution.prototype.writeTo=function(e){e.writeInt32(0,this.iWidth),e.writeInt32(1,this.iHeight)},r.MediaResolution.prototype.readFrom=function(e){this.iWidth=e.readInt32(0,!1,this.iWidth),this.iHeight=e.readInt32(1,!1,this.iHeight)},r.MediaStreamFormatInfo=function(){this.sFormatName="",this.sUrl="",this.sSuffix="",this.vIPList=new s.Vector(new s.STRING),this.iIsSupport=0,this.iRate=0,this.sAdditionalParam="",this.lFormatPropertyFlag=0},r.MediaStreamFormatInfo.prototype._clone=function(){return new r.MediaStreamFormatInfo},r.MediaStreamFormatInfo.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.MediaStreamFormatInfo.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.MediaStreamFormatInfo.prototype.writeTo=function(e){e.writeString(0,this.sFormatName),e.writeString(1,this.sUrl),e.writeString(2,this.sSuffix),e.writeVector(3,this.vIPList),e.writeInt32(4,this.iIsSupport),e.writeInt32(5,this.iRate),e.writeString(6,this.sAdditionalParam),e.writeInt64(7,this.lFormatPropertyFlag)},r.MediaStreamFormatInfo.prototype.readFrom=function(e){this.sFormatName=e.readString(0,!1,this.sFormatName),this.sUrl=e.readString(1,!1,this.sUrl),this.sSuffix=e.readString(2,!1,this.sSuffix),this.vIPList=e.readVector(3,!1,this.vIPList),this.iIsSupport=e.readInt32(4,!1,this.iIsSupport),this.iRate=e.readInt32(5,!1,this.iRate),this.sAdditionalParam=e.readString(6,!1,this.sAdditionalParam),this.lFormatPropertyFlag=e.readInt64(7,!1,this.lFormatPropertyFlag)},r.MediaStreamInfo=function(){this.sCdnName="",this.sStreamName="",this.sFlvUrl="",this.sFlvSuffix="",this.sHlsUrl="",this.sHlsSuffix="",this.iLineIndex=0,this.vFlvIPList=new s.Vector(new s.STRING),this.iIsP2PSupport=0,this.sP2pUrl="",this.sP2pSuffix="",this.lFreeFlag=0,this.iIsHEVCSupport=0,this.vP2pIPList=new s.Vector(new s.STRING),this.iPCPriorityRate=0,this.iWebPriorityRate=0,this.iMobilePriorityRate=0,this.sAdditionalParam="",this.mMediaStreamFormatInfo=new s.Map(new s.STRING,new r.MediaStreamFormatInfo)},r.MediaStreamInfo.prototype._clone=function(){return new r.MediaStreamInfo},r.MediaStreamInfo.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.MediaStreamInfo.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.MediaStreamInfo.prototype.writeTo=function(e){e.writeString(0,this.sCdnName),e.writeString(1,this.sStreamName),e.writeString(2,this.sFlvUrl),e.writeString(3,this.sFlvSuffix),e.writeString(4,this.sHlsUrl),e.writeString(5,this.sHlsSuffix),e.writeInt32(6,this.iLineIndex),e.writeVector(7,this.vFlvIPList),e.writeInt32(8,this.iIsP2PSupport),e.writeString(9,this.sP2pUrl),e.writeString(10,this.sP2pSuffix),e.writeInt64(11,this.lFreeFlag),e.writeInt32(12,this.iIsHEVCSupport),e.writeVector(13,this.vP2pIPList),e.writeInt32(14,this.iPCPriorityRate),e.writeInt32(15,this.iWebPriorityRate),e.writeInt32(16,this.iMobilePriorityRate),e.writeString(17,this.sAdditionalParam),e.writeMap(18,this.mMediaStreamFormatInfo)},r.MediaStreamInfo.prototype.readFrom=function(e){this.sCdnName=e.readString(0,!1,this.sCdnName),this.sStreamName=e.readString(1,!1,this.sStreamName),this.sFlvUrl=e.readString(2,!1,this.sFlvUrl),this.sFlvSuffix=e.readString(3,!1,this.sFlvSuffix),this.sHlsUrl=e.readString(4,!1,this.sHlsUrl),this.sHlsSuffix=e.readString(5,!1,this.sHlsSuffix),this.iLineIndex=e.readInt32(6,!1,this.iLineIndex),this.vFlvIPList=e.readVector(7,!1,this.vFlvIPList),this.iIsP2PSupport=e.readInt32(8,!1,this.iIsP2PSupport),this.sP2pUrl=e.readString(9,!1,this.sP2pUrl),this.sP2pSuffix=e.readString(10,!1,this.sP2pSuffix),this.lFreeFlag=e.readInt64(11,!1,this.lFreeFlag),this.iIsHEVCSupport=e.readInt32(12,!1,this.iIsHEVCSupport),this.vP2pIPList=e.readVector(13,!1,this.vP2pIPList),this.iPCPriorityRate=e.readInt32(14,!1,this.iPCPriorityRate),this.iWebPriorityRate=e.readInt32(15,!1,this.iWebPriorityRate),this.iMobilePriorityRate=e.readInt32(16,!1,this.iMobilePriorityRate),this.sAdditionalParam=e.readString(17,!1,this.sAdditionalParam),this.mMediaStreamFormatInfo=e.readMap(18,!1,this.mMediaStreamFormatInfo)},r.StreamGearInfo=function(){this.sDisplayName="",this.iBitRate=0,this.iCodecType=0,this.iHEVCBitRate=-1,this.tResolution=new r.MediaResolution,this.sAdditionalParam="",this.mSupportFormat=new s.Map(new s.STRING,new s.INT64),this.sBusiGearIndex=""},r.StreamGearInfo.prototype._clone=function(){return new r.StreamGearInfo},r.StreamGearInfo.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.StreamGearInfo.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.StreamGearInfo.prototype.writeTo=function(e){e.writeString(0,this.sDisplayName),e.writeInt32(1,this.iBitRate),e.writeInt32(2,this.iCodecType),e.writeInt32(3,this.iHEVCBitRate),e.writeStruct(4,this.tResolution),e.writeString(5,this.sAdditionalParam),e.writeMap(6,this.mSupportFormat),e.writeString(7,this.sBusiGearIndex)},r.StreamGearInfo.prototype.readFrom=function(e){this.sDisplayName=e.readString(0,!1,this.sDisplayName),this.iBitRate=e.readInt32(1,!1,this.iBitRate),this.iCodecType=e.readInt32(2,!1,this.iCodecType),this.iHEVCBitRate=e.readInt32(3,!1,this.iHEVCBitRate),this.tResolution=e.readStruct(4,!1,this.tResolution),this.sAdditionalParam=e.readString(5,!1,this.sAdditionalParam),this.mSupportFormat=e.readMap(6,!1,this.mSupportFormat),this.sBusiGearIndex=e.readString(7,!1,this.sBusiGearIndex)},r.MediaStreamNameInfoPack=function(){this.vMediaStreamInfo=new s.Vector(new r.MediaStreamInfo),this.vStreamGearInfo=new s.Vector(new r.StreamGearInfo),this.sStreamGroupId="",this.lLiveCompatibleFlag=0,this.sAntiCode="",this.lStreamId=0,this.lUid=0,this.iStreamProperty=0,this.iBitRate=0,this.iStreamType=0,this.iPcDefaultBitRate=0,this.iWebDefaultBitRate=0,this.iMobileDefaultBitRate=0,this.sStreamBusiProperty="",this.sAdditionalParam="",this.iStreamCategory=0},r.MediaStreamNameInfoPack.prototype._clone=function(){return new r.MediaStreamNameInfoPack},r.MediaStreamNameInfoPack.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.MediaStreamNameInfoPack.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.MediaStreamNameInfoPack.prototype.writeTo=function(e){e.writeVector(0,this.vMediaStreamInfo),e.writeVector(1,this.vStreamGearInfo),e.writeString(2,this.sStreamGroupId),e.writeInt64(3,this.lLiveCompatibleFlag),e.writeString(4,this.sAntiCode),e.writeInt64(5,this.lStreamId),e.writeInt64(6,this.lUid),e.writeInt32(7,this.iStreamProperty),e.writeInt32(8,this.iBitRate),e.writeInt32(9,this.iStreamType),e.writeInt32(10,this.iPcDefaultBitRate),e.writeInt32(11,this.iWebDefaultBitRate),e.writeInt32(12,this.iMobileDefaultBitRate),e.writeString(13,this.sStreamBusiProperty),e.writeString(14,this.sAdditionalParam),e.writeInt32(15,this.iStreamCategory)},r.MediaStreamNameInfoPack.prototype.readFrom=function(e){this.vMediaStreamInfo=e.readVector(0,!1,this.vMediaStreamInfo),this.vStreamGearInfo=e.readVector(1,!1,this.vStreamGearInfo),this.sStreamGroupId=e.readString(2,!1,this.sStreamGroupId),this.lLiveCompatibleFlag=e.readInt64(3,!1,this.lLiveCompatibleFlag),this.sAntiCode=e.readString(4,!1,this.sAntiCode),this.lStreamId=e.readInt64(5,!1,this.lStreamId),this.lUid=e.readInt64(6,!1,this.lUid),this.iStreamProperty=e.readInt32(7,!1,this.iStreamProperty),this.iBitRate=e.readInt32(8,!1,this.iBitRate),this.iStreamType=e.readInt32(9,!1,this.iStreamType),this.iPcDefaultBitRate=e.readInt32(10,!1,this.iPcDefaultBitRate),this.iWebDefaultBitRate=e.readInt32(11,!1,this.iWebDefaultBitRate),this.iMobileDefaultBitRate=e.readInt32(12,!1,this.iMobileDefaultBitRate),this.sStreamBusiProperty=e.readString(13,!1,this.sStreamBusiProperty),this.sAdditionalParam=e.readString(14,!1,this.sAdditionalParam),this.iStreamCategory=e.readInt32(15,!1,this.iStreamCategory)},r.MediaStreamInfoPack=function(){this.mMediaStreamInfoPack=new s.Map(new s.STRING,new r.MediaStreamNameInfoPack)},r.MediaStreamInfoPack.prototype._clone=function(){return new r.MediaStreamInfoPack},r.MediaStreamInfoPack.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.MediaStreamInfoPack.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.MediaStreamInfoPack.prototype.writeTo=function(e){e.writeMap(0,this.mMediaStreamInfoPack)},r.MediaStreamInfoPack.prototype.readFrom=function(e){this.mMediaStreamInfoPack=e.readMap(0,!1,this.mMediaStreamInfoPack)},r.GetStreamInfoByRoomFakeReq=function(){this.tId=new r.MediaUserId,this.sRoomId="",this.mpVariable=new s.Map(new s.STRING,new s.STRING),this.iMediaPackType=-1,this.mBusiParams=new s.Map(new s.STRING,new s.STRING)},r.GetStreamInfoByRoomFakeReq.prototype._clone=function(){return new r.GetStreamInfoByRoomFakeReq},r.GetStreamInfoByRoomFakeReq.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.GetStreamInfoByRoomFakeReq.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.GetStreamInfoByRoomFakeReq.prototype.writeTo=function(e){e.writeStruct(0,this.tId),e.writeString(1,this.sRoomId),e.writeMap(2,this.mpVariable),e.writeInt32(3,this.iMediaPackType),e.writeMap(4,this.mBusiParams)},r.GetStreamInfoByRoomFakeReq.prototype.readFrom=function(e){this.tId=e.readStruct(0,!1,this.tId),this.sRoomId=e.readString(1,!1,this.sRoomId),this.mpVariable=e.readMap(2,!1,this.mpVariable),this.iMediaPackType=e.readInt32(3,!1,this.iMediaPackType),this.mBusiParams=e.readMap(4,!1,this.mBusiParams)},r.GetStreamInfoByRoomFakeRsp=function(){this.tStreamInfoPack=new r.MediaStreamInfoPack,this.mpConfig=new s.Map(new s.STRING,new s.STRING),this.sRoomId=""},r.GetStreamInfoByRoomFakeRsp.prototype._clone=function(){return new r.GetStreamInfoByRoomFakeRsp},r.GetStreamInfoByRoomFakeRsp.prototype._write=function(e,t,i){e.writeStruct(t,i)},r.GetStreamInfoByRoomFakeRsp.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},r.GetStreamInfoByRoomFakeRsp.prototype.writeTo=function(e){e.writeStruct(0,this.tStreamInfoPack),e.writeMap(1,this.mpConfig),e.writeString(2,this.sRoomId)},r.GetStreamInfoByRoomFakeRsp.prototype.readFrom=function(e){this.tStreamInfoPack=e.readStruct(0,!1,this.tStreamInfoPack),this.mpConfig=e.readMap(1,!1,this.mpConfig),this.sRoomId=e.readString(2,!1,this.sRoomId)}},function(e,t,i){"use strict";i.r(t);var s=i(3),r=i(4),a=i(15),n=i(14),o=i(22),h=i(5),u=i(0),l=i(17),d=i(23),c=i(30),p=!!Number(localStorage._printProtocol),f=!!Number(localStorage._printGateway),m=function(e){Object(a.a)(i,e);var t=Object(n.a)(i);function i(){var e;return Object(s.a)(this,i),(e=t.call(this)).WEBSOCKET_CONNECTED="WEBSOCKET_CONNECTED",e.WEBSOCKET_CLOSED="WEBSOCKET_CLOSED",e.WEBSOCKET_ERROR="WEBSOCKET_ERROR",e.TAFLINK_INITED="TAFLINK_INITED",e._taf=null,e.delayWup=[],e.delayListener=[],e.streamName=null,e.requestId=1,e}return Object(r.a)(i,[{key:"getRequestId",value:function(){return this.requestId++,1e5===this.requestId&&(this.requestId=1),this.requestId}},{key:"getTaf",value:function(){return this._taf}},{key:"setTafHandler",value:function(e){var t=h.a.now();u.a.log("%c[TIME] initTafTime="+t,"color:#A23400;background:#FFF5C2"),e.getTaf&&l.default.setTaf(e.getTaf()),e.registerUriMap(y.UriMapping),e.registerWupMap(y.WupMapping),this._taf=e,this._taf.connected?this._onConnected():this._taf.addListener(this.WEBSOCKET_CONNECTED,this._onConnected.bind(this)),this.emit(this.TAFLINK_INITED)}},{key:"_onConnected",value:function(){u.a.log("TafLink._onConnected sendWup size=".concat(this.delayWup.length));var e=this;this.delayWup.forEach((function(t){var i=t.servantName,s=t.funcName,r=t.data,a=t.callback,n=t.once,o=t.iRequestId,h=t.noTid;e.sendWup(i,s,r,a,n,o,h)})),this.delayWup=[],this.delayListener.forEach((function(t){var i=t.p0,s=t.p1,r=t.p2;switch(i){case"add":e.addListener(s,r);break;case"remove":e.removeListener(s,r);break;case"dispatch":e.dispatch(s,r)}})),this.delayListener=[]}},{key:"getUserId",value:function(){return this._taf.getUserId()}},{key:"sendWup",value:function(e,t,i){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:-1,n=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(!this.connected)return u.a.log("TafLink.sendWup connected=false",e,t),void this.delayWup.push({servantName:e,funcName:t,data:i,callback:s,once:r,iRequestId:a,noTid:n});this._taf.sendWup2?this._taf.sendWup2(e,t,i,s,r,a,n):this._taf.sendWup(e,t,i,s,r,a,n)}},{key:"getInfoFromVG",value:function(e,t,i,s){if(this._taf){var r=this._taf.getTaf().BinBuffer,a=new l.default.GetInfoFromVGReq;a.lUid=e,a.sMsg=new r(i.marshall().buffer),a.sProtoName="yy",a.iUri=t,a.tId=this.getUserId(),this.sendWup("videogateway","getInfoFromVG",a,(function(e){s(e)}),!0)}else u.a.warn("TafLink.sendYY taf not init!")}},{key:"sendYY",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(this._taf){var a=e.constructor.name,n=d.a[a];n||"function"!=typeof e.marshall||(n=new DataView(e.marshall().buffer).getUint32(4,!0)),p&&u.a.log("%c>>>>>>> "+a,_("#009100"),"uri="+n,e);var o=null,h="mediaui",m="getInfoFromVGM";if("function"==typeof this._taf.packVGInfo)o=this._taf.packVGInfo(n,e,this.streamName);else{var y=this._taf.getTaf().BinBuffer;h="videogateway",m=r?"getInfoFromCdnVG":"getInfoFromVG",(o=new l.default.GetInfoFromVGReq).lUid=i||0,o.sMsg=new y(e.marshall().buffer),o.sProtoName="yy",o.iUri=n||0,o.lSid=0,o.tId=this.getUserId()}this.sendWup(h,m,o,function(i){if(0!=i.sMsg.len){if(!i.lUid||!o.lUid||i.lUid==o.lUid){var s=new DataView(i.sMsg.buffer),r=new c.a(s);if(!(a=d.a[r.uri]))throw f||u.a.log("%c<<<<<<< %crspWup:%c GetInfoFromVG",_("#0000E3"),_("black"),_("#0000E3"),"videogateway",i),new Error("[x] Unmatched protocol, uri=".concat(r.uri>>8," resCode=").concat(r.resCode," len=").concat(r.len));var n=r;p&&u.a.log("%c<<<<<<< "+a,_("#0000E3"),n),"function"==typeof t?t(n):this.dispatch(r.uri,n)}}else u.a.warn("GetInfoFromVG response an empty pkg.",e,o,i)}.bind(this),s)}else u.a.warn("TafLink.sendYY taf not init!")}},{key:"addListener",value:function(e,t){this.connected?this._taf.addListener(e,t):this.delayListener.push({p0:"add",p1:e,p2:t})}},{key:"removeListener",value:function(e,t){this.connected?this._taf.removeListener(e,t):this.delayListener.push({p0:"remove",p1:e,p2:t})}},{key:"dispatch",value:function(e,t){this.connected?this._taf.dispatch(e,t):this.delayListener.push({p0:"dispatch",p1:e,p2:t})}},{key:"inited",get:function(){return!!this._taf}},{key:"connected",get:function(){return this._taf&&this._taf.connected}}]),i}(o.EventEmitter);function _(e,t,i){var s="font-weight:900";return e&&(s+=";color:"+e),t&&(s+=";background:"+t),i&&(s+=";border:3px solid "+i),s}var y={UriMapping:{8102:l.default.LivingStreamInfoNotice,8103:l.default.LivingStreamEndNotice,1025601:l.default.LiveMeetingSyncNotice,1400200:l.default.ImgplusABTestNotice},WupMapping:{getInfoFromVG:l.default.GetInfoFromVGRsp,GetInfoFromVG:l.default.GetInfoFromVGRsp,getInfoFromCdnVG:l.default.GetInfoFromVGRsp,getCdnTokenInfoEx:l.default.GetCdnTokenExRsp,getLivingStreamInfo:l.default.GetLivingStreamInfoRsp,getP2PStreamInfo:l.default.GetP2PStreamInfoRsp,getP2PStreamTokenInfoEx:l.default.GetP2PStreamTokenExRsp,queryHttpDns:l.default.QueryHttpDnsRsp,loginVerify:l.default.LoginVerifyRsp,joinGroup:l.default.JoinMediaGroupRsp,quitGroup:l.default.QuitMediaGroupRsp,wsTimeSync:l.default.WSTimeSyncRsp,onClientGetStunAndPcdnProxyReq:l.default.ClientGetStunAndPcdnProxyRsp,clientQueryPcdnSchedule:l.default.ClientQueryPcdnScheduleRsp,onClientGetPcdnFlvOutsideSdkFullstreamInfo:l.default.ClientGetPcdnFlvOutsideSdkFullstreamInfoRsp,onClientGetVodPcdnProxyReq:l.default.ClientGetVodPcdnProxyReqRsp,getMediaRec:l.default.RecSysRsp,getStreamInfoByRoomFake:l.default.GetStreamInfoByRoomFakeRsp},NoLog:{8102:1,8103:1,1025601:1,getInfoFromVG:1,GetInfoFromVG:1,getInfoFromCdnVG:1,getInfoFromVGM:1,getCdnTokenInfoEx:1,videoClientReport:1}},v=new m;t.default=v},function(e,t,i){"use strict";t.a={printTodecodeVideo:!1,printToDecodeAudio:!1,printDecodedVideo:!1,printDecodedAudio:!1,printTorenderVideo:!1,printTorenderAudio:!1,printAppendVideo:!1,printAppendAudio:!1,printVideoDecodeFast:!1,printRenderSkipFrame:!1,setCfg:function(e){for(var t in e)this[t]=e[t]}}},function(e,t,i){"use strict";var s=i(3),r=i(4),a=navigator.userAgent,n=function(){function e(){Object(s.a)(this,e),this.matches=null,this.versionFuncs=null,this.device="",this.language="",this.browser="",this.version={major:0,full:""},this.kernel="",this.kernelVersion=0,this.os="",this.osVersion="",this.genBrowserInfo(),this.amendOSVersionCallback=null}return Object(r.a)(e,[{key:"getMatches",value:function(){var e=a;this.matches={Trident:e.indexOf("Trident")>-1||e.indexOf("NET CLR")>-1,Presto:e.indexOf("Presto")>-1,WebKit:e.indexOf("AppleWebKit")>-1,Gecko:e.indexOf("Gecko/")>-1,KHTML:e.indexOf("KHTML/")>-1,Safari:e.indexOf("Safari")>-1,Chrome:e.indexOf("Chrome")>-1||e.indexOf("CriOS")>-1,IE:e.indexOf("MSIE")>-1||e.indexOf("Trident")>-1,Edge:e.indexOf("Edge")>-1||e.indexOf("Edg/")>-1,Firefox:e.indexOf("Firefox")>-1||e.indexOf("FxiOS")>-1,"Firefox Focus":e.indexOf("Focus")>-1,Chromium:e.indexOf("Chromium")>-1,Opera:e.indexOf("Opera")>-1||e.indexOf("OPR")>-1,Vivaldi:e.indexOf("Vivaldi")>-1,Yandex:e.indexOf("YaBrowser")>-1,Arora:e.indexOf("Arora")>-1,Lunascape:e.indexOf("Lunascape")>-1,QupZilla:e.indexOf("QupZilla")>-1,"Coc Coc":e.indexOf("coc_coc_browser")>-1,Kindle:e.indexOf("Kindle")>-1||e.indexOf("Silk/")>-1,Iceweasel:e.indexOf("Iceweasel")>-1,Konqueror:e.indexOf("Konqueror")>-1,Iceape:e.indexOf("Iceape")>-1,SeaMonkey:e.indexOf("SeaMonkey")>-1,Epiphany:e.indexOf("Epiphany")>-1,360:e.indexOf("QihooBrowser")>-1||e.indexOf("QHBrowser")>-1,"360EE":e.indexOf("360EE")>-1,"360SE":e.indexOf("360SE")>-1,UC:e.indexOf("UCBrowser")>-1||e.indexOf(" UBrowser")>-1||e.indexOf("UCWEB")>-1,QQBrowser:e.indexOf("QQBrowser")>-1,QQ:e.indexOf("QQ/")>-1,Baidu:e.indexOf("Baidu")>-1||e.indexOf("BIDUBrowser")>-1||e.indexOf("baidubrowser")>-1||e.indexOf("baiduboxapp")>-1||e.indexOf("BaiduHD")>-1,Maxthon:e.indexOf("Maxthon")>-1,Sogou:e.indexOf("MetaSr")>-1||e.indexOf("Sogou")>-1,Liebao:e.indexOf("LBBROWSER")>-1||e.indexOf("LieBaoFast")>-1,"2345Explorer":e.indexOf("2345Explorer")>-1||e.indexOf("Mb2345Browser")>-1||e.indexOf("2345chrome")>-1,"115Browser":e.indexOf("115Browser")>-1,TheWorld:e.indexOf("TheWorld")>-1,XiaoMi:e.indexOf("MiuiBrowser")>-1,Quark:e.indexOf("Quark")>-1,Qiyu:e.indexOf("Qiyu")>-1,Wechat:e.indexOf("MicroMessenger")>-1,WechatWork:e.indexOf("wxwork/")>-1,Taobao:e.indexOf("AliApp(TB")>-1,Alipay:e.indexOf("AliApp(AP")>-1,Weibo:e.indexOf("Weibo")>-1,Douban:e.indexOf("com.douban.frodo")>-1,Suning:e.indexOf("SNEBUY-APP")>-1,iQiYi:e.indexOf("IqiyiApp")>-1,DingTalk:e.indexOf("DingTalk")>-1,Huawei:e.indexOf("HuaweiBrowser")>-1||e.indexOf("HUAWEI/")>-1||e.indexOf("HONOR")>-1,Vivo:e.indexOf("VivoBrowser")>-1,Windows:e.indexOf("Windows")>-1,Linux:e.indexOf("Linux")>-1||e.indexOf("X11")>-1,"Mac OS":e.indexOf("Macintosh")>-1,Android:e.indexOf("Android")>-1||e.indexOf("Adr")>-1,HarmonyOS:e.indexOf("HarmonyOS")>-1,Ubuntu:e.indexOf("Ubuntu")>-1,FreeBSD:e.indexOf("FreeBSD")>-1,Debian:e.indexOf("Debian")>-1,"Windows Phone":e.indexOf("IEMobile")>-1||e.indexOf("Windows Phone")>-1,BlackBerry:e.indexOf("BlackBerry")>-1||e.indexOf("RIM")>-1,MeeGo:e.indexOf("MeeGo")>-1,Symbian:e.indexOf("Symbian")>-1,iOS:e.indexOf("like Mac OS X")>-1,"Chrome OS":e.indexOf("CrOS")>-1,WebOS:e.indexOf("hpwOS")>-1,Mobile:e.indexOf("Mobi")>-1||e.indexOf("iPh")>-1||e.indexOf("480")>-1,Tablet:e.indexOf("Tablet")>-1||e.indexOf("Pad")>-1||e.indexOf("Nexus 7")>-1},this.matches.Mobile?this.matches.Mobile=!(e.indexOf("iPad")>-1):this.is360()&&(this.mime("type","application/gameplugin")||navigator&&void 0!==navigator.connection&&void 0===navigator.connection.saveData?this.matches["360SE"]=!0:this.matches["360EE"]=!0),this.matches.Baidu&&this.matches.Opera?this.matches.Baidu=!1:this.matches.iOS&&(this.matches.Safari=!0),window.chrome&&(window.chrome.adblock2345||window.chrome.common2345)&&(this.matches["2345Explorer"]=!0)}},{key:"genBrowserInfo",value:function(){this.getMatches();var e,t={kernel:["WebKit","Trident","Gecko","Presto","KHTML"],browser:["Safari","Chrome","Edge","IE","Firefox","Firefox Focus","Chromium","Opera","Vivaldi","Yandex","Arora","Lunascape","QupZilla","Coc Coc","Kindle","Iceweasel","Konqueror","Iceape","SeaMonkey","Epiphany","XiaoMi","Vivo","360","360SE","360EE","UC","QQBrowser","QQ","Huawei","Baidu","Maxthon","Sogou","Liebao","2345Explorer","115Browser","TheWorld","Quark","Qiyu","Wechat","WechatWork","Taobao","Alipay","Weibo","Douban","Suning","iQiYi","DingTalk"],os:["Windows","Linux","Mac OS","Android","HarmonyOS","Ubuntu","FreeBSD","Debian","iOS","Windows Phone","BlackBerry","MeeGo","Symbian","Chrome OS","WebOS"],device:["Mobile","Tablet"]};for(var i in this.device="PC",this.language=((e=(navigator.browserLanguage||navigator.language).split("-"))[1]&&(e[1]=e[1].toUpperCase()),e.join("_")),t)for(var s=0;s<t[i].length;s++){var r=t[i][s];this.matches[r]&&(this[i]=r)}this.getOSVersion(),this.getBrowserVersion(),this.amendSpecialCase(),this.amendOSVersion()}},{key:"getOSVersion",value:function(){var e=a,t={Windows:function(){var t=e.replace(/^Mozilla\/\d.0 \(Windows NT ([\d.]+)[;)].*$/,"$1");return{10:"10",6.4:"10",6.3:"8.1",6.2:"8",6.1:"7","6.0":"Vista",5.2:"XP",5.1:"XP","5.0":"2000"}[t]||t},Android:function(){return e.replace(/^.*Android ([\d.]+);.*$/,"$1")},HarmonyOS:function(){return{10:"2"}[e.replace(/^Mozilla.*Android ([\d.]+)[;)].*$/,"$1")]||""},iOS:function(){return e.replace(/^.*OS ([\d_]+) like.*$/,"$1").replace(/_/g,".")},Debian:function(){return e.replace(/^.*Debian\/([\d.]+).*$/,"$1")},"Windows Phone":function(){return e.replace(/^.*Windows Phone( OS)? ([\d.]+);.*$/,"$2")},"Mac OS":function(){return e.replace(/^.*Mac OS X ([\d_]+).*$/,"$1").replace(/_/g,".")},WebOS:function(){return e.replace(/^.*hpwOS\/([\d.]+);.*$/,"$1")}};this.osVersion="",t[this.os]&&(this.osVersion=t[this.os](),this.osVersion==e&&(this.osVersion=""))}},{key:"amendOSVersion",value:function(){var e=this;"Windows"===this.os&&navigator.userAgentData&&navigator.userAgentData.getHighEntropyValues&&navigator.userAgentData.getHighEntropyValues(["platformVersion"]).then((function(t){t.platformVersion&&parseInt(t.platformVersion.split(".")[0])>=13&&(e.osVersion="11",e.amendOSVersionCallback&&e.amendOSVersionCallback())}))}},{key:"getBrowserVersion",value:function(){var e=a;if(this.versionFuncs={Safari:function(){return e.replace(/^.*Version\/([\d.]+).*$/,"$1")},Chrome:function(){return e.replace(/^.*Chrome\/([\d.]+).*$/,"$1").replace(/^.*CriOS\/([\d.]+).*$/,"$1")},IE:function(){return e.replace(/^.*MSIE ([\d.]+).*$/,"$1").replace(/^.*rv:([\d.]+).*$/,"$1")},Edge:function(){return e.replace(/^.*Edge\/([\d.]+).*$/,"$1").replace(/^.*Edg\/([\d.]+).*$/,"$1")},Firefox:function(){return e.replace(/^.*Firefox\/([\d.]+).*$/,"$1").replace(/^.*FxiOS\/([\d.]+).*$/,"$1")},"Firefox Focus":function(){return e.replace(/^.*Focus\/([\d.]+).*$/,"$1")},Chromium:function(){return e.replace(/^.*Chromium\/([\d.]+).*$/,"$1")},Opera:function(){return e.replace(/^.*Opera\/([\d.]+).*$/,"$1").replace(/^.*OPR\/([\d.]+).*$/,"$1")},Vivaldi:function(){return e.replace(/^.*Vivaldi\/([\d.]+).*$/,"$1")},Yandex:function(){return e.replace(/^.*YaBrowser\/([\d.]+).*$/,"$1")},Arora:function(){return e.replace(/^.*Arora\/([\d.]+).*$/,"$1")},Lunascape:function(){return e.replace(/^.*Lunascape[\/\s]([\d.]+).*$/,"$1")},QupZilla:function(){return e.replace(/^.*QupZilla[\/\s]([\d.]+).*$/,"$1")},"Coc Coc":function(){return e.replace(/^.*coc_coc_browser\/([\d.]+).*$/,"$1")},Kindle:function(){return e.replace(/^.*Version\/([\d.]+).*$/,"$1")},Iceweasel:function(){return e.replace(/^.*Iceweasel\/([\d.]+).*$/,"$1")},Konqueror:function(){return e.replace(/^.*Konqueror\/([\d.]+).*$/,"$1")},Iceape:function(){return e.replace(/^.*Iceape\/([\d.]+).*$/,"$1")},SeaMonkey:function(){return e.replace(/^.*SeaMonkey\/([\d.]+).*$/,"$1")},Epiphany:function(){return e.replace(/^.*Epiphany\/([\d.]+).*$/,"$1")},360:function(){return e.replace(/^.*QihooBrowser\/([\d.]+).*$/,"$1")},"360SE":function(){return{86:"13.0",78:"12.0",69:"11.0",63:"10.0",55:"9.1",45:"8.1",42:"8.0",31:"7.0",21:"6.3"}[e.replace(/^.*Chrome\/([\d]+).*$/,"$1")]||""},"360EE":function(){return{86:"13.0",78:"12.0",69:"11.0",63:"9.5",55:"9.0",50:"8.7",30:"7.5"}[e.replace(/^.*Chrome\/([\d]+).*$/,"$1")]||""},Maxthon:function(){return e.replace(/^.*Maxthon\/([\d.]+).*$/,"$1")},QQBrowser:function(){return e.replace(/^.*QQBrowser\/([\d.]+).*$/,"$1")},QQ:function(){return e.replace(/^.*QQ\/([\d.]+).*$/,"$1")},Baidu:function(){return e.replace(/^.*BIDUBrowser[\s\/]([\d.]+).*$/,"$1").replace(/^.*baiduboxapp\/([\d.]+).*$/,"$1")},UC:function(){return e.replace(/^.*UC?Browser\/([\d.]+).*$/,"$1")},Sogou:function(){return e.replace(/^.*SE ([\d.X]+).*$/,"$1").replace(/^.*SogouMobileBrowser\/([\d.]+).*$/,"$1")},Liebao:function(){var t="";e.indexOf("LieBaoFast")>-1&&(t=e.replace(/^.*LieBaoFast\/([\d.]+).*$/,"$1"));var i=e.replace(/^.*Chrome\/([\d]+).*$/,"$1");return t||{57:"6.5",49:"6.0",46:"5.9",42:"5.3",39:"5.2",34:"5.0",29:"4.5",21:"4.0"}[i]||""},"2345Explorer":function(){return{69:"10.0",55:"9.9"}[navigator.userAgent.replace(/^.*Chrome\/([\d]+).*$/,"$1")]||e.replace(/^.*2345Explorer\/([\d.]+).*$/,"$1").replace(/^.*Mb2345Browser\/([\d.]+).*$/,"$1")},"115Browser":function(){return e.replace(/^.*115Browser\/([\d.]+).*$/,"$1")},TheWorld:function(){return e.replace(/^.*TheWorld ([\d.]+).*$/,"$1")},XiaoMi:function(){return e.replace(/^.*MiuiBrowser\/([\d.]+).*$/,"$1")},Vivo:function(){return e.replace(/^.*VivoBrowser\/([\d.]+).*$/,"$1")},Quark:function(){return e.replace(/^.*Quark\/([\d.]+).*$/,"$1")},Qiyu:function(){return e.replace(/^.*Qiyu\/([\d.]+).*$/,"$1")},Wechat:function(){return e.replace(/^.*MicroMessenger\/([\d.]+).*$/,"$1")},WechatWork:function(){return e.replace(/^.*wxwork\/([\d.]+).*$/,"$1")},Taobao:function(){return e.replace(/^.*AliApp\(TB\/([\d.]+).*$/,"$1")},Alipay:function(){return e.replace(/^.*AliApp\(AP\/([\d.]+).*$/,"$1")},Weibo:function(){return e.replace(/^.*weibo__([\d.]+).*$/,"$1")},Douban:function(){return e.replace(/^.*com.douban.frodo\/([\d.]+).*$/,"$1")},Suning:function(){return e.replace(/^.*SNEBUY-APP([\d.]+).*$/,"$1")},iQiYi:function(){return e.replace(/^.*IqiyiVersion\/([\d.]+).*$/,"$1")},DingTalk:function(){return e.replace(/^.*DingTalk\/([\d.]+).*$/,"$1")},Huawei:function(){return e.replace(/^.*Version\/([\d.]+).*$/,"$1").replace(/^.*HuaweiBrowser\/([\d.]+).*$/,"$1")}},this.versionFuncs[this.browser]){var t=this.versionFuncs[this.browser]();t!==e&&(this.version.major=parseInt(t),this.version.full=t)}}},{key:"amendSpecialCase",value:function(){var e=a;if("Chrome"==this.browser&&e.match(/\S+Browser/)){this.browser=e.match(/\S+Browser/)[0];var t=e.replace(/^.*Browser\/([\d.]+).*$/,"$1");this.version.major=parseInt(t),this.version.full=t}if("Firefox"!=this.browser||!window.clientInformation&&window.u2f||(this.kernel=this.browser,this.kernelVersion=this.version.major,this.browser+=" Nightly"),"Edge"==this.browser)this.version.major>75?(this.kernel="Chrome",this.kernelVersion=parseInt(this.versionFuncs.Chrome())):(this.kernel="EdgeHTML",this.kernelVersion=0);else if(this.matches.Chrome&&"WebKit"===this.kernel&&parseInt(this.versionFuncs.Chrome())>27)this.kernel="Chrome",this.kernelVersion=parseInt(this.versionFuncs.Chrome());else if("Opera"==this.browser&&this.version.major>12)this.kernel="Chrome",this.kernelVersion=parseInt(this.versionFuncs.Chrome());else if("Yandex"==this.browser)this.kernel="Chrome",this.kernelVersion=parseInt(this.versionFuncs.Chrome());else if(this.matches.Safari&&"WebKit"===this.kernel){var i=e.replace(/^.*Version\/([\d.]+).*$/,"$1");i===e&&(i=e.replace(/^.*AppleWebKit\/([\d.]+).*$/,"$1")),this.kernelVersion=parseInt(i)||0}}},{key:"is360",value:function(){var e=a,t=!1;if(window.chrome){var i=Number(e.replace(/^.*Chrome\/([\d]+).*$/,"$1"));this.mime("type","application/360softmgrplugin")||this.mime("type","application/mozilla-npqihooquicklogin")||i>36&&window.showModalDialog?t=!0:i>45&&(!(t=this.mime("type","application/vnd.chromium.remoting-viewer"))&&i>=69&&(t=this.mime("type","application/hwepass2001.installepass2001")||this.mime("type","application/asx")))}return t}},{key:"mime",value:function(e,t){var i=navigator.mimeTypes;for(var s in i)if(i[s][e]==t)return!0;return!1}}]),e}();t.a=new n},function(e,t,i){"use strict";t.a={AVC1:"avc1.42E01E,mp4a.40.2",HVC1:"hvc1.1.6.L93,mp4a.40.2",AV01:"av01.0.08M.08,mp4a.40.2",isMseSupportedH264:function(){return this._isSupported(this.AVC1)},isMseSupportedHevc:function(){return this._isSupported(this.HVC1)},isMseSupportedAV01:function(){return this._isSupported(this.AV01)},_isSupported:function(e){return window.MediaSource&&window.MediaSource.isTypeSupported("video/mp4; codecs=".concat(e))}}},function(e,t,i){"use strict";var s,r="object"==("undefined"==typeof Reflect?"undefined":_(Reflect))?Reflect:null,a=r&&"function"==typeof r.apply?r.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)};s=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var n=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}e.exports=o,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var h=10;function u(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+_(e))}function l(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function d(e,t,i,s){var r,a,n,o;if(u(i),void 0===(a=e._events)?(a=e._events=Object.create(null),e._eventsCount=0):(void 0!==a.newListener&&(e.emit("newListener",t,i.listener?i.listener:i),a=e._events),n=a[t]),void 0===n)n=a[t]=i,++e._eventsCount;else if("function"==typeof n?n=a[t]=s?[i,n]:[n,i]:s?n.unshift(i):n.push(i),(r=l(e))>0&&n.length>r&&!n.warned){n.warned=!0;var h=new Error("Possible EventEmitter memory leak detected. "+n.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");h.name="MaxListenersExceededWarning",h.emitter=e,h.type=t,h.count=n.length,o=h,console&&console.warn&&console.warn(o)}return e}function c(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(e,t,i){var s={fired:!1,wrapFn:void 0,target:e,type:t,listener:i},r=c.bind(s);return r.listener=i,s.wrapFn=r,r}function f(e,t,i){var s=e._events;if(void 0===s)return[];var r=s[t];return void 0===r?[]:"function"==typeof r?i?[r.listener||r]:[r]:i?function(e){for(var t=new Array(e.length),i=0;i<t.length;++i)t[i]=e[i].listener||e[i];return t}(r):y(r,r.length)}function m(e){var t=this._events;if(void 0!==t){var i=t[e];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function y(e,t){for(var i=new Array(t),s=0;s<t;++s)i[s]=e[s];return i}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return h},set:function(e){if("number"!=typeof e||e<0||n(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");h=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||n(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return l(this)},o.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var s="error"===e,r=this._events;if(void 0!==r)s=s&&void 0===r.error;else if(!s)return!1;if(s){var n;if(t.length>0&&(n=t[0]),n instanceof Error)throw n;var o=new Error("Unhandled error."+(n?" ("+n.message+")":""));throw o.context=n,o}var h=r[e];if(void 0===h)return!1;if("function"==typeof h)a(h,this,t);else{var u=h.length,l=y(h,u);for(i=0;i<u;++i)a(l[i],this,t)}return!0},o.prototype.addListener=function(e,t){return d(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return d(this,e,t,!0)},o.prototype.once=function(e,t){return u(t),this.on(e,p(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){return u(t),this.prependListener(e,p(this,e,t)),this},o.prototype.removeListener=function(e,t){var i,s,r,a,n;if(u(t),void 0===(s=this._events))return this;if(void 0===(i=s[e]))return this;if(i===t||i.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete s[e],s.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){for(r=-1,a=i.length-1;a>=0;a--)if(i[a]===t||i[a].listener===t){n=i[a].listener,r=a;break}if(r<0)return this;0===r?i.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(i,r),1===i.length&&(s[e]=i[0]),void 0!==s.removeListener&&this.emit("removeListener",e,n||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,i,s;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[e]),this;if(0===arguments.length){var r,a=Object.keys(i);for(s=0;s<a.length;++s)"removeListener"!==(r=a[s])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=i[e]))this.removeListener(e,t);else if(void 0!==t)for(s=t.length-1;s>=0;s--)this.removeListener(e,t[s]);return this},o.prototype.listeners=function(e){return f(this,e,!0)},o.prototype.rawListeners=function(e){return f(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},o.prototype.listenerCount=m,o.prototype.eventNames=function(){return this._eventsCount>0?s(this._events):[]}},function(e,t,i){"use strict";var s={PAudienceGetProxyListReq:530178,PAudienceGetProxyListRsp:530434,PNotifyStreamSwitch:268034,PLoginVideoProxyUniformly:5650690,PLoginVideoProxyUniformlyRes:5650434,PNotifyCurrentCdnStream:2739202,PNotifyCurrentStream4:2675714,PSubscribeStream3:2667266,PSubscribeStreamRes3:2667522,PStreamData3:2666754,PStopStream3:2666498,PStopStream:2560514,PPullStreamData:2694146,PResendStreamData4:2689026,PResendStreamDataFailAck:2694402,PVideoSyncSpeakerTime3:2674690,PForceConnectVideoProxy3:2685442,PVideoProxyPing3:2669570,PVideoProxyPingRes4:2683650,PNotifyMultiVideo:2746370,PLoginAndSubscribe:4097282,PLoginAndSubscribeRes:4097538,PNotifyUplinkRecvCount3:2672642,PVideoBroadcast4:2754050,PUpdateVideoConfig2:2569474,PVideoQualityStatistics:2591746,PP2pPing2:40706,PP2pPing3:41218,PP2pVideoPing3:2671874,VIDEOP2P_PFlashP2PKeepAlive:3072514,VIDEOP2P_PFlashP2PKeepAliveRes:3072770,P2PGetNodesProxy3:2673410,P2PGetNodesProxyRes3:2673666,P2PSubscribeStream3:2673922,P2PRemoveSubscribe3:2674178,P2PKeepAlive:3074562,P2PKeepAliveRes:3074818,P2PNotifyNodeLeave:3075074,P2PSyncDepth:3075330,P2PKeepAliveWebrtc:3075842,P2PKeepAliveWebrtcRes:3076098,PP2PWSForward:2757378,PP2PWSForwardReject:5653506,P2PSubStream:3073026,P2PSubStreamRes:3073282,P2PSyncSubTree:3073538,P2PTest:3073794,P2PRemoveSub:3074306,P2PRemoveSubRes:3075586,P2PStreamAlive:3076354,P2POffer:12316162,P2PAnswer:12316418,P2PCandidate:12316674,P2POfferReject:12316930,P2PRequestOffer:12317186,P2PVersionFailed:12317442,P2PPingOverProxy:12317698,P2PPunchBackReq:12317954,P2PPunchBackRsp:12318210,PCDNNotifyUrl:20740866,PCDNStatusReport:20741122,PCDNGetUrl:20741378,PCDNSwitchUrl:20741634,PCdnP2PWSForward:53283,PCdnP2PWSForwardReject:53539,PCdnProxyPing:26147,PCdnProxyPingRes:26403,PCdnP2PStatics:26659,PCdnP2PErrStatics:26915,PCdnP2pGetNode:51235,PCdnP2pGetNodeRes:51491,PCdnP2PNodePingThroughProxy:52259,PCdnP2PNodePunchThroughProxy:52515,PCdnP2PUserRegister:52771,PCdnP2PUserRegisterRes:53027,PCdnP2pReportLog:54051,PCdnForceConnectVideoProxy:54563,PCDNGetProxyListReq:153635,PCDNGetProxyListRsp:153891,PCDNGetSliceStreamInfoReq:154147,PCDNGetSliceStreamInfoRsp:154403,PCDNSubscribeReq:768547,PCDNSubscribeRes:768803,PCDNCompeteSubscribeReq:769059,PCDNCompeteSubscribeRes:769315,PCDNForceSubscribeNotify:769571,PCdnP2pUserUnRegister:770083,PP2pSliceData:511779,PP2pSliceAudioData:512035,PP2pSliceVideoData:512291,PP2pSliceCommonData:514083,PP2pSliceSignalData:514595,PP2pSliceAudioDataV2:517411,PP2pSliceControlData:1024547,PForceConnectCdnVideoProxy3:2711042,HuyaDelaySeiData:17920770};!function e(){if(!e.done){e.done=!0;var t=[];for(var i in s){var r=s[i];t.push({uri:r,name:i})}t.forEach((function(e){s[e.uri]=e.name}))}}(),t.a=s},function(e,t,i){"use strict";function s(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}i.d(t,"a",(function(){return s}))},function(e,t,i){function s(e){var t={};function i(s){if(t[s])return t[s].exports;var r=t[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=t,i.i=function(e){return e},i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:s})},i.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/",i.oe=function(e){throw console.error(e),e};var s=i(i.s=ENTRY_MODULE);return s.default||s}function r(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function a(e,t,s){var a={};a[s]=[];var n=t.toString(),o=n.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!o)return a;for(var h,u=o[1],l=new RegExp("(\\\\n|\\W)"+r(u)+"\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)","g");h=l.exec(n);)"dll-reference"!==h[3]&&a[s].push(h[3]);for(l=new RegExp("\\("+r(u)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)',"g");h=l.exec(n);)e[h[2]]||(a[s].push(h[1]),e[h[2]]=i(h[1]).m),a[h[2]]=a[h[2]]||[],a[h[2]].push(h[4]);for(var d,c=Object.keys(a),p=0;p<c.length;p++)for(var f=0;f<a[c[p]].length;f++)d=a[c[p]][f],isNaN(1*d)||(a[c[p]][f]=1*a[c[p]][f]);return a}function n(e){return Object.keys(e).reduce((function(t,i){return t||e[i].length>0}),!1)}e.exports=function(e,t){t=t||{};var r={main:i.m},o=t.all?{main:Object.keys(r.main)}:function(e,t){for(var i={main:[t]},s={main:[]},r={main:{}};n(i);)for(var o=Object.keys(i),h=0;h<o.length;h++){var u=o[h],l=i[u].pop();if(r[u]=r[u]||{},!r[u][l]&&e[u][l]){r[u][l]=!0,s[u]=s[u]||[],s[u].push(l);for(var d=a(e,e[u][l],u),c=Object.keys(d),p=0;p<c.length;p++)i[c[p]]=i[c[p]]||[],i[c[p]]=i[c[p]].concat(d[c[p]])}}return s}(r,e),h="";Object.keys(o).filter((function(e){return"main"!==e})).forEach((function(e){for(var t=0;o[e][t];)t++;o[e].push(t),r[e][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",h=h+"var "+e+" = ("+s.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+o[e].map((function(t){return JSON.stringify(t)+": "+r[e][t].toString()})).join(",")+"});\n"})),h=h+"new (("+s.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+o.main.map((function(e){return JSON.stringify(e)+": "+r.main[e].toString()})).join(",")+"}))(self);";var u=new window.Blob([h],{type:"text/javascript"});if(t.bare)return u;var l=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(u),d=new window.Worker(l);return d.objectURL=l,d}},function(e,t,i){e.exports=function(e){var t={};function i(s){if(t[s])return t[s].exports;var r=t[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==_(e)&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(s,r,function(t){return e[t]}.bind(null,r));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function a(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,s=new Array(t);i<t;i++)s[i]=e[i];return s}function o(e,t){var i=e.toString().length,s=Math.max(0,t-i),r="";if(s>0)for(var a=0;a<s;a++)r+="0";return r+e}function h(){var e=new Date,t=e.getFullYear(),i=o(e.getMonth()+1,2),s=o(e.getDate(),2),r=o(e.getHours(),2),a=o(e.getMinutes(),2),n=o(e.getSeconds(),2);return"["+"".concat(t,"-").concat(i,"-").concat(s," ").concat(r,":").concat(a,":").concat(n)+"."+o(e.getMilliseconds(),3)+"][w265]"}i.r(t);var u=[];function l(){for(var e,t=h(),i=arguments.length,s=new Array(i),r=0;r<i;r++)s[r]=arguments[r];s[0]=t+s[0],self.logCallback?(e=self.logCallback).call.apply(e,[null].concat(s)):u.push(s)}var d=function(){function e(t,i){s(this,e),this.width=t,this.height=i,this.stridey=this.width,this.strideu=this.stridey/2,this.stridev=this.stridey/2}return a(e,[{key:"calc",value:function(e){for(var t=new Uint8Array(this.stridey*this.height).fill(128,0,this.stridey*this.height),i=new Uint8Array(this.strideu*this.height).fill(128,0,this.strideu*this.height),s=new Uint8Array(this.stridev*this.height).fill(128,0,this.stridev*this.height),r=new Uint8Array(this.width*this.height*4),a=1e3*window.performance.now(),n=0;n<e;n++)this.convertYUV420(t,i,s,this.width,this.height,this.stridey,this.strideu,this.stridev,r);return 1e3*window.performance.now()-a}},{key:"convertYUV420",value:function(e,t,i,s,r,a,n,o,h){for(var u,l,d,c,p,f=0,m=0,_=s>>1,y=_*r,v=0,S=0,g=0,T=0;T<y;T++)p=T<<1,u=1.164*(e[v+(c=f<<1)]-16),l=t[S+f]-128,d=i[g+f]-128,h[0+(p<<2)]=u+1.596*d,h[1+(p<<2)]=u-.813*d-.391*l,h[2+(p<<2)]=u+2.018*l,h[3+(p<<2)]=255,u=1.164*(e[v+c+1]-16),h[0+(p+1<<2)]=u+1.596*d,h[1+(p+1<<2)]=u-.813*d-.391*l,h[2+(p+1<<2)]=u+2.018*l,h[3+(p+1<<2)]=255,++f===_&&(f=0,v+=a,S=(++m>>1)*n,g=(m>>1)*o)}}]),e}(),c=function(){function e(){s(this,e)}return a(e,null,[{key:"isSupportWasm",value:function(){return"object"==("undefined"==typeof WebAssembly?"undefined":_(WebAssembly))}},{key:"isSupportWasmThread",value:function(){if("undefined"==typeof SharedArrayBuffer||"undefined"==typeof Atomics)return l("hevcd","SharedArrayBuffer undefined or Atomics undefined"),!1;var e=new WebAssembly.Memory({initial:1,maximum:1,shared:!0}).buffer instanceof SharedArrayBuffer;return self.SharedArrayBuffer&&self.Atomics&&e}}]),e}(),p=function(){function e(){s(this,e),this.cla="hevcd",this.configs=null,this.costUs=0,this.reason=0,this.cores=navigator.hardwareConcurrency,this.is64bit=this.is64bitSoftware(),this.enableCost=!0}return a(e,[{key:"parseConfigs",value:function(e){this.configs=e,l(this.cla,"parse",JSON.stringify(e),"cfg",this.configs.enableWebH265)}},{key:"isSupportH265",value:function(e,t){if(null==this.configs)return l(this.cla,"isSupportH265 configs==null"),!1;this.reason=0;var i=this.isConfigEnable()&&this.isCPUCoresSatisfy(t)&&this.isWasm()&&this.isBitrateInRange(t)&&this.isCostInRange(t);return l(this.cla,"isSupportH265",i,"kbps=",t,"costUs",this.costUs.toFixed(0),"cores",this.cores,"64b",this.is64bit,"reason",this.reason,"version",e,"cfg",JSON.stringify(this.configs)),l("ua:",navigator.userAgent),{isSupport:i,costUs:this.costUs.toFixed(0),reason:this.reason}}},{key:"isWasm",value:function(){return!!c.isSupportWasm()||(this.reason=7,!1)}},{key:"isConfigEnable",value:function(){return!(!this.hasOwnProperty("enableWebH265")||1!=this.configs.enableWebH265&&(this.reason=1,1))}},{key:"isCPUCoresSatisfy",value:function(e){if(this.hasOwnProperty("core")){var t=this.configs.core[2e3];if(this.configs.core.hasOwnProperty(e)&&(t=this.configs.core[e]),this.cores>t)return!0}else if(this.cores>4)return!0;return this.reason=2,!1}},{key:"is64bitSoftware",value:function(){return-1!=navigator.userAgent.indexOf("Macintosh")||-1!=navigator.userAgent.indexOf("x64")}},{key:"isBitrateInRange",value:function(e){return c.isSupportWasmThread()?!(!this.hasOwnProperty("multiThreadBitKbps")||((e>=4e3||0==e)&&!this.checkX86(e)?(this.reason=4,1):(!Array.isArray(this.configs.multiThreadBitKbps)||!this.configs.multiThreadBitKbps.includes(e))&&(this.reason=3,1))):(this.reason=6,!1)}},{key:"checkX86",value:function(e){if(this.is64bit)return!0;if(!this.hasOwnProperty("x86"))return!1;var t=!1;return this.configs.x86.hasOwnProperty(e)&&(t=1==this.configs.x86[e]),t}},{key:"isCostInRange",value:function(e){if(!this.enableCost)return!0;if(!this.hasOwnProperty("baseCostUs"))return!1;var t=this.configs.baseCostUs[2e3];return this.configs.baseCostUs.hasOwnProperty(e)&&(t=this.configs.baseCostUs[e]),this.costUs=this.getCost(),this.costUs<=t||(this.reason=5,!1)}},{key:"getCost",value:function(){var e=this;if(!this.hasOwnProperty("loopCount"))return l(this.cla,"getCost configs==null or has no key=loopCount"),0;var t=0;return localStorage.hasOwnProperty("w265LastCost")&&(t=Number(localStorage.w265LastCost)),this.sid&&clearTimeout(this.sid),this.sid=setTimeout((function(){var t=new d(120,120);localStorage.w265LastCost=Math.floor(t.calc(e.configs.loopCount))}),5e3),t}},{key:"hasOwnProperty",value:function(e){return!!this.configs.hasOwnProperty(e)||(this.reason=1,!1)}}]),e}(),f=function(){function e(){s(this,e),this.configMgr=new p}return a(e,[{key:"parseConfigs",value:function(e){this.configMgr.parseConfigs(e)}},{key:"isSupportH265",value:function(e){return this.configMgr.isSupportH265(this.version(),e)}},{key:"version",value:function(){return"1.5.3"}},{key:"setLogCallback",value:function(e){var t;t=e,self.logCallback=t,l("Logger setLogCallback"),u.length>0&&(u.forEach((function(e){var t;(t=self.logCallback).call.apply(t,[null].concat(function(e){return function(e){if(Array.isArray(e))return n(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return n(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(i):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?n(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e)))})),u.length=0)}},{key:"isStripe",value:function(){return-1!==navigator.userAgent.indexOf("Windows")}}],[{key:"getInstance",value:function(){return this.instance||(this.instance=new e),this.instance}}]),e}();t.default=f}]).default},function(e,t,i){"use strict";i.r(t);var s=i(3),r=i(4),a=function(){function e(){Object(s.a)(this,e),this.uid=0,this.encoderSource=0,this.uploadType=0,this.frameDts=0,this.caputureTime=0,this.encodeEndTime=0,this.sendFrameTime=0}return Object(r.a)(e,[{key:"unmarshall",value:function(e){this.uid=e.popUInt64(),this.encoderSource=e.popUInt8(),this.uploadType=e.popUInt8(),this.frameDts=e.popUInt64(),this.caputureTime=e.popUInt64(),this.encodeEndTime=e.popUInt64(),this.sendFrameTime=e.popUInt64()}}]),e}();t.default=a},function(e,t,i){"use strict";i.r(t);var s=i(3),r=i(4),a=i(29),n=function(){function e(){Object(s.a)(this,e),this.dtsGapSum=0,this.delaySum=0,this.serverInfos=[]}return Object(r.a)(e,[{key:"unmarshall",value:function(e){this.dtsGapSum=e.popInt64(),this.delaySum=e.popUInt64();for(var t=e.popUInt32();t>0;){t--;var i=new a.default;i.unmarshall(e),this.serverInfos.push(i)}}}]),e}();t.default=n},function(e,t,i){"use strict";i.r(t);var s=i(3),r=i(4),a=function(){function e(){Object(s.a)(this,e),this.enable=0,//!=0时表示有效数据
this.proxyIdLow=0,this.proxyIdHigh=0,this.proxyType=0,this.serverDelay=0,this.lastPeriodDelay=0}return Object(r.a)(e,[{key:"unmarshall",value:function(e){this.enable=e.popUInt8(),this.proxyIdLow=e.popUInt32(),this.proxyIdHigh=e.popUInt32(),this.proxyType=e.popUInt16(),this.serverDelay=e.popUInt32(),this.lastPeriodDelay=e.popUInt32()}},{key:"getProxyIdStr",value:function(){return this.proxyIdHigh.toString(16)+this.proxyIdLow.toString(16)}}]),e}();t.default=a},function(e,t,i){"use strict";var s=i(3),r=i(4),a=function(){function e(t){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Object(s.a)(this,e),this.view=t,this.pos=0,this.len=0,this.uri=0,this.resCode=0,!0===i&&(this.len=this.popUInt32(),this.uri=this.popUInt32(),this.resCode=this.popUInt16())}return Object(r.a)(e,[{key:"bytesAvailable",value:function(){return this.view.byteLength-this.pos}},{key:"popBool",value:function(){return 1==this.popUInt8()}},{key:"popUInt8",value:function(){if(this.pos+1>this.view.byteLength)return 0;var e=this.view.getUint8(this.pos);return this.pos++,e}},{key:"popUInt16",value:function(){if(this.pos+2>this.view.byteLength)return 0;var e=this.view.getUint16(this.pos,!0);return this.pos+=2,e}},{key:"popUInt32",value:function(){if(this.pos+4>this.view.byteLength)return 0;var e=this.view.getUint32(this.pos,!0);return this.pos+=4,e}},{key:"popUInt64",value:function(){if(this.pos+8>this.view.byteLength)return 0;var e=this.view.getUint32(this.pos,!0);this.pos+=4;var t=this.view.getUint32(this.pos,!0);return this.pos+=4,4294967296*t+e}},{key:"popInt64",value:function(){for(var e=0,t=(128&this.view.getUint8(this.pos+7))>0,i=!0,s=0;s<8;s++){var r=this.view.getUint8(this.pos+s);t&&(i?0!=r&&(r=255&~(r-1),i=!1):r=255&~r),e+=r*Math.pow(2,8*s)}return t&&(e=-e),this.pos+=8,e}},{key:"popUint8Array",value:function(){var e=this.popUInt16();if(this.pos+e>this.view.byteLength)return null;var t=new Uint8Array(this.view.buffer,this.pos,e);return this.pos+=e,t.slice()}},{key:"popUint8Array32",value:function(){var e=this.popUInt32();if(this.pos+e>this.view.byteLength)return null;var t=new Uint8Array(this.view.buffer,this.pos,e);return this.pos+=e,t.slice()}},{key:"popUInt64Vector",value:function(){var e=this.popUInt32();if(this.pos+8*e>this.view.byteLength)return null;for(var t=[],i=0;i<e;i++)t.push(this.popUInt64());return t}},{key:"popUInt32Vector",value:function(){var e=this.popUInt32();if(this.pos+4*e>this.view.byteLength)return null;for(var t=[],i=0;i<e;i++)t.push(this.popUInt32());return t}},{key:"popUInt16Vector",value:function(){var e=this.popUInt32();if(this.pos+2*e>this.view.byteLength)return null;for(var t=[],i=0;i<e;i++)t.push(this.popUInt16());return t}},{key:"popString",value:function(){var e=this.popUInt16();if(this.pos+e>this.view.byteLength)return null;for(var t=[],i=0;i<e;++i)t[i]=String.fromCharCode(this.popUInt8());return t.join("")}},{key:"popMapKey8Val32",value:function(){for(var e=this.popUInt32(),t=new Map,i=0;i<e;i++){var s=this.popUInt8(),r=this.popUInt32();t.set(s,r)}return t}},{key:"popMapKey64Val64",value:function(){for(var e=this.popUInt32(),t=new Map,i=0;i<e;i++){var s=this.popUInt64(),r=this.popUInt64();t.set(s,r)}return t}}]),e}();t.a=a},function(e,t){e.exports=function(e){console.log("[ Timer worker init ]");var t=null;function i(){clearInterval(t),t=null}e.addEventListener("message",(function(s){switch(s.data){case"start":i(),t=setInterval((function(){e.postMessage({})}),10);break;case"stop":i()}})),e.addEventListener("messageerror",(function(e){console.error("[TimerWorker.messageerror]",e)}))}},function(e,t,i){"use strict";i.r(t);var s=i(3),r=i(4),a=function(){function e(){Object(s.a)(this,e),this.systime=0,this.encode_delay=0,this.send_buffer=0}return Object(r.a)(e,[{key:"unmarshall",value:function(e){this.systime=e.popUInt64(),this.encode_delay=e.popUInt32(),this.send_buffer=e.popUInt32()}}]),e}();t.default=a},function(e,t,i){"use strict";i.r(t);var s=i(3),r=i(4),a=i(27),n=i(28),o=function(){function e(){Object(s.a)(this,e),this.anchorSei=new a.default,this.serverSei=new n.default}return Object(r.a)(e,[{key:"unmarshall",value:function(e){this.anchorSei.unmarshall(e),this.serverSei.unmarshall(e)}}]),e}();t.default=o},function(e,t,i){e.exports=i(36)('!function(t){var e={};function s(i){if(e[i])return e[i].exports;var a=e[i]={i:i,l:!1,exports:{}};return t[i].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)s.d(i,a,function(e){return t[e]}.bind(null,a));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=0)}([function(t,e,s){"use strict";s.r(e);class i{constructor(){}}i.INIT="init",i.INITED="inited",i.STOP="stop",i.PAUSE="pause",i.RESUME="resume",i.PLAY="play",i.AUDIO_FRAME="audio_frame",i.UPDATE_CURRENT_TIME="update_current_time",i.TIME_STAMP="timestamp",i.VOLUME="volume",i.AUDIO_DATA_NAN="AUDIO_DATA_NAN",i.AUDIO_DATA_MUTE="AUDIO_DATA_MUTE",i.LOG_CFG="LOG_CFG";var a=i;const r=12;class n extends AudioWorkletProcessor{constructor(t){super(t),this.port.onmessage=this.onMessage.bind(this),this.audioList=[],this.channelDataLength=128,this.outputChannelNums=2,this.traceNums=0,this.currentTime=0,this.inited=!1,this.renderNums=0,this._id=0,this.postMessage(a.INITED),this.isAudioDataNaNCnt=0,this.isAudioDataZeroCnt=0,this.printProcess=!1,this.printAudioData=!1,this.overFlowTs=0}postMessage(t,e){this.port.postMessage({type:t,data:e})}onMessage(t){switch(t.data.type){case a.INIT:this.outputChannelNums=t.data.data.outputChannelCount,this.inited=!0,this._id=t.data.data.id,this.mainSharedArrayBuffer=t.data.data.mainSharedArrayBuffer;break;case a.PAUSE:break;case a.STOP:this.audioList.length=0;break;case a.PLAY:case a.RESUME:break;case a.AUDIO_FRAME:this.audioFrameTransToFloat32Array_new(t.data.data);break;case a.VOLUME:this.volume=t.data.data;break;case a.LOG_CFG:this.printProcess=t.data.data.printProcess,this.printAudioData=t.data.data.printAudioData,this.printRenderSkipAudio=t.data.data.printRenderSkipAudio}}setAudioCurrentDts(t){this.currentTime!=t&&(this.printProcess&&console.log("BypassProcessor.setAudioCurrentDts now",t,"diff",t-this.currentTime),this.currentTime=t,this.renderNums++,this.mainSharedArrayBuffer&&Atomics.store(this.mainSharedArrayBuffer,r,this.currentTime),this.postMessage("timestamp",{timeStamp:t,renderNums:this.renderNums}))}handleOuputs(t,e){if(this.audioList.length<1)return!0;const s=t[0];this.channelDataLength=s[0].length;let i=this.audioList.shift(),a=i.buffer,r=this.renderNums<5?0:this.volume;i.isEmptyAudioFrame&&(r=0);for(var n=0;n<a.byteLength;n++)for(var o=0;o<s.length;o++)s[o][n]=a[n*s.length+o]*r,this.traceNums++;return this.setAudioCurrentDts(i.timestamp),!0}checkDrop(){let t=this.audioList.length;if(t>2){let e=this.audioList[0];if(this.audioList[t-1].timestamp-e.timestamp>80){let s=Date.now();if(0===this.overFlowTs)this.overFlowTs=s;else if(s-this.overFlowTs>4e3&&this.renderNums%10==0){let s=0,i=0,a=0;for(let r=0;r<t;r++){let t=this.audioList[r];if(0===s&&e.timestamp<t.timestamp)i=r,s=t.timestamp;else if(s>0&&t.timestamp>s){a=r;break}}let r=this.audioList.splice(i,a-i);if(this.printRenderSkipAudio){let t=[];r.forEach(e=>{t.push(e.timestamp)}),console.log(`BypassProcessor.checkDrop pts=${s} dropIndex=[${i},${a}] ${t.toString()}`)}}}else this.overFlowTs=0}}audioFrameTransToFloat32Array_new(t){if(!this.inited)return;t.frameBuffer;let e=!0,s=[];for(let e=0;e<t.frameBuffers.length;e++){let i=new Float32Array(t.frameBuffers[e]);s.push(i)}let i=[],r=s[0].length;for(var n=0;n<r;n++)for(let r=0;r<s.length;r++){if(Number.isNaN(s[r][n])&&(this.isAudioDataNaNCnt++,this.isAudioDataNaNCnt>=3)){this.postMessage(a.AUDIO_DATA_NAN);break}if(0!=s[r][n]&&(e=!1),i.push(s[r][n]),i.length===this.channelDataLength*this.outputChannelNums){let e=new Float32Array(this.channelDataLength*this.outputChannelNums);e.set(i.splice(0,this.channelDataLength*this.outputChannelNums)),this.audioList.push({timestamp:t.timeStamp,buffer:e,isEmptyAudioFrame:t.isEmptyAudioFrame})}}this.printAudioData&&console.log(`BypassProcessor.audioFrameTransToFloat32Array_new timeStamp=${t.timeStamp} audioList.length=${this.audioList.length}`),e&&0!=this.volume&&(this.isAudioDataZeroCnt++,this.isAudioDataZeroCnt>=100&&this.postMessage(a.AUDIO_DATA_MUTE))}audioFrameTransToFloat32Array(t){if(!this.inited)return;let e=t.frameBuffer,s=new Float32Array(e),i=[],r=!0;for(let e=0;e<s.length;e++){if(Number.isNaN(s[e])&&(this.isAudioDataNaNCnt++,this.isAudioDataNaNCnt>=3)){this.postMessage(a.AUDIO_DATA_NAN);break}if(0!=s[e]&&(r=!1),i.push(s[e]),i.length===this.channelDataLength*this.outputChannelNums){let e=new Float32Array(this.channelDataLength*this.outputChannelNums);e.set(i.splice(0,this.channelDataLength*this.outputChannelNums)),this.audioList.push({timestamp:t.timeStamp,buffer:e,isEmptyAudioFrame:t.isEmptyAudioFrame})}}r&&0!=this.volume&&(this.isAudioDataZeroCnt++,this.isAudioDataZeroCnt>=100&&this.postMessage(a.AUDIO_DATA_MUTE))}process(t,e){return this.handleOuputs(e)}}registerProcessor("bypass-processor",n)}]);')},function(e,t,i){var s={"./AnchorDtsSei":27,"./AnchorDtsSei.js":27,"./AnchorSeiInfo":32,"./AnchorSeiInfo.js":32,"./HuyaDelaySeiData":33,"./HuyaDelaySeiData.js":33,"./ServerDtsSei":28,"./ServerDtsSei.js":28,"./ServerNodeInfo":29,"./ServerNodeInfo.js":29};function r(e){var t=a(e);return i(t)}function a(e){if(!i.o(s,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return s[e]}r.keys=function(){return Object.keys(s)},r.resolve=a,e.exports=r,r.id=35},function(e,t,i){"use strict";var s=window.URL||window.webkitURL;e.exports=function(e){try{var t;try{(t=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)).append(e),t=t.getBlob("application/javascript; charset=utf-8")}catch(i){t=new Blob([e],{type:"application/javascript; charset=utf-8"})}return s.createObjectURL(t)}catch(t){return"data:application/javascript,"+encodeURIComponent(e)}}},function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return r}));var s=i(19);function r(e){var t=i(39).default,r=i(7).default,a=i(16),n=a.ToMainMessageType,o=a.ReceiveMessageType;r.postMessage(n.WOREKR_READY);var h=new t;function u(){r.postMessage(n.VIDEORENDERERROR)}e.addEventListener("message",(function(t){var i=t.data,a=i.data;switch(i.type){case o.START:h.startVideoRender(a,u),e.mainSharedArrayBuffer=a.mainSharedArrayBuffer;break;case o.POSTFRAME:break;case o.RESIZE:h.updateRect(a.sizes.width,a.sizes.height);break;case o.COLSE:e.audioSamples=[],e.isBrowserHidden=!1,e.userPaused=!1,h.destroy();break;case o.VISIBILITYCHANGE:e.isBrowserHidden="hidden"==a.state,h.setBrowserHidden(e.isBrowserHidden);break;case o.FAST_OVER:h.fastOver();break;case o.VIDEOSAMPLES:h.appendVideoFrame(a.videoSamples);break;case o.AUDIOSAMPLES:h.appendAudioFrame(a.audioSamples);break;case o.AVCCONFIG:case o.AVCPPS:case o.AVCSPS:case o.AVCVPS:break;case o.AACCONFIG:h.updateAudioConfig(a.codec,a.sampleRate,a.numberOfChannels,a.timestamp);break;case o.UPDATE_VIDEOFPS:h.updateVideoFPS(a.fps,a.noReferFps);break;case o.SET_PLAY_MINBUFFER:h.setPlayMinBuffer(a.bufferLen);break;case o.SET_JITTER:h.setJitter(a);break;case o.SET_USE_SOFTACCELERATION:h.setUseSoftAcceleration();break;case o.UPDATE_SOFTACCELERATION:h.updateSoftAcceleration();break;case o.LOCAL_CONFIG:r.log("ReceiveMessageType.LOCAL_CONFIG",a),h.setLocalConfig(a);break;case o.PAUSE_VIDEO_DECODE:r.log("ReceiveMessageType.PAUSE_VIDEO_DECODE",a),h.setPauseVideoDecode(a);break;case o.PAUSE_AUDIO_DECODE:r.log("ReceiveMessageType.PAUSE_AUDIO_DECODE",a),h.setPauseAudioDecode(a);break;case o.ENABLE_DISCARD_VIDEO:r.log("ReceiveMessageType.ENABLE_DISCARD_VIDEO",a.enableDiscard),h.setEnableDiscard(a);break;case o.SET_AUDIO_WRITER:r.log("ReceiveMessageType.SET_AUDIO_WRITER"),h.startAudioRender(a.ageneratorWriter);break;case o.UPDATE_CURBITRATE:r.log("ReceiveMessageType.UPDATE_CURBITRATE",a.curBitrate),h.updateCurBitrate(a.curBitrate);break;case o.INIT_CONFIG:r.log("ReceiveMessageType.INIT_CONFIG",JSON.stringify(a));var n=JSON.parse(a.config);h.initWebcodecCfg(n.webcodecCfg,n.lowlatencyCfg);break;case o.RECV_FPS:h.setRealFps(a.recvFps);break;case o.LOG_CFG:r.log("ReceiveMessageType.LOG_CFG "+JSON.stringify(a)),s.a.setCfg(a)}}))}},function(e,t,i){"use strict";i.r(t);var s=i(3),a=i(4),o={PLAY_STATUS:"PLAY_STATUS",PLAY_CARTON:"PLAY_CARTON",PLAY_TIME_STATUS:"PLAY_TIME_STATUS",VIDEO_PLAY:"VIDEO_PLAY",VIDEO_NATIVE_PLAY:"VIDEO_NATIVE_PLAY",VIDEO_PLAYING:"VIDEO_PLAYING",VIDEO_PAUSE:"VIDEO_PAUSE",VIDEO_BAD_QUALITY:"VIDEO_BAD_QUALITY",METADATA:"METADATA",RECV_VIDEO_FRAME:"RECV_VIDEO_FRAME",VIDEO_STOP:"VIDEO_STOP",VIDEO_SEEK:"VIDEO_SEEK",BROWSER_PAUSE:"BROWSER_PAUSE",AUDIO_PLAY:"AUDIO_PLAY",AUDIO_SOUND:"AUDIO_SOUND",ANCHOR_STOP:"ANCHOR_STOP",VIDEO_LINK_CLOSE:"VIDEO_LINK_CLOSE",NO_VIDEO:"NO_VIDEO",HLS_URL_UNAVAILABLE:"HLS_URL_UNAVAILABLE",HLS_URL_LOAD_TIMEOUT:"HLS_URL_LOAD_TIMEOUT",HLS_MAINFEST_LOAD_TIMEOUT:"HLS_MAINFEST_LOAD_TIMEOUT",FLV_URL_UNAVAILABLE:"FLV_URL_UNAVAILABLE",FLV_URL_LOAD_TIMEOUT:"FLV_URL_LOAD_TIMEOUT",H5_PLAYER_ERROR:"H5_PLAYER_ERROR",PAUSE_5S_RETRY:"PAUSE_5S_RETRY",NO_DATA_RECEIVED:"NO_DATA_RECEIVED",P2P_REPORT:"P2P_REPORT",DATA_METRIC:"DATA_METRIC",DATA_METRIC2:"DATA_METRIC2",P2P_TIMEOUT:"P2P_TIMEOUT",FLV_TO_P2P:"FLV_TO_P2P",FLV_TRY_TO_P2P:"FLV_TRY_TO_P2P",FLAC_AUDIO_START:"FLAC_AUDIO_START",FLAC_AUDIO_ERROR:"FLAC_AUDIO_ERROR",FLAC_AUDIO_NEED_RETRY:"FLAC_AUDIO_NEED_RETRY",SIGNAL_PLAY:"SIGNAL_PLAY",SIGNAL_HEART:"SIGNAL_HEART",SIGNAL_DATA:"SIGNAL_DATA",SIGNAL_ERROR:"SIGNAL_ERROR",H264_SEI_PLAY:"H264_SEI_PLAY",TRANS_END:"TRANS_END",NEED_UPDATE_M3U8:"NEED_UPDATE_M3U8",PLAYBACK_UPDATE:"PLAYBACK_UPDATE",PLAYBACK_M3U8_UPDATED:"PLAYBACK_M3U8_UPDATED",PLAYBACK_DIF_CDN:"PLAYBACK_DIF_CDN",UPDATE_INTERSITY:"UPDATE_INTERSITY",PLAY_DOWNLINK_INFO:"PLAY_DOWNLINK_INFO",PLAY_FRAME_BUFFER:"PLAY_FRAME_BUFFER",WEBRTC_VIDEO_ERROR:"WEBRTC_VIDEO_ERROR",SWITCH_DONE:"SWITCH_DONE",AUTO_BITRATE_CHANGED:"AUTO_BITRATE_CHANGED",AUTO_FORCE_RSP:"AUTO_FORCE_RSP",VISIBILITY_CHANGE:"VISIBILITY_CHANGE",REPLAY_VIDEO:"REPLAY_VIDEO",P2P_PLAYING_EVENT:"P2P_PLAYING_EVENT",TURN_TO_H264:"TURN_TO_H264",H265_VIDEO_RETRY:"H265_VIDEO_RETRY",H265_PLAY:"H265_PLAY",PAUSE_5SEC_ERROR:"PAUSE_5SEC_ERROR",TRY_TO_AV1:"TRY_TO_AV1",M3U8_PLAY_ENDED:"M3U8_PLAY_ENDED",SEI_INFO:"SEI_INFO",VIDEO_RESOLUTION_CHANGE:"VIDEO_RESOLUTION_CHANGE",TURN_TO_MSE:"TURN_TO_MSE",TURN_TO_WEBCODECS_SOFT:"TURN_TO_WEBCODECS_SOFT",WEBCODECS_RETRY:"WEBCODECS_RETRY",TURN_TO_H265_WASM:"TURN_TO_H265_WASM",SHIELD_AUDIO_SWITCH_STATUS:"SHIELD_AUDIO_SWITCH_STATUS",RESET_PLAYER:"RESET_PLAYER"},l={VIDEO_PLAYING:"VIDEO_PLAYING",VIDEO_STOP:"VIDEO_STOP",VIDEO_CACHING:"VIDEO_CACHING",BROWSER_PAUSE:"BROWSER_PAUSE",AUDIO_START:"AUDIO_START",AUDIO_STOP:"AUDIO_STOP",AUDIO_PLAYING:"AUDIO_PLAYING"},d=o,f=i(2),y=i(18),v=i(0),S=i(5),g=i(1),T=function(){function e(t){var i=t.eventEmiter,r=t.stat,a=t.statVod;Object(s.a)(this,e),this.eventEmiter=i,this.stat=r,this.statVod=a,this.isSendLoadTime=!1,this.isSendHlsLoadTime=!1,this.isSendH265=!1,this.hasP2P=0,this.restartReason=-1,this.restartTimes=0,this.turnToFlvReason=-1,this.turnToFlvTimes=0,this.httpError=!1,this.busiSource="",this.isSendM3u8LoadTime=!1,this.isSendVodLoadTime=!1,this.isSendVodM3u8LoadTime=!1,this.isClosedSendVodLoadTime=!1}return Object(a.a)(e,[{key:"closeSendVodLoadTime",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.isClosedSendVodLoadTime=e}},{key:"sendCdnTime",value:function(e,t,i){if(!this.isSendLoadTime)if(this.isSendLoadTime=!0,t){var s=Math.max(0,e.connectVideoTime-e.startTime),r=e.firstVideoPkgTime-e.connectVideoTime,a=e.firstIFrameTime1-e.connectVideoTime,n=e.firstIFrameTime2-e.firstIFrameTime1,o=e.firstRenderTime-e.firstIFrameTime2,h=e.onPlayTime-e.firstRenderTime,u=e.recvDataTime-e.startTime,l=(e.onPlayTime,e.startTime,e.firstP2POnDataTime-e.startTime);l=l<0?0:l;var d=0;e.firstP2PIframeTime>0&&(d=(d=e.firstP2PIframeTime-e.startTime)<0?0:d);var c=[e.hyPlayerLoadTs,u,s,0,0,i,0,0,0,l,d],p=[this.stat.createAct(g.a.ACT.CONNECT_VIDEO_TS,{value:[s]}),this.stat.createAct(g.a.ACT.FIRST_VIDEO_PKG_TS,{value:[r]}),this.stat.createAct(g.a.ACT.FIRST_VIDEO_IFRAME_TS,{value:[a]}),this.stat.createAct(g.a.ACT.VIDEO_IFRAME_TS,{value:[n]}),this.stat.createAct(g.a.ACT.FIRST_VIDEO_RENDER_TS,{value:[o]}),this.stat.createAct(g.a.ACT.VIDEO_PLAYED_TS,{value:[h]}),this.stat.createAct(g.a.ACT.VIDEO_LOAD_TS,{value:c})];this.sendMetrics(p)}else{var f=e.getVPTime-e.startTime,m=Math.max(0,e.connectVideoTime-e.getVPTime),_=e.loginTime-e.connectVideoTime,y=e.firstVideoPkgTime-e.loginTime,v=e.firstIFrameTime-e.firstVideoPkgTime,S=e.firstRenderTime-e.firstIFrameTime,T=e.onPlayTime-e.firstRenderTime,P=e.onPlayTime-e.startTime,E=[this.stat.createAct(g.a.ACT.VIDEO_GET_VP_TS,{value:[f]}),this.stat.createAct(g.a.ACT.CONNECT_VIDEO_TS,{value:[m]}),this.stat.createAct(g.a.ACT.VIDEO_LOGIN_TS,{value:[_]}),this.stat.createAct(g.a.ACT.FIRST_VIDEO_PKG_TS,{value:[y]}),this.stat.createAct(g.a.ACT.FIRST_VIDEO_IFRAME_TS,{value:[v]}),this.stat.createAct(g.a.ACT.FIRST_VIDEO_RENDER_TS,{value:[S]}),this.stat.createAct(g.a.ACT.VIDEO_PLAYED_TS,{value:[T]}),this.stat.createAct(g.a.ACT.VIDEO_LOAD_TS,{value:[P]})];this.sendMetrics(E)}}},{key:"sendFlvTime",value:function(e,t,i,s){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;if((!this.isSendLoadTime||r)&&(this.isSendLoadTime=!0,!(e>1e4||t>1e4))){var l=0;n&&(l+=1),a&&(l+=2),this.stat.setComDim(g.a.DIM_COM.ACT_LOAD_TYPE,l);var d=[e,i,t,a,n,o,0,0,0,h,u],c=[this.stat.createAct(g.a.ACT.VIDEO_LOAD_TS,{value:d}),this.stat.createAct(g.a.ACT.CONNECT_VIDEO_TS,{value:[t]}),this.stat.createAct(g.a.ACT.RECV_VIDEO_TS,{value:[i,s]})];this.sendMetrics(c)}}},{key:"sendWebRtcTime",value:function(e,t,i,s,r){this.isSendLoadTime=!0,this.stat.setActDim("p2p","3");var a=[this.stat.createAct(g.a.ACT.VIDEO_LOAD_TS,{value:[e,0,0,0,0,t,i,s,r]})];this.sendMetrics(a)}},{key:"sendHlsTime",value:function(e,t,i,s,r,a){var n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,u=arguments.length>9?arguments[9]:void 0;if(!this.isSendHlsLoadTime){var l=0;if(o&&(l+=1),n&&(l+=2),this.stat.setComDim(g.a.DIM_COM.ACT_LOAD_TYPE,l),this.isSendHlsLoadTime=!0,!(t>1e4||i>1e4||r>1e4)){var d=[this.stat.createAct(g.a.ACT.VIDEO_LOAD_TS,{value:[t,e,0,n,o,r,h],str:[this.busiSource]}),this.stat.createAct(g.a.ACT.VIDEO_LOAD_SEG,{value:u}),this.stat.createAct(g.a.ACT.FIRST_FRAG_LOAD_TS,{value:[s,e]}),this.stat.createAct(g.a.ACT.FIRST_FRAG_LOADED_TS,{value:[r,e,h]}),this.stat.createAct(g.a.ACT.FIRST_FRAG_SIZE,{value:[a,e]})];i>0&&!this.isSendM3u8LoadTime&&(d.push(this.stat.createAct(g.a.ACT.LOAD_M3U8_TS,{value:[i,e]})),this.isSendM3u8LoadTime=!0),this.sendMetrics(d)}}}},{key:"sendM3u8LoadedTime",value:function(e,t){if(!(this.isSendM3u8LoadTime||t>1e4)){this.isSendM3u8LoadTime=!0;var i=[this.stat.createAct(g.a.ACT.LOAD_M3U8_TS,{value:[t,e]})];this.sendMetrics(i)}}},{key:"sendVodHlsTime",value:function(e){var t=e.loadType,i=e.loadTime,s=e.loadM3u8Time,r=e.firstFragLoadTs,a=e.firstFragLoadedTs,n=e.firstFragSize,o=e.businessCost,h=void 0===o?0:o,u=e.UICost,l=void 0===u?0:u,d=e.firstFragParsedTs,c=void 0===d?0:d,p=e.playTs,f=e.startTs,m=e.m3u8Status,_=e.firstTsStatus,y=e.costTimes;if(!this.isClosedSendVodLoadTime&&!(this.isSendVodLoadTime||(this.isSendVodLoadTime=!0,i>1e4&&99999!=i))){var v=[this.statVod.createAct(g.a.ACT.VIDEO_LOAD_TS,{value:[i,t,m,_,s,a,c,h,l,f,p]}),this.statVod.createAct(g.a.ACT.VIDEO_LOAD_SEG,{value:y})];i<1e4&&(v=v.concat([this.statVod.createAct(g.a.ACT.FIRST_FRAG_LOAD_TS,{value:[r,t]}),this.statVod.createAct(g.a.ACT.FIRST_FRAG_LOADED_TS,{value:[a,t,c]}),this.statVod.createAct(g.a.ACT.FIRST_FRAG_SIZE,{value:[n,t]})])),s>0&&!this.isSendVodM3u8LoadTime&&(v.push(this.statVod.createAct(g.a.ACT.LOAD_M3U8_TS,{value:[s,t]})),this.isSendVodM3u8LoadTime=!0),this.sendMetrics(v)}}},{key:"sendVodM3u8LoadedTime",value:function(e,t){if(!(this.isSendVodM3u8LoadTime||t>1e4)){this.isSendVodM3u8LoadTime=!0;var i=[this.statVod.createAct(g.a.ACT.LOAD_M3U8_TS,{value:[t,e]})];this.sendMetrics(i)}}},{key:"setBusiSource",value:function(e){this.busiSource=e}},{key:"sendMP4Time",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.loadTime;if(!(t>1e4)){var i=[this.stat.createAct(g.a.ACT.VIDEO_LOAD_TS,{value:[t],str:[this.busiSource]})];this.sendMetrics(i)}}},{key:"sendVodMP4Time",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.loadTime,i=[this.statVod.createAct(g.a.ACT.VIDEO_LOAD_TS,{value:[t],str:[this.busiSource]})];this.sendMetrics(i)}},{key:"sendMetrics",value:function(e){this.stat.checkFilter(e),this.eventEmiter.trigger(d.DATA_METRIC2,e)}},{key:"sendOldMetrics",value:function(e){this.eventEmiter.trigger(d.DATA_METRIC,e)}}]),e}();T.METRIC={VIDEO_FLOW_LINE:"video.flow.line",VIDEO_FLOW_P2P:"video.flow.p2p",VIDEO_BAD_QUALITY_RATIO:"video.video_bad_quality_ratio",WEB_HLS_PLAY_VIDEO_RATIO:"web.hls.play_video_ratio",WEB_HLS_PLAY_SUC_RATIO:"web.hls.play_suc_ratio",WEB_P2P_PLAY_RATIO:"web.p2p.play_ratio",WEB_P2P_PUNCH:"web.p2p.punch",WEB_P2P_BW_P2P_VALID:"web.p2p.bw_p2p_valid",WEB_P2P_BW_P2P_REPEAT:"web.p2p.bw_p2p_repeat",WEB_P2P_BW_P2P_TOTAL:"web.p2p.bw_p2p_total",WEB_P2P_BW_CDN_VALID:"web.p2p.bw_cdn_valid",WEB_P2P_BW_CDN_REPEAT:"web.p2p.bw_cdn_repeat",WEB_P2P_BW_CDN_TOTAL:"web.p2p.bw_cdn_total",WEB_P2P_BW_RANGE_VALID:"web.p2p.bw_range_valid",WEB_P2P_BW_RANGE_TOTAL:"web.p2p.bw_range_total",WEB_P2P_PLAY_FAIL:"web.p2p.play_fail",WEB_P2P_LOAD_RATIO:"web.p2p.load_ratio",WEB_P2P_CDN_RESTART:"web.p2p.cdn_restart",WEB_P2P_TCP_NO_SLICE:"web.p2p.tcp_no_slice",WEB_P2P_TCP_OPEN_TIME:"web.p2p.tcp_open_time",WEB_P2P_HTTP_CODE:"web.p2p.http_code_",WEB_P2P_TCP_TIMEOUT:"web.p2p.tcp_timeout",WEB_H265:"web.h265",SDK_P2P_TCP:"sdk.p2p.tcp",SDK_VIDEO_LOGIN_SUC:"sdk.video.login_suc",SDK_P2P_COOLING:"sdk.p2p.cooling",SDK_P2P_SERVER_OPEN:"sdk.p2p.server_open",SDK_P2P_USER_PROPERTY:"sdk.p2p.user_property",VIDEO_VIDEO_BAD_QUALITY_5M_RATIO:"video.video_bad_quality_5m_ratio",VIDEO_VIDEO_LOAD_ERROR:"video_load_error",RECV_DANMU_CARTON:"recv_danmu_carton",SDK_P2P_DETAILS:"sdk.p2p.details",SDK_P2P_FORCE_REASON:"sdk.p2p.force_reason",SDK_P2P_DEFAULT_REASON:"sdk.p2p.default_reason",SDK_P2P_VALID_RET:"sdk.p2p.valid_ret",SDK_P2P_GET_NODE:"sdk.p2p.get_node",WEB_USER:"web.user"},T.INTERVAL={SDK_VIDEO_QUALITY:"sdk.video.quality",SDK_VIDEO_QUALITY_5M:"sdk.video.quality_5m",SDK_CALC_FLOW:"sdk.calc.flow",SDK_P2P_TCP:"sdk.p2p.tcp",SDK_P2P_FLOW:"sdk.p2p.flow",SDK_P2P_PUNCH:"sdk.p2p.punch",SDK_P2P_SUB:"sdk.p2p.sub",SDK_P2P_RESEND:"sdk.p2p.resend",SDK_P2P_DELAY:"sdk.p2p.resend",SDK_P2P_OTHER:"sdk.p2p.other"},T.TRIGGER={SDK_HLS_PLAY:"sdk.hls.play",SDK_HLS_LOAD:"sdk.hls.load",SDK_MSE_ERROR:"sdk.mse.error",SDK_P2P_LOAD:"sdk.p2p.load",SDK_P2P_LOAD_SAMPLE:"sdk.p2p.load_sample",SDK_P2P_RESTART:"sdk.p2p.restart",SDK_WEB_H265:"sdk.web.h265"};var P=T,E=i(10);function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,s=new Array(t);i<t;i++)s[i]=e[i];return s}function w(e,t){if(e){if("string"==typeof e)return C(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(i):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?C(e,t):void 0}}function I(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=w(e))){var t=0,i=function(){};return{s:i,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,r,a=!0,n=!1;return{s:function(){s=e[Symbol.iterator]()},n:function(){var e=s.next();return a=e.done,e},e:function(e){n=!0,r=e},f:function(){try{a||null==s.return||s.return()}finally{if(n)throw r}}}}var A=i(9),R=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;Object(s.a)(this,e),this.maxSize=t,this.sum=0,this.list=[],this.idx=0,this.cur=0}return Object(a.a)(e,[{key:"reset",value:function(){this.sum=0,this.list=[],this.idx=0,this.cur=0}},{key:"addCur",value:function(e){this.cur+=e}},{key:"calculate",value:function(){this.add(this.cur);var e=this.cur;return this.cur=0,e}},{key:"add",value:function(e){this.sum+=e,this.list.length<this.maxSize?this.list.push(e):(this.sum-=this.list[this.idx],this.list[this.idx]=e),this.idx++,this.idx>=this.maxSize&&(this.idx=0)}},{key:"average",value:function(){return 0===this.list.length?A.b.UintMax:Math.round(this.sum/this.list.length)}},{key:"getSamples",value:function(){return this.list}},{key:"max",value:function(){if(0===this.list.length)return A.b.UintMax;var e,t=0,i=I(this.list);try{for(i.s();!(e=i.n()).done;){var s=e.value;s>t&&(t=s)}}catch(e){i.e(e)}finally{i.f()}return t}},{key:"min",value:function(){var e,t=A.b.UintMax,i=I(this.list);try{for(i.s();!(e=i.n()).done;){var s=e.value;s<t&&(t=s)}}catch(e){i.e(e)}finally{i.f()}return t}}]),e}(),k=function(){function e(){Object(s.a)(this,e),this.speed=new R(20),this.rtt=new R(20),this.p2p=0}return Object(a.a)(e,[{key:"addSpeed",value:function(e){var t=parseInt(e.replace("KB",""));this.speed.add(t)}},{key:"addRtt",value:function(e){this.rtt.add(e)}},{key:"setP2p",value:function(e){this.p2p=e}},{key:"getP2p",value:function(){return this.p2p}},{key:"getResult",value:function(){return{speed:this.speed.getSamples(),rtt:this.rtt.getSamples(),p2p:this.p2p}}}]),e}(),b=i(22),D=i.n(b),O={FLV:1,P2P:2,HLS:3,HUYA:4,STREAM:5,OBS:6,VR:7,HUYAWEBRTC:8,PLAYBACK:9,P2PFLV:10},F="h265",L=i(12),B=i(11);function N(e,t,i){return(N="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var s=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Object(B.a)(e)););return e}(e,t);if(s){var r=Object.getOwnPropertyDescriptor(s,t);return r.get?r.get.call(i):r.value}})(e,t,i||e)}var M=i(15),U=i(14),V=i(6),x=i(25),H=i.n(x),W=!1,G=[],j=0,Y=null;function q(e,t){for(var i=0,s=G.length;i<s;i++){var r=G[i];if(r.callback==e&&r.thisObj==t)return r}return null}function J(e,t,i){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if((i=0|(Number(i)||0))<10||i%10!=0||!e)return v.a.error("Timer.add Invalide interval value or callback function."),!1;var a=q(e,t);return a||(a={callback:e,thisObj:t,bindCallback:t?e.bind(t):e,param:s},G.push(a)),a.times=r,a.tickCount=0,a.interval=i/10,a.delayDel=!1,z(),!0}function z(){Y&&1==Number(f.a.isForceUseWorker)?Y.postMessage("start"):!j&&G.length>0&&(j=setInterval(K,10))}function K(){if(0!=G.length){W=!0;for(var e=S.a.now(),t=G.length-1;t>=0;t--){var i=G[t];if(i&&!i.delayDel){if(++i.tickCount%i.interval==0){var s=i.bindCallback,r=i.tickCount/i.interval;s(e,r,i.param),i.times>0&&i.times<=r&&i.tickCount>0&&G.splice(t,1)}}else G.splice(t,1)}W=!1}else Y&&1==Number(f.a.isForceUseWorker)?Y.postMessage("stop"):(clearInterval(j),j=0)}var Q={initWorker:function(){(Y=H()(31)).addEventListener("message",(function(e){K()})),Y.addEventListener("error",(function(e){v.a.error("TimerWorker.error:",e.lineno+","+e.colno,e.message),Y.terminate(),Y=null,v.a.warn("[ TimerWorker terminate ]"),z()}))},has:function(e,t){return!!q(e,t)},add:J,remove:function(e,t){for(var i=0,s=G.length;i<s;i++){var r=G[i];if(r.callback==e&&r.thisObj==t)return W?r.delayDel=!0:G.splice(i,1),!0}return!1},once:function(e,t,i,s){J(e,t,i+10,s,1)},getSize:function(){return G.length}},$=i(20),X={isMacChrome72:function(){return"mac"===E.a.platform&&"chrome"===E.a.name&&72===Number(E.a.version.major)},isNeedAud:function(){return E.a.chrome&&E.a.version.major>=73},isBrowserSupport:function(){var e=$.a.kernel.toLowerCase(),t=$.a.kernelVersion;if("chrome"===e&&53!=t)return!0;for(var i=($.a.browser+"").toLowerCase(),s=0;s<f.a.p2pOpenBrowsers.length;s++){var r=f.a.p2pOpenBrowsers[s];if(-1!==i.indexOf(r))return!0}return!1},isP2PCooling:function(){return 1===Number(f.a.needCooling)&&1===Number(localStorage.__p2p_cooling_play)},isSupportP2P:function(){return this.isBrowserSupport()&&!this.isP2PCooling()},isWebrtcSupport:function(){try{var e=navigator.userAgent,t={Trident:e.indexOf("Trident")>0||e.indexOf("NET CLR")>0,Presto:e.indexOf("Presto")>0,WebKit:e.indexOf("AppleWebKit")>0,Gecko:e.indexOf("Gecko/")>0,UC:e.indexOf("UC")>0||e.indexOf(" UBrowser")>0,BaiDu:e.indexOf("Baidu")>0||e.indexOf("BIDUBrowser")>0,Maxthon:e.indexOf("Maxthon")>0,LBBROWSER:e.indexOf("LBBROWSER")>0,SouGou:e.indexOf("MetaSr")>0||e.indexOf("Sogou")>0,IE:e.indexOf("MSIE")>0||e.indexOf("Trident")>0,Firefox:e.indexOf("Firefox")>0,Opera:e.indexOf("Opera")>0||e.indexOf("OPR")>0,Safari:e.indexOf("Safari")>0,Chrome:e.indexOf("Chrome")>0||e.indexOf("CriOS")>0,Wechat:e.indexOf("MicroMessenger")>0,Windows:e.indexOf("Windows")>0,Linux:e.indexOf("Linux")>0,Mac:e.indexOf("Macintosh")>0,Android:e.indexOf("Android")>0||e.indexOf("Adr")>0,WP:e.indexOf("IEMobile")>0,BlackBerry:e.indexOf("BlackBerry")>0||e.indexOf("RIM")>0||e.indexOf("BB")>0,MeeGo:e.indexOf("MeeGo")>0,Symbian:e.indexOf("Symbian")>0,iOS:e.indexOf("like Mac OS X")>0,iPhone:e.indexOf("iPh")>0,iPad:e.indexOf("iPad")>0,Mobile:e.indexOf("Mobi")>0||e.indexOf("iPh")>0||e.indexOf("480")>0,Tablet:e.indexOf("Tablet")>0||e.indexOf("iPad")>0||e.indexOf("Nexus 7")>0,TheWorld:e.indexOf("TheWorld")>0};return t.Chrome&&(t.Chrome=!(t.Opera||t.BaiDu||t.Maxthon||t.SouGou||t.UC||t.LBBROWSER||t.TheWorld)),t.Chrome}catch(e){return!1}}},Z=function(){function e(t){Object(s.a)(this,e),this.flvPlayer=t,this.eventEmitter=t.eventEmitter,this.jumpToP2PCd=1e3*(Math.floor(120*Math.random())+180),this.nextJumpToP2PTs=0,this.waitPlayEnd=!1,this.lastP2PInfo=null}return Object(a.a)(e,[{key:"reset",value:function(){this.waitPlayEnd=!1}},{key:"initJumpTs",value:function(e){0==this.nextJumpToP2PTs&&(this.nextJumpToP2PTs=e+this.jumpToP2PCd)}},{key:"onCheckTimer",value:function(e,t){if(!this.waitPlayEnd&&X.isSupportP2P()&&!(e<this.nextJumpToP2PTs)){var i=this.flvPlayer;if(this.lastP2PInfo&&!f.a.isCloseP2P(this.lastP2PInfo.uid)&&!f.a.isCloseAllFuncs(this.lastP2PInfo.uid)&&this.lastP2PInfo.lineType==i.lineType){var s=this.lastP2PInfo.sStreamName;s&&i.url&&-1!=i.url.indexOf(s)&&(i.getBufferLen()<i.mse.JITTER_BUFLEN||(this.waitPlayEnd=!0))}}}},{key:"onCheckFastTimer",value:function(e,t){this.flvPlayer.getBufferLen(),this.waitPlayEnd&&(this.waitPlayEnd=!1,this.jumpToP2PCd<18e5&&(this.jumpToP2PCd+=12e4),this.nextJumpToP2PTs=e+this.jumpToP2PCd,this.flvPlayer.getRecSysRsp({info:this.flvPlayer.info,type:"flv",metadata:this.flvPlayer.mse.metadata,isBackToP2P:!0}))}},{key:"recSysRspHandler",value:function(e,t,i){var s=this.flvPlayer;e&&t&&t.tRecSysInfo&&0==t.tRecSysInfo.lAction||(v.a.warn("BackToP2P.onCheckFastTimer jumpToP2PCd=".concat(this.jumpToP2PCd/6e4,"min, BackToP2P.tryPlayP2P")),s.loader&&s.loader.close(),this.eventEmitter.trigger(o.FLV_TRY_TO_P2P),this.lastP2PInfo=null)}}]),e}(),ee=i(13),te=function(e){Object(M.a)(i,e);var t=Object(U.a)(i);function i(e){var r;return Object(s.a)(this,i),(r=t.call(this,e)).img=null,r.isPaused=!1,r.isFirstReport=!0,r}return Object(a.a)(i,[{key:"sendFlow",value:function(e){this.record(e)}},{key:"getUserProperty",value:function(){var e=this.tsdb;return f.a[100]?f.a[101]?X.isBrowserSupport()?X.isP2PCooling()?V.a.userProperty.P2P_COOLING:1==e.turnToFlvTimes&&0==e.restartTimes?e.turnToFlvReason==V.a.turnToFlvReason.FULL_CONNECT_TIMEOUT?V.a.userProperty.FIRST_FULL_CONNECT_TIMEOUT:e.turnToFlvReason==V.a.turnToFlvReason.FULL_NO_DATA?V.a.userProperty.FIRST_FULL_NO_DATA:e.turnToFlvReason==V.a.turnToFlvReason.FULL_PLAY_FAIL?V.a.userProperty.FIRST_FULL_PLAY_FAIL:e.turnToFlvReason==V.a.turnToFlvReason.SUB_CONNECT_TIMEOUT?V.a.userProperty.SUB_CONNECT_TIMEOUT:e.turnToFlvReason==V.a.turnToFlvReason.SUB_NO_DATA?V.a.userProperty.SUB_NO_DATA:e.turnToFlvReason==V.a.turnToFlvReason.P2P_ARGS_ERROR?V.a.userProperty.P2P_ARGS_ERROR:e.turnToFlvReason==V.a.turnToFlvReason.P2P_COOLING?V.a.userProperty.P2P_COOLING:e.turnToFlvReason==V.a.turnToFlvReason.IS_NOT_FIRST_FETCH?V.a.userProperty.IS_NOT_FIRST_FETCH:e.turnToFlvReason==V.a.turnToFlvReason.VIDEO_BUFFER_EMPTY?V.a.userProperty.VIDEO_BUFFER_EMPTY:V.a.userProperty.UNKNOW:e.turnToFlvReason==V.a.turnToFlvReason.FULL_CONNECT_TIMEOUT||e.turnToFlvReason==V.a.turnToFlvReason.FULL_NO_DATA||e.turnToFlvReason==V.a.turnToFlvReason.FULL_PLAY_FAIL?e.restartReason==V.a.restartReason.RANGE_SEQ_MAX?V.a.userProperty.RESTART_RANGE_MAX:e.restartReason==V.a.restartReason.RANGE_SEQ_LARGE?V.a.userProperty.RESTART_RANGE_LARGE:e.restartReason==V.a.restartReason.CONNECT?V.a.userProperty.RESTART_CONNECT:e.restartReason==V.a.restartReason.MULTI_CDN?V.a.userProperty.RESTART_MUTI_CDN:e.restartReason==V.a.restartReason.PLAYER_NO_DATA?V.a.userProperty.RESTART_PLAYER_NO_DATA:e.restartReason==V.a.restartReason.PLAYER_ERROR?V.a.userProperty.RESTART_PLAYER_ERROR:e.restartReason==V.a.restartReason.FLV_TO_P2P?V.a.userProperty.FLV_TO_P2P:e.restartReason==V.a.restartReason.LOST_SEQ?V.a.userProperty.LOST_SEQ:V.a.userProperty.UNKNOW:e.turnToFlvReason==V.a.turnToFlvReason.SUB_CONNECT_TIMEOUT?V.a.userProperty.SUB_CONNECT_TIMEOUT:e.turnToFlvReason==V.a.turnToFlvReason.SUB_NO_DATA?V.a.userProperty.SUB_NO_DATA:e.turnToFlvReason==V.a.turnToFlvReason.P2P_ARGS_ERROR?V.a.userProperty.P2P_ARGS_ERROR:e.turnToFlvReason==V.a.turnToFlvReason.P2P_COOLING?V.a.userProperty.P2P_COOLING:e.turnToFlvReason==V.a.turnToFlvReason.IS_NOT_FIRST_FETCH?V.a.userProperty.IS_NOT_FIRST_FETCH:e.turnToFlvReason==V.a.turnToFlvReason.VIDEO_BUFFER_EMPTY?V.a.userProperty.VIDEO_BUFFER_EMPTY:V.a.userProperty.UNKNOW:V.a.userProperty.BROWSER_UN_SUPPORT:V.a.userProperty.CLIENT_CLOSE:V.a.userProperty.SERVER_CLOSE}},{key:"record",value:function(e){N(Object(B.a)(i.prototype),"sendRecordMetrics",this).call(this);var t=e.pauseCnt,s=(e.pauseTime,e.isPaused),r=e.isPausedWorker,a=(e.flowSize,e.pauseReason),n=e.volumeEnergy,o=e.isEnd,h=e.pauseWorkerCnt,u=e.isFramePaused;this.handlerPlayer.qaStaRecord&&this.handlerPlayer.qaStaRecord(),this.volumeEnergy=n,s&&(this.isPaused=!0);var l=this.getUserProperty();this.stat.setCoreDim(g.a.DIM_CORE.USER_PROPERTY,l),this.stat.setCoreDim(g.a.DIM_CORE.SIGNAL_USER_PROPERTY,0),this.stat.setComDim(g.a.DIM_COM.VIDEO_MIN_BUF,this.handlerPlayer.mse&&this.handlerPlayer.mse.JITTER_BUFLEN);var d=this.handlerPlayer.mse&&this.handlerPlayer.mse.parser.timeStampStat,c=[];d&&d.reset();var p=this.handlerPlayer.info;this.reportVideoBadQuality(s,t,o,h,r,u),this.stat.setCoreDim(g.a.DIM_CORE.VIDEO_BAD_REASON,a),this.stat.setCore(g.a.CORE.BUFFER_LENGTH,this.handlerPlayer.getBufferLen()+this.handlerPlayer.getFrameBufferLen());var m=this.handlerPlayer.getBufferLen();if(this.handlerPlayer.isShieldStart&&(m+=this.handlerPlayer.getFrameBufferLen()),this.stat.setCore(g.a.CORE.PLAY_DELAY,m),this.stat.setCore(g.a.CORE.FRAME_BUFFER_DELAY,this.handlerPlayer.getFrameBufferLen()),this.handlerPlayer._hyPlayer&&this.handlerPlayer._hyPlayer.visibility&&this.handlerPlayer._hyPlayer.visibility.setHiddenTimeStat&&this.handlerPlayer._hyPlayer.visibility.setHiddenTimeStat(),this.recordSample(),this.recordAuto(),this.handlerPlayer.recSysStat.recordHeart(this.stat),this.handlerPlayer.mse&&this.handlerPlayer.mse.buffered.record(this.stat),this.handlerPlayer.mse&&this.handlerPlayer.mse.pauseStat.record(this.stat),this.handlerPlayer.mse&&this.handlerPlayer.mse.avSyncStat.record(this.stat),this.handlerPlayer&&this.handlerPlayer.autoMonitor.recordHeartType(),this.handlerPlayer.mse&&this.handlerPlayer.mse.metadata){var _=this.handlerPlayer.mse.metadata,y=_.recvVideoFps,S=_.recvAudioFps;this.stat.setComp(g.a.DIM_LINK_SAM.name,g.a.DIM_LINK_SAM.AUDIO_RATE,S),this.stat.setComp(g.a.DIM_LINK_SAM.name,g.a.DIM_LINK_SAM.VIDEO_RATE,y)}if(this.handlerPlayer.mse&&this.handlerPlayer.mse.bufStat){var T=this.handlerPlayer.mse.bufStat.getStats(),E=T.emptyTime,C=T.emptyCnt;this.stat.setComp(g.a.DIM_LINK_SAM.name,g.a.DIM_LINK_SAM.VIDEO_BUFFER_EMPTY_COUNT,C),this.stat.setComp(g.a.DIM_LINK_SAM.name,g.a.DIM_LINK_SAM.VIDEO_BUFFER_EMPTY_TIME,E)}this.handlerPlayer._hyPlayer&&this.handlerPlayer._hyPlayer.costUs>0&&this.stat.setComp(g.a.DIM_H265_SAM.name,"costUs",this.handlerPlayer._hyPlayer.costUs),this.recordWebCodecsStat();var w=this.handlerPlayer.loader.speed;this.stat.setComp(g.a.DIM_LINK_SAM.name,g.a.DIM_LINK_SAM.SPEED,w);var A=this.handlerPlayer.mse&&this.handlerPlayer.mse.curVideoDts,R=this.handlerPlayer.mse&&this.handlerPlayer.mse.curAudioDts;this.stat.setComp(g.a.DIM_LINK_SAM.name,g.a.DIM_LINK_SAM.VIDEO_DTS,A),this.stat.setComp(g.a.DIM_LINK_SAM.name,g.a.DIM_LINK_SAM.AUDIO_DTS,R),this.stat.setCompFormat(g.a.DIM_LINK_SAM.name,":",","),this.handlerPlayer.recordRecvFps(this.stat),this.recordC2CDelay(),this.handlerPlayer.mse&&this.handlerPlayer.mse.metadata&&this.handlerPlayer.mse.metadata.codecname&&this.stat.setComDim(g.a.DIM_COM.SPHD_TYPE,this.handlerPlayer.mse.metadata.codecname),this.isFirstReport?this.isFirstReport=!1:0===f.a.statLv[15]&&c.push({sMetricName:P.METRIC.VIDEO_BAD_QUALITY_RATIO,vField:{value:this.isPaused?100:0,pausecnt:t},vDimension:{p2p:0,originalBitrate:0===p.originalBitrate?1:0,p2pCooling:ee.a.p2pCooling?1:0,topSid:p.sid,reason:a,quality:s||t>0?100:0},vExLog:{cdnip:this.handlerPlayer.cdnip}}),this.stat.setComDim(g.a.DIM_COM.CDNIP,this.handlerPlayer.cdnip),f.a.renderStat[0]&&this.reportAVRenderInfo(this.handlerPlayer.mse),this.recordAiData(),this.recordMuteData(),N(Object(B.a)(i.prototype),"recordHeart",this).call(this);var k,b=[],D=I(this.stat.coreMap.keys());try{for(D.s();!(k=D.n()).done;){var O=k.value;O.indexOf("_bw")>-1&&b.push("".concat(O,":").concat(this.stat.coreMap.get(O)))}}catch(e){D.e(e)}finally{D.f()}v.a.log("QAStat.coreDim pcdn,",b.join()),this.stat.fill(c,o),this.tsdb.sendMetrics(c),this.isPaused=!1}},{key:"reportVideoBadQuality",value:function(e,t,i,s,r,a){v.a.log("QAStat.reportVideoBadQuality, isPaused=".concat(e,", pauseCnt=").concat(t,", pauseWorkerCnt=").concat(s,", isFramePaused=").concat(a));var n=this.handlerPlayer.getPause500Cnt();this.handlerPlayer.h265Proxy&&this.handlerPlayer.h265Proxy.rendering?this.reportH265(e,t,i,n,s,r):(this.stat.setCoreDim(g.a.DIM_CORE.VIDEO_BAD_QUALITY,e||t>0?100:0),this.stat.setCoreDim(g.a.DIM_CORE.VIDEO_BAD_QUALITY_OLD,e?100:0),this.handlerPlayer.mse&&this.handlerPlayer.mse.getMseRenderList&&this.recordFrameInfo(this.handlerPlayer.mse.getMseRenderList(),g.a.DIM_COM.V_PLAY_FRAME),this.stat.setCoreDim(g.a.DIM_CORE.VIDEO_H265_BAD_QUALITY,n>0||r||s>0?100:0),this.handlerPlayer&&(this.handlerPlayer.isWebCodec?this.stat.setCoreDim(g.a.DIM_COM.MP_EXPERIMENT,a?100:0):this.stat.setCoreDim(g.a.DIM_COM.MP_EXPERIMENT,e||t>0?100:0)))}},{key:"reportH265",value:function(e,t,i,s,r,a){var n=this.handlerPlayer.h265Proxy.getStats(i),o=n.h265PauseCnt,h=n.videoPauseCnt,u=n.isVideoPaused,l=n.hiddenTime,d=n.statProps,c=n.pause500CntH265,p=n.isFramePaused;v.a.log("QAStat.reportH265, videoPauseCnt=".concat(h,", pause500CntH265=").concat(c,", isFramePaused=").concat(p));var f=o>0?100:0,m=e||t>0?100:0,_=u||h>0?100:0;for(var y in this.handlerPlayer.h265Proxy.render.isHidden&&l>=2e4?(this.stat.setCoreDim(g.a.DIM_CORE.VIDEO_H265_BAD_QUALITY,s>0||a||r>0?100:0),this.stat.setCoreDim(g.a.DIM_CORE.VIDEO_BAD_QUALITY,m)):(this.stat.setCoreDim(g.a.DIM_CORE.VIDEO_H265_BAD_QUALITY,c>0&&_?100:0),this.stat.setCoreDim(g.a.DIM_CORE.VIDEO_BAD_QUALITY,_)),this.stat.setCoreDim(g.a.DIM_CORE.VIDEO_BAD_QUALITY_OLD,f),this.stat.setComDim(g.a.DIM_COM.MP_EXPERIMENT,p?100:0),d)"toDecode"==y?this.recordFrameInfo(d[y],g.a.DIM_COM.V_TO_DECODE_FRAMES):"decoded"==y?this.recordFrameInfo(d[y],g.a.DIM_COM.V_DECODE_FRAME):"render"==y?this.recordFrameInfo(d[y],g.a.DIM_COM.V_PLAY_FRAME):"rawList"==y||("frameList"==y?this.recordFrameInfo(d[y],g.a.DIM_COM.V_TO_PLAY_FRAME):this.stat.setComp(g.a.DIM_H265_SAM.name,y,d[y].join("|")))}},{key:"recordSample",value:function(e){this.handlerPlayer.sampleController.recordStat(this.stat,e);var t=this.handlerPlayer.mse;t&&(this.handlerPlayer.mse.parser.avSample.recordStat(this.stat),t.parser&&t.parser.avcChangeStat&&t.parser.avcChangeStat.record(this.stat,f.a.getAvHeaderChangeStat(this.handlerPlayer.info.presenterUid)))}},{key:"recordAuto",value:function(){var e=this.handlerPlayer.p2pFlvPlayer.ctrlBitrate;e&&(this.stat.setCoreDim(g.a.DIM_CORE.AUTO_U_REASON,e._switchUpReason),this.stat.setCoreDim(g.a.DIM_CORE.AUTO_D_REASON,e._switchDownReason))}},{key:"recordAiData",value:function(){var e=this.handlerPlayer.getAiStat(),t=e.aiP2PCnt,i=e.aiFlvCnt,s=e.aiP2PTimeoutCnt,r=e.aiFlvTimeoutCnt,a=e.aiP2PErrorCnt,n=e.aiFlvErrorCnt,o=e.aiP2PSwitchCnt,h=e.aiFlvSwitchCnt,u=e.aiP2PNotSwitchCnt,l=e.aiFlvNotSwitchCnt,d=e.aiFlvErrorSwitchCnt,c=e.aiFlvErrorNotSwitchCnt,p=e.aiStartP2PCnt,f=e.aiStartFlvCnt;this.stat.setComp(g.a.AI_CONTROL_DATA.name,g.a.AI_CONTROL_DATA.AI_P2P_CNT,t),this.stat.setComp(g.a.AI_CONTROL_DATA.name,g.a.AI_CONTROL_DATA.AI_FLV_CNT,i),this.stat.setComp(g.a.AI_CONTROL_DATA.name,g.a.AI_CONTROL_DATA.AI_P2P_TIMEOUT_CNT,s),this.stat.setComp(g.a.AI_CONTROL_DATA.name,g.a.AI_CONTROL_DATA.AI_FLV_TIMEOUT_CNT,r),this.stat.setComp(g.a.AI_CONTROL_DATA.name,g.a.AI_CONTROL_DATA.AI_P2P_ERROR_CNT,a),this.stat.setComp(g.a.AI_CONTROL_DATA.name,g.a.AI_CONTROL_DATA.AI_FLV_ERROR_CNT,n),this.stat.setComp(g.a.AI_CONTROL_DATA.name,g.a.AI_CONTROL_DATA.AI_P2P_SWITCH_CNT,o),this.stat.setComp(g.a.AI_CONTROL_DATA.name,g.a.AI_CONTROL_DATA.AI_FLV_SWITCH_CNT,h),this.stat.setComp(g.a.AI_CONTROL_DATA.name,g.a.AI_CONTROL_DATA.AI_P2P_NOT_SWITCH_CNT,u),this.stat.setComp(g.a.AI_CONTROL_DATA.name,g.a.AI_CONTROL_DATA.AI_FLV_NOT_SWITCH_CNT,l),this.stat.setComp(g.a.AI_CONTROL_DATA.name,g.a.AI_CONTROL_DATA.AI_FLV_ERROR_SWITCH_CNT,d),this.stat.setComp(g.a.AI_CONTROL_DATA.name,g.a.AI_CONTROL_DATA.AI_FLV_ERROR_NOT_SWITCH_CNT,c),this.stat.setComp(g.a.AI_CONTROL_DATA.name,g.a.AI_CONTROL_DATA.AI_START_P2P_CNT,p),this.stat.setComp(g.a.AI_CONTROL_DATA.name,g.a.AI_CONTROL_DATA.AI_START_FLV_CNT,f),this.stat.setCompFormat(g.a.AI_CONTROL_DATA.name,":",",")}},{key:"recordMuteData",value:function(){if(this.handlerPlayer.eventEmitter&&this.handlerPlayer.eventEmitter.getMuteStat&&this.handlerPlayer.eventEmitter.getMuteStat){var e=this.handlerPlayer.eventEmitter.getMuteStat().muteData,t=[];e.map((function(e){var i=[];i.push(e.value),i.push(e.type),i.push(e.currentDts),i.push(e.reqKey),i.push(e.begin),i.push(e.end),t.push(i.join(":"))})),this.stat.setCoreDim(g.a.DIM_COM.MUTE_DATA,t.join(","))}}},{key:"recordC2CDelay",value:function(){var e=this.handlerPlayer.mse&&this.handlerPlayer.mse.getDelayStat();if(e){for(var t in e.fields)this.stat.setCore(t,e.fields[t]);for(var i in e.dims)this.stat.setCoreDim(i,e.dims[i])}}},{key:"reportAVRenderInfo",value:function(e){var t=e.videoPlayConsuming.getRecvToRenderConsuming(),i=e.videoPlayConsuming.getRecvToPushConsuming(),s=e.videoPlayConsuming.getPushToRenderedConSuming(),r=Math.round(t.max),a=Math.round(t.avg),n=Math.round(i.max),o=Math.round(i.avg),h=Math.round(s.max),u=Math.round(s.avg);r>0&&a>0&&(this.stat.setCore(g.a.DIM_CORE.VTDMAX,r),this.stat.setCore(g.a.DIM_CORE.VTDAVG,a),this.stat.setCore(g.a.DIM_CORE.VRTADEMAX,n),this.stat.setCore(g.a.DIM_CORE.VRTADE,o),this.stat.setCore(g.a.DIM_CORE.VATRDEMAX,h),this.stat.setCore(g.a.DIM_CORE.VATRDE,u));var l=e.audioPlayConsuming.getRecvToRenderConsuming(),d=e.audioPlayConsuming.getRecvToPushConsuming(),c=e.audioPlayConsuming.getPushToRenderedConSuming(),p=Math.round(l.max),f=Math.round(l.avg),m=Math.round(d.max),_=Math.round(d.avg),y=Math.round(c.max),S=Math.round(c.avg);p>0&&f>0&&(this.stat.setCore(g.a.DIM_CORE.ATDMAX,p),this.stat.setCore(g.a.DIM_CORE.ATDAVG,f),this.stat.setCore(g.a.DIM_CORE.ARTADEMAX,m),this.stat.setCore(g.a.DIM_CORE.ARTADE,_),this.stat.setCore(g.a.DIM_CORE.AATRDEMAX,y),this.stat.setCore(g.a.DIM_CORE.AATRDE,S)),e.videoPlayConsuming.clearConsuming(),e.audioPlayConsuming.clearConsuming();var T=e.renderFps.getRecordFps(),P=e.renderFps.getPageRecordFps(),E=P.pfps,C=P.pfpsMax,w=P.pfpsMin,I=e.renderFps.statRenderQuality(),A=e.parser.dropFrameDts.getRecrod(),R=e.parser.fps.getRecord(),k=e.parser.fps.getFps();this.stat.setCore(g.a.DIM_CORE.VRDFPS,T),this.stat.setCore(g.a.DIM_CORE.VRCFPS,k),this.stat.setCore(g.a.DIM_CORE.VDF,A),this.stat.setCore(g.a.DIM_CORE.VRBQ,I),this.stat.setCore(g.a.DIM_CORE.PFPS,E),this.stat.setCore(g.a.DIM_CORE.PFPSMAX,C),this.stat.setCore(g.a.DIM_CORE.PFPSMIN,w),v.a.log("QAStat.reportAVRenderInfo P2P: video_total_delay_max=",r,"video_total_delay_avg=",a,"video_recv_to_append_delay_max=",n,"video_recv_to_append_delay=",o,"video_append_to_render_delay_max=",h,"video_append_to_render_delay=",u,"audio_total_delay_max=",p,"audio_total_delay_avg=",f,"audio_recv_to_append_delay_max=",m,"audio_recv_to_append_delay=",_,"audio_append_to_render_delay_max=",y,"audio_append_to_render_delay=",S,"video_render_fps=",T,"video_receive_fps=",k,"page_fps=",E,"page_fps_max",C,"page_fps_min",w,"video_drop_frames=",A,"video_recv_frames=",R)}}]),i}(function(){function e(t){Object(s.a)(this,e),this.handlerPlayer=t,this.stat=t.stat,this.tsdb=t.tsdb}return Object(a.a)(e,[{key:"recordWebCodecsStat",value:function(){var e=this;if(this.handlerPlayer.mse&&this.handlerPlayer.mse.getWebCodecsStats){var t=this.handlerPlayer.mse.getWebCodecsStats();if(t)for(var i in t)if("decodedList"==i)this.recordFrameInfo(t[i],g.a.DIM_COM.V_DECODE_FRAME);else if("renderList"==i)this.recordFrameInfo(t[i],g.a.DIM_COM.V_PLAY_FRAME);else if("videoToDecodeList"==i)this.recordFrameInfo(t[i],g.a.DIM_COM.V_TO_DECODE_FRAMES);else if("delayList"==i)this.recordFrameInfo(t[i],g.a.DIM_COM.V_TO_PLAY_FRAME);else if("deltaList"==i){var s=t[i];s.length>0&&function(){var t=[];s.map((function(e,i){t.push("k"+(i+1)+":"+e)})),e.stat.setComDim("backup_field4","size:"+s.length+","+t.join(","))}()}}}},{key:"recordFrameInfo",value:function(e,t){var i=this;this.stat.setComp(t,"size",e.length),e.map((function(e,s){i.stat.setComp(t,"k"+(s+1),e),i.stat.setCompFormat(t,":",",")}))}},{key:"recordHeart",value:function(){this.recordAudioEmpty()}},{key:"recordAudioEmpty",value:function(){var e=this,t=this.handlerPlayer.getEmptyAudioRecord(),i=g.a.DIM_COM.A_RENDER_SILENCE_TIME,s=t.length;t.reverse(),this.stat.setComp(i,"size",s),t.map((function(t,r){e.stat.setComp(i,"k"+4*(s-r),t),e.stat.setCompFormat(i,":",",")}))}},{key:"sendRecordMetrics",value:function(){this.recordMosaicData()}},{key:"recordMosaicData",value:function(){if(this.handlerPlayer._hyPlayer.getMosaicStat){var e=this.handlerPlayer._hyPlayer.getMosaicStat().data,t=e.length,i=0,s=0,r=0,a=[],n={};e.map((function(e,o){t-o<=3&&a.push(e.pixelateKey),0==e.suc?i++:1==e.suc?s++:2==e.suc&&r++,n.dts_type=e.dtsType})),n.success_cnt=i,n.fail_cnt=s,n.partial_success_cnt=r,n.req_keys=a.join(","),n.buss="video_pixelate",n=JSON.stringify(n),v.a.log("BaseQaStat.recordMosaicData",n),t>0&&this.stat.setCoreDim(g.a.DIM_COM.MOSAIC_DATA,n)}}}]),e}()),ie=function(){function e(t,i){Object(s.a)(this,e),this.eventEmitter=t,this.mse=i,this.tickCnt=0}return Object(a.a)(e,[{key:"reset",value:function(){this.tickCnt=0}},{key:"onCheckTimer",value:function(e,t){this.tickCnt++,4!==this.tickCnt&&this.tickCnt%10!=0||this.trigger()}},{key:"trigger",value:function(){var e={};Object.assign(e,this.mse.metadata),this.eventEmitter.trigger(d.METADATA,e)}}]),e}();window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext;var se=function(e){Object(M.a)(i,e);var t=Object(U.a)(i);function i(){var e;return Object(s.a)(this,i),(e=t.call(this)).audioContext=null,e.playing=!1,e.audio=null,e.analyser=null,e.source=null,e.timer=0,e}return Object(a.a)(i,[{key:"reset",value:function(){this.playing=!1}},{key:"createAudioContext",value:function(e){if(e)try{this.audio!=e&&(this.audio=e,this.audioContext=new AudioContext,this.source=this.audioContext.createMediaElementSource(e),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2048,this.source.connect(this.analyser),this.analyser.connect(this.audioContext.destination)),this.playing=!0,this.loop(2e3)}catch(e){v.a.log("createAudioContext err:"+e)}}},{key:"loop",value:function(e){if(this.playing&&this.analyser&&this.analyser.fftSize){this.audio&&!this.audio.error&&this.playing&&(clearTimeout(this.timer),this.timer=setTimeout(this.loop.bind(this),e,e));var t=this.analyser.fftSize,s=new Uint8Array(t);this.analyser.getByteFrequencyData(s),s.some((function(e){return e}))?this.emit(i.AUDIO_FREQUENCY,{value:1}):this.emit(i.AUDIO_FREQUENCY,{value:0})}}}]),i}(b.EventEmitter),re=se;se.AUDIO_FREQUENCY="AUDIO_FREQUENCY";var ae=function(){function e(t){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;Object(s.a)(this,e),this.linkHandler=t,this.ws=null,this.connected=!1,this.isYY=i,this.url=null,this.avgSpeed=new R(r)}return Object(a.a)(e,[{key:"destroy",value:function(){this.linkHandler=null,this.reset(),Q.remove(this.onCheckTimer,this)}},{key:"connect",value:function(e){this.reset(),Q.add(this.onCheckTimer,this,1e3),this.url=e,this.ws=new WebSocket(e),this.ws.binaryType="arraybuffer",this.ws.onopen=this.onopen.bind(this),this.ws.onerror=this.onerror.bind(this),this.ws.onclose=this.onclose.bind(this),this.ws.onmessage=this.onmessage.bind(this)}},{key:"reset",value:function(){this.ws&&(this.connected=!1,this.ws.onopen=null,this.ws.onerror=null,this.ws.onclose=null,this.ws.onmessage=null,this.ws.close(),this.ws=null),this.url=null,this.avgSpeed.reset()}},{key:"send",value:function(e){this.ws&&this.connected&&this.ws.send(e)}},{key:"onopen",value:function(){this.connected=!0,this.linkHandler&&this.linkHandler.onopen()}},{key:"onerror",value:function(e){v.a.log("ProtoLink.onerror event="+e),this.connected=!1,this.ws=null,this.linkHandler&&(this.linkHandler.onerror(e),this.linkHandler=null)}},{key:"onclose",value:function(){this.connected=!1,this.ws=null,this.linkHandler&&(this.linkHandler.onclose(),this.linkHandler=null)}},{key:"onmessage",value:function(e){this.avgSpeed.addCur(e.data.byteLength),e.data instanceof ArrayBuffer?this.processArrayBuffer(e.data):this.processText(e.data)}},{key:"processText",value:function(e){v.a.log("ProtoLink.processText data="+e)}},{key:"processArrayBuffer",value:function(e){if(this.isYY)for(var t=new DataView(e),i=0,s=0,r=0;i+10<e.byteLength;){if(i+(s=t.getUint32(i,!0))>e.byteLength||s<10)return void v.a.error("ProtoLink.processArrayBuffer length error pktLen="+s+" bufferLen="+e.byteLength);r=t.getUint32(i+4,!0);var a=new DataView(e,i,s);this.linkHandler&&this.linkHandler.onData(r,a),i+=s}else this.linkHandler&&this.linkHandler.onData(e)}},{key:"onCheckTimer",value:function(e,t){this.connected&&this.avgSpeed.calculate()}},{key:"speed",get:function(){return this.avgSpeed.average()}}]),e}(),ne=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;Object(s.a)(this,e),this.linkHandler=t,this.connected=!1,this.url=null,this.xhr=null,this.avgSpeed=new R(i)}return Object(a.a)(e,null,[{key:"isSupported",value:function(){try{var e=new XMLHttpRequest;return e.open("GET","https://example.com",!0),e.responseType="moz-chunked-arraybuffer","moz-chunked-arraybuffer"===e.responseType}catch(e){return v.a.warn("MozChunkedLoader",e.message),!1}}}]),Object(a.a)(e,[{key:"destroy",value:function(){this.reset(),this.linkHandler=null,Q.remove(this.onCheckTimer,this)}},{key:"reset",value:function(){this.abort(),this.url=null,this.xhr=null,this.connected=!1,this.avgSpeed.reset()}},{key:"abort",value:function(){this.xhr&&(v.a.log("ProtoLinkXhrFF abort"),this.xhr.abort())}},{key:"connect",value:function(e){this.reset(),this.url=e;var t=this.xhr=new XMLHttpRequest;t.responseType="moz-chunked-arraybuffer",t.open("GET",this.url,!0),t.onerror=this.onerror.bind(this),t.onprogress=this.onprogress.bind(this),t.onloadend=this.loadend.bind(this),t.onload=this.onclose.bind(this),t.send(),Q.add(this.onCheckTimer,this,1e3)}},{key:"onprogress",value:function(e){this.connected||this.onopen();var t=e.target.response;this.linkHandler.onData(t),this.avgSpeed.addCur(t.byteLength)}},{key:"onreadystatechange",value:function(e){}},{key:"onopen",value:function(){this.connected=!0,this.linkHandler&&this.linkHandler.onopen()}},{key:"onerror",value:function(e){v.a.log("ProtoLinkXhrFF.onerror "+e);var t=e.currentTarget.status;this.connected=!1,this.linkHandler&&(this.linkHandler.onerror(e,t),this.linkHandler=null)}},{key:"loadend",value:function(e){404===e.currentTarget.status&&this.onerror(e)}},{key:"onclose",value:function(){v.a.log("ProtoLinkXhrFF.onclose"),this.connected=!1,this.linkHandler&&(this.linkHandler.onclose(),this.linkHandler=null)}},{key:"onCheckTimer",value:function(e,t){this.connected&&this.avgSpeed.calculate()}},{key:"speed",get:function(){return this.avgSpeed.average()}}]),e}();function oe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var i=[],s=!0,r=!1,a=void 0;try{for(var n,o=e[Symbol.iterator]();!(s=(n=o.next()).done)&&(i.push(n.value),!t||i.length!==t);s=!0);}catch(e){r=!0,a=e}finally{try{s||null==o.return||o.return()}finally{if(r)throw a}}return i}}(e,t)||w(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var he=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;Object(s.a)(this,e),this.linkHandler=t,this.connected=!1,this.url=null,this.requestAbort=!1,this.controller=null,this.reader=null,this.avgSpeed=new R(i)}return Object(a.a)(e,[{key:"destroy",value:function(){this.abort(),this.linkHandler=null,this.reset(),Q.remove(this.onCheckTimer,this)}},{key:"reset",value:function(){this.url=null,this.connected=!1,this.avgSpeed.reset()}},{key:"pump",value:function(e){var t=this;e.read().then(function(i){if(i.done)t.onclose();else if(!t.checkAbort(e)){var s=i.value.buffer;t.avgSpeed.addCur(s.byteLength),t.linkHandler&&t.linkHandler.onData(s),t.pump(e)}}.bind(this))}},{key:"checkAbort",value:function(e){return!!this.requestAbort&&(this.requestAbort=!1,e.cancel(),!0)}},{key:"connect",value:function(e){var t=this;Q.add(this.onCheckTimer,this,1e3),this.url=e;var i=null;window.AbortController&&((i=new AbortController).signal,this.controller=i),fetch(e).then((function(e){1==Number(localStorage._printFetchUrl)&&v.a.log("FetchUrl",e.url);var i=e.body.getReader();t.reader=i,t.checkAbort(i)||(t.linkHandler&&t.linkHandler.onstatus&&t.linkHandler.onstatus(e.status),e.ok&&e.status>=200&&e.status<300?(t.onheader(e),e.redirected&&t.on302(e),t.onopen(),t.pump.call(t,i)):(v.a.log("ProtoLinkFetch http code invalid status:"+e.status),t.onerror(e.statusText,e.status)))})).catch((function(e){v.a.log("ProtoLinkFetch exception"),t.onerror(e.message)}))}},{key:"abort",value:function(){if(this.requestAbort=!0,this.reader&&this.reader.cancel&&(v.a.log("ProtoLinkFetch.abort reader"),this.reader.cancel(),this.reader=null),this.controller&&this.controller.abort)return v.a.log("ProtoLinkFetch.abort controller"),this.controller.abort(),void(this.controller=null)}},{key:"on302",value:function(e){v.a.log("ProtoLinkFetch.on302 url=".concat(e.url)),this.linkHandler.on302&&this.linkHandler.on302(e.url)}},{key:"onheader",value:function(e){var t,i={},s=[],r=I(e.headers);try{for(r.s();!(t=r.n()).done;){var a=oe(t.value,2),n=a[0],o=a[1];i[n]=o,s.push(n+":"+o)}}catch(e){r.e(e)}finally{r.f()}v.a.log("ProtoLinkFetch.onheader",s.join(" | ")),this.linkHandler.onheader&&this.linkHandler.onheader(i)}},{key:"onopen",value:function(){this.connected=!0,this.linkHandler&&this.linkHandler.onopen()}},{key:"onerror",value:function(e,t){v.a.log("ProtoLinkFetch.onerror "+e),this.connected=!1,this.linkHandler&&(this.linkHandler.onerror(e,t),this.linkHandler=null)}},{key:"onclose",value:function(){this.connected=!1,this.linkHandler&&(this.linkHandler.onclose(),this.linkHandler=null)}},{key:"onCheckTimer",value:function(e,t){this.connected&&this.avgSpeed.calculate()}},{key:"speed",get:function(){return this.avgSpeed.average()}}]),e}(),ue=function(){function e(t){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Object(s.a)(this,e),this.flvPlayer=t,t.hyPlayer&&(this.hyPlayer=t.hyPlayer,this.stat=t.hyPlayer.stat),this._newLink(),this.needRetry=i,this.status=0,this.url=null,this.started=!1,this.lastGetProxyTime=0,this.getProxyPeriod=e.DEFAULT_GET_PROXY_PERIOD,this.headers=null}return Object(a.a)(e,[{key:"_newLink",value:function(){E.a.firefox&&ne.isSupported()?this.link=new ne(this):X.isMacChrome72()?this.link=new ae(this):this.link=new he(this)}},{key:"abort",value:function(){this.link.destroy()}},{key:"reset",value:function(){this.lastGetProxyTime=0,this.status=0,this.url=null,this.started&&(v.a.log("FlvLoader.reset"),this.link.destroy(),this._newLink())}},{key:"connect",value:function(e){e?(this.link instanceof ae&&(e=e.replace("http","ws")),this.reset(),this.lastGetProxyTime=S.a.now()-2e3,v.a.log("FlvLoader.connect url="+e,this.lastGetProxyTime),this.headers=null,this.url=e,this.link.connect(this.url),this.started=!0):v.a.warn("FlvLoader.connect url is null")}},{key:"close",value:function(){v.a.log("FlvLoader.close"),this.reset(),this.started=!1}},{key:"onstatus",value:function(e){this.status=e}},{key:"onheader",value:function(e){this.headers=e,v.a.log("FlvLoader.onheader",e),this.flvPlayer&&this.flvPlayer.onHeader&&this.flvPlayer.onHeader(e)}},{key:"onopen",value:function(){v.a.log("FlvLoader.onopen"),this.getProxyPeriod=e.DEFAULT_GET_PROXY_PERIOD,this.flvPlayer.onConnected()}},{key:"onclose",value:function(){localStorage.hasOwnProperty("_toPcdn")||(v.a.log("FlvLoader.onclose"),this.flvPlayer.onClosed(),this.lastGetProxyTime=0,this.needRetry&&this.getProxy())}},{key:"onerror",value:function(e,t){v.a.log("FlvLoader.onerror",t),this.lastGetProxyTime=0;var i=!1;this.flvPlayer&&this.flvPlayer._hyPlayer&&this.flvPlayer._hyPlayer.isPaidRoom&&(i=!0),this.flvPlayer.onLoadError&&this.flvPlayer.onLoadError(e,t),!i&&this.needRetry&&this.getProxy()}},{key:"onData",value:function(e){this.flvPlayer.onData(e,1)}},{key:"onCheckTimer",value:function(e,t){if(this.started&&(this.onCheckConnect(e),t%10==0)){var i=this.link.speed;i!=A.b.UintMax&&(i=A.b.formatByteSize(i),v.a.log("FlvLoader speed ".concat(i,"/s")))}}},{key:"on302",value:function(e){this.flvPlayer.on302&&this.flvPlayer.on302(e)}},{key:"onCheckConnect",value:function(e){this.connected||(this.needRetry?this.getProxy():e-this.lastGetProxyTime>15e3&&0!=this.lastGetProxyTime&&this.flvPlayer&&this.flvPlayer.onLoadTimeout&&(this.flvPlayer.onLoadTimeout(),this.lastGetProxyTime=0))}},{key:"getProxy",value:function(){var e=S.a.now();e-this.lastGetProxyTime<this.getProxyPeriod||(v.a.log("FlvLoader.getProxy lastGetProxyTime="+this.lastGetProxyTime+" now="+e+" period="+this.getProxyPeriod),this.reset(),this.lastGetProxyTime=e,this.getProxyPeriod=Math.min(2*this.getProxyPeriod,128e3),this.flvPlayer.requestUrl())}},{key:"speed",get:function(){var e=this.link.speed;return e==A.b.UintMax&&(e=0),e}},{key:"connected",get:function(){return this.link&&this.link.connected}}]),e}();ue.DEFAULT_GET_PROXY_PERIOD=4e3;var le=ue,de=i(24);function ce(e,t){var i=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(i>>16)<<16|65535&i}function pe(e,t,i,s,r,a){return ce((n=ce(ce(t,e),ce(s,a)))<<(o=r)|n>>>32-o,i);var n,o}function fe(e,t,i,s,r,a,n){return pe(t&i|~t&s,e,t,r,a,n)}function me(e,t,i,s,r,a,n){return pe(t&s|i&~s,e,t,r,a,n)}function _e(e,t,i,s,r,a,n){return pe(t^i^s,e,t,r,a,n)}function ye(e,t,i,s,r,a,n){return pe(i^(t|~s),e,t,r,a,n)}function ve(e,t){var i,s,r,a,n;e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;var o=1732584193,h=-271733879,u=-1732584194,l=271733878;for(i=0;i<e.length;i+=16)s=o,r=h,a=u,n=l,o=fe(o,h,u,l,e[i],7,-680876936),l=fe(l,o,h,u,e[i+1],12,-389564586),u=fe(u,l,o,h,e[i+2],17,606105819),h=fe(h,u,l,o,e[i+3],22,-1044525330),o=fe(o,h,u,l,e[i+4],7,-176418897),l=fe(l,o,h,u,e[i+5],12,1200080426),u=fe(u,l,o,h,e[i+6],17,-1473231341),h=fe(h,u,l,o,e[i+7],22,-45705983),o=fe(o,h,u,l,e[i+8],7,1770035416),l=fe(l,o,h,u,e[i+9],12,-1958414417),u=fe(u,l,o,h,e[i+10],17,-42063),h=fe(h,u,l,o,e[i+11],22,-1990404162),o=fe(o,h,u,l,e[i+12],7,1804603682),l=fe(l,o,h,u,e[i+13],12,-40341101),u=fe(u,l,o,h,e[i+14],17,-1502002290),o=me(o,h=fe(h,u,l,o,e[i+15],22,1236535329),u,l,e[i+1],5,-165796510),l=me(l,o,h,u,e[i+6],9,-1069501632),u=me(u,l,o,h,e[i+11],14,643717713),h=me(h,u,l,o,e[i],20,-373897302),o=me(o,h,u,l,e[i+5],5,-701558691),l=me(l,o,h,u,e[i+10],9,38016083),u=me(u,l,o,h,e[i+15],14,-660478335),h=me(h,u,l,o,e[i+4],20,-405537848),o=me(o,h,u,l,e[i+9],5,568446438),l=me(l,o,h,u,e[i+14],9,-1019803690),u=me(u,l,o,h,e[i+3],14,-187363961),h=me(h,u,l,o,e[i+8],20,1163531501),o=me(o,h,u,l,e[i+13],5,-1444681467),l=me(l,o,h,u,e[i+2],9,-51403784),u=me(u,l,o,h,e[i+7],14,1735328473),o=_e(o,h=me(h,u,l,o,e[i+12],20,-1926607734),u,l,e[i+5],4,-378558),l=_e(l,o,h,u,e[i+8],11,-2022574463),u=_e(u,l,o,h,e[i+11],16,1839030562),h=_e(h,u,l,o,e[i+14],23,-35309556),o=_e(o,h,u,l,e[i+1],4,-1530992060),l=_e(l,o,h,u,e[i+4],11,1272893353),u=_e(u,l,o,h,e[i+7],16,-155497632),h=_e(h,u,l,o,e[i+10],23,-1094730640),o=_e(o,h,u,l,e[i+13],4,681279174),l=_e(l,o,h,u,e[i],11,-358537222),u=_e(u,l,o,h,e[i+3],16,-722521979),h=_e(h,u,l,o,e[i+6],23,76029189),o=_e(o,h,u,l,e[i+9],4,-640364487),l=_e(l,o,h,u,e[i+12],11,-421815835),u=_e(u,l,o,h,e[i+15],16,530742520),o=ye(o,h=_e(h,u,l,o,e[i+2],23,-995338651),u,l,e[i],6,-198630844),l=ye(l,o,h,u,e[i+7],10,1126891415),u=ye(u,l,o,h,e[i+14],15,-1416354905),h=ye(h,u,l,o,e[i+5],21,-57434055),o=ye(o,h,u,l,e[i+12],6,1700485571),l=ye(l,o,h,u,e[i+3],10,-1894986606),u=ye(u,l,o,h,e[i+10],15,-1051523),h=ye(h,u,l,o,e[i+1],21,-2054922799),o=ye(o,h,u,l,e[i+8],6,1873313359),l=ye(l,o,h,u,e[i+15],10,-30611744),u=ye(u,l,o,h,e[i+6],15,-1560198380),h=ye(h,u,l,o,e[i+13],21,1309151649),o=ye(o,h,u,l,e[i+4],6,-145523070),l=ye(l,o,h,u,e[i+11],10,-1120210379),u=ye(u,l,o,h,e[i+2],15,718787259),h=ye(h,u,l,o,e[i+9],21,-343485551),o=ce(o,s),h=ce(h,r),u=ce(u,a),l=ce(l,n);return[o,h,u,l]}function Se(e){var t,i="",s=32*e.length;for(t=0;t<s;t+=8)i+=String.fromCharCode(e[t>>5]>>>t%32&255);return i}function ge(e){var t,i=[];for(i[(e.length>>2)-1]=void 0,t=0;t<i.length;t+=1)i[t]=0;var s=8*e.length;for(t=0;t<s;t+=8)i[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return i}function Te(e){var t,i,s="";for(i=0;i<e.length;i+=1)t=e.charCodeAt(i),s+="0123456789abcdef".charAt(t>>>4&15)+"0123456789abcdef".charAt(15&t);return s}function Pe(e){return unescape(encodeURIComponent(e))}function Ee(e){return function(e){return Se(ve(ge(e),8*e.length))}(Pe(e))}function Ce(e,t){return function(e,t){var i,s,r=ge(e),a=[],n=[];for(a[15]=n[15]=void 0,r.length>16&&(r=ve(r,8*e.length)),i=0;i<16;i+=1)a[i]=909522486^r[i],n[i]=1549556828^r[i];return s=ve(a.concat(ge(t)),512+8*t.length),Se(ve(n.concat(s),640))}(Pe(e),Pe(t))}var we=function(e,t,i){return t?i?Ce(t,e):Te(Ce(t,e)):i?Ee(e):Te(Ee(e))},Ie=function(){function e(){Object(s.a)(this,e),this.listeners={}}return Object(a.a)(e,[{key:"clear",value:function(){this.listeners={}}},{key:"has",value:function(e,t,i){var s=this.listeners[e];if(!s)return!1;for(var r=0,a=s.length;r<a;r++){var n=s[r];if(n.callback==t&&n.thisObj==i)return!0}return!1}},{key:"on",value:function(e,t,i,s){if(!this.has(e,t,i)){var r=this.listeners[e]||[];r.push({priority:s||0,callback:t,thisObj:i,bindCallback:i?t.bind(i):t}),r.sort((function(e,t){return t.priority-e.priority})),this.listeners[e]=r}}},{key:"off",value:function(e,t,i){var s=this.listeners[e];if(s)for(var r=s.length-1;r>=0;r--){var a=s[r];if(a.callback==t&&a.thisObj==i)return void s.splice(r,1)}}},{key:"trigger",value:function(e,t){var i=this.listeners[e];if(i)for(var s=i.length-1;s>=0;s--)(0,i[s].bindCallback)(t)}}]),e}(),Ae=i(18).default,Re=Object(A.a)("X2Zt"),ke=Object(A.a)("Zm0="),be=Object(A.a)("X3dzVGltZQ=="),De=Object(A.a)("d3NUaW1l"),Oe=Object(A.a)("X2ludmFsaWRUaW1l"),Fe=Object(A.a)("X25leHRSZWZyZXNoVGltZQ=="),Le=Object(A.a)("X2N0eXBl"),Be=Object(A.a)("Y3R5cGU="),Ne=Object(A.a)("d3NTZWNyZXQ="),Me=Object(A.a)("X3BhcmFtcw=="),Ue=Object(A.a)("X3NGbHZBbnRpY29kZQ=="),Ve=Object(A.a)("X3NGbHZVcmw="),xe=Object(A.a)("X3NTdHJlYW1OYW1l"),He=Object(A.a)("X3JlcQ=="),We=Object(A.a)("c2VxaWQ="),Ge=Object(A.a)("X3NlcWlk"),je=Object(A.a)("X3BjZG4="),Ye=Object(A.a)("JDA="),qe=Object(A.a)("JDE="),Je=Object(A.a)("JDI="),ze=Object(A.a)("JDM="),Ke=Object(A.a)("aW5pdA=="),Qe=Object(A.a)("aXNJbnZhbGlk"),$e=Object(A.a)("Z2V0QW50aWNvZGU="),Xe=Object(A.a)("cGFyc2VBbnRpY29kZQ=="),Ze=Object(A.a)("aGFzQW50aWNvZGU="),et=Object(A.a)("b25DaGVja1RpbWVy"),tt=Object(A.a)("X29uUmVmcmVzaA=="),it=Object(A.a)("X29uUmVmcmVzaEJpbmQ="),st=Object(A.a)("dmFsaWQ="),rt=Object(A.a)("Z2V0VG9rZW4="),at=Object(A.a)("X2dldFRva2Vu"),nt=Object(A.a)("bGl2ZXVp"),ot=Object(A.a)("Z2V0Q2RuVG9rZW5JbmZvRXg="),ht=(Object(A.a)("MTAw"),Object(A.a)("dmVyPTE=")),ut=Object(A.a)("Jg=="),lt=Object(A.a)("PQ=="),dt=Object(A.a)("UkVGUkVTSA=="),ct=Object(A.a)("cmVmcmVzaA=="),pt=(Object(A.a)("ZGVjb2RlVVJJ"),Object(A.a)("dW5lc2NhcGU="),Object(A.a)("Z2V0U2VxaWQ=")),ft=(Object(A.a)("bWVkaWF1aXNlYQ=="),Object(A.a)("Z2V0QW50aUNvZGVGb3JTdHJlYW0="),Object(A.a)("X25pbW9UaWQ=")),mt=i(17).default,_t=function(e){Object(M.a)(i,e);var t=Object(U.a)(i);function i(){var e;return Object(s.a)(this,i),(e=t.call(this))[be]="",e[Re]="",e[Le]="",e[Me]=[],e[Ue]="",e[Ve]="",e[xe]="",e[Ge]="",e[Oe]=Number.MAX_SAFE_INTEGER,e[Fe]=Number.MAX_SAFE_INTEGER,e[ft]=null,e[it]=e[tt].bind(Object(L.a)(e)),e}return Object(a.a)(i,[{key:Ze,value:function(){return""!==this[Ue]}},{key:Ke,value:function(e,t,i,s){this[Ve]=e,this[xe]=t,this[Xe](i),this[ft]=s}},{key:Xe,value:function(e){var t=this;this[Re]="",this[be]="",this[Le]="",this[Me]=[],this[Ue]=e,e.split(ut).forEach((function(e){var i=oe(e.split(lt),2),s=i[0],r=i[1];if(s===ke)r=decodeURI(r),r=unescape(r),r=atob(r),t[Re]=r;else if(s===De){t[be]=r;var a=1e3*parseInt(r,16)+3e5;t[Oe]=S.a.now()+(a-Date.now()),t[Fe]=t[Oe]-3e4}else s==Be?t[Le]=r:s!==Ne&&t[Me].push(e)}))}},{key:Qe,value:function(e){return e>this[Oe]}},{key:$e,value:function(e){if(""===this[Re])return this[Ue];var t=f.a.platform,i=V.a.PLATFORM_TYPE[t]||V.a.PLATFORM_TYPE.web;this[Ge]=Number(ee.a.uid)+Date.now();var s=we("".concat(this[Ge],"|").concat(this[Le],"|").concat(i)),r=t===V.a.PLATFORM_TYPE_NAME.wap?ee.a.uid:ee.a.convertUid,a=this[Re].replace(Ye,r).replace(qe,this[xe]).replace(Je,s).replace(ze,this[be]);e&&(a+=je);var n="".concat(Ne).concat(lt).concat(we(a)).concat(ut).concat(De).concat(lt).concat(this[be]).concat(ut).concat(We).concat(lt).concat(this[Ge]).concat(ut).concat(Be).concat(lt).concat(this[Le]).concat(ut).concat(ht);return this[Me].length>0&&(n+=ut+this[Me].join(ut)),n}},{key:pt,value:function(){return this[Ge]}},{key:et,value:function(e,t){e>=this[Fe]&&this[rt]().then(this[it])}},{key:tt,value:function(){this.trigger(i.Events[dt])}},{key:st,value:function(){var e=this;return new Promise((function(t){e[Qe](S.a.now())?e[rt]().then(t):t()}))}},{key:rt,value:function(){var e=this;return new Promise((function(t){Ae.connected?e[at](t):Ae.on(Ae.TAFLINK_INITED,(function(){e[at](t)}))}))}},{key:at,value:function(e){var t=this;this[He]||(this[He]=new mt.GetCdnTokenExReq),this[He].sFlvUrl=this._sFlvUrl,this[He].sStreamName=this._sStreamName,this[He].tId=Ae.getUserId(),this[He].iAppId=ee.a.appid,v.a.log("".concat(i.name,".").concat(rt,".req="),this._req),this[Fe]=Number.MAX_SAFE_INTEGER;var s=nt,r=ot;Ae.sendWup(s,r,this._req,(function(s){var r;r=s.sFlvToken,v.a.log("".concat(i.name,".").concat(rt," sAntiCode=").concat(r,", rsp="),s),t[Xe](r),e()}),!0,Ae.getRequestId())}}]),i}(Ie);_t.Events=Object(de.a)({},dt,ct);var yt=_t,vt="loaded",St="error",gt="timeout",Tt=new Map,Pt=function(e){Object(M.a)(i,e);var t=Object(U.a)(i);function i(e){var r;return Object(s.a)(this,i),(r=t.call(this))._libName=e,r._script=null,r._loaded=!1,r._onLoadBind=r._onLoad.bind(Object(L.a)(r)),r._onErrorBind=r._onError.bind(Object(L.a)(r)),r}return Object(a.a)(i,[{key:"load",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6e4;if(this._loaded)this.trigger(vt);else{var i=this._script;i||((i=document.createElement("script")).async=!0,i.onload=i.onreadystatechange=this._onLoadBind,i.onerror=this._onErrorBind,i.src=e.endsWith("/")?e+this._libName:e+"/"+this._libName,document.getElementsByTagName("head")[0].appendChild(i),this._script=i,Q.once(this._onTimeout,this,t))}}},{key:"_onLoad",value:function(){var e=this._script,t=e.readyState;t&&"loaded"!==t&&"complete"!==t||(e.onload=e.onreadystatechange=null,this._loaded=!0,Q.remove(this._onTimeout,this),this.trigger(vt))}},{key:"_onTimeout",value:function(){this._clear(),this.trigger(gt)}},{key:"_onError",value:function(){this._clear(),this.trigger(St)}},{key:"_clear",value:function(){var e=this._script;e&&(e.onload=e.onreadystatechange=e.onerror=null,e.src="",e.parentNode&&e.parentNode.removeChild(e),this._script=null)}}]),i}(Ie),Et=function(e,t,i){var s=i.onLoaded,r=void 0===s?null:s,a=i.onError,n=void 0===a?null:a,o=i.onTimeout,h=void 0===o?null:o,u=i.thisObj,l=void 0===u?null:u,d=i.timeout,c=void 0===d?6e4:d,p=Tt.get(t);return p||(p=new Pt(t),Tt.set(t,p)),r&&p.on(vt,r,l),n&&p.on(St,n,l),h&&p.on(gt,h,l),p.load(e,c),p},Ct=function(e,t){var i=t.onLoaded,s=void 0===i?null:i,r=t.onError,a=void 0===r?null:r,n=t.onTimeout,o=void 0===n?null:n,h=t.thisObj,u=void 0===h?null:h,l=Tt.get(e);l&&(s&&l.off(vt,s,u),a&&l.off(St,a,u),o&&l.off(gt,o,u))},wt={ppio:"ppio",xy:"xy"},It={ppio:"EcdnLive.js",xy:"XYLive.js"},At={},Rt=function(e){Object(M.a)(i,e);var t=Object(U.a)(i);function i(){var e;return Object(s.a)(this,i),(e=t.call(this))._pcdnName="",e._loader=null,e._lastDataTs=0,e._started=!1,e._speed=new R(10),e._callbacks={onLoaded:e._onLoadLibSUc,onError:e._onLoadLibErr,thisObj:Object(L.a)(e)},e._binds={},e._binds.LOAD_FAIL=e._onLoadFail.bind(Object(L.a)(e)),e._binds.GATHER_SUC=e._onGatherSuc.bind(Object(L.a)(e)),e._binds.GATHER_FAIL=e._onGatherFail.bind(Object(L.a)(e)),e._binds.DATA=e._onData.bind(Object(L.a)(e)),e._binds.LOAD_STOP=e._onLoadStop.bind(Object(L.a)(e)),e._binds.LOAD_FINISH=e._onLoadFinish.bind(Object(L.a)(e)),e._binds.SDK_DESTROYED=e._sdkDestroy.bind(Object(L.a)(e)),e}return Object(a.a)(i,[{key:"setPcdnName",value:function(e){this._pcdnName=e}},{key:"isLibReady",value:function(){return At[this._pcdnName]}},{key:"loadLib",value:function(e){this.isLibReady()?this.trigger(i.BaseEvents.LIB_READY,{type:i.BaseEvents.LIB_READY,isFirst:!1}):Et(e,It[this._pcdnName],this._callbacks)}},{key:"_onLoadLibSUc",value:function(){Ct(It[this._pcdnName],this._callbacks),this._hasInterface()?(At[this._pcdnName]=1,this.trigger(i.BaseEvents.LIB_READY,{type:i.BaseEvents.LIB_READY,isFirst:!0})):this.trigger(i.BaseEvents.LIB_ERR,{type:i.BaseEvents.LIB_ERR,msg:"".concat(this._pcdnName," has no constructor!")})}},{key:"_hasInterface",value:function(){return this._pcdnName===wt.ppio?!!window.EcdnLive:this._pcdnName===wt.xy&&!!window.xyvp&&!!window.xyvp.Loader}},{key:"_createLoader",value:function(){this._pcdnName===wt.ppio?this._loader=new window.EcdnLive({appId:"huya",debug:!1,logLevel:""}):this._pcdnName===wt.xy&&(this._loader=new window.xyvp.Loader),this._doPcdnEvents(!0)}},{key:"_destroyLoader",value:function(){this._loader&&(this._doPcdnEvents(!1),this._loader.stopLoad(),this._loader.stopPeerGather(),this._loader.destroy(),this._loader=null)}},{key:"_doPcdnEvents",value:function(e){if(this._loader)for(var t in this._binds)e?this._loader.on(t,this._binds[t]):this._loader.off(t,this._binds[t])}},{key:"_onLoadLibErr",value:function(){this.trigger(i.BaseEvents.LIB_ERR,{type:i.BaseEvents.LIB_ERR,msg:"".concat(this._pcdnName," load_fail")})}},{key:"_onLoadFail",value:function(){this.trigger(i.LoadEvents.LOAD_FAIL,{type:i.LoadEvents.LOAD_FAIL})}},{key:"_onData",value:function(e){0===this._lastDataTs&&(this.trigger(i.LoadEvents.LOAD_SUC,{type:i.LoadEvents.LOAD_SUC}),Q.remove(this.onConnectTimeout,this));var t="xy"===this._pcdnName?e:e.data;this._lastDataTs=S.a.now(),this._speed.addCur(t.byteLength),this.trigger(i.LoadEvents.DATA,{type:i.LoadEvents.DATA,data:t})}},{key:"_onGatherSuc",value:function(){this.trigger(i.BaseEvents.GATHER_SUC,{type:i.BaseEvents.GATHER_SUC})}},{key:"_onGatherFail",value:function(){this.trigger(i.BaseEvents.GATHER_FAIL,{type:i.BaseEvents.GATHER_FAIL})}},{key:"_onLoadStop",value:function(){this.trigger(i.LoadEvents.LOAD_STOP,{type:i.LoadEvents.LOAD_STOP})}},{key:"_onLoadFinish",value:function(){this.trigger(i.LoadEvents.LOAD_FINISH,{type:i.LoadEvents.LOAD_FINISH})}},{key:"_sdkDestroy",value:function(){this.trigger(i.LoadEvents.SDK_DESTROYED,{type:i.LoadEvents.SDK_DESTROYED})}},{key:"getName",value:function(){return this._pcdnName}},{key:"create",value:function(){this._destroyLoader(),this._createLoader()}},{key:"startPeerGather",value:function(e){this._callPcdn("startPeerGather",[e])}},{key:"stopPeerGather",value:function(){this._callPcdn("stopPeerGather")}},{key:"refreshUrl",value:function(e){this._callPcdn("refreshUrl",[e])}},{key:"startLoad",value:function(e,t){v.a.log("PcdnLoader.startLoad url="+e,JSON.stringify(t)),this._started=!0,this._lastDataTs=0,Q.once(this.onConnectTimeout,this,3e3),this._callPcdn("startLoad",[e,t])}},{key:"onConnectTimeout",value:function(){this.trigger(i.LoadEvents.CONNECT_TIMEOUT,{type:i.LoadEvents.CONNECT_TIMEOUT})}},{key:"stopLoad",value:function(e){this._started&&(this._lastDataTs=0,this._started=!1,this._speed.reset(),Q.remove(this.onConnectTimeout,this),this._callPcdn("stopLoad",{reason:e}))}},{key:"destroy",value:function(){this.clear(),this._lastDataTs=0,this._started=!1,Q.remove(this.onConnectTimeout,this),this._doPcdnEvents(!1),this._callPcdn("destroy")}},{key:"close",value:function(){this.clear(),this._doPcdnEvents(!1),this.stopLoad(),this.stopPeerGather(),this._callPcdn("destroy"),this._loader=null}},{key:"_callPcdn",value:function(e,t){this._loader&&this._loader[e]?(v.a.log("PcdnLoader.".concat(e," ").concat(this._pcdnName," ").concat(t?JSON.stringify(t):"")),this._loader[e].apply(this._loader,t)):v.a.log("PcdnLoader.".concat(e," ").concat(this._pcdnName," hasLoader=").concat(!!this._loader," hasInterface=").concat(!!this._loader&&!!this._loader[e]))}},{key:"onCheckTimer",value:function(e,t){this._speed.calculate()}},{key:"onCheckFastTimer",value:function(e,t){this._lastDataTs>0&&e-this._lastDataTs>500&&(this._lastDataTs=e,this.trigger(i.LoadEvents.DATA_TIMEOUT,{type:i.LoadEvents.DATA_TIMEOUT}))}},{key:"speed",get:function(){var e=this._speed.average();return e===A.b.UintMax&&(e=0),e}},{key:"connected",get:function(){return this._lastDataTs>0}}],[{key:"hasPcdn",value:function(e){return!!wt[e]}}]),i}(Ie);Rt.BaseEvents={LIB_READY:"LIB_READY",LIB_ERR:"LIB_ERR",GATHER_SUC:"GATHER_SUC",GATHER_FAIL:"GATHER_FAIL"},Rt.LoadEvents={CONNECT_TIMEOUT:"CONNECT_TIMEOUT",LOAD_SUC:"LOAD_SUC",DATA:"DATA",DATA_TIMEOUT:"DATA_TIMEOUT",LOAD_FAIL:"LOAD_FAIL",LOAD_STOP:"LOAD_STOP",LOAD_FINISH:"LOAD_FINISH",SDK_DESTROYED:"SDK_DESTROYED"};var kt=Rt,bt=i(17).default,Dt=function(){function e(t){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Object(s.a)(this,e),this._flvPlayer=t,this._flvLoader=new le(t,i),this._pcdnLoader=new kt,this._sPcdnName="",this._requesting=!1,this._loader=null,this._swapTs=0,this._gatherSuc=!1,this._failCnt=0,this._cdnCnt=0,this.url="",this._checkSampleBind=this._checkSample.bind(this)}return Object(a.a)(e,[{key:"close",value:function(){v.a.log("LoaderCtrl.close"),this._flvPlayer.anticode.off(yt.Events.REFRESH,this._onAnticodeRefresh,this),this._flvLoader.close(),this._pcdnLoader.close(),this._requesting=!1,this._loader=null,this._failCnt=0,this._gatherSuc=!1,this._swapTs=0,this._sPcdnName=""}},{key:"checkPcdnMode",value:function(){this._reqPcdn()}},{key:"connect",value:function(e){this.close(),this.url=e,this._connect(e,"firstCdn"),this._reqPcdn()}},{key:"_connect",value:function(e,t){this._cdnCnt++,e=this._getUrlParams(e,!1,t),v.a.log("LoaderCtrl._connect",e),this._flvPlayer.anticode.off(yt.Events.REFRESH,this._onAnticodeRefresh,this),this._stopPcdn(t),this._flvLoader.connect(e),this._loader=this._flvLoader,this.url=this._flvLoader.url?this._flvLoader.url:e}},{key:"_stopPcdn",value:function(e){this._doPcdnEventHandler(kt.LoadEvents,!1),this._pcdnLoader.stopLoad(e)}},{key:"_reqPcdn",value:function(){var e=this;if(1!=localStorage._closePcdn){if(this._flvPlayer.info.isAuto&&Number(f.a.closePcdn500)===this._flvPlayer.info.curBitrate)v.a.log("LoaderCtrl._reqPcdn closePcdn500");else if(localStorage._pcdnName&&(this._flvPlayer.info.usePcdn=1),1!==this._flvPlayer.info.usePcdn&&(this._flvPlayer.stat.setComDim(g.a.DIM_COM.FLV_PCDN_STATE,1),this.setFlvPcdnState(1)),1===this._flvPlayer.info.usePcdn&&!this._requesting&&""===this._sPcdnName){this._flvPlayer.stat.setComDim(g.a.DIM_COM.FLV_PCDN_STATE,2),this.setFlvPcdnState(2),this._requesting=!0;var t=new bt.ClientGetPcdnFlvOutsideSdkFullstreamInfoReq;t.lReqTs=Date.now(),t.lUid=ee.a.uid,t.sGuid=ee.a.sGuid,t.lAnchorUid=this._flvPlayer.info.presenterUid,t.iCdnLine=this._flvPlayer.info.lineType,t.iCliType=bt.EM_CLINET_TYPE.E_CLIENT_WEB,t.lBucketPara=Number(localStorage.randomPcdnPercent)||0,t.iBusiType=bt.EM_BUSI_TYPE.E_BusiType_Live,t.vCliSupportPcdns.value=["ppio","xy"],t.sStreamName=this._flvPlayer.info.sStreamName,v.a.log("LoaderCtrl.reqPcdn req",t),Ae.sendWup("hypcdngw","onClientGetPcdnFlvOutsideSdkFullstreamInfo",t,(function(t){v.a.log("HYPlayer.reqPcdn res",t),!t||0!=t.iErrCode&&7!=t.iErrCode||e._rspPcdn(t)}),!0,Ae.getRequestId())}}else v.a.log("LoaderCtrl._reqPcdn host close")}},{key:"_rspPcdn",value:function(e){this._requesting=!1,localStorage._pcdnName&&(e.sPcdnName=localStorage._pcdnName),this._sPcdnName!==e.sPcdnName&&(this._sPcdnName=e.sPcdnName,this._flvPlayer.stat.setComDim(g.a.DIM_COM.PCDN_ORIGIN,e.sPcdnName),this._flvPlayer.stat.setComDim(g.a.DIM_COM.FLV_PCDN_STATE,3),this.setFlvPcdnState(3),this._loadPcdn())}},{key:"onCheckTimer",value:function(e,t){this._loader&&this._loader.onCheckTimer(e,t),this._checkSwapToPcdn(e)}},{key:"_checkSwapToPcdn",value:function(e){return!!(e>this._swapTs&&this._gatherSuc&&this._loader!==this._pcdnLoader)&&(this._flvPlayer.stat.setComDim(g.a.DIM_COM.FLV_PCDN_STATE,10),this.setFlvPcdnState(10),this._swapToPcdn(),!0)}},{key:"onCheckFastTimer",value:function(e,t){this._loader&&this._loader.onCheckFastTimer&&this._loader.onCheckFastTimer(e,t)}},{key:"_loadPcdn",value:function(){kt.hasPcdn(this._sPcdnName)?(this._flvPlayer.stat.setComDim(g.a.DIM_COM.FLV_PCDN_STATE,5),this.setFlvPcdnState(5),this._doPcdnEventHandler(kt.BaseEvents,!0),this._pcdnLoader.setPcdnName(this._sPcdnName),this._pcdnLoader.loadLib(this._flvPlayer.info.h5Root)):(this._flvPlayer.stat.setComDim(g.a.DIM_COM.FLV_PCDN_STATE,4),this.setFlvPcdnState(4))}},{key:"_doPcdnEventHandler",value:function(e,t){for(var i in e){var s=e[i];t?this._pcdnLoader.on(s,this._onPcdnEventHandler,this):this._pcdnLoader.off(s,this._onPcdnEventHandler,this)}}},{key:"_onPcdnEventHandler",value:function(e){switch(e.type!==kt.LoadEvents.DATA&&v.a.log("LoaderCtrl._onPcdnEventHandler",e.type,e.msg),e.type){case kt.BaseEvents.LIB_READY:e.isFirst&&this._reportPcdnLibAct([0],[this._pcdnLoader.getName()]),this._flvPlayer.stat.setComDim(g.a.DIM_COM.FLV_PCDN_STATE,7),this.setFlvPcdnState(7),this._pcdnLoader.create(),this._pcdnLoader.startPeerGather(this._getUrl(!0));break;case kt.BaseEvents.LIB_ERR:this._flvPlayer.stat.setComDim(g.a.DIM_COM.FLV_PCDN_STATE,6),this._reportPcdnLibAct([100],[this._pcdnLoader.getName()]),this.setFlvPcdnState(6);break;case kt.LoadEvents.CONNECT_TIMEOUT:this._flvPlayer.stat.setComDim(g.a.DIM_COM.FLV_PCDN_STATE,11),this.setFlvPcdnState(11),this._swapToCdn(e.type);break;case kt.LoadEvents.DATA_TIMEOUT:this._flvPlayer.getBufferLen()<1500&&(this._flvPlayer.stat.setComDim(g.a.DIM_COM.FLV_PCDN_STATE,12),this.setFlvPcdnState(12),this._swapToCdn(e.type));break;case kt.LoadEvents.LOAD_SUC:this._failCnt=0,this._flvLoader.close(),this._flvPlayer.stat.setComDim(g.a.DIM_COM.FLV_PCDN_STATE,15),this.setFlvPcdnState(15),this._beforeSwap();break;case kt.LoadEvents.LOAD_FAIL:this._flvPlayer.stat.setComDim(g.a.DIM_COM.FLV_PCDN_STATE,14),this.setFlvPcdnState(14),this._swapToCdn(e.type);break;case kt.BaseEvents.GATHER_SUC:this._gatherSuc=!0,v.a.log("LoaderCtrl gather_suc",this._loader!==this._pcdnLoader),this._checkSwapToPcdn(S.a.now())||this._loader===this._pcdnLoader||(this._flvPlayer.stat.setComDim(g.a.DIM_COM.FLV_PCDN_STATE,9),this.setFlvPcdnState(9));break;case kt.BaseEvents.GATHER_FAIL:this._gatherSuc=!1,this._flvPlayer.stat.setComDim(g.a.DIM_COM.FLV_PCDN_STATE,8),this.setFlvPcdnState(8),this._swapToCdn(e.type);break;case kt.LoadEvents.DATA:this._flvPlayer.onData(e.data,2);break;case kt.LoadEvents.LOAD_STOP:this._flvPlayer.stat.setComDim(g.a.DIM_COM.FLV_PCDN_STATE,13),this.setFlvPcdnState(13),this._swapToCdn(e.type);break;case kt.LoadEvents.LOAD_FINISH:this._flvPlayer.stat.setComDim(g.a.DIM_COM.FLV_PCDN_STATE,16),this.setFlvPcdnState(16),this._swapToCdn(e.type);break;case kt.LoadEvents.SDK_DESTROYED:this._flvPlayer.stat.setComDim(g.a.DIM_COM.FLV_PCDN_STATE,17),this.setFlvPcdnState(17),this._swapToCdn(e.type)}}},{key:"_reportPcdnLibAct",value:function(e,t){this._flvPlayer.tsdb.sendMetrics([this._flvPlayer.stat.createAct(g.a.ACT.LOAD_PCDNLIB_ERROR,{value:e,str:t})])}},{key:"_onAnticodeRefresh",value:function(){v.a.log("LoaderCtrl._onAnticodeRefresh"),this._flvPlayer.initInfo(this._flvPlayer.info,!0),this._pcdnLoader.refreshUrl(this._flvPlayer.info.url)}},{key:"_checkSample",value:function(e){var t=this._flvPlayer.mse.parser;return t.lastParseDts>0&&e.ts<=t.lastParseDts||(t.setDroppingSample(null),!1)}},{key:"_swapToPcdn",value:function(){this._flvPlayer.anticode.on(yt.Events.REFRESH,this._onAnticodeRefresh,this),this._doPcdnEventHandler(kt.LoadEvents,!0);var e=this._flvPlayer.mse,t=e.parser||{};v.a.log("LoaderCtrl.swapToPcdn vDts=".concat(e.curVideoDts," aDts=").concat(e.curAudioDts," lastParseDts=").concat(t.lastParseDts)),this._pcdnLoader.startLoad(this._getUrl(!0),{startDts:t.lastParseDts}),this._loader=this._pcdnLoader,this._flvPlayer.stat.addCore(g.a.CORE.GET_STREAM_CNT,1)}},{key:"_swapToCdn",value:function(e){var t=this._loader!==this._flvLoader;v.a.log("LoaderCtrl.swapToCdn reason=".concat(e," swap=").concat(t)),t&&(this._flvPlayer.tsdb.sendMetrics([this._flvPlayer.stat.createAct(g.a.ACT.PCDN_TO_CDN,{str:[e]})]),this._failCnt++,this._swapTs=S.a.now()+1e4*Math.min(6,this._failCnt),this._flvPlayer.stat.addCore(g.a.CORE.SWITCH_CDN_CNT,1),this._beforeSwap(),this._flvPlayer.initInfo(this._flvPlayer.info,!1),this._connect(this._flvPlayer.info.url,e))}},{key:"_getUrl",value:function(e){return this._flvPlayer.initInfo(this._flvPlayer.info,e),this._getUrlParams(this._flvPlayer.info.url,e)}},{key:"_getSdkPcdnReason",value:function(e){return e===kt.LoadEvents.CONNECT_TIMEOUT?2:e===kt.LoadEvents.DATA_TIMEOUT?3:e===kt.LoadEvents.LOAD_FAIL||e===kt.LoadEvents.LOAD_STOP||e===kt.LoadEvents.LOAD_FINISH||e===kt.LoadEvents.SDK_DESTROYED?4:e===kt.BaseEvents.GATHER_FAIL?5:1}},{key:"_getUrlParams",value:function(e,t,i){var s="";s+=t?"pulltype=pcdn&":"sdkPcdn=".concat(this._cdnCnt,"_").concat(this._getSdkPcdnReason(i),"&");var r=f.a.platform,a=V.a.PLATFORM_TYPE[r]||V.a.PLATFORM_TYPE.web,n=r===V.a.PLATFORM_TYPE_NAME.wap?"uid=".concat(ee.a.uid,"&uuid=").concat(ee.a.uuid):"u=".concat(ee.a.convertUid);return s+="".concat(n,"&t=").concat(a,"&sv=").concat(2308081438,"&sdk_sid=").concat(this._flvPlayer.info._sessionId),-1===e.indexOf("?")?e+="?":e+="&",e+s}},{key:"_beforeSwap",value:function(){var e=this._flvPlayer.mse.parser;e.parseFlvHead=!1,e.flvCacher.reset(),e.printFirstVideoTs=!1,e.printFirstAudioTs=!1,e.pfvTs=!1,e.pfaTs=!1,e.setDroppingSample(this._checkSampleBind)}},{key:"setFlvPcdnState",value:function(e){v.a.log("LoaderCtrl.setFlvPcdnState, type=".concat(e)),this._flvPlayer.flvPcdnState=e}},{key:"connected",get:function(){return this._loader&&this._loader.connected}},{key:"speed",get:function(){return this._loader&&this._loader.speed}}]),e}(),Ot=!1,Ft=[],Lt=0,Bt=null;function Nt(e,t){for(var i=0,s=Ft.length;i<s;i++){var r=Ft[i];if(r.callback==e&&r.thisObj==t)return r}return null}function Mt(e,t,i){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if((i=0|(Number(i)||0))<10||i%10!=0||!e)return v.a.error("Timer.add Invalide interval value or callback function."),!1;var a=Nt(e,t);return a||(a={callback:e,thisObj:t,bindCallback:t?e.bind(t):e,param:s},Ft.push(a)),a.times=r,a.tickCount=0,a.interval=i/10,a.delayDel=!1,Ut(),!0}function Ut(){Bt?Bt.postMessage("start"):!Lt&&Ft.length>0&&(Lt=setInterval(Vt,10))}function Vt(){if(0!=Ft.length){Ot=!0;for(var e=S.a.now(),t=Ft.length-1;t>=0;t--){var i=Ft[t];if(i&&!i.delayDel){if(++i.tickCount%i.interval==0){var s=i.bindCallback,r=i.tickCount/i.interval;s(e,r,i.param),i.times>0&&i.times<=r&&i.tickCount>0&&Ft.splice(t,1)}}else Ft.splice(t,1)}Ot=!1}else 1==Bt?Bt.postMessage("stop"):(clearInterval(Lt),Lt=0)}var xt={initWorker:function(){(Bt=H()(31)).addEventListener("message",(function(e){Vt()})),Bt.addEventListener("error",(function(e){v.a.error("TimerWorker.error:",e.lineno+","+e.colno,e.message),Bt.terminate(),Bt=null,v.a.warn("[ TimerWorker terminate ]"),Ut()}))},has:function(e,t){return!!Nt(e,t)},add:Mt,remove:function(e,t){for(var i=0,s=Ft.length;i<s;i++){var r=Ft[i];if(r.callback==e&&r.thisObj==t)return Ot?r.delayDel=!0:Ft.splice(i,1),!0}return!1},once:function(e,t,i,s){Mt(e,t,i+10,s,1)},getSize:function(){return Ft.length}},Ht=function(){function e(t){Object(s.a)(this,e),this.samples=new R(t),this.maxSize=t,this.lastTs=0,this.isOver=!1,this.callback=null}return Object(a.a)(e,[{key:"getResult",value:function(){for(var e=this.samples.getSamples(),t=e.length,i=[],s=0;s<t;s++)i.push("".concat(s+1,":").concat(e[s]));return i.join(",")}},{key:"start",value:function(e){this.isOver=!1,this.callback=e,Q.add(this.onCheckTime,this,20)}},{key:"stop",value:function(){this.callback=null,this.samples.reset(),this.lastTs=0,Q.remove(this.onCheckTime,this)}},{key:"setOver",value:function(){if(!this.isOver){this.isOver=!0;var e=this.getResult();v.a.log("FastSample.over result=".concat(e)),this.callback&&this.callback(e),this.stop()}}},{key:"add",value:function(e){if(!this.isOver){this.samples.addCur(e);var t=S.a.now();0===this.lastTs?this.lastTs=t:this._checkSample(t)}}},{key:"onCheckTime",value:function(e){this._checkSample(e)}},{key:"_checkSample",value:function(e){this.lastTs>0&&e-this.lastTs>500&&(this.lastTs=e,this.samples.calculate(),this.samples.getSamples().length===this.maxSize&&this.setOver())}}]),e}(),Wt=1,Gt=2,jt=3,Yt=1,qt=2,Jt=3,zt=0,Kt=1,Qt=2,$t=3,Xt=4,Zt=5,ei=6,ti=7,ii=9,si=10,ri=11,ai=0,ni=1,oi=2,hi=3,ui=4,li=5,di="timer",ci="record",pi="resume",fi="heart",mi="resume",_i="stop",yi=null,vi=function(){if(null==yi)try{var e=document.createElement("canvas").getContext("experimental-webgl"),t=e.getExtension("WEBGL_debug_renderer_info");yi=e.getParameter(t.UNMASKED_RENDERER_WEBGL),localStorage._renderInfo=yi}catch(e){yi="",v.a.log("RenderInfo.getRenderInfo",e.message)}return yi},Si=function(){function e(t){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Object(s.a)(this,e),this.player=t,t.hyPlayer&&(this.hyPlayer=t.hyPlayer,this.stat=t.hyPlayer.stat),this._newLink(),this.needRetry=i,this.status=0,this.url=null,this.started=!1,this.lastGetProxyTime=0,this.headers=null,this.reconnectCnt=0}return Object(a.a)(e,[{key:"_newLink",value:function(){E.a.firefox&&ne.isSupported()?this.link=new ne(this):X.isMacChrome72()?this.link=new ae(this):this.link=new he(this)}},{key:"abort",value:function(){this.link.destroy()}},{key:"reset",value:function(){this.lastGetProxyTime=0,this.status=0,this.url=null,this.started&&(v.a.log("ShieldAudioLoaderCtrl.reset"),this.link.destroy(),this._newLink())}},{key:"stop",value:function(){this.reconnectCnt=0}},{key:"connect",value:function(e){e?(this.link instanceof ae&&(e=e.replace("http","ws")),this.reset(),this.lastGetProxyTime=S.a.now(),v.a.log("ShieldAudioLoaderCtrl.connect url="+e,this.lastGetProxyTime),this.headers=null,this.url=e,this.link.connect(this.url),this.started=!0):v.a.warn("ShieldAudioLoaderCtrl.connect url is null")}},{key:"close",value:function(){v.a.log("ShieldAudioLoaderCtrl.close"),this.reset(),this.started=!1}},{key:"onstatus",value:function(e){this.status=e}},{key:"onheader",value:function(e){this.headers=e,v.a.log("ShieldAudioLoaderCtrl.onheader",e),this.player&&this.player.onHeader&&this.player.onHeader(e)}},{key:"onopen",value:function(){v.a.log("ShieldAudioLoaderCtrl.onopen"),this.player.onConnected()}},{key:"onclose",value:function(){v.a.log("ShieldAudioLoaderCtrl.onclose"),this.player.onClosed(),this.lastGetProxyTime=0}},{key:"onerror",value:function(e,t){v.a.log("ShieldAudioLoaderCtrl.onerror",t),this.lastGetProxyTime=0,this.getProxy(),this.player.onLoadError&&this.player.onLoadError(e)}},{key:"onData",value:function(e){this.player.onData(e)}},{key:"onCheckTimer",value:function(e,t){if(this.started&&t%10==0){var i=this.link.speed;i!=A.b.UintMax&&(i=A.b.formatByteSize(i),v.a.log("ShieldAudioLoaderCtrl speed ".concat(i,"/s")))}}},{key:"onCheckConnect",value:function(e){this.connected||e-this.lastGetProxyTime>=2e3&&0!=this.lastGetProxyTime&&this.player&&this.player.onLoadTimeout&&(this.getProxy(),this.player.onLoadTimeout(),this.lastGetProxyTime=0)}},{key:"getProxy",value:function(){this.reconnectCnt>=3||(this.reconnectCnt++,this.reset(),this.player.restart())}},{key:"speed",get:function(){var e=this.link.speed;return e==A.b.UintMax&&(e=0),e}},{key:"connected",get:function(){return this.link&&this.link.connected}}]),e}();Si.DEFAULT_GET_PROXY_PERIOD=4e3;var gi=Si,Ti=0,Pi=function(){function e(t,i){Object(s.a)(this,e),this._id=Ti++,v.a.log("ShieldAudioPlayer(".concat(this._id,").constructor")),this.player=t,this.loader=new gi(this,!0),this.connectTime=0,this.started=!1,this.startTs=0,this.startUrlBind=this.startUrl.bind(this),this.cdncip="",this.cdnsip="",this.alt_svc="",this.x_hy_quic="",this.sShieldStreamName="",this.isOpen=!1,this.recvTime=0,this.playInfo=null,this.anticode=new yt,this.refreshAnticodeBind=this.refreshAnticode.bind(this),this.anticode.on(yt.Events.REFRESH,this.refreshAnticodeBind)}return Object(a.a)(e,[{key:"reset",value:function(){this.started&&(v.a.log("ShieldAudioPlayer(".concat(this._id,").reset")),this.loader.close(),this.started=!1,this.startTs=0,this.connectTime=0,this.url="",this.sShieldStreamName="",this.recvTime=0)}},{key:"initInfo",value:function(e){var t="";e.sFlvUrl&&e.sShieldStream.sStreamName&&(1==Number(localStorage._forceShieldStream)&&(e.sShieldStream.sStreamName=e.sStreamName),e.sShieldStream.sStreamName&&(t="".concat(e.sFlvUrl,"/").concat(e.sShieldStream.sStreamName,".flv")));var i=[],s=this.anticode.getAnticode(!1);v.a.log("ShieldAudioPlayer.initInfo.anticode",s),this.anticode.hasAnticode()&&i.push(s),-1===t.indexOf("va.huya.com")&&-1===t.indexOf("cdnweb.huya.com")&&-1===t.indexOf("va-cmcc.huya.com")||i.push("&https=1"),i.length>0&&(t+=(-1!==t.indexOf("?")?"&":"?")+"".concat(i.join("&"))),this.url=t}},{key:"start",value:function(e){this.stop(),this.playInfo=e,this.startShieldAudio(e)}},{key:"startShieldAudio",value:function(e){this.startTs=S.a.now(),this.checkParams(e,this.startUrlBind)}},{key:"onCheckTimer",value:function(e,t){if(this.anticode.onCheckTimer(e,t),this.started){if(S.a.now()-this.startTs>=5e3&&!this.isOpen&&this.player.onSwitchShieldAudioFail(2),this.connected&&this.recvTime>0&&e-this.recvTime>5e3)return v.a.warn("ShieldAudioPlayer(".concat(this._id,").onCheckTimer no data received ")+(e-this.recvTime)),void this.player.onSwitchShieldAudioAbnormal();this.loader.onCheckTimer(e,t)}}},{key:"refreshAnticode",value:function(){v.a.log("shieldAudioPlayer.refreshAnticode"),this.initInfo(this.playInfo)}},{key:"checkParams",value:function(e,t){e.sFlvUrl&&e.sShieldStream.sStreamName?(e.sFlvUrl=e.sFlvUrl.replace("http://","https://"),e.sShieldStream.sFlvAntiCode?(this.anticode.init(e.sFlvUrl,e.sShieldStream.sStreamName,e.sShieldStream.sFlvAntiCode,e.nimoTid),this.anticode.valid().then((function(){t&&t(e)}))):t&&t(e)):v.a.warn("ShieldAudioPlayer(".concat(this._id,").start has no params(sFlvUrl,sStreamName,url)"))}},{key:"startUrl",value:function(e){if(this.started=!0,e.sShieldStream&&e.sShieldStream.sStreamName){this.sShieldStreamName=e.sShieldStream.sStreamName,this.initInfo(e);var t=this._getUrlParams(this.url);this.loader.connect(t)}else v.a.warn("ShieldAudioPlayer.startUrl error",JSON.stringify(e.sShieldStream))}},{key:"_getUrlParams",value:function(e){var t="",i=f.a.platform,s=V.a.PLATFORM_TYPE[i]||V.a.PLATFORM_TYPE.web,r=i===V.a.PLATFORM_TYPE_NAME.wap?"uid=".concat(ee.a.uid,"&uuid=").concat(ee.a.uuid):"u=".concat(ee.a.convertUid);return t+="".concat(r,"&t=").concat(s,"&sv=").concat(2308081438),-1===e.indexOf("?")?e+="?":e+="&",e+t}},{key:"stop",value:function(){this.started&&this.loader.close(),this.isOpen=!1,this.reset(),this.loader.stop(),this.anticode.off(yt.Events.REFRESH,this.refreshAnticodeBind)}},{key:"onConnected",value:function(){this.connectTime=S.a.now(),this.isOpen=!0;var e=this.connectTime-this.startTs;this.player&&this.player.onShieldAudioConnected(e),v.a.log("%c[TIME] ShieldPlayer(".concat(this._id,").onConnected connectTime=")+e,"color:#A23400;background:#FFF5C2")}},{key:"onClosed",value:function(){v.a.log("ShieldAudioPlayer(".concat(this._id,").onClosed"))}},{key:"onLoadError",value:function(e){v.a.log("ShieldAudioPlayer(".concat(this._id,").onLoadError"))}},{key:"onLoadTimeout",value:function(){v.a.log("ShieldAudioPlayer(".concat(this._id,").onLoadTimeout"))}},{key:"onData",value:function(e,t){var i=S.a.now(),s=new Uint8Array(e);this.player.stat.addCore(g.a.CORE.CDN_TOTAL_BW,s.byteLength),this.player.mse.appendShieldAudioFlv(s),this.recvTime=i}},{key:"restart",value:function(){this.startShieldAudio(this.player.info)}},{key:"onHeader",value:function(e){e.hasOwnProperty("cdncip")&&(this.cdncip=e.cdncip),e.hasOwnProperty("cdnsip")&&(this.cdnsip=e.cdnsip),e.hasOwnProperty("alt-svc")&&(this.alt_svc=e["alt-svc"]),e.hasOwnProperty("x-hy-quic")&&(this.x_hy_quic=e["x-hy-quic"])}},{key:"connected",get:function(){return this.loader.connected}}]),e}(),Ei=i(21),Ci=0,wi=[],Ii=[],Ai=[],Ri=[],ki=-1e4,bi=function(e){Object(M.a)(i,e);var t=Object(U.a)(i);function i(e,r){var a,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Object(s.a)(this,i),a=t.call(this,e,r),v.a.log("FlvPlayer(".concat(a._id,").constructor"));var o=r.isPureAudio,h=r.isPureVideo;return a.startTs=0,a.startTime=0,a.lineType=0,a.loader=new Dt(Object(L.a)(a),!0),a.recvTime=0,a.firstPkgTime=0,a.connectTime=0,a.loadFlvStatus=0,a.isPureAudio=o,a.isPureVideo=h,a.videoElement=n,a.flvLoadTimeSended=!1,a.enableLowLatency=!1,a.anticode=r.anticode,a.mse=r.mse,a.pauseStartTs=0,a.metadataTick=new ie(e,a.mse),a.pauseReason=0,a.loadTime=0,a.connectTime=0,a.recvDataTime=0,a.loadStartTs=0,a.cdnip="",a.cdnsip="",a.sendPauseTimeout=0,a.videoStatus=l.VIDEO_STOP,void 0!==te&&(a.qaStat=new te(Object(L.a)(a))),a.playedStat=null,a.flowSize=0,a.flvDataSize=0,a.backToP2P=new Z(Object(L.a)(a)),a.volumeCount=0,a.sendMetricTimer=0,a.sendMetricTimes=0,a.businessStartCost=0,a.startTimeStamp=0,a.noNeedSendVideoLoadTime=!1,a.exceptionStat=r.exceptionStat,a.startUrlBind=a.startUrl.bind(Object(L.a)(a)),a.playerType=O.Flv,a.flvPcdnState=1,a}return Object(a.a)(i,[{key:"getFrameData",value:function(){return{pts:this.mse.getCurrentRealTime()}}},{key:"reset",value:function(){this.started&&(v.a.log("FlvPlayer(".concat(this._id,").reset")),this.loader.close(),this.pauseStartTs=0,this.qaStat.isFirstReport=!0,this.metadataTick.reset(),this.metadataTick.mse=this.mse,this.startTs=0,this.recvTime=0,this.startTime=0,this.enableLowLatency=!1,this.pauseCheckLock=!1,this.loadTime=0,this.connectTime=0,this.recvDataTime=0,this.flowSize=0,this.flvDataSize=0,this.recvDataEnough=!1,this.recvFlvData=!1,this.cdnip="",this.cdnsip="",this.backToP2P.reset(),this.stopPlayer(),this.audiouitil&&(this.audiouitil.reset(),this.audiouitil=null),this.videoStatus=l.VIDEO_STOP,this.flvPcdnState=1)}},{key:"getCostTimes",value:function(){return[this.connectTime>0?this.connectTime-this.startTs:0,this.recvDataTime>0?this.recvDataTime-this.connectTime:0,this.mse.pushVideoStartRenderTime>0?this.mse.pushVideoStartRenderTime-this.startTs:0]}},{key:"getRecvInfo",value:function(){return[this.connectTime>0?this.connectTime-this.startTs:0,this.recvDataTime>0?this.recvDataTime-this.connectTime:0,this.mse.pushVideoStartRenderTime>0?this.mse.pushVideoStartRenderTime-this.startTs:0,this.mse.getVideoFrames(),this.mse.getAudioFrames(),this.flowSize]}},{key:"checkPcdnMode",value:function(e){N(Object(B.a)(i.prototype),"checkPcdnMode",this).call(this,e),this.loader.checkPcdnMode()}},{key:"_getUsePcdn",value:function(e){return 1===Number(e[bt.EM_PCDN_MODE.E_PcdnMode_FlvOutsideSdkFullstream])?1:0}},{key:"_getPcdnName",value:function(e){var t="";return e&&(t=e[bt.EM_PCDN_MODE.E_PcdnMode_FlvOutsideSdkFullstream]),t}},{key:"start",value:function(e){v.a.log("FlvPlayer(".concat(this._id,").start"),JSON.stringify(e)),this.firstPkgTime=0,N(Object(B.a)(i.prototype),"start",this).call(this,e),this.reset(),this.started=!0,this.checkParams(e,this.startUrlBind)}},{key:"checkParams",value:function(e,t){this.info=e,e.sFlvUrl&&e.sStreamName?(e.sFlvUrl=e.sFlvUrl.replace("http://","https://"),e.sFlvAntiCode?(this.anticode.init(e.sFlvUrl,e.sStreamName,e.sFlvAntiCode,e.nimoTid),this.anticode.valid().then((function(){t&&t(e)}))):t&&t(e)):e.url?t&&t(e):v.a.warn("FlvPlayer(".concat(this._id,").start has no params(sFlvUrl,sStreamName,url)"))}},{key:"startUrl",value:function(e){if(this.initDomain(e),this.started){this.initInfo(e);var t=S.a.now();if(this.businessStartCost=0,this.UIStartCost=0,this.loadStartTs=0,this.startTimeStamp=Number(e.startTimeStamp)||0,e.noNeedSendVideoLoadTime?this.noNeedSendVideoLoadTime=!0:(this.businessStartCost=Math.floor(e.startTimeStamp>1?(new Date).getTime()-e.startTimeStamp:0),this.noNeedSendVideoLoadTime=!1),e.uistartTs&&e.uistartTs>0&&(this.UIStartCost=Math.floor((new Date).getTime()-e.uistartTs)),this.startTs=t,v.a.log("FlvPlayer(".concat(this._id,").startNow"),Date.now(),t),this.startTime=t,this.backToP2P.initJumpTs(t),this.loadFlvStatus=0,this.mse.setPushGop(f.a.pushGop),X.isNeedAud()?this.mse.setDeleteH264Aud(-1===f.a.deleteH264Aud.indexOf(e.presenterUid)?0:1):this.mse.setDeleteH264Aud(0),e.latencyLevel){var i=f.a.latency[e.latencyLevel];i||(i=[3e3,2e3,4e3,2e3]),this.mse.latencySeek=i[3],this.mse.setJitter(i[0],i[1],i[2])}else this.enableLowLatency?f.a.setLowLatency(this.mse):f.a.setJitterCfg(this.mse,e.presenterUid,e.curBitrate);var s=this.h265Proxy.isReady||this.h265Proxy.isH265MseCodec;this.isH265=s;var r=this.isUseAV1(e);this.stat.setComDim(g.a.DIM_COM.ORIGINAL_BITRATE,0===e.originalBitrate?1:0),this.stat.setComDim(g.a.DIM_COM.H265,s?1:0),this.stat.setComDim(g.a.DIM_COM.V_DECODEC,r?2:s?1:0),r?(e.url+="&codec=av1",-1==e.url.indexOf("ratio")&&(e.url+="&ratio=0")):s&&this._hyPlayer.tsdbUtil.sendMetrics([this.stat.createAct(g.a.ACT.H265_STATUS,{value:[0],str:[0]})]),this.statSwitch.check(e,!1),delete e.pullStreamFrom,this.startFastSample(),this._startContinueBuffer(),this.loader.connect(e.url,null==this.videoElement),this.stat.setComDim(g.a.DIM_COM.STREAM_URL,this.loader.url),function(e,t,i){i=i||"";var s="cdndomain",r=(t=t||"").match(/\/\/(.+?)\//i);r&&r.length>1&&(s=r[1]),e.setComDim(g.a.DIM_COM.CDNDOMAIN,s),e.setComDim(g.a.DIM_COM.STREAM,i||"stream")}(this.stat,this.info.url,this.info.sStreamName),this.startPlayer()}}},{key:"startPlayer",value:function(){this.started=!0,Q.add(this.onCheckTimer,this,1e3),Q.add(this.onCheckFastTimer,this,100),null!=this.videoElement&&this.startMetricTimer(2e4),this.stat.setComDim(g.a.DIM_COM.P2P,g.a.LIVE_TYPE.FLV),this.stat.setComDim(g.a.DIM_COM.STREAM_TYPE,1),N(Object(B.a)(i.prototype),"startPlayer",this).call(this)}},{key:"stopPlayer",value:function(){Q.remove(this.onCheckTimer,this),Q.remove(this.onCheckFastTimer,this),this.stopMetricTimer(),this.started=!1}},{key:"_switchStart",value:function(e,t){this.initInfo(this.info),-1!==this.info.url.indexOf("?")?this.info.url+="&startPts=".concat(t):this.info.url+="?startPts=".concat(t),this.mse.parser.reset(),this.loader.close(),1==localStorage._testBack?localStorage._testBack=0:(this.startTs=S.a.now(),this.loader.connect(this.info.url)),this.updateFlvConfig()}},{key:"initInfo",value:function(e,t){this.info=e,e.sFlvUrl&&e.sStreamName&&(e.url="".concat(e.sFlvUrl,"/").concat(e.sStreamName,".flv"));var i=[];this.anticode.hasAnticode()&&(i.push(this.anticode.getAnticode(t)),v.a.log("FlvPlayer.initInfo, anticode=".concat(this.anticode.getAnticode(t)))),-1!==f.a.useChangeRate.indexOf(Number(e.presenterUid))?i.push("ratio=".concat(e.curBitrate)):e.iBitRate>0?i.push("ratio=".concat(e.iBitRate)):localStorage._ratio&&i.push("&ratio=".concat(localStorage._ratio)),e.httpDomainOnly||-1===e.url.indexOf("va.huya.com")&&-1===e.url.indexOf("cdnweb.huya.com")&&-1===e.url.indexOf("va-cmcc.huya.com")||i.push("&https=1"),i.length>0&&(e.url+=(-1!==e.url.indexOf("?")?"&":"?")+"".concat(i.join("&"))),this.isUseAV1(e)?e.url+="&codec=av1":(this.h265Proxy.isReady||this.h265Proxy.isH265MseCodec)&&this.h265Proxy.checkUrl(e),e.url+="&dMod=".concat(A.b.getDMod(e._dMod,e._sMod)),this.url=e.url,this.lineType=e.lineType}},{key:"recSysRspHandler",value:function(e,t,i){i&&i.isBackToP2P?this.backToP2P.recSysRspHandler(e,t,i):!e||t&&t.tRecSysInfo&&1==t.tRecSysInfo.lAction?(v.a.warn("FlvPlayer(".concat(this._id,").recSysRspHandler FLV_TRY_TO_P2P")),this.eventEmitter.trigger(o.FLV_TRY_TO_P2P)):(v.a.warn("FlvPlayer(".concat(this._id,").recSysRspHandler jumpToP2PCd=").concat(this.jumpToP2PCd/6e4,"min fail")),this.eventEmitter.trigger(o.H5_PLAYER_ERROR))}},{key:"setVideoPlayTimeSended",value:function(){this.flvLoadTimeSended=!0}},{key:"getPlayVideo",value:function(){return this.mse.getPlayVideo()}},{key:"setJitter",value:function(e,t,i){this.mse&&this.mse.setJitter(e,t,i)}},{key:"stop",value:function(){this.started&&(v.a.log("FlvPlayer(".concat(this._id,").stopFlv")),this._reportFlvFlow(),this.reset(),this.started=!1),this.audiouitil&&(this.audiouitil.reset(),this.audiouitil=null),this.recvDataEnough=!1,this.recvFlvData=!1,N(Object(B.a)(i.prototype),"stop",this).call(this)}},{key:"recvDataFull",value:function(){this.recvDataTime=S.a.now(),this.eventEmitter.trigger(o.RECV_VIDEO_FRAME),v.a.log("FlvPlayer(".concat(this._id,").recvDataFull"))}},{key:"initDomain",value:function(e){if(!e.inited){e.inited=!0;var t=e.domainList;if(t&&t.length){var i=e.sFlvUrl.match(/\/\/(.+?)\//i);e._domain=i?i[1]:"",v.a.log("FlvPlayer(".concat(this._id,").initDomain:\n\t")+t.join("\n\t"));var s=t.shift();this.cdnip=s,this.stat.setComDim(g.a.DIM_COM.CDNIP,s),e.sFlvUrl=e.sFlvUrl.replace(/\/\/(.+?)\//,"//"+s+"/"+e._domain+"/")}}}},{key:"retryVideo",value:function(){this.eventEmitter.trigger(o.REPLAY_VIDEO)}},{key:"setEnableLowLatency",value:function(e){this.enableLowLatency=e,e&&f.a.setLowLatency(this.mse)}},{key:"updateFlvConfig",value:function(){this.enableLowLatency?f.a.setLowLatency(this.mse):f.a.setJitterCfg(this.mse,this.info.presenterUid,this.info.curBitrate),this.mse&&(this.mse.setNeedEmptyAudioFrame(f.a.flvEmptyAudioFrame>0),v.a.log("FlvPlayer(".concat(this._id,").updateFlvConfig flvEmptyAudioFrame=")+this.getConfig("flvEmptyAudioFrame")))}},{key:"requestUrl",value:function(){var e=this.info,t=e.domainList;if(t&&e._domain){var i=new RegExp("//(.*?)"+e._domain+"/"),s=t.shift();return s?(this.cdnip=s,this.stat.setExtDim(g.a.DIM_EXT.CDN_IP,s),v.a.warn("FlvPlayer(".concat(this._id,").requestUrl change domain to ").concat(s)),e.sFlvUrl=e.sFlvUrl.replace(i,"//"+s+"/"+e._domain+"/")):(this.cdnip="",this.stat.delDim(g.a.DIM_EXT.CDN_IP),v.a.warn("FlvPlayer(".concat(this._id,").requestUrl change domain to ").concat(e._domain)),e.sFlvUrl=e.sFlvUrl.replace(i,"//"+e._domain+"/"),delete e.domainList),this._reportFlvFlow(),void this.startUrl(e)}this._hyPlayer.isPaidRoom||this.eventEmitter.trigger(o.FLV_URL_UNAVAILABLE)}},{key:"setConfig",value:function(e,t){f.a.setConfig(e,t)}},{key:"getConfig",value:function(e){return f.a[e]}},{key:"setVolume",value:function(e){this.mse.setVolume(e)}},{key:"setMuted",value:function(e){this.mse.setMuted(e)}},{key:"getMuted",value:function(){return this.mse.getMuted()}},{key:"getBufferLen",value:function(){return this.mse&&this.mse.getBufferLen?this.mse.getBufferLen():0}},{key:"getSegmentsBufferLen",value:function(){return this.mse&&this.mse.getSegmentsBufferLen?this.mse.getSegmentsBufferLen():0}},{key:"getFrameBufferLen",value:function(){return this.mse&&this.mse.getFrameBufferLen?this.mse.getFrameBufferLen():0}},{key:"getCurrentTime",value:function(){return this.mse.getCurrentRealTime()}},{key:"getCurrentDts",value:function(){return this.mse.getCurrentDts()}},{key:"getCurrentSeiOffsetDts",value:function(){return this.mse.getCurrentSeiOffsetDts()}},{key:"getDurationTime",value:function(){var e=(this.mse.video||{}).video,t=0;return e&&(t=Math.floor(e.duration||0)),t}},{key:"getVolumeEnergy",value:function(){var e=this.volumeCount>5?1:0;return this.volumeCount=0,e}},{key:"getAnticodeHandler",value:function(){return this.anticode}},{key:"play",value:function(){this.mse.play()}},{key:"pause",value:function(){this.loader.close(),this.mse&&this.mse.pause(),Q.remove(this.onCheckTimer,this),Q.remove(this.onCheckFastTimer,this),this.stopMetricTimer()}},{key:"setPlaybackrateAccess",value:function(e){this.mse&&this.mse.setPlaybackrateAccess(e)}},{key:"setAutoJitter",value:function(e){this.mse.autoJitter=e}},{key:"setLoadFlvStatus",value:function(e){e>this.loadFlvStatus&&(this.loadFlvStatus=e)}},{key:"sendLoadVideoErrorStatus",value:function(){this._hyPlayer.tsdbUtil.sendMetrics([this.stat.createAct(P.METRIC.VIDEO_VIDEO_LOAD_ERROR,{value:[this.loadFlvStatus]})])}},{key:"getCdnSip",value:function(){return this.cdnsip}},{key:"turnToH264",value:function(e){this.stop(),this.eventEmitter.trigger(o.TURN_TO_H264,{reason:e})}},{key:"turntoH265Wasm",value:function(){this.stop(),this.eventEmitter.trigger(o.TURN_TO_H265_WASM)}},{key:"h265Retry",value:function(){this.stop(),this.eventEmitter.trigger(o.H265_VIDEO_RETRY)}},{key:"turnToMse",value:function(){this.stop()}},{key:"onConnected",value:function(){N(Object(B.a)(i.prototype),"onConnected",this).call(this),this.connectTime=S.a.now(),v.a.log("%c[TIME] FlvPlayer(".concat(this._id,").onConnected connectTime=")+(this.connectTime-this.startTs),"color:#A23400;background:#FFF5C2"),this.setLoadFlvStatus(V.a.LoadVideoTimeoutReason.FLV_CONNECTED),this.exceptionStat.setStat(g.a.DIM_LINK_STA.CONNECT_SUC,1)}},{key:"onClosed",value:function(){this.eventEmitter.trigger(o.VIDEO_LINK_CLOSE,{video:this.mse.getPlayVideo()})}},{key:"onError",value:function(){this.eventEmitter.trigger(o.ANCHOR_STOP,{video:this.mse.getPlayVideo()})}},{key:"onData",value:function(e,t){0==this.firstPkgTime&&(this.firstPkgTime=S.a.now()),this.exceptionStat.setStat(g.a.DIM_LINK_STA.HAS_DATA,1);var i=new Uint8Array(e);this.flowSize+=i.byteLength,this.addBytes(i.byteLength),this.recvDataEnough||(this.flvDataSize+=i.byteLength,this.flvDataSize>1e6&&(this.setLoadFlvStatus(V.a.LoadVideoTimeoutReason.FLV_DATA_INVALID),this.recvDataEnough=!0)),1===t?(this.stat.addCore(g.a.CORE.CDN_TOTAL_BW,i.byteLength),this.statCPDetalBw(i.byteLength)):this.stat.addCore(g.a.CORE.PCDN_TOTAL_BW,i.byteLength),this.mse.appendFlv(i);var s=S.a.now();0==this.recvTime&&(v.a.log("%c[TIME] FlvPlayer(".concat(this._id,").onData firstPkgTime=")+(s-this.connectTime),"color:#A23400;background:#FFF5C2"),this.setLoadFlvStatus(V.a.LoadVideoTimeoutReason.FLV_RECV_DATA)),this.recvTime=s}},{key:"getMse",value:function(){return this.mse}},{key:"onPlayVideo",value:function(e,t,s,r,a,n,h){N(Object(B.a)(i.prototype),"onPlayVideo",this).call(this,e,t,s,r,a,n,h),this.updateStatus(l.VIDEO_PLAYING),this.stat.setComDim(g.a.DIM_COM.DPI,t+"*"+s);var u=S.a.now();v.a.log("FlvPlayer(".concat(this._id,").onStartVideo loadeddata=").concat(u)),this.loadTime=u-this.startTs,this.newLoadTime=u-this._hyPlayer.startTs,this.waitRemuxTime=0,this.mse&&this.mse.parser&&0!=this.mse.parser.waitRemuxTime&&(this.waitRemuxTime=this.mse.parser.waitRemuxTime);var d=this.connectTime-this.startTs,c=this.recvDataTime-this.startTs,p=this.mse.pushVideoStartRenderTime-this.startTs,f=this.UIStartCost>0?this.loadTime+this.UIStartCost:0,m=0;this.startTimeStamp>1?m=this.loadTime+this.businessStartCost:1===this.startTimeStamp&&(m=this.loadTime);var _=this.firstPkgTime-this.startTs,y=0;0!=this.mse.parser.decodeIFRTime&&(y=this.mse.parser.decodeIFRTime-this.startTs),v.a.log("%cFlvPlayer(".concat(this._id,").onPlayVideo loadTime=")+this.loadTime+"  businessStartCost="+this.businessStartCost+"  UIStartCost="+this.UIStartCost,"color:#A23400;background:#FFF5C2"),v.a.log("%cFlvPlayer(".concat(this._id,").onPlayVideo newLoadTime=")+this.newLoadTime,"color:#A23400;background:#FFF5C2"),this.tsdb.sendFlvTime(this.newLoadTime,d,c,p,null!=this.videoElement,m,f,this.waitRemuxTime,_,y);var T={video:e,width:t,height:s,loadTime:this.loadTime,connectTime:d,recvDataTime:c,pushVideoTime:p,canvas:a,videoCodec:h,delayRemove:this.info._delayRemove};this.info._delayRemove=!1,this.setLoadFlvStatus(V.a.LoadVideoTimeoutReason.FLV_STARTPLAY),this.eventEmitter.trigger(o.VIDEO_PLAY,T),this._hyPlayer.onPlayVideo&&this._hyPlayer.onPlayVideo(e)}},{key:"onAudioFrequency",value:function(e){e.value&&this.volumeCount++}},{key:"onVideoStop",value:function(e,t){v.a.log("FlvPlayer(".concat(this._id,").onVideoStop hasVideo=")+t),t&&this.updateStatus(l.VIDEO_STOP),this.eventEmitter.trigger(o.VIDEO_STOP,{video:e,hasVideo:t})}},{key:"onSendSeiData",value:function(e,t,i){this.eventEmitter.trigger(o.H264_SEI_PLAY,{data:e,ts:t,now:(new Date).getTime(),vt:i})}},{key:"onSendScriptVolumeInfo",value:function(e,t){Number(localStorage._printAudioIntensity)&&v.a.log("FlvPlayer(".concat(this._id,").onSendScriptVolumeInfo uid:")+e+"  intensity:"+t),this.eventEmitter.trigger(o.UPDATE_INTERSITY,{uid:e,intensity:t})}},{key:"onLoadError",value:function(e,t){if(this._hyPlayer.isPaidRoom&&"403"==t&&null!=this._hyPlayer.flvCount403&&(this._hyPlayer.flvCount403++,this._hyPlayer.flvCount403>=3))return this._hyPlayer.stop(),!0;this.eventEmitter.trigger(o.FLV_URL_UNAVAILABLE,{msg:e}),this.setLoadFlvStatus(V.a.LoadVideoTimeoutReason.FLV_CONNECT_ERROR)}},{key:"onLoad403Error",value:function(e){if(this._hyPlayer.isPaidRoom&&"403"==e&&null!=this._hyPlayer.flvCount403&&(this._hyPlayer.flvCount403++,this._hyPlayer.flvCount403>=3))return this._hyPlayer.stop(),!0}},{key:"onVideoParseInvalid",value:function(){this.setLoadFlvStatus(V.a.LoadVideoTimeoutReason.FLV_DATA_INVALID)}},{key:"onLoadTimeout",value:function(){this.eventEmitter.trigger(o.FLV_URL_LOAD_TIMEOUT)}},{key:"onPlayerError",value:function(e){}},{key:"onErrorEvent",value:function(e){N(Object(B.a)(i.prototype),"onErrorEvent",this).call(this,e);var t=[];t.push(this.stat.createAct(g.a.ACT.P2P_PLAY_FAIL,{value:[e.type,this.getBufferLen()]})),this.tsdb.sendMetrics(t),this._hyPlayer&&this._hyPlayer.lastP2PInfo?this.getRecSysRsp({info:this.info,type:"flv",metadata:this.mse.metadata,isFlvError:!0}):this._hyPlayer.trigger(o.H5_PLAYER_ERROR,{code:e.type,msg:"播放错误"})}},{key:"onPlayPause",value:function(e,t){this.startSendPauseTimer(),N(Object(B.a)(i.prototype),"onPlayPause",this).call(this,e,t)}},{key:"onPlayResume",value:function(e,t){this.stopSendPauseTimer(),N(Object(B.a)(i.prototype),"onPlayResume",this).call(this,e,t)}},{key:"_getBadReason",value:function(e){return this.mse.getIsDownEnough()?this.mse.lastJumpBufferTs>0&&e-this.mse.lastJumpBufferTs<5e3?V.a.BAD_REASONS.BUFFER_JUMP:this.getBufferLen()>2e3?V.a.BAD_REASONS.PERFORMANCE:V.a.BAD_REASONS.UNKNOW:V.a.BAD_REASONS.DOWN_LINK}},{key:"sendPauseEvent",value:function(){this.eventEmitter.trigger(o.PLAY_CARTON)}},{key:"startMetricTimer",value:function(e){clearTimeout(this.sendMetricTimer),this.sendMetricTimer=setTimeout(this.heartBeat20sMetric.bind(this),e)}},{key:"stopMetricTimer",value:function(){this.sendMetricTimes=0,clearTimeout(this.sendMetricTimer)}},{key:"setAudioUtil",value:function(e){this.audiouitil=e,this.audiouitil.removeAllListeners([re.AUDIO_FREQUENCY]),this.mse&&this.mse.video&&this.mse.video.video&&(this.audiouitil.createAudioContext(this.mse.video.video),this.audiouitil.on(re.AUDIO_FREQUENCY,this.onAudioFrequency.bind(this)))}},{key:"startSendPauseTimer",value:function(){this.stopSendPauseTimer(),this.sendPauseTimeout=setTimeout(this.sendPauseEvent.bind(this),200)}},{key:"stopSendPauseTimer",value:function(){clearTimeout(this.sendPauseTimeout)}},{key:"heartBeat20sMetric",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2e4,t=S.a.now();if(v.a.log("FlvPlayer(".concat(this._id,").heartBeat20sMetric ")),this.sendMetricTimes++,this._checkPaused(t,fi),this._checkPausedWorker(t,fi),this._checkMobPaused(t,fi),this._checkAvcChangeReport(t,fi),this.qaStat){0==this.pauseTime&&(this.pauseReason=0);var i=this.pauseStartTs>0;this.qaStat.record({pauseCnt:this.pauseCnt,pauseTime:this.pauseTime,isPaused:i,flowSize:this.flowSize,pauseReason:this.pauseReason,volumeEnergy:this.getVolumeEnergy(),isPausedWorker:this.pauseStartWorkerTs>0,pauseWorkerCnt:this.pauseWorkerCnt,pauseWorkerTime:this.pauseWorkerTime,isFramePaused:this.pauseMobCnt>0||this.pauseMobStartTs>0||this.isRenderFpsPause})}this.pauseStartTs>0&&this.autoMonitor.setPause(this.pauseStartTs,this.getBufferLen()),this.pauseCnt=0,this.pauseTime=0,this.pauseWorkerCnt=0,this.pauseWorkerTime=0,this.pauseReason=0,this.flowSize=0,this.isRenderFpsPause=!1,this.pauseMobCnt=0,this.sendMetricTimes%15==0&&(this.tsdb.sendMetrics([{sMetricName:P.METRIC.VIDEO_VIDEO_BAD_QUALITY_5M_RATIO,vField:{value:this.pauseCnt5>0?100:0}}]),this.pauseCnt5=0,this.pauseTime5=0),e>0&&this.startMetricTimer(e)}},{key:"onCheckTimer",value:function(e,t){if(N(Object(B.a)(i.prototype),"onCheckTimer",this).call(this,e,t),this.started){if(this.connected&&this.recvTime>0&&e-this.recvTime>8e3){var s=this.getBufferLen();return v.a.warn("FlvPlayer(".concat(this._id,").onCheckTimer no data received ")+(e-this.recvTime)+" buffLen="+s),void this.eventEmitter.trigger(o.NO_DATA_RECEIVED)}if(this.loader.onCheckTimer(e,t),this.mse&&this.mse.onCheckTimer(e,t),this.metadataTick.onCheckTimer(e,t),this.connected){null==this.videoElement&&(0===this.heart20Ts?this.heart20Ts=e:e-this.heart20Ts>=2e4&&(this.heartBeat20sMetric(0),this.heart20Ts=e));try{this.mse.video&&this.eventEmitter.trigger(o.PLAY_DOWNLINK_INFO,{buffer:this.getBufferLen()/1e3,downLinkSpeed:0|this.loader.speed,videoBufferEnd:this.mse.video.video.buffered.end(this.mse.video.video.buffered.length-1)})}catch(e){v.a.log("FlvPlayer(".concat(this._id,").onCheckTimer cannot get down link info"))}this.backToP2P.onCheckTimer(e,t),this.eventEmitter.trigger(o.PLAY_FRAME_BUFFER,{frameStorage:this.mse.getFrameReadyed(),jitterBuffer:this.mse.getBufferLen(),playdelay:this.mse.getFramePlayDelays()})}}}},{key:"onCheckFastTimer",value:function(e,t){this.started&&(this.mse.onCheckFastTimer(e,t),this.backToP2P.onCheckFastTimer(e,t),this.loader.onCheckFastTimer(e,t))}},{key:"_reportFlvFlow",value:function(){if(this.qaStat){var e=S.a.now();this._checkPaused(e,_i),this._checkPausedWorker(e,_i),this.qaStat.sendFlow({pauseCnt:this.pauseCnt,pauseTime:this.pauseTime,isPaused:this.pauseStartTs>0,flowSize:this.flowSize,pauseReason:this.pauseReason,volumeEnergy:this.getVolumeEnergy(),isEnd:!0,isPausedWorker:this.pauseStartWorkerTs>0,pauseWorkerCnt:this.pauseWorkerCnt,pauseWorkerTime:this.pauseWorkerTime,isFramePaused:this.pauseMobCnt>0||this.pauseMobStartTs>0||this.isRenderFpsPause}),this._checkMobPaused(e,_i),this.pauseCnt=0,this.pauseTime=0,this.pauseReason=0,this.flowSize=0,this.pauseWorkerCnt=0,this.pauseWorkerTime=0,this.isRenderFpsPause=!1,this.pauseMobCnt=0}}},{key:"pauseCheck",value:function(e){if(this.started){var t=0,i=this.info.curBitrate/8-10,s=this.loader.speed/1024|0;t=s>0&&s<i?V.a.pauseReason.FLV_NET_SLOW:V.a.pauseReason.FLV_NO_BUFF,this.recvTime>0&&e-this.recvTime>2e3&&(t=V.a.pauseReason.FLV_NO_DATA);var r=this.getBufferLen();r>1e3&&(t=V.a.pauseReason.FLV_UNKNOW_PAUSE),t>this.pauseReason&&(this.pauseReason=t),v.a.warn("FlvPlayer(".concat(this._id,").pauseCheck curReason=").concat(t," reportReason=").concat(this.pauseReason," buffLen=").concat(r))}}},{key:"statCPDetalBw",value:function(e){var t=this.flvPcdnState;1==t?this.stat.addCore(g.a.DIM_CORE.UNOPEND_CPFLV_BW,e):2==t?this.stat.addCore(g.a.DIM_CORE.NORETURN_CPFLV_BW,e):3==t||4==t?this.stat.addCore(g.a.DIM_CORE.UNSUPPORT_CPFLV_BW,e):5==t||6==t?this.stat.addCore(g.a.DIM_CORE.LOAD_LIB_CPFLV_BW,e):7==t?this.stat.addCore(g.a.DIM_CORE.GATHER_CPFLV_BW,e):8==t?this.stat.addCore(g.a.DIM_CORE.GATHER_FAIL_CPFLV_BW,e):9==t||10==t||15==t?this.stat.addCore(g.a.DIM_CORE.LOAD_SUC_CPFLV_BW,e):11!=t&&12!=t&&13!=t&&14!=t&&16!=t&&17!=t||this.stat.addCore(g.a.DIM_CORE.ERROR_CPFLV_BW,e)}},{key:"connected",get:function(){return this.loader.connected}},{key:"hasPicture",get:function(){var e=this.p2pFlvPlayer.isPlaying;return this.playerCoreType===V.a.PLAYER_CORE_TYPE.MSE&&(e=e&&0!==this.mse.getCurrentTime()),this.h265Proxy.rendering&&(e=e&&this.isH265Playing),e}}]),i}(function(){function e(t,i){Object(s.a)(this,e),this._id=Ci++,this.eventEmitter=t,this.stat=i.stat,this.tsdb=i.tsdb,this.statSwitch=i.statSwitch,this.sampleController=i.sampleController,this.h265Proxy=i.h265Proxy,this.autoMonitor=i.autoMonitor,this.recSysStat=i.recSysStat,this.info=null,this.isH265Playing=!1,this.playerType=-1,this.started=!1,this.heart20Ts=0,this.pauseCnt=0,this.pauseTime=0,this.pauseCnt5=0,this.pauseTime5=0,this.pauseCnt60Sec=0,this.pauseStartTs=0,this.pauseStartWorkerTs=0,this.pauseMobStartTs=0,this.pauseMobCnt=0,this.pauseWorkerCnt=0,this.pauseWorkerTime=0,this.pauseReason=0,this.pauseCheckLock=!1,this.videoStatus=l.VIDEO_STOP,this.isSwitchPause=!1,this._useAV1=!1,this.isAV1MediaSupported=Ei.a.isMseSupportedAV01(),this.resetAiProps(),this.fastSample=new Ht(20),this.onFastSampleOverBind=this.onFastSampleOver.bind(this),this.p2pFlvPlayer=i.p2pFlvPlayer,this.videoFpsList=[],this.audioFpsList=[],this.startFps=!1,this._hyPlayer=i.hyPlayerIns,this.playerCoreType=i.playerCoreType,this.shieldAudioPlayer=new Pi(this),this.shieldAudioConnectTime=99999,this.isShieldStart=!1,this.is_tie_stream=!1,this.pause500Cnt=0,this.pcdnIaas="",this.isFramePaused=!1,this.isRenderFpsPause=!1,this.pcdnIaasParam="",this.isPcdnIaas=!1}return Object(a.a)(e,[{key:"on302",value:function(e){var t=A.b.getQueryString("p_iaas",e),i=A.b.getQueryString("p_iaas_param",e);this.pcdnIaasParam=i||"",this.pcdnIaas=t||"",this.info.pcdnIaas=t,this.info.pcdnIaasParam=i,v.a.log("IPlayer.on302,url=",e,t),this.isPcdnIaas=""!=this.pcdnIaas,this.stat&&(this.stat.setComDim(g.a.DIM_COM.IS_REDIRECT,1),t&&this.stat.setComDim(g.a.DIM_COM.PCDN_IAAS,t))}},{key:"onConnected",value:function(){this.p2pFlvPlayer.onConnected()}},{key:"onPlayVideo",value:function(e,t,i,s,r,a,n){var o=S.a.now()-this._hyPlayer.startTs;this.tsdb.sendMetrics([this.stat.createAct(g.a.ACT.VIDEO_LOAD_TS_ALL,{value:[o,this.is_tie_stream?1:0]})]),this.info&&this.info.isAuto&&0===Number(f.a.autoCfg.close)&&(this.p2pFlvPlayer.ctrlBitrate.start(this.getMse(),{sessionId:this.info._sessionId,startBitrate:this.info._startBitrate,bitrateList:this.info.bitrateList,curBitrate:this.info.curBitrate}),this.p2pFlvPlayer._triggerAutoChanged());var h=this.getMse();h&&h.setParams(this.info.presenterUid,this.info.curBitrate,this.info),this.stat.setComDim(g.a.DIM_COM.DPI,t+"*"+i),this.h265Proxy.needPreload&&this.h265Proxy.loadDecoder(this.info.h5Root,null);var u=vi().toLowerCase();this.stat.setComDim(g.a.DIM_COM.RENDER_INFO,u),-1==u.toLocaleLowerCase().indexOf("swiftshader device")&&""!=u||h&&h.setDisableHardAcc&&h.setDisableHardAcc();var l=$.a.os||"",d=$.a.osVersion||"",c="windows"==l.toLocaleLowerCase()&&7==Number(d),p=-1!=u.toLocaleLowerCase().indexOf("intel"),m=-1!=u.toLocaleLowerCase().indexOf("angle (null"),_=""==u.toLocaleLowerCase(),y=navigator.hardwareConcurrency;c&&p&&y<=4&&h&&h.win7PerfInsufficient&&h.win7PerfInsufficient(),m?(localStorage.isAngelNull=1,h&&h.angelNullError&&h.angelNullError()):localStorage.isAngelNull=0,_?h&&h.chromeH265RenderEmptyError&&h.chromeH265RenderEmptyError():localStorage.isChromeH265RenderInfoEmpty=0}},{key:"_startContinueBuffer",value:function(){var e=this.getMse();e&&e.buffered&&e.buffered.start()}},{key:"onPlayPause",value:function(e,t){this.pauseStartTs=e,this.pauseCheckLock=!1,this.isSwitchPause=!0,this.autoMonitor.setPause(e,this.getBufferLen()),t&&this.updateStatus(l.VIDEO_CACHING)}},{key:"onPlayResume",value:function(e,t){this._checkPaused(e,mi),t&&this.updateStatus(l.VIDEO_PLAYING)}},{key:"onPlayPauseWorker",value:function(e,t){this.pauseStartWorkerTs=e}},{key:"onPlayResumeWorker",value:function(e,t){this._checkPausedWorker(e,mi)}},{key:"_checkPaused",value:function(e,t){if(this.pauseStartTs>0){var i=e-this.pauseStartTs;if(i>=200){v.a.warn("IPlayer(".concat(this._id,")._checkPaused type=").concat(t," pauseTime=").concat(i));var s=this.getMse(),r=0;s&&(s.buffered._calc(e,pi),r=s.getContinueBuffer()),this.autoMonitor.addBadQuality(e,i,t,r),this.pauseCnt++,this.pauseTime+=i,this.pauseCnt5++,this.pauseTime5+=i,this.p2pFlvPlayer.ctrlBitrate.addBadQuality(e,i,this.getBufferLen()),this.pauseCnt60Sec++;var a=this._getBadReason(e);v.a.warn("IPlayer(".concat(this._id,")._checkPaused curReason=").concat(a," lastReason=").concat(this.pauseReason)),(0===this.pauseReason||a<this.pauseReason)&&(this.pauseReason=a),this.checkPerformanceBadQuality()}else this.autoMonitor.resetPausedTs();this.pauseStartTs=t===fi?e:0}t===fi&&this._autoReportSea()}},{key:"_checkMobPaused",value:function(e,t){this.pauseMobStartTs>0&&(this.pauseMobStartTs=t===fi?e:0)}},{key:"_checkPausedWorker",value:function(e,t){if(this.pauseStartWorkerTs>0){var i=e-this.pauseStartWorkerTs;i>=200&&(v.a.warn("IPlayer(".concat(this._id,")._checkPausedWorker type=").concat(t," pauseTime=").concat(i)),this.pauseWorkerCnt++,this.pauseWorkerTime+=i),this.pauseStartWorkerTs=t===fi?e:0}}},{key:"_checkAvcChangeReport",value:function(e,t){if(t){var i=this.getMse();if(i){var s=i.parser;s&&s.avcChangeTime+f.a.avHeaderChangeCfg[3]<e&&(this.printAVInfos(),100*Math.random()<f.a.avHeaderChangeCfg[1]&&this._hyPlayer.trigger(o.P2P_REPORT))}}}},{key:"_getBadReason",value:function(e){return 0}},{key:"_autoReportSea",value:function(){}},{key:"updateStatus",value:function(e){this.videoStatus!==e&&(this.videoStatus=e,this.eventEmitter.trigger(o.PLAY_STATUS,{status:e}))}},{key:"onErrorEvent",value:function(e){3===e.type&&this.p2pFlvPlayer.ctrlBitrate._badStat.setNoIFrame()}},{key:"getMse",value:function(){return null}},{key:"printAVInfos",value:function(){var e=this.getMse();e&&e.printAVInfos&&e.printAVInfos()}},{key:"onHeader",value:function(e){e.hasOwnProperty("cdncip")&&this.stat.setComDim(g.a.DIM_COM.CDN_CIP,e.cdncip),e.hasOwnProperty("cdnsip")&&(this.cdnsip=e.cdnsip,this.stat.setComDim(g.a.DIM_COM.CDN_SIP,e.cdnsip)),e.hasOwnProperty("alt-svc")&&this.stat.setComDim(g.a.DIM_COM.ALT_SVC,e["alt-svc"]),e.hasOwnProperty("x-hy-quic")&&this.stat.setComDim(g.a.DIM_COM.QUIC,e["x-hy-quic"])}},{key:"getBufferLen",value:function(){return 0}},{key:"getSegmentsBufferLen",value:function(){return 0}},{key:"getWaitBufferLen",value:function(){return 0}},{key:"getWaitFrameTime",value:function(e){return 0}},{key:"triggerVideoBadQuality",value:function(){this.eventEmitter.trigger(o.VIDEO_BAD_QUALITY)}},{key:"trigger",value:function(e,t){this.eventEmitter.trigger(e,t)}},{key:"onFastSampleOver",value:function(e){var t=[this.stat.createAct(g.a.ACT.FAST_SAMPLE,{str:[e]})];this.tsdb.sendMetrics(t);var i=this.getMse();i&&i.onFastOver()}},{key:"startFastSample",value:function(){this.fastSample.start(this.onFastSampleOverBind)}},{key:"addBytes",value:function(e){this.sampleController.addTotalSample(e),this.fastSample.add(e)}},{key:"init",value:function(e){}},{key:"start",value:function(e){this.pcdnIaas="",this.pcdnIaasParam="",this.isPcdnIaas=!1,-1e4!=ki&&e.iBitRate,this.getWebCodecType(),this.is_tie_stream=!1,this.stat.setComDim(g.a.DIM_COM.IS_TIE_STREAM,0),this.stat.setComDim(g.a.DIM_COM.IS_REDIRECT,0),1==e.pullStreamFrom&&(wi.length=0),this.stop(),Q.add(this.getVideoBadQuality,this,2e4),this.sampleController.start(),this.startFps=!1,xt.add(this.onIPlayerCheckTimer,this,1e3),ki=e.iBitRate,this.setEnableDiscard(e),this.startShildAudioPlayer(e)}},{key:"startPlayer",value:function(){this.isNotSupportWebcodecsConfigure()}},{key:"stop",value:function(){this.shieldAudioPlayer.stop(),this.isH265Playing=!1,this.heart20Ts=0,this.pauseCnt60Sec=0,this.isSwitchPause=!1,this.fastSample.stop(),this.sampleController.stop(),Q.remove(this.timeoutRecSysRsp,this),Q.remove(this.getVideoBadQuality,this),Q.remove(this.getVideoLoad,this),Q.remove(this.pauseGetRecSysRspOnce,this),Q.remove(this.onIPlayerCheckTimer,this),xt.remove(this.onCheckTimerThread,this),this.startFps=!1,this.videoFpsList.length=0,this.audioFpsList.length=0,this.shieldAudioConnectTime=99999,this.isShieldStart=!1,this.pause500Cnt=0,this.pauseWorkerCnt=0,this.pauseWorkerTime=0,this.pauseStartWorkerTs=0,this.pcdnIaas=""}},{key:"getVideoBadQuality",value:function(){if(0!==Number(f.a.isAiP2PToFlv)&&this.mse){var e=this.mse.pauseStat.getAiStat(),t=e.aiDuration,i=e.aiCnt;if(wi.length<3&&(t>=f.a.aiP2PFlvConfig[0]||i>=f.a.aiP2PFlvConfig[1]?wi.push(1):wi.push(0)),wi.length>=3){var s=0;wi.map((function(e){1==e&&s++}));var r=S.a.now();if(s>=2){if(this.playerType===O.P2P){var a=this._hyPlayer.getVideoP2PBuffertEmptyTime;0!=a&&r-a<=f.a.aiBufferEmptyRequestInterval?v.a.log("IPlayer(".concat(this._id,").getVideoBadQuality.getVideoP2PBuffertEmptyTime"),r-a):(this.pauseGetRecSysRsp(this.playerType),this._hyPlayer.getVideoP2PBuffertEmptyTime=r)}else if(this.playerType===O.Flv){var n=this._hyPlayer.getVideoFlvBuffertEmptyTime;if(0!=n&&r-n<=f.a.aiBufferEmptyRequestInterval)return void v.a.log("IPlayer(".concat(this._id,").getVideoBadQuality.getVideoFlvBuffertEmptyTime"),r-n);this._hyPlayer&&this._hyPlayer.lastP2PInfo&&(this.pauseGetRecSysRsp(this.playerType),this._hyPlayer.getVideoFlvBuffertEmptyTime=r)}wi.length=0}else wi.shift()}}}},{key:"pauseGetRecSysRsp",value:function(e){var t={info:this.info,type:"flv",metadata:null};e===O.P2P?(t.type="p2p",t.metadata=this.player?this.player.msePlayer.metadata:null,t.reason=V.a.turnToFlvReason.VIDEO_BUFFER_EMPTY):e===O.Flv&&(t.type="flv",t.metadata=this.mse.metadata);var i=10*~~(3e3*Math.random()/10);Q.once(this.pauseGetRecSysRspOnce,this,i,t)}},{key:"pauseGetRecSysRspOnce",value:function(e,t,i){this.getRecSysRsp(i)}},{key:"startP2PUrl",value:function(e){}},{key:"stopStream",value:function(e){}},{key:"checkPcdnMode",value:function(e,t){if(this.info){this.info.usePcdn=this._getUsePcdn(e),localStorage.usePcdn&&(this.info.usePcdn=1),this.p2pMgr&&this.p2pMgr.stream&&(this.p2pMgr.stream.usePcdn=this._checkUsePcdn()),this.stat.setComDim(g.a.DIM_COM.FORCE_SUB_TYPE,this.info.usePcdn);var i=this._getPcdnName(t);""!=i&&null!=i&&this.stat.setComDim(g.a.DIM_COM.PCDN_ORIGIN,i)}}},{key:"_checkUsePcdn",value:function(){return this.info.isAuto&&Number(f.a.closePcdn500)===this.info.curBitrate?0:this.info.usePcdn}},{key:"setUseAV1",value:function(e){this._useAV1=e}},{key:"isUseAV1",value:function(e){this._useAV1=f.a.useAV1;var t=!0;return this._hyPlayer.noLoadAv1Count&&(t=this._hyPlayer.noLoadAv1Count<3),this.isAV1MediaSupported&&this._useAV1&&t&&A.b.getAv1Random(e,f.a.av1PercentConfig)&&1==Number(f.a.abUseAv1)}},{key:"_getUsePcdn",value:function(e){return 0}},{key:"_getPcdnName",value:function(){return""}},{key:"setEnableLowLatency",value:function(e){}},{key:"setPlaybackrateAccess",value:function(e){}},{key:"setVolume",value:function(e){}},{key:"getCurrentTime",value:function(){return 0}},{key:"getFrameData",value:function(){return null}},{key:"resetAiProps",value:function(){this.aiP2PCnt=0,this.aiFlvCnt=0,this.aiP2PTimeoutCnt=0,this.aiFlvTimeoutCnt=0,this.aiP2PErrorCnt=0,this.aiFlvErrorCnt=0,this.aiP2PSwitchCnt=0,this.aiFlvSwitchCnt=0,this.aiP2PNotSwitchCnt=0,this.aiFlvNotSwitchCnt=0,this.aiFlvErrorNotSwitchCnt=0,this.aiFlvErrorSwitchCnt=0}},{key:"recordAiP2PFlv",value:function(e){"p2p"==e?this.aiP2PCnt++:"flv"==e&&this.aiFlvCnt++}},{key:"initAiReq",value:function(e,t,i,s,r,a){var n=new bt.RecSysReq;n.tId.iAppid=ee.a.appid,n.tId.lUid=ee.a.uid,n.tId.sGuid=ee.a.sGuid,n.tId.sUA="webh5",n.sAnchorUid=e.presenterUid,n.sRoomId=ee.a.roomId,n.iScene=6,n.bDebug=0,n.mAppendInfo.value={streamType:t,expVideoFps:i&&null!=i.fps?i.fps:0,expAudioFps:i&&null!=i.audioFps?i.audioFps:0,codeRate:e.curBitrate,isOriginal:0==e.originalBitrate?1:0,line:a,codeType:this.isH265?"265":"264",sStreamName:e.sStreamName,playType:s,isServer:0,iIsP2PSupport:e.iIsP2PSupport};var o=Object.assign({},n);return v.a.log("IPlayer(".concat(this._id,").getRecSysRsp.req"),n,JSON.stringify(o)),n}},{key:"getRecSysRsp",value:function(e,t){var i=this,s=e.info,r=e.type,a=(e.reason,e.metadata),n=e.isNotAi,o=S.a.now();if(0===Number(f.a.isAiP2PToFlv)||n)return this.recordAiP2PFlv(r),void this.recSysRspHandler(!1,null,e);var h=this._hyPlayer.getAIRequestTime;if(0!=h&&o-h<=f.a.aiRequestInterval)v.a.log("IPlayer(".concat(this._id,").getRecSysRsp.getAIRequestTime"),o-h);else{this._hyPlayer.getAIRequestTime=o,this.recordAiP2PFlv(r),Q.remove(this.timeoutRecSysRsp),this.isTimeout=!0,this.isResTimeout=!1;var u=this.initAiReq(s,r,a,0,"264",s.lineType);Ae.sendWup("mediaui","getMediaRec",u,(function(t){if(!i._hyPlayer.isBusiStop){var s=Object.assign({},t);if(v.a.log("IPlayer(".concat(i._id,").getRecSysRsp res"),t,JSON.stringify(s)),i.isTimeout=!1,!i.isResTimeout)if(0===t.iStatus)t&&t.tRecSysInfo&&1==t.tRecSysInfo.lAction?"p2p"==r?i.aiP2PSwitchCnt++:"flv"==r&&(i.aiFlvSwitchCnt++,e.isFlvError&&i.aiFlvErrorSwitchCnt++):"p2p"==r?i.aiP2PNotSwitchCnt++:"flv"==r&&(i.aiFlvNotSwitchCnt++,e.isFlvError&&i.aiFlvErrorNotSwitchCnt++),i.recSysRspHandler(!0,t,e);else{if(e.isNotFirstFetch)return;"p2p"==r?i.aiP2PErrorCnt++:"flv"==r&&(i.aiFlvErrorCnt++,e.isFlvError&&i.aiFlvErrorSwitchCnt++),i.recSysRspHandler(!1,null,e)}}}),!0,Ae.getRequestId(),!0),this.aiP2PFlvProps=e,Q.once(this.timeoutRecSysRsp,this,5e3)}}},{key:"getAiStat",value:function(){var e={};this._hyPlayer&&this._hyPlayer.getAiStartStat&&(e=this._hyPlayer.getAiStartStat()),this.aiP2PSwitchCnt+=e.aiStartFlvCnt;var t={aiP2PCnt:this.aiP2PCnt,aiFlvCnt:this.aiFlvCnt,aiP2PTimeoutCnt:this.aiP2PTimeoutCnt,aiFlvTimeoutCnt:this.aiFlvTimeoutCnt,aiP2PErrorCnt:this.aiP2PErrorCnt,aiFlvErrorCnt:this.aiFlvErrorCnt,aiP2PSwitchCnt:this.aiP2PSwitchCnt,aiFlvSwitchCnt:this.aiFlvSwitchCnt,aiP2PNotSwitchCnt:this.aiP2PNotSwitchCnt,aiFlvNotSwitchCnt:this.aiFlvNotSwitchCnt,aiStartP2PCnt:e.aiStartP2PCnt||0,aiStartFlvCnt:e.aiStartFlvCnt||0,aiFlvErrorSwitchCnt:this.aiFlvErrorSwitchCnt,aiFlvErrorNotSwitchCnt:this.aiFlvErrorNotSwitchCnt};return this.resetAiProps(),t}},{key:"timeoutRecSysRsp",value:function(){if(this.isTimeout){var e=this.aiP2PFlvProps,t=e.type;if(e.isNotFirstFetch)return;"p2p"==t?this.aiP2PTimeoutCnt++:"flv"==t&&(this.aiFlvTimeoutCnt++,e.isFlvError&&this.aiFlvErrorSwitchCnt++),this.recSysRspHandler(!1,null,e),this.isResTimeout=!0}}},{key:"onPause5Sec",value:function(){this.eventEmitter&&(v.a.log("IPlayer(".concat(this._id,").onPause5Sec")),this.eventEmitter.trigger(o.PAUSE_5SEC_ERROR))}},{key:"onIPlayerCheckTimer",value:function(e,t){if(this.mse){this.checkPerfBlock(),this.startFps||(this.startFps=!0,this.mse.parser.fps.getCalculate());var i=this.mse.parser.fps.getRecvFps();if(this.mse&&this.mse.parser2){var s=this.mse.parser2.audioFps.getRecvFps();this.audioFpsList.push(s)}this.videoFpsList.push(i);var r=this.mse.parser.avSample.getAutoSamples();r.aSamples.map((function(e){Ai.length>=60&&Ai.shift(),Ai.push(e)})),r.vSamples.map((function(e){Ri.length>=60&&Ri.shift(),Ri.push(e)}));var a=this.mse.pauseStat.getAiAutoStat(),n=a.aiAutoCnt,o=a.aiAutoDuration,h=a.aiAutoBlockBadDurationList,u=a.aiAutoBlockBadContinueBufferList;Ii.length>=60&&Ii.shift(),Ii.push({aiAutoCnt:n,aiAutoDuration:o,recvFps:i,aiAutoBuffer:this.mse.getBufferLen(),aiAutoBlockBadDurationList:h,aiAutoBlockBadContinueBufferList:u})}}},{key:"getAVSampleResult",value:function(e,t){var i=[],s=Math.min(t.length,e.length);if(s>0){i.push("size:".concat(s));for(var r=0;r<s;r++)i.push("".concat(s-r,":").concat(t[r]+e[r]))}return i.join(",")}},{key:"getAutoProps",value:function(){var e=0,t=0,i=[],s=[],r=Ii.length,a=[],n=[],o=[],h=[];if(r>0){i.push("size:".concat(r)),s.push("size:".concat(r));for(var u=0;u<r;u++){var l=Ii[u];e+=l.aiAutoCnt,t+=l.aiAutoDuration,i.push("k".concat(r-u,":").concat(l.recvFps)),s.push("k".concat(r-u,":").concat(l.aiAutoBuffer)),a=a.concat(l.aiAutoBlockBadDurationList),n=n.concat(l.aiAutoBlockBadContinueBufferList)}}var d=this.getAVSampleResult(Ai,Ri),c=a.length;if(c>0){o.push("size:".concat(c)),h.push("size:".concat(c));for(var p=0;p<c;p++)o.push("k".concat(c-p,":").concat(a[p])),h.push("k".concat(c-p,":").concat(n[p]))}var f={aiAutoCnt:e,aiAutoDuration:t,recvFps:i.join(","),realKbpsSample:d,videoBuffers:s.join(","),blockDurationSample:o.join(","),continueBufferSample:h.join(",")};return v.a.log("Iplayer.getAutoProps, props=",f),f}},{key:"recordRecvFps",value:function(e){var t=this.videoFpsList,i=t.length,s=[];if(i>0){s.push("size:".concat(i));for(var r=i;r>0;r--)s.push("k".concat(r,":").concat(t[r-1]))}if(e.setCoreDim(g.a.DIM_COM.V_RECV_FRAMES,s.join(",")),s.length=0,this.videoFpsList.length=0,this.mse&&this.mse.parser2){var a=this.audioFpsList,n=a.length,o=[];if(n>0){o.push("size:".concat(n));for(var h=n;h>0;h--)o.push("k".concat(h,":").concat(a[h-1]))}o.length=0,this.audioFpsList.length=0}}},{key:"getEmptyAudioRecord",value:function(){return this.mse.getEmptyAudioRecord()}},{key:"onCheckTimer",value:function(e,t){this.shieldAudioPlayer.onCheckTimer(e,t)}},{key:"startShildAudioPlayer",value:function(e){if(e.isStartShield){if(this.is_tie_stream=!0,this.isShieldStart=!0,this.eventEmitter.trigger(o.SHIELD_AUDIO_SWITCH_STATUS,{status:0,commentorIdList:e.commentorIdList}),0==f.a.shieldAudioCfg[0])return void this.eventEmitter.trigger(o.SHIELD_AUDIO_SWITCH_STATUS,{status:2,commentorIdList:e.commentorIdList});this.shieldAudioPlayer.start(e,e.sShieldStreamName),this.mse&&this.mse.switchShieldAudio(!0)}}},{key:"stopShieldAudioPlayer",value:function(){f.a.setAiP2PToFlv(0),this.isShieldStart=!1,this.stat.setComDim(g.a.DIM_COM.IS_TIE_STREAM,0),this.is_tie_stream=!1,v.a.log("IPlayer.stopShieldAudioPlayer"),this.shieldAudioPlayer.stop(),this.mse.stopShieldAudio()}},{key:"onSwitchShieldAudioSuc",value:function(e){this.stat.setComDim(g.a.DIM_COM.IS_TIE_STREAM,1),this.reportShildAudioRes(!0,0,e),v.a.log("IPlayer.onSwitchShieldAudioSuc"),this.eventEmitter.trigger(o.SHIELD_AUDIO_SWITCH_STATUS,{status:1,commentorIdList:this.info.commentorIdList})}},{key:"onSwitchShieldAudioFail",value:function(e,t){this.eventEmitter.trigger(o.SHIELD_AUDIO_SWITCH_STATUS,{status:2,commentorIdList:this.info.commentorIdList}),v.a.log("IPlayer.onSwitchShieldAudioFail"),this.reportShildAudioRes(!1,e,t),this.stopShieldAudioPlayer()}},{key:"onSwitchShieldAudioAbnormal",value:function(){v.a.log("IPlayer.onSwitchShieldAudioAbnormal"),this.eventEmitter.trigger(o.SHIELD_AUDIO_SWITCH_STATUS,{status:3,commentorIdList:this.info.commentorIdList}),this.reportShildAudioRes(!1,5,0),this.stopShieldAudioPlayer()}},{key:"reportShildAudioRes",value:function(e,t,i){var s=this.info&&this.info.commentorIdList?this.info.commentorIdList.join(","):"",r={value:[e?1:2,this.shieldAudioConnectTime,t,i],str:[this.shieldAudioPlayer.loader.url,this.shieldAudioPlayer.cdncip,this.shieldAudioPlayer.cdnsip,s]},a=[this.stat.createAct(g.a.ACT.SWITCH_AUDIO_RES,r)];this.tsdb.sendMetrics(a)}},{key:"getWebCodecType",value:function(){this.playerCoreType===V.a.PLAYER_CORE_TYPE.WEBCODECS&&this.onActWebCodecs([21],[0])}},{key:"onActWebCodecs",value:function(e,t){var i=[this.stat.createAct(g.a.ACT.H265_STATUS,{value:e,str:t})];v.a.log("IPlayer.onActWebCodecs",i),this.tsdb.sendMetrics(i)}},{key:"checkPerformanceBadQuality",value:function(){this.mse.getBufferLen(),this.mse.getContinueBuffer(),f.a.perfWin7kaCfg[0]}},{key:"turnToWebcodecsSoft",value:function(){A.b.isWebCodecsSupported()&&(v.a.log("IPlayer.turnToWebcodecsSoft"),this.eventEmitter.trigger(o.TURN_TO_WEBCODECS_SOFT))}},{key:"setUseSoftAcceleration",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.stat.setComDim(g.a.DIM_COM.DECODE_HARDWARE_ACCELERATION,e?1:0)}},{key:"setEnableDiscard",value:function(e){var t=Number(e.curBitrate)>Number(f.a.webCodecCfg[2]);this.mse&&this.mse.setEnableDiscard&&this.mse.setEnableDiscard(t)}},{key:"onShieldAudioConnected",value:function(e){this.shieldAudioConnectTime=e}},{key:"qaStaRecord",value:function(){v.a.log("IPlayer.qaStatRecord,pause500Cnt=".concat(this.pause500Cnt)),this.shieldStatRecord()}},{key:"shieldStatRecord",value:function(){}},{key:"checkPerfBlock",value:function(){if(this.mse){var e=this.mse.getVideoContinueBuffer(),t=Math.max(this.mse.getBufferLen(),0);1==Number(localStorage._printPerfSec)&&v.a.log("IPlayer.performanceCalc",e,t,f.a.perfBlockCfg[2]),e-t>=f.a.perfBlockCfg[2]&&this.mse.setPerfCntPlus()}}},{key:"check500Pause",value:function(){1!=f.a.closePause500&&this.pause500Cnt++}},{key:"getPause500Cnt",value:function(){var e=this.pause500Cnt;return this.pause500Cnt=0,e}},{key:"isNotSupportWebcodecsConfigure",value:function(){var e=this.isH265?"h265":"h264",t=this.mse;if("h265"==e||"h264"==e){var i="h265"==e?"hvc1.1.6.L93":"avc1.42E01E";"undefined"!=typeof VideoDecoder&&VideoDecoder.isConfigSupported({codec:i}).then((function(i){v.a.log("IPlayer.isConfigSupported",i,e),i.supported?"h265"==e?localStorage.isCloseWebcodecsH265=0:"h264"==e&&(localStorage.isCloseWebcodecsH264=0):("h265"==e?localStorage.isCloseWebcodecsH265=1:"h264"==e&&(localStorage.isCloseWebcodecsH264=1),t&&t.isNotSupportWebcodecsConfig&&t.isNotSupportWebcodecsConfig())})).catch((function(e){v.a.log("IPlayer.isConfigSupported.catch",e.message)}))}}},{key:"onPlayMobPause",value:function(e,t){this.pauseMobStartTs=e,this.pauseMobCnt++,v.a.log("IPlayer.onPlayMobPause,pauseMobStartTs=",this.pauseMobStartTs)}},{key:"onPlayMobResume",value:function(e,t){v.a.log("IPlayer.onPlayMobResume"),this._checkMobPaused(e,mi)}},{key:"setFramePause",value:function(){var e=S.a.now();this.isFramePaused||(this.onPlayMobPause(e),this.isFramePaused=!0)}},{key:"setFrameRusume",value:function(){if(this.isFramePaused){var e=S.a.now();this.onPlayMobResume(e),this.isFramePaused=!1}}},{key:"renderFpsPause",value:function(e){this.isRenderFpsPause=e}},{key:"hasPicture",get:function(){return!1}},{key:"isPlaying",get:function(){return!1}},{key:"isWebCodec",get:function(){return this.playerCoreType==V.a.PLAYER_CORE_TYPE.WEBCODECS}}]),e}());function Di(e){return function(e){if(Array.isArray(e))return C(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||w(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Oi,Fi=function(){function e(t){Object(s.a)(this,e),this.data=t,this.bytesAvailable=this.data.byteLength,this.word=0,this.bitsAvailable=0}return Object(a.a)(e,[{key:"loadWord",value:function(){var e=this.data.byteLength-this.bytesAvailable,t=new Uint8Array(4),i=Math.min(4,this.bytesAvailable);if(0===i)throw new Error("no bytes available");t.set(this.data.subarray(e,e+i)),this.word=new DataView(t.buffer).getUint32(0),this.bitsAvailable=8*i,this.bytesAvailable-=i}},{key:"skipBits",value:function(e){var t;this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,e-=(t=e>>3)>>3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}},{key:"readBits",value:function(e){var t=Math.min(this.bitsAvailable,e),i=this.word>>>32-t;return e>32&&v.a.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0?this.word<<=t:this.bytesAvailable>0&&this.loadWord(),(t=e-t)>0?i<<t|this.readBits(t):i}},{key:"skipLZ",value:function(){var e;for(e=0;e<this.bitsAvailable;++e)if(0!=(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"skipEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var e=this.skipLZ();return this.readBits(e+1)-1}},{key:"readEG",value:function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}},{key:"readBoolean",value:function(){return 1===this.readBits(1)}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"skipScalingList",value:function(e){var t,i=8,s=8;for(t=0;t<e;t++)0!==s&&(s=(i+this.readEG()+256)%256),i=0===s?i:s}},{key:"readSPS",value:function(){var e,t,i,s,r,a,n,o=0,h=0,u=0,l=0,d=0;if(this.readUByte(),e=this.readUByte(),this.readBits(5),this.skipBits(3),this.readUByte(),this.skipUEG(),100===e||110===e||122===e||144===e||244===e||44===e||83===e||86===e||118===e||128===e||138===e){var c=this.readUEG();if(3===c&&this.skipBits(1),this.skipUEG(),this.skipUEG(),this.skipBits(1),this.readBoolean())for(a=3!==c?8:12,n=0;n<a;n++)this.readBoolean()&&(n<6?this.skipScalingList(16):this.skipScalingList(64))}this.skipUEG();var p=this.readUEG();if(0===p)this.readUEG();else if(1===p)for(this.skipBits(1),this.skipEG(),this.skipEG(),t=this.readUEG(),n=0;n<t;n++)this.skipEG();if(this.skipUEG(),this.skipBits(1),i=this.readUEG(),s=this.readUEG(),0===(r=this.readBits(1))&&this.skipBits(1),this.skipBits(1),this.readBoolean()&&(o=this.readUEG(),h=this.readUEG(),u=this.readUEG(),l=this.readUEG()),this.readBoolean()&&(this.readBoolean()&&255===this.readUByte()&&(this.readBits(16),this.readBits(16)),this.readBoolean()&&this.skipBits(1),this.readBoolean()&&(this.readBits(3),this.skipBits(1),this.readBoolean()&&(this.readUByte(),this.readUByte(),this.readUByte())),this.readBoolean()&&(this.readUEG(),this.readUEG()),this.readBoolean())){var f=this.readBits(32);d=this.readBits(32)/f,this.readBoolean()&&(d=Math.ceil(d/2))}return{fps:d,width:16*(i+1)-2*o-2*h,height:(2-r)*(s+1)*16-(u+l)*(r?2:4)}}},{key:"readSliceType",value:function(){return this.readUByte(),this.readUEG(),this.readUEG()}}]),e}(),Li=function(){function e(){Object(s.a)(this,e),this.size=0,this.buffers=[]}return Object(a.a)(e,[{key:"destroy",value:function(){this.reset()}},{key:"reset",value:function(){v.a.log("FlvCacher.reset",this.size),this.size=0,this.buffers=[]}},{key:"append",value:function(e){0!==e.length&&(this.buffers.push(e),this.size+=e.length)}},{key:"getByte",value:function(e){for(var t=0,i=0;i<this.buffers.length;++i){var s=this.buffers[i];if(t+s.length>e)return s[e-t];t+=s.length}return v.a.warn("FlvCacher.getByte has no offset="+e),0}},{key:"popFrame",value:function(){if(0===this.size)return null;if(0===this.buffers.length)return v.a.error("FlvCacher.popFront error no buffers, size:"+this.size+" not eq 0"),this.reset(),null;if(this.size<=Ts.TAG_HEADER_LEN+Ts.PREV_TAG_SIZE_LEN)return null;var e=(this.getByte(1)<<16)+(this.getByte(2)<<8)+this.getByte(3),t=Ts.TAG_HEADER_LEN+e+Ts.PREV_TAG_SIZE_LEN;if(this.size<t)return null;if(1===this.buffers.length){if(this.buffers[0].length===t)return this.size-=t,this.buffers.shift();var i=this.buffers[0].slice(0,t);return this.buffers[0]=this.buffers[0].slice(t),this.size-=t,i}for(var s,r=new Uint8Array(t),a=0,n=0;a<t;){var o=t-a;if(this.buffers[0].length>o){s=this.buffers[0].slice(0,o),r.set(s,n),n+=o,a+=o,this.buffers[0]=this.buffers[0].slice(o),this.size-=o;break}s=this.buffers.shift(),r.set(s,n),n+=s.length,a+=s.length,this.size-=s.length}return r}}]),e}(),Bi=(Oi=new ArrayBuffer(2),new DataView(Oi).setInt16(0,256,!0),256===new Int16Array(Oi)[0]),Ni=function(){function e(){Object(s.a)(this,e)}return Object(a.a)(e,null,[{key:"parseObject",value:function(t,i,s){var r=e.parseString(t,i),a=e.parseScript(t,i+r.size);return{data:{name:r.data,value:a.data},size:a.size}}},{key:"parseVariable",value:function(t,i,s){return e.parseObject(t,i,s)}},{key:"parseDate",value:function(e,t,i){if(i<10)throw new Error("Data size invalid when parse Date");var s=new DataView(e,t),r=s.getFloat64(0,!Bi),a=s.getInt16(8,!Bi);return{data:new Date(r+=60*a*1e3),size:10}}},{key:"parseString",value:function(e,t){var i=new DataView(e,t),s=i.getUint16(0,!Bi),r="";if(s>0)for(var a=0;a<s;a++)r+=String.fromCharCode(i.getUint8(a+2));return{data:r,size:2+s}}},{key:"parseMetadata",value:function(t){var i=e.parseScript(t,0);return e.parseScript(t,i.size,t.length-i.size)}},{key:"parseScript",value:function(t,i,s){var r=i,a=new Uint8Array(t).buffer,n=new DataView(a,0,s),o=null,h=n.getUint8(r);switch(r+=1,h){case 0:o=n.getFloat64(r,!Bi),r+=8;break;case 1:o=!!n.getUint8(r),r+=1;break;case 2:var u=e.parseString(a,r);o=u.data,r+=u.size;break;case 3:for(o={};r<s-3;){var l=e.parseObject(a,r,s-i);if(o[l.data.name]=l.data.value,r=l.size,0===n.getUint8(r)&&0===n.getUint8(r+1)&&9===n.getUint8(r+2)){r+=3;break}}break;case 8:for(o={},r+=4;r<s-8;){var d=e.parseVariable(a,r);o[d.data.name]=d.data.value,r=d.size}r<=s-3&&9==(16777215&n.getUint32(r-1,!Bi))&&(r+=3);break;case 10:o=[];var c=n.getUint32(r,!Bi);r+=4;for(var p=0;p<c;p++){var f=e.parseScript(a,r);o.push(f.data),r=f.size}break;case 11:var m=e.parseDate(a,r+1,s-1);o=m.data,r+=m.size;break;case 12:var _=e.parseString(a,r+1);o=_.data,r+=_.size;break;default:r=s,console.log("AMF","Unsupported AMF value type "+h)}return{data:o,size:r}}},{key:"getStr",value:function(e,t,i){for(var s="",r=0;r<i;r++)s+=String.fromCharCode(e[t++]);return s}}]),e}(),Mi=function(){function e(){Object(s.a)(this,e),this.fpsIndex=0,this.fpsArr=[],this.fpsMap=new Map,this.started=!1,this.realFps=0,this.recvFps=new R(20),this.perSecondIndex=0,this.perSecondArr=[],this.perSecondMap=new Map,this.recvFrames=0,this.lastRecvFrames=0,this.preRecvFrames=0,this.gopSize=0,this.noReferFrameNums=0,this.preNoReferFrameNums=0,this.noReferSize=0,this.fpsList=[]}return Object(a.a)(e,[{key:"getRecord",value:function(){var e=this.recvFrames-this.lastRecvFrames;return this.lastRecvFrames=this.recvFrames,e}},{key:"reset",value:function(){this.fpsArr=[],this.fpsMap.clear(),this.started=!1,this.realFps=0,this.recvFps.reset(),this.recvFrames=0,this.lastRecvFrames=0,this.preRecvFrames=0,this.gopSize=0,this.noReferFrameNums=0,Q.remove(this.onFrameTimer,this),this.perSecondIndex=0,this.perSecondArr=[],this.perSecondMap.clear(),this.fpsList.length=0}},{key:"onFrameTimer",value:function(e,t){this.recvFps.calculate()}},{key:"addDts",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;this.recvFrames++,this.recvFps.addCur(1),this.started||(this.started=!0,Q.add(this.onFrameTimer,this,1e3));var s=parseInt(e/1e3);if(this.fpsMap.has(s))this.fpsMap.set(s,this.fpsMap.get(s)+1);else{this.fpsIndex>=10&&(this.fpsIndex=0),this.calcRealFps();var r=this.fpsArr[this.fpsIndex];this.fpsList.length>=5&&this.fpsList.shift(),this.fpsMap.has(r)&&this.fpsList.push(this.fpsMap.get(r)),this.fpsMap.delete(r),this.fpsArr[this.fpsIndex]=s,this.fpsMap.set(s,1),this.fpsIndex++}t&&this.addDataSize(s,t),i===Ts.IFRAME?(this.preRecvFrames>0&&(this.gopSize=this.recvFrames-this.preRecvFrames),this.preNoReferFrameNums>0&&(this.noReferSize=this.noReferFrameNums-this.preNoReferFrameNums),this.preRecvFrames=this.recvFrames,this.preNoReferFrameNums=this.noReferFrameNums):i===Ts.NO_REFERENCE_FRAME&&this.noReferFrameNums++}},{key:"calcNoRefFps",value:function(){if(0===this.noRefFps){var e=this.fpsArr[1];this.noRefFps=this.noRefFpsMap.get(e)}}},{key:"calcRealFps",value:function(){if(this.fpsIndex>1){var e=this.fpsArr[this.fpsIndex-1];this.realFps=this.fpsMap.get(e)}}},{key:"getRecvFps",value:function(){var e=this.recvFps.average();return e===A.b.UintMax?0:e}},{key:"getFps",value:function(){if(this.fpsArr.length>1){var t=this.fpsArr[1],i=this.fpsMap.get(t),s=0,r=i;return e.FIXED_FPS.forEach((function(e){var t=e>i?e-i:i-e;t<3&&(0===s||t<s)&&(s=t,r=e)})),r}return 0}},{key:"getCalculate",value:function(){this.recvFps.calculate()}},{key:"getNoReferFps",value:function(){return this.noReferSize>0&&this.gopSize>0&&this.getFps()>0?parseInt(this.noReferSize/this.gopSize*this.getFps()):0}},{key:"addDataSize",value:function(e,t){if(this.perSecondMap.has(e))this.perSecondMap.set(e,this.perSecondMap.get(e)+t);else{this.perSecondIndex>=10&&(this.perSecondIndex=0);var i=this.perSecondArr[this.perSecondIndex];this.perSecondMap.delete(i),this.perSecondArr[this.perSecondIndex]=e,this.perSecondMap.set(e,t),this.perSecondIndex++}}},{key:"getRealBitrate",value:function(){var e=0,t=this.perSecondArr.length;if(t>1){var i=this.perSecondArr[t-2];e=this.perSecondMap.get(i)}return parseInt(8*e/1e3)}},{key:"getGopSize",value:function(){return this.gopSize}},{key:"getHeartReceiveFps",value:function(){return this.fpsList.length>=5?this.fpsList.reduce((function(e,t){return e+t}))/this.fpsList.length:0}}]),e}();Mi.FIXED_FPS=[0,15,20,24,30,40,48,60];var Ui=Mi,Vi=i(30),xi=i(23),Hi=function(e){Object(M.a)(i,e);var t=Object(U.a)(i);function i(){var e;return Object(s.a)(this,i),(e=t.call(this)).printProtocol=!!Number(localStorage._printProtocol),e}return Object(a.a)(i,[{key:"onData",value:function(e,t){var i=this.unmarshall(e,t);this.trigger(e,i)}},{key:"unmarshall",value:function(e,t){var i=new Vi.a(t),s=xi.a[e],r=i,a=null;try{a=this.getClass(s)}catch(t){v.a.warn("%c[x] Unmatched protocol ".concat(e>>8," ").concat(s),"color:red;background:#FFF0F0")}return a&&(void 0===(r=new a).unmarshall?v.a.error("[x]"+s+".unmarshall undefined!"):r.unmarshall(i)),this.printProtocol&&!Wi[s]&&v.a.debug("%c<<<<< "+s,function(e,t,i){var s="font-weight:900";return s+=";color:"+e}("#0000E3"),r),r}},{key:"getClass",value:function(e){return null}}]),i}(Ie),Wi={PCdnProxyPing:1,PCdnProxyPingRes:1,PP2pSliceAudioData:1,PP2pSliceVideoData:1,PP2pSliceControlData:1,PCdnP2pGetNode:1,PCdnP2pGetNodeRes:1,P2POffer:1,P2PAnswer:1,P2PCandidate:1,P2POfferReject:1,P2PRequestOffer:1,PCdnP2PWSForward:1,PCdnP2PWSForwardReject:1,PCdnP2pReportLog:1,PCDNSubscribeReq:1,PCDNSubscribeRes:1,PCDNCompeteSubscribeReq:1,PCDNCompeteSubscribeRes:1,P2PPunchBackReq:1,P2PPunchBackRsp:1,HuyaDelaySeiData:1},Gi=Hi,ji=function(){function e(){Object(s.a)(this,e),this.osTime=0,this.syncLocalTime=0,this.rttList=[]}return Object(a.a)(e,[{key:"convertToSrvTime",value:function(e){if(0===this.osTime)return 0;var t=e-this.osTime;return this.syncLocalTime+t}},{key:"isFinishNtp",value:function(){return 0!==this.osTime}},{key:"ntpProcess",value:function(e,t){var i=S.a.now(),s=i-e,r=Math.round(t+s/2);if(0===this.osTime&&0===this.syncLocalTime)this.osTime=i,this.syncLocalTime=r,this.rttList.push(s);else if(this.rttList.length<10)this.osTime=i,this.syncLocalTime=r,this.rttList.push(s);else{for(var a=[],n=0;n<this.rttList.length;++n)a.push(this.rttList[n]);a.sort((function(e,t){return e-t}));for(var o=0,h=0;h<4;++h)o+=a[h];var u=o>>2;(4*s>3*u&&4*s<5*u||s>6e4)&&(this.osTime=i,this.syncLocalTime=r),this.rttList.shift(),this.rttList.push(s),a=null}}}]),e}(),Yi=new(function(){function e(){Object(s.a)(this,e),this._info=new ji,this._clientTime=0,this._requestId=0,this._onWsTimeSyncBind=this._onWsTimeSync.bind(this)}return Object(a.a)(e,[{key:"start",value:function(){this.wsTimeSync(),Q.add(this._onTimer,this,1e3)}},{key:"_onTimer",value:function(e,t){t%60==0&&this.wsTimeSync()}},{key:"wsTimeSync",value:function(){""!==ee.a.sGuid&&(this._req||(this._req=new bt.WSTimeSyncReq),this._requestId=Ae.getRequestId(),this._clientTime=S.a.now(),this._req.sGuid=ee.a.sGuid,this._req.lClientTime=this._clientTime,Ae.sendWup("launch","wsTimeSync",this._req,this._onWsTimeSyncBind,!0,this._requestId))}},{key:"_onWsTimeSync",value:function(e){this._info.ntpProcess(this._clientTime,Number(e.lServerTime))}},{key:"getSyncTime",value:function(){return this._info.convertToSrvTime(S.a.now())}},{key:"isFinishNtp",value:function(){return this._info.isFinishNtp()}}]),e}()),qi=function(){function e(t){Object(s.a)(this,e),this._split=t,this._str=""}return Object(a.a)(e,[{key:"isEmpty",value:function(){return""===this._str}},{key:"addStr",value:function(e){this._str.length>0&&(this._str+=this._split),this._str+=e}},{key:"getStr",value:function(){return this._str}}]),e}(),Ji=[72,85,89,65,58],zi=[44,162,222,9,181,23,71,219,187,85,164,254,127,194,252,78],Ki={HUMEN:"00000001",DELAY:"00000200",VOLUME:"00000400",VOLUME1:"00000401",IFRAME:"00000600"},Qi=function(e){Object(M.a)(r,e);var t=Object(U.a)(r);function r(){return Object(s.a)(this,r),t.call(this)}return Object(a.a)(r,[{key:"getClass",value:function(e){return i(35)("./"+e).default}}]),r}(Gi),$i=function(){function e(t){Object(s.a)(this,e),this._mse=t,this._protoHandler=new Qi,this._proto=null,this._netDelaySum=0,this._c2cDelaySum=0,this._svrDelaySum=0,this._delayCnt=0,this._curAnchorDelay=0,this._offset=0,this.initDts=0,this.initSeiDts=0}return Object(a.a)(e,[{key:"getStat",value:function(){if(0===this._delayCnt)return null;var e={fields:{},dims:{}};if(this._delayCnt>0&&(e.fields[g.a.CORE.DELAY_ANCHOR]=Math.floor(this._c2cDelaySum/this._delayCnt),e.fields[g.a.CORE.DELAY_SERVER]=Math.floor(this._svrDelaySum/this._delayCnt),e.fields[g.a.CORE.DELAY_NET]=Math.floor(this._netDelaySum/this._delayCnt),this._proto)){e.dims[g.a.CORE.UPLOADER_TYPE]=this._proto.anchorSei.uploadType+"",e.dims[g.a.CORE.ENCODER_SOURCE]=this._proto.anchorSei.encoderSource+"";var t=new qi(","),i=new qi(","),s=new qi(",");this._proto.serverSei.serverInfos.forEach((function(e){e.enable>0&&(t.addStr(e.getProxyIdStr()+"-"+e.proxyType),e.serverDelay>0&&e.serverDelay<1e4&&i.addStr(e.proxyType+":"+e.serverDelay),e.lastPeriodDelay>0&&e.lastPeriodDelay<1e4&&s.addStr(e.proxyType+":"+e.lastPeriodDelay))})),t.isEmpty()||(e.dims[g.a.CORE.DELAY_NODE_INFO]=t.getStr()),i.isEmpty()||(e.dims[g.a.CORE.SVR_DELAY_INFOS]=i.getStr()),s.isEmpty()||(e.dims[g.a.CORE.SVR_LAST_P_DELAY]=s.getStr())}return this._netDelaySum=0,this._c2cDelaySum=0,this._svrDelaySum=0,this._delayCnt=0,this._proto=null,e}},{key:"_record",value:function(e,t){this._proto=t;var i=Yi.getSyncTime(),s=e-t.serverSei.dtsGapSum-t.anchorSei.frameDts,r=i-t.anchorSei.sendFrameTime-s;if(this.initSeiDts!=t.anchorSei.frameDts&&(this._mse.offsetDts=e-t.anchorSei.frameDts),this.initSeiDts=t.anchorSei.frameDts,0<r&&r<3e4){var a=i-t.anchorSei.caputureTime-s;this._netDelaySum+=r,this._c2cDelaySum+=a,this._svrDelaySum+=r-t.serverSei.delaySum,this._delayCnt++,this._curAnchorDelay=a||this._curAnchorDelay,this._curAnchorDelay>3e5&&(this._curAnchorDelay=0),this._mse.setSeiDelay(this._curAnchorDelay)}}},{key:"parseSei",value:function(t,i,s,r){if(t+=this.initDts,this._offset=0,s==e.H265_CODEC_TYPE?(i=this._nalUintExtractRbsp(i),this._offset+=2):s==e.AV1_CODEC_TYPE||(this._offset+=1),this._getValue(i),this._getValue(i),this._getH265Len(i),this._isHuya(i)){var a=i.subarray(this._offset),n=this._getType(a);if(r[n]=1,this._mse.saveSeiInfo(t,a,n),n===Ki.DELAY)this._parseDelay(t,a);else if(n===Ki.HUMEN)this._mse.saveH264SeiData(t,a);else if(n===Ki.VOLUME){var o=this._getStr(a);this._mse.scriptVolumeInfos.addMixAudio(o,t)}else if(n===Ki.VOLUME1){var h=this._getStrVolume1(a);this._mse.scriptVolumeInfos.addMixAudio(h,t)}}}},{key:"_nalUintExtractRbsp",value:function(e){for(var t=new Uint8Array(e.length),i=e.length,s=0,r=0;s+2<i;)e[s]||e[s+1]||3!==e[s+2]?t[r++]=e[s++]:(t[r++]=e[s++],t[r++]=e[s++],s++);for(;s<i;)t[r++]=e[s++];return t.subarray(0,r)}},{key:"_getStr",value:function(e){for(var t=e.length,i=new Uint8Array(e.length),s=0;s<t;s++)i[s]=e[s];t=this._getLength(e)+8+16+2;var r=new DataView(i.buffer);return this._readVolume(r,t,26)}},{key:"_readVolume",value:function(e,t,i){for(var s=[];i+9<=t;){var r=4294967296*e.getUint32(i,!1)+e.getUint32(i+4,!1),a=e.getUint8(i+8);s.push(r+"_"+a),i+=9}return s.join(",")}},{key:"_getStrVolume1",value:function(e){var t=this._getStrChar(e),i=this._getStrCode(t),s=new DataView(i.buffer);return this._readVolume(s,i.length,0)}},{key:"_getStrChar",value:function(e){for(var t=this._getLength(e)+8+16+2,i="",s=26;s<t;s++)i+=String.fromCharCode(e[s]);return atob(i)}},{key:"_getStrCode",value:function(e){for(var t=new Uint8Array(e.length),i=0;i<e.length;i++)t[i]=e.charCodeAt(i);return t}},{key:"_getLength",value:function(e){for(var t="",i=9;i<26;i++)t+=String.fromCharCode(e[i]);return parseInt(t)}},{key:"_getValue",value:function(e){for(var t=0,i=e.length;this._offset<i;){if(t+=e[this._offset],255!==e[this._offset]){this._offset++;break}this._offset++}return t}},{key:"_parseDelay",value:function(e,t){if(Yi.isFinishNtp())for(var i=this._decodeData(t),s=i.length,r=new DataView(i.buffer),a=0;a+10<s;){var n=r.getUint32(a,!0),o=r.getUint32(a+4,!0);if(0===n||n>s)break;if(o===xi.a.HuyaDelaySeiData){var h=new DataView(i.buffer,a,n),u=this._protoHandler.unmarshall(o,h);this._record(e,u)}a+=n}}},{key:"_decodeData",value:function(e){for(var t=this._decodeBase64(e),i=t.length,s=new Uint8Array(i),r=0;r<i;r++)s[r]=t.charCodeAt(r);return s}},{key:"_decodeBase64",value:function(e){for(var t="",i=this._getPayloadLen(e),s=0;s<i;s++)t+=String.fromCharCode(e[s+26]);return atob(t)}},{key:"_getPayloadLen",value:function(e){for(var t="",i=0;i<16;i++)t+=String.fromCharCode(e[i+9]);return parseInt(t)}},{key:"_getType",value:function(e){for(var t="",i=0;i<8;i++)t+=String.fromCharCode(e[i]);return t}},{key:"_getH265Len",value:function(e){for(var t=0,i=0;i<16&&e[this._offset]===zi[i];i++)this._offset++,t++;return t}},{key:"_isHuya",value:function(e){for(var t=0;t<5;t++){if(e[this._offset]!==Ji[t])return!1;this._offset++}return!0}}]),e}();$i.H264_CODEC_TYPE=0,$i.H265_CODEC_TYPE=1,$i.AV1_CODEC_TYPE=2,$i.SEI_TYPES=Ki;var Xi=$i,Zi=function(){function e(t){Object(s.a)(this,e),this._bytes=t,this._bitIndex=0,this._bitLen=8*t.byteLength}return Object(a.a)(e,[{key:"getBits",value:function(e){var t=Math.floor(this._bitIndex/8),i=8-this._bitIndex%8,s=this._bytes[t]&(1<<i)-1;if(e<=i)return this._bitIndex+=e,s>>>i-e;var r=e-i;return this._bitIndex+=i,(s<<r|this.getBits(r))>>>0}},{key:"skipBits",value:function(e){this._bitIndex+=e}},{key:"getBytes",value:function(e){if(this._bitIndex%8!=0)throw new Error("can't get bytes from mid-byte: bit index="+this._bitIndex);var t=Math.floor(this._bitIndex/8);return this._bitIndex+=8*e,this._bytes.subarray(t,t+e)}},{key:"bytePosition",get:function(){return Math.floor(this._bitIndex/8)}},{key:"bitposition",get:function(){return this._bitIndex}}]),e}(),es=function(){function e(){Object(s.a)(this,e)}return Object(a.a)(e,null,[{key:"leb128",value:function(e){for(var t=0,i=0;i<8;i++){var s=e.getBits(8);if(t|=(127&s)<<7*i,!(128&s))break}return t}},{key:"parseOBUHeader",value:function(e){var t={},i=e.bits;return t.obu_forbidden_bit=i.getBits(1),t.obu_type=i.getBits(4),t.obu_extension_flag=i.getBits(1),t.obu_has_size_field=i.getBits(1),t.obu_reserved_1bit=i.getBits(1),1==t.obu_extension_flag&&(t.temporal_id=i.getBits(3),t.spatial_id=i.getBits(2),t.extension_header_reserved_3bits=i.getBits(3)),t}},{key:"uvlc",value:function(e){for(var t=0;!e.getBits(1);)++t;return t>=32?0:e.getBits(t)+(1<<t)-1}},{key:"color_config",value:function(t){var i={};return i.high_bitdepth=t.getBits(1),2==i.seq_profile&&i.high_bitdepth?(i.twelve_bit=t.getBits(1),i.BitDepth=i.twelve_bit?12:10):i.BitDepth=i.high_bitdepth?10:8,1==i.seq_profile?i.mono_chrome=0:i.mono_chrome=t.getBits(1),i.color_description_present_flag=t.getBits(1),i.color_description_present_flag?(i.color_primaries=t.getBits(8),i.transfer_characteristics=t.getBits(8),i.matrix_coefficients=t.getBits(8)):(i.color_primaries=e.CP_UNSPECIFIED,i.transfer_characteristics=e.TC_UNSPECIFIED,i.matrix_coefficients=e.MC_UNSPECIFIED),i.mono_chrome?(i.color_range=t.getBits(1),i.subsampling_x=1,i.subsampling_y=1,i.chroma_sample_position=e.CSP_UNKNOWN,i.separate_uv_delta_q=0,i):(i.color_primaries==e.CP_BT_709&&i.transfer_characteristics==e.TC_SRGB&&i.matrix_coefficients==e.MC_IDENTITY?(i.color_range=1,i.subsampling_x=0,i.subsampling_y=0):(i.color_range=t.getBits(1),0==i.seq_profile?(i.subsampling_x=1,i.subsampling_y=1):1==i.seq_profile?(i.subsampling_x=0,i.subsampling_y=0):12==i.BitDepth?(i.subsampling_x=t.getBits(1),i.subsampling_x?i.subsampling_y=t.getBits(1):i.subsampling_y=0):(i.subsampling_x=1,i.subsampling_y=0),i.subsampling_x&&i.subsampling_y&&(i.chroma_sample_position=t.getBits(2))),i.separate_uv_delta_q=t.getBits(1),i)}},{key:"metadata_obu",value:function(t,i){var s={},r=t.bits;if(s.metadata_type=e.leb128(r),s.metadata_type==e.METADATA_TYPE_ITUT_T35){s.itu_t_t35_country_code=r.getBits(8),255==s.itu_t_t35_country_code&&(s.itu_t_t35_country_code_extension_byte=r.getBits(8));var a=(8*i-r.bitposition)/8;s.itu_t_t35_payload_bytes=r.getBytes(a)}else if(s.metadata_type==e.METADATA_TYPE_HDR_CLL)s.max_cll=r.getBits(16),s.max_fall=r.getBits(16);else if(s.metadata_type==e.METADATA_TYPE_HDR_MDCV){s.primary_chromaticity_x=[],s.primary_chromaticity_y=[];for(var n=0;n<3;n++)s.primary_chromaticity_x[n]=r.getBits(16),s.primary_chromaticity_y[n]=r.getBits(16);s.white_point_chromaticity_x=r.getBits(16),s.white_point_chromaticity_y=r.getBits(16),s.luminance_max=r.getBits(32),s.luminance_min=r.getBits(32)}else if(s.metadata_type==e.METADATA_TYPE_SCALABILITY){if(s.scalability_mode_idc=r.getBits(8),s.scalability_mode_idc==e.SCALABILITY_SS){if(s.spatial_layers_cnt_minus_1=r.getBits(2),s.spatial_layer_dimensions_present_flag=r.getBits(1),s.spatial_layer_description_present_flag=r.getBits(1),s.temporal_group_description_present_flag=r.getBits(1),s.scalability_structure_reserved_3bits=r.getBits(3),s.spatial_layer_dimensions_present_flag)for(var o=0;o<=s.spatial_layers_cnt_minus_1;o++)s.spatial_layer_max_width[o]=r.getBits(16),s.spatial_layer_max_height[o]=r.getBits(16);if(s.spatial_layer_description_present_flag)for(var h=0;h<=s.spatial_layers_cnt_minus_1;h++)s.spatial_layer_ref_id[h]=r.getBits(8);if(s.temporal_group_description_present_flag){s.temporal_group_size=r.getBits(8);for(var u=0;u<s.temporal_group_size;u++){s.temporal_group_temporal_id[u]=r.getBits(3),s.temporal_group_temporal_switching_up_point_flag[u]=r.getBits(1),s.temporal_group_spatial_switching_up_point_flag[u]=r.getBits(1),s.temporal_group_ref_cnt[u]=r.getBits(3);for(var l=0;l<temporal_group_ref_cnt[u];l++)s.temporal_group_ref_pic_diff[u][l]=r.getBits(8)}}}}else s.metadata_type==e.METADATA_TYPE_TIMECODE&&(s.counting_type=r.getBits(5),s.full_timestamp_flag=r.getBits(1),s.discontinuity_flag=r.getBits(1),s.cnt_dropped_flag=r.getBits(1),s.n_frames=r.getBits(9),s.full_timestamp_flag?(s.seconds_value=r.getBits(6),s.minutes_value=r.getBits(6),s.hours_value=r.getBits(5)):(s.seconds_flag=r.getBits(1),s.seconds_flag&&(s.seconds_value=r.getBits(6),s.minutes_flag=r.getBits(1),s.minutes_flag&&(s.minutes_value=r.getBits(6),s.hours_flag=r.getBits(1),s.hours_flag&&(s.hours_value=r.getBits(5))))),s.time_offset_length=r.getBits(5),s.time_offset_length>0&&(s.time_offset_value=r.getBits(s.time_offset_length)));return s}},{key:"sequence_header_obu",value:function(t){var i={},s=t.bits;if(i.seq_profile=s.getBits(3),i.still_picture=s.getBits(1),i.reduced_still_picture_header=s.getBits(1),i.reduced_still_picture_header)i.timing_info_present_flag=0,i.decoder_model_info_present_flag=0,i.initial_display_delay_present_flag=0,i.operating_points_cnt_minus_1=0,i["operating_point_idc[0]"]=0,i["seq_level_idx[0]"]=s.getBits(5),i["seq_tier[0]"]=0,i["decoder_model_present_for_this_op[0]"]=0,i["initial_display_delay_present_for_this_op[0]"]=0;else{i.timing_info_present_flag=s.getBits(1),i.timing_info_present_flag?(i.num_units_in_display_tick=s.getBits(32),i.time_scale=s.getBits(32),i.equal_picture_interval=s.getBits(1),i.equal_picture_interval&&(i.num_ticks_per_picture_minus_1=e.uvlc(s)),i.decoder_model_info_present_flag=s.getBits(1),i.decoder_model_info_present_flag&&(i.buffer_delay_length_minus_1=s.getBits(5)),i.num_units_in_decoding_tick=s.getBits(32),i.buffer_removal_time_length_minus_1=s.getBits(5),i.frame_presentation_time_length_minus_1=s.getBits(5),i.initial_display_delay_present_flag=s.getBits(1),i.operating_points_cnt_minus_1=s.getBits(5)):(i.decoder_model_info_present_flag=0,i.initial_display_delay_present_flag=s.getBits(1),i.operating_points_cnt_minus_1=s.getBits(5));for(var r=0;r<=i.operating_points_cnt_minus_1;r++){if(i["operating_point_idc["+r+"]"]=s.getBits(12),i["seq_level_idx["+r+"]"]=s.getBits(5),i["seq_level_idx["+r+"]"]>7?i["seq_tier["+r+"]"]=s.getBits(1):i["seq_tier["+r+"]"]=0,i.decoder_model_info_present_flag){if(i["decoder_model_present_for_this_op["+r+"]"]=s.getBits(1),i["decoder_model_present_for_this_op["+r+"]"]){var a=i.buffer_delay_length_minus_1+1;i["decoder_buffer_delay["+r+"]"]=s.getBits(a),i["encoder_buffer_delay["+r+"]"]=s.getBits(a),i["low_delay_mode_flag["+r+"]"]=s.getBits(1)}}else i["decoder_model_present_for_this_op["+r+"]"]=0;i.initial_display_delay_present_flag&&(i["initial_display_delay_present_for_this_op["+r+"]"]=s.getBits(1)),i["initial_display_delay_present_for_this_op["+r+"]"]&&(i["initial_display_delay_minus_1["+r+"]"]=s.getBits(4))}}return i.frame_width_bits_minus_1=s.getBits(4),i.frame_height_bits_minus_1=s.getBits(4),i.max_frame_width_minus_1=s.getBits(i.frame_width_bits_minus_1+1),i.max_frame_height_minus_1=s.getBits(i.frame_height_bits_minus_1+1),i.reduced_still_picture_header?i.frame_id_numbers_present_flag=0:i.frame_id_numbers_present_flag=s.getBits(1),i.frame_id_numbers_present_flag&&(i.delta_frame_id_length_minus_2=s.getBits(4),i.additional_frame_id_length_minus_1=s.getBits(3)),i.use_128x128_superblock=s.getBits(1),i.enable_filter_intra=s.getBits(1),i.enable_intra_edge_filter=s.getBits(1),i.reduced_still_picture_header?(i.enable_interintra_compound=0,i.enable_masked_compound=0,i.enable_warped_motion=0,i.enable_dual_filter=0,i.enable_order_hint=0,i.enable_jnt_comp=0,i.enable_ref_frame_mvs=0,i.seq_force_screen_content_tools=e.SELECT_SCREEN_CONTENT_TOOLS,i.seq_force_integer_mv=1,i["#OrderHintBits"]=0):(i.enable_interintra_compound=s.getBits(1),i.enable_masked_compound=s.getBits(1),i.enable_warped_motion=s.getBits(1),i.enable_dual_filter=s.getBits(1),i.enable_order_hint=s.getBits(1),i.enable_order_hint&&(i.enable_jnt_comp=s.getBits(1),i.enable_ref_frame_mvs=s.getBits(1)),i.seq_choose_screen_content_tools=s.getBits(1),i.seq_choose_screen_content_tools?i.seq_force_screen_content_tools=e.SELECT_SCREEN_CONTENT_TOOLS:i.seq_force_screen_content_tools=s.getBits(1),i.seq_force_screen_content_tools>0&&(i.seq_choose_integer_mv=s.getBits(1),i.seq_choose_integer_mv?i.seq_force_integer_mv=1:i.seq_force_integer_mv=s.getBits(1)),i.enable_order_hint?(i.order_hint_bits_minus_1=s.getBits(3),i["#OrderHintBits"]=i.order_hint_bits_minus_1+1):i["#OrderHintBits"]=0,i.enable_superres=s.getBits(1),i.enable_cdef=s.getBits(1),i.enable_restoration=s.getBits(1),Object.assign(i,e.color_config(s)),i.film_grain_params_present=s.getBits(1)),i}},{key:"parseOBU",value:function(t,i,s,r){for(var a={bits:new Zi(t)},n=0;t.length-n>1;){var o;1==(o=e.parseOBUHeader(a)).obu_extension_flag&&n++;var h,u=t.length-n;if(h=o.obu_has_size_field?e.leb128(a.bits):u-1-o.obu_extension_flag,o.obu_type==e.OBU_SEQUENCE_HEADER&&s)s(e.sequence_header_obu(a));else if(o.obu_type==e.OBU_METADATA&&r){var l=e.metadata_obu(a,a.bits.bytePosition+h);l.itu_t_t35_payload_bytes&&r(i,l)}else a.bits.skipBits(8*h);n=a.bits.bytePosition}}},{key:"zeroPad",value:function(e,t,i){e||(e=0),void 0===i&&(i=10);for(var s=e.toString(i);s.length<t;)s="0"+s;return s}}]),e}();es.OBU_SEQUENCE_HEADER=1,es.OBU_TEMPORAL_DELIMITER=2,es.OBU_FRAME_HEADER=3,es.OBU_TILE_GROUP=4,es.OBU_METADATA=5,es.OBU_FRAME=6,es.OBU_REDUNDANT_FRAME_HEADER=7,es.OBU_TILE_LIST=8,es.OBU_PADDING=15,es.SELECT_SCREEN_CONTENT_TOOLS=2,es.CP_BT_709=1,es.CP_UNSPECIFIED=2,es.TC_SRGB=13,es.TC_UNSPECIFIED=2,es.MC_IDENTITY=0,es.MC_UNSPECIFIED=2,es.CSP_UNKNOWN=0,es.METADATA_TYPE_HDR_CLL=1,es.METADATA_TYPE_HDR_MDCV=2,es.METADATA_TYPE_SCALABILITY=3,es.METADATA_TYPE_ITUT_T35=4,es.METADATA_TYPE_TIMECODE=5,es.SCALABILITY_SS=14;var ts=es,is=function(){function e(t){Object(s.a)(this,e),this.hasSample=!1,this.samples=new R(t)}return Object(a.a)(e,[{key:"getSamples",value:function(){return this.samples.getSamples()}},{key:"addCur",value:function(e,t){this.hasSample=!0}},{key:"getResult",value:function(){var e=[],t=this.samples.getSamples(),i=t.length;if(i>0){e.push("size:"+i);for(var s=0;s<i;s++)e.push("".concat(i-s,":").concat(t[s]))}return e.join(",")}},{key:"reset",value:function(){var e=this.samples.cur;this.samples.reset(),this.samples.addCur(e)}}]),e}(),ss=function(e){Object(M.a)(i,e);var t=Object(U.a)(i);function i(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;return Object(s.a)(this,i),(e=t.call(this,r)).lastTs=0,e}return Object(a.a)(i,[{key:"addCur",value:function(e,t){N(Object(B.a)(i.prototype),"addCur",this).call(this,e,t);var s=parseInt(t/1e3);this.lastTs>0&&this.lastTs!==s&&this.samples.calculate(),this.lastTs=s,this.samples.addCur(e)}}]),i}(is),rs=function(){function e(){Object(s.a)(this,e),this.aSample=new ss(20),this.vSample=new ss(20),this.aAutoSample=new ss(20),this.vAutoSample=new ss(20)}return Object(a.a)(e,[{key:"addAudioSample",value:function(e,t){this.aSample.addCur(e,t),this.aAutoSample.addCur(e,t)}},{key:"addVideoSample",value:function(e,t){this.vSample.addCur(e,t),this.vAutoSample.addCur(e,t)}},{key:"getResult",value:function(){var e=[],t=this.aSample.getSamples(),i=this.vSample.getSamples(),s=Math.min(i.length,t.length);if(s>0){e.push("size:".concat(s));for(var r=0;r<s;r++)e.push("".concat(s-r,":").concat(i[r]+t[r]))}return e.join(",")}},{key:"reset",value:function(){this.aSample.reset(),this.vSample.reset()}},{key:"getAutoSamples",value:function(){var e={aSamples:this.aAutoSample.getSamples(),vSamples:this.vAutoSample.getSamples()};return this.aAutoSample.reset(),this.vAutoSample.reset(),e}},{key:"recordStat",value:function(e){var t=this.getResult();""!==t&&(this.reset(),e.setCoreDim(g.a.CORE.REAL_KBPS_SAMPLE,t))}}]),e}(),as=function(){function e(t){Object(s.a)(this,e),this.realFps=0,this.maxDropCnt=0,this.curDropCnt=0,this.startDropDts=0,this.lastDropDts=0,this.started=!1,this.discardGap=0,this.minFps=1e3,this.corePlayer=t,this.info=null,this.isRandom=!1}return Object(a.a)(e,[{key:"setConfig",value:function(e){this.dropTime=e.dropTime||0;var t=e.minFps||1e3;this.minFps=Math.max(t,parseInt(2*this.realFps/3))}},{key:"setInfo",value:function(e){this.info=e;var t=!0;this.info&&(t=A.b.getSdkAbRandom(this.info,f.a.dropFrameAb)),this.isRandom=t}},{key:"reset",value:function(){this.realFps=0,this.maxDropCnt=0,this.curDropCnt=0,this.startDropDts=0,this.lastDropDts=0,this.started=!1,this.isRandom=!1}},{key:"start",value:function(){v.a.log("DropFrameController.start"),this.started=!0}},{key:"stop",value:function(){this.started=!1}},{key:"setRealFps",value:function(e){e>0&&0===this.realFps&&(this.realFps=e,this.minFps=Math.max(this.minFps,parseInt(2*e/3)),this.maxDropCnt=Math.max(0,e-this.minFps),v.a.log("DropFrameController.setRealFps fps=".concat(e," minFps=").concat(this.minFps," maxDrop=").concat(this.maxDropCnt)))}},{key:"isCanDrop",value:function(e,t,i){if(this.isRandom&&this.corePlayer.webcodecType!=V.a.PLAYER_CORE_TYPE.WEBCODECS&&!(this.corePlayer.bitrate<f.a.perfBitrate||this.corePlayer.h265Proxy&&this.corePlayer.h265Proxy.isReady||this.corePlayer.getBufferLen()<=2e3)){var s=this.corePlayer.renderList;if(!(s.length<10)){var r=0;s.forEach((function(e){r+=e}));var a=Math.floor(r/s.length),n=~~(1e3/this.realFps*2);return a<=~~(.5*this.realFps)?this.discardGap=n:a<=~~(.6*this.realFps)?this.discardGap=~~(1.3*n):a<=~~(.7*this.realFps)?this.discardGap=~~(1.6*n):a<=~~(.8*this.realFps)?this.discardGap=2*n:a<=~~(.9*this.realFps)&&(this.discardGap=3*n),!t&&0==(96&i)&&(0===this.lastDropDts||e-this.lastDropDts>=this.discardGap)&&(this.lastDropDts=e,!0)}}}}]),e}(),ns=function e(){Object(s.a)(this,e),this.totalTime=0,this.frameNum=0},os=function(){function e(){Object(s.a)(this,e),this.started=!1,this.lastCheckTs=0,this.seg=new ns,this.segList=[],this.idx=0,this.segSize=10}return Object(a.a)(e,[{key:"addFrame",value:function(){var e=S.a.now();this.started||(this.started=!0,this.lastCheckTs=e,Q.add(this.onCheckFrameRate,this,200)),this.seg.frameNum++,this.onCheckFrameRate(e)}},{key:"reset",value:function(){this.started=!1,this.lastCheckTs=0,this.seg=new ns,this.segList=[],this.idx=0,Q.remove(this.onCheckFrameRate,this)}},{key:"onCheckFrameRate",value:function(e){if(this.lastCheckTs>0&&this.seg){var t=e-this.lastCheckTs;t>=1e3&&(this.seg.totalTime=t,this.segList[this.idx]=this.seg,this.idx++,this.idx>=this.segSize&&(this.idx=0),this.seg=new ns,this.lastCheckTs=e)}}},{key:"isDownEnough",value:function(e){return e>0&&this.segList.length>0&&this.getAvg()>.9*e}},{key:"getAvg",value:function(){for(var e=0,t=0,i=this.segList.length,s=0;s<i;s++){var r=this.segList[s];e+=r.frameNum,t+=r.totalTime}return e/t*1e3}}]),e}(),hs=function(){function e(){Object(s.a)(this,e),this.m_idx=0,this.m_data=null,this.m_len=0,this.m_bits=0,this.m_byte=0,this.m_zeros=0}return Object(a.a)(e,[{key:"init",value:function(e,t){this.m_data=e,this.m_len=t,this.m_idx=0,this.m_bits=0,this.m_byte=0,this.m_zeros=0}},{key:"getByte",value:function(){if(this.m_idx>=this.m_len)return 0;var e=this.m_data[this.m_idx++];return 0==e?(this.m_zeros++,this.m_idx<this.m_len&&2==this.m_zeros&&3==this.m_data[this.m_idx]&&(this.m_idx++,this.m_zeros=0)):this.m_zeros=0,e}},{key:"getBit",value:function(){return 0==this.m_bits&&(this.m_byte=this.getByte(),this.m_bits=8),this.m_bits--,this.m_byte>>this.m_bits&1}},{key:"getWord",value:function(e){for(var t=0;e>0;)t<<=1,t|=this.getBit(),e--;return t}},{key:"getUe",value:function(){for(var e=0;this.m_idx<this.m_len&&0==this.getBit();)e++;var t=(1<<e)-1;return 31==e?0:(e>0&&(t+=this.getWord(e)),t)}},{key:"getSe",value:function(){var e=this.getUe(),t=e+1>>1;return 1&e||(t=-t),t}},{key:"parseSequenceParameterSet",value:function(e,t,i){if(t<20)return!1;this.init(e,t),this.getWord(16);var s=this.getWord(4);i.sps_video_parameter_set_id=s;var r=this.getWord(3);i.sps_max_sub_layers_minus1=r,s=this.getWord(1),i.temporal_id_nesting_flag=s,this.hevc_parse_profile_tier_level(i,r);var a=this.getUe();i.sps_seq_parameter_set_id=a;var n=this.getUe();i.chroma_format_idc=n;var o=0;3==n&&(o=s=this.getWord(1)),i.separate_colour_plane_flag=o;var h=this.getUe(),u=this.getUe();v.a.log("HevcSpsParser.parseSequenceParameterSet', ue_width=".concat(h,", ue_height=").concat(u));var l=0,d=0,c=0,p=0;this.getWord(1)&&(l=this.getUe(),d=this.getUe(),c=this.getUe(),p=this.getUe());var f=1!=n&&2!=n||0!=o?1:2,m=1==n&&0==o?2:1;return h-=f*d+f*l,u-=m*p+m*c,i.width=h,i.height=u,this.getUe()==this.getUe()}},{key:"hevc_parse_profile_tier_level",value:function(e,t){if(this.hevc_parse_profile_tier_level_common(e,1,1,1),0!=t){var i=[],s=[];i[6]={},s[6]={};for(var r=0;r<t;r++)i[r]=this.getWord(1),s[r]=this.getWord(1);if(t>0)for(var a=t;a<8;a++)this.getWord(2);e.sub_layer=[];for(var n=0;n<t;n++)e.sub_layer[n]={},this.hevc_parse_profile_tier_level_common(e.sub_layer[n],i[n],s[n],0)}}},{key:"hevc_parse_profile_tier_level_common",value:function(e,t,i,s){t&&(e.profile_space=this.getWord(2),e.tier_flag=this.getWord(1),e.profile_idc=this.getWord(5),e.profile_compatibility_flags=this.getWord(32),e.progressive_source_flag=this.getWord(1),e.interlaced_source_flag=this.getWord(1),e.non_packed_constraint_flag=this.getWord(1),e.frame_only_constraint_flag=this.getWord(1),e.reserved_zero_44bits=this.getWord(44)),i&&(e.level_idc=this.getWord(8))}}]),e}(),us=function(){function e(t,i){Object(s.a)(this,e),this.corePlayer=t,this.parser=i,this.dropLevel=0,this.open=!1,this.started=!1,this.dropFrames=0,this.lastDropFrames=0,this.lastDropTs=0,this.realFps=0,this.discardGap=0,this.lastDropDts=0,this.dropRenderLevel=0,this.lastCheckDisCardTs=0,this.checkDiscardTimes=0,this.dropRenderLevel=!1,this.isRenderDrop=!1}return Object(a.a)(e,[{key:"setRealFps",value:function(e){e>0&&0===this.realFps&&(this.realFps=e,v.a.log("DropFrameByDts.setRealFps fps=".concat(e)))}},{key:"getRecrod",value:function(){var e=S.a.now()-this.lastDropTs,t=Math.round(e/1e3),i=this.dropFrames-this.lastDropFrames,s=Math.round(i/t);return this.lastDropFrames=this.dropFrames,this.lastDropTs=S.a.now(),s<0?0:s}},{key:"start",value:function(){var e=($.a.browser+"").toLowerCase();"safari"===e?v.a.log("DropFrameDts.start fail browser=".concat(e)):(v.a.log("DropFrameDts.start"),this.started=!0,this.lastDropTs=S.a.now())}},{key:"stop",value:function(){this.started=!1}},{key:"reset",value:function(){this.dropLevel=0,this.dropFrames=0,this.lastDropFrames=0,this.realFps=0,this.lastDropDts=0,this.dropRenderLevel=0,this.discardGap=0,this.lastCheckDisCardTs=0,this.checkDiscardTimes=0}},{key:"isCanDrop",value:function(e,t,i){if(1!=f.a.isCloseMseDrop&&1==f.a.isLimitNaluType){if(!this.open||!this.started||this.corePlayer.webcodecType!==V.a.PLAYER_CORE_TYPE.MSE)return!1;if(1==localStorage._closeDrop)return!1;var s=this.corePlayer.renderList;if(s.length>=5&&this.getDisCardCfg(s),t)0!==this.dropLevel&&v.a.log("DropFrameByDts.dropFrames level=".concat(this.dropLevel," dromNum=").concat(this.dropFrames)),this.dropLevel=0;else{var r=this.corePlayer.getBufferLen(),a=e-this.corePlayer.getCurrentRealTime();if(this.dropLevel<2&&a>=f.a.dropFrameDts[1]&&r<.5*f.a.dropFrameDts[1]?(this.dropLevel=2,v.a.log("DropFrameByDts.dropFrame level=2 buffer=".concat(r," gap=").concat(a))):this.dropLevel<1&&a>=f.a.dropFrameDts[0]&&r<.7*f.a.dropFrameDts[0]&&(this.dropLevel=1,v.a.log("DropFrameByDts.dropFrame level=1 buffer=".concat(r," gap=").concat(a))),2===this.dropLevel)return this.dropFrames++,this.lastDropDts=e,!0;if(1===this.dropLevel&&0==(96&i))return this.dropFrames++,this.lastDropDts=e,!0;if(r<=1e3)return 2==localStorage._printMseDropInfo&&v.a.log("DropFrameByDts buffer <= 1000"),!1;if(!this.corePlayer.isSupportRequestVideoFrameCallback())return!1;if(this.isRenderDrop&&0==(96&i)&&e-this.lastDropDts>=this.discardGap)return this.lastDropDts=e,this.dropFrames++,this.dropLevel=3,!0}return!1}}},{key:"getDisCardCfg",value:function(e){var t=S.a.now();if(!(0!=this.lastCheckDisCardTs&&t-this.lastCheckDisCardTs<1e3)){this.checkDiscardTimes++,this.lastCheckDisCardTs=t;var i,s=0,r=0,a=!1,n=0,o=0;if(0!=this.realFps){var h=this.parser.fps.getHeartReceiveFps();e.forEach((function(e){s+=e})),i=Math.floor(s/e.length),0!=h&&(o=Math.floor(i/h*100)/100),n=this.realFps,Number(localStorage._forceDropFrame)>0&&(n=Number(localStorage._forceDropFrame));var u=Math.floor(i/n*100)/100,l=~~(1e3/n*2),d=3*l,c=2*l,p=~~(1.6*l),f=~~(1.3*l),m=l,_=~~(.9*n),y=~~(.8*n),g=~~(.7*n),T=~~(.6*n),P=~~(.5*n);o>=.9&&1!=localStorage._forceMseDropReal?(o>=.95&&this.checkDiscardTimes%10==0?1==this.dropRenderLevel?(a=!1,r=0):2==this.dropRenderLevel?(this.discardGap=d,r=1,a=!0):3==this.dropRenderLevel?(this.discardGap=c,r=2,a=!0):4==this.dropRenderLevel?(this.discardGap=p,r=3,a=!0):5==this.dropRenderLevel&&(this.discardGap=f,r=4,a=!0):(r=0,a=!1),1==localStorage._printMseDropInfo&&v.a.log("DropFrameByDts.getDisCardCfg.realRate back,lastDropLevel=".concat(this.dropRenderLevel,",isRenderDropLevel=").concat(r,",isRenderDrop=").concat(a,",realRenderRate=").concat(o,",fpsRenderRate=").concat(u,",renderSec=").concat(i,",heartReceiveFps=").concat(h))):(i<=_&&i>y?(this.discardGap=d,r=1,a=!0):i<=y&&i>g?(this.discardGap=c,r=2,a=!0):i<=g&&i>T?(this.discardGap=p,r=3,a=!0):i<=T&&i>P?(this.discardGap=f,r=4,a=!0):i<=P?(this.discardGap=m,r=5,a=!0):(r=this.dropRenderLevel,a=this.isRenderDrop),1==localStorage._printMseDropInfo&&v.a.log("DropFrameByDts.getDisCardCfg.realFps,lastDropLevel=".concat(this.dropRenderLevel,",isRenderDropLevel=").concat(r,",isRenderDrop=").concat(a,",realRenderRate=").concat(o,",fpsRenderRate=").concat(u,",renderSec=").concat(i,",heartReceiveFps=").concat(h))),this.dropRenderLevel=r,this.isRenderDrop=a}}}},{key:"destroy",value:function(){this.corePlayer=null,this.parser=null,this.isRenderDrop=!1}}]),e}(),ls=function(){function e(){Object(s.a)(this,e),this.size=0,this.head=null,this.freeChainSize=0,this.freeChain=null,this.travelNode=null}return Object(a.a)(e,[{key:"resetTravel",value:function(){this.travelNode=this.head}},{key:"travel",value:function(){if(null===this.travelNode&&(this.travelNode=this.head,null===this.travelNode))return null;var e=this.travelNode.data;return this.travelNode=this.travelNode.next,this.travelNode===this.head||null===this.travelNode?null:e}},{key:"reset",value:function(){this.resetTravel();var e=null,t=null;for(e=this.head;null!=e;)t=e,e=e.next,t.data=null,t.prev=null,t.next=null,e===this.head&&(e=null);for(this.head=null,e=this.freeChain;null!=e;)t=e,e=e.next,t.data=null,t.prev=null,t.next=null;this.freeChain=null,this.size=0,this.freeChainSize=0}},{key:"put",value:function(e){var t=this.getFree(e);if(this.size++,null===this.head)t.prev=t,t.next=t,this.head=t;else if(t.data.key<this.head.data.key)t.prev=this.head.prev,t.next=this.head,t.prev.next=t,t.next.prev=t,this.head=t;else{for(var i=this.head.prev;t.data.key<i.data.key;)i=i.prev;if(t.data.key===i.data.key)return this.size--,this.putFree(t),!1;t.prev=i,t.next=i.next,t.prev.next=t,t.next.prev=t}return!0}},{key:"put2",value:function(e){var t=this.getFree(e);if(this.size++,null===this.head)t.prev=t,t.next=t,this.head=t;else if(t.data.key<this.head.data.key)t.prev=this.head.prev,t.next=this.head,t.prev.next=t,t.next.prev=t,this.head=t;else{for(var i=this.head;t.data.key>i.data.key&&(i=i.next)!==this.head;);if(t.data.key===i.data.key)return this.size--,this.putFree(t),!1;t.prev=i.prev,t.next=i,i.prev.next=t,i.prev=t}return!0}},{key:"get",value:function(){if(null===this.head)return null;var e=this.head,t=e.data;return this.size--,0===this.size?this.head=null:(e.prev.next=e.next,e.next.prev=e.prev,this.head=this.head.next),this.putFree(e),t}},{key:"peek",value:function(){return null===this.head?null:this.head.data}},{key:"peekLast",value:function(){return null===this.head?null:this.head.prev.data}},{key:"getOrNewNode",value:function(e){var t=null;if(null===this.head)this.size++,(t=this.getFree(null)).prev=t,t.next=t,this.head=t;else if(e<this.head.data.key)this.size++,(t=this.getFree(null)).prev=this.head.prev,t.next=this.head,t.prev.next=t,t.next.prev=t,this.head=t;else{for(var i=this.head.prev;e<i.data.key;)i=i.prev;i.data.key===e?t=i:(this.size++,(t=this.getFree(null)).prev=i,t.next=i.next,t.prev.next=t,t.next.prev=t)}return t}},{key:"putFree",value:function(e){e.data=null,e.next=this.freeChain,e.prev=null,this.freeChain=e,this.freeChainSize++}},{key:"getFree",value:function(e){if(null===this.freeChain)return new ds(e);var t=this.freeChain;return t.data=e,this.freeChain=t.next,this.freeChainSize--,t}},{key:"getLast",value:function(){if(null==this.head)return null;var e=this.head.prev,t=e.data;return this.size--,0===this.size?this.head=null:(e.prev.next=e.next,e.next.prev=e.prev),this.putFree(e),t}}],[{key:"addData",value:function(e,t,i){e.put(t),e.size>i&&e.get()}}]),e}(),ds=function e(t){Object(s.a)(this,e),this.next=null,this.prev=null,this.data=t},cs=ls,ps=function(){function e(){Object(s.a)(this,e),this.beforeChangeVideo=new cs,this.beforeChangeAudio=new cs,this.afterChangeVideo=new cs,this.afterChangeAudio=new cs,this.avcChangeCnt=0,this.avcChange=!1,this.duration=f.a.avHeaderChangeStatCfg[1]||3e3,this.avcChangeInfo=""}return Object(a.a)(e,[{key:"setAvcChange",value:function(){this.avcChangeCnt++,this.avcChangeCnt>1&&(this.avcChange=!0,this.afterChangeVideo.reset(),this.afterChangeAudio.reset())}},{key:"addVideo",value:function(e){this.addChain(this.avcChange?this.afterChangeVideo:this.beforeChangeVideo,e)}},{key:"addAudio",value:function(e){this.addChain(this.avcChange?this.afterChangeAudio:this.beforeChangeAudio,e)}},{key:"addChain",value:function(e,t){e.put(t);var i=e.peek();i&&t.key-i.key>this.duration&&(this.avcChange?this.recordAvcChangeInfo():e.get())}},{key:"recordAvcChangeInfo",value:function(){this.avcChange=!1;var e=this.getInfo(this.beforeChangeVideo),t=this.getInfo(this.afterChangeVideo),i=this.getInfo(this.beforeChangeAudio),s=this.getInfo(this.afterChangeAudio);this.avcChangeInfo="vDts=[".concat(e.dtsArr.join("-"),"--").concat(t.dtsArr.join("-"),"]"),this.avcChangeInfo+="  vCts=[".concat(e.ctsArr.join("-"),"--").concat(t.ctsArr.join("-"),"]"),this.avcChangeInfo+="  aDts=[".concat(i.dtsArr.join("-"),"--").concat(s.dtsArr.join("-"),"]")}},{key:"getInfo",value:function(e){var t=e.get(),i=[],s=[];if(t)for(i.push(t.key),t.hasOwnProperty("cts")&&s.push(t.cts);e.size>0;){var r=e.get();i.push(r.key-t.key),r.hasOwnProperty("cts")&&s.push(r.cts),t=r,0===e.size&&i.push(r.key)}return{dtsArr:i,ctsArr:s}}},{key:"record",value:function(e,t){""!==this.avcChangeInfo&&t&&e.setComp(g.a.DIM_H265_SAM.name,"avcChange",this.avcChangeInfo),this.avcChangeInfo=""}}]),e}(),fs=!!Number(localStorage._dropAudio),ms=!!Number(localStorage._dropVideo),_s=(Number(localStorage._dropGap),"Hvcc"),ys="AnnexB",vs=function(){function e(){Object(s.a)(this,e),this.lastDts=0,this.lastPts=0,this.lastCts=0,this.dtsStat=[0,0,0,0,0,0],this.ptsStat=[0,0,0,0,0,0],this.ctsStat=[0,0,0,0,0,0],this.playVideoFrameCnt=0,this.playAudioFrameCnt=0}return Object(a.a)(e,[{key:"reset",value:function(){this.lastDts=this.lastPts=this.lastCts=0,this.playVideoFrameCnt=this.playAudioFrameCnt=0,this.dtsStat=[0,0,0,0,0,0],this.ptsStat=[0,0,0,0,0,0],this.ctsStat=[0,0,0,0,0,0]}},{key:"setTimeStamp",value:function(e,t,i){this.addStat(this.dtsStat,this.lastDts,e),this.addStat(this.ptsStat,this.lastPts,t),this.addStat(this.ctsStat,this.lastCts,i),this.lastDts=e,this.lastPts=t,this.lastCts=i}},{key:"addStat",value:function(e,t,i){if(t>0&&i>t){var s=i-t;s>=1e3?e[4]++:s>=800?e[3]++:s>=600?e[2]++:s>=400?e[1]++:s>=200&&e[0]++}}}]),e}(),Ss=[43,138,8,0],gs=function(e){Object(M.a)(i,e);var t=Object(U.a)(i);function i(e,r,a){var n;return Object(s.a)(this,i),(n=t.call(this)).corePlayer=e,n.remuxer=r,n.flvCacher=new Li,n.fps=new Ui,n.downFrameRate=new os,n.audioFps=new Ui,n.sei=new Xi(e),n.avSample=new rs,n.hevcSpsParser=new hs,n.timeStampStat=new vs,n.emptyFrames=0,n.avcChangeStat=new ps,n.dropFrameCtrl=new as(e),n.dropFrameDts=new us(e,Object(L.a)(n)),n.videoChain=new cs,n.audioChain=new cs,n.DEFAULT_GOP=200,n.bufLen=400,n.firstBufLen=400,n.remuxLen=n.firstBufLen,n.maxWaitTime=2e3,n.repairSameDts=!1,n.lastDtsDis=0,n.pushGop=!1,n.parseFlvHead=!1,n.lengthSizeMinusOne=0,n.recvVideoFrameTimeStamp=0,n.recvVideoFrameNums=0,n.videoFramePlayDelayTs=0,n.videoFrameCalculatePlayDelayFrames=0,n.audioConfig=Ss.slice(),n.audioSampleRate=22050,n.aacTimeLen=1024e3/n.audioSampleRate,n.validAacTime=500*n.aacTimeLen,n.audioChannelCount=1,n.audioObjectType=5,n.audioIncreaseTSMap=new Map,n.firstDemuxAudioTS=-1,n.streamFormat=ys,n.spsUnit=null,n.ppsUnit=null,n.vpsUnit=null,n.videoConfig={},n.hasCtsZero=!1,n.paused=!1,n.hasEmptyFrames=!1,n.playVideoFrameCnt=0,n.playVideoLength=0,n.playAudioFrameCnt=0,n.playAudioLength=0,n.playEmptyAudioFrameCnt=0,n.beginParseTs=0,n.hasAudioTag=!1,n.lastAacTs=0,n.hasKeyFrame=!1,n.lastAudioTs=0,n.lastVideoTs=0,n.lastParseDts=0,n.maxaudioptsList=[0,0,0,0,0,0,0,0,0,0],n.last10anduiptsList=[0,0,0,0,0,0,0,0,0,0],n.firstAudioTs=-1,n.showH265Tip=!1,n.appendHighQualityEmptyAudio=!0,n.deleteH264Aud=!1,n.incompleteFlvheaderLen=0,n.videoFrames=0,n.audioFrames=0,n.headCache=null,n.useWebCodes=!0,n.decodeNums=0,n.OBUParser=new ts,n.seiTypes={},n.av1Bytes=0,n.lastDropDts=0,n.PPS=[],n.SPS=[],n.VPS=[],n.videoCodec="",n.videoWidth=1280,n.videoHeight=720,n.reset(),n.onAV1SequenceHeaderBind=n.onAV1SequenceHeader.bind(Object(L.a)(n)),n.onAV1MetaDataBind=n.onAV1MetaData.bind(Object(L.a)(n)),n.parseType=a,n.startAudioTs=0,n.startVideoTs=0,n.parseVideoTagCnt=0,n.parseVideoSucCnt=0,n}return Object(a.a)(i,[{key:"printVideoInfo",value:function(){var e=this.videoChain;if(e.size>0){for(var t=e.get(),i=[t.key],s=[t.cts];e.size>0;){var r=e.get();i.push(r.key-t.key),s.push(r.cts),t=r}v.a.log("FlvParser video dtsList：".concat(i.join(","))),v.a.log("FlvParser video ctsList：".concat(s.join(",")))}}},{key:"printAudioInfo",value:function(){var e=this.audioChain;if(e.size>0){for(var t=e.get(),i=[t.key];e.size>0;){var s=e.get();i.push(s.key-t.key),t=s}v.a.log("FlvParser audio dtsList：".concat(i.join(",")))}}},{key:"getCodecType",value:function(){return 12===this.codec?F:13===this.codec?"av1":"h264"}},{key:"printPlayFrameInfo",value:function(){v.a.log("FlvParser.playFrameInfo",this.timeStampStat.playVideoFrameCnt,this.timeStampStat.playAudioFrameCnt)}},{key:"getAudioFrames",value:function(){return this.audioFrames}},{key:"getVideoFrames",value:function(){return this.videoFrames}},{key:"getFps",value:function(){return this.fps.getFps()}},{key:"getRealFps",value:function(){return this.fps.realFps}},{key:"getRealFpsAudio",value:function(){return this.audioFps.realFps}},{key:"isDownEnough",value:function(){return this.downFrameRate.isDownEnough(this.fps.realFps)}},{key:"getAudioFps",value:function(){return this.audioFps&&this.audioFps.getFps()}},{key:"setDecoctorTimeAbnormal",value:function(){var e=localStorage.decodeabnormal;if(e&&e.split("_").length>1){var t=parseInt(e.split("_")[1]),i=(new Date).getTime()-t;i&&i>864e5?(this.appendHighQualityEmptyAudio=!0,localStorage.decodeabnormal=""):this.appendHighQualityEmptyAudio=!1}}},{key:"destroy",value:function(){this.reset()}},{key:"reset",value:function(e){v.a.log("FlvParser.reset"),this.printFirstVideoTs=!1,this.printFirstAudioTs=!1,this.pfvTs=!1,this.pfaTs=!1,this.fps.reset(),this.audioFps.reset(),this.flvCacher.destroy(),this.timeStampStat.reset(),this.dropFrameCtrl.reset(),this.dropFrameDts.reset(),this.videoChain.reset(),this.audioChain.reset(),this.lastParseDts=0,this.hasAudioTag=!1,this.lastAacTs=0,this.hasKeyFrame=!1,this.lastAudioTs=0,this.lastVideoTs=0,this.lastDropDts=0,this.showH265Tip=!1,this.bufLen=400,this.remuxLen=this.firstBufLen,this.hasCtsZero=!1,this.audioIncreaseTSMap.clear(),this.firstDemuxAudioTS=-1,this.recvVideoFrameTimeStamp=0,this.recvVideoFrameNums=0,this.videoFramePlayDelayTs=0,this.videoFrameCalculatePlayDelayFrames=0,this.incompleteFlvheaderLen=0,this.parseFlvHead=!1,this.switchingUrl=!1,this.droppingSample=null,this.decodeIFRTime=0,this.waitRemuxTime=0,this.isFirstRemux=!1,this.av1Bytes=0,this.onAV1SequenceHeaderBind=null,this.onAV1MetaDataBind=null,this.startAudioTs=0,this.startVideoTs=0,this.PPS.length=0,this.SPS.length=0,this.VPS.length=0,this.videoCodec="",this.videoWidth=1280,this.videoHeight=720}},{key:"getPlayStat",value:function(){var e={videoFrameCnt:this.playVideoFrameCnt,videoLength:this.playVideoLength,audioFrameCnt:this.playAudioFrameCnt,audioLength:this.playAudioLength,emptyAudioFrameCnt:this.playEmptyAudioFrameCnt};return this.playVideoFrameCnt=0,this.playVideoLength=0,this.playAudioFrameCnt=0,this.playAudioLength=0,this.playEmptyAudioFrameCnt=0,e}},{key:"setPaused",value:function(e){this.paused=e}},{key:"setPushGop",value:function(e){this.pushGop=e,v.a.log("FlvParser.setPushGop "+e)}},{key:"setDeleteH264Aud",value:function(e){this.deleteH264Aud=e,v.a.log("FlvParser.deleteH264Aud "+e)}},{key:"setDroppingSample",value:function(e){this.droppingSample=e}},{key:"parseFlv",value:function(e,t){var s=0;if(this.headCache){var r=new Uint8Array(e.length+this.headCache.length);r.set(this.headCache,0),r.set(e,this.headCache.length),e=r}var a,n=e.length;if(!1===this.parseFlvHead){var o=i.FLV_HEADER_LEN+i.PREV_TAG_SIZE_LEN;if(n<o)return v.a.warn("FlvParser.parseFlv flv has no header len="+n),void(this.headCache=e.slice());if(this.headCache=null,s+=o,!i.probe(e))return;this.parseFlvHead=!0,this.beginParseTs=Date.now()}for(0===s?this.flvCacher.append(e):this.flvCacher.append(e.slice(s));null!==(a=this.flvCacher.popFrame());)this.parseTag(a,t)}},{key:"parseTag",value:function(e,t){var s=e.length;if(s<i.TAG_HEADER_LEN+i.PREV_TAG_SIZE_LEN)v.a.warn("FlvParser.parseTag flv has no whole tag len="+s+" data="+e);else{var r=0,a=e[r++],n=(e[r++]<<16)+(e[r++]<<8)+e[r++];if(s-(i.TAG_HEADER_LEN+i.PREV_TAG_SIZE_LEN)<n)v.a.warn("FlvParser.parseTag flv has no enough data dataLen="+n+" len="+s);else if(0!==n){var o=(e[r++]<<16)+(e[r++]<<8)+e[r++]+parseInt(e[r++].toString(16)+"000000",16);r+=3,a===i.VIDEO_TYPE?(this.avSample.addVideoSample(s,o),ms||t||(this.parseVideo(e,11,n,o),this.corePlayer.setExceptionStat(g.a.DIM_LINK_STA.VIDEO_FRAME,1))):a===i.AUDIO_TYPE?(this.avSample.addAudioSample(s,o),fs||this.corePlayer.isPureVideo||(this.parseAudio(e,11,n,o),this.corePlayer.setExceptionStat(g.a.DIM_LINK_STA.AUDIO_FRAME,1))):a===i.SCRIPT_TYPE?this.parseScriptTag(e,11,n,o):(v.a.warn("%cFlvParser.parseTag discard type="+a+" len="+n,"color:white;background:black"),this.corePlayer.onVideoParseInvalid&&this.corePlayer.onVideoParseInvalid())}else v.a.warn("FlvParser.parseTag flvtag empty type="+a)}}},{key:"parseScriptTag",value:function(e,t,s,r){if(t+i.SCRIPT_AMF1_HEAD_LEN>s)v.a.log("script too small");else{e[t++];var a=(e[t++]<<8)+e[t++],n=Ni.getStr(e,t,a);t+=a,this.corePlayer&&("onMetaData"===n?Object.assign(this.corePlayer.metadata,Ni.parseScript(e,t,e.length).data):-1!==n.indexOf("onMixAudio")&&this.corePlayer.scriptVolumeInfos.addMixAudio(n.replace("onMixAudio:",""),r))}}},{key:"parseVideo",value:function(e,t,s,r){if(this.repairSameDts&&r===this.lastVideoTs&&this.lastDtsDis>0){var a=this.fps.realFps;r+=a>0?parseInt(1e3/a):this.lastDtsDis}if(this.lastVideoTs>0&&this.lastVideoTs<r&&(this.lastDtsDis=r-this.lastVideoTs),s<5)v.a.warn("FlvParser.parseVideo avc videotag not enough dataLen="+s);else{var n=e[t]>>4;this.codec=15&e[t++];var o=e[t++];if(5!==s)if(0===o)this.parseVideoConfig(e,t,s,r);else if(1===o){if(this.parseVideoTagCnt++,n==i.IFRAME)this.corePlayer&&this.corePlayer.setExceptionStat(g.a.DIM_LINK_STA.VIDEO_IFRAME,1),this.hasKeyFrame||(this.decodeIFRTime=S.a.now()),this.hasKeyFrame=!0;else if(!this.hasKeyFrame)return void v.a.log("-------- drop video tag has no IFrame",r);if(Number(localStorage._printVideoTs)&&v.a.debug("%cFlvParser video ts","color:green",r,r-this.lastVideoTs),localStorage.gap&&(r+=Number(localStorage.gap)),this.lastVideoTs>0&&(r-this.lastVideoTs>200||r-this.lastVideoTs<-200)){var h=r-this.lastVideoTs;v.a.warn("FlvParser video dts jump lastDts=".concat(this.lastVideoTs," curDts=").concat(r," gap=").concat(h)),(h>=f.a.videoMaxGap||h<=-f.a.videoMaxGap)&&this.resetPlayer()}if(1==Number(localStorage._printAudioTsSec)){var u=S.a.now();u-this.startVideoTs>1e3&&(v.a.debug("%cFlvParser shield video sec ts","color:blue",r),this.startVideoTs=u)}this.lastVideoTs=r,this.parseVideoNalu(e,t,s,r,n)}else 2===o?v.a.info("%cFlvParser.parseVideo avc_end dataLen="+s,"color:white;background:black"):v.a.warn("%cFlvParser.parseVideo error avc packet type="+o,"color:white;background:black");else v.a.log("FlvParser.parseVideo avc_empty frameType="+n+" avcPacketType="+o)}}},{key:"resetPlayer",value:function(){this.corePlayer.resetPlayer()}},{key:"onAV1SequenceHeader",value:function(e){var t="av01."+e.seq_profile+"."+ts.zeroPad(e["seq_level_idx[0]"],2)+(e["seq_tier[0]"]?"H":"M")+"."+ts.zeroPad(e.BitDepth,2)+"."+e.mono_chrome+"."+e.subsampling_x+e.subsampling_y+(1===e.subsampling_x&&1===e.subsampling_y?e.chroma_sample_position:0);e.color_description_present_flag&&(t+="."+ts.zeroPad(e.colorPrimaries,2)+"."+ts.zeroPad(e.transferCharacteristics,2)+"."+ts.zeroPad(e.matrixCoefficients,2)+"."+e.color_range);var i={isHevc:!1,isAV01:!0,width:e.max_frame_width_minus_1+1,height:e.max_frame_height_minus_1+1,codec:t};this.corePlayer.setExceptionStat(g.a.DIM_LINK_STA.VIDEO_CONFIG,1),this.remuxer&&this.remuxer.switchLevel(!1,!1),this.corePlayer.updateVideoConfig(i,!1)}},{key:"onAV1MetaData",value:function(e,t){t.itu_t_t35_payload_bytes&&this.sei.parseSei(e,t.itu_t_t35_payload_bytes,Xi.AV1_CODEC_TYPE,this.seiTypes)}},{key:"parseVideoConfig",value:function(e,t,s,r){var a,n,o=[],h=[],u=[],l=[],d=[],c=[],p=0,m=0,_="",y=!1,S=null,T=(t+=3)+s-5;if(this.isAv01()){this.av1Bytes=e.subarray(t,t+s-5);var P=e.subarray(t+=4,t+s);ts.parseOBU(P,0,this.onAV1SequenceHeaderBind)}else{if(this.isHevc()){this.showH265Tip||(this.showH265Tip=!0,v.a.warn("This is a H265 video.")),this.corePlayer.setExceptionStat(g.a.DIM_LINK_STA.H265,1);var E=this.hevcFindNextStartCode(e,t);if(E.found){this.streamFormat=ys,this.corePlayer.setStreamFormat(this.streamFormat),v.a.log("FlvParser.parseVideoConfig AnnexB");for(var C=(126&e[t+=E.startCodeSize])>>1,w=t;t<T;){if((E=this.hevcFindNextStartCode(e,t)).found||t+1===T){switch(C){case i.NAL_VPS:var I=null;I=t+1===T?{data:e.subarray(w,t+1),type:C}:{data:e.subarray(w,t),type:C},this.vpsUnit&&this.vpsUnit.data.toString(16)!==I.data.toString(16)&&(v.a.log("FlvParser.parseVideoConfig vps changed"),y=!0),this.vpsUnit=I,u.push(I.data),c[c.length]={length:I.data.length,nalu:I.data};break;case i.NAL_SPS:var A=null;A=t+1===T?{data:e.subarray(w,t+1),type:C}:{data:e.subarray(w,t),type:C},this.spsUnit&&this.spsUnit.data.toString(16)!==A.data.toString(16)&&(v.a.log("FlvParser.parseVideoConfig sps changed"),y=!0),this.spsUnit=A,o.push(A.data),l[l.length]={length:A.data.length,nalu:A.data};break;case i.NAL_PPS:var R=null;R=t+1===T?{data:e.subarray(w,t+1),type:C}:{data:e.subarray(w,t),type:C},this.ppsUnit&&this.ppsUnit.data.toString(16)!==R.data.toString(16)&&(v.a.log("FlvParser.parseVideoConfig pps changed"),y=!0),this.ppsUnit=R,h.push(R.data),d[d.length]={length:R.data.length,nalu:R.data}}if(t+E.startCodeSize<T){C=(126&e[t+=E.startCodeSize])>>1,w=t;continue}}t++}}else{if(!f.a.enableHvcc)return v.a.warn("hevcFindNextStartCode failed! dataLen",s),void this.corePlayer.on265StartCodeError();this.streamFormat=_s,this.corePlayer.setStreamFormat(this.streamFormat),v.a.log("FlvParser.parseVideoConfig Hvcc"),t+=21,this.lengthSizeMinusOne=3&e[t++];var k=e[t++];v.a.log("FlvParser.parseVideoConfig Hvcc nNaluArrayCount=".concat(k));for(var b=0;b<k;b++){var D=99&e[t++];if(D===i.NAL_VPS)for(var O=(e[t++]<<8)+e[t++],F=0,L=0;L<O;++L){F=(e[t++]<<8)+e[t++];var B={data:e.subarray(t,t+F),type:i.NAL_VPS};this.vpsUnit&&this.vpsUnit.data.toString(16)!==B.data.toString(16)&&(v.a.log("FlvParser.parseVideoConfig vps changed"),y=!0),this.vpsUnit=B,t+=F,u.push(B.data),c[c.length]={length:B.data.length,nalu:B.data}}else if(D===i.NAL_SPS)for(var N=(e[t++]<<8)+e[t++],M=0;M<N;++M){a=(e[t++]<<8)+e[t++];var U={data:e.subarray(t,t+a),type:i.NAL_SPS};this.spsUnit&&this.spsUnit.data.toString(16)!==U.data.toString(16)&&(v.a.log("FlvParser.parseVideoConfig sps changed"),y=!0),this.spsUnit=U,t+=a,o.push(U.data),l[l.length]={length:U.data.length,nalu:U.data}}else if(D===i.NAL_PPS)for(var V=(e[t++]<<8)+e[t++],x=0;x<V;++x){n=(e[t++]<<8)+e[t++];var H={data:e.subarray(t,t+n),type:i.NAL_PPS};this.ppsUnit&&this.ppsUnit.data.toString(16)!==H.data.toString(16)&&(v.a.log("FlvParser.parseVideoConfig pps changed"),y=!0),this.ppsUnit=H,t+=n,h.push(H.data),d[d.length]={length:H.data.length,nalu:H.data}}}}this.spsConfig={},this.hevcSpsParser.parseSequenceParameterSet(this.spsUnit.data,this.spsUnit.data.length,this.spsConfig);var W=this.spsConfig.profile_space,G=this.spsConfig.profile_idc,j=this.spsConfig.profile_compatibility_flags;j=(j=(j=(j=(j=j>>1&1431655765|(1431655765&j)<<1)>>2&858993459|(858993459&j)<<2)>>4&252645135|(252645135&j)<<4)>>8&16711935|(16711935&j)<<8)>>16|j<<16;var Y=this.spsConfig.tier_flag,q=this.spsConfig.level_idc;_="hvc1."+["","A","B","C"][W%4]+G.toString()+"."+j.toString(16).toLowerCase()+"."+["L","H"][Y%2]+q.toString(),p=this.spsConfig.width||this.corePlayer.width,m=this.spsConfig.height||this.corePlayer.height,v.a.log("FlvParser.parseVideoConfig.hevcSpsConfig",this.spsConfig,_),S={isHevc:!0,isAV01:!1,vps:u,sps:o,pps:h,codec:_,width:p,height:m},this.hasCtsZero=!0,this.corePlayer.setAvcCfg(p,m)}else{t+=4,this.lengthSizeMinusOne=3&e[t++],this.streamFormat="Avcc",v.a.log("FlvParser.parseVideoConfig Avcc"),this.corePlayer.setStreamFormat(this.streamFormat);for(var J=31&e[t++],z=0;z<J;++z){a=(e[t++]<<8)+e[t++];var K={data:e.subarray(t,t+a),type:7};this.spsUnit&&this.spsUnit.data.toString(16)!==K.data.toString(16)&&(v.a.log("FlvParser.parseVideoConfig sps changed"),y=!0),this.spsUnit=K,t+=a,o.push(K.data),l[z]={length:a,nalu:K.data};var Q=new Fi(K.data).readSPS();p=Q.width,m=Q.height;for(var $=K.data.subarray(1,4),X="avc1.",Z=0;Z<3;Z++){var ee=$[Z].toString(16);ee.length<2&&(ee="0"+ee),X+=ee}_=X}for(var te=e[t++],ie=0;ie<te;++ie){n=(e[t++]<<8)+e[t++];var se={data:e.subarray(t,t+n),type:8};this.ppsUnit&&this.ppsUnit.data.toString(16)!==se.data.toString(16)&&(v.a.log("FlvParser.parseVideoConfig pps changed"),y=!0),this.ppsUnit=se,t+=n,h.push(se.data),d[ie]={length:n,nalu:se.data}}S={isHevc:!1,isAV01:!1,sps:o,pps:h,width:p,height:m,codec:_},this.corePlayer.setExceptionStat(g.a.DIM_LINK_STA.VIDEO_CONFIG,1),this.corePlayer.setAvcCfg(p,m)}this.corePlayer.updateAVCConfig&&this.corePlayer.updateAVCConfig({pps:d,sps:l,vps:c,codec:_,width:p,height:m,timestamp:r}),this.PPS=d,this.SPS=l,this.VPS=c,this.videoCodec=_,this.videoWidth=p,this.videoHeight=m,this.avcChangeStat.setAvcChange(),this.corePlayer.updateVideoConfig(S,y),this.remuxer&&this.remuxer.switchLevel(y,!1),v.a.log("FlvParser.parseVideoConfig avccfg dataLen="+s+" spsLen="+a+" ppsLen="+n+" w/h="+S.width+"/"+S.height+" codec="+S.codec)}}},{key:"parseVideoNalu",value:function(e,t,s,r,a){var n,o,h=[],u=0,l=!1,d=a===i.IFRAME,c=(e[t++]<<16)+(e[t++]<<8)+e[t++];0===c?this.hasCtsZero||(this.hasCtsZero=!0):c>=8388608?c-=16777216:c>2500&&c<3500?c=0:c>600&&v.a.warn("FlvParser.parseVideoNalu large cts="+c+" dts="+r),cs.addData(this.videoChain,{key:r,cts:c},Number(f.a.avHeaderChangeCfg[2])),this.avcChangeStat.addVideo({key:r,cts:c}),d&&!this.isAv01()&&(this.vpsUnit&&(h.push(this.vpsUnit),u+=this.vpsUnit.data.length),this.spsUnit&&(h.push(this.spsUnit),u+=this.spsUnit.data.length),this.ppsUnit&&(h.push(this.ppsUnit),u+=this.ppsUnit.data.length));var p=t+s-5,m=!1;if(this.seiTypes={},this.isAv01()){var _=e.subarray(t,t+s-5);h.push({data:_,type:1===a?5:1}),ts.parseOBU(_,r,null,this.onAV1MetaDataBind),u+=_.length,n=1}else if(this.isHevc()){if(this.streamFormat==ys){var y=this.hevcFindNextStartCode(e,t);if(!y.found)return v.a.error("hevcFindNextStartCode failed! dataLen",s),void this.corePlayer.on265StartCodeError();for(var g=(126&e[t+=y.startCodeSize])>>1,T=t;t<p;)((y=this.hevcFindNextStartCode(e,t)).found||t+1===p)&&(g<10&&(m=!((98&g)>>1)),o=t+1===p?{data:e.subarray(T,t+1),type:g}:{data:e.subarray(T,t),type:g},g===i.HEVC_NAL_SEI?this.sei.parseSei(r,o.data,Xi.H265_CODEC_TYPE,this.seiTypes):g===i.HEVC_NAL_AUD||(g===i.NAL_VPS?(h.push(o),u+=o.data.length,this.corePlayer.updateAVCVPS&&this.corePlayer.updateAVCVPS(o.data,r)):g===i.NAL_SPS?(h.push(o),u+=o.data.length,this.corePlayer.updateAVCSPS&&this.corePlayer.updateAVCSPS(o.data,r)):g===i.NAL_PPS?(h.push(o),u+=o.data.length,this.corePlayer.updateAVCPPS&&this.corePlayer.updateAVCPPS(o.data,r)):(o.discardAllow=g<10&&!(1&g),o.isUnit=!0,h.push(o),u+=o.data.length)),t+y.startCodeSize<p)?(g=(126&e[t+=y.startCodeSize])>>1,T=t):t++}else if(this.streamFormat==_s)for(var P=s-5;P;){n=0;for(var E=0;E<=this.lengthSizeMinusOne;++E)n+=e[t++]<<8*(this.lengthSizeMinusOne-E);if(P-=this.lengthSizeMinusOne+1,0!==n){if(n<0||n>s-5)break;if(n>P){t+=P;break}var C=(126&e[t])>>1;P-=n,(o={data:e.subarray(t,t+n),type:C}).naluType=C,C===i.HEVC_NAL_SEI?this.sei.parseSei(r,o.data,Xi.H265_CODEC_TYPE,this.seiTypes):C===i.HEVC_NAL_AUD||(C===i.NAL_VPS?(h.push(o),u+=o.data.length,this.corePlayer.updateAVCVPS&&this.corePlayer.updateAVCVPS(o.data,r)):C===i.NAL_SPS?(h.push(o),u+=o.data.length,this.corePlayer.updateAVCSPS&&this.corePlayer.updateAVCSPS(o.data,r)):C===i.NAL_PPS?(h.push(o),u+=o.data.length,this.corePlayer.updateAVCPPS&&this.corePlayer.updateAVCPPS(o.data,r)):(o.discardAllow=C<10&&!(1&C),o.isUnit=!0,h.push(o),u+=o.data.length)),t+=n}}}else for(var w=s-5;w;){n=0;for(var I=e[t+4],A=0;A<=this.lengthSizeMinusOne;++A)n+=e[t++]<<8*(this.lengthSizeMinusOne-A);if(w-=this.lengthSizeMinusOne+1,0!==n){if(n<0||n>s-5)break;if(n>w){t+=w;break}w-=n;var R=31&(o={data:e.subarray(t,t+n),type:1===a?5:1}).data[0];if(o.naluType=R,this.isH264Sei(o.data))this.sei.parseSei(r,o.data,Xi.H264_CODEC_TYPE,this.seiTypes);else if(this.isH264NALUPPS(o.data))h.push(o),u+=o.data.length,this.corePlayer.updateAVCPPS&&this.corePlayer.updateAVCPPS(o.data,r);else if(this.isH264NALUPSPS(o.data))h.push(o),u+=o.data.length,this.corePlayer.updateAVCSPS&&this.corePlayer.updateAVCSPS(o.data,r);else if(this.corePlayer.webcodecType==V.a.PLAYER_CORE_TYPE.WEBCODECS){if(R>=1&&R<=5){var k=!1;1!=a&&0==(96&I)&&(k=!0,l=!0),o.discardAllow=k,o.isUnit=!0,h.push(o),u+=o.data.length}}else 1==f.a.isLimitNaluType?R>=1&&R<=5&&!this.dropFrameDts.isCanDrop(r,d,I)&&(h.push(o),u+=o.data.length):this.isH264Aud(o.data)&&this.deleteH264Aud||(this.isH264Aud(o.data)?(h.push(o),u+=o.data.length):this.dropFrameDts.isCanDrop(r,d,I)||(h.push(o),u+=o.data.length));t+=n}}if(u>0){var b={type:this.isAv01()?"av01":"avc",units:h,len:u,ts:r,cts:c,dts:90*r,pts:90*(r+c),key:a===i.IFRAME,origin_iframe:1===this.seiTypes[Xi.SEI_TYPES.IFRAME],isBFrameType:m,av1Bytes:this.av1Bytes};if(a===i.IFRAME&&(b.spsUnit=this.SPS,b.ppsUnit=this.PPS,b.vpsUnit=this.VPS,b.videoCodec=this.videoCodec,b.videoWidth=this.videoWidth,b.videoHeight=this.videoHeight),this.corePlayer.isLive&&this.corePlayer.videoPlayConsuming&&this.corePlayer.videoPlayConsuming.addRecvFrameData(r,r+c,S.a.now()),this.droppingSample&&this.droppingSample(b))return;if(this.printFirstVideoTs||(this.printFirstVideoTs=!0,v.a.log("FlvParser.parseVideo dts=".concat(r," pts=").concat(b.pts/90," isIFrame=").concat(d))),this.pfvTs||(this.pfvTs=!0,v.a.log("FlvParser.parseVideo11 dts=".concat(r," pts=").concat(b.pts/90," isIFrame=").concat(d))),this.corePlayer.webcodecType!=V.a.PLAYER_CORE_TYPE.WEBCODECS||this.isH264Aud(o.data))this.fps.addDts(r,s);else{var D=d?i.IFRAME:l?i.NO_REFERENCE_FRAME:0;this.fps.addDts(r,s,D)}this.downFrameRate.addFrame(),this.dropFrameCtrl.setRealFps(this.fps.realFps),this.dropFrameDts.setRealFps(this.fps.realFps),this.corePlayer.setRealFps(this.fps.realFps),this.corePlayer.curVideoDts=r,this.lastParseDts=r,this.videoFrames++,this.timeStampStat.setTimeStamp(r,r+c,c),this.parseVideoSucCnt++,this.corePlayer.pushAvcSample(b),this.playVideoFrameCnt++,this.timeStampStat.playVideoFrameCnt++,this.playVideoLength+=s}}},{key:"parseAudio",value:function(e,t,s,r){cs.addData(this.audioChain,{key:r},Number(f.a.avHeaderChangeCfg[2])),this.avcChangeStat.addAudio({key:r});var a=e[t++]>>>4,n=!0,o=r;10!=a&&v.a.warn("FlvParser.parseAudio Unsupported audio codec, soundFormat="+a),this.calcAudioFrameRate(r),null!=this.audioIncreaseTSMap.get(r)&&(r=this.audioIncreaseTSMap.get(r)),r<this.lastAudioTs&&0!=this.lastAudioTs&&(n=!1);var h=e[t++];if(0===h)if(s>=4){var u=e[t]>>3;this.audioObjectType=u;var l=((7&e[t])<<1)+((128&e[t+1])>>7);if(l>=i.AdtsSampleingRates.length)return void v.a.warn("FlvParser.parseAudio SampleingRate out of bounds. samplingIndex="+l);this.audioChannelCount=(120&e[t+1])>>3;var d=this.getAdtsConfig(u,l,this.audioChannelCount);this.audioConfig=d,this.corePlayer.updateAudioConfig({audioConfig:d,codec:"mp4a.40.5",audioSampleRate:this.audioSampleRate,aacTimeLen:this.aacTimeLen,audioObjectType:this.audioObjectType,audioChannelCount:this.audioChannelCount,timeStamp:r},!1,this.parseType),this.firstAudioTs=-1,this.firstDemuxAudioTS=-1,this.lastAudioTs=0,this.corePlayer.setExceptionStat(g.a.DIM_LINK_STA.AUDIO_CONFIG,1)}else v.a.warn("FlvParser.parseAudio adts error dataLen="+s+" ts="+r);else if(1===h){if(1==localStorage._dropAudioFrame)return;if(this.last10anduiptsList.shift(),this.last10anduiptsList.push(r),-1==this.firstAudioTs&&(this.firstAudioTs=r),-1==this.firstDemuxAudioTS)this.firstDemuxAudioTS=r;else if(r==this.firstDemuxAudioTS)return void v.a.warn("parseaudio audio too much audio in firstTs ts="+r);if(!n)return void v.a.warn("parseaudio audio ts too small maxlist="+this.maxaudioptsList+"  now="+r+"  first="+this.firstAudioTs+"  last="+this.lastAudioTs);for(var c=0;c<10;c++)this.maxaudioptsList[c]=this.last10anduiptsList[c];if(this.lastAudioTs>0&&this.lastAudioTs==r){var p=r+(0|this.aacTimeLen);this.audioIncreaseTSMap.set(o,p),r=p}if(Number(localStorage._printAudioTs)&&1==this.parseType&&v.a.debug("%cFlvParser audio ts","color:red",r,r-this.lastAudioTs),1==Number(localStorage._printAudioTs2)&&2==this.parseType&&v.a.debug("%cFlvParser shield audio ts","color:green",r,r-this.lastAudioTs),1==Number(localStorage._printAudioTsSec)&&2==this.parseType){var m=S.a.now();m-this.startAudioTs>1e3&&(v.a.debug("%cFlvParser shield audio sec ts","color:green",r),this.startAudioTs=m)}if(this.lastAudioTs=r,this.hasAudioTag=!0,!this.validAacSample(r))return;var _=s-2,y={type:"aac",unit:e.subarray(t,t+_),dts:90*r,pts:90*r,ts:r,sampleDuration:this.aacTimeLen};if(this.corePlayer.isLive&&this.corePlayer.audioPlayConsuming&&this.corePlayer.audioPlayConsuming.addRecvFrameData(r,r,S.a.now()),this.droppingSample&&this.droppingSample(y))return;this.printFirstAudioTs||(this.printFirstAudioTs=!0,v.a.log("FlvParser.parseAudio"+this.parseType,r)),this.pfaTs||(this.pfaTs=!0,v.a.log("FlvParser.parseAudio11"+this.parseType,r)),this.audioFps.addDts(r),this.corePlayer.curAudioDts=r,this.lastParseDts=r,this.audioFrames++,this.corePlayer.pushAacSample(y,this.parseType)}else v.a.warn("FlvParser.parseAudio error aac packet type="+h)}},{key:"validAacSample",value:function(e){var t=[],i=(t=2==this.parseType?this.corePlayer.ctrlBuffer.avBuffer.aShieldBuffer.samples:this.corePlayer.ctrlBuffer.avBuffer.aBuffer.samples).length;if(i>0){var s=t[i-1];return 1===i&&s.ts>e&&s.ts-e>this.validAacTime?(t.shift(),!0):e-s.ts<this.validAacTime}return!0}},{key:"getAdtsConfig",value:function(e,t,s){var r=0,a=null,n=navigator.userAgent.toLowerCase();return-1!==n.indexOf("firefox")?t>=6?(e=5,a=new Array(4),r=t-3):(e=2,a=new Array(2),r=t):-1!==n.indexOf("android")?-1!==n.indexOf("mqqbrowser")?(e=2,a=new Array(2),r=t):(e=5,a=new Array(4),r=t):(e=5,a=new Array(4),r=t,t>=6?r=t-3:1===s&&(e=2,a=new Array(2),r=t)),this.audioSampleRate=i.AdtsSampleingRates[t],this.aacTimeLen=1024e3/this.audioSampleRate,v.a.log("FlvParser.getAdtsConfig audioSampleRate="+this.audioSampleRate+" aacTimeLen="+this.aacTimeLen),a[0]=e<<3,a[0]|=(14&t)>>1,a[1]=(1&t)<<7,a[1]|=s<<3,5===e&&(a[1]|=(14&r)>>1,a[2]=(1&r)<<7,a[2]|=8,a[3]=0),v.a.log("FlvParser.getAdtsConfig type="+e+" index="+t+" channel="+s+" exIndex="+r+" config="+a),a}},{key:"parseOBUHeader",value:function(e){var t={};return t.obu_forbidden_bit=e>>7,t.obu_type=(120&e)>>3,t.obu_extension_flag=(4&e)>>2,t.obu_has_size_field=(2&e)>>1,t.obu_reserved_1bit=1&e,t}},{key:"isHevc",value:function(){return 12==this.codec}},{key:"isAv01",value:function(){return 13==this.codec}},{key:"hevcFindNextStartCode",value:function(e,t){return 0===e[t]&&0===e[t+1]?1===e[t+2]?{found:!0,startCodeSize:3}:0===e[t+2]&&1===e[t+3]?{found:!0,startCodeSize:4}:{found:!1}:{found:!1}}},{key:"isHevcNal",value:function(e,t){return 0===e[t]&&0===e[t+1]&&0===e[t+2]&&1===e[t+3]}},{key:"isH264Sei",value:function(e){return 6==(31&e[0])}},{key:"isH264Aud",value:function(e){return 9==(31&e[0])}},{key:"isH264NALUPPS",value:function(e){return(31&e[0])==i.NALU_TYPE_PPS}},{key:"isH264NALUPSPS",value:function(e){return(31&e[0])==i.NALU_TYPE_SPS}},{key:"getCalculateVideoFramePlayDelay",value:function(){return 0}},{key:"calcAudioFrameRate",value:function(e){this.audioFrameRateTs||(this.audioFrameRateTs=e,this.audioFrameCnt=0),e-this.audioFrameRateTs<1e3?this.audioFrameCnt++:(Number(localStorage._printAudioFrameRate)&&v.a.log("@@@@@@@@ audioFrameRate="+this.audioFrameCnt),this.audioFrameRateTs=e,this.audioFrameCnt=0)}}],[{key:"probe",value:function(e){return!(70!==e[0]||76!==e[1]||86!==e[2]||1!==e[3])}}]),i}(Ie);gs.EVENTS={META_DATA:"meta_data",SWITCH_URL_DONE:"switch_url_done"},gs.REMUX_TYPE_AUDIO=0,gs.REMUX_TYPE_VIDEO=1,gs.FLV_HEADER_LEN=9,gs.TAG_HEADER_LEN=11,gs.PREV_TAG_SIZE_LEN=4,gs.AUDIO_TYPE=8,gs.VIDEO_TYPE=9,gs.SCRIPT_TYPE=18,gs.SCRIPT_AMF1_HEAD_LEN=13,gs.SCRIPT_AMF2_HEAD_LEN=5,gs.IFRAME=1,gs.NO_REFERENCE_FRAME=99,gs.NAL_VPS=32,gs.NAL_SPS=33,gs.NAL_PPS=34,gs.HEVC_NAL_AUD=35,gs.HEVC_NAL_SEI=39,gs.NAL_RASL_N=8,gs.NAL_RASL_R=9,gs.NALU_TYPE_SLICE=1,gs.NALU_TYPE_DPA=2,gs.NALU_TYPE_DPB=3,gs.NALU_TYPE_DPC=4,gs.NALU_TYPE_IDR=5,gs.NALU_TYPE_SEI=6,gs.NALU_TYPE_SPS=7,gs.NALU_TYPE_PPS=8,gs.NALU_TYPE_AUD=9,gs.NALU_TYPE_EOSEQ=10,gs.NALU_TYPE_EOSTREAM=11,gs.NALU_TYPE_FILL=12,gs.H265_SEI_HEAD=[44,162,222,9,181,23,71,219,187,85,164,254,127,194,252,78],gs.AdtsSampleingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];var Ts=gs,Ps=function(){function e(t,i){Object(s.a)(this,e),this.mse=t,this.video=i,this.playing=!1,this.seekTime=0,this.isMuffled=!1,this.cacheVolume=1,this.seekSuc=!1,this.seeking=!1,i.addEventListener("pause",t.onVideoPauseBind),i.addEventListener("error",t.onVideoErrorBind),i.addEventListener("play",t.onVideoPlayBind),i.addEventListener("playing",t.onVideoPlayingBind),i.addEventListener("loadeddata",t.onVideoLoadedBind),i.addEventListener("resize",t.onVideoResizeBind),this.requestVideoFrameCallbackBind=this.requestVideoFrameCallback.bind(this),this.callBackId=-1,"safari"!==E.a.name&&this.video&&this.video.requestVideoFrameCallback&&(this.callBackId=this.video.requestVideoFrameCallback(this.requestVideoFrameCallbackBind))}return Object(a.a)(e,[{key:"isSupportRequestVideoFrameCallback",value:function(){return this.video&&this.video.requestVideoFrameCallback}},{key:"isSupportRequestVideoFrameCallback",value:function(){return this.video&&this.video.requestVideoFrameCallback}},{key:"requestVideoFrameCallback",value:function(){this.mse&&this.mse.requestVideoFrameCallback&&this.mse.requestVideoFrameCallback(),this.callBackId=this.video.requestVideoFrameCallback(this.requestVideoFrameCallbackBind)}},{key:"seek",value:function(e){this.seekTime=e,this.seeking=!0}},{key:"realSeek",value:function(){if(this.seeking&&this.video&&this.video.buffered.length>0){for(var e=!1,t=this.video.buffered,i=this.seekTime,s=0;s<t.length;s++){var r=t.start(s),a=t.end(s);r>=i&&r-i<1?(i=r,e=!0,v.a.log("MseVideo._checkSeek out off buffer, reseek=".concat(i))):i>r&&i<a&&(e=!0,v.a.log("MseVideo._checkSeek in buffer, reseek=".concat(i)))}e&&(this.printBuffered(),this.seeking=!1,this.video.currentTime=i,v.a.log("MSEVideo.seek currentTime=".concat(this.video.currentTime," seekTime=").concat(i)))}}},{key:"checkCurrentTime",value:function(){this.video&&(this.video.currentTime=this.video.currentTime)}},{key:"_checkPlay",value:function(){v.a.log("MSEVideo.checkPlay seekTime=".concat(this.seekTime," playing=").concat(this.playing," currentTime=").concat(this.video&&this.video.currentTime)),this.video&&0===this.video.currentTime&&!this.playing?(this.seekTime>0?(this.seekTime++,this.video.currentTime=this.seekTime):this.video.currentTime+=1,this._play()):Q.remove(this._checkPlay,this)}},{key:"play",value:function(){"safari"!==E.a.name||this.mse.isLive?(this._play(),Q.add(this._checkPlay,this,1e3)):Q.add(this._checkPlay,this,1e3)}},{key:"_play",value:function(){var e=this;if(this.video){var t=this.video.play();t?t.then((function(){Q.remove(e._checkPlay,e),v.a.log("MSEVideo._play suc currentTime=".concat(e.video&&e.video.currentTime)),e.mse&&e.mse.handler._hyPlayer&&e.mse.handler._hyPlayer.roomRecordStat&&e.mse.handler._hyPlayer.roomRecordStat.roomNoRenderStat.resume(),f.a.platform===V.a.PLATFORM_TYPE_NAME.wap&&!e.playing&&e.mse&&e.mse.triggerH5PlayVideo(),e.playing=!0,Q.remove(e._checkSeek,e)})).catch((function(t){e.playing=!1;var i=t.toString();v.a.warn("MSEVideo.play error: ".concat(i)),e.mse&&(i.indexOf("NotAllowedError")>=0||i.indexOf("request was interrupted")>=0||e.video.paused)&&(e.mse&&e.mse.onPauseByBrowser(),f.a.platform===V.a.PLATFORM_TYPE_NAME.wap&&Q.remove(e._checkPlay,e))})):this.playing=!1}else Q.remove(this._checkPlay,this)}},{key:"pause",value:function(){this.video.pause()}},{key:"getBufferLen",value:function(){var e=0;if(this.video){var t=this.video.buffered;t.length>0&&(e=1e3*(t.end(t.length-1)-this.video.currentTime)>>0)}return e}},{key:"printBuffered",value:function(){for(var e=this.video.buffered,t=[],i=0;i<e.length;i++)t.push("[".concat(e.start(i),", ").concat(e.end(i),"]"));v.a.log("video.buffered",t.join(" "),"video.currentTime=",this.video.currentTime)}},{key:"getCurrentTime",value:function(){return this.seeking&&this.seekTime>0?1e3*this.seekTime:1e3*this.video.currentTime}},{key:"setVolume",value:function(e){this.isMuffled?this.video.volume=0:this.video.volume=e,this.cacheVolume=e}},{key:"setMuffledVolume",value:function(e){this.isMuffled=e,this.isMuffled?this.video.volume=0:this.setVolume(this.cacheVolume)}},{key:"getVolume",value:function(){return this.video.volume}},{key:"setMuted",value:function(e){this.video&&(this.video.muted=e,v.a.log("MSEVideo.setMuted ".concat(e," hasVideo=").concat(!!this.videoSourceBuffer," hasAudio=").concat(!!this.audioSourceBuffer)))}},{key:"getMuted",value:function(){return this.video?this.video.muted:-1}},{key:"getVideoWidth",value:function(){return this.video?this.video.videoWidth:0}},{key:"getVideoHeight",value:function(){return this.video?this.video.videoHeight:0}},{key:"destroy",value:function(){this.video.removeEventListener("error",this.mse.onVideoErrorBind),this.video.removeEventListener("pause",this.mse.onVideoPauseBind),this.video.removeEventListener("play",this.mse.onVideoPlayBind),this.video.removeEventListener("playing",this.mse.onVideoPlayingBind),this.video.removeEventListener("loadeddata",this.mse.onVideoLoadedBind),this.video.removeEventListener("resize",this.mse.onVideoResizeBind),this.pause(),this.video.removeAttribute("src"),"function"==typeof this.video.load&&function(){try{this.video.load()}catch(e){}}(),this.video&&this.video.cancelVideoFrameCallback&&-1!=this.callBackId&&this.video.cancelVideoFrameCallback(this.callBackId),this.callBackId=-1,this.video=null,this.mse=null}}]),e}(),Es=function(){function e(t,i){Object(s.a)(this,e),this._mse=t,this._callbacks=i,this._paused=!1,this._playedTime=0,this._pausedTs=0,this._lastPausedTs=0,this._lastCheckTime=0,this._lastCheck500Time=0,this._lastCheck500CurrntTime=0}return Object(a.a)(e,[{key:"reset",value:function(){this._paused=!1,this._playedTime=0,this._pausedTs=0,this._lastPausedTs=0,this._lastCheckTime=0,this._lastCheck500Time=0}},{key:"check",value:function(){var e=S.a.now(),t=this._mse.video.video;0!=this._lastCheckTime&&1==Number(localStorage._printPauseCheck)&&v.a.log("MSEPause.check",e-this._lastCheckTime,t.currentTime),!this._mse.isLive&&t.currentTime<=1||(this._mse.isLive||!this._mse.handler||this._mse.handler.started)&&(0!==this._playedTime&&(t.currentTime===this._playedTime?this._paused?this._fixedCurrentTime(e,t):this._setPaused(e,t):this._paused&&this._setResume(e,t)),this._playedTime=t.currentTime,this._lastCheckTime=e)}},{key:"_setPaused",value:function(e,t){this._paused=!0,this._pausedTs=e,this._lastPausedTs=e,this._log("_setPaused",t),this._callbacks.pause(e)}},{key:"_setResume",value:function(e,t){var i=e-this._pausedTs;this._paused=!1,this._pausedTs=0,this._lastPausedTs=0,this._log("_setResume",t),this._callbacks.resume(e,i)}},{key:"_fixedCurrentTime",value:function(e,t){e-this._lastPausedTs>500&&(this._fixedByBuffered(t)||this._fixedByDts(t))&&(this._lastPausedTs=e)}},{key:"_fixedByBuffered",value:function(e){if("flv"===this._mse.videoType){var t=e.buffered.length;if(t>0){var i=e.buffered.start(t-1),s=e.buffered.end(t-1);if(i>e.currentTime&&s-i>1)return this._log("_fixedByBuffered",e),e.currentTime=i,!0}}else if("ts"===this._mse.videoType&&!this._mse.isLive){var r=((this._mse.handler||{}).playlist||{}).currFrag,a=2;r&&(a=r.duration);for(var n=e.buffered.length,o=0;o<n;o++){var h=e.buffered.start(o),u=e.buffered.end(o);if(o>=1&&e.buffered.end(o-1)-e.currentTime<=1&&h>e.currentTime&&h<=e.currentTime+a&&u-h>1)return v.a.log("%cMSEPause.fixedByBuffered currentTime=".concat(e.currentTime," fixed time=").concat(h),"color:#A23400;background:#FFF5C2"),e.currentTime=h,!0}}return!1}},{key:"_fixedByDts",value:function(e){return!!(this._mse.getBufferLen()>2e3&&this._mse.isLive)&&(this._log("_fixedByDts",e),e.currentTime+=1,!0)}},{key:"_log",value:function(e,t,i){this._mse.video.printBuffered();var s=this._mse.getBufferLen();"ts"===this._mse.videoType&&!this._mse.isLive&&this._mse.handler&&(s=this._mse.handler.getBufferLen()),v.a.log("MSEPause(".concat(this._mse._num_,").").concat(e," readyState=").concat(t.readyState," currentTime=").concat(t.currentTime," buf=").concat(s," dts=").concat(this._mse.getCurrentDts()," ").concat(i||""))}},{key:"paused",get:function(){return this._paused}},{key:"pausedTs",get:function(){return this._pausedTs}}]),e}(),Cs={CODE:21,PRIORITY:2},ws=new(function(){function e(){Object(s.a)(this,e),this._hlsPlayer=null,this._m3u8Status=0,this._m3u8Loader=null,this._firstTs=null,this._firstFragStatus=0,this._mp4Status=0}return Object(a.a)(e,[{key:"setHlsPlayer",value:function(e){this._hlsPlayer=e}},{key:"setM3u8Loader",value:function(e){this._m3u8Loader=e}},{key:"setM3u8Status",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;v.a.log("VodNoPictureHelper.setM3u8Status status: ",e),this._m3u8Status=e}},{key:"getM3u8Status",value:function(){if(0!==this._m3u8Status||!this._m3u8Loader)return this._m3u8Status;var e=this._m3u8Loader.getLoaderHandler();return e?(e.status>=200&&e.status<300&&4===e.readyState?this._m3u8Status=1:e.status>=200&&e.status<300&&e.readyState<4?this._m3u8Status=-4:e.status>=300?this._m3u8Status=-1:0===e.status&&4===e.readyState?this._m3u8Status=-2:this._m3u8Status=-3,this._m3u8Status):this._m3u8Status}},{key:"getM3u8Reason",value:function(){var e=0;switch(this.getM3u8Status()){case-1:e=101;break;case-2:e=102;break;case-4:e=104;break;case-3:e=103}return e}},{key:"setFirstTs",value:function(e){this._firstTs=e}},{key:"setFirstFragStatus",value:function(e){v.a.log("VodNoPictureHelper.setFirstFragStatus status: ",e),this._firstFragStatus=e}},{key:"getFirstFragStatus",value:function(){return this._firstFragStatus}},{key:"getTsReason",value:function(){var e=0;switch(this._firstFragStatus){case 1:e=106;break;case-1:e=105;break;case-2:e=106;break;case 2:e=107;break;case-3:e=108;break;case 3:case 4:this._hlsPlayer&&(e=this._hlsPlayer.getBufferLen()<=200?109:110);break;case-4:e=111}return e}},{key:"getHlsNoPictureReason",value:function(){var e=0;return(this._firstTs||0===(e=this.getM3u8Reason()))&&(e=this.getTsReason()),0===e&&(e=112),v.a.log("VodNoPictureHelper.getHlsNoPictureReason reason: ",e),e}},{key:"setMP4Status",value:function(e){this._mp4Status=e}},{key:"getMP4NoPictureReason",value:function(){var e=0;switch(this._mp4Status){case 1:e=113;break;case-1:e=114}return 0===e&&(e=115),v.a.log("VodNoPictureHelper.getMP4NoPictureReason reason: ",e),e}}]),e}()),Is=function(){function e(){Object(s.a)(this,e),this.emptyTs=0,this.emptyTime=0,this.emptyCnt=0,this.aiEmptyTime=0,this.aiEmptyCnt=0}return Object(a.a)(e,[{key:"reset",value:function(){this.emptyTs=0,this.emptyTime=0,this.emptyCnt=0}},{key:"getStats",value:function(){var e={emptyTime:this.emptyTime,emptyCnt:this.emptyCnt};return this.emptyTime=0,this.emptyCnt=0,e}},{key:"getAiStats",value:function(){var e={aiEmptyTime:this.aiEmptyTime,aiEmptyCnt:this.aiEmptyCnt};return this.aiEmptyTime=0,this.aiEmptyCnt=0,e}},{key:"checkBuffer",value:function(e,t){t<200&&0===this.emptyTs?this.emptyTs=e:t>500&&this.emptyTs>0&&(this.emptyTime+=e-this.emptyTs,this.aiEmptyTime+=e-this.emptyTs,this.emptyTs=0,this.emptyCnt++,this.aiEmptyCnt++)}}]),e}(),As=function(){function e(t){Object(s.a)(this,e),this._handler=t,this._cnt=0,this._duration=0,this._pauseTs=0,this._aiCnt=0,this._aiDuration=0,this._aiAutoCnt=0,this._aiAutoDuration=0,this._videoBlockBufferList=[],this._videoBlockContinueList=[],this._blockBadDurationList=[],this._blockBadContinueBufferList=[],this._autoReportProps=null}return Object(a.a)(e,[{key:"reset",value:function(){this.resetStat(),this.resetAiStat(),this.resetAutoAiStat(),this._pauseTs=0,this._autoReportProps=null}},{key:"getCnt",value:function(){return this._cnt}},{key:"resetStat",value:function(){this._cnt=0,this._duration=0,this._videoBlockBufferList.length=0,this._videoBlockContinueList.length=0}},{key:"pause",value:function(){0===this._pauseTs&&(this._pauseTs=S.a.now()),this.getAutoReportProps(),this._handler&&(this._videoBlockBufferList.push(this._handler.getBufferLen()),this._videoBlockContinueList.push(this._handler.getVideoContinueBuffer()))}},{key:"resume",value:function(){this.calc(!0)}},{key:"calc",value:function(e){if(this._pauseTs>0){var t=S.a.now(),i=t-this._pauseTs;i>=200&&(this._cnt++,this._aiCnt++,this._aiAutoCnt++,this._duration+=i,this._aiDuration+=i,this._aiAutoDuration+=i,this._blockBadDurationList.push(i),this._blockBadContinueBufferList.push(this._handler.getBufferLen())),i>=f.a.blockBadCfg[0]&&this.setBlockBad(i),e?this._pauseTs=0:(this._pauseTs=t,this.getAutoReportProps())}}},{key:"resetAiStat",value:function(){this._aiCnt=0,this._aiDuration=0}},{key:"resetAutoAiStat",value:function(){this._aiAutoCnt=0,this._aiAutoDuration=0,this._blockBadDurationList.length=0,this._blockBadContinueBufferList.length=0}},{key:"getAiStat",value:function(){var e={aiCnt:this._aiCnt,aiDuration:this._aiDuration};return this.resetAiStat(),e}},{key:"getAiAutoStat",value:function(){var e={aiAutoCnt:this._aiAutoCnt,aiAutoDuration:this._aiAutoDuration,aiAutoBlockBadDurationList:Di(this._blockBadDurationList),aiAutoBlockBadContinueBufferList:Di(this._blockBadContinueBufferList)};return this.resetAutoAiStat(),e}},{key:"record",value:function(e){this.calc(!1),e.setCore(g.a.CORE.VIDEO_BLOCK_COUNT,this._cnt),e.setCore(g.a.CORE.VIDEO_BLOCK_DURATION,this._duration),this.performanceCalc(e),this.resetStat()}},{key:"performanceCalc",value:function(e){var t=this,i=f.a.perfBlockCfg[0],s=0,r=0;this._videoBlockBufferList.map((function(e,a){var n=t._videoBlockContinueList[a];e>i?(n>i&&r++,s++):n>f.a.perfBlockCfg[1]&&(s++,r++)})),v.a.log("PauseStat.performanceCalc, continueBufferCnt=".concat(r,",bufferCnt=").concat(s,",perfBlockCnt=").concat(this._handler.perfBlockCnt)),this._handler.perfBlockCnt>0&&(r+=this._handler.perfBlockCnt,s+=this._handler.perfBlockCnt),e.setCore(g.a.CORE.VIDEO_PERFPAUSE_CONTINUE_CNT,r),e.setCore(g.a.CORE.VIDEO_PERFPAUSE_CNT,s),this._handler.resetPerfBlockCnt()}},{key:"recordSam",value:function(e){var t=e.length,i=[];if(t>0){i.push("size:".concat(t));for(var s=0;s<t;s++)i.push("k".concat(t-s,":").concat(e[s]))}return i.join(",")}},{key:"getAutoReportProps",value:function(){this._handler.handler&&this._handler.handler.getAutoProps&&(this._autoReportProps=this._handler.handler.getAutoProps())}},{key:"setBlockBad",value:function(e){var t=Math.floor(100*f.a.blockBadCfg[1]);if(!(Math.floor(100*Math.random())>t)){var i=this._handler.handler._hyPlayer.stat,s=this._handler.handler._hyPlayer.tsdbUtil,r=this._autoReportProps;if(r){var a=[e],n=["",r.videoBuffers,"",r.blockDurationSample,r.continueBufferSample,r.realKbpsSample,"",r.recvFps],o=i.createAct(g.a.ACT.BLOCK_BAD,{value:a,str:n});v.a.log("PauseStat.setBlockBad getAutoProps metric=",o),s.sendMetrics([o])}}}}]),e}(),Rs=[95,112,101,114,102],ks=function(){function e(){Object(s.a)(this,e),this.bitrate=4e3,this.blockCount=1,this.continueBuffer=2e3,this.map=new Map,this.key="",this._initKey(),this._initLocal()}return Object(a.a)(e,[{key:"_initKey",value:function(){for(var e=0;e<Rs.length;e++)this.key+=String.fromCharCode(Rs[e])}},{key:"setConfig",value:function(e){this.bitrate=e.perfBitrate||4e3,this.blockCount=e.perfCnt||1,this.continueBuffer=e.perfBuf||2e3}},{key:"_initLocal",value:function(){if(localStorage.hasOwnProperty(this.key)){for(var e=localStorage[this.key].split(","),t="",i=!0,s=0;s<e.length;s++){var r=Number(e[s]);if(isNaN(r)){i=!1;break}t+=String.fromCharCode(Number(e[s]))}i&&t.length>0&&this._parseLocal(t)}}},{key:"_parseLocal",value:function(e){for(var t=e.split("|"),i=0;i<t.length;i++){var s=t[i].split(":"),r=Number(s[0]),a=s[1].split(",");this.map.set(r,a)}}},{key:"checkLocal",value:function(e,t){if(e=Number(e),this.map.has(e)){var i=this.map.get(e);return this._hasBitrate(i,t)}return!1}},{key:"checkLive",value:function(e,t,i,s){if(e=Number(e),t>=this.bitrate&&i>this.blockCount&&s>this.continueBuffer){var r=this.map.get(e);if(r||(r=[],this.map.set(e,r)),!this._hasBitrate(r,t))return r.push(t),this._saveMap(),v.a.log("PausePerformance.checkLive pid=".concat(e," bitrate=").concat(t)),!0}return!1}},{key:"_hasBitrate",value:function(e,t){for(var i=0;i<e.length;i++)if(Number(t)===Number(e[i]))return!0;return!1}},{key:"_saveMap",value:function(){var e,t=[],i=I(this.map.entries());try{for(i.s();!(e=i.n()).done;){var s=oe(e.value,2),r=s[0],a=s[1];t.push(r+":"+a.join(","))}}catch(e){i.e(e)}finally{i.f()}if(t.length>0){for(var n=t.join("|"),o=[],h=0;h<n.length;h++)o.push(n.charCodeAt(h));localStorage[this.key]=o.join(",")}}}]),e}(),bs=function(){function e(){Object(s.a)(this,e),this.startDts=0,this.endDts=0,this.endFrameId=0}return Object(a.a)(e,[{key:"isDisconnectDts",value:function(e){return this.endDts>0&&e-this.endDts>200}},{key:"isDisconnectFrame",value:function(e){return this.endFrameId>0&&e-this.endFrameId!=1}},{key:"getContinueBuffer",value:function(e){return e>=this.startDts&&e<=this.endDts?this.endDts-e:0}},{key:"addBuffer",value:function(e,t){0===this.startDts&&(this.startDts=t),this.endDts=t,this.endFrameId=e}}]),e}(),Ds=function(){function e(){Object(s.a)(this,e),this._frameId=0,this._lastFrameId=0,this._startFrameId=0}return Object(a.a)(e,[{key:"reset",value:function(){this._frameId=0,this._lastFrameId=0,this._startFrameId=0}},{key:"setStartFrameId",value:function(e){this._startFrameId=e,this._lastFrameId=this._frameId}},{key:"getFrameId",value:function(e,t){return 0===e?(this._frameId++,t>0&&this._frameId++):(t>0&&this._lastFrameId++,this._frameId=this._lastFrameId+(e-this._startFrameId+1)),this._frameId}}]),e}(),Os=function(){function e(){Object(s.a)(this,e),this._mse=null,this._list=[],this._dtsList=[],this._tsList=[],this._currentBuffered=null,this._continueBuffer=-1,this._lastFrameTs=0,this._startTs=0,this._started=!1,this._lastRemoveTs=0,this._deltaStart=Number(f.a.continueBufferDeltaStart)||6e3,this._deltaEnd=Number(f.a.continueBufferDeltaEnd)||3e3,this._localFrameId=new Ds,this._printContinueBuffer=1==localStorage._printContinueBuffer}return Object(a.a)(e,[{key:"setMse",value:function(e){this._mse=e}},{key:"stop",value:function(){v.a.log("VideoBufferedList.stop"),this._startTs=0,this._list.length=0,this._dtsList.length=0,this._continueBuffer=-1,this._currentBuffered=null,this._localFrameId.reset(),Q.remove(this.onCheckFastTimer,this)}},{key:"printInfo",value:function(e){var t=[];this._list.forEach((function(e){t.push("[".concat(e.startDts,", ").concat(e.endDts,"]"))})),v.a.log("VideoBufferedList.print dts=".concat(e," buffered=").concat(t.join(" ")))}},{key:"record",value:function(e){this._calc(S.a.now(),ci),e.setCore(g.a.CORE.VIDEO_CONTINUE_BUFFER,this.getVideoContinueBuffer()),this._continueBuffer=-1}},{key:"start",value:function(){0===this._startTs&&(v.a.log("VideoBufferList.start"),this._startTs=S.a.now(),Q.add(this.onCheckFastTimer,this,50))}},{key:"onCheckFastTimer",value:function(e){if(0===this._lastRemoveTs)this._lastRemoveTs=e;else if(this._lastRemoveTs>0&&e-this._lastRemoveTs>5e3){this._lastRemoveTs=e;for(var t=this._mse.getCurrentDts()-2e4,i=this._dtsList.length-1;i>=0;i--)if(this._dtsList[i]<t){this._dtsList=this._dtsList.slice(i),this._tsList=this._tsList.slice(i);break}}var s=e-this._lastFrameTs;this._lastFrameTs>0&&s>100&&(this._calc(e,di),this._lastFrameTs=e)}},{key:"addSample",value:function(e,t,i,s){var r=S.a.now();this._tsList.push(r),this._dtsList.push(t),(0===this._lastFrameTs||i)&&this._localFrameId.setStartFrameId(e),this._lastFrameTs=r;var a=this._localFrameId.getFrameId(e,s);this._currentBuffered&&!this._currentBuffered.isDisconnectFrame(a)||(this._currentBuffered=new bs,this._list.push(this._currentBuffered),this._list.length>10&&t-this._list[0].endDts>3e5&&this._list.shift()),this._currentBuffered.addBuffer(a,t)}},{key:"_calc",value:function(e,t){var i=e-this._deltaStart,s=e-this._deltaEnd;if((t===ci||t===pi)&&-1===this._continueBuffer)return this._continueBuffer=this._getContinueBuffer(this._mse.getCurrentDts()),void(this._printContinueBuffer&&this.printInfo(this._mse.getCurrentDts()+" continueBuffer=".concat(this._continueBuffer," from=").concat(t," ")));if(!(0===this._startTs||i<this._startTs)){for(var r=this._getDtsBound(i,s),a=r.startDts,n=r.endDts,o=Number.MAX_SAFE_INTEGER,h=this._dtsList.length,u=0;u<h;u++){var l=this._dtsList[u];if(l>n)break;if(l>=a&&l<=n&&(o=Math.min(o,this._getContinueBuffer(l))),0===o)break}o===Number.MAX_SAFE_INTEGER&&(o=0),(-1===this._continueBuffer||this._continueBuffer>o)&&(this._continueBuffer=o,this._printContinueBuffer&&this.printInfo(this._mse.getCurrentDts()+" now=".concat(e," startDts=").concat(a," endDts=").concat(n," continueBuffer=").concat(o," from=").concat(t)))}}},{key:"_getDtsBound",value:function(e,t){for(var i=this._tsList.length,s=Number.MAX_SAFE_INTEGER,r=0,a=0;a<i;a++){var n=this._tsList[a];if(n>=e&&n<=t){var o=this._dtsList[a];o<s&&(s=o),o>r&&(r=o)}else if(n>t)break}return{startDts:s,endDts:r}}},{key:"_getContinueBuffer",value:function(e){for(var t=0,i=0;i<this._list.length&&0===(t=this._list[i].getContinueBuffer(e));i++);return t}},{key:"getVideoContinueBuffer",value:function(){var e=0;if(this._mse&&this._mse.getCurrentDts){var t=this._mse.getCurrentDts();e=this._getContinueBuffer(t)}return e}},{key:"continueBuffer",get:function(){return this._continueBuffer},set:function(e){this._continueBuffer=e}}]),e}(),Fs=function(){function e(t){Object(s.a)(this,e),this.seiList=[],this.player=t,this.lastTs=-1,this.internal=10,this.timerStart=!1}return Object(a.a)(e,[{key:"add",value:function(e,t){var i=this.seiList.length;if(this.seiList.length>0)for(i=this.seiList.length-1;i>0&&!(e>this.seiList[i].timeStamp);i--);this.seiList.splice(i+1,0,{timeStamp:e,data:t}),this.timerStart||(this.timerStart=!0,setTimeout(this.checkDispatchSei.bind(this),this.internal))}},{key:"checkDispatchSei",value:function(){if(this.timerStart){for(var e=this.player.getCurrentRealTime(),t=0,i=null;t<this.seiList.length-2;){if(e>=this.seiList[t].timeStamp&&this.seiList[t+1].timeStamp>e){i=this.seiList[t+1].data,this.player.onH264Sei(i,this.seiList[t+1].timeStamp),this.seiList.splice(0,t+1);break}t++}setTimeout(this.checkDispatchSei.bind(this),this.internal)}}},{key:"reset",value:function(){this.seiList=[],this.player=null,this.lastTs=-1,this.timerStart=!1}}]),e}(),Ls=function(){function e(t){Object(s.a)(this,e),this.volumeList=[],this.player=t,this.lastTs=-1,this.internal=100,this.timerStart=!1,this.dispatchMap=new Map}return Object(a.a)(e,[{key:"addMixAudio",value:function(e,t){if(e.length>0)for(var i=e.split(","),s=0;s<i.length;s++)this.add(t,i[s])}},{key:"add",value:function(e,t){var i=this.volumeList.length;if(this.volumeList.length>0)for(i=this.volumeList.length-1;i>0&&!(e>this.volumeList[i].timeStamp);i--);this.volumeList.splice(i+1,0,{timeStamp:e,data:t}),this.timerStart||(this.timerStart=!0,setTimeout(this.checkDispatchVolume.bind(this),this.internal))}},{key:"checkDispatchVolume",value:function(){var e=this;if(this.timerStart){var t=this.player.getCurrentRealTime(),i=0;for(this.dispatchMap.clear();this.volumeList[i]&&this.volumeList[i].timeStamp<t;){var s=this.volumeList[i].data.split("_");s.length>1&&this.dispatchMap.set(s[0],s[1]),i++}this.dispatchMap.forEach((function(t,i,s){e.player.onScriptVolumeInfo(i,t)})),this.dispatchMap.clear(),this.volumeList.splice(0,i),this.volumeList.length>0?setTimeout(this.checkDispatchVolume.bind(this),this.internal):this.timerStart=!1}}},{key:"reset",value:function(){this.volumeList=[],this.player=null,this.lastTs=-1,this.timerStart=!1}}]),e}(),Bs=function(){function e(){Object(s.a)(this,e)}return Object(a.a)(e,null,[{key:"init",value:function(){var t;for(t in e.types={av01:[],av1C:[],avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var i=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),s=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:i,audio:s};var r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),a=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=a,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var n=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),h=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,n,h,n,o),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,r))}},{key:"box",value:function(e){for(var t,i=Array.prototype.slice.call(arguments,1),s=8,r=i.length,a=r;r--;)s+=i[r].byteLength;for((t=new Uint8Array(s))[0]=s>>24&255,t[1]=s>>16&255,t[2]=s>>8&255,t[3]=255&s,t.set(e,4),r=0,s=8;r<a;r++)t.set(i[r],s),s+=i[r].byteLength;return t}},{key:"hdlr",value:function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])}},{key:"mdat",value:function(t){return e.box(e.types.mdat,t)}},{key:"mdhd",value:function(t,i){return e.box(e.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,i>>24,i>>16&255,i>>8&255,255&i,85,196,0,0]))}},{key:"mdia",value:function(t){return e.box(e.types.mdia,e.mdhd(t.timescale,t.duration),e.hdlr(t.type),e.minf(t))}},{key:"mfhd",value:function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}},{key:"minf",value:function(t){return"audio"===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))}},{key:"moof",value:function(t,i,s){return e.box(e.types.moof,e.mfhd(t),e.traf(s,i))}},{key:"moov",value:function(t){for(var i=t.length,s=[];i--;)s[i]=e.trak(t[i]);return e.box.apply(null,[e.types.moov,e.mvhd(t[0].timescale,t[0].duration)].concat(s).concat(e.mvex(t)))}},{key:"mvex",value:function(t){for(var i=t.length,s=[];i--;)s[i]=e.trex(t[i]);return e.box.apply(null,[e.types.mvex].concat(s))}},{key:"mvhd",value:function(t,i){var s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,t>>24&255,t>>16&255,t>>8&255,255&t,i>>24&255,i>>16&255,i>>8&255,255&i,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,s)}},{key:"sdtp",value:function(t){var i,s,r=t.samples||[],a=new Uint8Array(4+r.length);for(s=0;s<r.length;s++)i=r[s].flags,a[s+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return e.box(e.types.sdtp,a)}},{key:"stbl",value:function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))}},{key:"av01",value:function(t){var i=t.bytes,s=t.width,r=t.height;return e.box(e.types.av01,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,s>>8&255,255&s,r>>8&255,255&r,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]),e.box(e.types.av1C,i))}},{key:"avc1",value:function(t){var i,s,r,a=[],n=[];for(i=0;i<t.sps.length;i++)r=(s=t.sps[i]).byteLength,a.push(r>>>8&255),a.push(255&r),a=a.concat(Array.prototype.slice.call(s));for(i=0;i<t.pps.length;i++)r=(s=t.pps[i]).byteLength,n.push(r>>>8&255),n.push(255&r),n=n.concat(Array.prototype.slice.call(s));var o=e.box(e.types.avcC,new Uint8Array([1,a[3],a[4],a[5],255,224|t.sps.length].concat(a).concat([t.pps.length]).concat(n))),h=t.width,u=t.height;return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,h>>8&255,255&h,u>>8&255,255&u,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]),o,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])))}},{key:"hvc1",value:function(t){var i,s,r,a=[],n=[],o=[];for(a.push(160),a.push(t.vps.length>>>8&255),a.push(255&t.vps.length),i=0;i<t.vps.length;i++)r=(s=t.vps[i]).byteLength,a.push(r>>>8&255),a.push(255&r),a=a.concat(Array.prototype.slice.call(s));for(n.push(161),n.push(t.sps.length>>>8&255),n.push(255&t.sps.length),i=0;i<t.sps.length;i++)r=(s=t.sps[i]).byteLength,n.push(r>>>8&255),n.push(255&r),n=n.concat(Array.prototype.slice.call(s));var h=[],u=0;for(i=0;i<n.length;)s=n[i],2!==u||3!==s?(0===s?u++:u=0,h.push(s),++i):(++i,u=0);for(o.push(162),o.push(t.pps.length>>>8&255),o.push(255&t.pps.length),i=0;i<t.pps.length;i++)r=(s=t.pps[i]).byteLength,o.push(r>>>8&255),o.push(255&r),o=o.concat(Array.prototype.slice.call(s));var l=new Uint8Array([1,h[8],h[9],h[10],h[11],h[12],h[13],h[14],h[15],h[16],h[17],h[18],h[19],240,0,252,253,248,248,0,0,15].concat([3]).concat(a).concat(n).concat(o)),d=e.box(e.types.hvcC,l),c=t.width,p=t.height;return e.box(e.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,c>>8&255,255&c,p>>8&255,255&p,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]),d,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])))}},{key:"esds",value:function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))}},{key:"mp4a",value:function(t){var i=t.audiosamplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,i>>8&255,255&i,0,0]),e.box(e.types.esds,e.esds(t)))}},{key:"stsd",value:function(t){return"audio"===t.type?e.box(e.types.stsd,e.STSD,e.mp4a(t)):t.isHevc?e.box(e.types.stsd,e.STSD,e.hvc1(t)):t.isAV01?e.box(e.types.stsd,e.STSD,e.av01(t)):e.box(e.types.stsd,e.STSD,e.avc1(t))}},{key:"tkhd",value:function(t){var i=t.id,s=t.duration,r=t.width,a=t.height;return e.box(e.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,i>>24&255,i>>16&255,i>>8&255,255&i,0,0,0,0,s>>24,s>>16&255,s>>8&255,255&s,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,255&r,0,0,a>>8&255,255&a,0,0]))}},{key:"traf",value:function(t,i){var s=e.sdtp(t),r=t.id;return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r])),e.box(e.types.tfdt,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i])),e.trun(t,s.length+16+16+8+16+8+8),s)}},{key:"trak",value:function(t){return t.duration=t.duration||4294967295,e.box(e.types.trak,e.tkhd(t),e.mdia(t))}},{key:"trex",value:function(t){var i=t.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trun",value:function(t,i){var s,r,a,n,o,h,u=t.samples||[],l=u.length,d=12+16*l,c=new Uint8Array(d);for(i+=8+d,c.set([0,0,15,1,l>>>24&255,l>>>16&255,l>>>8&255,255&l,i>>>24&255,i>>>16&255,i>>>8&255,255&i],0),s=0;s<l;s++)a=(r=u[s]).duration,n=r.size,o=r.flags,h=r.cts,c.set([a>>>24&255,a>>>16&255,a>>>8&255,255&a,n>>>24&255,n>>>16&255,n>>>8&255,255&n,o.isLeading<<2|o.dependsOn,o.isDependedOn<<6|o.hasRedundancy<<4|o.paddingValue<<1|o.isNonSync,61440&o.degradPrio,15&o.degradPrio,h>>>24&255,h>>>16&255,h>>>8&255,255&h],12+16*s);return e.box(e.types.trun,c)}},{key:"initSegment",value:function(t){e.types||e.init();var i,s=e.moov(t);return(i=new Uint8Array(e.FTYP.byteLength+s.byteLength)).set(e.FTYP),i.set(s,e.FTYP.byteLength),i}}]),e}(),Ns=function(){function e(t){Object(s.a)(this,e),this.mse=t,this.audioISGenerated=!1,this.videoISGenerated=!1,this.PES2MP4SCALEFACTOR=1,this.PES_TIMESCALE=9e4,this.MP4_TIMESCALE=this.PES_TIMESCALE/this.PES2MP4SCALEFACTOR,this._forceFirstIDR=!(!E.a.chrome||!(E.a.version.major<50||50===E.a.version.major&&E.a.version.build<2661))}return Object(a.a)(e,[{key:"destroy",value:function(){this.reset()}},{key:"reset",value:function(){this.insertDiscontinuity(),this.switchLevel()}},{key:"resetInitDts",value:function(){this._initPTS=this._initDTS=void 0}},{key:"insertDiscontinuity",value:function(){this.nextAacPts=this.nextAvcDts=void 0}},{key:"getInitDts",value:function(){return void 0!==this._initDTS?this._initDTS/90:void 0}},{key:"switchLevel",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];v.a.log("mp4-remuxer.switchLevel"),e&&(this.videoISGenerated=!1),t&&(this.audioISGenerated=!1)}},{key:"remux",value:function(e,t,i,s){Number(localStorage._printMp4Remux)&&v.a.debug("\n### Audio",e,"\n### Video",t),this.audioISGenerated||this.generateAudioIS(e,i),this.videoISGenerated||this.isWebglRender||this.generateVideoIS(t,i),this.initTs(e,t,i),t.samples.length&&(this.isWebglRender?this.renderVideo(t,s):this.remuxVideo(t,s)),e.samples.length&&this.remuxAudio(e,s),this.mse.onFragParsed()}},{key:"initTs",value:function(e,t,i){if(null==this._initPTS){var s=e.samples,r=t.samples,a=s.length,n=r.length,o=this.PES_TIMESCALE;0===a&&0===n?v.a.warn("mp4-remuxer.initTs have no nbAudio&nbVideo"):0===n?(this._initPTS=s[0].pts-o*i,this._initDTS=s[0].dts-o*i):0===a?(this._initPTS=r[0].pts-o*i,this._initDTS=r[0].dts-o*i):(this._initPTS=Math.min(r[0].pts,s[0].pts)-o*i,this._initDTS=Math.min(r[0].dts,s[0].dts)-o*i),v.a.log("mp4-remuxer initDTS/initPTS=[".concat(this._initDTS,", ").concat(this._initPTS,"]"))}}},{key:"generateAudioIS",value:function(e,t){if(e.config){var i={audioMoov:Bs.initSegment([e]),audioCodec:e.codec,audioChannelCount:e.channelCount};this.mse.onInitSegment(i),this.audioISGenerated=!0}}},{key:"generateVideoIS",value:function(e,t){if(e.isAV01||e.sps&&e.pps){var i={videoMoov:Bs.initSegment([e]),videoCodec:e.codec,videoWidth:e.width,videoHeight:e.height};this.mse.onInitSegment(i),this.videoISGenerated=!0}}},{key:"remuxVideo",value:function(e,t){var i,s,r,a,n,o,h,u,l,d,c,p,f,m,_=8,y=this.PES2MP4SCALEFACTOR,g=[],T=e.isAV01?0:4*e.naluCnt;for(h=new Uint8Array(e.len+T+8),(i=new DataView(h.buffer)).setUint32(0,h.byteLength),h.set(Bs.types.mdat,4);e.samples.length;){for(r=e.samples.shift(),n=0;r.units.length;)s=(o=r.units.shift()).data.byteLength,"av01"!=r.type&&(i.setUint32(_,s),_+=4,n+=4),h.set(o.data,_),_+=s,n+=s;if(c=r.pts-this._initDTS,((p=r.dts-this._initDTS)<0||c<0)&&Number(localStorage._printMp4RemuxVideo)&&v.a.log("mp4-remuxer.remuxVideo warn dts=".concat(p,", pts=").concat(c)),void 0!==d)f=this._PTSNormalize(c,d),m=this._PTSNormalize(p,d),a.duration=(m-d)/y,a.duration<0&&(Number(localStorage._printMp4RemuxVideo)&&v.a.warn("mp4-remuxer.remuxVideo invalid sample duration at pts="+r.pts/90+" dts="+r.dts/90+" duration="+a.duration/90),a.duration=0,m=d);else{var P,E=this.nextAvcDts||p;f=this._PTSNormalize(c,E),m=this._PTSNormalize(p,E),P=Math.round((m-E)/90),(t||Math.abs(P)<600)&&P&&(P>1&&Number(localStorage._printMp4RemuxVideo)?v.a.warn("mp4-remuxer.remuxVideo hole="+P+" filling it"):P<-1&&Number(localStorage._printMp4RemuxVideo)&&v.a.warn("mp4-remuxer.remuxVideo overlapping="+-P+" detected"),m=E,f=Math.max(f-P,m)),Math.max(0,f),l=Math.max(0,m)}var C=r.key;a={size:n,duration:0,cts:(f-m)/y,flags:{isLeading:0,degradPrio:0,hasRedundancy:0,dependsOn:C?2:1,isDependedOn:C?1:0,isNonSync:C?0:1}},g.push(a),d=m,this.mse.isLive&&this.mse.videoPlayConsuming.addRemuxFrameData(r.ts,r.ts+r.cts,S.a.now())}this._forceFirstIDR&&(g[0].flags.dependsOn=2,g[0].flags.isNonSync=0),void 0!==e.endDts?(a.duration=(90*e.endDts-this._initDTS-m)/y,a.duration<0?(a.duration=0,this.nextAvcDts=m):this.nextAvcDts=90*e.endDts-this._initDTS):(g.length>=2&&(a.duration=g[g.length-2].duration),this.nextAvcDts=m+a.duration*y),e.len=0,e.naluCnt=0,e.samples=g,u=Bs.moof(e.sn,l/y,e),e.samples=[];var w={type:"video",data:this._mergeBoxes(u,h)};this.mse.onFragParsing(w)}},{key:"remuxAudio",value:function(e,t){var i,s,r,a,n,o,h,u,l,d,c,p=8,m=this.PES_TIMESCALE,_=this.PES2MP4SCALEFACTOR,y=[];for(a=new Uint8Array(e.len+8),new DataView(a.buffer).setUint32(0,a.byteLength),a.set(Bs.types.mdat,4);e.samples.length;){if(r=(i=e.samples.shift()).unit,a.set(r,p),p+=r.byteLength,u=i.pts-this._initDTS,l=i.dts-this._initDTS,void 0!==h)d=this._PTSNormalize(u,h),c=this._PTSNormalize(l,h),s.duration=(c-h)/_,f.a.popSize0Brows.map((function(e){var t=e[0],r=e[1];E.a.name==t&&E.a.version.major>=r&&(s.duration=90*Math.ceil(i.sampleDuration))})),s.duration<0&&(Number(localStorage._printMp4RemuxAudio)&&v.a.warn("mp4-remuxer.remuxAudio invalid AAC sample duration at PTS="+i.pts+" duration="+s.duration),s.duration=0,d=c=h);else{var g,T=this.nextAacPts||u;d=this._PTSNormalize(u,T),c=this._PTSNormalize(l,T),g=Math.round(1e3*(d-T)/m),(t||Math.abs(g)<600)&&g&&(d=c=T),Math.max(0,d),o=Math.max(0,c)}s={size:r.byteLength,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},y.push(s),h=c,this.mse.isLive&&this.mse.audioPlayConsuming.addRemuxFrameData(i.ts,i.ts,S.a.now())}y.length>=2&&(s.duration=y[y.length-2].duration),this.nextAacPts=d+s.duration*_,e.len=0,e.samples=y,n=Bs.moof(e.sn,o/_,e),e.samples=[];var P={type:"audio",data:this._mergeBoxes(n,a)};this.mse.onFragParsing(P)}},{key:"renderVideo",value:function(e,t){if(this.mse.isLive)for(var i=0;i<e.samples.length;i++){var s=e.samples[i];this.mse.videoPlayConsuming.addRemuxFrameData(s.ts,s.ts+s.cts,S.a.now())}this.mse.h265Proxy.pushVideoFrame(e,t)}},{key:"_mergeBoxes",value:function(e,t){var i=new Uint8Array(e.byteLength+t.byteLength);return i.set(e,0),i.set(t,e.byteLength),i}},{key:"_PTSNormalize",value:function(e,t){var i;if(void 0===t)return e;for(i=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=i;return e}},{key:"timescale",get:function(){return this.MP4_TIMESCALE}},{key:"isWebglRender",get:function(){return this.mse.h265Proxy&&this.mse.h265Proxy.renderInited}}]),e}(),Ms=function(){function e(){Object(s.a)(this,e),this.type=-1,this.sn=0,this.samples=[],this.firstDts=-1e4,this.playDts=0,this.lastSampleDts=0,this.setPlayDtsCallback=null}return Object(a.a)(e,[{key:"getInfo",value:function(){return"size=".concat(this.samples.length,"=[").concat(this.samples.length>0?this.samples[0].ts:0,", ").concat(this.samples.length>0?this.samples[this.samples.length-1].ts:0,"]")}},{key:"destroy",value:function(){this.samples=[]}},{key:"clear",value:function(){this.samples=[],this.firstDts=-1e4,this.playDts=0,this.lastSampleDts=0}},{key:"addSample",value:function(e,t){if(this.lastSampleDts>0){var i=e.ts-this.lastSampleDts;(i>100||i<-100)&&v.a.warn("BufferFrame.addSample type=".concat(this.type," isShield=").concat(t," dis=").concat(i," lastDts=").concat(this.lastSampleDts," curDts=").concat(e.ts))}return this.lastSampleDts=e.ts,this.samples.push(e),this._setFirstDts(e.ts),e.ts-this.playDts}},{key:"_setFirstDts",value:function(e){-1e4===this.firstDts&&(this.firstDts=e,this.playDts=e,this.setPlayDtsCallback&&this.setPlayDtsCallback())}},{key:"_createTrack",value:function(t){return{type:t,id:t===e.TYPES.video?1:2,sn:0,samples:[],len:0,duration:0,startDts:-1,endDts:0,naluCnt:0}}},{key:"getTrack",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this._createTrack(this.type),s=this._fillTrack(i,e,t);return s>0&&this.samples.splice(0,s),i.endDts>0&&(i.playDts=this.playDts,i.sn=this.sn,this.sn++),i}},{key:"_fillTrack",value:function(e,t,i){return 0}},{key:"_addTrack",value:function(e,t){e.samples.push(t),-1===e.startDts&&(e.startDts=t.ts),e.endDts=t.ts,t.av1Bytes&&(e.bytes=t.av1Bytes)}},{key:"getBufferLen",value:function(){var e=this.samples.length;if(e>1){var t=this.samples[0];return this.samples[e-1].ts-t.ts}return 0}},{key:"getSize",value:function(){return this.samples.length}},{key:"removeExpireBuffer",value:function(e,t){var i=this;this.samples=this.samples.filter((function(s){if(s.ts>=e-i.aacTimeLen)return s;1===Number(localStorage._printAVTrack)&&2==t&&v.a.log("BufferFrame.removeExpireBuffer, sample.ts=".concat(s.ts,", videoDts=").concat(e))})),this.samples.length>0&&(this.playDts=this.samples[0].ts)}},{key:"recoverBuffer",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];t.length<=0||(this.playDts=t[0].ts,(e=this.samples).splice.apply(e,[0,0].concat(Di(t))))}}]),e}();Ms.TYPES={video:"video",audio:"audio"};var Us=Ms,Vs=function(e){Object(M.a)(i,e);var t=Object(U.a)(i);function i(){var e;return Object(s.a)(this,i),(e=t.call(this)).type=Us.TYPES.video,e}return Object(a.a)(i,[{key:"_setFirstDts",value:function(e){-1e4===this.firstDts&&v.a.log("BufferFrameVideo._setFirstDts=".concat(e)),N(Object(B.a)(i.prototype),"_setFirstDts",this).call(this,e)}},{key:"_fillTrack",value:function(e,t,i){for(var s=0,r=this.samples.length,a=this.playDts+t,n=0;n<r;n++){var o=this.samples[n];if(o.ts>=a){e.endDts=o.ts;break}s++,this._addTrack(e,o)}return e.endDts>0&&(this.playDts=e.endDts),s}},{key:"_addTrack",value:function(e,t){N(Object(B.a)(i.prototype),"_addTrack",this).call(this,e,t),e.naluCnt+=t.units.length,e.len+=t.len}}]),i}(Us),xs=function(){function e(){Object(s.a)(this,e)}return Object(a.a)(e,null,[{key:"getSilentFrame",value:function(e,t){if(2===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null}},{key:"setWebcodeccEmptyFrame",value:function(t){e.webcodeccEmptyFrame=t.toLocaleString().split(",")}}]),e}();xs.emptyAacFrameAdts=[255,241,92,64,18,64,252,0,208,32,6,238,90,119,128,0,128,0,0,0,0,26,37,65,0,13,237,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,28],xs.emptyAacFrame=[0,208,32,6,238,90,119,128,0,128,0,0,0,0,26,37,65,0,13,237,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,28],xs.emptyAacFrame_44_1=[1,64,34,128,163,78,129,64,0,0,0,0,4,96,6,246,81,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94],xs.webcodeccEmptyFrame=null;var Hs=xs,Ws=function(e){Object(M.a)(i,e);var t=Object(U.a)(i);function i(e,r){var a;return Object(s.a)(this,i),(a=t.call(this)).shieldType=e,a.type=Us.TYPES.audio,a.needEmptyAudioFrame=!0,a.isPureAudio=!1,a.lastAacTs=0,a.webcodecType=r,a.webcodecsEmptyFrameInited=!1,a.audioObjectType=5,a.audioChannelCount=1,a.audioSampleRate=22050,a.aacTimeLen=1024e3/a.audioSampleRate,a.aacEmptyDuration=0,a}return Object(a.a)(i,[{key:"addSample",value:function(e,t){return this.webcodecType!=V.a.PLAYER_CORE_TYPE.WEBCODECS||this.webcodecsEmptyFrameInited||(this.webcodecsEmptyFrameInited=!0,Hs.setWebcodeccEmptyFrame(e.unit)),e.empty=0,e.ts>this.playDts-this.aacTimeLen?N(Object(B.a)(i.prototype),"addSample",this).call(this,e,t):(v.a.log("BufferFrameAudio.addSample audio late dts=".concat(e.ts," platDts=").concat(this.playDts)),0)}},{key:"_setFirstDts",value:function(e){0===this.firstDts&&v.a.log("BufferFrameAudio._setFirstDts=".concat(e)),this.playDts>0&&0===this.firstDts&&e>this.playDts&&e-this.playDts<this.aacTimeLen&&(v.a.log("BufferFrameAudio._setFirstDts resetPlayDts ".concat(this.playDts," to ").concat(e)),this.playDts=e),N(Object(B.a)(i.prototype),"_setFirstDts",this).call(this,e)}},{key:"alignPlayDts",value:function(e){if(0===this.playDts)v.a.log("BufferFrameAudio.alignPlayDts videoPlayDts=".concat(e)),this.playDts=e;else if(e>this.playDts){var t=this.playDts;this.playDts=e;for(var i=0;this.samples.length>0&&this.samples[0].ts<e;)i++,this.samples.shift();v.a.log("BufferFrameAudio.alignPlayDts audioPlayDts=".concat(t," to ").concat(e,", clear samples=").concat(i))}}},{key:"_fillTrack",value:function(e,t,i){for(var s=t,r=this.playDts+this.aacTimeLen,a=0,n=0,o=0,h=this.samples.length,u=0;r<s;){var l=this.samples[a];if(u=Math.round(r),l&&l.ts<=u)a++,o++,this._fixDts(l,u),this._addTrack(e,l);else if(!this.isPureAudio&&this.needEmptyAudioFrame){n++;var d={unit:null,pts:0,dts:0,ts:0,empty:1};this.webcodecType==V.a.PLAYER_CORE_TYPE.WEBCODECS&&null!=Hs.webcodeccEmptyFrame?d.unit=new Uint8Array(Hs.webcodeccEmptyFrame):22050===this.audioSampleRate&&2===this.audioObjectType?d.unit=new Uint8Array(Hs.emptyAacFrame):d.unit=Hs.getSilentFrame(this.audioObjectType,this.audioChannelCount),this._fixDts(d,u),this._addTrack(e,d),this.aacEmptyDuration+=this.aacTimeLen}if(!i&&h>1&&a>=h||r+this.aacTimeLen>=s)break;r+=this.aacTimeLen}return e.emptyFrames=n,this.playDts=r,n>0&&v.a.log("BufferFrameAudio add empty frames ".concat(n,", shieldType=").concat(this.shieldType," playDts=").concat(this.playDts," sampleTs=").concat(this.samples[a-1]?this.samples[a-1].ts:0," endDts=").concat(s)),o}},{key:"hasPushBuffer",value:function(e){return!(e-this.playDts>f.a.shieldAudioCfg[4])}},{key:"_fixDts",value:function(e,t){e.pts=e.dts=90*t,e.ts=t}},{key:"_addTrack",value:function(e,t){t.unit&&(N(Object(B.a)(i.prototype),"_addTrack",this).call(this,e,t),e.len+=t.unit.length)}},{key:"getEmptyeDuration",value:function(){var e=this.aacEmptyDuration;return this.aacEmptyDuration=0,e}}]),i}(Us),Gs=function(){function e(t,i,r){Object(s.a)(this,e),this.popSize=t.bufferSize+t.popDuration,this.waitSize=t.waitSize||2e3,this.popDuration=t.popDuration,this.timescale=t.timescale,this.isPureAudio=t.isPureAudio,this.isPureVideo=t.isPureVideo,this.webcodecType=t.webcodecType,this.remuxCb=i,this.ctrlBuffer=r,this.popMode=0,this.avcChange=!1,this.inited=!0,this.hasOriginIFrame=!1,this.hasRemux=!1,this.gop=f.a.maxGop,this.lastKeyFrameDts=0,this.paused=!1,this.switchedShieldAudio=!1,this.isShieldAudio=!1,this.isAShieldFirstPop=!1,this.shieldAudioWaitSize=200,this.startShieldTs=0,this.firstVideoTs=0,this.firstAudioTs=0,this.firstShieldAudioTs=0,this.isShieldFastToAlign=0,this.firstPrintVideo=!1,this.firstPrintAudio=!1,this.isSwitchShieldFailed=!1,this.videoConfig={isHevc:!1,vps:null,sps:null,pps:null,codec:"",width:0,height:0},this.audioConfig={config:null,codec:"mp4a.40.5",audioSampleRate:22050,aacTimeLen:1024e3/22050,audioObjectType:5,audioChannelCount:1},this.shieldAudioConfig={config:null,codec:"mp4a.40.5",audioSampleRate:22050,aacTimeLen:1024e3/22050,audioObjectType:5,audioChannelCount:1},this.vBuffer=new Vs,this.vBuffer.setPlayDtsCallback=this.setVideoPlayDts.bind(this),this.aBuffer=new Ws(1,this.webcodecType),this.aShieldBuffer=new Ws(2,this.webcodecType),this.aBuffer.isPureAudio=this.isPureAudio,this.aShieldBuffer.isPureAudio=this.isPureAudio,this._switchShieldTimeoutBind=this._switchShieldTimout.bind(this)}return Object(a.a)(e,[{key:"_updateGop",value:function(e){!e.key||this.hasOriginIFrame&&!e.origin_iframe||(this.lastKeyFrameDts>0&&(this.gop=Math.min(f.a.maxGop,e.ts-this.lastKeyFrameDts)),this.lastKeyFrameDts=e.ts)}},{key:"updateVideoConfig",value:function(e,t){this.videoConfig=e,this.avcChange=t,this.firstPrintVideo=!1,this.firstPrintAudio=!1}},{key:"updateAudioConfig",value:function(e,t,i){1==t?(v.a.log("BufferAV.updateAudioConfig.common, first=".concat(i),JSON.stringify(e)),this.audioConfig=e,this.aBuffer.audioSampleRate=e.audiosamplerate,this.aBuffer.aacTimeLen=e.aacTimeLen,this.aBuffer.audioObjectType=e.audioObjectType,this.aBuffer.audioChannelCount=e.audioChannelCount):(t=2)&&(v.a.log("BufferAV.updateAudioConfig.shield, first=".concat(i),JSON.stringify(e)),this.shieldAudioConfig=e,this.aShieldBuffer.audioSampleRate=e.audiosamplerate,this.aShieldBuffer.aacTimeLen=e.aacTimeLen,this.aShieldBuffer.audioObjectType=e.audioObjectType,this.aShieldBuffer.audioChannelCount=e.audioChannelCount)}},{key:"destroy",value:function(){this.firstVideoTs=0,this.firstAudioTs=0,this.firstShieldAudioTs=0,this.remuxCb=null,this.hasRemux=!1,this.switchedShieldAudio=!1,this.isAShieldFirstPop=!1,this.isShieldFastToAlign=!1,this.vBuffer.destroy(),this.aBuffer.destroy(),this.aShieldBuffer.destroy(),Q.remove(this._switchShieldTimeoutBind,this)}},{key:"clearShieldAudio",value:function(){this.aShieldBuffer.clear(),this.switchedShieldAudio=!1}},{key:"addSample",value:function(t){this.inited=!1,t.type===e.TYPES.avc||t.type===e.TYPES.av01?this._addSampleVideo(t):t.type===e.TYPES.aac&&this._addSmapleAudio(t)}},{key:"switchShieldAudio",value:function(e){v.a.log("BufferAV.switchShieldAudio, yes=".concat(e)),this.isShieldAudio=e,e?(this.isStartShieldAudio=!1,this.startShieldTs=0,this.isFirstShieldAvc=!1,this.isFirstDelteShieldAac=!1,this.isAShieldFirstPop=!1,this.isShieldFastToAlign=!1,this.isSwitchShieldFailed=!1,Q.once(this._switchShieldTimeoutBind,this,f.a.shieldAudioCfg[2])):(Q.remove(this._switchShieldTimeoutBind,this),this.switchedShieldAudio&&this.clearShieldAudio())}},{key:"_switchShieldTimout",value:function(){this._switchShieldAudioFailed(1);var e=this.aShieldBuffer.samples.length,t=this.vBuffer.samples.length;v.a.warn("BufferAv._switchShieldTimout, shieldBuffelen=".concat(e,", vBufferLen=").concat(t,", firstVideoTs=").concat(this.firstVideoTs,", firstAudioTs=").concat(this.firstAudioTs,", firstShieldAudioTs=").concat(this.firstShieldAudioTs)),e>0&&v.a.warn("BufferAv._switchShieldTimout, aStart=".concat(this.aShieldBuffer.samples[0].ts,", aEnd=").concat(this.aShieldBuffer.samples[e-1].ts)),t>0&&v.a.warn("BufferAv._switchShieldTimout, vStart=".concat(this.vBuffer.samples[0].ts,", vEnd=").concat(this.vBuffer.samples[t-1].ts))}},{key:"_getFirstShieldAVDelta",value:function(){var e=this.firstVideoTs,t=this.firstShieldAudioTs,i=0;return 0!=e&&0!=this.firstAudioTs&&(i=e-t),i}},{key:"_switchShieldAudioFailed",value:function(e){v.a.warn("BufferAv._switchShieldAudioFailed switch shield audio failed, reason=".concat(e,", firstVideoTs=").concat(this.firstVideoTs,", firstAudioTs=").concat(this.firstAudioTs,", firstShieldAudioTs=").concat(this.firstShieldAudioTs)),this.isSwitchShieldFailed=!0,this.switchedShieldAudio&&this.clearShieldAudio();var t=Math.abs(this._getFirstShieldAVDelta());this.ctrlBuffer.onSwitchShieldAudioFail(e,t)}},{key:"_switchShieldAudioSuc",value:function(){if(!this.isSwitchShieldFailed){v.a.log("BufferAv._switchShieldAudioSuc switch shield audio successfully, firstVideoTs=".concat(this.firstVideoTs,", firstAudioTs=").concat(this.firstAudioTs,", firstShieldAudioTs=").concat(this.firstShieldAudioTs));var e=this._getFirstShieldAVDelta();this.ctrlBuffer.onSwitchShieldAudioSuc(e)}}},{key:"_shieldAuidoMute",value:function(e,t){this.ctrlBuffer.shieldAuidoMute(e,t)}},{key:"_setShieldBuffer",value:function(e){if(!this.isFirstShieldAvc){v.a.log("BufferAv.popBuffer.firstShieldBuffer.length",this.aShieldBuffer.samples&&this.aShieldBuffer.samples.length),this.isFirstShieldAvc=!0;var t=this.aShieldBuffer.samples[0].ts,i=e,s=e-t;if(v.a.log("BufferAv.popBuffer.shield.firstDts avcFirstTs=".concat(i," aacFirstTs=").concat(t," delta=").concat(e-t)),s<0&&s>-f.a.shieldAudioCfg[3])return this._switchShieldAudioSuc(),this.switchedShieldAudio=!0,!0;if(s<-f.a.shieldAudioCfg[3])return v.a.log("BufferAv.popBuffer.shield audio to fast"),this._switchShieldAudioFailed(3),!1}return!0}},{key:"_addSampleVideo",value:function(e){0==this.firstVideoTs&&(this.firstVideoTs=e.ts),this.firstPrintVideo||(this.firstPrintVideo=!0,v.a.log("BufferAv.addSampleVideo firstPrint dts=".concat(e.ts," isKey=").concat(e.key))),e.key&&e.origin_iframe&&!this.hasOriginIFrame&&(v.a.log("BufferAv.addSampleVideo find origin_iframe! isIframe=".concat(e.key)),this.hasOriginIFrame=!0),!e.key&&e.origin_iframe&&v.a.warn("BufferAv.addSampleVideo find origin_iframe sei not in iframe"),this._updateGop(e);var t=this.vBuffer.addSample(e,!1);if(this.isShieldAudio){var i=this.vBuffer.samples.length;0!=this.firstAudioTs&&0!=this.firstVideoTs&&this.firstVideoTs-this.firstAudioTs>=f.a.shieldAudioCfg[4]&&this._switchShieldAudioFailed(4),!this.isFirstDelteShieldAac&&i>0&&this.aShieldBuffer.removeExpireBuffer(this.vBuffer.samples[0].ts,2);var s=this.aShieldBuffer.getBufferLen();!this.paused&&t>=this.popSize&&s>=this.popSize&&(this.popBuffer(this.popDuration),this.isFirstDelteShieldAac=!0)}else!this.paused&&t>this.popSize&&(0===this.popMode?this.aBuffer.getBufferLen()>this.popSize?this.popBuffer(this.popDuration):t>this.waitSize&&(this.popBuffer(this.waitSize),e.ts-this.firstVideoTs>1e4&&0===this.aBuffer.firstDts&&(this.popMode=1)):1===this.popMode&&this.popBuffer(this.popDuration))}},{key:"setVideoPlayDts",value:function(){this.aBuffer.alignPlayDts(this.vBuffer.playDts)}},{key:"_addSmapleAudio",value:function(e){0==this.firstAudioTs&&(this.firstAudioTs=e.ts),this.firstPrintAudio||(this.firstPrintAudio=!0,v.a.log("BufferAv._addSmapleAudio firstPrint dts=".concat(e.ts)));var t=this.aBuffer.addSample(e,!1);this.isShieldAudio||!this.isShieldAudio&&!this.paused&&this.isPureAudio&&t>this.popSize&&this.popBuffer(this.popDuration)}},{key:"addShieldAudioSample",value:function(e){0==this.firstShieldAudioTs&&(this.firstShieldAudioTs=e.ts);var t=this.aShieldBuffer.addSample(e,!0);this.isShieldAudio&&!this.paused&&this.isPureAudio&&t>this.popSize&&this.popBuffer(this.popDuration)}},{key:"getShieldWait",value:function(){if(this.isShieldAudio){var e=this.aShieldBuffer.getSize();if(e<=0)return!1;var t=this.aShieldBuffer.samples[0].ts,i=this.aShieldBuffer.samples[e-1].ts;if(!this.isAShieldFirstPop){if(i-t<f.a.shieldAudioCfg[5])return v.a.log("BufferAv.popBuffer.waitShield",i-t),!1;v.a.log("BufferAv.popBuffer.waitShield success",i-t),this.isAShieldFirstPop=!0}}return!0}},{key:"popBuffer",value:function(e){var t=0,i=0;if(this.isStartShieldAudio||(this.startShieldTs=S.a.now(),this.isStartShieldAudio=!0),this.getShieldWait()){0!=this.startShieldTs&&(t=S.a.now()-this.startShieldTs);var s=null,r=null,a=!1;(r=this.vBuffer.getTrack(e)).timescale=this.timescale,r.duration=Math.round((r.endDts-r.startDts)*(this.timescale/1e3));var n=0==r.sn;r&&(n||this.avcChange)&&Object.assign(r,this.videoConfig);var o=this.isPureAudio?this.aBuffer.playDts+e:r.endDts;if(this.isShieldAudio){var h=this._setShieldBuffer(this.vBuffer.firstDts),u=this.firstVideoTs,l=this.firstShieldAudioTs,d=u-l;if(h)if(d<0&&d>-f.a.shieldAudioCfg[3]&&!this.isShieldFastToAlign)if(o<=l+this.popSize)s=this.aBuffer.getTrack(o),a=!1;else{var c=this.aShieldBuffer.samples[0].ts;this.aShieldBuffer.removeExpireBuffer(r.startDts,2),this.aShieldBuffer.samples.length>0&&v.a.log("BufferAv.popBuffer.shield to align, aRemoveShieldFirstTs=".concat(c,", vshieldAlignTs=").concat(r.startDts,",ashieldAlignTs=").concat(this.aShieldBuffer.samples[0].ts,", removeDelta=").concat(this.aShieldBuffer.samples[0].ts-c)),s=this.aShieldBuffer.getTrack(o),a=!0,this.aBuffer.removeExpireBuffer(o,1),this.isShieldFastToAlign=!0}else this.isSwitchShieldFailed?(s=this.aBuffer.getTrack(o),a=!1):this.switchedShieldAudio?(a=!0,s=this.aShieldBuffer.getTrack(o),this.aBuffer.removeExpireBuffer(o,1)):(this.switchedShieldAudio=!0,this.aShieldBuffer.removeExpireBuffer(r.startDts,2),this.aShieldBuffer.hasPushBuffer(o)?(s=this.aShieldBuffer.getTrack(o),a=!0,this.aBuffer.removeExpireBuffer(o,1),this._switchShieldAudioSuc()):0==this.aShieldBuffer.playDts?v.a.log("BufferAv.popBuffer.shield audio curDts=".concat(this.aShieldBuffer.playDts,", dts = 0, switch failed")):(this._switchShieldAudioFailed(4),v.a.warn("BufferAv.popBuffer.shield audio curDts=".concat(this.aShieldBuffer.playDts," far less than curDts=").concat(o,", delta = ").concat(o-this.aShieldBuffer.playDts,", switch failed")),s=this.aBuffer.getTrack(o)));else s=this.aBuffer.getTrack(o),a=!1;1===Number(localStorage._printShield)&&v.a.log("BufferAv.popBuffer.shield: aac startDts=".concat(s.startDts," endDts=").concat(s.endDts," avc startDts=").concat(r.startDts," endDts=").concat(r.endDts),"gap:",r.endDts-s.endDts),Q.remove(this._switchShieldTimeoutBind,this)}else a=!1,s=this.aBuffer.getTrack(o,e===Number.MAX_SAFE_INTEGER||e===this.waitSize),this.switchedShieldAudio&&this.clearShieldAudio();0!=this.startShieldTs&&(i=S.a.now()-this.startShieldTs,v.a.log("BufferAv.popBuffer.shield: waitTime1 = ".concat(t," waitTime2=").concat(i)),this.startShieldTs=0),a?(s.config=this.shieldAudioConfig.config,s.audiosamplerate=this.shieldAudioConfig.audiosamplerate,s.channelCount=this.shieldAudioConfig.channelCount,s.codec=this.shieldAudioConfig.codec):(s.config=this.audioConfig.config,s.audiosamplerate=this.audioConfig.audiosamplerate,s.channelCount=this.audioConfig.channelCount,s.codec=this.audioConfig.codec),s.timescale=this.timescale,s.duration=Math.round((s.endDts-s.startDts)*(this.timescale/1e3)),e===Number.MAX_SAFE_INTEGER&&v.a.log("BufferAV.popAllBuffer video=[".concat(r.startDts,", ").concat(r.endDts,"] audio=[").concat(s.startDts,", ").concat(s.endDts,"] audioNum=").concat(this.aBuffer.getSize()," audioEndDts=").concat(this.aBuffer.lastSampleDts)),1===Number(localStorage._printAVTrack)&&v.a.log("BufferAV.popBuffer.shield vaStartDelta=".concat(r.startDts-s.startDts,",vaEndDelta=").concat(r.endDts-s.endDts,",avcDelta=").concat(r.endDts-r.startDts,",aacDelta=").concat(s.endDts-s.startDts,",avcStartDts= ").concat(r.startDts,",aacStartDts=").concat(s.startDts,",avcEndDts=").concat(r.endDts,",aacEndDts=").concat(s.endDts)),this.hasRemux=!0,this.remuxCb&&this.remuxCb(r,s)}}},{key:"clearBuffer",value:function(){this.vBuffer.clear(),this.aBuffer.clear(),this.aShieldBuffer.clear()}},{key:"setNeedEmptyAudioFrame",value:function(e){this.aBuffer.needEmptyAudioFrame=e}},{key:"getBufferLen",value:function(){return this.isPureAudio?this.aBuffer.getBufferLen():this.vBuffer.getBufferLen()}},{key:"getSize",value:function(){return this.vBuffer.getSize()}}]),e}();Gs.TYPES={avc:"avc",av01:"av01",aac:"aac"};var js=Gs,Ys=function(){function e(){Object(s.a)(this,e),this.list=[],this.switchIFrameDts=0,this.switchIFramePts=0,this.lastIFrameDts=0,this.lastIFRamePts=0}return Object(a.a)(e,[{key:"getDts",value:function(){return this.switchIFrameDts||this.lastIFrameDts}},{key:"getPts",value:function(){return this.switchIFramePts||this.lastIFRamePts}},{key:"setSwitchTs",value:function(e,t){this.switchIFrameDts=e,this.switchIFramePts=t}},{key:"setLastTs",value:function(e,t){this.lastIFrameDts=e,this.lastIFRamePts=t}},{key:"resetPtsSample",value:function(){this.list=[]}},{key:"addPtsSample",value:function(e,t,i,s,r,a){this.list.push({dts:e,pts:t,dtsGap:i,ptsGap:s,hasOrigin:r,isOrigin:a})}},{key:"getMetric",value:function(){var e=[0,0,0],t=[0,0];if(this.list.length>0){var i=this.list[0],s=this.list[this.list.length-1];e[0]=i.dtsGap,e[1]=i.ptsGap,e[2]=this.list.length,e[3]=0,e[4]=s.ptsGap,t[0]=s.hasOrigin?1:2,t[1]=s.isOrigin?1:2,t[2]=0}return{values:e,strs:t}}}]),e}(),qs=0,Js=function(){function e(t,i,r){Object(s.a)(this,e),this.config=t,this.remuxCb=i,this.mse=r,this.hasVideoConfig=!1,this.needEmptyAudioFrame=!0,this.timescale=9e4,this.hasFrame=!1,this.state=0,this.switchTs=new Ys,this.avBuffer=this._createBuffer(),this.evalBw=null,this.callbacks=null,this._buffered=null,this.id=qs++,v.a.log("CtrlBuffer.constructor(".concat(this.id,")")),this._curFrameId=0,this.avcChangeTime=0}return Object(a.a)(e,[{key:"setCurFrameId",value:function(e){this._curFrameId=e}},{key:"setBuffered",value:function(e){this._buffered=e}},{key:"addBuffered",value:function(e,t,i){(e.type===js.TYPES.avc||e.type===js.TYPES.av01&&this._buffered)&&this._buffered.addSample(this._curFrameId,e.ts,t,i)}},{key:"destroy",value:function(){this.remuxCb=null,this.callbacks=null,this._destroyBuffer()}},{key:"_destroyBuffer",value:function(){this.avBuffer&&(this.avBuffer.destroy(),this.avBuffer=null)}},{key:"_createBuffer",value:function(){this._destroyBuffer();var e=new js(this.config,this.remuxCb,this);return e.timescale=this.timescale,e.setNeedEmptyAudioFrame(this.needEmptyAudioFrame),e}},{key:"pause",value:function(){this.avBuffer.paused=!0}},{key:"play",value:function(){this.avBuffer.paused=!1}},{key:"isPaused",value:function(){return this.avBuffer.paused}},{key:"isWaitForIFrame",value:function(){return 1===this.state}},{key:"switchBitrate",value:function(e,t,i){v.a.log("CtrlBuffer(".concat(this.id,").switchBitrate isDown=").concat(e)),this._lastBitrate=t,this._curBitrate=i,this.state=1}},{key:"switchBack",value:function(){v.a.log("CtrlBuffer(".concat(this.id,").switchBack switchIFramePts=").concat(this.switchTs.getDts()," lastIFramePts=").concat(this.switchTs.getPts())),this.state=2,this.avBuffer=this._createBuffer(),this.callbacks&&this.callbacks.start(this.switchTs.getDts(),this.switchTs.getPts())}},{key:"switchShieldAudio",value:function(e){this.avBuffer&&this.avBuffer.switchShieldAudio&&this.avBuffer.switchShieldAudio(e)}},{key:"setEval",value:function(e){this.evalBw=e}},{key:"addSample",value:function(e){if(this.avBuffer){var t=e.key&&(!this.avBuffer.hasOriginIFrame||e.origin_iframe);if(t&&this.switchTs.setLastTs(e.ts,e.ts+e.cts),e.type!==js.TYPES.avc&&e.type!==js.TYPES.av01||this.evalBw&&this.evalBw.addSample(e),2===this.state&&(this.hasFrame||e.type!==js.TYPES.avc&&e.type!==js.TYPES.av01||(v.a.log("CtrlBuffer(".concat(this.id,").addSample first sample dts=").concat(e.ts," pts=").concat(e.ts+e.cts)),this.hasFrame=!0,this.callbacks&&this.callbacks.first())),e.type!==js.TYPES.avc&&e.type!==js.TYPES.av01||this.hasVideoConfig)if(2===this.state){if(e.key){var i=e.ts+e.cts,s=e.ts-this.switchTs.getDts(),r=i-this.switchTs.getPts();v.a.log("CtrlBuffer(".concat(this.id,").addSample find IFrame origin_iframe=").concat(e.origin_iframe," dts=").concat(e.ts," pts=").concat(i," switchDts=").concat(this.switchTs.switchIFrameDts," switchPts=").concat(this.switchTs.switchIFramePts," dtsGap=").concat(s," ptsGap=").concat(r," iFrameGap=").concat(this.avBuffer.gop)),this.switchTs.addPtsSample(e.ts,i,s,r,this.avBuffer.hasOriginIFrame,e.origin_iframe),i>=this.switchTs.switchIFramePts&&(v.a.log("CtrlBuffer(".concat(this.id,").addSample find new IFrame, switch done")),this.state=0,this.switchTs.setSwitchTs(0,0),this.avBuffer.addSample(e),this.addBuffered(e,!0,r),this.callbacks&&this.callbacks.done(s,e.ts,r))}}else 1===this.state?t?(this._popAllBuffer(),this.avBuffer.hasOriginIFrame=!1,this.hasVideoConfig=!1,this.hasFrame=!1,this.state=2,this.switchTs.setSwitchTs(e.ts,e.ts+e.cts),this.switchTs.resetPtsSample(),v.a.log("CtrlBuffer(".concat(this.id,").addSample find next IFrame origin_iframe=").concat(e.origin_iframe," dts=").concat(this.switchTs.switchIFrameDts," pts=").concat(this.switchTs.switchIFramePts," iFrameGap=").concat(this.avBuffer.gop,", switch start!")),this.callbacks&&this.callbacks.start(this.switchTs.switchIFrameDts,this.switchTs.switchIFramePts)):(e.key&&v.a.log("CtrlBuffer(".concat(this.id,").addSample find next IFrame fail, origin_iframe=").concat(e.origin_iframe," dts=").concat(e.ts," pts=").concat(e.ts+e.cts)),this.avBuffer.addSample(e),this.addBuffered(e,!1,0)):(1===Number(localStorage._printIFramePts)&&e.key&&v.a.log("CtrlBuffer(".concat(this.id,").addSample find next IFrame fail, origin_iframe=").concat(e.origin_iframe," dts=").concat(e.ts," pts=").concat(e.ts+e.cts)),this.avBuffer.addSample(e),this.addBuffered(e,!1,0))}}},{key:"addShieldAudioSample",value:function(e){this.avBuffer.addShieldAudioSample(e),this.addBuffered(e,!1,0)}},{key:"_popAllBuffer",value:function(){this.avBuffer&&(this.avBuffer.getBufferLen()>0&&this.avBuffer.popBuffer(Number.MAX_SAFE_INTEGER),this.avBuffer.clearBuffer())}},{key:"updateVideoConfig",value:function(e,t){t&&(this.avcChangeTime=S.a.now(),this._popAllBuffer()),this.hasVideoConfig=!0,this.avBuffer.updateVideoConfig(e,t)}},{key:"updateAudioConfig",value:function(e,t,i,s){t&&this._popAllBuffer(),this.avBuffer&&this.avBuffer.updateAudioConfig&&this.avBuffer.updateAudioConfig(e,i,s)}},{key:"setNeedEmptyAudioFrame",value:function(e){this.needEmptyAudioFrame=e,this.avBuffer.setNeedEmptyAudioFrame(e)}},{key:"isInAvcChangeTime",value:function(e){var t=S.a.now();return this.avcChangeTime+e<t}},{key:"getBufferLen",value:function(){return this.avBuffer.getBufferLen()}},{key:"getVideoBufferLen",value:function(){return this.mse.getBufferLen()}},{key:"getLastIFrameDts",value:function(){return this.switchTs.lastIFrameDts}},{key:"getSize",value:function(){return this.avBuffer.getSize()}},{key:"onSwitchShieldAudioFail",value:function(e,t){this.mse&&this.mse.onSwitchShieldAudioFail(e,t)}},{key:"onSwitchShieldAudioSuc",value:function(e){this.mse&&this.mse.onSwitchShieldAudioSuc(e)}},{key:"shieldAuidoMute",value:function(e,t){this.mse&&this.mse.shieldAuidoMute(e,t)}}]),e}(),zs=function(){function e(){Object(s.a)(this,e),this.avDifTotal=0,this.avDifCnt=0,this.avDifMax=0,this.emptyFrames=0}return Object(a.a)(e,[{key:"checkSync",value:function(e,t){if(e.endDts>0&&t.endDts>0){this.emptyFrames+=t.emptyFrames;var i=e.endDts-t.endDts;this.avDifTotal+=i,this.avDifCnt++,this.avDifMax<i&&(this.avDifMax=i),i>200&&0===t.emptyFrames&&v.a.warn("AVSyncStat.checkSync avDif=".concat(i," video=[").concat(e.startDts,", ").concat(e.endDts,"] videoPlayDts=").concat(e.playDts," audio=[").concat(t.startDts,", ").concat(t.endDts,"] audioPlayDts=").concat(t.playDts))}}},{key:"record",value:function(e){if(this.avDifCnt>0){var t=Math.round(this.avDifTotal/this.avDifCnt);e.setCore(g.a.DIM_CORE.AVSDA,t),e.setCore(g.a.DIM_CORE.AVSDM,this.avDifMax),e.setCore(g.a.DIM_CORE.AVEFS,this.emptyFrames)}this.avDifCnt=0,this.avDifTotal=0,this.avDifMax=0,this.emptyFrames=0}}]),e}(),Ks=function(){function e(t){Object(s.a)(this,e),this.mse=t,this.eventEmitter=this.mse.handler.eventEmitter,this.stat=this.mse.handler.stat,this.lastTs=0,this.renderNum=0,this.fpsTotal=0,this.fpsNum=0,this.recordTotal=0,this.recordNum=0,this.lastEachTs=0,this.renderBadQuality=0,this.isFirstRender=!0,this.prePageRenderTs=0,this.pageRecordTotal=0,this.pageRecordNum=0,this.pageRenderNum=0,this.pageFpsTotal=0,this.pageFpsNum=0,this.pageFpsMax=0,this.pageFpsMin=0,this._onVisibilityChangeBind=this._onVisibilityChange.bind(this),this.eventEmitter&&this.eventEmitter.on(d.VISIBILITY_CHANGE,this._onVisibilityChangeBind)}return Object(a.a)(e,[{key:"reset",value:function(){this.fpsNum=0,this.fpsTotal=0,this.renderNum=0,this.recordTotal=0,this.recordNum=0,this.lastEachTs=0,this.renderBadQuality=0,this.isFirstRender=!0,this.prePageRenderTs=0,this.pageRecordTotal=0,this.pageRecordNum=0,this.pageRenderNum=0,this.pageFpsTotal=0,this.pageFpsNum=0,this.pageFpsMax=0,this.pageFpsMin=0}},{key:"getRecordFps",value:function(){var e=this.fpsTotal-this.recordTotal,t=this.fpsNum-this.recordNum;return t>0?(this.recordTotal=this.fpsTotal,this.recordNum=this.fpsNum,Math.round(e/t)):0}},{key:"addRender",value:function(){var e=S.a.now();if(this.renderNum++,0===this.lastTs)this.lastTs=e;else{var t=e-this.lastTs;if(t>=1e3){this.lastTs=e;var i=Math.floor(this.renderNum/(t/1e3));this.fpsNum++,this.fpsTotal+=i,this.renderNum=0}}this._checkRenderQuality(e)}},{key:"getPageRecordFps",value:function(){var e=this.pageFpsTotal-this.pageRecordTotal,t=this.pageFpsNum-this.pageRecordNum,i=0,s=this.pageFpsMax,r=this.pageFpsMin;t>0&&(this.pageRecordTotal=this.pageFpsTotal,this.pageRecordNum=this.pageFpsNum,i=Math.round(e/t));var a={pfps:i,pfpsMax:s,pfpsMin:r};return this.pageFpsMax=0,this.pageFpsMin=0,a}},{key:"addPageRender",value:function(){var e=S.a.now();if(this.pageRenderNum++,0===this.prePageRenderTs)this.prePageRenderTs=e;else{var t=e-this.prePageRenderTs;if(t>=1e3){this.prePageRenderTs=e;var i=Math.round(this.pageRenderNum/(t/1e3));this.pageFpsNum++,this.pageFpsTotal+=i,this.pageRenderNum=0,this.pageFpsMax=Math.max(i,this.pageFpsMax),0!=i&&(0==this.pageFpsMin?this.pageFpsMin=i:this.pageFpsMin=Math.min(i,this.pageFpsMin))}}}},{key:"_checkRenderQuality",value:function(e){if(0===this.lastEachTs)this.lastEachTs=e;else{var t=e-this.lastEachTs;!this.isFirstRender&&t>200&&(this.renderBadQuality=100,this.stat.addCore(g.a.DIM_CORE.VRBQC,1),this.stat.addCore(g.a.DIM_CORE.VRBQD,t),v.a.warn("RenderFps._checkRenderQuality render bad quality time=",t)),this.isFirstRender=!1,this.lastEachTs=e}}},{key:"statRenderQuality",value:function(){var e=this.renderBadQuality;return this.renderBadQuality=0,e}},{key:"_onVisibilityChange",value:function(){(document.hidden||document.webkitHidden||document.mozHidden||document.msHidden)&&(this._checkRenderQuality(S.a.now()),this.lastTs=0,this.lastEachTs=0,this.renderNum=0)}}]),e}(),Qs=function(){function e(t){Object(s.a)(this,e),this.mse=t,this.eventEmitter=this.mse.handler.eventEmitter,this.recvFrameDataList=[],this.remuxFrameDataList=[],this.pushedVideoDataList=[],this.frameRecvToPushConSumingMax=0,this.frameRecvToPushConSumingFrames=0,this.frameRecvToPushConSumingTotalTime=0,this.framePushToRenderedConSumingMax=0,this.framePushToRenderedConSumingFrames=0,this.framePushToRenderedConSumingTotalTime=0,this.frameRecvToRenderMax=0,this.frameRecvToRenderConSumingFrames=0,this.frameRecvToRenderConSumingTotalTime=0,this._onVisibilityChangeBind=this._onVisibilityChange.bind(this),this.eventEmitter&&this.eventEmitter.on(d.VISIBILITY_CHANGE,this._onVisibilityChangeBind)}return Object(a.a)(e,[{key:"clearConsuming",value:function(){this.recvFrameDataList=[],this.remuxFrameDataList=[],this.pushedVideoDataList=[],this.frameRecvToPushConSumingMax=0,this.frameRecvToPushConSumingFrames=0,this.frameRecvToPushConSumingTotalTime=0,this.framePushToRenderedConSumingMax=0,this.framePushToRenderedConSumingFrames=0,this.framePushToRenderedConSumingTotalTime=0,this.frameRecvToRenderMax=0,this.frameRecvToRenderConSumingFrames=0,this.frameRecvToRenderConSumingTotalTime=0}},{key:"addRecvFrameData",value:function(e,t,i){f.a.renderStat[0]&&this.recvFrameDataList.push({ts:e,pts:t,time:i})}},{key:"addRemuxFrameData",value:function(e,t,i){f.a.renderStat[0]&&this.remuxFrameDataList.push({ts:e,pts:t,time:i})}},{key:"pushRemuxedVideoFrameData",value:function(e){var t=this;if(f.a.renderStat[0]){for(var i=function(i){var s=t.recvFrameDataList.find((function(e){return e.ts===t.remuxFrameDataList[i].ts}));if(s){var r=e-s.time;t.frameRecvToPushConSumingTotalTime+=r,t.frameRecvToPushConSumingFrames++,t.frameRecvToPushConSumingMax=Math.max(r,t.frameRecvToPushConSumingMax)}t.pushedVideoDataList.push({ts:t.remuxFrameDataList[i].ts,pts:t.remuxFrameDataList[i].pts,time:e})},s=0;s<this.remuxFrameDataList.length;s++)i(s);this.remuxFrameDataList=[]}}},{key:"addRenderFrameData",value:function(e,t){if(f.a.renderStat[0]){for(var i=0;i<this.recvFrameDataList.length;i++)for(;this.recvFrameDataList.length>0&&this.recvFrameDataList[0].pts<e;){var s=t-this.recvFrameDataList[0].time;this.frameRecvToRenderMax=Math.max(s,this.frameRecvToRenderMax),this.frameRecvToRenderConSumingFrames++,this.frameRecvToRenderConSumingTotalTime+=s,this.recvFrameDataList.shift()}for(var r=0;r<this.pushedVideoDataList.length;r++)for(;this.pushedVideoDataList.length>0&&this.pushedVideoDataList[0].pts<e;){var a=t-this.pushedVideoDataList[0].time;this.framePushToRenderedConSumingMax=Math.max(a,this.framePushToRenderedConSumingMax),this.framePushToRenderedConSumingFrames++,this.framePushToRenderedConSumingTotalTime+=a,this.pushedVideoDataList.shift()}}}},{key:"getRecvToPushConsuming",value:function(){return{max:this.frameRecvToPushConSumingMax,avg:this.frameRecvToPushConSumingFrames>0?this.frameRecvToPushConSumingTotalTime/this.frameRecvToPushConSumingFrames:0}}},{key:"getPushToRenderedConSuming",value:function(){return{max:this.framePushToRenderedConSumingMax,avg:this.framePushToRenderedConSumingFrames>0?this.framePushToRenderedConSumingTotalTime/this.framePushToRenderedConSumingFrames:0}}},{key:"getRecvToRenderConsuming",value:function(){return{max:this.frameRecvToRenderMax,avg:this.frameRecvToRenderConSumingFrames>0?this.frameRecvToRenderConSumingTotalTime/this.frameRecvToRenderConSumingFrames:0}}},{key:"_onVisibilityChange",value:function(){this.clearConsuming()}}]),e}(),$s=[43,138,8,0],Xs=0,Zs=function(){function e(t,i,r){Object(s.a)(this,e),this._num_=++Xs;var a=i.videoType,n=void 0===a?"flv":a,o=i.isLive,h=void 0===o||o,u=i.isPureAudio,l=void 0!==u&&u,d=i.isPureVideo,c=void 0!==d&&d,p=i.isH265Mode,m=i.popDuration,_=void 0===m?200:m;this.isH265Mode=p,this.handler=t,this.videoType=n,this.isLive=h,this.isPureAudio=l,this.isPureVideo=c,this.parser=null,this.metadata={},this.bufStat=new Is,this.pauseStat=new As(this),this.pausePerf=new ks,this.buffered=new Os,this.buffered.setMse(this),this.h264SeiInfos=new Fs(this),this.scriptVolumeInfos=new Ls(this),this.pid=0,this.bitrate=0,this.JITTER_BUFMIN=1e3,this.JITTER_BUFLEN=4e3,this.JITTER_BUFMAX=8e3,this.webcodecType=r,this.width=1280,this.height=720,this.widthCfg=1280,this.heightCfg=720,this.mediaElement=null,this.hasRemuxed=!1,this.remuxer=new Ns(this),this.avSyncStat=new zs(this),this.ctrlBuffer=new Js({bufferSize:0,popDuration:_,timescale:this.remuxer.timescale,isPureAudio:this.isPureAudio,isPureVideo:this.isPureVideo,webcodecType:this.webcodecType},this._remux.bind(this),this),this.renderFps=new Ks(this),this.onPageRenderCbkBind=this.onPageRenderCbk.bind(this),window.requestAnimationFrame&&f.a.renderStat[0]&&window.requestAnimationFrame(this.onPageRenderCbkBind),this.videoPlayConsuming=new Qs(this),this.audioPlayConsuming=new Qs(this),this.audioConfig=$s.slice(),this.updateAudioConfig({audioConfig:this.audioConfig,codec:"mp4a.40.5",audioSampleRate:22050,aacTimeLen:1024e3/22050,audioObjectType:5,audioChannelCount:1},!0),this.perfBlockCnt=0,this.remuxVideoCnt=0,this.audioEmptyDuration=0,this.audioEmptyList4Sec=[],this.lastSecNow=S.a.now(),this.isNoAudio=!0,xt.add(this.onCheckFastWorkerTimer,this,100),this.shildAudioStartTs=0,this.isShieldAudio=!1}return Object(a.a)(e,[{key:"printAVInfos",value:function(){this.parser&&(this.parser.printVideoInfo&&this.parser.printVideoInfo(),this.parser.printAudioInfo&&this.parser.printAudioInfo())}},{key:"onFastOver",value:function(){}},{key:"setParams",value:function(e,t){if(this.pid=e,this.bitrate=t,this._initPerf(),this.parser.dropFrameDts){var i=!1;(1===f.a.dropFrameUids[0]||-1!==f.a.dropFrameUids.indexOf(parseInt(e)))&&(i=!0),this.parser.dropFrameDts.open=i}this.parser.dropFrameDts.start()}},{key:"_initPerf",value:function(){"ts"!==this.videoType&&this.pausePerf.checkLocal(this.pid,this.bitrate)&&this.parser.dropFrameCtrl.start()}},{key:"getDelayStat",value:function(){return"ts"!==this.videoType?this.parser.sei.getStat():null}},{key:"onRestart",value:function(){v.a.log("BaseController(".concat(this._num_,").onRestart")),this.reset()}},{key:"onVideoParseInvalid",value:function(){this.handler&&this.handler.onVideoParseInvalid&&this.handler.onVideoParseInvalid()}},{key:"onGop",value:function(e){this.handler.onGop&&this.handler.onGop(e),e>this.maxGop&&(this.maxGop=e,v.a.log("BaseController(".concat(this._num_,").onGop update maxGop=")+this.maxGop))}},{key:"onCheckTimer",value:function(e,t){this.parser&&this.parser.fps&&(this.metadata.fps=this.parser.fps.getFps(),this.metadata.recvVideoFps=this.parser.fps.getRecvFps()),this.parser&&this.parser.audioFps&&(this.metadata.audioFps=this.parser.audioFps.getFps(),this.metadata.recvAudioFps=this.parser.audioFps.getRecvFps())}},{key:"onCheckFastTimer",value:function(e,t){1===Number(f.a.isMute)&&this.muffledVoice(),this._getEmptyAudioDuration(e)}},{key:"destroy",value:function(){xt.remove(this.onCheckFastWorkerTimer,this),this.metadata={},this.JITTER_BUFMIN=1e3,this.JITTER_BUFLEN=4e3,this.JITTER_BUFMAX=8e3,this.remuxer.destroy(),this.ctrlBuffer&&this.ctrlBuffer.destroy&&this.ctrlBuffer.destroy(),this.hasRemuxed=!1,this.resetPerfBlockCnt(),this.renderFps.reset(),this.audioEmptyList4Sec.length=0,this.isNoAudio=!0,this.shildAudioStartTs=0,this.isShieldAudio=!1}},{key:"getCodecType",value:function(){return this.parser.getCodecType()}},{key:"setPushGop",value:function(e){this.parser.setPushGop(e)}},{key:"saveH264SeiData",value:function(e,t){this.h264SeiInfos.add(e,t)}},{key:"saveSeiInfo",value:function(e,t,i){1===Number(localStorage._printSeiInfo)&&v.a.log("BaseController.saveSeiInfo, timestamp=".concat(e,", type=").concat(i)),this.handler&&this.handler.eventEmitter.trigger(d.SEI_INFO,{timestamp:e,data:t})}},{key:"setPlaybackrateAccess",value:function(e){this.playbackrateChangeAccess=e}},{key:"getDelayInfo",value:function(){return v.a.log("MSEPlayer.getDelayInfo: delay: ",this.mediaDelay),this.mediaDelay}},{key:"setSeiDelay",value:function(e){if(this.seiAnchorDelay!==e||!this.mediaDelay){var t=this.getBufferLen();this.isShieldAudio&&(t+=this.getFrameBufferLen()),this.seiAnchorDelay=e,this.mediaDelay={total_delay:this.seiAnchorDelay+t,buffer_delay:t,status:0},0===this.seiAnchorDelay&&(this.mediaDelay.status=1)}}},{key:"getRealFps",value:function(){return this.parser.getRealFps?this.parser.getRealFps():0}},{key:"getIsDownEnough",value:function(){return!this.parser.isDownEnough||this.parser.isDownEnough()}},{key:"getRealBitrate",value:function(){var e=0;return this.parser.fps&&(e=this.parser.fps.getRealBitrate()),e}},{key:"setDeleteH264Aud",value:function(e){this.parser.setDeleteH264Aud(e)}},{key:"setNeedEmptyAudioFrame",value:function(e){this.parser.setNeedEmptyAudioFrame(e)}},{key:"setJitter",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3e3,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5e3;this.JITTER_BUFLEN=e,this.JITTER_BUFMIN=t,this.JITTER_BUFMAX=i,v.a.info("".concat(this._getTag()," BaseController.setJitter bufMin=").concat(t," bufLen=").concat(e," bufMax=").concat(i))}},{key:"setResolution",value:function(e,t){v.a.log("BaseController(".concat(this._num_,").setResolution w/h=")+e+"/"+t),this.width&&this.height&&(this.width!==e||this.height!==t)&&this.handler.eventEmitter&&this.handler.eventEmitter.trigger(d.VIDEO_RESOLUTION_CHANGE),this.width=e,this.height=t}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"setExceptionStat",value:function(e,t){this.handler&&this.handler.exceptionStat&&this.handler.exceptionStat.setStat(e,t)}},{key:"cacheBlockReason",value:function(e,t){this.handler&&this.handler.cacheBlockReason&&this.handler.cacheBlockReason(e,t)}},{key:"getPlayStat",value:function(){return this.parser.getPlayStat()}},{key:"getPlayVideo",value:function(){return this.video?this.video.video:null}},{key:"getFrameReadyed",value:function(){return this.parser&&this.parser.getFrameReadyed?this.parser.getFrameReadyed():0}},{key:"getFramePlayDelays",value:function(){return this.parser.getCalculateVideoFramePlayDelay?this.parser.getCalculateVideoFramePlayDelay():0}},{key:"getFrameBufferLen",value:function(){return this.parser.getFrameBufferLen?this.parser.getFrameBufferLen():0}},{key:"getContinueBuffer",value:function(){return this.buffered.continueBuffer}},{key:"getVideoContinueBuffer",value:function(){return this.buffered.getVideoContinueBuffer()}},{key:"getParserBufLen",value:function(){return this.parser.getParserBufLen()}},{key:"setSensitivePause",value:function(e){this.sensitivePause=e}},{key:"getInitDts",value:function(){return void 0===this.remuxer.getInitDts()?0:this.remuxer.getInitDts()}},{key:"getCurrentSeiOffsetDts",value:function(){return this.offsetDts||0}},{key:"appendFlv",value:function(e){this.parser.parseFlv(e)}},{key:"_getTag",value:function(){var e=this.handler.constructor.name;return this._num_+" "+e}},{key:"recvDataFull",value:function(){this.handler&&this.handler.recvDataFull&&this.handler.recvDataFull()}},{key:"getVideoFrames",value:function(){return this.parser&&this.parser.getVideoFrames?this.parser.getVideoFrames():0}},{key:"getAudioFrames",value:function(){return this.parser&&this.parser.getAudioFrames?this.parser.getAudioFrames():0}},{key:"setVolume",value:function(e){this.webcodecType==V.a.PLAYER_CORE_TYPE.MSE?this.video.setVolume(e):this.webcodecType==V.a.PLAYER_CORE_TYPE.WEBCODECS&&this.startMuteRender(e)}},{key:"muffledVoice",value:function(){var e=this;if(this.handler&&this.handler.getMuffleCacheData){var t=this.handler.voiceEliminationData||[],i=!1,s=this.getCurrentDts(),r=this.getBufferLen(),a=0,n=0,o=Di(t),h=this.handler.getMuffleCacheData(),u=h.length;if(0!=h.length){var l=h[0].begin,d=h[u-1].end,c=s-l,p=s-h[0].end,f=s-h[u-1].begin,m=s-d;1==Number(localStorage._printMuteInfo)&&v.a.log("MSEPlayer.muffledVoice nowDts=".concat(s,",buffer=").concat(r,",cacheBegin=").concat(l,",cacheEnd=").concat(d,",firstBeginDetla=").concat(c,",firstEndDelta=").concat(p,",lastBeginDelta=").concat(f,",lastEndDelta=").concat(m,",cacheLen=").concat(u)),h.map((function(t,r){a=t.begin,n=t.end,0==t.type&&(a+=e.offsetDts,n+=e.offsetDts),s>=a&&s<=n&&(i=!0,1==Number(localStorage._printMuteInfo)&&v.a.log("MSEPlayer.muffledVoicecache data",JSON.stringify(t)))}))}o.map((function(t,i){a=t.begin,n=t.end,0==t.type&&(a+=e.offsetDts,n+=e.offsetDts),s>n&&e.handler.voiceEliminationData.splice(i,1)})),this.setMuffledVolume(i)}}},{key:"setMuffledVolume",value:function(e){}},{key:"disableHardAcc",value:function(){v.a.log("BaseController.disableHardAcc")}},{key:"setDisableHardAcc",value:function(){v.a.log("BaseController.setDisableHardAcc")}},{key:"pushAvcSample",value:function(e){this.ctrlBuffer.addSample(e)}},{key:"pushAacSample",value:function(e,t){2==t?this.ctrlBuffer.addShieldAudioSample(e):this.ctrlBuffer.addSample(e)}},{key:"appendShieldAudioFlv",value:function(e){this.parser2.parseFlv(e,!0)}},{key:"updateAudioConfig",value:function(e,t,i){var s=e.audioConfig,r=e.codec,a=e.audioSampleRate,n=e.aacTimeLen,o=e.audioObjectType,h=e.audioChannelCount;if(t)this.ctrlBuffer.updateAudioConfig({config:s,codec:r,audiosamplerate:a,aacTimeLen:n,audioObjectType:o,audioChannelCount:h},!1,1,t);else{var u=!1,l=s;l.toString(16)!==this.audioConfig.toString(16)&&(this.audioConfig.toString(16)===$s.toString(16)&&this.remuxer.videoISGenerated&&(u=!0),v.a.warn("MSEPlayer.parseAudio adts changed old='".concat(this.audioConfig,", new='").concat(l,", needReplay=").concat(u))),this.audioConfig=s,this.ctrlBuffer.updateAudioConfig({config:s,codec:r,audiosamplerate:a,aacTimeLen:n,audioObjectType:o,audioChannelCount:h},u,i,t),this.remuxer.switchLevel(!1,u),this.setExceptionStat(g.a.DIM_LINK_STA.AUDIO_CONFIG,1)}}},{key:"updateVideoConfig",value:function(e,t){this.ctrlBuffer.updateVideoConfig(e,t)}},{key:"getLastIFrameDts",value:function(){return this.ctrlBuffer.getLastIFrameDts()}},{key:"getFrameBufferLen",value:function(){return this.ctrlBuffer.getBufferLen()}},{key:"getFrameReadyed",value:function(){return this.ctrlBuffer.getSize()}},{key:"setNeedEmptyAudioFrame",value:function(e){this.ctrlBuffer.setNeedEmptyAudioFrame(e),v.a.log("FlvParser.setNeedEmptyAudioFrame "+e)}},{key:"getParserBufLen",value:function(){return this.ctrlBuffer.getBufferLen()}},{key:"_remux",value:function(e,t){this._setRemuxed(),this.remuxVideoCnt+=e.samples.length,this.avSyncStat.checkSync(e,t),this.webcodecType==V.a.PLAYER_CORE_TYPE.WEBCODECS?(this.appendAvcTrack(e),this.appendAacSample(t)):this.remuxer&&this.remuxer.remux(t,e,0,!1)}},{key:"_setRemuxed",value:function(){this.hasRemuxed||(this.hasRemuxed=!0,this.recvDataFull&&this.recvDataFull())}},{key:"setPerfCntPlus",value:function(){this.perfBlockCnt++}},{key:"resetPerfBlockCnt",value:function(){this.perfBlockCnt=0}},{key:"getRealFpsAudio",value:function(){return this.parser.getRealFpsAudio?this.parser.getRealFpsAudio():0}},{key:"onVideoResize",value:function(e){this.checkResolution()}},{key:"checkResolution",value:function(){if(!this.h265Proxy||!this.h265Proxy.isReady||this.h265Proxy.isH265MseCodec){var e=0,t=0;this.webcodecType==V.a.PLAYER_CORE_TYPE.WEBCODECS?(e=this.videoRender.getVideoWidth(),t=this.videoRender.getVideoHeight()):(e=this.video.getVideoWidth(),t=this.video.getVideoHeight()),v.a.log("MSEPlayer(".concat(this._num_,").checkResolution o_w/o_h=")+this.width+"/"+this.height,"n_w/nh",e,"/",t),this.width&&this.height&&(this.width!==e||this.height!==t)&&this.handler.eventEmitter&&this.handler.eventEmitter.trigger(d.VIDEO_RESOLUTION_CHANGE,{width:e,height:t}),this.width=e,this.height=t}}},{key:"setAvcCfg",value:function(e,t){this.widthCfg=e,this.heightCfg=t}},{key:"getMseAvcCfgWidth",value:function(){return this.widthCfg}},{key:"getMseAvcCfgHeight",value:function(){return this.heightCfg}},{key:"onPageRenderCbk",value:function(){this.renderFps.addPageRender(),window.requestAnimationFrame&&window.requestAnimationFrame(this.onPageRenderCbkBind)}},{key:"onScriptVolumeInfo",value:function(e,t){this.handler.onSendScriptVolumeInfo(e,t)}},{key:"_getEmptyAudioDuration",value:function(e){var t=this.ctrlBuffer.avBuffer.aBuffer.getEmptyeDuration();this.audioEmptyDuration+=t,e-this.lastSecNow>=4e3&&(this.audioEmptyList4Sec.push(Math.floor(this.audioEmptyDuration>4e3?4e3:this.audioEmptyDuration)),this.audioEmptyDuration=0,this.lastSecNow=e)}},{key:"getEmptyAudioRecord",value:function(){var e=Di(this.audioEmptyList4Sec);return this.audioEmptyList4Sec.length=0,e}},{key:"setRealFps",value:function(){}},{key:"setNoAuido",value:function(e){this.isNoAudio=e}},{key:"setStreamFormat",value:function(e){this.handler&&this.handler.setStreamFormat&&this.handler.setStreamFormat(e)}},{key:"switchShieldAudio",value:function(e){this.ctrlBuffer.switchShieldAudio(e)}},{key:"stopShieldAudio",value:function(){this.switchShieldAudio(!1),this.isShieldAudio=!1}},{key:"onSwitchShieldAudioFail",value:function(e,t){this.isShieldAudio=!1,this.handler.onSwitchShieldAudioFail&&this.handler.onSwitchShieldAudioFail(e,t)}},{key:"onSwitchShieldAudioSuc",value:function(e){this.isShieldAudio=!0,this.handler.onSwitchShieldAudioSuc&&this.handler.onSwitchShieldAudioSuc(e)}},{key:"shieldAuidoMute",value:function(e,t){v.a.log("MSEPlayer.shieldAudioMute",e,t),this.shildAudioStartTs=t,this.webcodecType==V.a.PLAYER_CORE_TYPE.WEBCODECS?this.setMuted(!0):this.video&&this.video.video&&(this.video.video.muted=!0)}},{key:"resetPlayer",value:function(){this.handler.resetPlayer()}},{key:"getRenderElement",value:function(){}}]),e}(),er=function(){function e(t,i){Object(s.a)(this,e),this._mse=t,this._callbacks=i,this._paused=!1,this._playedTime=0,this._pausedTs=0,this._lastPausedTs=0,this._lastCheckTime=0,this._lastCheck500Time=0,this._lastCheck500CurrntTime=0}return Object(a.a)(e,[{key:"reset",value:function(){this._paused=!1,this._playedTime=0,this._pausedTs=0,this._lastPausedTs=0,this._lastCheckTime=0,this._lastCheck500Time=0}},{key:"check",value:function(){var e=S.a.now(),t=this._mse.video.video;if(!(0!=this._lastCheckTime&&e-this._lastCheckTime<50)&&(this._mse.isLive||!(t.currentTime<=1))&&(this._mse.isLive||!this._mse.handler||this._mse.handler.started)){if(0!==this._playedTime){t.currentTime===this._playedTime?this._paused||this._setPaused(e,t):this._paused&&this._setResume(e,t);var i=e-this._lastCheck500Time,s=Math.round(1e3*t.currentTime-this._lastCheck500CurrntTime);(0==this._lastCheck500Time||i>=500)&&(0!=this._lastCheck500Time&&i-s>=f.a.pause500Cfg[0]&&(v.a.log("MSEPauseWorker.check.500ms check500Delta=".concat(i,", check500CurrentTimeDelta=").concat(s,", pauseDelta=").concat(i-s)),this._mse.check500Pause()),this._lastCheck500CurrntTime=1e3*t.currentTime,this._lastCheck500Time=e)}this._playedTime=t.currentTime,this._lastCheckTime=e}}},{key:"_setPaused",value:function(e,t){this._paused=!0,this._pausedTs=e,this._lastPausedTs=e,this._log("_setPaused",t),this._callbacks.pause(e)}},{key:"_setResume",value:function(e,t){var i=e-this._pausedTs;this._paused=!1,this._pausedTs=0,this._lastPausedTs=0,this._log("_setResume",t),this._callbacks.resume(e,i)}},{key:"_log",value:function(e,t,i){this._mse.video.printBuffered(),v.a.log("MSEPauseWorker(".concat(this._mse._num_,").").concat(e," readyState=").concat(t.readyState," currentTime=").concat(t.currentTime," buf=").concat(this._mse.getBufferLen()," dts=").concat(this._mse.getCurrentDts()," ").concat(i||""))}},{key:"paused",get:function(){return this._paused}},{key:"pausedTs",get:function(){return this._pausedTs}}]),e}(),tr=function(){function e(t){Object(s.a)(this,e),t&&t.xhrSetup&&(this.xhrSetup=t.xhrSetup)}return Object(a.a)(e,[{key:"destroy",value:function(){this.abort(),this.loader=null}},{key:"abort",value:function(){this.loader&&(this.stats.aborted=!0,this.loader.abort()),this.timeoutHandle&&window.clearTimeout(this.timeoutHandle)}},{key:"load",value:function(e,t,i,s,r,a,n,o){var h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.url=e,this.responseType=t,this.onSuccess=i,this.onError=s,this.onTimeout=r,this.onProgress=h,this.stats={trequest:performance.now(),retry:0},this.timeout=a,this.maxRetry=n,this.retryDelay=o,this.timeoutHandle=window.setTimeout(this.loadtimeout.bind(this),a),this.loadInternal()}},{key:"loadBuffer",value:function(e,t,i,s,r,a,n,o,h){this.onOpen=t,this.load(e,"arraybuffer",(function(e){var t=e.target;return s(t.response)}),r,a,n,o,h)}},{key:"loadInternal",value:function(){var e=this.loader=new XMLHttpRequest;e.onload=this.loadsuccess.bind(this),e.onerror=this.loaderror.bind(this),e.onprogress=this.loadprogress.bind(this),e.onloadend=this.loadend.bind(this),e.onloadstart=this.loadstart.bind(this),e.responseType=this.responseType,e.open("GET",this.url,!0),null!=this.fromByte&&null!=this.toByte&&e.setRequestHeader("Range","bytes="+this.fromByte+"-"+this.toByte),this.stats.tstart=null,this.stats.loaded=0,this.xhrSetup&&this.xhrSetup(e),this.stats.tstart=performance.now(),e.send()}},{key:"loadsuccess",value:function(e){404===e.currentTarget.status?this.onError(e):(window.clearTimeout(this.timeoutHandle),this.stats.tload=performance.now(),e.requestURL=this.url,this.onSuccess(e,this.stats))}},{key:"loaderror",value:function(e){if(404===e.currentTarget.status||0===e.currentTarget.status)return window.clearTimeout(this.timeoutHandle),void this.onError(e);this.stats.retry<this.maxRetry?(v.a.warn("XhrLoader.loaderror url="+this.url+" retryDelay="+this.retryDelay),this.destroy(),window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,64e3),this.stats.retry++):(window.clearTimeout(this.timeoutHandle),v.a.warn("XhrLoader.loaderror reach max retry url="+this.url),this.onError(e))}},{key:"loadtimeout",value:function(){this.stats.retry<this.maxRetry?(v.a.warn("XhrLoader.loadtimeout url="+this.url+" retryDelay="+this.retryDelay),this.destroy(),window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,64e3),this.stats.retry++):(window.clearTimeout(this.timeoutHandle),v.a.warn("XhrLoader.loadtimeout max retry url="+this.url),this.onTimeout(this.loader))}},{key:"loadstart",value:function(){this.onOpen&&this.onOpen()}},{key:"loadprogress",value:function(e){var t=this.stats;null===t.tfirst&&(t.tfirst=performance.now()),t.loaded=e.loaded,this.onProgress&&this.onProgress(e,t)}},{key:"loadend",value:function(e){404===e.currentTarget.status&&this.loaderror(e)}},{key:"getResponseHeader",value:function(e){return this.loader&&this.loader.getResponseHeader&&this.loader.getResponseHeader(e)}},{key:"getLoaderHandler",value:function(){return this.loader}}]),e}(),ir=function(){function e(){Object(s.a)(this,e),this.buffer=null,this.view=null,this.size=0,this.pos=0}return Object(a.a)(e,[{key:"destroy",value:function(){this.buffer=null,this.view=null,this.size=0,this.pos=0}},{key:"appendBuffer",value:function(e){e=new Uint8Array(e);var t=new Uint8Array(this.size+e.length);this.buffer&&t.set(this.buffer,0),t.set(e,this.size),this.size=t.byteLength,this.buffer=t,this.view=new DataView(t.buffer)}},{key:"peekString",value:function(e,t){for(var i=this.pos+e,s="",r=0;r<t;r++)s+=String.fromCharCode(this.view.getUint8(i+r));return s}},{key:"peekBuffer",value:function(e,t){return e=this.pos+e,new Uint8Array(this.view.buffer.slice(e,Math.min(e+t,this.size)))}},{key:"peekAnyInt",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=0;if(this.pos+t<=this.size){switch(t){case 1:s=i?this.view.getInt8(this.pos):this.view.getUint8(this.pos);break;case 2:s=i?this.view.getInt16(this.pos):this.view.getUint16(this.pos);break;case 3:if(i)throw"peekAnyInt signed 24 bits values wrong";s=this.view.getUint8(this.pos)<<16,s|=this.view.getUint8(this.pos+1)<<8,s|=this.view.getUint8(this.pos+2);break;case 4:s=i?this.view.getInt32(this.pos):this.view.getUint32(this.pos);break;case 8:if(i)throw"peekAnyInt signed 64 bits values wrong";s=this.view.getUint32(this.pos)*e.MAX_UINT+this.view.getUint32(this.pos+4);break;default:throw"peekAnyInt not implemented for size: "+t}return s}throw"Not enough bytes in buffer"}},{key:"readUint8",value:function(){var e=this.peekAnyInt(1);return this.pos++,e}},{key:"readUint16",value:function(){var e=this.peekAnyInt(2);return this.pos+=2,e}},{key:"readUint24",value:function(){var e=this.peekAnyInt(3);return this.pos+=3,e}},{key:"readUint32",value:function(){var e=this.peekAnyInt(4);return this.pos+=4,e}},{key:"readInt32",value:function(){var e=this.peekAnyInt(4,!0);return this.pos+=4,e}},{key:"readUint64",value:function(){var e=this.peekAnyInt(8);return this.pos+=8,e}},{key:"readStr",value:function(e){var t=this.peekString(0,e);return this.pos+=e,t}},{key:"skip",value:function(e){this.pos+=e}},{key:"getPos",value:function(){return this.pos}},{key:"isCanRead",value:function(e){return this.size-this.pos>=e}}],[{key:"writeUint64",value:function(t,i,s){var r=Math.floor(s/e.MAX_UINT),a=4294967295&s;t.setUint32(i,r),t.setUint32(i+4,a)}}]),e}();ir.MAX_UINT=Math.pow(2,32);var sr=ir,rr=function(){function e(){Object(s.a)(this,e),this.startOffset=0,this.size=0,this.type=""}return Object(a.a)(e,[{key:"destroy",value:function(){}},{key:"read",value:function(e){this.startOffset=e.getPos(),this.size=e.readUint32(),this.type=e.readStr(4)}},{key:"readContainer",value:function(e){for(var t=this.size+e.getPos()-8;e.getPos()<t;){var i=e.peekString(4,4),s=gr.createBox(i);s.read(e),this.onReadBox(s)}}},{key:"onReadBox",value:function(e){}},{key:"remux",value:function(){return null}},{key:"fillHeader",value:function(e,t,i,s){t.setUint32(0,s),e.set(gr.getCharCode(i),4)}},{key:"getSize",value:function(){return 8}}]),e}(),ar=function(e){Object(M.a)(i,e);var t=Object(U.a)(i);function i(){var e;return Object(s.a)(this,i),(e=t.call(this)).major_brand="",e.minor_version=0,e.compatible_brands="",e}return Object(a.a)(i,[{key:"getSize",value:function(){return N(Object(B.a)(i.prototype),"getSize",this).call(this)+4+4+this.compatible_brands.length}},{key:"read",value:function(e){N(Object(B.a)(i.prototype),"read",this).call(this,e),this.major_brand=e.readStr(4),this.minor_version=e.readUint32(),this.compatible_brands=e.readStr(this.size-16)}},{key:"remux",value:function(){var e=this.getSize(),t=new Uint8Array(e),i=new DataView(t.buffer);this.fillHeader(t,i,gr.STYP,e);var s=8;return this.fillStr(t,s,this.major_brand),s+=4,i.setUint32(s,this.minor_version),s+=4,this.fillStr(t,s,this.compatible_brands),t}},{key:"fillStr",value:function(e,t,i){for(var s=0;s<i.length;s++)e[t+s]=i.charCodeAt(s)}}]),i}(rr),nr=function(e){Object(M.a)(i,e);var t=Object(U.a)(i);function i(){var e;return Object(s.a)(this,i),(e=t.call(this)).version=0,e.flags=0,e}return Object(a.a)(i,[{key:"read",value:function(e){N(Object(B.a)(i.prototype),"read",this).call(this,e),this.version=e.readUint8(),this.flags=e.readUint24()}},{key:"fillHeader",value:function(e,t,s,r){N(Object(B.a)(i.prototype),"fillHeader",this).call(this,e,t,s,r),e[8]=this.version,e[9]=this.flags>>16&255,e[10]=this.flags>>8&255,e[11]=255&this.flags}},{key:"getSize",value:function(){return N(Object(B.a)(i.prototype),"getSize",this).call(this)+4}}]),i}(rr),or=function(e){Object(M.a)(i,e);var t=Object(U.a)(i);function i(){var e;return Object(s.a)(this,i),(e=t.call(this)).reference_id=0,e.time_scale=0,e.earliest_presentation_time=0,e.first_offset=0,e.reserved=0,e.reference_count=0,e.reference_list=[],e.reference_data=[],e.earliest_presentation_time_offset=0,e}return Object(a.a)(i,[{key:"destroy",value:function(){this.reference_list=[],this.reference_data=[],N(Object(B.a)(i.prototype),"destroy",this).call(this)}},{key:"updateReference",value:function(e){if(this.reference_count>0){var t=e.trun.getRemuxSampleCnt(),i=this.reference_list[0];i.referenced_size=e.trun.getMdatSize(),i.subsegment_duration=t*e.tfhd.default_sample_duration}}},{key:"updateEarliestPresentationTime",value:function(e){var t=e.trun.getRemuxSampleCnt();this.earliest_presentation_time_offset=t*e.tfhd.default_sample_duration}},{key:"read",value:function(e){N(Object(B.a)(i.prototype),"read",this).call(this,e),this.reference_id=e.readUint32(),this.time_scale=e.readUint32(),0===this.version?(this.earliest_presentation_time=e.readUint32(),this.first_offset=e.readUint32()):(this.earliest_presentation_time=e.readUint64(),this.first_offset=e.readUint64()),this.reserved=e.readUint16(),this.reference_count=e.readUint16();for(var t=0;t<this.reference_count;t++){var s={},r=e.readUint32();this.reference_data.push(r),s.reference_type=r>>31&1,s.referenced_size=2147483647&r,s.subsegment_duration=e.readUint32(),this.reference_data.push(s.subsegment_duration),r=e.readUint32(),this.reference_data.push(r),s.starts_with_SAP=r>>31&1,s.SAP_type=r>>28&7,s.SAP_delta_time=268435455&r,this.reference_list.push(s)}}},{key:"getSize",value:function(){var e=N(Object(B.a)(i.prototype),"getSize",this).call(this);return e+=4,e+=4,e+=0===this.version?8:16,e+=2,(e+=2)+12*this.reference_count}},{key:"remux",value:function(){var e=this.getSize(),t=new Uint8Array(e),i=new DataView(t.buffer);this.fillHeader(t,i,gr.SIDX,e);var s=12;i.setUint32(s,this.reference_id),s+=4,i.setUint32(s,this.time_scale),s+=4,0===this.version?(i.setUint32(s,this.earliest_presentation_time+this.earliest_presentation_time_offset),s+=4,i.setUint32(s,this.first_offset),s+=4):(sr.writeUint64(i,s,this.earliest_presentation_time+this.earliest_presentation_time_offset),s+=8,sr.writeUint64(i,s,this.first_offset),s+=8),i.setUint16(s,this.reserved),s+=2,i.setUint16(s,this.reference_count),s+=2;for(var r=0;r<this.reference_data.length;r++)i.setUint32(s,this.reference_data[r]),s+=4;return t}}]),i}(nr),hr=function(e){Object(M.a)(i,e);var t=Object(U.a)(i);function i(){var e;return Object(s.a)(this,i),(e=t.call(this)).mfhd=null,e.trafVideo=null,e.trafAudio=null,e}return Object(a.a)(i,[{key:"destroy",value:function(){this.mfhd.destroy(),this.trafVideo.destroy(),this.trafAudio.destroy(),this.mfhd=null,this.trafVideo=null,this.trafAudio=null,N(Object(B.a)(i.prototype),"destroy",this).call(this)}},{key:"read",value:function(e){N(Object(B.a)(i.prototype),"read",this).call(this,e),this.readContainer(e),this.trafVideo.trun.data_offset>this.trafAudio.trun.data_offset?(this.trafAudio.calcSampleMdatDataOffset(0),this.trafVideo.calcSampleMdatDataOffset(this.trafAudio.getSampleDataSize())):(this.trafVideo.calcSampleMdatDataOffset(0),this.trafAudio.calcSampleMdatDataOffset(this.trafVideo.getSampleDataSize()))}},{key:"onReadBox",value:function(e){e.type===gr.MFHD?this.mfhd=e:e.type===gr.TRAF&&(e.isVideo()?this.trafVideo=e:this.trafAudio=e)}},{key:"readMdat",value:function(e){this.trafVideo&&this.trafVideo.readMdat(e),this.trafAudio&&this.trafAudio.readMdat(e)}},{key:"getSize",value:function(){return N(Object(B.a)(i.prototype),"getSize",this).call(this)+this.mfhd.getSize()+this.trafVideo.getSize()+this.trafAudio.getSize()}},{key:"remux",value:function(){var e=this.mfhd.remux(),t=this.trafVideo.remux(),i=this.trafAudio.remux(),s=this.getSize(),r=new Uint8Array(s),a=new DataView(r.buffer);this.fillHeader(r,a,gr.MOOF,s);var n=8;return r.set(e,n),n+=e.length,r.set(t,n),n+=t.length,r.set(i,n),n+=i.length,r}},{key:"updateMdatDataOffset",value:function(){var e=this.getSize();e+=8,this.trafVideo.trun.remux_data_offset=e,this.trafAudio.trun.remux_data_offset=e+this.trafVideo.trun.getMdatSize()}},{key:"updateBaseMediaDecodeTime",value:function(){this.trafVideo.updateBaseMediaDecodeTime(),this.trafAudio.updateBaseMediaDecodeTime()}}]),i}(rr),ur=function(e){Object(M.a)(i,e);var t=Object(U.a)(i);function i(){var e;return Object(s.a)(this,i),(e=t.call(this)).sequence_number=0,e}return Object(a.a)(i,[{key:"read",value:function(e){N(Object(B.a)(i.prototype),"read",this).call(this,e),this.sequence_number=e.readUint32()}},{key:"getSize",value:function(){return N(Object(B.a)(i.prototype),"getSize",this).call(this)+4}},{key:"remux",value:function(){var e=this.getSize(),t=new Uint8Array(e),i=new DataView(t.buffer);return this.fillHeader(t,i,gr.MFHD,e),i.setUint32(12,this.sequence_number),t}}]),i}(nr),lr=function(e){Object(M.a)(i,e);var t=Object(U.a)(i);function i(){var e;return Object(s.a)(this,i),(e=t.call(this)).tfhd=null,e.tfdt=null,e.trun=null,e}return Object(a.a)(i,[{key:"destroy",value:function(){this.tfhd.destroy(),this.tfdt.destroy(),this.trun.destroy(),this.tfhd=null,this.tfdt=null,this.trun=null,N(Object(B.a)(i.prototype),"destroy",this).call(this)}},{key:"isVideo",value:function(){return 1===this.tfhd.track_id}},{key:"getDuration",value:function(){return this.trun.sampleMdatIndex*this.tfhd.default_sample_duration}},{key:"getSampleDataSize",value:function(){return this.trun?this.trun.getSampleDataSize(this.tfhd):0}},{key:"calcSampleMdatDataOffset",value:function(e){this.trun.calcSampleMdatDataOffset(e,this.tfhd)}},{key:"readMdat",value:function(e){this.trun&&this.trun.readMdat(e,this.tfhd)}},{key:"read",value:function(e){N(Object(B.a)(i.prototype),"read",this).call(this,e),this.readContainer(e)}},{key:"onReadBox",value:function(e){e.type===gr.TFHD?this.tfhd=e:e.type===gr.TFDT?this.tfdt=e:e.type===gr.TRUN&&(this.trun=e)}},{key:"getSize",value:function(){return N(Object(B.a)(i.prototype),"getSize",this).call(this)+this.tfhd.getSize()+this.tfdt.getSize()+this.trun.getSize()}},{key:"remux",value:function(){var e=this.getSize(),t=new Uint8Array(e),i=new DataView(t.buffer);this.fillHeader(t,i,gr.TRAF,e);var s=this.tfhd.remux(),r=this.tfdt.remux(),a=this.trun.remux(),n=8;return t.set(s,n),n+=s.length,t.set(r,n),n+=r.length,t.set(a,n),n+=a.length,t}},{key:"updateBaseMediaDecodeTime",value:function(){var e=this.trun.getRemuxSampleCnt();this.tfdt.base_media_decode_time_offset=e*this.tfhd.default_sample_duration}}]),i}(rr),dr=function(e){Object(M.a)(i,e);var t=Object(U.a)(i);function i(){var e;return Object(s.a)(this,i),(e=t.call(this)).track_id=0,e.base_data_offset=0,e.sample_description_index=0,e.default_sample_duration=0,e.default_sample_size=0,e.default_sample_flags=0,e}return Object(a.a)(i,[{key:"read",value:function(e){N(Object(B.a)(i.prototype),"read",this).call(this,e),this.track_id=e.readUint32(),this.flags&i.FLAG_BASE_DATA_OFFSET&&(this.base_data_offset=e.readUint64()),this.flags&i.FLAG_SAMPLE_DESC&&(this.sample_description_index=e.readUint32()),this.flags&i.FLAG_SAMPLE_DUR&&(this.default_sample_duration=e.readUint32()),this.flags&i.FLAG_SAMPLE_SIZE&&(this.default_sample_size=e.readUint32()),this.flags&i.FLAG_SAMPLE_FLAGS&&(this.default_sample_flags=e.readUint32())}},{key:"getSize",value:function(){var e=N(Object(B.a)(i.prototype),"getSize",this).call(this);return e+=4,this.flags&i.FLAG_BASE_DATA_OFFSET&&(e+=8),this.flags&i.FLAG_SAMPLE_DESC&&(e+=4),this.flags&i.FLAG_SAMPLE_DUR&&(e+=4),this.flags&i.FLAG_SAMPLE_SIZE&&(e+=4),this.flags&i.FLAG_SAMPLE_FLAGS&&(e+=4),e}},{key:"remux",value:function(){var e=this.getSize(),t=new Uint8Array(e),s=new DataView(t.buffer);this.fillHeader(t,s,gr.TFHD,e),s.setUint32(12,this.track_id);var r=16;return this.flags&i.FLAG_BASE_DATA_OFFSET&&(sr.writeUint64(s,r,this.base_data_offset),r+=8),this.flags&i.FLAG_SAMPLE_DESC&&(s.setUint32(r,this.sample_description_index),r+=4),this.flags&i.FLAG_SAMPLE_DUR&&(s.setUint32(r,this.default_sample_duration),r+=4),this.flags&i.FLAG_SAMPLE_SIZE&&(s.setUint32(r,this.default_sample_size),r+=4),this.flags&i.FLAG_SAMPLE_FLAGS&&(s.setUint32(r,this.default_sample_flags),r+=4),t}}]),i}(nr);dr.FLAG_BASE_DATA_OFFSET=1,dr.FLAG_SAMPLE_DESC=2,dr.FLAG_SAMPLE_DUR=8,dr.FLAG_SAMPLE_SIZE=16,dr.FLAG_SAMPLE_FLAGS=32,dr.FLAG_DUR_EMPTY=65536,dr.FLAG_DEFAULT_BASE_IS_MOOF=131072;var cr=dr,pr=function(e){Object(M.a)(i,e);var t=Object(U.a)(i);function i(){var e;return Object(s.a)(this,i),(e=t.call(this)).base_media_decode_time=0,e.base_media_decode_time_offset=0,e}return Object(a.a)(i,[{key:"read",value:function(e){N(Object(B.a)(i.prototype),"read",this).call(this,e),1===this.version?this.base_media_decode_time=e.readUint64():this.base_media_decode_time=e.readUint32()}},{key:"getSize",value:function(){return N(Object(B.a)(i.prototype),"getSize",this).call(this)+(1===this.version?8:4)}},{key:"remux",value:function(){var e=this.getSize(),t=new Uint8Array(e),i=new DataView(t.buffer);return this.fillHeader(t,i,gr.TFDT,e),1===this.version?sr.writeUint64(i,12,this.base_media_decode_time+this.base_media_decode_time_offset):i.setUint32(12,this.base_media_decode_time+this.base_media_decode_time_offset),t}}]),i}(nr),fr=function(){function e(){Object(s.a)(this,e),this.sample_duration=0,this.sample_size=0,this.sample_flags=0,this.sample_composition_time_offset=0,this.dataOffset=0,this.units=null}return Object(a.a)(e,[{key:"destroy",value:function(){this.units=null}}]),e}(),mr=function(e){Object(M.a)(i,e);var t=Object(U.a)(i);function i(){var e;return Object(s.a)(this,i),(e=t.call(this)).sample_count=0,e.data_offset=0,e.first_sample_flags=0,e.samples=[],e.sampleMdatIndex=0,e.sampleMdatSize=0,e.remuxSampleStart=0,e.remuxSampleEnd=0,e.remux_data_offset=0,e}return Object(a.a)(i,[{key:"destroy",value:function(){this.samples.forEach((function(e){e.destroy()})),this.samples=[],N(Object(B.a)(i.prototype),"destroy",this).call(this)}},{key:"createEmptySamples",value:function(e){this.remuxSampleEnd=e;for(var t=0;t<e;t++){var i=this.samples[t];i.units=new Uint8Array(Hs.emptyAacFrame),i.sample_size=i.units.length}this.sampleMdatIndex=e}},{key:"readMdat",value:function(e,t){for(;this.sampleMdatIndex<this.sample_count;){var i=this.samples[this.sampleMdatIndex];if(!e.readSample(i,t))break;this.sampleMdatIndex++}}},{key:"read",value:function(e){N(Object(B.a)(i.prototype),"read",this).call(this,e),this.sample_count=e.readUint32(),this.flags&i.FLAGS_DATA_OFFSET&&(this.data_offset=e.readUint32()),this.flags&i.FLAGS_FIRST_FLAG&&(this.first_sample_flags=e.readUint32());for(var t=0;t<this.sample_count;t++){var s=new fr(this.flags);this.flags&i.FLAGS_DURATION&&(s.sample_duration=e.readUint32()),this.flags&i.FLAGS_SIZE&&(s.sample_size=e.readUint32()),this.flags&i.FLAGS_FLAGS&&(s.sample_flags=e.readUint32()),this.flags&i.FLAGS_CTS_OFFSET&&(0===this.version?s.sample_composition_time_offset=e.readUint32():s.sample_composition_time_offset=e.readInt32()),this.sampleMdatSize+=s.sample_size,this.samples.push(s)}}},{key:"calcSampleMdatDataOffset",value:function(e,t){for(var i=0;i<this.sample_count;i++){var s=this.samples[i];s.dataOffset=e,0===s.sample_size?e+=t.default_sample_size:e+=s.sample_size}}},{key:"getRemuxSampleCnt",value:function(){return this.remuxSampleEnd-this.remuxSampleStart}},{key:"getSize",value:function(){var e=N(Object(B.a)(i.prototype),"getSize",this).call(this);return e+=4,this.flags&i.FLAGS_DATA_OFFSET&&(e+=4),this.flags&i.FLAGS_FIRST_FLAG&&(e+=4),e+(this.remuxSampleEnd-this.remuxSampleStart)*this.getSampleSize()}},{key:"getSampleDataSize",value:function(e){for(var t=0,i=0;i<this.sample_count;i++){var s=this.samples[i];0===s.sample_size?t+=e.default_sample_size:t+=s.sample_size}return t}},{key:"getSampleSize",value:function(){var e=0;return this.flags&i.FLAGS_DURATION&&(e+=4),this.flags&i.FLAGS_SIZE&&(e+=4),this.flags&i.FLAGS_FLAGS&&(e+=4),this.flags&i.FLAGS_CTS_OFFSET&&(e+=4),e}},{key:"getMdatSize",value:function(){for(var e=0,t=this.remuxSampleStart;t<this.remuxSampleEnd;t++)e+=this.samples[t].units.length;return e}},{key:"getMdat",value:function(){for(var e=this.getMdatSize(),t=0,i=new Uint8Array(e),s=this.remuxSampleStart;s<this.remuxSampleEnd;s++){var r=this.samples[s];i.set(r.units,t),t+=r.units.length}return i}},{key:"remux",value:function(){var e=this.getSize(),t=new Uint8Array(e),s=new DataView(t.buffer);this.fillHeader(t,s,gr.TRUN,e),s.setUint32(12,this.remuxSampleEnd-this.remuxSampleStart);var r=16;this.flags&i.FLAGS_DATA_OFFSET&&(s.setUint32(r,this.remux_data_offset),r+=4),this.flags&i.FLAGS_FIRST_FLAG&&(s.setUint32(r,this.first_sample_flags),r+=4);for(var a=this.remuxSampleStart;a<this.remuxSampleEnd;a++){var n=this.samples[a];this.flags&i.FLAGS_DURATION&&(s.setUint32(r,n.sample_duration),r+=4),this.flags&i.FLAGS_SIZE&&(s.setUint32(r,n.sample_size),r+=4),this.flags&i.FLAGS_FLAGS&&(s.setUint32(r,n.sample_flags),r+=4),this.flags&i.FLAGS_CTS_OFFSET&&(0===this.version?s.setUint32(r,n.sample_composition_time_offset):s.setInt32(r,n.sample_composition_time_offset),r+=4)}return t}}]),i}(nr);mr.FLAGS_DATA_OFFSET=1,mr.FLAGS_FIRST_FLAG=4,mr.FLAGS_DURATION=256,mr.FLAGS_SIZE=512,mr.FLAGS_FLAGS=1024,mr.FLAGS_CTS_OFFSET=2048;var _r=mr,yr=function(e){Object(M.a)(i,e);var t=Object(U.a)(i);function i(e){var r;return Object(s.a)(this,i),(r=t.call(this)).data_len=0,r.data_size=e-8,r.data=new Uint8Array(r.data_size),r}return Object(a.a)(i,[{key:"isRecvFull",value:function(){return this.data_len>=this.data_size}},{key:"destroy",value:function(){this.data=null,N(Object(B.a)(i.prototype),"destroy",this).call(this)}},{key:"read",value:function(e){N(Object(B.a)(i.prototype),"read",this).call(this,e),e.skip(this.data_size)}},{key:"appendData",value:function(e){var t=e.peekBuffer(8,this.data_size);this.data_len=t.length,this.data.set(t,0)}},{key:"readSample",value:function(e,t){var i=e.sample_size;return 0===i&&(i=t.default_sample_size),this.data_len-e.dataOffset>=i&&(e.units=this.data.slice(e.dataOffset,e.dataOffset+i),!0)}},{key:"remux",value:function(){var e=8+this.data_len,t=new Uint8Array(e),i=new DataView(t.buffer);return this.fillHeader(t,i,gr.MDAT,e),t.set(this.data,8),t}}]),i}(rr),vr=function(e){Object(M.a)(i,e);var t=Object(U.a)(i);function i(){return Object(s.a)(this,i),t.call(this)}return Object(a.a)(i,[{key:"read",value:function(e){N(Object(B.a)(i.prototype),"read",this).call(this,e),e.skip(this.size-8)}}]),i}(rr),Sr=new Map,gr={STYP:"styp",SIDX:"sidx",MOOF:"moof",MFHD:"mfhd",TRAF:"traf",TFHD:"tfhd",TFDT:"tfdt",TRUN:"trun",MDAT:"mdat",createBox:function(e){return 0===Sr.size&&(Sr.set(this.STYP,ar),Sr.set(this.SIDX,or),Sr.set(this.MOOF,hr),Sr.set(this.MFHD,ur),Sr.set(this.TRAF,lr),Sr.set(this.TFHD,cr),Sr.set(this.TFDT,pr),Sr.set(this.TRUN,_r),Sr.set(this.MDAT,yr)),new(Sr.get(e)||vr)},getCharCode:function(e){for(var t=[],i=0;i<e.length;i++)t.push(e.charCodeAt(i));return t}},Tr=function(){function e(){Object(s.a)(this,e),this.buffer=new sr,this.styp=null,this.sidxVideo=null,this.sidxAudio=null,this.moof=null,this.mdat=null,this.step=0}return Object(a.a)(e,[{key:"destroy",value:function(){this.buffer.destroy(),this.styp.destroy(),this.sidxVideo.destroy(),this.sidxAudio.destroy(),this.moof.destroy(),this.mdat.destroy()}},{key:"isRecvFull",value:function(){return this.mdat&&this.mdat.isRecvFull()}},{key:"setFullRemux",value:function(){this.moof.trafVideo.trun.remuxSampleStart=0,this.moof.trafAudio.trun.remuxSampleStart=0,this.moof.trafVideo.trun.remuxSampleEnd=this.moof.trafVideo.trun.sample_count,this.moof.trafAudio.trun.remuxSampleEnd=this.moof.trafAudio.trun.sample_count,this.sidxVideo.earliest_presentation_time_offset=0,this.sidxAudio.earliest_presentation_time_offset=0,this.moof.trafVideo.tfdt.base_media_decode_time_offset=0,this.moof.trafAudio.tfdt.base_media_decode_time_offset=0}},{key:"setRemuxAll",value:function(){this.moof.trafVideo.trun.remuxSampleStart=this.moof.trafVideo.trun.remuxSampleEnd,this.moof.trafAudio.trun.remuxSampleStart=this.moof.trafAudio.trun.remuxSampleEnd,this.moof.trafVideo.trun.remuxSampleEnd=this.moof.trafVideo.trun.sample_count,this.moof.trafAudio.trun.remuxSampleEnd=this.moof.trafAudio.trun.sample_count}},{key:"isCanSecOpen",value:function(e){if(this.moof){var t=1e3*this.moof.trafVideo.getDuration()/this.sidxVideo.time_scale;if(t>=e){this.moof.trafVideo.trun.remuxSampleEnd=this.moof.trafVideo.trun.sampleMdatIndex;var i=Math.ceil(t*this.sidxAudio.time_scale/1e3/this.moof.trafAudio.tfhd.default_sample_duration);return i=Math.min(i,this.moof.trafAudio.trun.sample_count),this.moof.trafAudio.trun.createEmptySamples(i),!0}}return!1}},{key:"appendBuffer",value:function(e){this.buffer.appendBuffer(e),this.parse()}},{key:"parse",value:function(){for(;this.buffer.isCanRead(8);){var e=this.buffer.peekAnyInt(4),t=this.buffer.peekString(4,4);if(t===gr.MDAT){if(this.mdat||(this.mdat=new yr(e)),this.mdat.appendData(this.buffer),this.moof&&this.moof.readMdat(this.mdat),!this.buffer.isCanRead(e))break;this.mdat.read(this.buffer)}else{if(!this.buffer.isCanRead(e))break;var i=gr.createBox(t);i.read(this.buffer),t===gr.STYP?this.styp=i:t===gr.SIDX?1===i.reference_id?this.sidxVideo=i:this.sidxAudio=i:t===gr.MOOF&&(this.moof=i)}}}},{key:"remux",value:function(){this.moof.updateMdatDataOffset(),this.sidxVideo.updateReference(this.moof.trafVideo),this.sidxAudio.updateReference(this.moof.trafAudio);var e=this.styp.remux(),t=this.sidxVideo.remux(),i=this.sidxAudio.remux(),s=this.moof.remux(),r=this.moof.trafVideo.trun.getMdat(),a=this.moof.trafAudio.trun.getMdat(),n=8+r.length+a.length,o=new Uint8Array(e.length+t.length+i.length+s.length+n),h=0;return o.set(e,h),h+=e.length,o.set(i,h),h+=i.length,o.set(t,h),h+=t.length,o.set(s,h),o[h+=s.length]=n>>24&255,o[h+1]=n>>16&255,o[h+2]=n>>8&255,o[h+3]=255&n,h+=4,o.set(gr.getCharCode(gr.MDAT),h),h+=4,o.set(r,h),h+=r.length,o.set(a,h),this.sidxVideo.updateEarliestPresentationTime(this.moof.trafVideo),this.sidxAudio.updateEarliestPresentationTime(this.moof.trafAudio),this.moof.updateBaseMediaDecodeTime(),o}}]),e}(),Pr=function(){function e(t){Object(s.a)(this,e),this.mse=t,this.mediaSource=null,this.buffer=null,this.segments=[],this.initSegment=null,this.initUrl="",this.config=null,this.initPhase=0,this.initLoader=null,this.onUpdateendBind=this.onUpdateend.bind(this),this.onErrorBind=this.onError.bind(this),this.loadOpenBind=this.loadOpen.bind(this),this.loadChunkBind=this.loadChunk.bind(this),this.loadSuccessBind=this.loadSuccess.bind(this),this.loadErrorBind=this.loadError.bind(this),this.loadTimeoutBind=this.loadTimeout.bind(this),this.onInitOpenCb=null,this.onInitCallback=null,this.onFirstBufCb=null,this.mp4=null,this.firstPlay=!0,this.checkCurrentTime=!1}return Object(a.a)(e,[{key:"reset",value:function(){v.a.log("Av1Player.reset"),this.buffer&&(this.buffer.removeEventListener("updateend",this.onUpdateendBind),this.buffer.removeEventListener("error",this.onErrorBind),this.buffer=null),this.initLoader&&this.initLoader.abort(),this.onInitOpenCb=null,this.onInitCallback=null,this.mediaSource=null,this.segments=[]}},{key:"destroy",value:function(){v.a.log("Av1Player.destroy"),this.reset(),this.initSegment=null,this.initPhase=0,this.tryCnt=5,this.initUrl="",this.config=null,this.mse=null,this.onFirstBufCb=null}},{key:"isPlaying",value:function(){return null!=this.buffer}},{key:"isInitLoaded",value:function(){return 2===this.initPhase}},{key:"initError",value:function(){3!==this.initPhase&&(this.initPhase=3,this.onError({message:"load init.mp4=404"}))}},{key:"loadInit",value:function(e,t,i){var s=i.initCb,r=i.openCb;if(0===this.initPhase){v.a.log("M4sPlayer.loadInit"),this.initPhase=1,this.initUrl=e,this.config=t,this.onInitCallback=s,this.onInitOpenCb=r;var a=new tr(t);this.initLoader=a,a.loadBuffer(e,this.loadOpenBind,this.loadChunkBind,this.loadSuccessBind,this.loadErrorBind,this.loadTimeoutBind,2e3,t.fragLoadingMaxRetry,t.fragLoadingRetryDelay)}}},{key:"loadOpen",value:function(e){this.onInitOpenCb&&(this.onInitOpenCb(),this.onInitOpenCb=null)}},{key:"loadChunk",value:function(e){}},{key:"loadSuccess",value:function(e){v.a.log("M4sPlayer.loadSuccess init"),this.initPhase=2,this.initSegment=e,this._initCodecs(),this._appendInit(),this.onInitCallback&&(this.onInitCallback(),this.onInitCallback=null)}},{key:"loadError",value:function(e){e.code,e.currentTarget,e.msg,this.initError()}},{key:"loadTimeout",value:function(e){this.initError()}},{key:"onMediaSourceOpen",value:function(e){this.mediaSource=e,this._initCodecs(),this._appendInit()}},{key:"createMp4",value:function(){this.mp4&&(this.mp4.destroy(),this.mp4=null),this.mp4=new Tr}},{key:"appendSegment",value:function(e){var t=this.mp4;t.appendBuffer(e);var i=!1;this.firstPlay?t.isCanSecOpen(200)&&(t.step=1,this.firstPlay=!1,i=!0):t.isRecvFull()&&(1==t.step&&(t.step=2),i=!0,t.setFullRemux()),i&&(v.a.log("M4sPlayer.appendSegment video=[".concat(t.moof.trafVideo.trun.remuxSampleStart,", ").concat(t.moof.trafVideo.trun.remuxSampleEnd,"] audio=[").concat(t.moof.trafAudio.trun.remuxSampleStart,", ").concat(t.moof.trafAudio.trun.remuxSampleEnd,"]")),e=t.remux(),this.segments.push({segment:e,step:t.step}),this._appendBuffer())}},{key:"_appendInit",value:function(){this.initSegment&&this.buffer&&this.buffer.appendBuffer(this.initSegment)}},{key:"_appendBuffer",value:function(){if(this.initSegment&&this.segments.length>0&&this.buffer&&!this.buffer.updating){this.onFirstBufCb&&this.onFirstBufCb();var e=this.segments.shift(),t=e.segment;this.checkCurrentTime=2===e.step,this.buffer.appendBuffer(t)}}},{key:"_initCodecs",value:function(){!this.buffer&&this.mediaSource&&2===this.initPhase&&(v.a.log("M4sPlayer._initCodecs"),this.buffer=this.mediaSource.addSourceBuffer("video/mp4;codecs=".concat(Ei.a.AV01)),this.buffer.addEventListener("updateend",this.onUpdateendBind),this.buffer.addEventListener("error",this.onErrorBind))}},{key:"onUpdateend",value:function(){this.mse.checkSeek(),this.checkCurrentTime&&(v.a.log("M4sPlayer.onUpdateend checkCurrentTime"),this.checkCurrentTime=!1,this.mse.checkCurrentTime()),this._appendBuffer()}},{key:"onError",value:function(e){v.a.log("M4sPlayer.onError ".concat(e.message)),this.mse&&this.mse.onM4sError()}},{key:"hasVideo",value:function(){return!!this.buffer}}]),e}(),Er=0,Cr=function(e){Object(M.a)(i,e);var t=Object(U.a)(i);function i(e,r){var a;Object(s.a)(this,i),a=t.call(this,e,r,V.a.PLAYER_CORE_TYPE.MSE);var n=r.videoType,o=void 0===n?"flv":n,h=r.videoElement,u=void 0===h?null:h,l=r.h265Proxy;r.ignoreSei,r.closeFetch,a.pushVideoStartRenderTime=0,a.h265Proxy=l,a.videoElement=u,a.requestAnimationId=-1,a._num_=++Er,v.a.log("MSEPlayer(".concat(a._num_,").constructor")),"ts"===o||(a.parser=new Ts(Object(L.a)(a),a.remuxer,1),a.parser.repairSameDts=1==f.a.repairSameDts,a.ctrlBuffer.setBuffered(a.buffered),a.parser.dropFrameCtrl.setConfig({dropTime:f.a.dropTime,minFps:f.a.minFps}),a.parser2=new Ts(Object(L.a)(a),a.remuxer,2)),a.JITTER_BUFMIN=1e3,a.JITTER_BUFLEN=4e3,a.JITTER_BUFMAX=8e3,a.latencySeek=0,a.userPaused=!1,a._triggerPlay=!1,a.hasData=!1,a.playing=!1,a.lastPlayTime=0,a.lastCheckPlayTime=0,a.maxGop=0,a.playStartTime=0,a.delayReset=!1,a.isPlayerError=!1,a.isErrorEvent=!1,a.startPlayBackRate=.9,a.pausedByBrowser=!1,a.tryPlayAgainTimout=0,a.onUpdateErrorBind=a.onUpdateError.bind(Object(L.a)(a)),a.onAudioUpdateEndBind=a.onAudioUpdateEnd.bind(Object(L.a)(a)),a.onVideoUpdateEndBind=a.onVideoUpdateEnd.bind(Object(L.a)(a)),a.onMediaSourceOpenBind=a.onMediaSourceOpen.bind(Object(L.a)(a)),a.onVideoErrorBind=a.onVideoError.bind(Object(L.a)(a)),a.onVideoPauseBind=a.onVideoPause.bind(Object(L.a)(a)),a.onVideoPlayBind=a.onVideoPlay.bind(Object(L.a)(a)),a.onVideoLoadedBind=a.onVideoLoaded.bind(Object(L.a)(a)),a.checkVideoPlayingBind=a.checkVideoPlaying.bind(Object(L.a)(a)),a.onVideoPlayingBind=a.onVideoPlaying.bind(Object(L.a)(a)),a.onVideoResizeBind=a.onVideoResize.bind(Object(L.a)(a)),a.m4sPlayer=new Pr(Object(L.a)(a)),a.mediaSource=new MediaSource,a.mediaSource.addEventListener("sourceopen",a.onMediaSourceOpenBind),a.video=a.createVideo(),a.msePause=new Es(Object(L.a)(a),{pause:a._msePaused.bind(Object(L.a)(a)),resume:a._mseResume.bind(Object(L.a)(a))}),a.msePauseWorker=new er(Object(L.a)(a),{pause:a._msePausedWorker.bind(Object(L.a)(a)),resume:a._mseResumeWorker.bind(Object(L.a)(a))}),a.audioSourceBuffer=null,a.videoSourceBuffer=null,a.audioCodec=null,a.videoCodec=null,a.audioSegments=[],a.videoSegments=[],a.autoJitter=!0,a.autoBitrateJitter=!1,a.playbackrateChangeAccess=!0,a.enableLowLatency=!1,a.sensitivePause=!0,a.waitSwapToPcdn=!1,a.printJitter=!!Number(localStorage._printJitter);var d=navigator.userAgent.toLowerCase();return a.isAndroid=-1!==d.indexOf("Android"),-1==v.a.getLevel()&&window.chrome&&(window.chrome.mse=Object(L.a)(a)),a.videoDataAppended=!1,a.avcchangeCheckTimer=0,a.offsetDts=0,a.curVideoDts=0,a.curAudioDts=0,a.isOnFragParsed=!1,a.onFragParsedTime=0,a.isH265Play=!1,a.playRateIncrease=0,a.playRateDecrease=0,a.startPlayTime=0,a.isStartBuffer=!0,a.bufferCd=12e4,a.startCd=5e3,a.setVideoCurrentTime=0,a.startMoreBufferTime=0,a.bufferMoreContinueTime=6e4,a.maxJumpWaitNow=0,a.lastJumpBufferTs=0,a.mediaDelay=null,a.seiAnchorDelay=-1,a.discontinuityAudio=!1,a.discontinuityVideo=!1,a.isPlaybackRateNormal=!0,a.discontinuityTimeOffset=0,a.frameCallBackNums=0,a.lastFrameCallBackNums=0,a.mseRenderList=[],l&&l.initRender&&l.initRender(Object(L.a)(a)),a.renderList=[],a.renderHiddenTs=0,a.renderListFirst=!0,a.onInitSegmentCb=null,a}return Object(a.a)(i,[{key:"isM4sInitLoaded",value:function(){return this.m4sPlayer.isInitLoaded()}},{key:"loadM4sInit",value:function(e,t,i){this.m4sPlayer.loadInit(e,t,i)}},{key:"appendM4sSegment",value:function(e){this.setFragParsedTime(),this.m4sPlayer.appendSegment(e)}},{key:"onM4sError",value:function(){this._onErrorEvent(100),this._onPlayerError(!0)}},{key:"setParams",value:function(e,t){if(this.pid=e,this.bitrate=t,this._initPerf(),this.parser.dropFrameDts){var i=!1;(1===f.a.dropFrameUids[0]||-1!==f.a.dropFrameUids.indexOf(parseInt(e)))&&(i=!0),this.parser.dropFrameDts.open=i}this.parser.dropFrameDts.start()}},{key:"_initPerf",value:function(){"ts"!==this.videoType&&this.pausePerf.checkLocal(this.pid,this.bitrate)&&this.parser.dropFrameCtrl.start()}},{key:"getDelayStat",value:function(){return"ts"!==this.videoType?this.parser.sei.getStat():null}},{key:"getDelayInfo",value:function(){return v.a.log("MSEPlayer.getDelayInfo: delay: ",this.mediaDelay),this.mediaDelay}},{key:"getRealFps",value:function(){return this.parser.getRealFps?this.parser.getRealFps():0}},{key:"getIsDownEnough",value:function(){return!this.parser.isDownEnough||this.parser.isDownEnough()}},{key:"getRealBitrate",value:function(){var e=0;return this.parser.fps&&(e=this.parser.fps.getRealBitrate()),e}},{key:"destroy",value:function(){if(N(Object(B.a)(i.prototype),"destroy",this).call(this),v.a.log("MSEPlayer(".concat(this._num_,").destroy")),this.onMediaSourceOpenCallback=null,this.buffered.stop(),this.h265Proxy&&this.h265Proxy.stop(),this.playing=!1,this.lastPlayTime=0,this.playStartTime=0,this.lastCheckPlayTime=0,this.hasData=!1,this.handler&&this.handler.onVideoStop(this.video.video,this._hasVideo()),this.parser.destroy(),this.audioCodec=null,this.videoCodec=null,this.audioSegments=[],this.videoSegments=[],this.onInitSegmentCb=null,this.audioSourceBuffer&&(this.audioSourceBuffer.removeEventListener("updateend",this.onAudioUpdateEndBind),this.audioSourceBuffer.removeEventListener("error",this.onUpdateErrorBind),this.audioSourceBuffer=null),this.videoSourceBuffer&&(this.videoSourceBuffer.removeEventListener("updateend",this.onVideoUpdateEndBind),this.videoSourceBuffer.removeEventListener("error",this.onUpdateErrorBind),this.videoSourceBuffer=null),this.mediaSource){this.mediaSource.removeEventListener("sourceopen",this.onMediaSourceOpenBind);for(var e=this.mediaSource.sourceBuffers;e.length;)this.mediaSource.removeSourceBuffer(e[0]);this.mediaSource=this.onMediaSourceOpenBind=null}this.onAudioUpdateEndBind=this.onVideoUpdateEndBind=this.onUpdateErrorBind=null,this.video&&(this.video.destroy(),this.video=null),this.m4sPlayer&&(this.m4sPlayer.destroy(),this.m4sPlayer=null),this.videoElement=null,this.pushVideoStartRenderTime=0,this.playbackrateChangeAccess=!0,-1!==this.requestAnimationId&&(cancelAnimationFrame(this.requestAnimationId),this.requestAnimationId=-1),this.onFragParsedTime=0,Q.remove(this.triggerPlayVideo,this)}},{key:"clearSourceBuffer",value:function(){var e=this.video.video,t=0;if(e){var i=e.buffered.length;t=i>0?e.buffered.end(i-1):t}this.audioSourceBuffer&&!this.audioSourceBuffer.updating&&t>0&&this.audioSourceBuffer.remove(0,t),this.videoSourceBuffer&&!this.videoSourceBuffer.updating&&t>0&&this.videoSourceBuffer.remove(0,t)}},{key:"resetHls",value:function(){this.parser.pushAllData&&this.parser.pushAllData(),this.parser.reset&&this.parser.reset(),this.remuxer.reset(),this.remuxer.resetInitDts&&this.remuxer.resetInitDts(),this.clearSourceBuffer()}},{key:"reset",value:function(){if(v.a.log("MSEPlayer(".concat(this._num_,").reset")),this.handler.onVideoStop(this.video.video,!!this.videoSourceBuffer),this.userPaused=!1,this.playing=!1,this.lastPlayTime=0,this.playStartTime=0,this.lastCheckPlayTime=0,this.hasData=!1,this.audioCodec=null,this.videoCodec=null,this.audioSegments=[],this.videoSegments=[],this.discontinuityAudio=!1,this.discontinuityVideo=!1,this.msePause.paused&&this.handler.onPlayResume(S.a.now()),this.pauseStat.reset(),this.bufStat.reset(),this.msePause.reset(),this.msePauseWorker.reset(),this.maxGop=0,this.isPlaybackRateNormal=!0,clearTimeout(this.tryPlayAgainTimout),this.audioSourceBuffer&&(this.audioSourceBuffer.removeEventListener("updateend",this.onAudioUpdateEndBind),this.audioSourceBuffer.removeEventListener("error",this.onUpdateErrorBind),this.audioSourceBuffer=null),this.videoSourceBuffer&&(this.videoSourceBuffer.removeEventListener("updateend",this.onVideoUpdateEndBind),this.videoSourceBuffer.removeEventListener("error",this.onUpdateErrorBind),this.videoSourceBuffer=null),this.mediaSource){this.mediaSource.removeEventListener("sourceopen",this.onMediaSourceOpenBind);for(var e=this.mediaSource.sourceBuffers;e.length;)this.mediaSource.removeSourceBuffer(e[0])}this.mediaSource=new MediaSource,this.mediaSource.addEventListener("sourceopen",this.onMediaSourceOpenBind),this.m4sPlayer.reset(),this.video&&(this.video.destroy(),this.video=null),this.video=this.createVideo(),this.playbackrateChangeAccess=!0,this.videoDataAppended=!1,this.onFragParsedTime=0,this.startPlayTime=0,this.isStartBuffer=!0,this.setVideoCurrentTime=0,this.startMoreBufferTime=0,this.maxJumpWaitNow=0,this.frameCallBackNums=0,this.lastFrameCallBackNums=0,this.mseRenderList.length=0}},{key:"resetVideo",value:function(){if(this.audioSourceBuffer&&(this.audioSourceBuffer.removeEventListener("updateend",this.onAudioUpdateEndBind),this.audioSourceBuffer.removeEventListener("error",this.onUpdateErrorBind),this.audioSourceBuffer=null),this.videoSourceBuffer&&(this.videoSourceBuffer.removeEventListener("updateend",this.onVideoUpdateEndBind),this.videoSourceBuffer.removeEventListener("error",this.onUpdateErrorBind),this.videoSourceBuffer=null),this.mediaSource){this.mediaSource.removeEventListener("sourceopen",this.onMediaSourceOpenBind);for(var e=this.mediaSource.sourceBuffers;e.length;)this.mediaSource.removeSourceBuffer(e[0])}this.mediaSource=new MediaSource,this.mediaSource.addEventListener("sourceopen",this.onMediaSourceOpenBind),this.video&&(this.video.destroy(),this.video=null),this.video=this.createVideo(),this.videoCodec=null,this.audioCodec=null,this.lastPlayTime=0}},{key:"createVideo",value:function(){this._triggerPlay=!1;var e=this.videoElement?this.videoElement:document.createElement("video");return e.src=URL.createObjectURL(this.mediaSource),new Ps(this,e)}},{key:"insertDiscontinuity",value:function(e){if(this.discontinuityAudio=!0,this.discontinuityVideo=!0,this.discontinuityTimeOffset=e,this.discontinuityTimeOffset>0){var t=Cs;this.cacheBlockReason(t,e)}}},{key:"getBufferLen",value:function(){return this.video?this.video.getBufferLen():0}},{key:"getSegmentsBufferLen",value:function(){return 200*this.videoSegments.length}},{key:"getCurrentDts",value:function(){return void 0===this.remuxer.getInitDts()?0:this.video?this.video.getCurrentTime()+this.remuxer.getInitDts():0}},{key:"getCurrentTime",value:function(){return this.video?this.video.getCurrentTime():0}},{key:"getCurrentRealTime",value:function(){return this.video?this.getCurrentDts():0}},{key:"appendFlv",value:function(e){this.addPlayEvent(),this.parser.parseFlv(e,this.isPureAudio)}},{key:"addPlayEvent",value:function(){this.hasData||(this.hasData=!0,this.videoElement&&(this.videoElement.addEventListener("loadeddata",this.onVideoLoadedBind),this.requestAnimationId=requestAnimationFrame(this.checkVideoPlayingBind)))}},{key:"appendTs",value:function(e){this.addPlayEvent(),this.parser.parseTs(e)}},{key:"checkBuffer",value:function(){if(!this.video.video.paused&&!this.video.seeking){var e=S.a.now(),t=this.video.video.buffered,i=t.length,s=this.getBufferLen();if(this.bufStat.checkBuffer(e,s),0===this.video.video.currentTime&&0!==this.lastPlayTime)return v.a.warn("MSEPlayer.checkBuffer onPlayerError(true) lastPlayTime="+this.lastPlayTime+" bufLen="+s),this._onPlayerError(!0),this._onErrorEvent(9),void(this.lastPlayTime=0);if(this.lastPlayTime=this.video.video.currentTime,e>this.playStartTime+3e3&&s>4e3&&0==this.video.currentTime&&(i>0&&t.start(0)<=4&&(v.a.log("MSEPlayer.checkBuffer buffer full but can not play"),this.video.currentTime=Math.round(t.start(0)+1)),this.video.play()),0!==this.playStartTime&&e>this.playStartTime+5e3&&(s>5e3||0===s))if(0==this.video.video.currentTime&&s>2e3)v.a.log("MSEPlayer(".concat(this._num_,") ####### currentTime=0 ++ bufLen=").concat(s," paused=").concat(this.video.video.paused)),this.video.play();else if(this.playStartTime=0,0===this.video.video.currentTime&&!this.isAndroid)return v.a.warn("MSEPlayer(".concat(this._num_,").checkBuffer onPlayerError(true) playTime=")+this.video.video.currentTime+" bufLen="+s),this._onErrorEvent(6),void this._onPlayerError(!0);null==this.videoElement&&i&&this.video.video.currentTime-t.start(0)>20&&(this.audioSourceBuffer&&!this.audioSourceBuffer.updating&&this.audioSourceBuffer.remove(0,this.video.video.currentTime-10),this.videoSourceBuffer&&!this.videoSourceBuffer.updating&&this.videoSourceBuffer.remove(0,this.video.video.currentTime-10))}}},{key:"_onPlayerError",value:function(e){!this.isPlayerError&&this.handler&&(this.isPlayerError=!0,this.handler.onPlayerError(e))}},{key:"_onErrorEvent",value:function(e){this.isErrorEvent||(this.isErrorEvent=!0,this.handler&&this.handler.onErrorEvent&&this.handler.onErrorEvent({type:e}))}},{key:"onParseError",value:function(e){this._onErrorEvent(e)}},{key:"onAvcCfgChange",value:function(){return v.a.log("MSEPlayer(".concat(this._num_,").onAvcCfgChange")),this.getBufferLen()<500?(v.a.log("MSEPlayer(".concat(this._num_,").onAvcCfgChange reset player")),this.remuxer.reset(),this.parser.setPaused(!1),!1):(this.delayReset=!0,!0)}},{key:"getMaxGop",value:function(){return this.maxGop}},{key:"setEnableLowLatency",value:function(e){this.enableLowLatency=e}},{key:"getVolume",value:function(){return this.video?this.video.getVolume():-1}},{key:"setMuted",value:function(e){this.video&&(this.video.setMuted(e),v.a.log("MSEPlayer.setMuted ".concat(e," hasVideo=").concat(this._hasVideo()," hasAudio=").concat(this._hasAudio())))}},{key:"getMuted",value:function(){return this.video?this.video.getMuted():-1}},{key:"setResolution",value:function(e,t){v.a.log("MSEPlayer(".concat(this._num_,").setResolution w/h=")+e+"/"+t),this.width&&this.height&&(this.width!==e||this.height!==t)&&this.handler.eventEmitter&&this.handler.eventEmitter.trigger(o.VIDEO_RESOLUTION_CHANGE,{width:e,height:t}),this.width=e,this.height=t}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"setExceptionStat",value:function(e,t){this.handler&&this.handler.exceptionStat&&this.handler.exceptionStat.setStat(e,t)}},{key:"cacheBlockReason",value:function(e,t){this.handler&&this.handler.cacheBlockReason&&this.handler.cacheBlockReason(e,t)}},{key:"turnToH264",value:function(e){this.h265Proxy&&this.h265Proxy.stop(),this.handler&&this.handler.turnToH264(e)}},{key:"on265StartCodeError",value:function(){this.h265Proxy&&this.h265Proxy.on265StartCodeError()}},{key:"h265Retry",value:function(){this.h265Proxy&&this.h265Proxy.stop(),this.handler.h265Retry()}},{key:"onInitSegment",value:function(e){this.onInitSegmentCb&&this.onInitSegmentCb(),e.audioCodec&&(this.audioCodec=e.audioCodec),e.videoCodec&&(this.videoCodec=e.videoCodec,this.getVideoCapabilities(e)),this.isMediaSourceOpen&&this.initSourceBuffer(),e.audioMoov&&this.audioSegments.push(e.audioMoov),e.videoMoov&&this.videoSegments.push(e.videoMoov),this.playStartTime=0}},{key:"onFragParsing",value:function(e){"audio"===e.type?this.audioSegments.push(e.data):"video"===e.type&&this.videoSegments.push(e.data)}},{key:"onFragParsed",value:function(){this.audioSourceBuffer&&this.appendBuffer("audio"),this.videoSourceBuffer&&this.appendBuffer("video"),null==this.videoElement&&this.isLive&&(this.setFragParsedTime(),this.triggerPlay())}},{key:"setFragParsedTime",value:function(){this.isOnFragParsed||(this.onFragParsedTime=S.a.now(),v.a.log("MSEPlayer.onFragParsed",this.onFragParsedTime),this.isOnFragParsed=!0)}},{key:"checkVideoPlaying",value:function(){0==this.pushVideoStartRenderTime&&this.video&&this.video.video&&this.video.video.videoWidth>0&&this.video.video.videoHeight>0?this.pushVideoStartRenderTime=S.a.now():this.requestAnimationId=requestAnimationFrame(this.checkVideoPlayingBind)}},{key:"onVideoLoaded",value:function(){v.a.log("MSEPlayer.onVideoLoaded"),this.triggerPlay()}},{key:"reloadInError",value:function(){this.handler.reloadInError&&this.handler.reloadInError()}},{key:"initSourceBuffer",value:function(){if(localStorage._localVideoCodec&&""!=localStorage._localVideoCodec&&(this.videoCodec=localStorage._localVideoCodec),this.audioCodec&&!this.audioSourceBuffer){v.a.log("MSEPlayer(".concat(this._num_,").initSourceBuffer audio codec=")+this.audioCodec);try{this.audioSourceBuffer=this.mediaSource.addSourceBuffer("video/mp4;codecs=".concat(this.audioCodec)),this.audioSourceBuffer.addEventListener("updateend",this.onAudioUpdateEndBind),this.audioSourceBuffer.addEventListener("error",this.onUpdateErrorBind)}catch(e){return v.a.warn("MSEPlayer.initSourceBuffer audio err="+e.message),e.message&&-1!=e.message.indexOf("No additional SourceBuffer objects may be added")&&(v.a.log("MSEPlayer.initSourceBuffer resetMediasource in audio"),this.handler.resetMediasource)?void this.handler.resetMediasource():(this._onErrorEvent(4),void this._onPlayerError(!0))}}else this.audioCodec&&this.audioSourceBuffer&&this.discontinuityAudio&&(v.a.log("MSEPlayer(".concat(this._num_,").initSourceBuffer reset audio codec=")+this.audioCodec),this.audioSourceBuffer.changeType("video/mp4;codecs=".concat(this.audioCodec)));if(this.videoCodec&&!this.videoSourceBuffer){v.a.log("MSEPlayer(".concat(this._num_,").initSourceBuffer video codec=")+this.videoCodec);try{this.videoSourceBuffer=this.mediaSource.addSourceBuffer("video/mp4;codecs=".concat(this.videoCodec)),this.videoSourceBuffer.addEventListener("updateend",this.onVideoUpdateEndBind),this.videoSourceBuffer.addEventListener("error",this.onUpdateErrorBind)}catch(e){if(e.message&&-1!=e.message.indexOf("No additional SourceBuffer objects may be added")&&(v.a.log("MSEPlayer.initSourceBuffer resetMediasource in video"),this.handler.resetMediasource))return void this.handler.resetMediasource();v.a.warn("MSEPlayer(".concat(this._num_,").initSourceBuffer video err=")+e.message),this.getIsMseHevc()?this.handler.onMseHevcError():(this._onErrorEvent(5),this._onPlayerError(!0))}}else this.videoCodec&&this.videoSourceBuffer&&this.discontinuityVideo&&(v.a.log("MSEPlayer(".concat(this._num_,").initSourceBuffer reset video codec=")+this.videoCodec),this.videoSourceBuffer.changeType("video/mp4;codecs=".concat(this.videoCodec)));this.discontinuityVideo=!1,this.discontinuityAudio=!1}},{key:"appendBuffer",value:function(e){var t=S.a.now();if(0!=this.mediaSource.sourceBuffers.length&&!this.isPlayerError)if("audio"==e){if(this.audioSegments.length>0&&this.audioSourceBuffer&&!this.audioSourceBuffer.updating){var i=this.audioSegments.shift();try{this.audioSourceBuffer.appendBuffer(i),this.videoDataAppended=!0,this.audioPlayConsuming.pushRemuxedVideoFrameData(t)}catch(e){v.a.warn("MSEPlayer(".concat(this._num_,").appendBuffer audio err=")+e.message),this._onErrorEvent(7),this._onPlayerError(!0)}}}else{if("video"!=e)throw new Error("MSEPlayer(".concat(this._num_,").appendBuffer type error! Valide type is audio or video."));if(this.videoSegments.length>0&&this.videoSourceBuffer&&!this.videoSourceBuffer.updating){var s=this.videoSegments.shift();try{this.videoSourceBuffer.appendBuffer(s),this.videoDataAppended=!0,this.videoPlayConsuming.pushRemuxedVideoFrameData(t)}catch(e){v.a.warn("MSEPlayer(".concat(this._num_,").appendBuffer video err=")+e.message),this._onErrorEvent(8),this._onPlayerError(!0)}}}}},{key:"triggerH265Play",value:function(e,t){this.isH265Play||(v.a.log("MSEPlayer.triggerH265Play"),this.isH265Play=!0,this.h265Proxy&&this.h265Proxy.reportDecodeRenderTime(e,t)),!this.videoElement&&this.isLive||(v.a.log("MSEPlayer.triggerH265Play.triggerPlay"),this.triggerPlay())}},{key:"triggerPlay",value:function(){if(!this.playing&&this.isMediaSourceOpen){if(this.playing=!0,this.playStartTime=S.a.now(),this.videoElement&&!this.videoElement.autoplay||this.video.play(),f.a.platform===V.a.PLATFORM_TYPE_NAME.wap&&null!=this.videoElement)return;"safari"===E.a.name?f.a.safariFirstLoad?(f.a.safariFirstLoad=!1,this.triggerPlayVideo()):Q.once(this.triggerPlayVideo,this,f.a.safariPlayDelay):this.triggerPlayVideo()}}},{key:"getCodecType",value:function(){return this.m4sPlayer.isInitLoaded()?"av1":N(Object(B.a)(i.prototype),"getCodecType",this).call(this)}},{key:"triggerPlayVideo",value:function(){var e=!!this.videoSourceBuffer,t=this.getCodecType(),i=this.h265Proxy&&this.h265Proxy.isH265MseCodec;v.a.log("MSEPlayer.onPlayVideo codec: ".concat(t).concat(i?" (mse)":"")),0==this.parser.decodeIFRTime&&1==Number(f.a.isNoVideoReport)&&this.handler.eventEmitter&&this.handler.eventEmitter.trigger(o.P2P_REPORT),t===F&&this.h265Proxy&&this.h265Proxy.isReady&&this.h265Proxy.canvas,t===F&&this.h265Proxy&&this.h265Proxy.isReady?this.h265Proxy.isVideoTrack?this.handler.onPlayVideo(this.h265Proxy.canvas,this.widthCfg,this.heightCfg,e,null,this.onFragParsedTime,t):this.handler.onPlayVideo(this.video.video,this.widthCfg,this.heightCfg,e,this.h265Proxy.canvas,this.onFragParsedTime,t):this.handler.onPlayVideo(this.video.video,this.widthCfg,this.heightCfg,e,null,this.onFragParsedTime,t),this.startPlayTime=S.a.now()}},{key:"triggerH5PlayVideo",value:function(){if(v.a.log("trigger h5 video play"),this.pausedByBrowser)this.pausedByBrowser=!1;else{this.startPlayTime=S.a.now();var e=this._hasVideo();this.handler.onPlayVideo(this.video.video,this.widthCfg,this.heightCfg,e,null,this.onFragParsedTime)}}},{key:"onH264Sei",value:function(e,t){this.handler.onSendSeiData(e,t,this.video.video.currentTime)}},{key:"onMediaSourceOpen",value:function(){this.mediaSource.removeEventListener("sourceopen",this.onMediaSourceOpenBind),v.a.log("MSEPlayer.onMediaSourceOpen"),this.m4sPlayer.onMediaSourceOpen(this.mediaSource),(this.audioSegments.length>0||this.videoSegments.length>0)&&(this.initSourceBuffer(),this.appendBuffer("audio"),this.appendBuffer("video"),0==this.onFragParsedTime&&(this.onFragParsedTime=S.a.now()),null==this.videoElement&&this.triggerPlay())}},{key:"onAudioUpdateEnd",value:function(){this.checkSeek(),this.appendBuffer("audio"),this.checkAppendOver()}},{key:"onVideoUpdateEnd",value:function(){this.checkSeek(),this.appendBuffer("video"),this.checkAppendOver()}},{key:"checkSeek",value:function(){this.video.realSeek()}},{key:"checkCurrentTime",value:function(){this.video.checkCurrentTime()}},{key:"checkAppendOver",value:function(){0===this.videoSegments.length&&0===this.audioSegments.length&&(this.videoSourceBuffer&&this.videoSourceBuffer.updating||this.audioSourceBuffer&&this.audioSourceBuffer.updating||this.handler&&this.handler.onSBUpdateEnd&&this.handler.onSBUpdateEnd())}},{key:"onUpdateError",value:function(e){v.a.warn("MSEPlayer.onUpdateError",e)}},{key:"onVideoPause",value:function(e){v.a.log("MSEPlayer.onVideoPause"),this.userPaused=!0,this.h265Proxy&&this.h265Proxy.isReady&&this.h265Proxy.onVideoPause&&this.h265Proxy.onVideoPause()}},{key:"onPauseByBrowser",value:function(){this.userPaused=!0,v.a.log("MSEPlayer.onPauseByBrowser"),this.handler&&(this.handler.onPauseByBrowser&&this.handler.onPauseByBrowser(),this.handler.updateStatus&&this.handler.updateStatus(l.BROWSER_PAUSE),this.pausedByBrowser=!0,this.handler.eventEmitter&&this.handler.eventEmitter.trigger(o.BROWSER_PAUSE,{video:this.video.video})),this.h265Proxy&&this.h265Proxy.isReady&&this.h265Proxy.onVideoPause&&this.h265Proxy.onVideoPause()}},{key:"onVideoPlaying",value:function(){if(this.handler&&this.handler.updateStatus){if(this.video&&this.video.video&&this.video.video.paused)return void v.a.log("video is playing, video.paused=",this.video.video.paused);v.a.log("video is playing",this.isPureAudio);var e=this.isPureAudio?l.AUDIO_PLAYING:l.VIDEO_PLAYING;this.handler.updateStatus(e)}}},{key:"onVideoPlay",value:function(e){v.a.log("MSEPlayer.onVideoPlay"),this.userPaused=!1,this.h265Proxy&&this.h265Proxy.isReady&&this.h265Proxy.onVideoPlay&&this.h265Proxy.onVideoPlay()}},{key:"onVideoError",value:function(e){var t="";if(this.video.video.error){var i=this.video.video.error.code;t=" errCode="+i+" "+["Unknow","用户终止","网络错误","解码错误","格式不支持"][i],3!=i&&4!=i||(this.getIsMseHevc()?this.handler.onMseHevcError():(this._onErrorEvent(3==i?1:2),this._onPlayerError(!0)),localStorage.decodeabnormal="abnormal_"+(new Date).getTime())}v.a.warn("MSEPlayer(".concat(this._num_,").onVideoError id=").concat(e.currentTarget.id)+t,e),this.isLive||4===ws.getFirstFragStatus()&&ws.setFirstFragStatus(-4)}},{key:"pause",value:function(){v.a.info("MSEPlayer.pause"),this.userPaused=!0,this.video&&this.video.pause(),this.handler._hyPlayer&&this.handler._hyPlayer.roomRecordStat&&this.handler._hyPlayer.roomRecordStat.roomNoRenderStat.pause()}},{key:"play",value:function(){v.a.info("MSEPlayer.play"),this.userPaused=!1,this.video&&this.video.play()}},{key:"seek",value:function(e){this.lastPlayTime=e,v.a.info("MSEPlayer.seek seekTime="+e,"currentTime="+this.video.video.currentTime),this.video&&this.video.seek(e)}},{key:"onCheckTimer",value:function(e,t){if(this.playing&&this.isMediaSourceOpen){if(N(Object(B.a)(i.prototype),"onCheckTimer",this).call(this,e,t),0!=this.shildAudioStartTs&&this.video&&this.video.video){var s=this.getCurrentDts();this.video.video.muted&&s>=this.shildAudioStartTs&&(v.a.log("MSEPlayer.shieldAudioMute recover"),this.video.video.muted=!1,this.shildAudioStartTs=0)}var r=this.getBufferLen(),a=Number(localStorage._printBufferLen);if(-1==a||a>0&&a==this._num_){var n=Math.max(0,r/100);v.a.debug(this._getTag(),"bufLen","-".repeat(n),r)}if(Number(localStorage._printMseLog)&&this.audioSegments&&this.videoSegments&&v.a.debug("MSE aSegments=".concat(this.audioSegments.length," vSegments=").concat(this.videoSegments.length," bufLen=").concat(this.getBufferLen())),!this.video.video.paused&&!this.userPaused){if(this.checkVideoRenderFrames(),null==this.videoElement&&this.isLive&&t%4==0&&r>f.a.jitJump[0]&&!Number(localStorage._localFlvTest)){var o=.001*(f.a.jitJump[0]-f.a.jitJump[1]);this.video.video.currentTime+=o,v.a.warn("MSEPlayer.onCheckTimer jumpTs=".concat(o," bufLen=").concat(this.getBufferLen()))}this.checkBuffer(),this.onJitterTimer();var h=(this.handler?this.handler.lastEmptySliceTs:0)||0,u=h>0&&e-h<3e3,l=this._hasVideo();this.isLive&&l&&this.msePause.pausedTs>0&&e-this.msePause.pausedTs>5e3&&!u&&this.sensitivePause&&(v.a.warn("MSEPlayer.onCheckTimer paused 5 sec."),this._onErrorEvent(3),this._onPlayerError(!0),this.handler&&this.handler.onPause5Sec&&this.handler.onPause5Sec())}}else this.parser&&this.parser.printPlayFrameInfo&&this.parser.printPlayFrameInfo()}},{key:"checkVideoRenderFrames",value:function(){var e=this.frameCallBackNums-this.lastFrameCallBackNums,t=S.a.now();this.renderList.length>=5&&this.renderList.shift(),"hidden"==document.visibilityState?(this.renderList.length=0,this.renderHiddenTs=t):(t-this.renderHiddenTs>=1e3||0==this.renderHiddenTs)&&!this.renderListFirst&&this.renderList.push(e),1==Number(localStorage._printVideoCallBackFps)&&v.a.log("MSEPlayer.videoRenderFps drop",e,document.visibilityState,this.renderList.toString()),this.mseRenderList.push(e),this.renderListFirst=!1,this.lastFrameCallBackNums=this.frameCallBackNums}},{key:"getMseRenderList",value:function(){var e=Di(this.mseRenderList);return this.mseRenderList.length=0,e}},{key:"onCheckFastTimer",value:function(e,t){if(N(Object(B.a)(i.prototype),"onCheckFastTimer",this).call(this,e),this.playing&&this.isMediaSourceOpen&&!this.video.video.paused&&!this.userPaused){this.checkEmptyFrames(),this.checkDelayReset(),this.msePause.check(e);var s=(this.handler?this.handler.lastEmptySliceTs:0)||0,r=s>0&&e-s<3e3,a=this._hasVideo();if(null==this.videoElement&&!this.pause500checked&&a&&this.msePause.pausedTs>0&&e-this.msePause.pausedTs>500&&!r){this.pause500checked=!0;var n=this.bufferedInfo(),o=n.bufferLen.toFixed(2),h=(n.nextStart-n.end).toFixed(2);if(v.a.info("MSEPlayer(".concat(this._num_,").onCheckFastTimer paused"),"bufferLen="+o,"hole="+h,"nextStart="+n.nextStart.toFixed(2),"currentTime="+this.video.video.currentTime,"audioSegments=".concat(this.audioSegments.length," videoSegments=").concat(this.videoSegments.length," videoSamples=").concat(this.ctrlBuffer.avBuffer.vBuffer.getInfo()," audioSamples=").concat(this.ctrlBuffer.avBuffer.aBuffer.getInfo())),this.isLive&&"ts"!=this.videoType){this.video.printBuffered();var u=Number(n.nextStart);this.video.video&&u&&h>0&&h<3&&u-this.video.video.currentTime>.5&&(this.video.video.currentTime=u,v.a.log("MSEPlayer(".concat(this._num_,").onCheckFastTimer try jump currentTime=")+this.video.video.currentTime))}}}}},{key:"onCheckFastWorkerTimer",value:function(e){this.playing&&this.isMediaSourceOpen&&!this.video.video.paused&&!this.userPaused&&this.msePauseWorker.check(e)}},{key:"checkEmptyFrames",value:function(){this.handler.setEmptyFrames&&this.parser.hasEmptyFrames&&this.handler.setEmptyFrames(this.parser.hasEmptyFrames)}},{key:"checkDelayReset",value:function(){this.delayReset&&this.getBufferLen()<500&&(v.a.log("MSEPlayer(".concat(this._num_,").checkDelayReset reset player")),this.remuxer.reset(),this.parser.setPaused(!1),this.delayReset=!1)}},{key:"_hasAudio",value:function(){return!!this.audioSourceBuffer||this.m4sPlayer.hasVideo()}},{key:"_hasVideo",value:function(){return!!this.videoSourceBuffer||this.m4sPlayer.hasVideo()}},{key:"_msePaused",value:function(e){this.handler.onPlayPause(e,this._hasVideo())}},{key:"_mseResume",value:function(e,t){this.pause500checked=!1,this.handler.onPlayResume(e,this._hasVideo())}},{key:"_msePausedWorker",value:function(e){this.pauseStat.pause(),this.handler._hyPlayer&&this.handler._hyPlayer.roomRecordStat&&this.handler._hyPlayer.roomRecordStat.roomNoRenderStat.pause(),this.handler.onPlayPauseWorker&&this.handler.onPlayPauseWorker(e,this._hasVideo())}},{key:"_mseResumeWorker",value:function(e,t){this.pauseStat.resume(),this.handler._hyPlayer&&this.handler._hyPlayer.roomRecordStat&&this.handler._hyPlayer.roomRecordStat.roomNoRenderStat.resume(),this.parser.dropFrameCtrl&&this.pausePerf.checkLive(this.pid,this.bitrate,this.pauseStat.getCnt(),this.buffered.continueBuffer)&&(this.parser.dropFrameCtrl.start(),this.parser.dropFrameDts.start()),this.handler.onPlayResumeWorker&&this.handler.onPlayResumeWorker(e,this._hasVideo())}},{key:"bufferedInfo",value:function(){var e,t,i,s,r,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.2,n=[],o=[],h=this.video.video.buffered;for(r=0;r<h.length;r++)n.push({start:h.start(r),end:h.end(r)});for(n.sort((function(e,t){return e.start-t.start||t.end-e.end})),r=0;r<n.length;r++){var u=o.length;if(u){var l=o[u-1].end;n[r].start-l<a?n[r].end>l&&(o[u-1].end=n[r].end):o.push(n[r])}else o.push(n[r])}var d=this.video.video.currentTime;for(r=0,e=0,t=i=d;r<o.length;r++){var c=o[r].start,p=o[r].end;if(d+a>=c&&d<p)t=c,e=(i=p)-d;else if(d+a<c){s=c;break}}return s||(s=i),{bufferLen:e,start:t,end:i,nextStart:s}}},{key:"printBuffer",value:function(e){if(this.video.video){var t=this.video.video.buffered,i="buffered=["+(1e3*t.start(0)|0)+","+(1e3*t.end(0)|0)+"]",s=1e3*this.video.video.currentTime>>0,r=this.getBufferLen();v.a.log("MSEPlayer(".concat(this._num_,").printBuffer ").concat(e," currentTime=").concat(s," bufLen=").concat(r," ").concat(i))}}},{key:"playbackRateSet",value:function(e){var t=this,i=this.getPlayVideo();if(i){var s=function(e){if(t.playRateIncrease%2==0){var s=e<1&&e+.02>1?1:e+.02;s>f.a.playbackrateMax&&(s=f.a.playbackrateMax),t.playRateDecrease=0,i.playbackRate=s}},r=function(e){if(t.playRateDecrease%2==0){var s=e>1&&e-.02<1?1:e-.02;s<f.a.playbackrateMin&&(s=f.a.playbackrateMin),t.playRateIncrease=0,i.playbackRate=s}},a=this.getBufferLen(),n=i.playbackRate;e<0?r(n):e>0?s(n):1!==n&&(n<1&&a<this.JITTER_BUFLEN?r(n):n>1&&a>this.JITTER_BUFLEN?s(n):i.playbackRate=1),this.playRateDecrease++,this.playRateIncrease++}}},{key:"setMuffledVolume",value:function(e){this.video.setMuffledVolume(e)}},{key:"setPlaybackRate",value:function(e){if(!(this.handler&&this.handler._hyPlayer&&this.handler._hyPlayer.getSupportAuto)||this.handler._hyPlayer.getSupportAuto()){var t=this.getPlayVideo();t&&(t.playbackRate=e)}}},{key:"onJitterTimer",value:function(e,t){if(this.playing&&("ts"!=this.videoType||this.isLive)&&this.autoJitter&&!this.autoBitrateJitter){var i=this.getPlayVideo();if(i){var s=this.getBufferLen();if(f.a.getEnableJumpBuffer()||this.isShieldAudio){var r=S.a.now();if(this.latencySeek>0&&s>4e3)return void(i.currentTime+=s-this.latencySeek);if(this.enableLowLatency&&s>Number(f.a.jitLowLatency))i.currentTime+=s-f.a.jitLowLatency;else{var a=s-this.JITTER_BUFLEN;if(r-this.startPlayTime<this.startCd)return;if(this.isShieldAudio){var n=this.getFrameBufferLen(),o=n+s,h=this.JITTER_BUFLEN+f.a.shieldAudioCfg[1],u=this.JITTER_BUFLEN;if(this.printJitter&&v.a.log("MSEPlayer.onJitterTimer.shield bufLen=".concat(s,",frameBufLen=").concat(n,",minusBuffer=").concat(a,",newBuf=").concat(o-a)),(a=o-h)<=0)return;if(s-a<u&&(a=s-u),a<0)return}else if(s>=(f.a.setVideoCTCfg[2]||1e4))return void this.setJumpBufferCurrentTime(a,s,0,r);if(this.isStartBuffer&&r-this.startPlayTime>this.startCd)a>=f.a.setVideoCTCfg[1]&&this.setJumpBufferCurrentTime(a,s,1,r),this.isStartBuffer=!1;else if(r-this.setVideoCurrentTime>=this.bufferCd||0==this.setVideoCurrentTime){if(r-this.startMoreBufferTime>=this.bufferMoreContinueTime&&0!=this.startMoreBufferTime)return this.setJumpBufferCurrentTime(a,s,2,r),void(this.startMoreBufferTime=0);a>=f.a.setVideoCTCfg[1]?0==this.startMoreBufferTime&&(this.startMoreBufferTime=r):this.startMoreBufferTime=0}}}else if(this.latencySeek>0&&s>4e3)i.currentTime+=s-this.latencySeek;else try{var l=0;if(s<this.JITTER_BUFMIN?l=s-this.JITTER_BUFLEN:s>this.JITTER_BUFMAX&&(l=s-this.JITTER_BUFMAX),this.enableLowLatency&&s>Number(f.a.jitLowLatency))i.playbackRate=1.1;else if(this.playbackrateChangeAccess){l=Number(localStorage.ab_adjust)||l,1!=i.playbackRate&&this.isPlaybackRateNormal&&v.a.log("MSEPlayer.onJitterTimer.playbackRate=",i.playbackRate),1!=i.playbackRate?this.isPlaybackRateNormal=!1:this.isPlaybackRateNormal=!0,this.playbackRateSet(l)}else i.playbackRate=1;-1===Number(localStorage._print_ab_log)&&v.a.log("BUFMIN: %d, BUFMAX: %d, BUFLEN:%d, bufLen: %d, adjust: %d, playbackRate: %f",this.JITTER_BUFMIN,this.JITTER_BUFMAX,this.JITTER_BUFLEN,s,l,i.playbackRate)}catch(e){v.a.error("MSEPlayer.onJitterTimer set playbackRateSet error",e)}}}}},{key:"setJumpBufferCurrentTime",value:function(e,t,i,s){this.lastJumpBufferTs=s||S.a.now(),this.h265Proxy&&this.h265Proxy.isReady&&!this.h265Proxy.isH265MseCodec?this.h265Proxy.jumpBuffer(e,t,i,s):this.setVideoCurrentTimeHand(e,t,i,s)}},{key:"setVideoCurrentTimeHand",value:function(e,t,i,s){var r=this.getPlayVideo();if(r){var a="";0===i?a="maxBuffer":1===i?a="fiveJump":2===i&&(a="ContinueJudgeJump"),v.a.log("MSEPlayer.onJitterTimer.jumpBuffer ".concat(a," video.currentTime before=").concat(r.currentTime," bufLen=").concat(t," minusBuffer=").concat(e," curDts=").concat(this.getCurrentDts())),r.currentTime+=e/1e3,this.setVideoCurrentTime=s,v.a.log("MSEPlayer.onJitterTimer.jumpBuffer ".concat(a," video.currentTime now=").concat(r.currentTime," curDts=").concat(this.getCurrentDts()," bufLen=").concat(this.getBufferLen()," frameBufLen=").concat(this.getFrameBufferLen()))}}},{key:"requestVideoFrameCallback",value:function(){if(this.frameCallBackNums++,f.a.renderStat[0]){this.renderFps.addRender();var e=S.a.now(),t=this.getCurrentRealTime();this.audioPlayConsuming.addRenderFrameData(t,e),this.videoPlayConsuming.addRenderFrameData(t,e)}}},{key:"getOsDiscardConfig",value:function(){var e=$.a.os||"",t=$.a.osVersion||"";return!("windows"!=e.toLocaleLowerCase()||7!=Number(t))||1==Number(localStorage._enableOsDiscardFrame)}},{key:"getIsMseHevc",value:function(){return this.videoCodec&&(-1!=this.videoCodec.indexOf("hev")||-1!=this.videoCodec.indexOf("hvc"))}},{key:"getVideoCapabilities",value:function(e){var t=this;navigator&&navigator.mediaCapabilities&&navigator.mediaCapabilities.decodingInfo({type:"media-source",video:{contentType:'video/mp4;codecs="'.concat(e.videoCodec,'"'),width:e.videoWidth,height:e.videoHeight,bitrate:1e4,framerate:60}}).then((function(e){e&&e.supported?v.a.log("MSEPlayer.getVideoCapabilities",JSON.stringify(e)):t.getIsMseHevc()&&t.handler.onMseHevcError()}))}},{key:"switchShieldAudio",value:function(e){this.ctrlBuffer.switchShieldAudio(e)}},{key:"check500Pause",value:function(){this.handler.check500Pause&&this.handler.check500Pause()}},{key:"isSupportRequestVideoFrameCallback",value:function(){return this.video&&this.video.isSupportRequestVideoFrameCallback()}},{key:"getRenderElement",value:function(){return this.video.video}},{key:"isMediaSourceOpen",get:function(){return this.mediaSource&&"open"===this.mediaSource.readyState}}]),i}(Zs);if(!Object.values){var wr=Function.bind.call(Function.call,Array.prototype.reduce),Ir=Function.bind.call(Function.call,Object.prototype.propertyIsEnumerable),Ar=Function.bind.call(Function.call,Array.prototype.concat),Rr=Reflect.ownKeys;Object.values=function(e){return wr(Rr(e),(function(t,i){return Ar(t,"string"==typeof i&&Ir(e,i)?[e[i]]:[])}),[])}}var kr=function(){function e(t){Object(s.a)(this,e),this.player=t,this.recordMap=new Map,this.init(),this.reset()}return Object(a.a)(e,[{key:"init",value:function(){this.keys=Object.values(g.a.DIM_LINK_STA);var e=this.keys.indexOf(g.a.DIM_LINK_STA.name);-1!==e&&this.keys.splice(e,1)}},{key:"setStat",value:function(e,t){this.recordMap.has(e)||(this.recordMap.set(e,1),this.exceptionStat[e]=t)}},{key:"getStat",value:function(){var e=this;this.player.getDurationTime&&this.player.getDurationTime()>2&&this.setStat(g.a.DIM_LINK_STA.DATA_ENOUGH,1);var t=[];return Object.keys(this.exceptionStat).forEach((function(i){t.push("".concat(i,":").concat(e.exceptionStat[i]))})),t.join(",")}},{key:"reset",value:function(){var e=this;this.recordMap.clear(),this.exceptionStat={},this.keys.forEach((function(t){e.exceptionStat[t]=0}))}}]),e}(),br=function e(t){Object(s.a)(this,e),this.iHEVCBitRate=t.iHEVCBitRate,this.iCodecType=t.iCodecType,this.iBitRate=t.iBitRate,this.bitrate=t.bitrate},Dr=0,Or=function(){function e(t){Object(s.a)(this,e),this._id=Dr++,this._callbacks=t,this._timeout=!1,this._destroy=!1,this._timeoutTime=1e3,this._onRspBind=this._onRsp.bind(this)}return Object(a.a)(e,[{key:"destroy",value:function(){this._destroy=!0,this._callbacks=null,Q.remove(this._onTimeout,this)}},{key:"sendP2PFlv",value:function(e){var t=e.info,i=this._getReq(e);i.mAppendInfo.value={streamType:e.type,expVideoFps:e.metadata&&e.metadata.fps||0,expAudioFps:e.metadata&&e.metadata.audioFps||0,codeRate:t.curBitrate,isOriginal:Number(0===t.originalBitrate),line:e.lineType,codeType:e.isH265?"265":"264",sStreamName:t.sStreamName,playType:e.playType,isServer:0,iIsP2PSupport:t.iIsP2PSupport},this._sendReq(i)}},{key:"sendAuto",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;this._timeoutTime=t;var i=this._getReq(e);i.mAppendInfo.value=e.appendInfo,this._sendReq(i)}},{key:"_getReq",value:function(e){var t=new bt.RecSysReq;return t.tId.iAppid=ee.a.appid,t.tId.lUid=ee.a.uid,t.tId.sGuid=ee.a.sGuid,t.tId.sUA="webh5",t.sAnchorUid=e.presenterUid,t.sRoomId=e.roomId,t.iScene=e.scene,t.bDebug=0,t}},{key:"_sendReq",value:function(e){var t=Object.assign({},e);v.a.log("RecSysProxy(".concat(this._id,").sendReq"),e,JSON.stringify(t)),Ae.sendWup("mediaui","getMediaRec",e,this._onRspBind,!0,Ae.getRequestId(),!0),Q.once(this._onTimeout,this,this._timeoutTime)}},{key:"_onRsp",value:function(e){if(1!=localStorage._testTimeout){Q.remove(this._onTimeout,this);var t=Object.assign({},e);v.a.log("RecSysProxy(".concat(this._id,").onRsp"),e,JSON.stringify(t)),this._destroy||this._callbacks&&this._callbacks.onRsp(e)}else v.a.log("RecSysProxy._onRsp _testTimeout=".concat(localStorage._testTimeout))}},{key:"_onTimeout",value:function(){this._callbacks&&this._callbacks.onTimeout&&this._callbacks.onTimeout()}}]),e}(),Fr=function(){function e(t){Object(s.a)(this,e),this.ctrlBitrate=t,this.timeLineTs=0,this.sampleTs=0,this.sampleCheckTs=0,this.sampleDts=0,this.sampleCheckDts=0,this.printTs=0,this.printSampleTs=0,this.printSampleDts=0,this.startTs=0,this.startDts=0,this.cnt12=0}return Object(a.a)(e,[{key:"start",value:function(e,t){v.a.log("EvalBw.start now=".concat(e," dts=").concat(t)),this.startTs=this.timeLineTs=this.sampleTs=this.sampleCheckTs=this.printTs=this.printSampleTs=e,this.startDts=this.printSampleDts=this.sampleCheckDts=this.sampleDts=t,this.cnt12=0}},{key:"stop",value:function(){this.reset()}},{key:"reset",value:function(){v.a.log("EvalBw.reset"),this.startTs=this.timeLineTs=this.sampleTs=this.sampleCheckTs=this.printTs=this.printSampleTs=0,this.startDts=this.printSampleDts=this.sampleCheckDts=this.sampleDts=0,this.cnt12=0}},{key:"onCheckFastTimer",value:function(e,t){if(this.startTs>0){var i=e-this.timeLineTs;if(i>300){var s=this.sampleTs-this.sampleCheckTs,r=this.sampleDts-this.sampleCheckDts,a=r>0?s/r:2;v.a.log("EvalBw.onCheckFastTimer eval timeline=".concat(i," costtime=").concat(s," duration=").concat(r," costtime/duration=").concat(a," dts=").concat(this.sampleDts)),a>1.4&&!this._downBwCheck()?this._evalFail():a>1.2&&!this._downBwCheck()?(this.cnt12++,this.cnt12>=2&&this._evalFail()):this.cnt12=0,this.timeLineTs=e,this.sampleCheckTs=e,this.sampleCheckDts=this.sampleDts}}if(Number(localStorage._printEval)>0&&e-this.printTs>Number(localStorage._printEval)&&this.sampleDts>0){var n=e-this.printTs,o=this.sampleTs-this.printSampleTs,h=this.sampleDts-this.printSampleDts;v.a.log("EvalBw.onCheckFastTimer print timeline=".concat(n," duration=").concat(h," costtime=").concat(o," costtime/duration=").concat(o/h," dts=").concat(this.sampleDts)),this.printTs=e,this.printSampleTs=this.sampleTs,this.printSampleDts=this.sampleDts}}},{key:"_evalFail",value:function(){this.stop(),this.ctrlBitrate.evalFail()}},{key:"_downBwCheck",value:function(){var e=this.sampleTs-this.startTs,t=this.sampleDts-this.startDts;return v.a.log("EvalBw._downBwCheck costtime=".concat(e," duration=").concat(t," costtime/duration=").concat(e/t," dts=").concat(this.sampleDts)),t>0&&e/t<1.2}},{key:"addSample",value:function(e){var t=S.a.now();if(0===this.printSampleDts&&(this.printSampleDts=e.ts,this.printTs=this.printSampleTs=t),this.sampleTs=t,this.sampleDts=e.ts,this.startTs>0&&e.key){var i=this._downBwCheck();this.stop(),i?this.ctrlBitrate.evalSuc():this.ctrlBitrate.evalFail()}}}]),e}(),Lr=function(){function e(t){Object(s.a)(this,e),this.statSwitch=t,this.type=0,this.startTs=0,this.nextIFrameTs=0,this.connectedTs=0,this.firstVideoPkgTs=0,this.ptsIFrameTs=0,this.endTs=0,this.lastPlayerType=0}return Object(a.a)(e,[{key:"start",value:function(e){var t=e.type,i=e.reason,s=e.playerType;v.a.log("AutoSeg.start, type=".concat(t,", reason=").concat(i,", playerType=").concat(s)),this.lastPlayerType=s||0,this.statSwitch.sendSwitchAuto([t,i||0]),this.type=t,this.reset(),this.startTs=S.a.now()}},{key:"nextIFrame",value:function(){this.startTs>0&&(this.nextIFrameTs=S.a.now())}},{key:"connected",value:function(){this.startTs>0&&(this.connectedTs=S.a.now())}},{key:"firstVideo",value:function(){this.startTs>0&&(this.firstVideoPkgTs=S.a.now())}},{key:"ptsIFrame",value:function(){this.startTs>0&&(this.ptsIFrameTs=S.a.now())}},{key:"end",value:function(e){var t=e.full,i=e.playerType;if(this.startTs>0){this.endTs=S.a.now();var s=[this.endTs-this.startTs,this.nextIFrameTs>0?this.nextIFrameTs-this.startTs:-1,this.connectedTs>0&&this.nextIFrameTs>0?this.connectedTs-this.nextIFrameTs:-1,this.firstVideoPkgTs>0&&this.connectedTs>0?this.firstVideoPkgTs-this.connectedTs:-1,this.ptsIFrameTs>0&&this.firstVideoPkgTs>0?this.ptsIFrameTs-this.firstVideoPkgTs:-1,this.ptsIFrameTs>0?this.endTs-this.ptsIFrameTs:-1,i||0,this.lastPlayerType];v.a.log("AutoSeg.end, result=".concat(s.toString(),", full=").concat(t,", playerType=").concat(i)),this.statSwitch.sendSwitchCost(s,[this.type,t])}this.reset()}},{key:"reset",value:function(){this.startTs=0,this.nextIFrameTs=0,this.connectedTs=0,this.firstVideoPkgTs=0,this.ptsIFrameTs=0,this.endTs=0}}]),e}(),Br=function(){function e(){Object(s.a)(this,e),this._size=0,this._cnt=0,this._index=0,this._map=new Map,this._bufCnt=Number(f.a.autoCfg.bufCnt),this._sucPer=Number(f.a.autoCfg.sucPer),this._sucCnt=0,this._contiCnt=0}return Object(a.a)(e,[{key:"reset",value:function(){this._cnt=0,this._index=0,this._map.clear(),this._sucCnt=0,this._contiCnt=0}},{key:"setSwitchTime",value:function(e){this.reset(),this._size=e/Number(f.a.autoCfg.sampleTime)}},{key:"addSample",value:function(e){if(this._cnt++,e?(this._contiCnt++,this._sucCnt++,this._map.set(this._index,1)):(this._contiCnt=0,this._map.set(this._index,0)),this._cnt>this._size){this._cnt--;var t=this._index-this._size,i=this._map.get(t);this._map.delete(t),1===i&&this._sucCnt--}return this._index++,this.isFullSize()&&this.isLastReach()&&this.isPercentReach()}},{key:"isFullSize",value:function(){return this._cnt>=this._size}},{key:"isLastReach",value:function(){return this._contiCnt>=this._bufCnt}},{key:"isPercentReach",value:function(){return this._sucCnt/this._cnt>=this._sucPer}}]),e}(),Nr=function(){function e(){Object(s.a)(this,e),this._minTime=Number(f.a.autoCfg.minTime),this._maxTime=Number(f.a.autoCfg.maxTime),this._map=new Map}return Object(a.a)(e,[{key:"reset",value:function(){v.a.log("AutoUpGap.reset"),this._map.clear()}},{key:"getMin",value:function(){return this._minTime}},{key:"getGap",value:function(e){return this._map.has(e)||this._map.set(e,this._minTime),this._map.get(e)}},{key:"addFail",value:function(e,t){v.a.log("AutoUpGap.addFail bitrate=".concat(e," isMin=").concat(t));var i=this.getGap(e);if(!t){var s=Math.min(2*i,this._maxTime);this._map.set(e,s)}}}]),e}(),Mr=new Set,Ur=new Map,Vr=function(){function e(){Object(s.a)(this,e),this._highRate=Number(f.a.autoCfg.highRate),this._badBuf=Number(f.a.autoCfg.badBuf),this._badCnt=Number(f.a.autoCfg.badCnt),this._sList=[],this._sTime=f.a.autoCfg.badS[0],this._sCnt=f.a.autoCfg.badS[1],this._lList=[],this._lTime=f.a.autoCfg.badL[0],this._lCnt=f.a.autoCfg.badL[1]}return Object(a.a)(e,[{key:"reset",value:function(){this._sList=[],this._lList=[]}},{key:"getBitrates",value:function(){return Array.from(Mr).join(",")}},{key:"hasBitrate",value:function(e){return Mr.has(e)}},{key:"addBadQuality",value:function(e,t,i,s){return this._addBadQuality(e,t,i,s,this._sList,this._sTime,this._sCnt)||this._addBadQuality(e,t,i,s,this._lList,this._lTime,this._lCnt)}},{key:"_addBadQuality",value:function(e,t,i,s,r,a,n){if(r.push({now:t,pauseTime:i,bufferLen:s}),r.length>n&&r.shift(),r.length>=n){var o=t-r[0].now;if(o<=a)return v.a.log("AutoBadQuality._addBadQuality disTime=".concat(o," time=").concat(a," cnt=").concat(n)),this._checkPerformance(e,r),!0}return!1}},{key:"_checkPerformance",value:function(e,t){var i=this;if(e>this._highRate)if(t.some((function(e){return e.bufferLen<i._badBuf}))){Ur.has(e)||Ur.set(e,0);var s=Ur.get(e)+1;Ur.set(e,s),s>=this._badCnt&&Mr.add(e)}else Mr.add(e)}}]),e}(),xr={UP_PTS:Math.pow(2,0),UP_WAIT_IFRAME:Math.pow(2,1),UP_CONNECT_FAIL:Math.pow(2,2),UP_CONNECT_SLOW:Math.pow(2,3),UP_FIRST_FRAME:Math.pow(2,4),UP_PTS_FRAME:Math.pow(2,5),BACK_CONNECT_FAIL:Math.pow(2,6),BACK_PTS:Math.pow(2,7),EVAL_BEFORE:Math.pow(2,8),EVAL_AFTER:Math.pow(2,9),BACK_CONNECT_SLOW:Math.pow(2,10),BACK_FIRST_FRAME:Math.pow(2,11),BACK_PTS_FRAME:Math.pow(2,12),DOWN_NO_IFRAME:Math.pow(2,13),DOWN_CONNECT_FAIL:Math.pow(2,14),DOWN_PTS:Math.pow(2,15),DOWN_CONNECT_SLOW:Math.pow(2,16),DOWN_FIRST_FRAME:Math.pow(2,17),DOWN_PTS_FRAME:Math.pow(2,18),UP_NO_IFRAME:Math.pow(2,19)},Hr=function(){function e(t,i){Object(s.a)(this,e),this._ctrlBitrate=t,this._autoMonitor=i,this._buffer=null,this._startTs=0,this._connectedTs=0,this._firstFrameTs=0}return Object(a.a)(e,[{key:"setStart",value:function(e){this._startTs=S.a.now(),this._connectedTs=0,this._firstFrameTs=0,e<f.a.autoBufferScore&&this._ctrlBitrate.isSwitchUp()&&this._autoMonitor.addBadReason(xr.UP_WAIT_IFRAME)}},{key:"setConnected",value:function(){this._connectedTs=S.a.now(),this._connectedTs-this._startTs>f.a.autoConnectScore&&(this._ctrlBitrate.isSwitchUp()?this._autoMonitor.addBadReason(xr.UP_CONNECT_SLOW):this._ctrlBitrate.isSwitchDown()?this._autoMonitor.addBadReason(xr.DOWN_CONNECT_SLOW):this._ctrlBitrate.isSwitchBack()&&this._autoMonitor.addBadReason(xr.BACK_CONNECT_SLOW))}},{key:"setFirstFrame",value:function(){this._firstFrameTs=S.a.now(),this._checkFirstFrame()}},{key:"setFirstVideoTimeout",value:function(){this._connectedTs>0?this._checkFirstFrame():this._ctrlBitrate.isSwitchUp()?this._autoMonitor.addBadReason(xr.UP_CONNECT_FAIL):this._ctrlBitrate.isSwitchDown()?this._autoMonitor.addBadReason(xr.DOWN_CONNECT_FAIL):this._ctrlBitrate.isSwitchBack()&&this._autoMonitor.addBadReason(xr.BACK_CONNECT_FAIL)}},{key:"_checkFirstFrame",value:function(){S.a.now()-this._connectedTs>f.a.autoFirstScore&&(this._ctrlBitrate.isSwitchUp()?this._autoMonitor.addBadReason(xr.UP_FIRST_FRAME):this._ctrlBitrate.isSwitchDown()?this._autoMonitor.addBadReason(xr.DOWN_FIRST_FRAME):this._ctrlBitrate.isSwitchBack()&&this._autoMonitor.addBadReason(xr.BACK_FIRST_FRAME))}},{key:"setPtsFrame",value:function(e){this._checkPtsFrame(),e>0&&(this._ctrlBitrate.isSwitchUp()?this._autoMonitor.addBadReason(xr.UP_PTS):this._ctrlBitrate.isSwitchDown()?this._autoMonitor.addBadReason(xr.DOWN_PTS):this._ctrlBitrate.isSwitchBack()&&this._autoMonitor.addBadReason(xr.BACK_PTS))}},{key:"setPtsFrameTimeout",value:function(){this._checkPtsFrame()}},{key:"_checkPtsFrame",value:function(){S.a.now()-this._firstFrameTs>f.a.autoPtsScore&&(this._ctrlBitrate.isSwitchUp()?this._autoMonitor.addBadReason(xr.UP_PTS_FRAME):this._ctrlBitrate.isSwitchDown()?this._autoMonitor.addBadReason(xr.DOWN_PTS_FRAME):this._ctrlBitrate.isSwitchBack()&&this._autoMonitor.addBadReason(xr.BACK_PTS_FRAME))}},{key:"setEvalBefore",value:function(e){e<f.a.autoBufferScore&&this._autoMonitor.addBadReason(xr.EVAL_BEFORE)}},{key:"setEvalAfter",value:function(e){e<f.a.autoBufferScore&&this._autoMonitor.addBadReason(xr.EVAL_AFTER)}},{key:"setNoIFrame",value:function(){this._buffer&&this._buffer.isWaitForIFrame()&&(this._ctrlBitrate.isSwitchUp()?this._autoMonitor.addBadReason(xr.UP_NO_IFRAME):this._ctrlBitrate.isSwitchDown()&&this._autoMonitor.addBadReason(xr.DOWN_NO_IFRAME))}},{key:"reset",value:function(){this._startTs=0,this._connectedTs=0,this._firstFrameTs=0}},{key:"buffer",set:function(e){this._buffer=e}}]),e}(),Wr={NONE:0,H264ToH264:1,H264ToH265:2,H265ToH264:3,H265ToH265:4},Gr=function(){function e(t,i){var r=t.player,a=t.statSwitch,n=t.autoMonitor,o=t.recSysStat;Object(s.a)(this,e),this._player=r,this._statSwitch=a,this._autoMonitor=n,this._recSysStat=o,this._callbacks=i,this._seg=new Lr(a),this._badStat=new Hr(this,n),this._buffer=null,this._curBitrate=0,this._lastBitrate=0,this._startBitrate=0,this._sessionId=0,this._maxBitrate=0,this._originalMaxBitrate=0,this._minBitrate=0,this._bitrateList=[],this._allBitratebps="",this._switchSampleTime=Number(f.a.autoCfg.sampleTime),this._switchUpGap=Number(f.a.autoCfg.upGap),this._switchDownGap=Number(f.a.autoCfg.downGap),this._switchBackGap=Number(f.a.autoCfg.backGap),this._nextReqInterval=Number(f.a.recSysExpiredTime),this._firstRecSysTime=Number(f.a.autoCfg.sysTime),this._switchUpPer=Number(f.a.autoCfg.upPer),this._switchDownPer=Number(f.a.autoCfg.downPer),this._switchDownNowPer=Number(f.a.autoCfg.downNowPer),this._switchWaitPer=Number(f.a.autoCfg.waitPer),this._switchDownBitrate=Number(f.a.autoCfg.downBitrate),this._beforeSwitchCb=null,this._mse=null,this._evalBw=new Fr(this),this._switchNextTime=0,this._switchSampleTs=0,this._upGap=new Nr,this._switchUpSample=new Br,this._badRate=new Vr,this._switchUpReason=zt,this._switchDownReason=ai,this._switchType=Wr.NONE,this._switchOver=!1,this._evalOver=!1,this._started=!1,this._nextRecSysTs=0,this._switchState=0,this._recSysProxy=null,this._badQualityCoderatebps=[],this._recSysExpiredTime=0,this._visibilityState=V.a.VISIBILITY_STATE.VISIBLE,this._onRecSysBind=this._onRecSys.bind(this),this._onRecSysDownTimeoutBind=this._onRecSysDownTimeout.bind(this),this._onRecSysIntervalTimeoutBind=this._onRecSysIntervalTimeout.bind(this),this._onVisibilityChangeBind=this._onVisibilityChange.bind(this),this._switchUpSample.setSwitchTime(this._upGap.getMin()),this.closeAuto=2===Number(localStorage.openAuto),this.switchStartTime=0}return Object(a.a)(e,[{key:"isSwitchUp",value:function(){return 1===this._switchState}},{key:"isSwitchDown",value:function(){return 3===this._switchState}},{key:"isSwitchBack",value:function(){return 4===this._switchState}},{key:"start",value:function(e,t){var i=this;if(!this._started)if(e){v.a.log("CtrlBitrate.start",JSON.stringify(t)),this._mse=e;var s=e.ctrlBuffer;s.setEval(this._evalBw),s.callbacks=this._callbacks,this._buffer=s,this._badStat.buffer=s,this._sessionId=t.sessionId,this._curBitrate=t.curBitrate,this._maxBitrate=t.startBitrate,3===Number(f.a.isWebAutoAB)&&(this._maxBitrate=f.a.maxBitRate),this._originalMaxBitrate=this._maxBitrate,this._startBitrate=t.startBitrate,this._bitrateList=[],this._minBitrate=Number.MAX_SAFE_INTEGER;var r=[];t.bitrateList.forEach((function(e){i._bitrateList.push(new br(e)),r.push(1e3*e.bitrate),i._minBitrate=Math.min(i._minBitrate,e.bitrate)})),this._allBitratebps=r.join(","),this._bitrateList.sort((function(e,t){return e.bitrate>t.bitrate?-1:1})),this._start()}else v.a.warn("CtrlBitrate.start waring mse")}},{key:"_start",value:function(){v.a.log("CtrlBitrate._start started=".concat(this._started," bitrates=").concat(this._bitrateList.length," mse=").concat(!!this._mse)),this._mse&&this._bitrateList.length>0&&!this._started&&(this._started=!0,this._player.eventEmitter.on(d.VISIBILITY_CHANGE,this._onVisibilityChangeBind),this._switchNextTime=S.a.now()+5e3,Q.add(this._onCheckFastTimer,this,100),Q.once(this._firstReqAuto,this,1e3+10*Math.floor(Math.random()*this._firstRecSysTime/10)),this._onVisibilityChange())}},{key:"_onVisibilityChange",value:function(){v.a.log("CtrlBitrate._onVisibilityChange old=".concat(this._visibilityState," new=").concat(document.visibilityState)),this._visibilityState!==V.a.VISIBILITY_STATE.VISIBLE&&document.visibilityState===V.a.VISIBILITY_STATE.VISIBLE&&(this._switchSampleTs=0,this._switchUpSample.reset()),this._visibilityState=document.visibilityState}},{key:"_firstReqAuto",value:function(){v.a.log("CtrlBitrate._firstReqAuto"),this._reqAutoRecSys(1,this._onRecSysIntervalTimeoutBind)}},{key:"stop",value:function(){v.a.log("CtrlBitrate.stop"),this._mse=null,this._buffer=null,this._started=!1,this._switchState=0,this._switchType=Wr.NONE,this._switchUpReason=zt,this._switchDownReason=ai,this._badQualityCoderatebps=[],this._recSysExpiredTime=0,this._switchNextTime=0,this._switchTarget=null,this._curBitrate=0,this._lastBitrate=0,this._nextRecSysTs=0,this._bitrateList=[],this._evalBw.stop(),this._switchUpSample.reset(),this._upGap.reset(),this._badRate.reset(),this._destroyRecSys(),this._player.eventEmitter.off(d.VISIBILITY_CHANGE,this._onVisibilityChangeBind),Q.remove(this._onCheckFastTimer,this),Q.remove(this._firstReqAuto,this),this.switchStartTime=0}},{key:"pause",value:function(){this._buffer.pause()}},{key:"_sendSwitchStat",value:function(e){var t=this._buffer.switchTs.getMetric(),i=t.values,s=t.strs;this._buffer.switchTs.resetPtsSample(),i[3]=this._seg.type,s[2]=e,this._statSwitch.sendSwitchPts(i,s),this._seg.end({full:e,playerType:this._player._type})}},{key:"switchBitrate",value:function(e){this._curBitrate!==e&&(0!==this._curBitrate&&v.a.log("CtrlBitrate.switchBitrate from=".concat(this._curBitrate," to=").concat(e," buffer=").concat(this._mse.getBufferLen())),this._switchOver=!1,this._lastBitrate=this._curBitrate,this._curBitrate=e,this._buffer.switchBitrate(3===this._switchState,this._lastBitrate,this._curBitrate))}},{key:"switchBack",value:function(e){if(this.switchStartTime=0,0!==this._switchState&&this._lastBitrate<this._curBitrate){this._upGap.addFail(this._lastBitrate,this._curBitrate===this._minBitrate),this._evalBw.stop(),this._sendSwitchStat(e===Jt?1:2),this._seg.start({type:jt,reason:e,playerType:this._player._type}),this._switchState=4,v.a.log("CtrlBitrate.switchBack from=".concat(this._curBitrate," lastBitrate=").concat(this._lastBitrate," reason=").concat(e," buffer=").concat(this._mse.getBufferLen()));for(var t=this._bitrateList.length,i=0;i<t;i++){var s=this._bitrateList[i];if(s.bitrate===this._lastBitrate){var r=this._getDownInfo(i+1,t);r&&r.bitrate>=this._switchDownBitrate&&(s=r),v.a.log("CtrlBitrate.switchBack to=".concat(s.bitrate)),this._beforeSwitchCb&&this._beforeSwitchCb(s),this._buffer.switchBack();break}}}}},{key:"startEval",value:function(e){if(1===this._switchState){var t=this._mse.getBufferLen();v.a.log("CtrlBitrate.switchDone start eval buffer=".concat(t)),this._badStat.setEvalBefore(t),this._switchState=6,this._switchUpReason=ii,this._evalOver=!1,this._evalBw.start(S.a.now(),e)}}},{key:"evalSuc",value:function(){var e=this._mse.getBufferLen();v.a.log("CtrlBirate.evalSuc buffer=".concat(e)),this._badStat.setEvalAfter(e);var t=S.a.now();this._switchNextTime>t?this._switchNextTime+=this._switchUpGap:this._switchNextTime=t+this._switchUpGap,this._evalOver=!0,this._resetProperties(),this._sendSwitchStat(1),this._setPlaybackrate(!1),this._switchUpSample.setSwitchTime(this._upGap.getGap(this._curBitrate))}},{key:"evalFail",value:function(){var e=this._mse.getBufferLen();v.a.log("CtrlBirate.evalFail buffer=".concat(e)),this._badStat.setEvalAfter(e),this._switchUpReason=si,this._evalOver=!0,this.switchBack(Jt)}},{key:"_resetProperties",value:function(){this._evalOver&&this._switchOver&&(this._switchState=0,this._switchType=Wr.NONE,this._switchUpReason=zt,this._switchDownReason=ai)}},{key:"switchDone",value:function(e){this._switchOver=!0;var t=this._mse.getBufferLen();v.a.log("CtrlBitrate.switchDone buffer=".concat(t," switchType=").concat(this._switchType," switchNextGap=").concat(e));var i=S.a.now();if(this._switchNextTime=i+e,6===this._switchState&&(this.switchStartTime=i),3===this._switchState||4===this._switchState){this._evalBw.reset(),this._sendSwitchStat(1),3===this._switchState?(this._switchUpReason=zt,this._switchDownReason=ai,this._switchNextTime+=this._switchDownGap,this._switchState=0,this._switchType=Wr.NONE,this._setPlaybackrate(!1)):(this._switchState=5,this._switchNextTime+=this._switchBackGap);var s=this._upGap.getGap(this._curBitrate);v.a.log("CtrlBitrate.switchDone switchTime=".concat(s)),this._switchUpSample.setSwitchTime(s)}else this._resetProperties();this._buffer.play()}},{key:"_setPlaybackrate",value:function(e){var t=this._mse.getBufferLen(),i=Number(f.a.autoCfg.slow);i=t>3e3?.95:t>2e3?.9:.85,this._mse.setPlaybackRate(e?i:1),this._mse.autoBitrateJitter=e}},{key:"_switchUp",value:function(e){if(e||(e=this._curBitrate),this._curBitrate<this.maxBitrate){if(0===this._switchState){for(var t=null,i=this._bitrateList.length-1;i>=0;i--){var s=this._bitrateList[i];if(s.bitrate>e&&!this._badRate.hasBitrate(s.bitrate)&&s.bitrate<=this.maxBitrate&&!this._isBadBitrate(s.bitrate)){t=s;break}}if(t){if(this._player&&this._player.getIsEnableAuto&&!this._player.getIsEnableAuto(t))return void(this._switchUpReason=ri);v.a.log("CtrlBitrate._switchUp suc"),this._setPlaybackrate(!0),this._seg.start({type:Wt,playerType:this._player._type}),this._switchState=1,this._beforeSwitchCb&&this._beforeSwitchCb(t),this._autoMonitor.start(Wt,this.switchType)}else this._bitrateList[0].bitrate>this.maxBitrate?this._switchUpReason=ti:this._switchUpReason=ei}}else this._switchUpReason=Zt}},{key:"addBadQuality",value:function(e,t,i){e=e||S.a.now(),v.a.log("CtrlBitrate.addBadQuality started=".concat(this._started," switchState=").concat(this._switchState)),this._started&&0===this._switchState&&this._badRate.addBadQuality(this._curBitrate,e,t,i)&&(this._badRate.reset(),v.a.log("CtrlBitrate pause down!"),this._switchDownBefore())}},{key:"_switchDownBefore",value:function(){if(0!==Number(f.a.autoDownTimer)){var e=this._bitrateList[this._bitrateList.length-1].bitrate;this._curBitrate>e&&(this._switchState=2,1===Number(f.a.sdkCloseAutoAi)||2===Number(f.a.isWebAutoAB)||3===Number(f.a.isWebAutoAB)?this._switchDown():this._reqAutoRecSys(2,this._onRecSysDownTimeoutBind))}}},{key:"_switchDown",value:function(e){var t=S.a.now();f.a.autoCfg&&0!=this.switchStartTime&&t-this.switchStartTime<f.a.autoCfg.noRederTime&&this._upGap.addFail(this._lastBitrate,this._curBitrate===this._minBitrate),e||(e=this._curBitrate),this.switchStartTime=0;for(var i=this.badQualityCoderatebps,s=this._bitrateList.length,r=null,a=0;a<s;a++){var n=this._bitrateList[a];if(n.bitrate<e&&!this._isBadBitrate(n.bitrate)){if(n.bitrate===this._minBitrate||n.bitrate<=this._switchDownBitrate)r=n;else{var o=this._getDownInfo(a+1,s);r=!o||o.bitrate<this._switchDownBitrate?n:o}break}}if(r){if(this._player&&this._player.getIsEnableAuto&&!this._player.getIsEnableAuto(r))return void(this._switchDownReason=li);v.a.log("CtrlBitrate._switchDown suc"),this._setPlaybackrate(!0),this._seg.start({type:Gt,playerType:this._player._type}),this._switchState=3,this._beforeSwitchCb&&this._beforeSwitchCb(r),this._autoMonitor.start(Gt,this.switchType)}else{v.a.log("CtrlBitrate._switchDown fail bad_host=".concat(this._badRate.getBitrates()," bad_svr=").concat(i.join(",")));var h=this._bitrateList[s-1];-1!==i.indexOf(1e3*h.bitrate)?this._switchDownReason=hi:this._badRate.hasBitrate(h.bitrate)&&(this._switchDownReason=ui)}}},{key:"_isBadBitrate",value:function(e){return-1!==this.badQualityCoderatebps.indexOf(1e3*e)||this._badRate.hasBitrate(e)}},{key:"_getDownInfo",value:function(e,t){return null}},{key:"_onRecSysDownTimeout",value:function(){v.a.log("CtrlBitrate._onRecSysTimeout"),this._nextRecSysTs=S.a.now()+this.nextReqInterval,this._destroyRecSys(),this._switchDown()}},{key:"_onCheckFastTimer",value:function(e,t){if(this._evalBw.onCheckFastTimer(e,t),5===this._switchState)this._fillBuf();else if(this._visibilityState===V.a.VISIBILITY_STATE.VISIBLE&&0===this._switchState&&e>this._switchNextTime&&!this._buffer.isPaused()&&!this.closeAuto){if(0===this._switchSampleTs)this._switchSampleTs=e;else if(e-this._switchSampleTs>=this._switchSampleTime){this._switchSampleTs=e;var i=this._mse.getBufferLen(),s=this._player.getWaitBufferLen(),r=this._player.getWaitFrameTime(e);this._needSwitchDown(e,i,s,r)?(v.a.log("CtrlBitrate buffer down! buffer=".concat(i," waitBuffer=").concat(s," waitFrameTime=").concat(r)),this._switchDownBefore()):(this._switchDownReason=oi,this._switchUpSample.addSample(i>=this._mse.JITTER_BUFLEN*this._switchUpPer)?this._switchUp():this._switchUpSample.isFullSize()?this._switchUpSample.isLastReach()?this._switchUpSample.isPercentReach()||(this._switchUpReason=Xt):this._switchUpReason=$t:this._switchUpReason=Qt)}}else e<this._switchNextTime&&(this._switchUpReason=Kt,this._switchDownReason=ni);this._nextRecSysTs>0&&e>=this._nextRecSysTs&&this._reqAutoRecSys(0,this._onRecSysIntervalTimeoutBind)}},{key:"_needSwitchDown",value:function(e,t,i,s){return t+i<this._mse.JITTER_BUFLEN*this._switchDownPer}},{key:"_fillBuf",value:function(){var e=this._mse.getBufferLen();e>=this._mse.JITTER_BUFLEN*this._switchUpPer&&(v.a.log("CtrlBitrate.fillBuf suc bufferLen=".concat(e)),this._switchState=0,this._switchType=Wr.NONE,this._setPlaybackrate(!1))}},{key:"_reqAutoRecSys",value:function(e,t){if(1!==Number(f.a.sdkCloseAutoAi)&&2!==Number(f.a.isWebAutoAB)&&3!==Number(f.a.isWebAutoAB)){this._nextRecSysTs=Number.MAX_SAFE_INTEGER,this._destroyRecSys();var i=this._player.info,s=new Or({onRsp:this._onRecSysBind,onTimeout:t}),r=this._player.getAutoProps();s.sendAuto({presenterUid:i.presenterUid,roomId:i.roomId,scene:1,appendInfo:{platform:"webh5&".concat(2308081438),p2p:this._player._type,h265:this._player.h265Proxy&&this._player.h265Proxy.isReady?1:0,line:i.lineType,coderatebps:1e3*i.curBitrate,gameid:i.gameId,all_coderatebps:this._allBitratebps,req_type:e,start_coderatebps:1e3*this._startBitrate,session_id:this._sessionId,video_play_buf:r.videoBuffers,audio_play_buf:"",video_block_count:r.aiAutoCnt,video_block_duration:r.aiAutoDuration,real_kbps_sample:r.realKbpsSample,v_loss_frames:"",v_recv_frames:r.recvFps}},1e3),this._recSysProxy=s}}},{key:"_onRecSysIntervalTimeout",value:function(){this._nextRecSysTs=S.a.now()+this.nextReqInterval,this._destroyRecSys()}},{key:"_onRecSys",value:function(e){var t=!1,i=!1,s=S.a.now();if(e){if(this._recSysStat.addItem(1,e.tRecSysInfo.sDispatchId,s+f.a.recSysExpiredTime),Number(localStorage._testAction)>0&&(v.a.log("CtrlBitrate._onRecSys _testAction=".concat(localStorage._testAction)),e.tRecSysInfo.lAction=Number(localStorage._testAction)),0===e.tRecSysInfo.lAction)t=!0;else if(e.tRecSysInfo.lAction>=100&&e.tRecSysInfo.lAction<200){if(""!==e.tRecSysInfo.sActValue){var r=JSON.parse(A.b.unescapeHTML(e.tRecSysInfo.sActValue));v.a.log("CtrlBitrate._onRecSys",JSON.stringify(r)),i=r.force_switch&&1==Number(r.force_switch),this._maxBitrate=Number(r.auto_max_coderatebps)/1e3||this._maxBitrate,this._nextReqInterval=1e3*Number(r.next_req_interval)||this._nextReqInterval,this._badQualityCoderatebps=r.bad_quality_coderatebps||[],this._recSysExpiredTime=S.a.now();var a=r.auto_user_tags||"";this._player.eventEmitter.autoUserTags=a,this._statSwitch.stat.setComDim(g.a.DIM_COM.AUTO_USER_TAGS,a);var n=Number(r.force_auto_count),o=Number(r.force_auto_effective_time);n>0&&o>0&&this._player.trigger(d.AUTO_FORCE_RSP,{force_auto_count:n,force_auto_effective_time:o})}t=!0}}else t=!0;Number(localStorage._testBadQuality)>0&&(v.a.log("CtrlBitrate._onRecSys _testBadQuality=".concat(localStorage._testBadQuality)),this._badQualityCoderatebps=[1e3*Number(localStorage._testBadQuality)]),Number(localStorage._testMaxBitrate)>0&&(this._recSysExpiredTime=S.a.now(),v.a.log("CtrlBitrate._onRecSys _testMaxBitrate=".concat(localStorage._testMaxBitrate)),this._maxBitrate=Number(localStorage._testMaxBitrate)),1===localStorage._testActAble&&(v.a.log("CtrlBitrate._onRecSys _testMaxBitrate=".concat(localStorage._testActAble)),t=!0),Number(localStorage._testForceSwitch)>0&&(v.a.log("CtrlBitrate._onRecSys _testForceSwitch=".concat(localStorage._testForceSwitch)),i=1==localStorage._testForceSwitch),i?this._maxBitrate<this._curBitrate?this._switchDown(this._maxBitrate+1):this._switchUp(this._maxBitrate-1):2===this._switchState?(this._switchState=0,t?this._switchDown():this._switchNextTime=this._nextRecSysTs):1===Number(f.a.autoDownMaxBitrate)&&this._maxBitrate<this._curBitrate&&this._switchDown(this._maxBitrate+1),this._nextRecSysTs=s+this.nextReqInterval-1e4}},{key:"_destroyRecSys",value:function(){this._recSysProxy&&this._recSysProxy.destroy(),this._recSysProxy=null}},{key:"_recSysExpired",value:function(){var e=S.a.now()-this._recSysExpiredTime;return 0!=this._recSysExpiredTime&&e>f.a.recSysExpiredTime}},{key:"switchType",get:function(){return this._switchType},set:function(e){this._switchType=e}},{key:"beforeSwitchCb",set:function(e){this._beforeSwitchCb=e}},{key:"lastBitrate",get:function(){return this._lastBitrate}},{key:"curBitrate",get:function(){return this._curBitrate}},{key:"maxBitrate",get:function(){return this._recSysExpired()&&(this._maxBitrate=this._originalMaxBitrate),this._maxBitrate}},{key:"nextReqInterval",get:function(){return this._recSysExpired()&&(this._nextReqInterval=Number(f.a.recSysExpiredTime)),this._nextReqInterval}},{key:"badQualityCoderatebps",get:function(){return this._recSysExpired()&&(this._badQualityCoderatebps=[]),this._badQualityCoderatebps}}]),e}();Gr.SwitchType=Wr;var jr=Gr,Yr=function(){function e(){Object(s.a)(this,e),this.mse=null,this.dtsGap=0,this.lastBufferLen=0,this.pauseCnt=0,this.callbacks=null}return Object(a.a)(e,[{key:"stop",value:function(){this.mse=null,this.dtsGap=0,this.callbacks=null,Q.remove(this._onTimer,this)}},{key:"start",value:function(e,t,i){v.a.log("SwitchDoneBefore.start bufferLen=".concat(e.getBufferLen()," dtsGap=").concat(t)),this.mse=e,this.dtsGap=t,this.lastBufferLen=0,this.pauseCnt=0,this.callbacks=i,Q.add(this._onTimer,this,100),this._onTimer(0)}},{key:"_onTimer",value:function(e){if(this.mse){var t=200;Number(localStorage._localBuffer)>0&&(t=Number(localStorage._localBuffer));var i=this.mse.getBufferLen();i<=t||this.dtsGap+i<=0||this.pauseCnt>2?(v.a.log("SwitchDoneBefore.done bufferLen=".concat(i," dtsGap=").concat(this.dtsGap," pauseCnt=").concat(this.pauseCnt)),Q.remove(this._onTimer,this),this.callbacks&&this.callbacks.done()):i===this.lastBufferLen&&this.pauseCnt++,this.lastBufferLen=i}else this.stop()}}]),e}(),qr=(window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame,window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame||window.oCancelAnimationFrame),Jr=function(){function e(t,i){var r=i.resumeFunc,a=i.pauseFunc;Object(s.a)(this,e),this._webCodecsPlayer=t,this._playResume=r,this._playPause=a,this._paused=!1,this._playedPts=0,this._pausedTs=0,this._lastCheckTime=0}return Object(a.a)(e,[{key:"reset",value:function(){this._paused=!1,this._playedPts=0,this._pausedTs=0}},{key:"check",value:function(e){if(!(0!=this._lastCheckTime&&e-this._lastCheckTime<50)){var t=this._webCodecsPlayer.isBrowserHidden?this._webCodecsPlayer.getCurrentAudioDts():this._webCodecsPlayer.getVideoPts();0!==this._playedPts&&(t===this._playedPts?this._paused||this._setPaused(e):this._paused&&this._setResume(e)),this._playedPts=t,this._lastCheckTime=e}}},{key:"_setPaused",value:function(e){this._paused=!0,this._pausedTs=e,v.a.log("WebCodecsPause._setPaused _pausedTs=",e),this._playPause(e)}},{key:"_setResume",value:function(e){var t=e-this._pausedTs;v.a.log("WebCodecsPause._setResume pausedTime=",t,this._playedPts),this._playResume(e,t),this._paused=!1,this._pausedTs=0}},{key:"paused",get:function(){return this._paused}},{key:"pausedTs",get:function(){return this._pausedTs}}]),e}(),zr=function(){function e(t,i){var r=i.resumeFunc,a=i.pauseFunc;Object(s.a)(this,e),this._webCodecsPlayer=t,this._playResume=r,this._playPause=a,this._paused=!1,this._playedPts=0,this._pausedTs=0,this._lastCheckTime=0,this._lastCheck500Time=0,this._lastCheck500CurrntTime=0}return Object(a.a)(e,[{key:"reset",value:function(){this._paused=!1,this._playedPts=0,this._pausedTs=0,this._lastCheck500Time=0,this._lastCheck500CurrntTime=0}},{key:"check",value:function(e){if(!(0!=this._lastCheckTime&&e-this._lastCheckTime<50)){var t=this._webCodecsPlayer.isBrowserHidden?this._webCodecsPlayer.getCurrentAudioDts():this._webCodecsPlayer.getVideoPts();if(0!==this._playedPts){t===this._playedPts?this._paused||this._setPaused(e):this._paused&&this._setResume(e);var i=e-this._lastCheck500Time,s=Math.round(t-this._lastCheck500CurrntTime);(0==this._lastCheck500Time||i>=500)&&(0!=this._lastCheck500Time&&i-s>=f.a.pause500Cfg[0]&&(1==Number(localStorage._printPauseCheckWorker)&&v.a.log("WebCodecsPauseWorker.check.500ms check500Delta=".concat(i,", check500CurrentTimeDelta=").concat(s,", pauseDelta=").concat(i-s)),this._webCodecsPlayer.check500Pause()),this._lastCheck500CurrntTime=t,this._lastCheck500Time=e)}this._playedPts=t,this._lastCheckTime=e}}},{key:"_setPaused",value:function(e){this._paused=!0,this._pausedTs=e,v.a.log("WebCodecsPauseWorker._setPaused _pausedTs=",e),this._playPause(e)}},{key:"_setResume",value:function(e){var t=e-this._pausedTs;v.a.log("WebCodecsPauseWorker._setResume pausedTime=",t,this._playedPts),this._playResume(e,t),this._paused=!1,this._pausedTs=0}},{key:"paused",get:function(){return this._paused}},{key:"pausedTs",get:function(){return this._pausedTs}}]),e}(),Kr=function(){function e(t){Object(s.a)(this,e),this._webCodecsPlayer=t,this.delayList=[],this.decodedList=[],this.renderList=[],this.deltaList=[],this.videoBufList=[],this.videoToDecodeList=[],this.audioToDecodeList=[],this.audioDecodedList=[],this.audioRenderList=[],this.videoDiscardList=[],this.videoThrowFpsList=[],this.videoRender5SecFpsList=[]}return Object(a.a)(e,[{key:"onCheckTimer",value:function(){var e=this._webCodecsPlayer.getDecodeFps(),t=e.decodedVideoFps,i=e.decodedAudioFps,s=this._webCodecsPlayer.getVideoRenderFps(),r=this._webCodecsPlayer.getAudioRenderFps(),a=this._webCodecsPlayer.getVideoThrowFps(),n=e.toDecodeAudioFps,o=e.toDecodeVideoFps,h=e.decodedVideoDelay,u=e.videoFrameLen,l=~~(this._webCodecsPlayer.getCurrentAudioDts()-this._webCodecsPlayer.getCurrentDts()),d=this._webCodecsPlayer.getDecodedBuffer(),c=this._webCodecsPlayer.getDiscardVideoFrames(),p=this._webCodecsPlayer.getBufferLen();this.delayList.push(h),this.decodedList.push(t),this.renderList.push(s),this.videoRender5SecFpsList.length>=5&&this.videoRender5SecFpsList.shift(),this.videoRender5SecFpsList.push(s),this.deltaList.push(l),this.videoBufList.push(p),this.audioToDecodeList.push(i),this.videoToDecodeList.push(o),this.audioDecodedList.push(i),this.audioRenderList.push(r),this.videoDiscardList.push(c),this.videoThrowFpsList.push(a),1==Number(localStorage._printWebCodecsStat)&&v.a.log("WebCodecsPlayer.getWebCodecsStats,","videoDecodeDelay=".concat(h,", audioToDecodeFps=").concat(n,", audioDecodeFps=").concat(i,","),"audioRenderFps=".concat(r,", videoBufferLen=").concat(this._webCodecsPlayer.getBufferLen(),", delta=").concat(l,", videoToDecodeFps=").concat(o,","),"videoDecodeFps=".concat(t,", discardVideoFps=").concat(c,", videoRenderFps=").concat(s,", videoThrowFps=").concat(a,","),"videoDecodedBuffer=".concat(d,", videoFrameLen=").concat(u))}},{key:"getStats",value:function(){var e=Di(this.delayList),t=Di(this.decodedList),i=Di(this.renderList),s=Di(this.deltaList),r=Di(this.audioToDecodeList),a=Di(this.videoToDecodeList),n=Di(this.audioDecodedList),o=Di(this.audioRenderList),h=Di(this.videoDiscardList),u=Di(this.videoThrowFpsList);this.delayList.length=0,this.decodedList.length=0,this.renderList.length=0,this.deltaList.length=0,this.audioToDecodeList.length=0,this.videoToDecodeList.length=0,this.audioDecodedList.length=0,this.audioRenderList.length=0,this.videoDiscardList.length=0,this.videoThrowFpsList.length=0;var l={delayList:e,decodedList:t,renderList:i,deltaList:s,videoToDecodeList:a,videoDiscardList:h,audioToDecodeList:r,auidoDecodedList:n,audioRenderList:o,videoThrowFpsList:u},d="WebCodecsPlayer.getStats\n";for(var c in l)d+="".concat(c,": ").concat(l[c].toString(),"\n");return d+="bufferLen:".concat(this.videoBufList.toString(),"\n"),v.a.log(d),this.videoBufList.length=0,l}},{key:"destroy",value:function(){this.videoRender5SecFpsList.length=0}}]),e}(),Qr={};self||(self=window),function(){var e=self.navigator.userAgent.toLowerCase(),t=/(edge)\/([\w.]+)/.exec(e)||/(edg)\/([\w.]+)/.exec(e)||/(opr)[\/]([\w.]+)/.exec(e)||/(chrome)[ \/]([\w.]+)/.exec(e)||/(iemobile)[\/]([\w.]+)/.exec(e)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(e)||[],i=/(ipad)/.exec(e)||/(ipod)/.exec(e)||/(windows phone)/.exec(e)||/(iphone)/.exec(e)||/(kindle)/.exec(e)||/(android)/.exec(e)||/(windows)/.exec(e)||/(mac)/.exec(e)||/(linux)/.exec(e)||/(cros)/.exec(e)||[],s={browser:t[5]||t[3]||t[1]||"",version:t[2]||t[4]||"0",majorVersion:t[4]||t[2]||"0",platform:i[0]||""},r={};if(s.browser){r[s.browser]=!0;var a=s.majorVersion.split(".");r.version={major:parseInt(s.majorVersion,10),string:s.version,majorVersion:s.majorVersion},a.length>1&&(r.version.minor=parseInt(a[1],10)),a.length>2&&(r.version.build=parseInt(a[2],10))}if(s.platform&&(r[s.platform]=!0),(r.chrome||r.opr||r.safari)&&(r.webkit=!0),r.rv||r.iemobile){r.rv&&delete r.rv;s.browser="msie",r.msie=!0}if(r.edge){delete r.edge;s.browser="msedge",r.chrome=!0}if(r.edg){delete r.edg;s.browser="msedge",r.chrome=!0}if(r.opr){s.browser="opera",r.opera=!0}if(r.safari&&r.android){s.browser="android",r.android=!0}for(var n in r.name=s.browser,r.platform=s.platform,Qr)Qr.hasOwnProperty(n)&&delete Qr[n];Object.assign(Qr,r)}(),Qr.version||(Qr.version={major:0,minor:0,build:0,string:"0.0.0"});var $r=Qr;function Xr(e,t){var i=e.toString().length,s=Math.max(0,t-i),r="";if(s>0)for(var a=0;a<s;a++)r+="0";return r+e}var Zr=0,ea={now:function(){if(void 0!==window.performance){var e=window.performance;if(void 0!==e.now)return~~e.now();if(void 0!==e.webkitNow)return~~e.webkitNow();if(void 0!==e.mozNow)return~~e.mozNow();if(void 0!==e.msNow)return~~e.msNow()}0===Zr&&(Zr=Date.now()-1);var t=Date.now()-Zr;return t>4294967295?(Zr+=4294967295,t-4294967295):t},utc:function(){return Math.round(Date.now()/1e3)},getDateStr:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:NaN,t=null;return"".concat((t=e?new Date(e):new Date).getFullYear(),"-").concat(Xr(t.getMonth()+1,2),"-").concat(Xr(t.getDate(),2))},getTimeStr:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:NaN,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=null,s="".concat(Xr((i=e?new Date(e):new Date).getHours(),2),":").concat(Xr(i.getMinutes(),2),":").concat(Xr(i.getSeconds(),2));return t&&(s+="."+Xr(i.getMilliseconds(),3)),s},getDateTimeStr:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:NaN,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=null,s="".concat((i=e?new Date(e):new Date).getFullYear(),"-").concat(Xr(i.getMonth()+1,2),"-").concat(Xr(i.getDate(),2)," ").concat(Xr(i.getHours(),2),":").concat(Xr(i.getMinutes(),2),":").concat(Xr(i.getSeconds(),2));return t&&(s+="."+Xr(i.getMilliseconds(),3)),s}},ta=99;function ia(){return ea.getDateTimeStr()+" "}var sa=!1,ra={_data:[],_length:0,debug:function(){var e=ia(),t=Array.apply(null,arguments);t[0]=e+t[0],ta<=-1&&console.log.apply(console,t)},log:function(e){var t=ia(),i=Array.apply(null,arguments);i[0]=t+i[0],ta<=0&&console.log.apply(console,i),ra.record(i,"log")},info:function(e){var t=ia(),i=Array.apply(null,arguments);i[0]=t+i[0],ta<=1&&console.info.apply(console,i),ra.record(i,"info")},warn:function(e){var t=ia(),i=Array.apply(null,arguments);i[0]=t+i[0],ta<=2&&console.warn.apply(console,i),ra.record(i,"warn")},error:function(e){var t=ia(),i=Array.apply(null,arguments);i[0]=t+i[0],ta<=3&&console.error.apply(console,i),ra.record(i,"error")},group:function(e){var t=ia(),i=Array.apply(null,arguments);if(i[0]=t+i[0],ta<=1){var s=console.groupCollapsed||console.group||console.log;s.apply(console,i)}ra.record(i,"group")},groupEnd:function(){console.groupEnd&&console.groupEnd.apply(console)},setLevel:function(e){e!=ta&&(console.log(ia()+" set log level from "+ta+" to "+e),ta=e)},getLevel:function(){return ta},record:function(e,t){1100===ra._length&&(ra._data.splice(0,100),ra._length=1e3);var i=0,s=(e.shift()||"").toString();for(s=s.replace(/\%c/gi,(function(e,t){return i++,""}));i--&&e.length;)e.shift();for(var r=0,a=e.length;r<a;r++)"object"==_(e[r])&&(e[r]="");e.unshift(s);var n=e.join(" ");ra._length++,ra._data.push("[".concat(t,"][HYLineTrans]").concat(n))},getLog:function(){return sa||(sa=!0,ra._data.unshift($r.platform+" "+$r.name+" "+$r.version.string)),ra._data},logcss:function(e,t,i){var s="font-weight:900";return e&&(s+=";color:"+e),t&&(s+=";background:"+t),i&&(s+=";border:3px solid "+i),s},padNum:function(e,t){var i=e.toString().length,s=Math.max(0,t-i);return"0".repeat(s)+e}},aa=ra,na={logger:null,TimeUtil:null,init:function(e){this.logger=e.logger||aa,this.TimeUtil=e.TimeUtil||ea}},oa=i(8),ha=function(){function e(t,i,s){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],n=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,h=arguments.length>7?arguments[7]:void 0;p(this,e),this.data=s,this.timeStamp=i,this.type=t,this.startDecodeTime=0,this.decodedTime=0,this.discardAllow=r,this.isKeyFrame=a,this.compositionTime=n,this.naluType=o,this.isEmptyAudioFrame=!1,h&&h.spsUnit&&(this.sps=h.spsUnit),h&&h.vpsUnit&&(this.vps=h.vpsUnit),h&&h.ppsUnit&&(this.pps=h.ppsUnit),h&&h.videoCodec&&(this.codec=h.videoCodec),h&&h.videoWidth&&(this.width=h.videoWidth),h&&h.videoHeight&&(this.height=h.videoHeight)}return m(e,[{key:"setIsEmptyAudioFrame",value:function(e){this.isEmptyAudioFrame=e}}]),e}();ha.VIDEO=0,ha.AUIDO=1;var ua=ha,la=function(){function e(t){p(this,e),this._player=t,this._worker=t.getWorker(),this._workerErrorBind=this._workerError.bind(this),this._workerMessageBind=this._workerMessage.bind(this),this._worker.addEventListener("message",this._workerMessageBind)}return m(e,[{key:"postInitConfig",value:function(e){this._post(oa.c.INIT_CONFIG,e)}},{key:"postAvcConfig",value:function(e){this._post(oa.c.AVCCONFIG,e)}},{key:"postAVCPPS",value:function(e){this._post(oa.c.AVCPPS,e)}},{key:"postAVCSPS",value:function(e){this._post(oa.c.AVCSPS,e)}},{key:"postAVCVPS",value:function(e){this._post(oa.c.AVCVPS,e)}},{key:"postVideoSamples",value:function(e){this._post(oa.c.VIDEOSAMPLES,e)}},{key:"postAudioConfig",value:function(e){this._post(oa.c.AACCONFIG,e)}},{key:"postAudioSamples",value:function(e){this._post(oa.c.AUDIOSAMPLES,e)}},{key:"postFastOver",value:function(){this._post(oa.c.FAST_OVER,{})}},{key:"postClose",value:function(){this._post(oa.c.CLOSE,{})}},{key:"postLocalConfig",value:function(){this._post(oa.c.LOCAL_CONFIG,{_webcodecsNoRenderVideo:Number(localStorage._webcodecsNoRenderVideo),_useSoftAcceleration:Number(localStorage._useSoftAcceleration)})}},{key:"postSetUseSoftAcceleration",value:function(){this._post(oa.c.SET_USE_SOFTACCELERATION,{})}},{key:"postUpdateSoftAcceleration",value:function(){this._post(oa.c.UPDATE_SOFTACCELERATION,{})}},{key:"postEnableDiscardVideo",value:function(e){this._post(oa.c.ENABLE_DISCARD_VIDEO,e)}},{key:"postSetAudioWriter",value:function(e){this._post(oa.c.SET_AUDIO_WRITER,{writer:e},[e])}},{key:"postSetPauseVideoDecode",value:function(e){this._post(oa.c.PAUSE_VIDEO_DECODE,e)}},{key:"postSetPauseAudioDecode",value:function(e){this._post(oa.c.PAUSE_AUDIO_DECODE,e)}},{key:"postUpdateCurBitrate",value:function(e){this._post(oa.c.UPDATE_CURBITRATE,e)}},{key:"postSetJitter",value:function(e){this._post(oa.c.SET_JITTER,e)}},{key:"postFrameInfo",value:function(e){this._post(oa.c.POSTFRAME,e)}},{key:"postResize",value:function(e){this._post(oa.c.RESIZE,e)}},{key:"postVisibilityChange",value:function(e){this._post(oa.c.VISIBILITYCHANGE,e)}},{key:"postUpdateVideoFps",value:function(e){this._post(oa.c.UPDATE_VIDEOFPS,e)}},{key:"postSetPlayMinBuffer",value:function(e){this._post(oa.c.SET_PLAY_MINBUFFER,e)}},{key:"postVideoRenderStart",value:function(e,t){this._post(oa.c.START,e,t)}},{key:"postAuidoTrack",value:function(e,t){this._post(oa.c.SET_AUDIO_WRITER,e,t)}},{key:"postLogCfg",value:function(e){this._post(oa.c.LOG_CFG,e)}},{key:"_post",value:function(e,t,i){e!==oa.c.VIDEOSAMPLES&&e!==oa.c.AUDIOSAMPLES&&e!==oa.c.UPDATE_VIDEOFPS&&e!==oa.c.VISIBILITYCHANGE&&e!==oa.c.AVCPPS&&e!==oa.c.AVCSPS&&e!==oa.c.AVCVPS&&na.logger.log("WokerHolder.post type="+e),i?this._worker&&this._worker.postMessage({type:e,data:t},i):this._worker&&this._worker.postMessage({type:e,data:t})}},{key:"_workerError",value:function(e){this._player.onWebcodecsError(oa.d.WORKERERROR,e.message)}},{key:"_workerMessage",value:function(e){var t=e.data;switch(t.type){case oa.b.WOREKR_READY:this._onWorkerReady();break;case oa.b.INTERVAL:this._player.onWorkerInterval(ea.now());break;case oa.b.TURN_TO_WEBCODECS_SOFT:this._player.turnToWebcodecsSoft();break;case oa.b.AUDIORENDERERROR:this._player.onWebcodecsError(oa.d.AUDIORENDERERROR);break;case oa.b.SOFT_TURN_TO_MSE:this._player.onWebcodecsError(oa.d.SOFT_TURN_TO_MSE);break;case oa.b.AUDIO_FRAME_DECODED:this._player.getAudioRender().appendFrame(t.data);break;case oa.b.WEBGLPLAY:this._player.triggerWebcodecsPlay();break;case oa.b.AUDIO_PLAY:this._player.triggerAudioPlay();break;case oa.b.STAT:this._player.getVideoStatData(t.data);break;case oa.b.PAUSE:case oa.b.WORKERSHAREBUFFER:break;case oa.b.RENDERERROR:this._player.onWebcodecsError(oa.d.VIDEORENDEERROR);break;case oa.b.LOG:na.logger.log("webCodecs worker log:\n",t.data.join("\n"));break;case oa.b.VIDEODECODEERROR:na.logger.log("webCodecs worker.onDecoderError, video decode error",t.data&&t.data.msg),this._player.onWebcodecsError(oa.d.VIDEODECODEERROR,t.data&&t.data.msg);break;case oa.b.AUDIODECODEERROR:na.logger.log("webCodecs worker.onDecoderError, audio decode error",t.data&&t.data.msg),this._player.onWebcodecsError(oa.d.AUDIODECODEERROR,t.data&t.data.msg);break;case oa.b.DECODE_COST:na.logger.log("webCodecs worker.onDecoderCostError, video decode_cost error"),this._player.onWebcodecsError(oa.d.DECODE_COST);break;case oa.b.DECODE_DTS:na.logger.log("webCodecs worker.decodeByDts, video decode error"),this._player.onWebcodecsError(oa.d.DECODE_DTS);break;case oa.b.WAIT_KEY_FRAME:this._player.onWaitKeyFrame(t.data);break;case oa.b.SET_FRAME_PAUSE:this._player.setFramePause();break;case oa.b.SET_FRMAE_RESUME:this._player.setFrameRusume();break;case oa.b.RENDER_FPS_PAUSE:this._player.renderFpsPause();break;case oa.b.AUDIO_FORMAT_ERROR:this._player.onWebcodecsError(oa.d.AUDIO_FORMAT_ERROR)}}},{key:"_onWorkerReady",value:function(){this.postLocalConfig(),1===Number(localStorage._useSoftAcceleration)&&this._player.setUseSoftAcceleration()}}]),e}(),da=function(){function e(){p(this,e),this.framelist=[]}return m(e,[{key:"appendFrame",value:function(e){this.framelist.push(e)}},{key:"appendFrames",value:function(e){for(;e.length>0;)this.framelist.push(e.shift())}},{key:"dropFrames",value:function(e){for(var t=0,i=0;i<this.framelist.length&&this.framelist[i].timeStamp<e;i++)t++;t>0&&this.framelist.splice(0,t)}},{key:"dropInvalidFrames",value:function(e,t){for(var i=-1,s=0,r=0;r<this.framelist.length;r++){var a=this.framelist[r];if(!(a.timeStamp<e)){if(-1==i&&a.timeStamp>e&&(i=r),!(a.timeStamp<t))break;s++}}s>0&&this.framelist.splice(i,s)}},{key:"close",value:function(){for(;this.framelist.length>0;)this.framelist.pop().frame.close();this.framelist=null}}]),e}(),ca=function(e){n(i,e);var t=u(i);function i(e){var s;return p(this,i),(s=t.call(this)).rafNow=0,s.renderedFrameNums=0,s.webCodecsPlayer=e,s.frameRenderFps=0,s.renderFpsList=[],s.canvas=null,s.pauseList=[],s.lastRenderNums=0,s.lastVideoThrowNums=0,s.lastFrameTimeStamp=0,s.lastToDecodeAudioNums=0,s.lastToDecodeVideoNums=0,s.lastDecodedAudioNums=0,s.lastDecodedVideoNums=0,s.lastDiscardVideoNums=0,s.videoPlayerElement=null,s.agenerator=null,s.processedStream=null,s}return m(i,[{key:"start",value:function(e,t){this.videoPlayerElement=document.createElement("video"),this.videoPlayerElement.muted=!0,this.agenerator=new MediaStreamTrackGenerator({kind:"video"}),this.processedStream=new MediaStream([this.agenerator]),this.videoPlayerElement.srcObject=this.processedStream,this.webCodecsPlayer.getWorkerHolder().postVideoRenderStart({agenerator:this.agenerator.writable,width:e,height:t,mainSharedArrayBuffer:this.webCodecsPlayer.getSharedArrayBufferHolder().getMainBuffer()},[this.agenerator.writable])}},{key:"appendFrame",value:function(e){this.webCodecsPlayer.getWorkerHolder().postFrameInfo({frameInfo:e}),this.lastFrameTimeStamp=e.timeStamp,e.frame.close(),e=null}},{key:"getVideoStatData",value:function(e){1==Number(localStorage._printVideoRenderStat)&&aa.log("VideoRender.getVideoStatData",e)}},{key:"getVideoElement",value:function(){return this.videoPlayerElement}},{key:"play",value:function(){var e=this;if(this.videoPlayerElement){var t=this.videoPlayerElement.play();t&&t.then((function(){aa.log("VideoRender.play success"),e.webCodecsPlayer.audioBrowserPaused&&(e.videoPlayerElement.pause(),e.webCodecsPlayer&&e.webCodecsPlayer.onPauseByBrowser())})).catch((function(t){var i=t.toString();aa.warn("VideoRender.play error: "+i),e.webCodecsPlayer&&(i.indexOf("NotAllowedError")>=0||i.indexOf("request was interrupted")>=0)&&e.webCodecsPlayer&&e.webCodecsPlayer.onPauseByBrowser()}))}}},{key:"getPauseStatList",value:function(){var e=[].slice.call(this.pauseList);return this.pauseList.length=0,e}},{key:"getRenderedFrameNums",value:function(){return this.renderedFrameNums}},{key:"getVideoPts",value:function(){return this.webCodecsPlayer.getSharedArrayBufferHolder().getVideoPts()}},{key:"getDecodedBuffer",value:function(){return this.webCodecsPlayer.getSharedArrayBufferHolder().getDecodedBuffer()}},{key:"getRenderFps",value:function(){var e=this.webCodecsPlayer.getSharedArrayBufferHolder().getRenderNums(),t=e-this.lastRenderNums;return this.lastRenderNums=e,t<0&&(t=0),t}},{key:"getVideoThrowFps",value:function(){var e=this.webCodecsPlayer.getSharedArrayBufferHolder().getVideoThrowNums(),t=e-this.lastVideoThrowNums;return this.lastVideoThrowNums=e,t<0&&(t=0),t}},{key:"containerResize",value:function(e){}},{key:"onVisibilitychange",value:function(){var e=document.visibilityState;this.webCodecsPlayer.getWorkerHolder().postVisibilityChange({state:e})}},{key:"updateVideoFPS",value:function(e,t){this.webCodecsPlayer.getWorkerHolder().postUpdateVideoFps({fps:e,noReferFps:t})}},{key:"setPlayMinBuffer",value:function(e){this.webCodecsPlayer.getWorkerHolder().postSetPlayMinBuffer({bufferLen:e})}},{key:"getDecodeFps",value:function(){var e=this.webCodecsPlayer.getSharedArrayBufferHolder(),t=e.getAudioTodecodeNums(),i=e.getVideoTodecodeNums(),s=e.getAudioDecodedNums(),r=e.getVideoDecodedNums(),a=e.getDecodedVideoDelay(),n=e.getVideoReadyToRenderListLen(),o=t-this.lastToDecodeAudioNums,h=i-this.lastToDecodeVideoNums,u=s-this.lastDecodedAudioNums,l=r-this.lastDecodedVideoNums;return this.lastToDecodeAudioNums=t,this.lastToDecodeVideoNums=i,this.lastDecodedAudioNums=s,this.lastDecodedVideoNums=r,{toDecodeAudioFps:o,toDecodeVideoFps:h,decodedAudioFps:u,decodedVideoFps:l,decodedVideoDelay:a,videoFrameLen:n}}},{key:"getDiscardVideoFrames",value:function(){var e=this.webCodecsPlayer.getSharedArrayBufferHolder().getVideoDecodeDiscardNums(),t=e-this.lastDiscardVideoNums;return this.lastDiscardVideoNums=e,t}},{key:"setAudioDecodedBuffer",value:function(e){this.webCodecsPlayer.getSharedArrayBufferHolder().storeMainBuffer(oa.a.AUDIO_DECODED_BUFFER,e)}},{key:"getVideoBufferLen",value:function(){var e=0;if(this.videoPlayerElement){var t=this.videoPlayerElement.buffered;t.length>0&&(e=1e3*(t.end(t.length-1)-this.videoPlayerElement.currentTime)>>0)}return e}},{key:"onVideoPause",value:function(){aa.log("VideoRenderWorker.pause"),this.webCodecsPlayer.getSharedArrayBufferHolder().storeMainBuffer(oa.a.PAUSE_STATUS,1)}},{key:"onVideoPlay",value:function(){this.webCodecsPlayer.getSharedArrayBufferHolder().storeMainBuffer(oa.a.PAUSE_STATUS,0)}},{key:"setRealFps",value:function(e){this.webCodecsPlayer.getSharedArrayBufferHolder().storeMainBuffer(oa.a.VIDEO_REAL_FPS,e)}},{key:"getVideoWidth",value:function(){return this.videoPlayerElement?this.videoPlayerElement.videoWidth:0}},{key:"getVideoHeight",value:function(){return this.videoPlayerElement?this.videoPlayerElement.videoHeight:0}},{key:"startMuteRender",value:function(){this.webCodecsPlayer.onVideoPlay(),this.videoPlayerElement.play()}},{key:"close",value:function(){r(c(i.prototype),"close",this).call(this),this.rafNow=0,this.renderedFrameNums=0,this.isBrowserHidden=!1,this.renderFpsList.length=0,this.canvas=null,this.lastRenderNums=0,this.lastVideoThrowNums=0,this.lastToDecodeAudioNums=0,this.lastToDecodeVideoNums=0,this.lastDecodedAudioNums=0,this.lastDecodedVideoNums=0,this.lastDiscardVideoNums=0,this.videoPlayerElement&&this.videoPlayerElement.removeEventListener("resize",this.webCodecsPlayer.onVideoResizeBind),this.videoPlayerElement=null,this.agenerator=null,this.processedStream=null}}]),i}(da),pa=function(e){n(i,e);var t=u(i);function i(e){var s;return p(this,i),(s=t.call(this,e)).audioDuration=0,s.ageneratorWriter=null,s.audioPlayerElement=null,s.processedStream=null,s.agenerator=null,s.renderTimer=0,s.frameTimeStamps=[],s.renderQueueLimit=5,s.audioSampleRate=44100,s.volume=1,s.paused=!1,s.renderNums=0,s.lastRenderNums=0,s.player=e,s.firstFrameRenderWriting=!1,s.firstFinshed=!1,s.isMuffled=!1,s.cacheVolume=1,s.isPlaying=!1,s.userPaused=!1,s.audioPlayerElement=document.createElement("audio"),s.audioPlayerElement.addEventListener("error",e.onVideoErrorBind),s.audioPlayerElement.addEventListener("play",e.onVideoPlayBind),s.audioPlayerElement.addEventListener("playing",e.onVideoPlayingBind),s.playing=!1,s}return m(i,[{key:"start",value:function(){"MediaStreamTrackProcessor"in window&&"MediaStreamTrackGenerator"in window?(this.agenerator=new MediaStreamTrackGenerator({kind:"audio"}),this.processedStream=new MediaStream([this.agenerator]),this.audioPlayerElement.srcObject=this.processedStream,this.player.getWorkerHolder().postAuidoTrack({ageneratorWriter:this.agenerator.writable},[this.agenerator.writable]),this.setVolume(this.volume)):this.player.handlerError(oa.d.NOT_SUPPORT_MEDIASRTREAMTRACK)}},{key:"getCurrentDts",value:function(){return this.player.getSharedArrayBufferHolder().getAudioDts()}},{key:"getCurrentTime",value:function(){return this.audioPlayerElement&&this.audioPlayerElement.currentTime?Math.round(1e3*this.audioPlayerElement.currentTime):0}},{key:"setVolume",value:function(e){this.isMuffled?this.audioPlayerElement&&(this.audioPlayerElement.volume=0):this.audioPlayerElement&&(this.audioPlayerElement.volume=e),this.volume=e,this.cacheVolume=e}},{key:"setMuffledVolume",value:function(e){this.isMuffled=e,this.isMuffled?this.audioPlayerElement&&(this.audioPlayerElement.volume=0):this.setVolume(this.cacheVolume)}},{key:"setMuted",value:function(e){this.isMute=e,e?this.audioPlayerElement&&(this.audioPlayerElement.muted=!0):this.audioPlayerElement&&(this.audioPlayerElement.muted=!1)}},{key:"getRenderFps",value:function(){var e=this.player.getSharedArrayBufferHolder().getAudioRenderNums(),t=e-this.lastRenderNums;return t<0&&(t=0),this.lastRenderNums=e,t}},{key:"pause",value:function(){this.audioPlayerElement.pause()}},{key:"play",value:function(){this._play()}},{key:"_checkPlay",value:function(){aa.log("AudioRender.checkPlay playing="+this.playing),this.playing?Timer.remove(this._checkPlay,this):this._play()}},{key:"_play",value:function(){var e=this,t=this.audioPlayerElement.play();t?t.then((function(){e.playing=!0,aa.log("AudioRender.play success")})).catch((function(t){e.playing=!1;var i=t.toString();aa.warn("AudioRender.play error: "+i),e.player&&(i.indexOf("NotAllowedError")>=0||i.indexOf("request was interrupted")>=0||e.audioPlayerElement.paused)&&e.player&&e.player.onPauseByBrowser(),e.userPaused=!0})):this.playing=!1}},{key:"userPlay",value:function(){aa.log("AudioRender.userPlay"),this.userPaused=!1,this.play()}},{key:"userPause",value:function(){aa.log("AudioRender.userPause"),this.userPaused=!0,this.pause(),this.player.onVideoPauseBind()}},{key:"workerMessage",value:function(e){switch(e.data.type){case oa.b.WORKERSHAREBUFFER:break;case oa.b.AUDIODECODEERROR:aa.log("webCodecs worker.onDecoderError, audio decode error"),this.player.handlerError(oa.d.AUDIODECODEERROR)}}},{key:"getAudioBufferLen",value:function(){var e=0;if(this.audioPlayerElement){var t=this.audioPlayerElement.buffered;t.length>0&&(e=1e3*(t.end(t.length-1)-this.audioPlayerElement.currentTime)>>0)}return e}},{key:"initAudio",value:function(){}},{key:"onCheckFastTimer",value:function(){}},{key:"close",value:function(){r(c(i.prototype),"close",this).call(this),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.audioPlayerElement.removeEventListener("pause",this.player.onVideoPauseBind),this.audioPlayerElement.removeEventListener("error",this.player.onVideoErrorBind),this.audioPlayerElement.removeEventListener("play",this.player.onVideoPlayBind),this.audioPlayerElement.removeEventListener("playing",this.player.onVideoPlayingBind),this.agenerator=null,this.ageneratorWriter=null,this.audioPlayerElement=null,this.processedStream=null,this.renderNums=0,this.lastRenderNums=0,this.firstFinshed=!1,this.frameTimeStamps.length=0,this.isPlaying=!1,this.userPaused=!1,this.playing=!1}}]),i}(da),fa=m((function e(){p(this,e)}));fa.INIT="init",fa.INITED="inited",fa.STOP="stop",fa.PAUSE="pause",fa.RESUME="resume",fa.PLAY="play",fa.AUDIO_FRAME="audio_frame",fa.UPDATE_CURRENT_TIME="update_current_time",fa.TIME_STAMP="timestamp",fa.VOLUME="volume",fa.AUDIO_DATA_NAN="AUDIO_DATA_NAN",fa.AUDIO_DATA_MUTE="AUDIO_DATA_MUTE",fa.LOG_CFG="LOG_CFG";var ma=fa,_a=i(34),ya=i.n(_a),va=window.AudioContext||window.webkitAudioContext,Sa=0,ga=function(){function e(t){p(this,e),this._id=Sa++,this.player=t,this.audioCtx=null,this.oscillator=null,this.bypasser=null,this.outputChannelCount=2,this.sampleRate=44100,this.currentDts=0,this.isMuffled=!1,this.isMute=!1,this.cacheVolume=1,this.isPlaying=!1,this.userPaused=!1,this.renderNums=0,this.lastRenderNums=0,this.isFirstFrameTs=0,this.firstTimeStamp=0,this.gainNode=null,this.audioContextState="",this.isFirstPlay=!1,this.onAudioStateChangeBind=this.onAudioStateChange.bind(this),this.audioFrames=[],this._logCfg={},this._logTs=0}return m(e,[{key:"isSuspended",value:function(){return"suspended"===this.audioContextState}},{key:"start",value:function(){}},{key:"initAudio",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:44100,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(na.logger.log("AudioWorkletNodeRenderer.initAudio"),this.audioCtx=new va({sampleRate:e}),"suspended"==this.audioCtx.state)return this.player.onAudioPauseByBrowser(),void(this.isAudioPause=!0);this.initAudioContext(t)}},{key:"initAudioContext",value:function(e){var t=this;this.outputChannelCount=e,this.audioCtx.audioWorklet.addModule(ya.a).then((function(){t.audioCtx&&(t.bypasser=new AudioWorkletNode(t.audioCtx,"bypass-processor",{outputChannelCount:[e]}),t.bypasser.port.onmessage=t.onMessage.bind(t),t.bypasser.connect(t.audioCtx.destination))})),this.audioCtx.addEventListener("statechange",this.onAudioStateChangeBind)}},{key:"muteRecoverInit",value:function(){this.isAudioPause=!1,this.audioCtx=null,this.initAudio()}},{key:"onAudioStateChange",value:function(){var e=this.audioCtx.state;aa.log("AudioWorkletNoRenderer.onAudioStateChange, state="+e),this.audioContextState=e,"suspended"==e?(this.player.onVideoPause(),this.isAudioPause=!0):"running"==e&&(this.player.onAudioPlay(),this.isAudioPause=!1)}},{key:"appendFrame",value:function(e){-1!=e.format.indexOf("32")?this.isAudioPause?this.audioFrames.push(e):this.postMessage(ma.AUDIO_FRAME,e):this.player.handlerError(oa.d.AUDIO_FORMAT_ERROR)}},{key:"onWorkLetReady",value:function(){var e=this;this.audioFramesClear(),this.audioFrames.length>=0&&(this.audioFrames.map((function(t){e.postMessage(ma.AUDIO_FRAME,t)})),this.audioFrames.length)}},{key:"onCheckFastTimer",value:function(){if(this.audioFramesClear(),this.bypasser&&this.bypasser.port&&this.bypasser.port.postMessage){var e=ea.now();if(e-this._logTs>1e3){this._logTs=e;var t={printProcess:1==localStorage._printProcess,printAudioData:1==localStorage._printAudioData,printRenderSkipAudio:1==localStorage._printRenderSkipAudio};t.printProcess==this._logCfg.printProcess&&t.printAudioData===this._logCfg.printAudioData&&t.printRenderSkipAudio===this._logCfg.printRenderSkipAudio||(this._logCfg=t,this.postMessage(ma.LOG_CFG,t))}}}},{key:"audioFramesClear",value:function(){for(var e=this.player.getVideoPts();this.audioFrames.length>0&&this.audioFrames[0].timeStamp<e;)this.audioFrames.shift()}},{key:"onMessage",value:function(e){switch(e.data.type){case ma.INITED:na.logger.log("AudioWorkletNodeRenderer.onMessage inited"),this.setVolume(this.volume),this.postMessage(ma.INIT,{outputChannelCount:this.outputChannelCount,id:this._id,mainSharedArrayBuffer:this.player.getSharedArrayBufferHolder().getMainBuffer()}),this.onWorkLetReady();break;case ma.TIME_STAMP:var t=ea.now();this.currentDts=e.data.data.timeStamp,this.renderNums=e.data.data.renderNums,this.isFirstPlay||(this.isFirstPlay=!0,this.player.triggerAudioPlay()),this.player.audioPlayConsuming&&this.player.audioPlayConsuming.addRenderFrameData&&this.player.audioPlayConsuming.addRenderFrameData(this.currentDts,t),0==this.isFirstFrameTs?(this.isFirstFrameTs=t,this.firstTimeStamp=this.currentDts):Number(1==localStorage._printWebcodecsWorkletDts)&&na.logger.log("AudioWorkLet, dts=".concat(this.currentDts,",localPast=").concat(ea.now()-this.isFirstFrameTs,",audioPast=").concat(this.currentDts-this.firstTimeStamp));break;case ma.AUDIO_DATA_NAN:this.player.handlerError(oa.d.AUDIO_DATA_NAN);break;case ma.AUDIO_DATA_MUTE:}}},{key:"postMessage",value:function(e,t){this.bypasser&&this.bypasser.port&&this.bypasser.port.postMessage&&this.bypasser.port.postMessage({type:e,data:t})}},{key:"workerMessage",value:function(e){switch(e.data.type){case oa.b.WORKERSHAREBUFFER:break;case oa.b.AUDIODECODEERROR:aa.log("webCodecs worker.onDecoderError, audio decode error"),this.player.handlerError(oa.d.AUDIODECODEERROR)}}},{key:"getCurrentDts",value:function(){return this.player.getSharedArrayBufferHolder().getAudioDts()||this.currentDts}},{key:"getCurrentTime",value:function(){return this.audioCtx?Math.round(this.audioCtx.currentTime):0}},{key:"setVolume",value:function(e){this.isMuffled||this.isMute?this.postMessage(ma.VOLUME,0):this.postMessage(ma.VOLUME,e),this.volume=e,this.cacheVolume=e}},{key:"setMuffledVolume",value:function(e){this.isMuffled=e,this.isMuffled?this.postMessage(ma.VOLUME,0):this.setVolume(this.cacheVolume)}},{key:"setMuted",value:function(e){this.isMute=e,e?this.postMessage(ma.VOLUME,0):this.setVolume(this.cacheVolume)}},{key:"getRenderFps",value:function(){var e=this.renderNums,t=e-this.lastRenderNums;return t<0&&(t=0),this.lastRenderNums=e,t}},{key:"pause",value:function(){aa.log("AudioWorkletNodeRenderer.pause"),this.audioCtx.suspend()}},{key:"play",value:function(){this._play()}},{key:"_play",value:function(){var e=this,t=this.audioCtx.resume();t?t.then((function(){e.playing=!0,aa.log("AudioRender.play success")})).catch((function(t){e.playing=!1;var i=t.toString();aa.warn("AudioRender.play error: "+i),e.player&&e.player.onAudioPauseByBrowser(),e.userPaused=!0})):this.playing=!1}},{key:"userPlay",value:function(){aa.log("AudioRender.userPlay"),this.userPaused=!1,this.play()}},{key:"userPause",value:function(){aa.log("AudioRender.userPause"),this.userPaused=!0,this.pause(),this.player.onVideoPauseBind()}},{key:"getAudioBufferLen",value:function(){return 0}},{key:"close",value:function(){this.currentDts=0,this.audioCtx&&(this.postMessage(ma.STOP,null),this.bypasser&&(this.bypasser.port.close(),this.bypasser.disconnect(this.audioCtx),this.bypasser=null),this.audioCtx.removeEventListener("statechange",this.onAudioStateChangeBind),this.audioCtx.close(),this.audioCtx=null),this.renderNums=0,this.lastRenderNums=0,this.isFirstFrameTs=0,this.firstTimeStamp=0,this.isFirstPlay=!1}}]),e}(),Ta=function(){function e(){p(this,e);var t=new SharedArrayBuffer(1024);this._mainBuffer=new Uint32Array(t),this._workerBufferAudio=null}return m(e,[{key:"getMainBuffer",value:function(){return this._mainBuffer}},{key:"setWorkerBufferVideo",value:function(e){this._mainBuffer=e}},{key:"setWorkerBufferAudio",value:function(e){this._workerBufferAudio=e}},{key:"storeMainBuffer",value:function(e,t){this._mainBuffer&&Atomics.store(this._mainBuffer,e,t)}},{key:"storeMainShieldAudio",value:function(e){this.storeMainBuffer(oa.a.IS_SHIELD_AUDIO,e)}},{key:"storeFrameBuffer",value:function(e){this.storeMainBuffer(oa.a.FRAME_BUFFER_LEN,e)}},{key:"getBufferLen",value:function(){return this._loadWorker(oa.e.VIDEO_BUFFER_LEN,this._mainBuffer)}},{key:"getVideoPts",value:function(){return this._loadWorker(oa.e.VIDEO_PTS,this._mainBuffer)}},{key:"getDecodedBuffer",value:function(){return this._loadWorker(oa.e.VIDEO_NOT_RENDERD_BUFFER,this._mainBuffer)}},{key:"getRenderNums",value:function(){return this._loadWorker(oa.e.VIDEO_RENDER_NUMS,this._mainBuffer)}},{key:"getAudioRenderNums",value:function(){return this._loadWorker(oa.e.AUDIO_RENDER_NUMS,this._mainBuffer)}},{key:"getVideoThrowNums",value:function(){return this._loadWorker(oa.e.VIDEO_THROW_FRAME_FPS,this._mainBuffer)}},{key:"getAudioTodecodeNums",value:function(){return this._loadWorker(oa.e.AUDIO_TODECODE_NUMS,this._mainBuffer)}},{key:"getVideoTodecodeNums",value:function(){return this._loadWorker(oa.e.VIDEO_TODECODE_NUMS,this._mainBuffer)}},{key:"getAudioDecodedNums",value:function(){return this._loadWorker(oa.e.AUDIO_DECODE_NUMS,this._mainBuffer)}},{key:"getVideoDecodedNums",value:function(){return this._loadWorker(oa.e.VIDEO_DECODE_NUMS,this._mainBuffer)}},{key:"getDecodedVideoDelay",value:function(){return this._loadWorker(oa.e.VIDEO_DECODED_DELAY,this._mainBuffer)}},{key:"getVideoReadyToRenderListLen",value:function(){return this._loadWorker(oa.e.VIDEO_READY_TO_RENDER_LIST_LEN,this._mainBuffer)}},{key:"getVideoDecodeDiscardNums",value:function(){return this._loadWorker(oa.e.VIDEO_DECODE_DISCARD_NUMS,this._mainBuffer)}},{key:"getAudioDts",value:function(){return this._loadWorker(oa.e.AUDIO_DTS,this._mainBuffer)}},{key:"_loadWorker",value:function(e,t){return t?Atomics.load(t,e):0}}]),e}(),Pa=function(){function e(t,i){p(this,e),this._config=t,this._callbacks=i,this._worker=H()(37),this._workerHolder=new la(this),this._sharedArrayBufferHolder=new Ta,this._videoRender=new ca(this),1==localStorage._enableAudioTrack?this._audioRender=new pa(this):this._audioRender=new ga(this),this._isAudioPause=!1,this._isRenderStart=!1,this._logCfgCheckTs=0,this._logCfg={},this._initConfig()}return m(e,[{key:"_initConfig",value:function(){this._workerHolder.postInitConfig({config:JSON.stringify(this._config)}),this._checkLogCfg(ea.now())}},{key:"getWorker",value:function(){return this._worker}},{key:"getWorkerHolder",value:function(){return this._workerHolder}},{key:"getSharedArrayBufferHolder",value:function(){return this._sharedArrayBufferHolder}},{key:"getVideoRender",value:function(){return this._videoRender}},{key:"getAudioRender",value:function(){return this._audioRender}},{key:"getVideoElement",value:function(){return this._videoRender.getVideoElement()}},{key:"getVideoPts",value:function(){return this._videoRender?this._videoRender.getVideoPts():0}},{key:"getDecodeFps",value:function(){return this._videoRender.getDecodeFps()}},{key:"getDecodedBuffer",value:function(){return this._videoRender.getDecodedBuffer()}},{key:"getVideoRenderFps",value:function(){return this._videoRender.getRenderFps()}},{key:"getAudioRenderFps",value:function(){return this._audioRender.getRenderFps()}},{key:"getVideoThrowFps",value:function(){return this._videoRender.getVideoThrowFps()}},{key:"getDiscardVideoFrames",value:function(){return this._videoRender.getDiscardVideoFrames()}},{key:"getCurrentTime",value:function(){return this._audioRender.getCurrentTime()}},{key:"getCurrentAudioDts",value:function(){return this._audioRender.getCurrentDts()}},{key:"getBufferLen",value:function(){return this._sharedArrayBufferHolder.getBufferLen()}},{key:"setRealFps",value:function(e){this._videoRender.setRealFps(e)}},{key:"updateVideoFPS",value:function(e,t){this._videoRender.updateVideoFPS(e,t)}},{key:"getAudioError",value:function(){return this._audioRender.audioPlayerElement.error}},{key:"userPause",value:function(){this._audioRender.userPause()}},{key:"userPlay",value:function(){this._audioRender.userPlay()}},{key:"setPlayMinBuffer",value:function(e){this._workerHolder.postSetPlayMinBuffer({bufferLen:e})}},{key:"startMuteRender",value:function(e){this._audioRender.isAudioPause&&(na.logger.log("WebcodecsPlayer.startMuteRender.".concat(0===e?"mute":"setVolume"," val=").concat(e)),0===e?(this._isAudioPause=!0,this._videoRender.startMuteRender()):this._isAudioPause&&(this.onAudioPlay(),this._audioRender.muteRecoverInit())),this._audioRender.setVolume(e)}},{key:"setMuffledVolume",value:function(e){this._audioRender.setMuffledVolume(e)}},{key:"setPauseVideoDecode",value:function(e){this._workerHolder.postSetPauseVideoDecode({isPause:e})}},{key:"setPauseAudioDecode",value:function(e){this._workerHolder.postSetPauseAudioDecode({isPause:e})}},{key:"isAudioSuspended",value:function(){return this._audioRender.isSuspended()}},{key:"onVisibilitychange",value:function(){this._videoRender.onVisibilitychange()}},{key:"onAudioPauseByBrowser",value:function(){this.audioBrowserPaused=!0}},{key:"onPauseByBrowser",value:function(){this._callbacks&&this._callbacks.onPauseByBrowser()}},{key:"onVideoPause",value:function(){this._videoRender.onVideoPause()}},{key:"onVideoPlay",value:function(){this._videoRender.onVideoPlay()}},{key:"onAudioPlay",value:function(){this.audioBrowserPaused=!1,this._videoRender.onVideoPlay()}},{key:"triggerAudioPlay",value:function(){this._audioRender.play(),this.triggerPlay()}},{key:"triggerPlay",value:function(){this._videoRender.play(),this._callbacks&&this._callbacks.triggerPlay()}},{key:"triggerWebcodecsPlay",value:function(){this.triggerPlay(),this._callbacks&&this._callbacks.triggerWebcodecsPlay()}},{key:"setFramePause",value:function(){this._callbacks&&this._callbacks.setFramePause&&this._callbacks.setFramePause()}},{key:"setFrameRusume",value:function(){this._callbacks&&this._callbacks.setFrameRusume&&this._callbacks.setFrameRusume()}},{key:"renderFpsPause",value:function(){this._callbacks&&this._callbacks.renderFpsPause&&this._callbacks.renderFpsPause()}},{key:"getVideoStatData",value:function(e){1==Number(localStorage._printVideoRenderStat)&&na.logger.log("VideoRender.getVideoStatData",e)}},{key:"onWorkerInterval",value:function(e){this._audioRender.onCheckFastTimer(),this._callbacks&&this._callbacks.onWorkerInterval(e),this._checkLogCfg(e)}},{key:"_checkLogCfg",value:function(e){if(0===this._logCfgCheckTs||e-this._logCfgCheckTs>1e3){this._logCfgCheckTs=e;var t={printTodecodeVideo:1==localStorage._printTodecodeVideo,printToDecodeAudio:1==localStorage._printToDecodeAudio,printDecodedVideo:1==localStorage._printDecodedVideo,printDecodedAudio:1==localStorage._printDecodedAudio,printTorenderVideo:1==localStorage._printTorenderVideo,printTorenderAudio:1==localStorage._printTorenderAudio,printAppendVideo:1==localStorage._printAppendVideo,printAppendAudio:1==localStorage._printAppendAudio,printVideoDecodeFast:1==localStorage._printVideoDecodeFast,printRenderSkipFrame:1==localStorage._printRenderSkipFrame},i=!1;for(var s in t)if(this._logCfg[s]!==t[s]){i=!0;break}this._logCfg=t,i&&this._workerHolder.postLogCfg(t)}}},{key:"onWebcodecsError",value:function(e,t){na.logger.log("WebcodecsPlayer.onWebcodecsError type="+e,t),this._callbacks&&this._callbacks.onWebcodecsError(e,t)}},{key:"containerResize",value:function(e){this._videoRender.containerResize(e)}},{key:"setEnableDiscard",value:function(e){this._workerHolder.postEnableDiscardVideo({enableDiscard:e})}},{key:"updateCurBitrate",value:function(e){this._workerHolder.postUpdateCurBitrate({curBitrate:e})}},{key:"setJitter",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3e3,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5e3,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;this._workerHolder.postSetJitter({bufLen:e,bufMin:t,bufMax:i,jumpBuffer:s,shieldAudioCfgBufLen:r})}},{key:"updateAVCConfig",value:function(e){var t=e.width,i=e.height;na.logger.log("WebcodecsPlayer.updateAVCConfig width=".concat(t," height=").concat(i)),this._isRenderStart||(this._videoRender.start(t,i),this._audioRender.start(),this._isRenderStart=!0),this._workerHolder.postAvcConfig(e)}},{key:"updateAVCPPS",value:function(e,t){this._workerHolder.postAVCPPS({data:e,timestamp:t})}},{key:"updateAVCSPS",value:function(e,t){this._workerHolder.postAVCSPS({data:e,timestamp:t})}},{key:"updateAVCVPS",value:function(e,t){this._workerHolder.postAVCVPS({data:e,timestamp:t})}},{key:"appendVideoSample",value:function(e){var t=e.ts,i=e.key,s=e.cts,r=e.units,a=0,n=0,o=0;r.map((function(e){n+=e.data.byteLength,o++}));var h=new Uint8Array(n+4*o),u=new DataView(h.buffer);u.setUint32(0,h.byteLength);var l=!1,d=0;r.map((function(e,t){var i=e,s=i.data.byteLength;d=i.naluType,l=i.discardAllow,u.setUint32(a,s),a+=4,h.set(i.data,a),a+=s}));var c=new EncodedVideoChunk({type:i?"key":"delta",timestamp:t,duration:3e3,data:u.buffer}),p=new ua(ua.VIDEO,t,c,l,i,s,d,e);1!==Number(localStorage._dropVideoUnit)&&this._workerHolder.postVideoSamples({videoSamples:[p]})}},{key:"updateAudioConfig",value:function(e){na.logger.log("WebcodecsPlayer.updateAudioConfig "+JSON.stringify(e));var t=e.codec,i=e.audioSampleRate,s=e.audioChannelCount,r=e.timeStamp;this._audioRender.initAudio(i,s),this._workerHolder.postAudioConfig({codec:t,sampleRate:i,numberOfChannels:s,timestamp:r})}},{key:"appendAudioSample",value:function(e){var t=e.unit,i=e.ts,s=new Uint8Array(t.byteLength+4);new DataView(s.buffer).setUint32(0,t.byteLength),s.set(t,4);var r=new EncodedAudioChunk({type:"key",timestamp:0,duration:3e3,data:t}),a=new ua(ua.AUIDO,i,r);1==e.empty&&a.setIsEmptyAudioFrame(!0),this._workerHolder.postAudioSamples({audioSamples:[a]})}},{key:"onFastOver",value:function(){this._workerHolder.postFastOver()}},{key:"turnToWebcodecsSoft",value:function(){this._callbacks&&this._callbacks.turnToWebcodecsSoft()}},{key:"setUseSoftAcceleration",value:function(){this._workerHolder.postSetUseSoftAcceleration()}},{key:"updateSoftAcceleration",value:function(){this._workerHolder.postUpdateSoftAcceleration()}},{key:"onWaitKeyFrame",value:function(e){this._callbacks&&this._callbacks.onWaitKeyFrame(e)}},{key:"storeMainShieldAudio",value:function(e){this._sharedArrayBufferHolder.storeMainShieldAudio(e)}},{key:"storeFrameBuffer",value:function(e){this._sharedArrayBufferHolder.storeFrameBuffer(e)}},{key:"destroy",value:function(){this._callbacks=null,this._worker&&(this._workerHolder.postClose(),this._worker.terminate(),this._worker=null),this._audioRender&&(this._audioRender.close(),this._audioRender=null),this._videoRender&&(this._videoRender.close(),this._videoRender=null)}}]),e}(),Ea={setLogLevel:function(e){aa.setLevel(e)},init:function(e){na.init(e)},createIns:function(e,t){return new Pa(e,t)},WebCodecsErrType:oa.d,MainSharedBufferType:oa.a},Ca=0,wa=function(e){Object(M.a)(i,e);var t=Object(U.a)(i);function i(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(s.a)(this,i),(r=t.call(this,e,a,V.a.PLAYER_CORE_TYPE.WEBCODECS))._id=++Ca;var n=a.h265Proxy;return r.h265Proxy=n,r.lowlatencyCfg=a.lowlatencyCfg||{lowlatencyBuf:-1,lowlatencyMin:-1,lowlatencyMax:-1,lowlatencyJit:-1},r.lowlatency=-1!==r.lowlatencyCfg.lowlatencyBuf,r.pushAvcDts=0,Ea.init({logger:v.a,TimeUtil:S.a}),r._mediaWebcodecs=Ea.createIns({lowlatencyCfg:r.lowlatencyCfg,webcodecCfg:f.a.webCodecCfg},{turnToWebcodecsSoft:r.turnToWebcodecsSoft.bind(Object(L.a)(r)),onPauseByBrowser:r.onPauseByBrowser.bind(Object(L.a)(r)),setUseSoftAcceleration:r.setUseSoftAcceleration.bind(Object(L.a)(r)),onWebcodecsError:r.onWebcodecsError.bind(Object(L.a)(r)),triggerWebcodecsPlay:r.triggerWebcodecsPlay.bind(Object(L.a)(r)),triggerPlay:r.triggerPlay.bind(Object(L.a)(r)),onWorkerInterval:r.onWorkerInterval.bind(Object(L.a)(r)),setFramePause:r.setFramePause.bind(Object(L.a)(r)),setFrameRusume:r.setFrameRusume.bind(Object(L.a)(r)),renderFpsPause:r.renderFpsPause.bind(Object(L.a)(r))}),r.toDecodeVideoFrameNums=0,r.decodedVideoFrameNums=0,r.decodeNums=0,r.destroyed=!1,r.count=0,r.width=1280,r.height=720,r.playbackrateChangeAccess=!0,r.mediaDelay=null,r.seiAnchorDelay=-1,r.pushVideoStartRenderTime=0,r.offsetDts=0,r.curVideoDts=0,r.curAudioDts=0,r.playing=!1,r.pause500checked=!1,r.lastFrameTs=0,r.lastVideoDts=0,r.lastAudioDts=0,r.videoWebcodecsPauseTs=0,r.audioWebcodecsPauseTs=0,r.isVideoWebCodecsPaused=!1,r.isAudioWebCodecsPaused=!1,r.parser=new Ts(Object(L.a)(r),r.remuxer,1),r.parser2=new Ts(Object(L.a)(r),r.remuxer,2),r.ctrlBuffer.setBuffered(r.buffered),r.pauseHanlder=new Jr(Object(L.a)(r),{pauseFunc:r._playPause.bind(Object(L.a)(r)),resumeFunc:r._playResume.bind(Object(L.a)(r))}),r.pauseWorkerHanlder=new zr(Object(L.a)(r),{pauseFunc:r._playWorkerPause.bind(Object(L.a)(r)),resumeFunc:r._playWorkerResume.bind(Object(L.a)(r))}),r.webCodecsStat=new Kr(Object(L.a)(r)),n&&n.initRender&&n.initRender(Object(L.a)(r)),r.isRenderStart=!1,r.onVisibilityChangedBind=r.onVisibilitychange.bind(Object(L.a)(r)),r.addEvents(),r.checkQuickTime=0,r.firstGetCurrentTime=0,r.firstPerformentTime=0,r.lastToDecodeAudioTs=0,r.lastToDecodeVideoTs=0,r.startAudioFastTs=0,r.startVideoFastTs=0,r.quickTime=S.a.now(),r.userPaused=!1,r.onVideoErrorBind=r.onVideoError.bind(Object(L.a)(r)),r.onVideoPauseBind=r.onVideoPause.bind(Object(L.a)(r)),r.onVideoPlayBind=r.onVideoPlay.bind(Object(L.a)(r)),r.onVideoPlayingBind=r.onVideoPlaying.bind(Object(L.a)(r)),r.onVideoResizeBind=r.onVideoResize.bind(Object(L.a)(r)),r.isWebcodecsError=!1,r.lastIFrameTs=0,r.audioBrowserPaused=!1,r.isBrowserCloseHardAcc=!1,r.isAudioMuted=!1,r}return Object(a.a)(i,[{key:"addEvents",value:function(){this.handler&&this.handler.eventEmitter&&this.handler.eventEmitter.on(o.VISIBILITY_CHANGE,this.onVisibilityChangedBind)}},{key:"delEvents",value:function(){this.handler&&this.handler.eventEmitter&&this.handler.eventEmitter.off(o.VISIBILITY_CHANGE,this.onVisibilityChangedBind)}},{key:"getCurrentTime",value:function(){return this._mediaWebcodecs.getCurrentTime()}},{key:"getCurrentAudioDts",value:function(){return this._mediaWebcodecs.getCurrentAudioDts()}},{key:"setMuffledVolume",value:function(e){this._mediaWebcodecs.setMuffledVolume(e)}},{key:"onWorkerInterval",value:function(e){this.destroyed||(e-this.quickTime>=1e3&&(this.quickTime=e,this.webCodecsStat.onCheckTimer(e)),(0==this.checkQuickTime||e-this.checkQuickTime>=2e4)&&(this.checkQuickTime=e,v.a.log("WebCodecsPlayer(".concat(this._id,").onCheckAudioQuickTimer aduio currentTime"),this.getCurrentAudioDts())))}},{key:"setPlayMinBuffer",value:function(e){this._mediaWebcodecs.setPlayMinBuffer(e)}},{key:"getBufferLen",value:function(){return this._mediaWebcodecs.getBufferLen()}},{key:"getCurrentDts",value:function(){return this.getVideoPts()}},{key:"getCurrentRealTime",value:function(){return this.getCurrentDts()}},{key:"triggerPlay",value:function(){if(!this.playing){var e=this._mediaWebcodecs.getVideoElement();this.playing=!0,this.handler.onPlayVideo(e,this.widthCfg,this.heightCfg,!1,null,0,this.parser.getCodecType())}}},{key:"triggerWebcodecsPlay",value:function(){if(this.handler.setWebCodecsSuccess(),this.isLive&&f.a.renderStat[0]){var e=this.getVideoPts();this.videoPlayConsuming.addRenderFrameData(e,S.a.now()),this.renderFps.addRender()}}},{key:"setFramePause",value:function(){this.handler.setFramePause()}},{key:"setFrameRusume",value:function(){this.handler.setFrameRusume()}},{key:"renderFpsPause",value:function(){1==f.a.mobVBlockCfg&&this.handler.renderFpsPause(!0)}},{key:"onFastOver",value:function(){this._mediaWebcodecs.onFastOver()}},{key:"onCheckTimer",value:function(e,t){if(this.playing){if(0!=this.shildAudioStartTs){var s=this.getCurrentAudioDts();this.isAudioMuted&&s>=this.shildAudioStartTs&&(v.a.log("WebCodecsPlayer.shieldAudioMute recover"),this.setMuted(!1),this.shildAudioStartTs=0)}N(Object(B.a)(i.prototype),"onCheckTimer",this).call(this,e,t);var r=this.parser.fps.getNoReferFps();this._mediaWebcodecs.updateVideoFPS(this.metadata.recvVideoFps,r)}else this.parser&&this.parser.printPlayFrameInfo&&this.parser.printPlayFrameInfo()}},{key:"getWebCodecsStats",value:function(){return this.webCodecsStat.getStats()}},{key:"onCheckFastTimer",value:function(e,t){if(this.playing&&!this.userPaused){if(N(Object(B.a)(i.prototype),"onCheckFastTimer",this).call(this,e,t),this.pauseHanlder.check(e),!this.pause500checked&&this.pauseHanlder.paused&&e-this.pauseHanlder.pausedTs>500){this.pause500checked=!0;var s=this.getBufferLen();v.a.log("WebCodecsPlayer(".concat(this._id,").onCheckFastTimer: play paused buf=").concat(s))}this.isLive&&this.checkPause5Sec(e)}}},{key:"onCheckFastWorkerTimer",value:function(e){this.playing&&!this.userPaused&&(this.pauseWorkerHanlder.check(e),this._mediaWebcodecs.storeMainShieldAudio(this.isShieldAudio?1:0),this._mediaWebcodecs.storeFrameBuffer(this.getFrameBufferLen()))}},{key:"checkPause5Sec",value:function(e){var t=this.getCurrentDts(),i=this.getCurrentAudioDts(),s=!1,r=!1;0!=t&&0!=this.lastVideoDts&&t==this.lastVideoDts?this.isVideoWebCodecsPaused||(this.videoWebcodecsPauseTs=e,this.isVideoWebCodecsPaused=!0):(this.videoWebcodecsPauseTs=0,this.isVideoWebCodecsPaused=!1),0!=i&&0!=this.lastAudioDts&&i==this.lastAudioDts?this.isAudioWebCodecsPaused||(this.audioWebcodecsPauseTs=e,this.isAudioWebCodecsPaused=!0):(this.audioWebcodecsPauseTs=0,this.isAudioWebCodecsPaused=!1),0!=this.videoWebcodecsPauseTs&&e-this.videoWebcodecsPauseTs>=5e3&&(s=!0),0!=this.audioWebcodecsPauseTs&&e-this.audioWebcodecsPauseTs>=5e3&&(r=!0),s?v.a.warn("WebCodecsPlayer.onCheckTimer video paused 5 sec."):r&&v.a.warn("WebCodecsPlayer.onCheckTimer audio paused 5 sec."),(s||r)&&(this._onErrorEvent(3),this._onPlayerError(!0)),this.lastVideoDts=t,this.lastAudioDts=i}},{key:"onWebcodecsError",value:function(e,t){if(!this.isWebcodecsError){this.isWebcodecsError=!0,v.a.log("WebCodecsPlayer.onWebcodecsError, type=".concat(e));var i=[e];t&&i.push(t),this.handler&&this.handler.onActWebCodecs&&this.handler.onActWebCodecs([22],i),this.turnToMse(e)}}},{key:"turnToMse",value:function(e){if(this.handler&&this.handler._hyPlayer){if(e===Ea.WebCodecsErrType.VIDEODECODEERROR)this.autoReport(),this.handler._hyPlayer.webcodecsErrCount++;else if(e===Ea.WebCodecsErrType.AUDIODECODEERROR)this.autoReport(),this.handler._hyPlayer.webcodecsErrCount++;else if(e===Ea.WebCodecsErrType.VIDEOFAST)this.handler._hyPlayer.webcodecsErrCount++;else if(e===Ea.WebCodecsErrType.AUDIOFAST)this.handler._hyPlayer.webcodecsErrCount++;else{if(e!==Ea.WebCodecsErrType.WORKERERROR)return this.handler._hyPlayer&&(this.handler._hyPlayer.turnMseType=e),e===Ea.WebCodecsErrType.DECODE_COST?localStorage.nextWcsTime=Date.now()+2592e5:e===Ea.WebCodecsErrType.DECODE_DTS&&(localStorage.nextWcsTime=Number.MAX_SAFE_INTEGER),void this.handler.turnToMse();this.handler._hyPlayer.webcodecsErrCount++}this.handler._hyPlayer&&this.handler._hyPlayer.webcodecsErrCount>=3?(this.handler._hyPlayer.turnMseType=Ea.WebCodecsErrType.RETRY_MAX_TIMES,this.handler.turnToMse()):this.handler.webcodecsRetry()}}},{key:"updateAVCConfig",value:function(e){this._mediaWebcodecs.updateAVCConfig(e)}},{key:"updateAudioConfig",value:function(e,t,s){N(Object(B.a)(i.prototype),"updateAudioConfig",this).call(this,e,t,s),this._mediaWebcodecs&&this._mediaWebcodecs.updateAudioConfig(e)}},{key:"updateAVCPPS",value:function(e,t){this._mediaWebcodecs.updateAVCPPS(e,t)}},{key:"updateAVCSPS",value:function(e,t){this._mediaWebcodecs.updateAVCSPS(e,t)}},{key:"updateAVCVPS",value:function(e,t){this._mediaWebcodecs.updateAVCVPS(e,t)}},{key:"pushAvcSample",value:function(e){this.lowlatency?(this.pushAvcDts=e.ts,this._appendVideoSample(e)):N(Object(B.a)(i.prototype),"pushAvcSample",this).call(this,e)}},{key:"pushAacSample",value:function(e){this.lowlatency?this._appendAudioSample(e):N(Object(B.a)(i.prototype),"pushAacSample",this).call(this,e)}},{key:"appendAvcTrack",value:function(e){var t=this;e.samples.map((function(e){e&&t._appendVideoSample(e)}))}},{key:"_appendVideoSample",value:function(e){if(this.isLive){var t=S.a.now();this.videoPlayConsuming.pushRemuxedVideoFrameData(t),this.videoPlayConsuming.addRemuxFrameData(e.ts,e.ts+e.cts,t)}this._mediaWebcodecs.appendVideoSample(e)}},{key:"appendAacSample",value:function(e){var t=this;e.samples.map((function(e){e&&t._appendAudioSample(e)}))}},{key:"_appendAudioSample",value:function(e){if(this.isLive){var t=S.a.now();this.audioPlayConsuming.addRemuxFrameData(e.ts,e.ts,t),this.audioPlayConsuming.pushRemuxedVideoFrameData(t)}this._mediaWebcodecs.appendAudioSample(e)}},{key:"onVisibilitychange",value:function(){this._mediaWebcodecs.onVisibilitychange(),"hidden"==document.visibilityState?this.isBrowserHidden=!0:"visible"==document.visibilityState&&(this.isBrowserHidden=!1)}},{key:"containerResize",value:function(e){this._mediaWebcodecs.containerResize(e)}},{key:"getVideoPts",value:function(){return this._mediaWebcodecs.getVideoPts()}},{key:"destroy",value:function(){N(Object(B.a)(i.prototype),"destroy",this).call(this),this._mediaWebcodecs.destroy(),this.destroyed=!0,this.isRenderStart=!1,this.playing=!1,this.pause500checked=!1,this.buffered.stop(),this.parser.destroy(),this.pauseStat.reset(),this.pauseHanlder.reset(),this.renderFps.reset(),qr(this.rafId),this.startAudioFastTs=0,this.startVideoFastTs=0,this.userPaused=!1,this.quickTime=0,this.delEvents(),this.lastVideoDts=0,this.lastAudioDts=0,this.videoWebcodecsPauseTs=0,this.audioWebcodecsPauseTs=0,this.isVideoWebCodecsPaused=!1,this.isAudioWebCodecsPaused=!1,this.isWebcodecsError=!1,this.lastIFrameTs=0,this.webCodecsStat.destroy(),this.isBrowserCloseHardAcc=!1,this.isAudioMuted=!1}},{key:"_playPause",value:function(e){var t=this.getVideoPts()>0;this.handler.onPlayPause(e,t)}},{key:"_playResume",value:function(e,t){this.pause500checked=!1;var i=this.getVideoPts()>0;this.handler.onPlayResume(e,i)}},{key:"_playWorkerPause",value:function(e){this.pauseStat.pause(),this.handler._hyPlayer&&this.handler._hyPlayer.roomRecordStat&&this.handler._hyPlayer.roomRecordStat.roomNoRenderStat.pause();var t=this.getVideoPts()>0;this.handler.onPlayPauseWorker&&this.handler.onPlayPauseWorker(e,t)}},{key:"_playWorkerResume",value:function(e,t){this.pauseStat.resume(),this.handler.eventEmitter&&this.handler.eventEmitter.roomRecordStat&&this.handler.eventEmitter.roomRecordStat.roomNoRenderStat.resume();var i=this.getVideoPts()>0;this.handler.onPlayResumeWorker&&this.handler.onPlayResumeWorker(e,i)}},{key:"check500Pause",value:function(){this.handler.check500Pause&&this.handler.check500Pause()}},{key:"getDecodeFps",value:function(){return this._mediaWebcodecs.getDecodeFps()}},{key:"getVideoRenderFps",value:function(){return this._mediaWebcodecs.getVideoRenderFps()}},{key:"getAudioRenderFps",value:function(){return this._mediaWebcodecs.getAudioRenderFps()}},{key:"getVideoThrowFps",value:function(){return this._mediaWebcodecs.getVideoThrowFps()}},{key:"getDecodedBuffer",value:function(){return this._mediaWebcodecs.getDecodedBuffer()}},{key:"getDiscardVideoFrames",value:function(){return this._mediaWebcodecs.getDiscardVideoFrames()}},{key:"setJitter",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3e3,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5e3,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;N(Object(B.a)(i.prototype),"setJitter",this).call(this,e,t,s),this._mediaWebcodecs.setJitter(e,t,s,r>0?r:f.a.setVideoCTCfg[1],f.a.shieldAudioCfg[1])}},{key:"onVideoPause",value:function(e){v.a.log("WebCodecsPlayer.onVideoPause"),this.userPaused=!0,this._mediaWebcodecs.onVideoPause()}},{key:"onVideoPlaying",value:function(){if(this.handler&&this.handler.updateStatus){if(this._mediaWebcodecs.isAudioSuspended())return;var e=l.VIDEO_PLAYING;this.handler.updateStatus(e)}}},{key:"turnToWebcodecsSoft",value:function(){this.handler.turnToWebcodecsSoft()}},{key:"onPauseByBrowser",value:function(){v.a.log("WebCodecsPlayer.onPauseByBrowser"),this.userPaused=!0,this._mediaWebcodecs.onVideoPause(),this.handler&&(this.handler.onPauseByBrowser&&this.handler.onPauseByBrowser(),this.handler.updateStatus&&this.handler.updateStatus(l.BROWSER_PAUSE),this.handler.eventEmitter&&this.handler.eventEmitter.trigger(o.BROWSER_PAUSE,{}))}},{key:"onAudioPauseByBrowser",value:function(){this.audioBrowserPaused=!0}},{key:"onVideoPlay",value:function(e){v.a.log("WebCodecsPlayer.onVideoPlay"),this.userPaused=!1,this.audioBrowserPaused=!1,this._mediaWebcodecs.onVideoPlay()}},{key:"onVideoError",value:function(e){var t="",i=this._mediaWebcodecs.getAudioError();if(i){var s=i.code;t=" errCode="+s+" "+["Unknow","用户终止","网络错误","解码错误","格式不支持"][s],3!=s&&4!=s||(this._onErrorEvent(3==s?1:2),this._onPlayerError(!0))}v.a.warn("WebCodecsPlayer.onVideoError"+t)}},{key:"_onPlayerError",value:function(e){!this.isPlayerError&&this.handler&&(this.isPlayerError=!0,this.handler.onPlayerError(e))}},{key:"_onErrorEvent",value:function(e){this.isErrorEvent||(this.isErrorEvent=!0,this.handler&&this.handler.onErrorEvent&&this.handler.onErrorEvent({type:e}))}},{key:"pause",value:function(){v.a.info("WebCodecsPlayer.pause"),this.userPaused=!0,this._mediaWebcodecs.userPause(),this.handler._hyPlayer&&this.handler._hyPlayer.roomRecordStat&&this.handler._hyPlayer.roomRecordStat.roomNoRenderStat.pause()}},{key:"play",value:function(){v.a.info("WebCodecsPlayer.play"),this.userPaused=!1,this._mediaWebcodecs.userPlay()}},{key:"setUseSoftAcceleration",value:function(){this._mediaWebcodecs.setUseSoftAcceleration(),this.handler.setUseSoftAcceleration(!0)}},{key:"setPauseVideoDecode",value:function(e){this._mediaWebcodecs.setPauseVideoDecode(e)}},{key:"setPauseAudioDecode",value:function(e){this._mediaWebcodecs.setPauseVideoDecode(e)}},{key:"disableHardAcc",value:function(){N(Object(B.a)(i.prototype),"disableHardAcc",this).call(this),this.onWebcodecsError(Ea.WebCodecsErrType.DISABLE_HARDWARE_ACCELERATION)}},{key:"win7PerfInsufficient",value:function(){this.onWebcodecsError(Ea.WebCodecsErrType.WIN_PERF_INSUFFICIENT)}},{key:"angelNullError",value:function(){this.onWebcodecsError(Ea.WebCodecsErrType.ANGLE_NULL)}},{key:"chromeH265RenderEmptyError",value:function(){this.isH265Mode&&(localStorage.isChromeH265RenderInfoEmpty=1,this.onWebcodecsError(Ea.WebCodecsErrType.CHROME_H265_RENDER_INFO_EMPTY))}},{key:"isNotSupportWebcodecsConfig",value:function(){this.onWebcodecsError(Ea.WebCodecsErrType.IS_NOT_SUPPORT_CONFIGURE)}},{key:"setEnableDiscard",value:function(e){this._mediaWebcodecs.setEnableDiscard(e)}},{key:"updateCurBitrate",value:function(e){this._mediaWebcodecs.updateCurBitrate(e)}},{key:"setDisableHardAcc",value:function(){this.isBrowserCloseHardAcc=!0}},{key:"autoReport",value:function(){E.a.name.indexOf("chrome")>-1&&this.isH265Mode&&1e3*Math.random()<=100&&1==f.a.isAutoWcsReport&&this.handler.eventEmitter&&this.handler.eventEmitter.trigger(o.P2P_REPORT)}},{key:"setRealFps",value:function(e){this._mediaWebcodecs.setRealFps(e)}},{key:"startMuteRender",value:function(e){this._mediaWebcodecs.startMuteRender(e)}},{key:"setMuted",value:function(e){this.isAudioMuted=e,this._mediaWebcodecs.setMuted(e)}},{key:"on265StartCodeError",value:function(){this.h265Proxy&&this.h265Proxy.on265StartCodeError()}},{key:"turnToH264",value:function(e){this.h265Proxy&&this.h265Proxy.stop(),this.handler&&this.handler.turnToH264(e)}},{key:"getRenderElement",value:function(){return this._mediaWebcodecs.getVideoElement()}}]),i}(Zs),Ia=0,Aa=function(){function e(t,i,r){Object(s.a)(this,e),this._id=Ia++,v.a.log("P2PFlvPlayer(".concat(this._id,").constructor")),this._isP2pPlayIng=!1,this._type=O.FLV,this.eventEmitter=t,this._hyPlayer=i.hyPlayerIns,this.player=null,this.p2pPlayer=null,this.flvPlayer=null,this.exceptionStat=new kr(this),this.info=null,this.isPureAudio=i.isPureAudio,this.isPureVideo=i.isPureVideo,this.h265Proxy=i.h265Proxy,this.statSwitch=i.statSwitch,this.autoMonitor=i.autoMonitor,this.recSysStat=i.recSysStat,this.isSoftSolution=i.isSoftSolution,this._switch265FailBind=this._switch265Fail.bind(this),this.ctrlBitrate=new jr({player:this,statSwitch:this.statSwitch,autoMonitor:this.autoMonitor,recSysStat:this.recSysStat},{start:this._switchStart.bind(this),first:this._switchFirstSample.bind(this),done:this._switchDone.bind(this)}),this.videoElement=i.videoElement,this.tsdb=i.tsdb,this.stat=i.stat,this.mse=null,this.ctrlBitrate.beforeSwitchCb=this._beforeSwitch.bind(this),this.switchDoneBefore=new Yr,this.anticode=new yt,this.videoStatus=l.VIDEO_STOP,this.closeP2pCoderates=[],this.onP2PTimeoutBind=this.onP2pTimeout.bind(this),this.flvTryToP2PBind=this.flvTryToP2P.bind(this),this.eventEmitter.on(o.P2P_TIMEOUT,this.onP2PTimeoutBind),this.eventEmitter.on(o.FLV_TRY_TO_P2P,this.flvTryToP2PBind),this.handlerType=0,this.playerCoreType="",this.isWebcodecsPlaying=!1}return Object(a.a)(e,[{key:"initPlayer",value:function(e,t){this.info=e,e.mpExtArgs&&e.mpExtArgs.closep2pcoderate&&(this.closeP2pCoderates=e.mpExtArgs.closep2pcoderate.split(","));var i=e.iIsP2PSupport,s=this.getIsCloseP2P();i&&s&&(e.type===HYPlayer.VR?e.vr.playerType=0:e.type=HYPlayer.FLV),this.handlerType=t.handlerType,v.a.log("P2PFlvPlayer(".concat(this._id,").initPlayer, closeP2pCoderates"),this.closeP2pCoderates),Q.add(this.onCheckTimer,this,1e3);var r=t.playerCoreType;this.playerCoreType=r,this.mse=r===V.a.PLAYER_CORE_TYPE.WEBCODECS?this.createWebCodecsPlayer():this.createMse(),r===V.a.PLAYER_CORE_TYPE.WEBCODECS?this.isSoftSolution?this.stat.setComDim(g.a.DIM_COM.MSE_PLAYER,3):this.stat.setComDim(g.a.DIM_COM.MSE_PLAYER,2):this.stat.setComDim(g.a.DIM_COM.MSE_PLAYER,1),t.mse=this.mse,t.exceptionStat=this.exceptionStat,t.p2pFlvPlayer=this,t.anticode=this.anticode,this.flvPlayer=new bi(this.eventEmitter,t,this.videoElement),this.startPlayer(e)}},{key:"createMse",value:function(){var e=new Cr(this,{videoType:"flv",isPureAudio:this.isPureAudio,isPureVideo:this.isPureVideo,h265Proxy:this.h265Proxy,videoElement:this.videoElement});return e.setPushGop(f.a.pushGop),e}},{key:"createWebCodecsPlayer",value:function(){var e=localStorage.hasOwnProperty("_minBuffer")?Number(localStorage._minBuffer):3e3,t=new wa(this,{videoType:"flv",isPureAudio:this.isPureAudio,isPureVideo:this.isPureVideo,h265Proxy:this.h265Proxy,videoElement:this.videoElement,isH265Mode:this.h265Proxy.isReady||this.h265Proxy.isH265MseCodec,lowlatencyCfg:{lowlatencyBuf:-1,lowlatencyMin:e+500,lowlatencyMax:e+1e3,openRenderSync:1}});return t.setPushGop(f.a.pushGop),t}},{key:"startPlayer",value:function(e){switch(this.h265Proxy.isLive=!0,66==e.lineType&&e.type!==HYPlayer.FLV||this.stat.setComDim(g.a.DIM_COM.UA,""),e.type){case O.FLV:this._hyPlayer.lastFlvInfo=e,this._hyPlayer.lastP2PInfo&&(this.flvPlayer.backToP2P.lastP2PInfo=this._hyPlayer.lastP2PInfo),this.player=this.flvPlayer,this._type=O.FLV;break;case O.P2P:if(!X.isSupportP2P()||f.a.isCloseP2P(e.uid)||f.a.isCloseAllFuncs(e.uid)||f.a.isCloseP2PBroVer()||f.a.isClosePidMediaP2P(e.presenterUid,e.lineType))return this._hyPlayer.lastP2PInfo=e,this.onP2pTimeout(o.P2P_TIMEOUT,{reason:V.a.turnToFlvReason.NOT_SUPPORT_P2P}),void v.a.warn("xxxxxxx "+E.a.name+" "+E.a.version.major+" unsupport p2p !");66==e.lineType&&navigator&&navigator.userAgent&&this.stat.setComDim(g.a.DIM_COM.UA,navigator.userAgent),this._hyPlayer.lastP2PInfo=e,this._isP2pPlayIng=!0,this.p2pPlayingEvent(this._isP2pPlayIng),this._hyPlayer.isForceFlv=!1,this.player=this.p2pPlayer,this._type=O.P2P}return this.playerCoreType===V.a.PLAYER_CORE_TYPE.WEBCODECS&&this.isSoftSolution&&this.mse.setUseSoftAcceleration(),this.mse&&this.mse.updateCurBitrate&&this.mse.updateCurBitrate(e.curBitrate),!0}},{key:"start",value:function(e){e.type==O.P2P&&this.flvPlayer.checkParams(e),e.type==O.P2P&&e.p2purl?this.player.startP2PUrl(e):this.player.start(e)}},{key:"startP2PUrl",value:function(e){e.type==O.P2P&&e.p2purl&&this.player.startP2PUrl(e)}},{key:"onCheckTimer",value:function(e,t){this.anticode.onCheckTimer(e,t)}},{key:"flvTryToP2P",value:function(){v.a.log("P2PFlvPlayer(".concat(this._id,").flvTryToP2P")),this._hyPlayer.lastP2PInfo&&(this._hyPlayer.flvTryToP2P&&this._hyPlayer.flvTryToP2P(),this._hyPlayer.metrics.setP2p(1),ee.a.flvTryToP2P=1,this._hyPlayer.lastP2PInfo.type===HYPlayer.VR?this._hyPlayer.lastP2PInfo.vr.playerType=1:this._hyPlayer.lastP2PInfo.type=HYPlayer.P2P,this.trigger(o.FLV_TO_P2P),this._hyPlayer.isForceFlv=!1,this._hyPlayer.sdkTurnToP2P=!0,this._hyPlayer.start(this._hyPlayer.lastP2PInfo)),this._hyPlayer.flacMgr&&(this._hyPlayer.stopFlac(),this._hyPlayer.startFlac())}},{key:"onP2pTimeout",value:function(e,t){this._hyPlayer.onP2pTimeout&&this._hyPlayer.onP2pTimeout(),this._isP2pPlayIng=!1,this.p2pPlayingEvent(this._isP2pPlayIng),this._hyPlayer.isForceFlv=!0,this._hyPlayer.lastP2PInfo.type===HYPlayer.VR?this._hyPlayer.lastP2PInfo.vr.playerType=0:this._hyPlayer.lastP2PInfo.type=HYPlayer.FLV,this._hyPlayer.start(this._hyPlayer.lastP2PInfo);var i=t.reason,s=t.domain,r=t.pcdnIaas;i!=V.a.turnToFlvReason.P2P_ARGS_ERROR&&i!=V.a.turnToFlvReason.P2P_COOLING&&i!=V.a.turnToFlvReason.IS_NOT_FIRST_FETCH&&i!=V.a.turnToFlvReason.VIDEO_BUFFER_EMPTY&&i!=V.a.turnToFlvReason.NOT_SUPPORT_P2P&&(v.a.log("P2PFlvPlayer.onP2pTimeout, domain=".concat(s,", reason=").concat(i)),this.stat&&this.stat.setComDim(g.a.DIM_COM.P2P_TO_FLV_DOMAIN,s),this.stat.setComDim(g.a.DIM_COM.PCDN_IAAS,r))}},{key:"p2pPlayingEvent",value:function(e){this.trigger(o.P2P_PLAYING_EVENT,{isP2pPlayIng:e})}},{key:"trigger",value:function(e,t){this.eventEmitter.trigger(e,t)}},{key:"setVolume",value:function(e){this.player.setVolume(e)}},{key:"setEnableLowLatency",value:function(e){this.player&&this.player.setEnableLowLatency&&this.player.setEnableLowLatency(e)}},{key:"setPlaybackrateAccess",value:function(e){this.player&&this.player.setPlaybackrateAccess&&this.player.setPlaybackrateAccess(e)}},{key:"updateFlvConfig",value:function(){this.player&&this.player.updateFlvConfig&&this.player.updateFlvConfig()}},{key:"updateP2PConfig",value:function(){this.player&&this.player.updateP2PConfig&&this.player.updateP2PConfig()}},{key:"getFrameData",value:function(){return this.player&&this.player.getFrameData()}},{key:"getExceptionStat",value:function(){return this.player.exceptionStat?this.player.exceptionStat.getStat():""}},{key:"seek",value:function(e){this.player&&this.player.seek&&this.player.seek(e)}},{key:"getBufferLen",value:function(){return this.mse&&this.mse.getBufferLen?this.mse.getBufferLen():0}},{key:"setMuted",value:function(e){this.player&&this.player.setMuted(e)}},{key:"getMuted",value:function(){return this.player&&this.player.getMuted()}},{key:"getCurrentTime",value:function(){return this.player&&this.player.getCurrentTime()}},{key:"getCurrentDts",value:function(){return this.player?this.player.getCurrentDts():0}},{key:"getCurrentSeiOffsetDts",value:function(){return this.player?this.player.getCurrentSeiOffsetDts():0}},{key:"play",value:function(){this.player&&this.player.play()}},{key:"pause",value:function(){this.player&&this.player.pause()}},{key:"stop",value:function(){v.a.log("P2PFlvPlayer(".concat(this._id,").stop")),this._isP2pPlayIng=!1,this.videoStatus=l.VIDEO_STOP,this.p2pPlayingEvent(this._isP2pPlayIng),this.flvPlayer&&(this.flvPlayer.stop(),this.flvPlayer=null),this.p2pPlayer&&(this.p2pPlayer.stop(),this.p2pPlayer=null),this.mse&&(this.mse.destroy(),this.mse=null),this.exceptionStat.reset(),this.eventEmitter.off(o.P2P_TIMEOUT,this.onP2PTimeoutBind),this.eventEmitter.off(o.FLV_TRY_TO_P2P,this.flvTryToP2PBind),this.ctrlBitrate.stop(),this.switchDoneBefore.stop(),Q.remove(this._switchFirstVideoTimeout,this),Q.remove(this._switchPtsIFrameTimeout,this),Q.remove(this.onCheckTimer,this),this.info=null,this.handlerType=0,this.isWebcodecsPlaying=!1}},{key:"destroy",value:function(){this.player&&this.player.destroy&&this.player&&this.player.destroy()}},{key:"stopStream",value:function(e){this.player&&this.player.stopStream&&this.player.stopStream(e)}},{key:"checkPcdnMode",value:function(e){this.player&&this.player.checkPcdnMode&&this.player.checkPcdnMode(e.mPcdnModeSwitch.value,e.mPcdnModePcdnName.value)}},{key:"containerResize",value:function(e){this.player&&this.player.h265Proxy&&this.player.h265Proxy.containerResize&&this.player.h265Proxy.containerResize(e)}},{key:"getCdnSip",value:function(){return this.player&&this.player.getCdnSip&&this.player.getCdnSip()}},{key:"getDelayInfo",value:function(){return this.player&&this.player.mse.getDelayInfo()}},{key:"getRealBitrate",value:function(){return this.player&&this.player.mse.getRealBitrate()}},{key:"setVideoPlayTimeSended",value:function(){this.player&&this.player.setVideoPlayTimeSended&&this.player.setVideoPlayTimeSended()}},{key:"onVideoStop",value:function(e,t){this.player&&this.player.onVideoStop&&this.player.onVideoStop(e,t)}},{key:"onPlayResume",value:function(e){this.player&&this.player.onPlayResume&&this.player.onPlayResume(e)}},{key:"onPlayResumeWorker",value:function(e){this.player&&this.player.onPlayResumeWorker&&this.player.onPlayResumeWorker(e)}},{key:"onPlayerError",value:function(e){this.player&&this.player.onPlayerError&&this.player.onPlayerError(e)}},{key:"onErrorEvent",value:function(e){v.a.log("P2PFlvPlayer(".concat(this._id,").onErrorEvent"),e),this.player&&this.player.onErrorEvent&&this.player.onErrorEvent(e)}},{key:"onMseHevcError",value:function(){v.a.log("P2PFlvPlayer(".concat(this._id,").onMseHevcError")),this.player&&this.player.turntoH265Wasm&&this.player.turntoH265Wasm()}},{key:"onVideoParseInvalid",value:function(){this.player&&this.player.onVideoParseInvalid&&this.player.onVideoParseInvalid()}},{key:"onGop",value:function(e){this.player&&this.player.onGop&&this.player.onGop(e)}},{key:"turnToH264",value:function(e){this.player&&this.player.turnToH264&&this.player.turnToH264(e)}},{key:"h265Retry",value:function(){this.player&&this.player.h265Retry&&this.player.h265Retry()}},{key:"reloadInError",value:function(){this.player&&this.player.reloadInError&&this.player.reloadInError()}},{key:"resetMediasource",value:function(){this.player&&this.player.resetMediasource&&this.player.resetMediasource()}},{key:"recvDataFull",value:function(){this.player&&this.player.recvDataFull&&this.player.recvDataFull()}},{key:"onPlayVideo",value:function(e,t,i,s,r,a,n){this.updateStatus(l.VIDEO_PLAYING),this.player&&this.player.onPlayVideo&&this.player.onPlayVideo(e,t,i,s,r,a,n)}},{key:"onSendSeiData",value:function(e,t,i){this.player&&this.player.onSendSeiData&&this.player.onSendSeiData(e,t,i)}},{key:"onSendScriptVolumeInfo",value:function(e,t){this.player&&this.player.onSendScriptVolumeInfo&&this.player.onSendScriptVolumeInfo(e,t)}},{key:"onSBUpdateEnd",value:function(){this.player&&this.player.onSBUpdateEnd&&this.player.onSBUpdateEnd()}},{key:"onPauseByBrowser",value:function(){this.player&&this.player.onPauseByBrowser&&this.player.onPauseByBrowser()}},{key:"updateStatus",value:function(e){this.player&&this.player.updateStatus&&this.player.updateStatus(e),this.videoStatus=e}},{key:"onPause5Sec",value:function(){this.player&&this.player.onPause5Sec&&this.player.onPause5Sec()}},{key:"setEmptyFrames",value:function(e){this.player&&this.player.hasEmptyFrames&&(this.player.hasEmptyFrames=e)}},{key:"onPlayPause",value:function(e,t){this.player&&this.player.onPlayPause&&this.player.onPlayPause(e,t)}},{key:"onPlayPauseWorker",value:function(e,t){this.player&&this.player.onPlayPauseWorker&&this.player.onPlayPauseWorker(e,t)}},{key:"getWaitBufferLen",value:function(){return this.player?this.player.getWaitBufferLen():0}},{key:"getWaitFrameTime",value:function(e){return this.player?this.player.getWaitFrameTime(e):0}},{key:"getRecvInfo",value:function(){return this.player&&this.player.getRecvInfo&&this.player.getRecvInfo()}},{key:"setAudioUtil",value:function(e){return this.player&&this.player.setAudioUtil&&this.player.setAudioUtil(e)}},{key:"turnToMse",value:function(){this.stop(),this.eventEmitter.trigger(o.TURN_TO_MSE)}},{key:"webcodecsRetry",value:function(){this.stop(),this.eventEmitter.trigger(o.WEBCODECS_RETRY)}},{key:"turnToWebcodecsSoft",value:function(){A.b.isWebCodecsSupported()&&(v.a.log("P2PFlvPlayer.turnToWebcodecsSoft"),this.stop(),this.eventEmitter.trigger(o.TURN_TO_WEBCODECS_SOFT))}},{key:"_beforeSwitch",value:function(e){this.switchDoneBefore.stop();var t=this.info;t._delayRemove=!1,t.iBitRate=e.iBitRate,t.curBitrate=e.bitrate,t.originalBitrate=0===e.iBitRate,t.iCodecType=e.iCodecType,t.iHEVCBitRate=e.iHEVCBitRate;var i=this.h265Proxy.renderInited;this.h265Proxy.initSupport(t);var s=this.h265Proxy.isSupported;!i&&s?(this.ctrlBitrate.switchType=jr.SwitchType.H264ToH265,this.h265Proxy.loadDecoder(t.h5Root,{ready:this._onH265DecoderReady.bind(this),error:this._switch265FailBind,timeout:this._switch265FailBind})):(i||s?i&&s?this.ctrlBitrate.switchType=jr.SwitchType.H265ToH265:i&&!s&&(this.ctrlBitrate.switchType=jr.SwitchType.H265ToH264,t._delayRemove=!0):this.ctrlBitrate.switchType=jr.SwitchType.H264ToH264,this.switchLevel(t))}},{key:"_onH265DecoderReady",value:function(){v.a.log("IPlayer._onH265DecoderReady"),this.info._delayRemove=!0,this.switchLevel(this.info)}},{key:"_switch265Fail",value:function(){this.ctrlBitrate.switchType=jr.SwitchType.H264ToH264,this.switchLevel(this.info)}},{key:"setAutoInfo",value:function(e){this.ctrlBitrate.setAutoInfo(e)}},{key:"switchLevel",value:function(e){f.a.initByBitrate(e.curBitrate),this.player.started&&(this.info=e,this.statSwitch.check(e,!0),this.ctrlBitrate.switchBitrate(e.curBitrate),this._triggerAutoChanged())}},{key:"getIsCloseP2P",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(0===f.a.closeP2PConfig[0])return!1;var t=e.iBitRate||this.info.iBitRate,i=!1;return this.closeP2pCoderates.map((function(e){Number(e)===Number(t)&&(i=!0)})),i}},{key:"getIsEnableAuto",value:function(e){var t=this;if(0==f.a.closeP2PConfig[0]||0==f.a.closeP2PConfig[1])return!0;if(this.info.iIsP2PSupport&&1==f.a.closeP2PConfig[1]){var i=this.info.bitrateList,s=0;if(i.map((function(e){-1!=t.closeP2pCoderates.indexOf(String(e.iBitRate))&&s++})),0!=i.length){if(0===s)return!0;if(0!=s&&s!=i.length)return!1;if(0!=s&&s==i.length)return!0}}return!0}},{key:"getDurationTime",value:function(){return this.player?this.player.getDurationTime&&this.player.getDurationTime():0}},{key:"setUseSoftAcceleration",value:function(e){this.player&&this.player.setUseSoftAcceleration&&this.player.setUseSoftAcceleration(e)}},{key:"onActWebCodecs",value:function(e,t){this.player&&this.player.onActWebCodecs&&this.player.onActWebCodecs(e,t)}},{key:"_switchStart",value:function(e,t){var i=this.info.iBitRate,s=this.info.iIsP2PSupport,r=this.getIsCloseP2P(),a=this.getBufferLen();v.a.log("IPlayer(".concat(this._id,")._switchStart bufferLen=").concat(a," dts=").concat(e," pts=").concat(t," isCloseP2P=").concat(r," iIsP2PSupport=").concat(s," iBitRate=").concat(i)),s?r&&this._type==O.P2P?(this.info.type=O.FLV,this._type=O.FLV,this.flvPlayer.info=this.info,this.p2pPlayer.stopPlayer(),this.flvPlayer.startPlayer(this.info),this._switchStartFlv(e,t),this.player=this.flvPlayer):r&&this._type==O.FLV?this._switchStartFlv():r||this._type!=O.P2P?r||this._type!=O.FLV||(this.info.type=O.P2P,this.flvPlayer.stopPlayer(),this.flvPlayer.loader.close(),this._type=O.P2P,this.p2pPlayer.startPlayer(this.info),this._hyPlayer.lastP2PInfo=this.info,this._switchStartP2P(e,t),this.player=this.p2pPlayer):this._switchStartP2P(e,t):this._switchStartFlv(e,t),this.ctrlBitrate._badStat.setStart(a),this.ctrlBitrate._seg.nextIFrame(),Q.once(this._switchFirstVideoTimeout,this,1e3),this.isSwitchPause=!1}},{key:"_switchStartP2P",value:function(e,t){this.p2pPlayer.loaderMgr.stopFullStream(),this.p2pPlayer._switchStart(e,t),this.p2pFlvPlayerSetType(O.P2P)}},{key:"_switchStartFlv",value:function(e,t){this.flvPlayer.loader.close(),this.flvPlayer._switchStart(e,t),this.p2pFlvPlayerSetType(O.FLV)}},{key:"p2pFlvPlayerSetType",value:function(e){1==this.handlerType&&this._hyPlayer.p2pFlvPlayerSetType(e)}},{key:"onConnected",value:function(){v.a.log("IPlayer(".concat(this._id,").onConnected")),this.ctrlBitrate._badStat.setConnected(),this.ctrlBitrate._seg.connected()}},{key:"_switchFirstSample",value:function(){v.a.log("IPlayer(".concat(this._id,")._switchFirstSample")),this.ctrlBitrate._badStat.setFirstFrame(),this.ctrlBitrate._seg.firstVideo(),Q.remove(this._switchFirstVideoTimeout,this),Q.once(this._switchPtsIFrameTimeout,this,1e3)}},{key:"_switchFirstVideoTimeout",value:function(){v.a.log("IPlayer(".concat(this._id,")._switchFirstVideoTimeout")),this.ctrlBitrate._badStat.setFirstVideoTimeout(),this.switchDoneBefore.stop(),this.ctrlBitrate.switchBack(Yt)}},{key:"_switchPtsIFrameTimeout",value:function(){v.a.log("IPlayer(".concat(this._id,")._switchPtsIFrameTimeout")),this.ctrlBitrate._badStat.setPtsFrameTimeout(),this.switchDoneBefore.stop(),this.ctrlBitrate.switchBack(qt)}},{key:"_switchDone",value:function(e,t,i){this.ctrlBitrate._badStat.setPtsFrame(i),this.ctrlBitrate._seg.ptsIFrame(),Q.remove(this._switchPtsIFrameTimeout,this),this.ctrlBitrate.startEval(t),this.ctrlBitrate.switchType===jr.SwitchType.H264ToH265||this.ctrlBitrate.switchType===jr.SwitchType.H265ToH264?(this.ctrlBitrate.pause(),this.switchDoneBefore.start(this.mse,e,{done:this._onSwitchDoneBefore.bind(this)})):this._switchDoneReal(0),v.a.log("P2PFlvPlayer._switchDone _type=".concat(this._type)),this._type===O.P2P&&this.p2pPlayer._switchDone(e,t,i)}},{key:"_onSwitchDoneBefore",value:function(){var e=this.mse;v.a.log("IPlayer(".concat(this._id,")._onSwitchDoneBefore mse=").concat(!!e," switchType=").concat(this.ctrlBitrate.switchType)),e&&(e.resetVideo(),e.playing=!1,e.parser.remuxer.reset(),this.ctrlBitrate.switchType===jr.SwitchType.H265ToH264?this.h265Proxy.stop():this.ctrlBitrate.switchType===jr.SwitchType.H264ToH265&&this.h265Proxy.initRender(e)),this._switchDoneReal(3e3)}},{key:"_switchDoneReal",value:function(e){v.a.log("IPlayer(".concat(this._id,")._switchDoneReal")),this.ctrlBitrate.switchDone(e)}},{key:"_triggerAutoChanged",value:function(){this.eventEmitter.trigger(o.AUTO_BITRATE_CHANGED,{lastBitrate:this.ctrlBitrate.lastBitrate,curBitrate:this.ctrlBitrate.curBitrate})}},{key:"getAutoProps",value:function(){return this.player&&this.player.getAutoProps&&this.player.getAutoProps()}},{key:"setWebCodecsSuccess",value:function(){this.isWebcodecsPlaying=!0}},{key:"startShildAudioPlayer",value:function(e){this.player.startShildAudioPlayer(e)}},{key:"stopShieldAudioPlayer",value:function(){this.player.stopShieldAudioPlayer()}},{key:"onSwitchShieldAudioFail",value:function(e,t){this.player.onSwitchShieldAudioFail(e,t)}},{key:"onSwitchShieldAudioSuc",value:function(e){this.player.onSwitchShieldAudioSuc(e)}},{key:"check500Pause",value:function(){this.player.check500Pause&&this.player.check500Pause()}},{key:"getMuffleCacheData",value:function(){var e=[];return this._hyPlayer&&this._hyPlayer.muffleAudio&&(e=this._hyPlayer.muffleAudio.getCacheData()),e}},{key:"setStreamFormat",value:function(e){var t={Avcc:1,Hvcc:1,AnnexB:2};e&&t[e]&&this.stat&&this.stat.setComDim(g.a.DIM_COM.STREAM_FORMAT,t[e])}},{key:"resetPlayer",value:function(){this.eventEmitter&&this.eventEmitter.trigger(o.RESET_PLAYER)}},{key:"setFramePause",value:function(){this.player&&this.player.setFramePause&&this.player.setFramePause()}},{key:"setFrameRusume",value:function(){this.player&&this.player.setFrameRusume&&this.player.setFrameRusume()}},{key:"renderFpsPause",value:function(e){this.player&&this.player.renderFpsPause&&this.player.renderFpsPause(e)}},{key:"isP2P",get:function(){return this._type==O.P2P}},{key:"type",get:function(){return this._type}},{key:"isFlv",get:function(){return this._type==O.FLV}},{key:"isPlaying",get:function(){return this.videoStatus!==l.VIDEO_STOP}},{key:"hasPicture",get:function(){if(!this.player)return!1;var e=this.isPlaying;return this.playerCoreType===V.a.PLAYER_CORE_TYPE.MSE?e=e&&0!==this.mse.getCurrentTime():this.playerCoreType===V.a.PLAYER_CORE_TYPE.WEBCODECS&&(e=e&&this.isWebcodecsPlaying),this.player&&this.player.h265Proxy&&this.player.h265Proxy.rendering&&(e=e&&this.player.h265Proxy.rendering),e}},{key:"voiceEliminationData",get:function(){return this.player.voiceEliminationData},set:function(e){this.player.voiceEliminationData=e}},{key:"connected",get:function(){return!!this.player&&this.player.connected}},{key:"playerType",get:function(){return this._type}},{key:"isTieStream",get:function(){return this.player&&this.player.is_tie_stream}}]),e}(),Ra=function(){function e(){Object(s.a)(this,e),this._ignoreMap=new Map,this._ignoreDefault=!1,this.initLv()}return Object(a.a)(e,[{key:"addStreamUrl",value:function(e,t){var i=f.a.statLv;A.b.isOpen(f.a.statCfg,e,t,!1)&&i[2]>0&&this._ignoreMap.set(g.a.DIM_COM.STREAM_URL,1)}},{key:"initLv",value:function(e,t){this._ignoreDefault=!1,this._ignoreMap.clear();var i=f.a.statLv,s=A.b.isOpen(f.a.statCfg,e,t,!1);if(v.a.log("StatFilter.init isOpen=".concat(s," statLv=").concat(i)),s){this._ignoreDefault=1===i[0];var r=this._ignoreMap;r.clear(),i[1]>0&&(r.set(g.a.DIM_CORE.VIDEO_BAD_QUALITY_OLD,1),r.set(g.a.DIM_COM.P2P_COOL_FLAG,1),r.set(g.a.DIM_COM.ACT_LOAD_TYPE,1)),i[2]>0&&(i[2]>1&&r.set(g.a.DIM_COM.STREAM,1),r.set(g.a.DIM_COM.CDP_ID,1)),i[3]>0&&(i[3]>1&&(r.set(g.a.DIM_COM.V_RECV_FRAMES,1),r.set(g.a.DIM_COM.V_RECV_FRAME,1),r.set(g.a.DIM_COM.V_PLAY_FRAME,1),r.set(g.a.DIM_COM.V_TO_PLAY_FRAME,1),r.set(g.a.DIM_COM.VISIBILITY_STATE,1)),r.set(g.a.DIM_COM.VIDEO_PAUSE_BUFFERS,1),r.set(g.a.DIM_COM.VIDEO_PAUSE_CONTINUE_BUFFERS,1),r.set(g.a.DIM_LINK_STA.name,1),r.set(g.a.DIM_LINK_SAM.name,1),r.set(g.a.FRAME_INFO.name,1)),i[4]>0&&r.set(g.a.AI_CONTROL_DATA.name,1),i[5]>0&&(i[5]>1&&(r.set(g.a.SUB_INFO.name,1),r.set(g.a.PUNCH_INFO.name,1)),r.set(g.a.CORE.FORWARD_REJECT_CNT,1),r.set(g.a.DIM_COM.SUB_CHANGE_STATE,1),r.set(g.a.UPDOWN_INFO.name,1),r.set(g.a.PUNCH_BACK_RET.name,1),r.set(g.a.SUBSTREAM_INFO.name,1),r.set(g.a.FORCESUB_REASON.name,1),r.set(g.a.SUB_RETURN.name,1),r.set(g.a.NONODE_RETURN.name,1),r.set(g.a.P2P_TCP_TYPE.name,1),r.set(g.a.P2P_TCP_STATE.name,1)),i[6]>0&&(r.set(g.a.DIM_COM.BROWSER_NAME,1),r.set(g.a.DIM_COM.BROWSER_VERSION,1),r.set(g.a.DIM_COM.BROWSER_KERNEL,1),r.set(g.a.DIM_COM.BROWSER_KERNEL_VERSION,1),r.set(g.a.DIM_COM.OS_NAME,1),r.set(g.a.DIM_COM.OS_VERSION,1),r.set(g.a.DIM_COM.RENDER_INFO,1)),i[7]>0&&(r.set(g.a.DIM_COM.STREAM_INDEX,1),r.set(g.a.DIM_COM.OBS_RENDER_MODE,1),r.set(g.a.CORE.OBS_FPS,1),r.set(g.a.CORE.OBS_UPLOAD_TS,1)),i[8]>0&&(r.set(g.a.DIM_COM.VR_ENABLE,1),r.set(g.a.DIM_COM.VR_MODE,1)),i[9]>0&&(r.set(g.a.DIM_COM.CDN_CIP,1),r.set(g.a.DIM_COM.CDN_SIP,1),r.set(g.a.DIM_COM.ALT_SVC,1),r.set(g.a.DIM_COM.QUIC,1)),i[10]>0&&(i[10]>3&&(r.set("pcdn_hot_degree_in",1),r.set("pcdn_hot_degree_kick",1),r.set("pcdn_hot_degree",1),r.set("get_pcdn_url_result",1),r.set(g.a.DIM_COM.CLI_ISP,1),r.set(g.a.DIM_COM.CLI_PROV,1),r.set(g.a.DIM_COM.PCDN_SVR_ISP,1),r.set(g.a.DIM_COM.PCDN_SVR_AREA,1)),i[10]>2&&(r.set(g.a.PCDN_DATA.GET_PCDN_URL_TOTAL_CNT,1),r.set(g.a.PCDN_DATA.GET_PCDN_URL_SUCCESS,1),r.set(g.a.PCDN_DATA.GET_PCDN_URL_SUC_FREETIME,1),r.set(g.a.PCDN_DATA.GET_PCDN_ERR_NOT_REACHED,1),r.set(g.a.PCDN_DATA.GET_PCDN_ERR_OVER_RUN,1),r.set(g.a.PCDN_DATA.GET_PCDN_ERR_OVER_RUN_FREETIME,1),r.set(g.a.PCDN_DATA.GET_PCDN_ERR_NOT_COVERD,1),r.set(g.a.PCDN_DATA.GET_PCDN_ERR_OTHER,1),r.set(g.a.PCDN_DATA.GET_PCDN_ERROR_REQ,1),r.set(g.a.PCDN_DATA.GET_SUBS_URL_ERROR_CNT,1),r.set(g.a.PCDN_DATA.GET_PCDN_DATA_TIME,1),r.set(g.a.PCDN_DATA.GET_PCDN_DATA_TIME_CNT,1),r.set(g.a.PCDN_DATA.GET_PCDN_SUBS_URL_TIME,1),r.set(g.a.PCDN_DATA.GET_PCDN_SUBS_URL_TIME_CNT,1),r.set(g.a.PCDN_DATA.GET_CDN_DATA_TIME,1),r.set(g.a.PCDN_DATA.GET_CDN_DATA_TIME_CNT,1)),i[10]>1&&(r.set(g.a.DIM_COM.SUB_PCDN_STATE,1),r.set(g.a.DIM_COM.FLV_PCDN_STATE,1)),r.set("pcdn_pull_stream_user_cnt",1),r.set("pcdn_get_proxy_user_cnt",1),r.set(g.a.PCDN_BW_DATA.name,1)),i[11]>0&&(i[11]>1&&(r.set(g.a.CORE.REAL_KBPS_SAMPLE,1),r.set(g.a.CORE.REAL_FLAC_KBPS_SAMPLE,1),r.set(g.a.CORE.RECV_TOTAL_SAMPLE,1),r.set(g.a.CORE.RECV_LAN_SAMPLE,1)),r.set(g.a.DIM_COM.AUTO_U_REASON,1),r.set(g.a.DIM_COM.AUTO_D_REASON,1),r.set(g.a.DIM_COM.AUTO_HEART_TYPE,1),r.set(g.a.DIM_COM.AUTO_CODEC_CHANGE_TYPE,1),r.set(g.a.DIM_COM.AUTO_BAD_REASON,1),r.set(g.a.DIM_COM.AUTO_BAD_MIN_REASON,1),r.set(g.a.CORE.AUTO_SWITCH_CNT,1),r.set(g.a.CORE.AUTO_SWITCH_SAME_CNT,1),r.set(g.a.CORE.AUTO_BAD_QUALITY,1),r.set(g.a.CORE.AUTO_BAD_QUALITY_UP,1),r.set(g.a.CORE.AUTO_BAD_DURATION,1),r.set(g.a.CORE.AUTO_BAD_DURATION_UP,1),r.set(g.a.CORE.AUTO_BAD_SWITCH,1),r.set(g.a.CORE.AUTO_BAD_SWITCH_SAME,1),r.set(g.a.CORE.AUTO_BAD_SWITCH_UP,1),r.set(g.a.CORE.AUTO_BAD_DONE,1),r.set(g.a.CORE.AUTO_BAD_BUFFER,1),r.set(g.a.CORE.AUTO_CONTINUE_BUFFER,1),r.set(g.a.AUTO_INFO.name,1)),1===i[12]&&(r.set(g.a.CORE.SVR_DELAY_INFOS,1),r.set(g.a.CORE.DELAY_NODE_INFO,1),r.set(g.a.CORE.SVR_LAST_P_DELAY,1)),1===i[13]&&r.set(g.a.HLS_INFO.name,1),i[14],1===i[16]&&(r.set(g.a.VIDEO_LINK.PVSSC,1),r.set(g.a.VIDEO_LINK.PVFSC,1),r.set(g.a.VIDEO_LINK.PVLSC,1),r.set(g.a.VIDEO_LINK.PVLFC,1),r.set(g.a.VIDEO_LINK.PVPFC,1),r.set(g.a.VIDEO_LINK.PVPTC,1),r.set(g.a.VIDEO_LINK.PVPAFC,1),r.set(g.a.VIDEO_LINK.PVRFC,1))}}},{key:"checkFilter",value:function(e){var t=this;e.forEach((function(e){t.filterObj(e.vField),t.filterObj(e.vDimension),t.filterObj(e.vExLog)}))}},{key:"filterObj",value:function(e){var t=[];for(var i in e)(0===e[i]||""===e[i]&&this._ignoreDefault||this._ignoreMap.has(i))&&t.push(i);for(var s=0;s<t.length;s++)delete e[t[s]]}}]),e}(),ka=function(){function e(){Object(s.a)(this,e),this.comDim=new Map,this.coreDim=new Map,this.actDim=new Map,this.extDim=new Map,this.comFormatMap=new Map,this.coreMap=new Map,this.compMap=new Map,this.keyvalCoreDimMap=new Map,this.heart_type=g.a.HEART_TYPE.START,this.recordTs=this.create_time=S.a.now(),this.filter=new Ra}return Object(a.a)(e,[{key:"checkFilter",value:function(e){this.filter.checkFilter(e)}},{key:"setCreateTime",value:function(e){isNaN(e)||(this.create_time=e)}},{key:"reset",value:function(){this.comDim.clear(),this.coreDim.clear(),this.actDim.clear(),this.extDim.clear(),this.coreMap.clear(),this.compMap.clear(),this.keyvalCoreDimMap.clear(),this.heart_type=g.a.HEART_TYPE.START,this.create_time=S.a.now()}},{key:"clearFill",value:function(){this.coreDim.clear(),this.extDim.clear(),this.coreMap.clear(),this.compMap.clear(),this.keyvalCoreDimMap.clear()}},{key:"createAct",value:function(e,t){return this._createAct(e,t)}},{key:"createActs",value:function(e){var t=[];if(e)for(var i=0;i<e.length;i++){var s=e[i],r=this._createAct(s.type,s.params);t.push(r)}return t}},{key:"_createAct",value:function(e,t){var i={sMetricName:g.a.ACT.name,vField:{},vDimension:{}};if(i.vDimension[g.a.ACT.field]=e,i.vDimension[g.a.DIM_CORE.CREATE_TIME]=S.a.now()-this.create_time,this._fillFromMap(i.vDimension,this.comDim),this._fillFromMap(i.vDimension,this.actDim),t){var s=0;if(t.hasOwnProperty(g.a.KEY_VALUE)){var r=t[g.a.KEY_VALUE];for(s=0;s<r.length;s++)i.vField[g.a.KEY_VALUE+(s+1)]=r[s]}if(t.hasOwnProperty(g.a.KEY_STR)){var a=t[g.a.KEY_STR];for(s=0;s<a.length;s++)i.vDimension[g.a.KEY_STR+(s+1)]=a[s]}t.hasOwnProperty(g.a.KEY_DIM)&&Object.assign(i.vDimension,t[g.a.KEY_DIM])}return i.vDimension.appid=ee.a.appid,this.actDim.clear(),i}},{key:"fill",value:function(e,t){t?(this.heart_type=g.a.HEART_TYPE.END,this._fill(e),this.heart_type=g.a.HEART_TYPE.START):this._fill(e)}},{key:"_fill",value:function(e){if(0!=this.coreMap.size||0!=this.compMap.size){var t={sMetricName:g.a.CORE.name,vField:{},vDimension:{},vExLog:{}},i=S.a.now();this.coreMap.set(g.a.CORE.HTD,i-this.recordTs),this.recordTs=i,this.coreDim.set(g.a.DIM_CORE.HEART_TYPE,this.heart_type),this._fillFromMap(t.vDimension,this.comDim),this._fillFromMap(t.vDimension,this.coreDim),this._fillFromMap(t.vExLog,this.extDim),this._fillFromMap(t.vField,this.coreMap),this._fillComp(t.vDimension),this.coreDim.clear(),this.extDim.clear(),this.coreMap.clear(),this.compMap.clear(),this.heart_type==g.a.HEART_TYPE.START&&(this.heart_type=g.a.HEART_TYPE.CONTINUS),t.vDimension.appid=ee.a.appid,e.push(t)}}},{key:"_fillComp",value:function(e){var t,i=I(this.compMap.keys());try{for(i.s();!(t=i.n()).done;){var s,r=t.value,a=this._getCompMapFormat(r),n=a.get("ref")||",",o=a.get("split")||";",h=this.compMap.get(r),u="",l=I(h.keys());try{for(l.s();!(s=l.n()).done;){var d=s.value;u.length>0&&(u+=o),u+=d+n+h.get(d)}}catch(e){l.e(e)}finally{l.f()}e[r]=u}}catch(e){i.e(e)}finally{i.f()}}},{key:"_fillFromMap",value:function(e,t){var i,s=I(t.keys());try{for(s.s();!(i=s.n()).done;){var r=i.value;e[r]=t.get(r)}}catch(e){s.e(e)}finally{s.f()}}},{key:"_fillFromKeyvalMap",value:function(e,t){var i,s=I(t.keys());try{for(s.s();!(i=s.n()).done;){for(var r=i.value,a=t.get(r),n=a.entries(),o="",h=0;h<a.size;h++){var u=n.next().value;o+="".concat(u[0],":").concat(u[1]),h<a.size-1&&(o+=",")}a.clear(),e[r]=o}}catch(e){s.e(e)}finally{s.f()}}},{key:"setComDim",value:function(e,t){this.comDim.set(e,t)}},{key:"setCoreDim",value:function(e,t){this.coreDim.set(e,t)}},{key:"addCoreDim",value:function(e,t){this._addValue(this.coreDim,e,t)}},{key:"addKeyvalCoreDim",value:function(e,t){this._addKeyvalValue(this.keyvalCoreDimMap,e,t)}},{key:"setActDim",value:function(e,t){this.actDim.set(e,t)}},{key:"setExtDim",value:function(e,t){this.extDim.set(e,t)}},{key:"delDim",value:function(e){this.comDim.has(e)?this.comDim.delete(e):this.coreDim.has(e)?this.coreDim.delete(e):this.actDim.has(e)&&this.actDim.delete(e)}},{key:"setCore",value:function(e,t){this.coreMap.set(e,t)}},{key:"addCore",value:function(e,t){this._addValue(this.coreMap,e,t)}},{key:"setComp",value:function(e,t,i){this._getCompMap(e).set(t,i)}},{key:"addComp",value:function(e,t,i){var s=this._getCompMap(e);this._addValue(s,t,i)}},{key:"setCompFormat",value:function(e,t,i){var s=this._getCompMapFormat(e);s.set("ref",t),s.set("split",i)}},{key:"_getCompMapFormat",value:function(e){if(this.comFormatMap.has(e))return this.comFormatMap.get(e);var t=new Map;return this.comFormatMap.set(e,t),t}},{key:"_getCompMap",value:function(e){if(this.compMap.has(e))return this.compMap.get(e);var t=new Map;return this.compMap.set(e,t),t}},{key:"_addValue",value:function(e,t,i){if(e.has(t)){var s=e.get(t);e.set(t,s+i)}else e.set(t,i)}},{key:"_addKeyvalValue",value:function(e,t,i){if(e.has(t)){var s=e.get(t),r=i.split(":");if(r.length<2)return;var a=r[0],n=Number(r[1]);if(s.has(a)){var o=s.get(a);s.set(a,o+n)}else s.set(a,n)}else{var h=i.split(":");if(h.length<2)return;var u=new Map,l=h[0],d=Number(h[1]);u.set(l,d),e.set(t,u)}}}]),e}(),ba=[d.H264_SEI_PLAY,d.AUDIO_SOUND,d.SIGNAL_DATA,d.UPDATE_INTERSITY,d.SIGNAL_HEART,d.METADATA,d.TRANS_END,d.PLAY_DOWNLINK_INFO,d.PLAY_FRAME_BUFFER,d.PLAY_TIME_STATUS,d.PLAYBACK_UPDATE,d.PLAYBACK_M3U8_UPDATED,d.SEI_INFO,"VIDEO_TIMEUPDATE","VIDEO_PROGRESS"],Da=i(17),Oa=function(){function e(){Object(s.a)(this,e),this._mediaUserId=null,this._bAnonymous=0,this._tryTimes=0,this._isLogin=!1,this._roomId=0}return Object(a.a)(e,[{key:"loginMedia",value:function(e,t,i){if(this._roomId=t,!this._mediaUserId){var s=new Da.default.MediaUserId;s.lUid=i,s.sGuid=A.b.getCookie("guid"),s.sToken=e,s.sUA="media_web&1000&",s.iAppid=ee.a.appid,s.sStrUid="",this._mediaUserId=s}this._login()}},{key:"_login",value:function(){this._mediaUserId.bAnonymous=this._bAnonymous;var e=new Da.default.LoginVerifyReq;e.tId=this._mediaUserId,y.default.sendWup("mediaui","loginVerify",e,this._onLogin.bind(this),!0,y.default.getRequestId(),!0)}},{key:"_onLogin",value:function(e){v.a.log("MediaLink._onLogin iResCode=".concat(e.iResCode)),0===e.iResCode?(this._isLogin=!0,this._mediaUserId.sCookie=e.sCookie,this._join()):1===e.iResCode&&(this._tryTimes++,this._tryTimes<5&&(this._bAnonymous=1,this._login()))}},{key:"_join",value:function(){var e=new Da.default.JoinMediaGroupReq;e.tId=this._mediaUserId,e.vGroupId.value=[this._roomId],y.default.sendWup("mediaui","joinGroup",e,this._onJoin.bind(this),!0,y.default.getRequestId(),!0)}},{key:"_onJoin",value:function(e){v.a.log("MediaLink._onJoin iCode=".concat(e.iCode))}},{key:"quitMedia",value:function(){var e=new Da.default.QuitMediaGroupReq;e.tId=this._mediaUserId,e.vGroupId.value=[this._roomId],y.default.sendWup("mediaui","quitGroup",e,this._onQuit.bind(this),!0,y.default.getRequestId(),!0)}},{key:"_onQuit",value:function(e){v.a.log("MediaLink._onQuit iCode=".concat(e.iCode))}}]),e}(),Fa={},La=Fa;Fa.INT8=function(){this._clone=function(){return 0},this._write=function(e,t,i){return e.writeInt8(t,i)},this._read=function(e,t,i){return e.readInt8(t,!0,i)},this._className=function(){return Fa.CHAR}},Fa.INT16=function(){this._clone=function(){return 0},this._write=function(e,t,i){return e.writeInt16(t,i)},this._read=function(e,t,i){return e.readInt16(t,!0,i)},this._className=function(){return Fa.SHORT}},Fa.INT32=function(){this._clone=function(){return 0},this._write=function(e,t,i){return e.writeInt32(t,i)},this._read=function(e,t,i){return e.readInt32(t,!0,i)},this._className=function(){return Fa.INT32}},Fa.INT64=function(){this._clone=function(){return 0},this._write=function(e,t,i){return e.writeInt64(t,i)},this._read=function(e,t,i){return e.readInt64(t,!0,i)},this._className=function(){return Fa.INT64}},Fa.UINT8=function(){this._clone=function(){return 0},this._write=function(e,t,i){return e.writeInt16(t,i)},this._read=function(e,t,i){return e.readInt16(t,!0,i)},this._className=function(){return Fa.SHORT}},Fa.UInt16=function(){this._clone=function(){return 0},this._write=function(e,t,i){return e.writeInt32(t,i)},this._read=function(e,t,i){return e.readInt32(t,!0,i)},this._className=function(){return Fa.INT32}},Fa.UInt32=function(){this._clone=function(){return 0},this._write=function(e,t,i){return e.writeInt64(t,i)},this._read=function(e,t,i){return e.readInt64(t,!0,i)},this._className=function(){return Fa.INT64}},Fa.Float=function(){this._clone=function(){return 0},this._write=function(e,t,i){return e.writeFloat(t,i)},this._read=function(e,t,i){return e.readFloat(t,!0,i)},this._className=function(){return Fa.FLOAT}},Fa.Double=function(){this._clone=function(){return 0},this._write=function(e,t,i){return e.writeDouble(t,i)},this._read=function(e,t,i){return e.readDouble(t,!0,i)},this._className=function(){return Fa.DOUBLE}},Fa.STRING=function(){this._clone=function(){return 0},this._write=function(e,t,i){return e.writeString(t,i)},this._read=function(e,t,i){return e.readString(t,!0,i)},this._className=function(){return Fa.STRING}},Fa.BOOLEAN=function(){this._clone=function(){return!1},this._write=function(e,t,i){return e.writeBoolean(t,i)},this._read=function(e,t,i){return e.readBoolean(t,!0,i)},this._className=function(){return Fa.BOOLEAN}},Fa.ENUM=function(){this._clone=function(){return 0},this._write=function(e,t,i){return e.writeInt32(t,i)},this._read=function(e,t,i){return e.readInt32(t,!0,i)}},Fa.Vector=function(e){this.proto=e,this.value=new Array},Fa.Vector.prototype._clone=function(){return new Fa.Vector(this.proto)},Fa.Vector.prototype._write=function(e,t,i){return e.writeVector(t,i)},Fa.Vector.prototype._read=function(e,t,i){return e.readVector(t,!0,i)},Fa.Vector.prototype._className=function(){return Fa.TypeHelp.VECTOR.replace("$t",this.proto._className())},Fa.Map=function(e,t){this.kproto=e,this.vproto=t,this.value=new Object},Fa.Map.prototype._clone=function(){return new Fa.Map(this.kproto,this.vproto)},Fa.Map.prototype._write=function(e,t,i){return e.writeMap(t,i)},Fa.Map.prototype._read=function(e,t,i){return e.readMap(t,!0,i)},Fa.Map.prototype.put=function(e,t){this.value[e]=t},Fa.Map.prototype.get=function(e){return this.value[e]},Fa.Map.prototype.getKeys=function(){var e=[];for(var t in this.value)""!=t&&e.push(t);return e},Fa.Map.prototype.hasKey=function(e){return this.value.hasOwnProperty(e)},Fa.Map.prototype.remove=function(e){delete this.value[e]},Fa.Map.prototype.clear=function(){this.value=new Object},Fa.Map.prototype.size=function(){var e=0;for(var t in this.value)e++;return e},Fa.Vector.prototype._className=function(){return Fa.TypeHelp.Map.replace("$k",this.kproto._className()).replace("$v",this.vproto._className())},Fa.DataHelp={EN_INT8:0,EN_INT16:1,EN_INT32:2,EN_INT64:3,EN_FLOAT:4,EN_DOUBLE:5,EN_STRING1:6,EN_STRING4:7,EN_MAP:8,EN_LIST:9,EN_STRUCTBEGIN:10,EN_STRUCTEND:11,EN_ZERO:12,EN_SIMPLELIST:13},Fa.TypeHelp={BOOLEAN:"bool",CHAR:"char",SHORT:"short",INT32:"int32",INT64:"int64",FLOAT:"float",DOUBLE:"double",STRING:"string",VECTOR:"list<$t>",MAP:"map<$k, $v>"},Fa.BinBuffer=function(e){this.buf=null,this.vew=null,this.len=0,this.position=0,null!=e&&null!=e&&(e instanceof ArrayBuffer?(this.buf=e,this.vew=new DataView(this.buf),this.len=this.vew.byteLength,this.position=0):(this.buf=e.buf,this.vew=new DataView(this.buf),this.len=e.length,this.position=e.position)),this.__defineGetter__("length",(function(){return this.len})),this.__defineGetter__("buffer",(function(){return this.buf}))},Fa.BinBuffer.prototype._write=function(e,t,i){return e.writeBytes(t,i)},Fa.BinBuffer.prototype._read=function(e,t,i){return e.readBytes(t,!0,i)},Fa.BinBuffer.prototype._clone=function(){return new Fa.BinBuffer},Fa.BinBuffer.prototype.allocate=function(e){if(e=this.position+e,!(null!=this.buf&&this.buf.length>e)){var t=new ArrayBuffer(Math.max(256,2*e));null!=this.buf&&(new Uint8Array(t).set(new Uint8Array(this.buf)),this.buf=void 0),this.buf=t,this.vew=void 0,this.vew=new DataView(this.buf)}},Fa.BinBuffer.prototype.getBuffer=function(){var e=new ArrayBuffer(this.len);return new Uint8Array(e).set(new Uint8Array(this.buf,0,this.len)),e},Fa.BinBuffer.prototype.memset=function(e,t,i){this.allocate(i),new Uint8Array(this.buf).set(new Uint8Array(e,t,i),this.position)},Fa.BinBuffer.prototype.writeInt8=function(e){this.allocate(1),this.vew.setInt8(this.position,e),this.position+=1,this.len=this.position},Fa.BinBuffer.prototype.writeUInt8=function(e){this.allocate(1),this.vew.setUint8(this.position++,e),this.len=this.position},Fa.BinBuffer.prototype.writeInt16=function(e){this.allocate(2),this.vew.setInt16(this.position,e),this.position+=2,this.len=this.position},Fa.BinBuffer.prototype.writeUInt16=function(e){this.allocate(2),this.vew.setUint16(this.position,e),this.position+=2,this.len=this.position},Fa.BinBuffer.prototype.writeInt32=function(e){this.allocate(4),this.vew.setInt32(this.position,e),this.position+=4,this.len=this.position},Fa.BinBuffer.prototype.writeUInt32=function(e){this.allocate(4),this.vew.setUint32(this.position,e),this.position+=4,this.len=this.position},Fa.BinBuffer.prototype.writeInt64=function(e){this.allocate(8),this.vew.setUint32(this.position,parseInt(e/4294967296)),this.vew.setUint32(this.position+4,e%4294967296),this.position+=8,this.len=this.position},Fa.BinBuffer.prototype.writeFloat=function(e){this.allocate(4),this.vew.setFloat32(this.position,e),this.position+=4,this.len=this.position},Fa.BinBuffer.prototype.writeDouble=function(e){this.allocate(8),this.vew.setFloat64(this.position,e),this.position+=8,this.len=this.position},Fa.BinBuffer.prototype.writeString=function(e){for(var t=[],i=0;i<e.length;i++)t.push(255&e.charCodeAt(i));this.allocate(t.length),new Uint8Array(this.buf).set(new Uint8Array(t),this.position),this.position+=t.length,this.len=this.position},Fa.BinBuffer.prototype.writeBytes=function(e){0!=e.length&&null!=e.buf&&(this.allocate(e.length),new Uint8Array(this.buf).set(new Uint8Array(e.buf,0,e.length),this.position),this.position+=e.length,this.len=this.position)},Fa.BinBuffer.prototype.readInt8=function(){return this.vew.getInt8(this.position++)},Fa.BinBuffer.prototype.readInt16=function(){return this.position+=2,this.vew.getInt16(this.position-2)},Fa.BinBuffer.prototype.readInt32=function(){return this.position+=4,this.vew.getInt32(this.position-4)},Fa.BinBuffer.prototype.readUInt8=function(){return this.position+=1,this.vew.getUint8(this.position-1)},Fa.BinBuffer.prototype.readUInt16=function(){return this.position+=2,this.vew.getUint16(this.position-2)},Fa.BinBuffer.prototype.readUInt32=function(){return this.position+=4,this.vew.getUint32(this.position-4)},Fa.BinBuffer.prototype.readInt64=function(){var e=this.vew.getUint32(this.position),t=this.vew.getUint32(this.position+4);return this.position+=8,4294967296*e+t},Fa.BinBuffer.prototype.readFloat=function(){var e=this.vew.getFloat32(this.position);return this.position+=4,e},Fa.BinBuffer.prototype.readDouble=function(){var e=this.vew.getFloat64(this.position);return this.position+=8,e},Fa.BinBuffer.prototype.readString=function(e){for(var t=[],i=0;i<e;i++)t.push(String.fromCharCode(this.vew.getUint8(this.position++)));var s=t.join("");try{s=decodeURIComponent(escape(s))}catch(e){}return s},Fa.BinBuffer.prototype.readBytes=function(e){var t=new Fa.BinBuffer;return t.allocate(e),t.memset(this.buf,this.position,e),t.position=0,t.len=e,this.position=this.position+e,t},Fa.JceOutputStream=function(){this.buf=new Fa.BinBuffer,this.getBinBuffer=function(){return this.buf},this.getBuffer=function(){return this.buf.getBuffer()}},Fa.JceOutputStream.prototype.clear=function(){return this.buf=new Fa.BinBuffer,this},Fa.JceOutputStream.prototype.writeTo=function(e,t){e<15?this.buf.writeUInt8(e<<4&240|t):this.buf.writeUInt16((240|t)<<8|e)},Fa.JceOutputStream.prototype.writeBoolean=function(e,t){this.writeInt8(e,1==t?1:0)},Fa.JceOutputStream.prototype.writeInt8=function(e,t){0==t?this.writeTo(e,Fa.DataHelp.EN_ZERO):(this.writeTo(e,Fa.DataHelp.EN_INT8),this.buf.writeInt8(t))},Fa.JceOutputStream.prototype.writeInt16=function(e,t){t>=-128&&t<=127?this.writeInt8(e,t):(this.writeTo(e,Fa.DataHelp.EN_INT16),this.buf.writeInt16(t))},Fa.JceOutputStream.prototype.writeInt32=function(e,t){t>=-32768&&t<=32767?this.writeInt16(e,t):(this.writeTo(e,Fa.DataHelp.EN_INT32),this.buf.writeInt32(t))},Fa.JceOutputStream.prototype.writeInt64=function(e,t){t>=-2147483648&&t<=2147483647?this.writeInt32(e,t):(this.writeTo(e,Fa.DataHelp.EN_INT64),this.buf.writeInt64(t))},Fa.JceOutputStream.prototype.writeUInt8=function(e,t){this.writeInt16(e,t)},Fa.JceOutputStream.prototype.writeUInt16=function(e,t){this.writeInt32(e,t)},Fa.JceOutputStream.prototype.writeUInt32=function(e,t){this.writeInt64(e,t)},Fa.JceOutputStream.prototype.writeFloat=function(e,t){0==t?this.writeTo(e,Fa.DataHelp.EN_ZERO):(this.writeTo(e,Fa.DataHelp.EN_FLOAT),this.buf.writeFloat(t))},Fa.JceOutputStream.prototype.writeDouble=function(e,t){0==t?this.writeTo(e,Fa.DataHelp.EN_ZERO):(this.writeTo(e,Fa.DataHelp.EN_DOUBLE),this.buf.writeDouble(t))},Fa.JceOutputStream.prototype.writeStruct=function(e,t){if(null==t.writeTo)throw Error("not defined writeTo Function");this.writeTo(e,Fa.DataHelp.EN_STRUCTBEGIN),t.writeTo(this),this.writeTo(0,Fa.DataHelp.EN_STRUCTEND)},Fa.JceOutputStream.prototype.writeString=function(e,t){var i=t;try{i=unescape(encodeURIComponent(i))}catch(e){}i.length>255?(this.writeTo(e,Fa.DataHelp.EN_STRING4),this.buf.writeUInt32(i.length)):(this.writeTo(e,Fa.DataHelp.EN_STRING1),this.buf.writeUInt8(i.length)),this.buf.writeString(i)},Fa.JceOutputStream.prototype.writeBytes=function(e,t){this.writeTo(e,Fa.DataHelp.EN_SIMPLELIST),this.writeTo(0,Fa.DataHelp.EN_INT8),this.writeInt32(0,t.length),this.buf.writeBytes(t)},Fa.JceOutputStream.prototype.writeVector=function(e,t){this.writeTo(e,Fa.DataHelp.EN_LIST),this.writeInt32(0,t.value.length);for(var i=0;i<t.value.length;i++)t.proto._write(this,0,t.value[i])},Fa.JceOutputStream.prototype.writeMap=function(e,t){for(var i in this.writeTo(e,Fa.DataHelp.EN_MAP),this.writeInt32(0,t.size()),t.value)t.kproto._write(this,0,i),t.vproto._write(this,1,t.value[i])},Fa.JceInputStream=function(e){this.buf=new Fa.BinBuffer(e)},Fa.JceInputStream.prototype.setBuffer=function(e){return this.buf=new Fa.BinBuffer(e),this},Fa.JceInputStream.prototype.readFrom=function(){var e=this.buf.readUInt8(),t=(240&e)>>4,i=15&e;return t>=15&&(t=this.buf.readUInt8()),{tag:t,type:i}},Fa.JceInputStream.prototype.peekFrom=function(){var e=this.buf.position,t=this.readFrom();return this.buf.position=e,{tag:t.tag,type:t.type,size:t.tag>=15?2:1}},Fa.JceInputStream.prototype.skipField=function(e){switch(e){case Fa.DataHelp.EN_INT8:this.buf.position+=1;break;case Fa.DataHelp.EN_INT16:this.buf.position+=2;break;case Fa.DataHelp.EN_INT32:this.buf.position+=4;break;case Fa.DataHelp.EN_INT64:this.buf.position+=8;break;case Fa.DataHelp.EN_STRING1:var t=this.buf.readUInt8();this.buf.position+=t;break;case Fa.DataHelp.EN_STRING4:var i=this.buf.readInt32();this.buf.position+=i;break;case Fa.DataHelp.EN_STRUCTBEGIN:this.skipToStructEnd();break;case Fa.DataHelp.EN_STRUCTEND:case Fa.DataHelp.EN_ZERO:break;case Fa.DataHelp.EN_MAP:for(var s=this.readInt32(0,!0),r=0;r<2*s;++r){var a=this.readFrom();this.skipField(a.type)}break;case Fa.DataHelp.EN_SIMPLELIST:if((a=this.readFrom()).type!=Fa.DataHelp.EN_INT8)throw Error("skipField with invalid type, type value: "+e+","+a.type);t=this.readInt32(0,!0),this.buf.position+=t;break;case Fa.DataHelp.EN_LIST:for(s=this.readInt32(0,!0),r=0;r<s;++r)a=this.readFrom(),this.skipField(a.type);break;default:throw new Error("skipField with invalid type, type value: "+e)}},Fa.JceInputStream.prototype.skipToStructEnd=function(){for(;;){var e=this.readFrom();if(this.skipField(e.type),e.type==Fa.DataHelp.EN_STRUCTEND)return}},Fa.JceInputStream.prototype.skipToTag=function(e,t){for(;this.buf.position<this.buf.length;){var i=this.peekFrom();if(e<=i.tag||i.type==Fa.DataHelp.EN_STRUCTEND)return i.type!=Fa.DataHelp.EN_STRUCTEND&&e==i.tag;this.buf.position+=i.size,this.skipField(i.type)}if(t)throw Error("require field not exist, tag:"+e);return!1},Fa.JceInputStream.prototype.readBoolean=function(e,t,i){return 1==this.readInt8(e,t,i)},Fa.JceInputStream.prototype.readInt8=function(e,t,i){if(0==this.skipToTag(e,t))return i;var s=this.readFrom();switch(s.type){case Fa.DataHelp.EN_ZERO:return 0;case Fa.DataHelp.EN_INT8:return this.buf.readInt8()}throw Error("read int8 type mismatch, tag:"+e+", get type:"+s.type)},Fa.JceInputStream.prototype.readInt16=function(e,t,i){if(0==this.skipToTag(e,t))return i;var s=this.readFrom();switch(s.type){case Fa.DataHelp.EN_ZERO:return 0;case Fa.DataHelp.EN_INT8:return this.buf.readInt8();case Fa.DataHelp.EN_INT16:return this.buf.readInt16()}throw Error("read int8 type mismatch, tag:"+e+", get type:"+s.type)},Fa.JceInputStream.prototype.readInt32=function(e,t,i){if(0==this.skipToTag(e,t))return i;var s=this.readFrom();switch(s.type){case Fa.DataHelp.EN_ZERO:return 0;case Fa.DataHelp.EN_INT8:return this.buf.readInt8();case Fa.DataHelp.EN_INT16:return this.buf.readInt16();case Fa.DataHelp.EN_INT32:return this.buf.readInt32()}throw Error("read int8 type mismatch, tag:"+e+", get type:"+s.type)},Fa.JceInputStream.prototype.readInt64=function(e,t,i){if(0==this.skipToTag(e,t))return i;switch(this.readFrom().type){case Fa.DataHelp.EN_ZERO:return 0;case Fa.DataHelp.EN_INT8:return this.buf.readInt8();case Fa.DataHelp.EN_INT16:return this.buf.readInt16();case Fa.DataHelp.EN_INT32:return this.buf.readInt32();case Fa.DataHelp.EN_INT64:return this.buf.readInt64()}throw Error("read int64 type mismatch, tag:"+e+", get type:"+h.type)},Fa.JceInputStream.prototype.readFloat=function(e,t,i){if(0==this.skipToTag(e,t))return i;switch(this.readFrom().type){case Fa.DataHelp.EN_ZERO:return 0;case Fa.DataHelp.EN_FLOAT:return this.buf.readFloat()}throw Error("read float type mismatch, tag:"+e+", get type:"+h.type)},Fa.JceInputStream.prototype.readDouble=function(e,t,i){if(0==this.skipToTag(e,t))return i;switch(this.readFrom().type){case Fa.DataHelp.EN_ZERO:return 0;case Fa.DataHelp.EN_DOUBLE:return this.buf.readDouble()}throw Error("read double type mismatch, tag:"+e+", get type:"+h.type)},Fa.JceInputStream.prototype.readUInt8=function(e,t,i){return this.readInt16(e,t,i)},Fa.JceInputStream.prototype.readUInt16=function(e,t,i){return this.readInt32(e,t,i)},Fa.JceInputStream.prototype.readUInt32=function(e,t,i){return this.readInt64(e,t,i)},Fa.JceInputStream.prototype.readStruct=function(e,t,i){if(0==this.skipToTag(e,t))return i;var s=this.readFrom();if(s.type!=Fa.DataHelp.EN_STRUCTBEGIN)throw Error("read struct type mismatch, tag: "+e+", get type:"+s.type);return i.readFrom(this),this.skipToStructEnd(),i},Fa.JceInputStream.prototype.readString=function(e,t,i){if(0==this.skipToTag(e,t))return i;var s=this.readFrom();if(s.type==Fa.DataHelp.EN_STRING1)return this.buf.readString(this.buf.readUInt8());if(s.type==Fa.DataHelp.EN_STRING4)return this.buf.readString(this.buf.readUInt32());throw Error("read 'string' type mismatch, tag: "+e+", get type: "+s.type+".")},Fa.JceInputStream.prototype.readString2=function(e,t,i){if(0==this.skipToTag(e,t))return i;var s=this.readFrom();if(s.type==Fa.DataHelp.EN_STRING1)return this.buf.readBytes(this.buf.readUInt8());if(s.type==Fa.DataHelp.EN_STRING4)return this.buf.readBytes(this.buf.readUInt32());throw Error("read 'string' type mismatch, tag: "+e+", get type: "+s.type+".")},Fa.JceInputStream.prototype.readBytes=function(e,t,i){if(0==this.skipToTag(e,t))return i;var s=this.readFrom();if(s.type==Fa.DataHelp.EN_SIMPLELIST){var r=this.readFrom();if(r.type!=Fa.DataHelp.EN_INT8)throw Error("type mismatch, tag:"+e+",type:"+s.type+","+r.type);if((a=this.readInt32(0,!0))<0)throw Error("invalid size, tag:"+e+",type:"+s.type+","+r.type);return this.buf.readBytes(a)}if(s.type==Fa.DataHelp.EN_LIST){var a=this.readInt32(0,!0);return this.buf.readBytes(a)}throw Error("type mismatch, tag:"+e+",type:"+s.type)},Fa.JceInputStream.prototype.readVector=function(e,t,i){if(0==this.skipToTag(e,t))return i;var s=this.readFrom();if(s.type!=Fa.DataHelp.EN_LIST)throw Error("read 'vector' type mismatch, tag: "+e+", get type: "+s.type);var r=this.readInt32(0,!0);if(r<0)throw Error("invalid size, tag: "+e+", type: "+s.type+", size: "+r);for(var a=0;a<r;++a)i.value.push(i.proto._read(this,0,i.proto._clone()));return i},Fa.JceInputStream.prototype.readMap=function(e,t,i){if(0==this.skipToTag(e,t))return i;var s=this.readFrom();if(s.type!=Fa.DataHelp.EN_MAP)throw Error("read 'map' type mismatch, tag: "+e+", get type: "+s.type);var r=this.readInt32(0,!0);if(r<0)throw Error("invalid map, tag: "+e+", size: "+r);for(var a=0;a<r;a++){var n=i.kproto._read(this,0,i.kproto._clone()),o=i.vproto._read(this,1,i.vproto._clone());i.put(n,o)}return i},Fa.Wup=function(){this.iVersion=3,this.cPacketType=0,this.iMessageType=0,this.iRequestId=0,this.sServantName="",this.sFuncName="",this.sBuffer=new Fa.BinBuffer,this.iTimeout=0,this.context=new Fa.Map(new Fa.STRING,new Fa.STRING),this.status=new Fa.Map(new Fa.STRING,new Fa.STRING),this.data=new Fa.Map(new Fa.STRING,new Fa.Map(new Fa.STRING,new Fa.BinBuffer)),this.newdata=new Fa.Map(new Fa.STRING,new Fa.BinBuffer),this.iStream=new Fa.JceInputStream,this.oStream=new Fa.JceOutputStream},Fa.Wup.prototype.hasKey=function(e){return this.newdata.hasKey(e)},Fa.Wup.prototype.setVersion=function(e){this.iVersion=e},Fa.Wup.prototype.getVersion=function(e){return this.iVersion},Fa.Wup.prototype.setServant=function(e){this.sServantName=e},Fa.Wup.prototype.setFunc=function(e){this.sFuncName=e},Fa.Wup.prototype.setRequestId=function(e){this.iRequestId=e||++this.iRequestId},Fa.Wup.prototype.getRequestId=function(){return this.iRequestId},Fa.Wup.prototype.setTimeOut=function(e){this.iTimeout=e},Fa.Wup.prototype.getTimeOut=function(){return this.iTimeout},Fa.Wup.prototype.writeTo=function(){var e=this.oStream.clear();return e.writeInt16(1,this.iVersion),e.writeInt8(2,this.cPacketType),e.writeInt32(3,this.iMessageType),e.writeInt32(4,this.iRequestId),e.writeString(5,this.sServantName),e.writeString(6,this.sFuncName),e.writeBytes(7,this.sBuffer),e.writeInt32(8,this.iTimeout),e.writeMap(9,this.context),e.writeMap(10,this.status),new Fa.BinBuffer(e.getBuffer())},Fa.Wup.prototype.encode=function(){var e=this.oStream.clear();3==this.iVersion?e.writeMap(0,this.newdata):e.writeMap(0,this.data),this.sBuffer=e.getBinBuffer();var t=this.writeTo(),i=new Fa.BinBuffer;return i.writeInt32(4+t.len),i.writeBytes(t),i},Fa.Wup.prototype.writeBoolean=function(e,t){var i=this.oStream.clear();if(i.writeBoolean(0,t),3==this.iVersion)this.newdata.put(e,new Fa.BinBuffer(i.getBuffer()));else{var s=this.data.get(e),r=TAF.TypeHelp.BOOLEAN;null==s&&(s=new Fa.Map(Fa.STRING,Fa.STRING)),s.put(r,new Fa.BinBuffer(i.getBuffer())),this.data.put(e,s)}},Fa.Wup.prototype.writeInt8=function(e,t){var i=this.oStream.clear();if(i.writeInt8(0,t),3==this.iVersion)this.newdata.put(e,new Fa.BinBuffer(i.getBuffer()));else{var s=this.data.get(e),r=TAF.TypeHelp.CHAR;null==s&&(s=new Fa.Map(Fa.STRING,Fa.STRING)),s.put(r,new Fa.BinBuffer(i.getBuffer())),this.data.put(e,s)}},Fa.Wup.prototype.writeInt16=function(e,t){var i=this.oStream.clear();if(i.writeInt16(0,t),3==this.iVersion)this.newdata.put(e,new Fa.BinBuffer(i.getBuffer()));else{var s=this.data.get(e),r=TAF.TypeHelp.SHORT;null==s&&(s=new Fa.Map(Fa.STRING,Fa.STRING)),s.put(r,new Uint8Array(i.getBuffer())),this.data.put(e,s)}},Fa.Wup.prototype.writeInt32=function(e,t){var i=this.oStream.clear();if(i.writeInt32(0,t),3==this.iVersion)this.newdata.put(e,new Fa.BinBuffer(i.getBuffer()));else{var s=this.data.get(e),r=TAF.TypeHelp.INT32;null==s&&(s=new Fa.Map(Fa.STRING,Fa.STRING)),s.put(r,new Uint8Array(i.getBuffer())),this.data.put(e,s)}},Fa.Wup.prototype.writeInt64=function(e,t){var i=this.oStream.clear();if(i.writeInt64(0,t),3==this.iVersion)this.newdata.put(e,new Fa.BinBuffer(i.getBuffer()));else{var s=this.data.get(e),r=TAF.TypeHelp.INT64;null==s&&(s=new Fa.Map(Fa.STRING,Fa.STRING)),s.put(r,new Uint8Array(i.getBuffer())),this.data.put(e,s)}},Fa.Wup.prototype.writeFloat=function(e,t){var i=this.oStream.clear();if(i.writeFloat(0,t),3==this.iVersion)this.newdata.put(e,new Fa.BinBuffer(i.getBuffer()));else{var s=this.data.get(e),r=TAF.TypeHelp.FLOAT;null==s&&(s=new Fa.Map(Fa.STRING,Fa.STRING)),s.put(r,new Uint8Array(i.getBuffer())),this.data.put(e,s)}},Fa.Wup.prototype.writeDouble=function(e,t){var i=this.oStream.clear();if(i.writeDouble(0,t),3==this.iVersion)this.newdata.put(e,new Fa.BinBuffer(i.getBuffer()));else{var s=this.data.get(e),r=TAF.TypeHelp.DOUBLE;null==s&&(s=new Fa.Map(Fa.STRING,Fa.STRING)),s.put(r,new Uint8Array(i.getBuffer())),this.data.put(e,s)}},Fa.Wup.prototype.writeString=function(e,t){var i=this.oStream.clear();if(i.writeString(0,t),3==this.iVersion)this.newdata.put(e,new Fa.BinBuffer(i.getBuffer()));else{var s=this.data.get(e),r=Fa.TypeHelp.STRING;null==s&&(s=new Fa.Map(Fa.STRING,Fa.STRING)),s.put(r,new Uint8Array(i.getBuffer())),this.data.put(e,s)}},Fa.Wup.prototype.writeVector=function(e,t){var i=this.oStream.clear();if(i.writeVector(0,t),3==this.iVersion)this.newdata.put(e,new Fa.BinBuffer(i.getBinBuffer()));else{var s=this.data.get(e),r=t._className();null==s&&(s=new Fa.Map(Fa.STRING,Fa.STRING)),s.put(r,new Uint8Array(i.getBuffer())),this.data.put(e,s)}},Fa.Wup.prototype.writeStruct=function(e,t){var i=this.oStream.clear();if(i.writeStruct(0,t),3==this.iVersion)this.newdata.put(e,new Fa.BinBuffer(i.getBuffer()));else{var s=this.data.get(e);null==s&&(s=new Fa.Map(Fa.STRING,Fa.STRING)),s.put(" ",new Uint8Array(i.getBuffer())),this.data.put(e,s)}},Fa.Wup.prototype.writeBytes=function(e,t){var i=this.oStream.clear();if(i.writeBytes(0,t),3==this.iVersion)this.newdata.put(e,new Fa.BinBuffer(i.getBuffer()));else{var s=this.data.get(e);null==s&&(s=new Fa.Map(Fa.STRING,Fa.STRING)),s.put("vec",new Uint8Array(i.getBuffer())),this.data.put(e,s)}},Fa.Wup.prototype.writeMap=function(e,t){var i=this.oStream.clear();if(i.writeMap(0,t),3==this.iVersion)this.newdata.put(e,new Fa.BinBuffer(i.getBuffer()));else{var s=this.data.get(e),r=Fa.Util.getClassType(t);null==s&&(s=new Fa.Map(Fa.STRING,Fa.STRING)),s.put(r,new Uint8Array(i.getBuffer())),this.data.put(e,s)}},Fa.Wup.prototype.readFrom=function(e){this.iVersion=e.readInt16(1,!0),this.cPacketType=e.readInt8(2,!0),this.iMessageType=e.readInt32(3,!0),this.iRequestId=e.readInt32(4,!0),this.sServantName=e.readString(5,!0),this.sFuncName=e.readString(6,!0),localStorage.__wup&&console.info("%c@@@ "+this.sServantName+"."+this.sFuncName,"color:white;background:black;",this),this.sBuffer=e.readBytes(7,!0),this.iTimeout=e.readInt32(8,!0),this.context=e.readMap(9,!0,this.context),this.status=e.readMap(10,!0,this.status)},Fa.Wup.prototype.decode=function(e){var t=this.iStream.setBuffer(e);if(t.buf.vew.getInt32(t.buf.position)<4)throw Error("packet length too short");t.buf.position+=4,this.readFrom(t),t=this.iStream.setBuffer(this.sBuffer.getBuffer()),3==this.iVersion?(this.newdata.clear(),t.readMap(0,!0,this.newdata)):(this.data.clear(),t.readMap(0,!0,this.data))},Fa.Wup.prototype.readBoolean=function(e){var t,i;if(3==this.iVersion){if(null==(t=this.newdata.get(e)))throw Error("UniAttribute not found key:"+e);i=this.iStream.setBuffer(t.buffer).readBoolean(0,!0,i)}else{if(null==(t=this.data.get(e)))throw Error("UniAttribute not found key:"+e);var s=Fa.TypeHelp.BOOLEAN,r=t.get(s);if(null==r)throw Error("UniAttribute not found type:"+s);i=this.iStream.setBuffer(r).readBoolean(0,!0,i)}return i},Fa.Wup.prototype.readInt8=function(e){var t,i;if(3==this.iVersion){if(null==(t=this.newdata.get(e)))throw Error("UniAttribute not found key:"+e);i=this.iStream.setBuffer(t.buffer).readInt8(0,!0,i)}else{if(null==(t=this.data.get(e)))throw Error("UniAttribute not found key:"+e);var s=Fa.TypeHelp.CHAR,r=t.get(s);if(null==r)throw Error("UniAttribute not found type:"+s);i=this.iStream.setBuffer(r).readInt8(0,!0,i)}return i},Fa.Wup.prototype.readInt16=function(e){var t,i;if(3==this.iVersion){if(null==(t=this.newdata.get(e)))throw Error("UniAttribute not found key:"+e);i=(a=this.iStream.setBuffer(t.buffer)).readInt16(0,!0,i)}else{if(null==(t=this.data.get(e)))throw Error("UniAttribute not found key:"+e);var s=Fa.TypeHelp.SHORT,r=t.get(s),a=this.iStream.setBuffer(r);if(null==r)throw Error("UniAttribute not found type:"+s);i=a.readInt16(0,!0,i)}return i},Fa.Wup.prototype.readInt32=function(e){var t,i;if(3==this.iVersion){if(null==(t=this.newdata.get(e)))throw Error("UniAttribute not found key:"+e);i=this.iStream.setBuffer(t.buffer).readInt32(0,!0,i)}else{if(null==(t=this.data.get(e)))throw Error("UniAttribute not found key:"+e);var s=Fa.TypeHelp.INT32,r=t.get(s);if(null==r)throw Error("UniAttribute not found type:"+s);i=this.iStream.setBuffer(r).readInt32(0,!0,i)}return i},Fa.Wup.prototype.readInt64=function(e){var t,i;if(3==this.iVersion){if(null==(t=this.newdata.get(e)))throw Error("UniAttribute not found key:"+e);i=this.iStream.setBuffer(t.buffer).readInt64(0,!0,i)}else{if(null==(t=this.data.get(e)))throw Error("UniAttribute not found key:"+e);var s=Fa.TypeHelp.INT64,r=t.get(s);if(null==r)throw Error("UniAttribute not found type:"+s);i=this.iStream.setBuffer(r).readInt64(0,!0,i)}return i},Fa.Wup.prototype.readFloat=function(e){var t,i;if(3==this.iVersion){if(null==(t=this.newdata.get(e)))throw Error("UniAttribute not found key:"+e);i=this.iStream.setBuffer(t.buffer).readFloat(0,!0,i)}else{if(null==(t=this.data.get(e)))throw Error("UniAttribute not found key:"+e);var s=Fa.TypeHelp.FLOAT,r=t.get(s);if(null==r)throw Error("UniAttribute not found type:"+s);i=this.iStream.setBuffer(r).readFloat(0,!0,i)}return i},Fa.Wup.prototype.readDouble=function(e){var t;if(3==this.iVersion){if(null==(t=this.newdata.get(e)))throw Error("UniAttribute not found key:"+e);var i=this.iStream.setBuffer(t.buffer);def=i.readDouble(0,!0,def)}else{if(null==(t=this.data.get(e)))throw Error("UniAttribute not found key:"+e);var s=Fa.TypeHelp.DOUBLE,r=t.get(s);if(null==r)throw Error("UniAttribute not found type:"+s);i=this.iStream.setBuffer(r),def=i.readDouble(0,!0,def)}return def},Fa.Wup.prototype.readVector=function(e,t,i){var s;if(3==this.iVersion){if(null==(s=this.newdata.get(e)))throw Error("UniAttribute not found key:"+e);t=this.iStream.setBuffer(s.buffer).readVector(0,!0,t)}else{if(null==(s=this.data.get(e)))throw Error("UniAttribute not found key:"+e);var r=s.get(i);if(null==r)throw Error("UniAttribute not found type:"+i);t=this.iStream.setBuffer(r).readVector(0,!0,t)}return t},Fa.Wup.prototype.readStruct=function(e,t,i){var s;if(3==this.iVersion){if(null==(s=this.newdata.get(e)))throw Error("UniAttribute not found key:"+e);t=this.iStream.setBuffer(s.buffer).readStruct(0,!0,t)}else{if(null==(s=this.data.get(e)))throw Error("UniAttribute not found key:"+e);var r=s.get(i);if(null==r)throw Error("UniAttribute not found type:"+i);t=this.iStream.setBuffer(r).readStruct(0,!0,t)}return t},Fa.Wup.prototype.readMap=function(e,t,i){var s;if(3==this.iVersion){if(null==(s=this.newdata.get(e)))throw Error("UniAttribute not found key:"+e);t=this.iStream.setBuffer(s.buffer).readMap(0,!0,t)}else{if(null==(s=this.data.get(e)))throw Error("UniAttribute not found key:"+e);var r=s.get(i);if(null==r)throw Error("UniAttribute not found type:"+i);t=this.iStream.setBuffer(r).readMap(0,!0,t)}return t},Fa.Wup.prototype.readBytes=function(e,t,i){var s;if(3==this.iVersion){if(null==(s=this.newdata.get(e)))throw Error("UniAttribute not found key:"+e);t=this.iStream.setBuffer(s.buffer).readBytes(0,!0,t)}else{if(null==(s=this.data.get(e)))throw Error("UniAttribute not found key:"+e);var r=s.get(i);if(null==r)throw Error("UniAttribute not found type:"+i);t=this.iStream.setBuffer(r).readBytes(0,!0,t)}return t},Fa.Util=Fa.Util||{},Fa.Util.jcestream=function(e,t){if(null!=e&&null!=e)if(e instanceof ArrayBuffer){t=t||16;for(var i=new Uint8Array(e),s="",r=0;r<i.length;r++)0!=r&&r%t==0?s+="\n":0!=r&&(s+=" "),s+=(i[r]>15?"":"0")+i[r].toString(16);console.log(s.toUpperCase())}else console.log("Taf.Util.jcestream::value is not ArrayBuffer");else console.log("Taf.Util.jcestream::value is null or undefined")},Fa.Util.str2ab=function(e){var t,i=e.length,s=new Array(i);for(t=0;t<i;++t)s[t]=e.charCodeAt(t);return new Uint8Array(s).buffer},Fa.Util.ajax=function(e,t,i,s){var r=new XMLHttpRequest;r.overrideMimeType("text/plain; charset=x-user-defined"),r.addEventListener("readystatechange",(function e(){4===r.readyState&&(200===r.status||304===r.status?i(Fa.Util.str2ab(r.response)):s(r.status),r.removeEventListener("readystatechange",e),r=void 0)})),r.open("post",e),r.send(t)};var Ba=function(e){Object(M.a)(i,e);var t=Object(U.a)(i);function i(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;return Object(s.a)(this,i),(r=t.call(this,a)).duration=e,r.lastTs=0,r}return Object(a.a)(i,[{key:"addCur",value:function(e,t){N(Object(B.a)(i.prototype),"addCur",this).call(this,e,t),this.samples.addCur(e),this.calculate(t)}},{key:"calculate",value:function(e){0===this.lastTs?this.lastTs=e:e-this.lastTs>=this.duration&&(this.lastTs=e,this.samples.calculate())}},{key:"onCheckFastTimer",value:function(e,t){this.calculate(e)}}]),i}(is),Na=function(){function e(){Object(s.a)(this,e),this.recvTotalSample=new Ba(1e3),this.recvLanSample=new Ba(1e3),this.realFlacSample=new ss}return Object(a.a)(e,[{key:"start",value:function(){Q.add(this.onCheckFastTimer,this,100)}},{key:"stop",value:function(){Q.remove(this.onCheckFastTimer,this)}},{key:"onCheckFastTimer",value:function(e,t){this.recvTotalSample.onCheckFastTimer(e,t),this.recvLanSample.onCheckFastTimer(e,t)}},{key:"addTotalSample",value:function(e){this.recvTotalSample.addCur(e,S.a.now())}},{key:"recordStat",value:function(e,t){this._recordStat(e,g.a.CORE.RECV_TOTAL_SAMPLE,this.recvTotalSample,!0,t),this._recordStat(e,g.a.CORE.RECV_LAN_SAMPLE,this.recvLanSample,!0,t),this._recordStat(e,g.a.CORE.REAL_FLAC_KBPS_SAMPLE,this.realFlacSample)}},{key:"_recordStat",value:function(e,t,i,s,r){if(i.hasSample){var a=i.getResult();""!==a&&(i.reset(),s?e.setCoreDim(t,"type:".concat(r?2:e.heart_type,",").concat(a)):e.setCoreDim(t,a))}}},{key:"addLanSample",value:function(e){this.recvLanSample.addCur(e,S.a.now())}}]),e}(),Ma="force_auto_count",Ua="force_auto_effective_time",Va=function(){function e(t,i){Object(s.a)(this,e),this._abConfig=i,this._forceCnt=0,this._sysForceCnt=0,this._effectiveTime=0,this._sysEffectiveTime=0,this._isInit=!1,this._closed=!1,t.on(d.AUTO_FORCE_RSP,this.onAutoForceRsp.bind(this))}return Object(a.a)(e,[{key:"_init",value:function(){if(!this._isInit)if(this._isInit=!0,this._sysEffectiveTime>0?this._effectiveTime=this._sysEffectiveTime:this._effectiveTime=Number(f.a.force_auto_effective_time),this._sysForceCnt>0)this._forceCnt=this._sysForceCnt,v.a.log("AutoForce._init useSys");else{this._forceCnt=Number(f.a.force_auto_count);var e=[],t=this._abConfig.getConfig("quitAutoCount");null!==t&&(this._forceCnt=Number(t),e.push("_forceCnt=".concat(this._forceCnt)));var i=this._abConfig.getConfig("isWebAutoABBBB");null!==i&&(this._closed=1===i,e.push("isWebAutoAB=".concat(i))),v.a.log("AutoForce._init ".concat(e.join(" ")))}}},{key:"onAutoForceRsp",value:function(e,t){var i=t.force_auto_count,s=t.force_auto_effective_time;v.a.log("AutoForce.onAutoForceRsp force_auto_count=".concat(i," force_auto_effective_time=").concat(s)),this._forceCnt=this._sysForceCnt=i,this._effectiveTime=this._sysEffectiveTime=1e3*s,this._checkEffective()}},{key:"addForce",value:function(){var e=Number(localStorage.getItem(Ma))||0;localStorage.setItem(Ma,e+1),v.a.log("AutoForce.addForce forceCnt=".concat(e+1)),this._checkEffective()}},{key:"_checkEffective",value:function(){(Number(localStorage.getItem(Ma))||0)>=this._forceCnt&&!localStorage.hasOwnProperty(Ua)&&(localStorage.setItem(Ua,Date.now()+this._effectiveTime),v.a.log("AutoForce._checkEffective cooling"))}},{key:"getUseAuto",value:function(){if(this._init(),this._closed)return!1;if(localStorage.hasOwnProperty(Ua)){var e=Number(localStorage.getItem(Ua));if(Date.now()<e)return v.a.log("AutoForce.getUseAuto cooling!"),!1;localStorage.removeItem(Ma),localStorage.removeItem(Ua)}var t=Number(localStorage.getItem(Ma))||0;return v.a.log("AutoForce.getUseAuto forceCnt=".concat(t," _forceCnt=").concat(this._forceCnt)),t<this._forceCnt}}]),e}(),xa=function(){function e(){Object(s.a)(this,e),this._isInit=!1,this._mpConfig=null}return Object(a.a)(e,[{key:"_init",value:function(){if(!this._isInit){v.a.log("AbConfigParser._init",localStorage.abConfig),this._isInit=!0;try{var e=JSON.parse(localStorage.abConfig);e&&e.mpConfig&&(this._mpConfig=e.mpConfig)}catch(e){v.a.log("AbConfigParser._init ".concat(e.message))}}}},{key:"getConfig",value:function(e){return this._init(),this._mpConfig&&this._mpConfig.hasOwnProperty(e)?this._mpConfig[e]:null}}]),e}(),Ha=-1,Wa=-1,Ga=function(){function e(t,i,r){Object(s.a)(this,e),this.tsdb=t,this.stat=i,this.autoMonitor=null,this.recSysStat=null,this.autoForce=null,this.handler=r}return Object(a.a)(e,[{key:"init",value:function(e,t,i){this.autoMonitor=e,this.recSysStat=t,this.autoForce=i}},{key:"check",value:function(e,t){if(!isNaN(e.lineType)&&!isNaN(e.curBitrate)&&-1!==e.lineType){if(this.stat.setComDim(g.a.DIM_COM.AUTO_USER_TAGS,this.handler.autoUserTags),-1!==Ha){var i=null;if(Ha!==e.lineType)i=this.stat.createAct(g.a.ACT.SWITCH_LINE,{value:[Ha,e.lineType]});else{var s=1e3*e.curBitrate,r=1e3*Wa,a=t?1:0,n=0;t?Wa!==e.curBitrate&&(n=2):e&&1==e.pullStreamFrom&&(n=1);var o=[s,r,a,n,0,0,1,e.bitrateList?e.bitrateList.length:0],h=[];if(this.handler.player&&this.handler.player.player&&this.handler.player.player.getAutoProps){var u=this.handler.player.player.getAutoProps();h[0]="",h[1]=u.videoBuffers,h[2]="",h[3]=u.blockDurationSample,h[4]=u.continueBufferSample,h[5]=u.realKbpsSample,h[6]="",h[7]=u.recvFps}1===a&&(this.recSysStat.recordAct(this.stat),1===n&&(this.autoForce.addForce(),this.recSysStat.removeItem(1))),this.autoMonitor.addSwitch(S.a.now(),s,r,n),i=this.stat.createAct(g.a.ACT.SWITCH_BITRATE,{value:o,str:h}),v.a.log("StatSwitch.reportSwitchBitrate getAutoProps value4=".concat(n," metric="),i)}i&&this.tsdb.sendMetrics([i])}Ha=e.lineType,Wa=e.curBitrate,t=e.isAuto}}},{key:"sendSwitchAuto",value:function(e){e[0]===Wt?this.stat.addComp(g.a.AUTO_INFO.name,g.a.AUTO_INFO.UP_CNT,1):e[0]===Gt?this.stat.addComp(g.a.AUTO_INFO.name,g.a.AUTO_INFO.DOWN_CNT,1):e[0]===jt&&this.stat.addComp(g.a.AUTO_INFO.name,g.a.AUTO_INFO.BACK_CNT,1),this.stat.setComDim(g.a.DIM_COM.AUTO_USER_TAGS,this.handler.autoUserTags);var t=this.stat.createAct(g.a.ACT.SWITCH_AUTO,{value:e});this.tsdb.sendMetrics([t])}},{key:"sendSwitchCost",value:function(e,t){this.stat.setComDim(g.a.DIM_COM.AUTO_USER_TAGS,this.handler.autoUserTags),this._sendMetric(g.a.ACT.SWITCH_COST,e,t)}},{key:"sendSwitchPts",value:function(e,t){this.stat.setComDim(g.a.DIM_COM.AUTO_USER_TAGS,this.handler.autoUserTags),this._sendMetric(g.a.ACT.SWITCH_PTS,e,t)}},{key:"_sendMetric",value:function(e,t,i){var s=this.stat.createAct(e,{value:t,str:i});this.tsdb.sendMetrics([s])}}]),e}(),ja=i(26),Ya=i.n(ja),qa=function(){function e(t,i){Object(s.a)(this,e),this.stat=t,this.tsdb=i,this.isP2PUseH265=!0,this.isFlvUseH265=!0,this.isHlsUseH265=!0,this.costUs=0,this.isCodecSupport=!1,this.codecSupportReason=-1e4,this.isBrowserSupport=!1,this.isCfgSupport=!1,this.serverSupported=!1,this.lastCurBitrate=0,this.lastLine=0,this.isUseH265Mse=!0}return Object(a.a)(e,[{key:"destroy",value:function(){}},{key:"onTurntoH264",value:function(e){e===O.P2P?this.isP2PUseH265=!1:e===O.FLV?this.isFlvUseH265=!1:e==O.HLS&&(this.isHlsUseH265=!1)}},{key:"onTurntoH265Wasm",value:function(){this.isUseH265Mse=!1}},{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.resetProps(e),this._initCodec(e),this._initBrowser(),this._initRandom(e),this._initCfg(e),this.lastCurBitrate=Number(e.curBitrate),this.lastLine=Number(e.lineType),v.a.log("H265Support.init isCodecSupport=".concat(this.isCodecSupport," isBrowserSupport=").concat(this.isBrowserSupport," isCfgSupport=").concat(this.isCfgSupport))}},{key:"mseHevcInit",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.resetMseHevcProps(e),this._initBrowserMseHevcSupport(e),this._initMseHevcCodec(e),this._initMseHevcCfg(e),this.lastCurBitrate=Number(e.curBitrate),this.lastLine=Number(e.lineType),v.a.log("H265Support.mseHevcInit isCodecSupport=".concat(this.isCodecSupport," isBrowserSupport=").concat(this.isBrowserSupport," isCfgSupport=").concat(this.isCfgSupport))}},{key:"resetProps",value:function(e){this.isCodecSupport=!1,this.codecSupportReason=-1e4,this.isBrowserSupport=!1,this.isCfgSupport=!1;var t=Number(e.lineType),i=Number(e.curBitrate);(0!=this.lastCurBitrate&&this.lastCurBitrate!=i||0!=this.lastLine&&this.lastLine!=t)&&(this.isP2PUseH265=!0,this.isFlvUseH265=!0,this.isHlsUseH265=!0)}},{key:"resetMseHevcProps",value:function(e){this.resetProps(e);var t=Number(e.lineType),i=Number(e.curBitrate);(0!=this.lastCurBitrate&&this.lastCurBitrate!=i||0!=this.lastLine&&this.lastLine!=t)&&(this.isUseH265Mse=!0)}},{key:"_initCodec",value:function(e){var t=arguments;if(1==localStorage.open265&&(localStorage.w265LastCost=0),this.isReport265||e.type===O.STREAM||(this.tsdb.sendMetrics([this.stat.createAct(g.a.ACT.H265_STATUS,{value:[10],str:[A.b.is64bitSoftware()?1:2,navigator.userAgent]})]),v.a.log("HYPlayer.initH265 support hardwareConcurrency hardwareConcurrency=",navigator.hardwareConcurrency),this.isReport265=!0),this._isSupported(e)&&Ya.a&&Ya.a.getInstance){var i={enableWebH265:1,baseCostUs:{2e3:32e3,4e3:3e4},loopCount:100,singleThreadBitKbps:[10],multiThreadBitKbps:[4e3,2e3,500],threadCount:2,degrade:0,statIntervalMs:1e3,fmt:11,share:0,wasmLoad:500,core:{2e3:3,4e3:4},x86:{4e3:1}},s={};i.x86={4e3:1},f.a.h265Config[0][0].forEach((function(e,t){s[e]=f.a.h265Config[0][1][t]})),i.baseCostUs=s,i.multiThreadBitKbps=f.a.h265Config[1];var r={};f.a.h265Config[3][0].forEach((function(e,t){r[e]=f.a.h265Config[3][1][t]})),i.core=r,Ya.a.getInstance().parseConfigs(i);var a=e.curBitrate;0===e.originalBitrate&&e.curBitrate>=4e3&&(a=0);var n=Ya.a.getInstance().isSupportH265(a);v.a.log("H265Support.initH265 bitRate",a,n),e.type===O.HLS&&3==n.reason?this.isCodecSupport=!0:this.isCodecSupport=n.isSupport,this.costUs=n.costUs,this.codecSupportReason=n.reason,this.tsdb.sendMetrics([this.stat.createAct(g.a.ACT.H265_STATUS,{value:[2],str:[n.reason]})]),Ya.a.getInstance().setLogCallback((function(){var e=["H265 render setLogCallback"].concat(Array.apply(null,t));v.a.log.apply(v.a,e)}))}}},{key:"_initMseHevcCodec",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.isUseH265Mse){if(e.type===O.HLS)return!1;if(this._isSupported(e)){this.isCodecSupport=!1;var t=e.curBitrate;if(E.a.version.major>=f.a.h265MseChromeConfig[0])navigator.hardwareConcurrency<f.a.h265MseChromeConfig[2]?this.isCodecSupport=!1:this.isCodecSupport=!0;else{if(f.a.h265MseConfig[4].length>0){var i={},s={},r={};if(f.a.h265MseConfig[4][0].forEach((function(e,t){i[e]=f.a.h265MseConfig[4][1][t],s[e]=f.a.h265MseConfig[4][2][t],r[e]=f.a.h265MseConfig[4][3][t]})),navigator.hardwareConcurrency<=i[t]){if(!(s[t]&&navigator.hardwareConcurrency>s[t]))return void v.a.warn("H265Support._initMseHevcCodec Mse Config: curThread=".concat(navigator.hardwareConcurrency," isn't greater than thread=").concat(i[t]));if(this.isBrowserSupport&&r[t]){var a=vi().toLowerCase();if(!(a.indexOf(r[t])>=0))return void v.a.warn("H265Support._initMseHevcCodec Mse Render Config: curRender=".concat(a," isn't suppored render=").concat(r[t]));this.isCodecSupport=!0}}}this.isCodecSupport=!0}}}else this.isCodecSupport=!1}},{key:"_isSupported",value:function(e){var t=!1;if(e.type===O.HLS){if(e.h265Url&&(this.serverSupported=!0),e.h265Url&&this.isHlsUseH265)return!0}else{if(t=e.iIsHEVCSupport>0&&e.iHEVCBitRate>=0||this._isH265(e.iCodecType)&&0===e.iBitRate,this.serverSupported=t,e.type===O.FLV)return this.isFlvUseH265&&t||1==localStorage._enableServer265;if(e.type===O.P2P)return this.isP2PUseH265&&t||1==localStorage._enableServer265}return!1}},{key:"_isH265",value:function(e){return 1===e||4===e||6===e||8===e}},{key:"_initBrowser",value:function(){var e=E.a.version.major,t=!1;E.a.chrome&&e>=f.a.h265Config[2]&&(t=!0),E.a.chrome&&-1!==f.a.wasm265BlackBrowVers.indexOf(e)&&(v.a.log("H265Support._initBrowser wasm265BlackBrowVers",f.a.wasm265BlackBrowVers),t=!1),1===Number(localStorage._enableBrowser)&&(t=!0),"undefined"==typeof SharedArrayBuffer&&(t=!1),this.isBrowserSupport=t}},{key:"_initBrowserMseHevcSupport",value:function(e){var t=Ei.a.isMseSupportedHevc();if(t){var i=f.a.h265MseConfig[1];if(i.length>0){var s=E.a.version.major;t=E.a.chrome&&i.indexOf(s)>=0?t&&!0:t&&!1}E.a.chrome&&E.a.version.major>=f.a.h265MseChromeConfig[0]&&(t=(t=!0)&&this.getChromeHevcRenderSupport(e))}else v.a.warn("H265Support._initMseHevcCodec browser isn't supported mse h265");if(E.a.chrome&&-1!==f.a.mse265BlackBrowVers.indexOf(E.a.version.major)){t=!1;var r=f.a.bitrateBrowHard265Cfg[0],a=f.a.bitrateBrowHard265Cfg[1],n=f.a.bitrateBrowHard265Cfg[2];1==r&&e.curBitrate<=a&&-1!==n.indexOf(E.a.version.major)&&(t=!0),v.a.log("H265Support._initBrowser wasm265BlackBrowVers, isBrowserSupport=".concat(t,", Config.mse265BlackBrowVers=").concat(f.a.mse265BlackBrowVers))}1==Number(localStorage._closeMseHevc)&&(t=!1),1===Number(localStorage._enableMseHevcBrowser)&&(t=!0),this.isBrowserSupport=t}},{key:"_initRandom",value:function(e){var t=this._getRandomUse(e);this.isCodecSupport&&(t||(this.isCodecSupport=!1)),e.randomH265=t}},{key:"_getRandomUse",value:function(e){var t=localStorage.h265PresentUid,i=e.presenterUid,s=!0,r=f.a.h265BlackUids;if(2==e.liveType&&(r=f.a.replayH265BlackUids),r.forEach((function(e){i&&e.toString()==i.toString()&&(s=!1)})),!s)return!1;if(2==e.liveType||3==e.liveType){var a=f.a.whiteH265Uids;if(0==a[1]){var n=!1;return a[0].forEach((function(e){i&&e.toString()==i.toString()&&(n=!0)})),n}}localStorage.randomH265Percent&&t==i||(localStorage.randomH265Percent=f.a.randomH265Percent),1==localStorage.open265?localStorage.randomH265Percent=3e3:2==localStorage.open265&&(localStorage.randomH265Percent=6e3);var o=Number(localStorage.randomH265Percent);return localStorage.h265PresentUid=e.presenterUid,o<f.a.h265PercentConfig}},{key:"_initCfg",value:function(e){var t=1===Number(f.a.isConfigSupportH265);e.type==O.HLS&&(t=1===Number(f.a.isVodSupportH265)),(f.a.isCloseAllFuncs(e.uid)||-1!=f.a.wcsSoft264Uids.indexOf(Number(e.uid)))&&(t=!1,v.a.log("H265Support._initCfg closeAllFuncs!")),-1!==f.a.h265BlackBrows.indexOf(E.a.version.major)&&(t=!1),f.a.wasmCloseCfg.length>0&&1==f.a.wasmCloseCfg[0]&&(v.a.log("H265Support._initCfg wasm close!"),t=!1),f.a.wasmCloseCfg.length>0&&f.a.wasmCloseCfg[1].length>0&&-1!=f.a.wasmCloseCfg[1].indexOf(Number(e.presenterUid))&&(v.a.log("H265Support._getConfigUse wasm black anchoruid"),t=!1),this.isCfgSupport=t}},{key:"_initMseHevcCfg",value:function(e){var t=1===Number(f.a.h265MseConfig[0])&&1===Number(f.a.isConfigSupportH265);if((f.a.isCloseAllFuncs(e.uid)||-1!==f.a.wcsSoft264Uids.indexOf(Number(e.uid)))&&(t=!1,v.a.log("H265Support._initCfg closeAllFuncs!")),-1!==f.a.h265BlackBrows.indexOf(E.a.version.major)&&(t=!1),E.a.version.major>=f.a.h265MseChromeConfig[0]&&e.curBitrate<=f.a.h265MseChromeConfig[1])this.isCfgSupport=t;else{var i=f.a.h265MseConfig[2];i.length>0&&i.indexOf(e.curBitrate)>=0?t=t&&!0:(v.a.warn("H265Support._initMseHevcCodec Mse Config: bitrate ".concat(e.curBitrate," isn't supported mse h265")),t=t&&!1);var s=f.a.h265MseConfig[3];s.length>0&&(s.indexOf(e.lineType)>=0?t=t&&!0:(v.a.warn("H265Support._initMseHevcCodec Mse Config: line ".concat(e.lineType," isn't supported mse h265")),t=t&&!1))}var r=f.a.h265MseWhiteBlackUids[0];r.length>0&&(e.presenterUid&&r.indexOf(Number(e.presenterUid))>=0?t=t&&!0:(t=t&&!1,v.a.warn("H265Support._initMseHevcCodec uid ".concat(e.presenterUid," isn't in white list"))));var a=f.a.h265MseWhiteBlackUids[1];a.length>0&&e.presenterUid&&a.indexOf(Number(e.presenterUid))>=0&&(t=t&&!1,v.a.warn("H265Support._initMseHevcCodec uid ".concat(e.presenterUid," is in black list"))),this.isCfgSupport=t}},{key:"getChromeHevcRenderSupport",value:function(e){return 0!=f.a.h265MseChromeConfig[4]&&-1===f.a.wcs265BlackUids.indexOf(Number(e.uid))&&-1===f.a.webCodecBlackUids.indexOf(Number(e.presenterUid))&&(-1===E.a.name.indexOf("edg")||1!=e._isTurnTomse)}},{key:"isSupported",get:function(){var e=this.isCodecSupport&&this.isBrowserSupport&&this.isCfgSupport;return 1==Number(localStorage._localCloseHevc)&&(e=!1),1===Number(localStorage._enableForceH265)&&(e=!0),e}},{key:"canPreload",get:function(){return this.isBrowserSupport&&this.isCfgSupport}}]),e}(),Ja=function(){function e(t,i){Object(s.a)(this,e),this._stat=t,this._tsdb=i,this._onMessageBind=this._onMessage.bind(this),this._onErrorBind=this._onError.bind(this),this._startTs=0,this._readyTs=0,this._isReady=!1,this._isTimeout=!1,this._isError=!1,this._decoder=null,this._callbacks=null,this._onMessageCb=null}return Object(a.a)(e,[{key:"terminate",value:function(){v.a.log("H265Decoder.terminate"),this._destroyDecoder(),Q.remove(this._onTimeout,this),this._callbacks=null,this._onMessageCb=null,this._isReady=!1,this._startTs=0,this._readyTs=0}},{key:"destroy",value:function(){v.a.log("H265Decoder.destroy"),this._stat=null,this._tsdb=null,this.stopDecoder(),this._decoder&&this._decoder.terminate(),Q.remove(this._onTimeout,this)}},{key:"_destroyDecoder",value:function(){if(this._decoder){this._decoder.onmessage=null,this._decoder.onerror=null,this.stopDecoder();try{this._decoder.terminate()}catch(e){v.a.log("H265Decoder._destroyDecoder",e)}this._decoder=null}}},{key:"stopDecoder",value:function(){this._decoder&&this._decoder.postMessage({t:6})}},{key:"load",value:function(e,t){if("undefined"!=typeof SharedArrayBuffer)if(this._callbacks=t,this._decoder)this._callbacks&&this._callbacks.ready();else{var i=E.a.chrome&&E.a.version.major>=91;1==Number(localStorage._unSupportSimd)&&(i=!1),v.a.log("H265Decoder.load"),this._startTs=S.a.now();var s='importScripts("'.concat(e+(i?"decoder.worker.simd.js":"decoder.worker.js"),'")'),r=new Blob([s],{type:"application/javascript"}),a=window.URL.createObjectURL(r),n=new Worker(a);n.onmessage=this._onMessageBind,n.onerror=this._onErrorBind,this._decoder=n,Q.remove(this._onTimeout,this),Q.once(this._onTimeout,this,1e3)}}},{key:"_onMessage",value:function(t){switch(t.data.t){case 0:this._decoder.postMessage({t:1});break;case 2:v.a.log("H265Decoder._onMessage worker isReady!"),Q.remove(this._onTimeout,this),e.preloaded=!0,this._isReady=!0,this._readyTs=S.a.now();var i=this._readyTs-this._startTs;this._tsdb&&this._tsdb.sendMetrics([this._stat.createAct(g.a.ACT.H265_WORKER_LOAD_TS,{value:[i]})]),this._isError||this._isTimeout||this._callbacks&&this._callbacks.ready()}this._onMessageCb&&this._onMessageCb(t)}},{key:"_onError",value:function(e){v.a.error("H265Decoder._onError",e),this._tsdb&&this._tsdb.sendMetrics([this._stat.createAct(g.a.ACT.H265_STATUS,{value:[1],str:[11]})]),this._destroyDecoder(),Q.remove(this._onTimeout,this),this._readyTs=0,this._isReady=!1,this._isError=!0,localStorage.h265WorkerError=1,this._callbacks&&this._callbacks.error()}},{key:"_onTimeout",value:function(){v.a.log("H265Decoder._onTimeout"),this._tsdb&&this._tsdb.sendMetrics([this._stat.createAct(g.a.ACT.H265_STATUS,{value:[1],str:[15]})]),this._destroyDecoder(),this._readyTs=0,this._isTimeout=!0,this._isReady=!1,this._callbacks&&this._callbacks.timeout()}},{key:"onMessageCb",set:function(e){this._onMessageCb=e}},{key:"decoder",get:function(){return this._decoder}},{key:"isReady",get:function(){return this._isReady}}]),e}();Object(de.a)(Ja,"preloaded",!1);var za=Ja,Ka=function e(){Object(s.a)(this,e)},Qa=function(){function e(t,i){Object(s.a)(this,e),this.stat=t.stat,this.tsdb=t.tsdb,this.vodStat=t.vodStat,this.handler=i,this.reset()}return Object(a.a)(e,[{key:"destroy",value:function(){}},{key:"addH265Support",value:function(e,t){var i=e;if(-1e4==i){var s=this.handler.h265Support,r=s.serverSupported,a=s.isCodecSupport,n=s.isBrowserSupport,o=s.isCfgSupport;r?o?n?a?o&&n&&a&&(i=0):i=6:i=5:i=4:i=1}this.stat.setComDim(g.a.DIM_COM.H265_SUPPORT_REASON,i),!t.isLive&&this.vodStat&&this.vodStat.setComDim(g.a.DIM_COM.H265_SUPPORT_REASON,i)}},{key:"addTurnTo264Support",value:function(e,t){var i=0;switch(e){case 15:i=5;break;case 3:case 11:i=6;break;case 14:i=12;break;case 9:i=13;break;case 13:i=14;break;case 12:i=15;break;case 10:i=16;break;case 16:i=17}this.stat.setComDim(g.a.DIM_COM.H265_SUPPORT_REASON,i),!t.isLive&&this.vodStat&&this.vodStat.setComDim(g.a.DIM_COM.H265_SUPPORT_REASON,i)}},{key:"addH265SupportNew",value:function(e){var t,i=this.handler.h265Support,s=i.serverSupported,r=i.isCodecSupport,a=i.isBrowserSupport,n=i.isCfgSupport,o=i.codecSupportReason;if(s)if(n)if(a){if(r)n&&a&&r&&(t=1);else if(-1e4!=o)switch(o){case 2:t=7;break;case 3:t=8;break;case 5:t=9;break;case 6:t=10;break;case 7:t=11}}else t=3;else t=4;else t=2;this.stat.setComDim(g.a.DIM_COM.H265_SUPPORT_REASON,t),!e.isLive&&this.vodStat&&this.vodStat.setComDim(g.a.DIM_COM.H265_SUPPORT_REASON,t)}},{key:"reset",value:function(){}}]),e}(),$a=function(){function e(t,i,r){Object(s.a)(this,e),this._stat=t,this._vodStat=r,this._tsdb=i,this._support=new qa(t,i),this._decoder=new za(t,i),this._render=new Ka(t,i),this._h265StatReport=new Qa({stat:t,tsdb:i,vodStat:r},this),this._renderInited=!1,this._rendering=!1,this._isH265WasmCodec=!0,this._isH265Stream=!1,this._isLive=!0,this.decodeType="wasm"}return Object(a.a)(e,[{key:"stop",value:function(){v.a.log("H265Proxy.stop"),this._isH265Stream=!1,this._rendering=!1,this._renderInited=!1,this._decoder.stopDecoder(),this._render&&this._render.destroy&&this._render.destroy()}},{key:"destroy",value:function(){this._render&&(this._render.destroy(),this._support.destroy(),this._decoder.destroy(),this._h265StatReport.destroy(),this._stat=null,this._tsdb=null,this._vodStat=null,this._render=null,this._support=null,this._decoder=null,this._h265StatReport=null,this._isH265Stream=!1)}},{key:"initSupport",value:function(e){this._isH265Stream=!1,this._support.init(e)}},{key:"loadDecoder",value:function(e,t){this._decoder.load(e,t)}},{key:"initRender",value:function(e){this.isSupported&&(this._isLive||this._isH265Stream)&&(v.a.log("H265Proxy.initRender isSupported=".concat(this._support.isSupported," isReady=").concat(this._decoder.isReady)),this._rendering=!1,this._renderInited=!1,this._render.destroy(),this.isReady&&(this._renderInited=!0,this._render.attachMse(e)))}},{key:"terminate",value:function(){this._decoder.terminate()}},{key:"containerResize",value:function(e){this.rendering&&this._render.containerResize(e)}},{key:"pushVideoFrame",value:function(e,t){this._rendering=!0,this._render&&this._render.pushVideoFrame(e,t)}},{key:"onTurnToH264",value:function(e){this._rendering=!1,this._renderInited=!1,this._support.onTurntoH264(e)}},{key:"checkUrl",value:function(e){this.isReady&&-1===e.url.indexOf("codec=265")&&(e.url+="&codec=265")}},{key:"on265StartCodeError",value:function(){this._render&&this._render.on265StartCodeError()}},{key:"reportDecodeRenderTime",value:function(e,t){this._render&&this._render.reportDecodeRenderTime(e,t)}},{key:"getStats",value:function(){return this._render&&this._render.getStats()}},{key:"jumpBuffer",value:function(e,t,i,s){this._rendering&&this._render.jumpBuffer(e,t,i,s)}},{key:"seek",value:function(e){this._render.seek(e)}},{key:"onVideoPause",value:function(){this._render.onVideoPause()}},{key:"onVideoPlay",value:function(){this._render.onVideoPlay()}},{key:"onVideoSeek",value:function(e){this._render.onVideoSeek(e)}},{key:"onStarted",value:function(){this._render.onStarted()}},{key:"onEnded",value:function(){this._render.onEnded()}},{key:"getCurrentVideoTime",value:function(){return this._render&&this._render.getCurrentVideoTime?this._render.getCurrentVideoTime():0}},{key:"getVideoBufferLen",value:function(){return this._render&&this._render.getVideoBufferLen?this._render.getVideoBufferLen():0}},{key:"isLive",set:function(e){this._isLive=e}},{key:"isH265Stream",set:function(e){this._isH265Stream=e}},{key:"render",get:function(){return this._render}},{key:"canvas",get:function(){return this._render.videoPlayerElement?this._render.videoPlayerElement:this._render.canvas}},{key:"isVideoTrack",get:function(){return this._render.isSupportVideoTrack}},{key:"decoder",get:function(){return this._decoder}},{key:"isSupported",get:function(){return this._support&&this._support.isSupported}},{key:"isReady",get:function(){return this._support&&this._support.isSupported&&this._decoder.isReady}},{key:"needPreload",get:function(){return!za.preloaded&&this._support.canPreload&&!this._decoder.isReady}},{key:"renderInited",get:function(){return this._renderInited}},{key:"rendering",get:function(){return this._rendering}},{key:"h265StatReport",get:function(){return this._h265StatReport}},{key:"h265Support",get:function(){return this._support}},{key:"isServerSupported",get:function(){return this._support&&this._support.serverSupported}}]),e}(),Xa=function(){function e(){Object(s.a)(this,e),this._buffer=-1}return Object(a.a)(e,[{key:"reset",value:function(){this._buffer=-1}},{key:"buffer",get:function(){return this._buffer},set:function(e){(-1===this._buffer||e<this._buffer)&&(this._buffer=e<0?0:e)}}]),e}(),Za=function(){function e(){Object(s.a)(this,e),this._badBuffer=new Xa}return Object(a.a)(e,[{key:"reset",value:function(){this._badBuffer.reset()}},{key:"setItem",value:function(e){this._badBuffer.buffer=e.badBuffer}},{key:"setBuffers",value:function(e){this._badBuffer.buffer=e}},{key:"badBuffer",get:function(){return this._badBuffer.buffer}}]),e}(),en=function(){function e(){Object(s.a)(this,e),this.autoBuffer=new Za,this.videoBuffer=new Za}return Object(a.a)(e,[{key:"reset",value:function(){this.autoBuffer.reset(),this.videoBuffer.reset()}}]),e}(),tn=function(){function e(){Object(s.a)(this,e),this.stat=null,this.endTs=0,this.pausedStartTs=0,this.isInTime=!1,this.switchType=0,this.switchCodecType=0,this.recordCodecType=0,this.heartType=0,this.monitorTime=Number(f.a.autoCfg.monitorTime),this.tempBuffer=new en,this.usefulBuffer=new en,this._continueBuffer=-1,this._badReasons=0,this._minReason=0}return Object(a.a)(e,[{key:"init",value:function(e){this.stat=e}},{key:"start",value:function(e,t){0===this.endTs&&(this._badReasons=0,this._minReason=0),this.switchType=e,this.switchCodecType=t,v.a.log("AutoSwitchMonitor.start"),this.endTs=S.a.now()+this.monitorTime,this.pausedStartTs>0&&(this.isInTime=!0,this.tempBuffer.autoBuffer.setItem(this.tempBuffer.videoBuffer)),this._checkStat(),Q.add(this.onCheckTimer,this,100)}},{key:"_checkStat",value:function(){this.endTs>S.a.now()?(this.heartType=this._getHeartType(),this.recordCodecType=this.switchCodecType):(this.heartType=0,this.recordCodecType=0)}},{key:"recordHeartType",value:function(){this.stat.setCoreDim(g.a.DIM_CORE.AUTO_HEART_TYPE,this.heartType),this.stat.setCoreDim(g.a.DIM_CORE.AUTO_CODEC_CHANGE_TYPE,this.recordCodecType),this.stat.setCoreDim(g.a.CORE.AUTO_BAD_BUFFER,this.usefulBuffer.autoBuffer.badBuffer),this.stat.setCoreDim(g.a.CORE.VIDEO_BAD_BUFFER,this.usefulBuffer.videoBuffer.badBuffer),this.stat.setCore(g.a.CORE.AUTO_CONTINUE_BUFFER,this._continueBuffer),this.usefulBuffer.reset(),this._continueBuffer=-1,this._checkStat()}},{key:"_getHeartType",value:function(){return this.switchType===Wt?1:2}},{key:"stop",value:function(){this.endTs=0,Q.remove(this.onCheckTimer,this)}},{key:"addBadReason",value:function(e){this._badReasons|=e;var t=Math.log2(e)+1;(0===this._minReason||this._minReason>t)&&(this._minReason=t)}},{key:"addSwitch",value:function(e,t,i,s){1===s&&(v.a.log("AutoSwitchMonitor.addSwitch, now=".concat(e,", value1=").concat(t,", value2=").concat(i,", value4=").concat(s)),this.stat.addCore(g.a.CORE.AUTO_SWITCH_CNT,1),t===i&&this.stat.addCore(g.a.CORE.AUTO_SWITCH_SAME_CNT,1),this.endTs>e&&(t===i&&this.stat.addCore(g.a.CORE.AUTO_BAD_SWITCH_SAME,1),this.switchType===Wt&&this.stat.addCore(g.a.CORE.AUTO_BAD_SWITCH_UP,1),this.stat.addCore(g.a.CORE.AUTO_BAD_SWITCH,1)))}},{key:"addBadQuality",value:function(e,t,i,s){v.a.log("AutoSwitchMonitor.addBadQuality isIntime=".concat(this.isInTime," pausedStartTs=").concat(this.pausedStartTs," endTs=").concat(this.endTs," now=").concat(e)),this.usefulBuffer.videoBuffer.setItem(this.tempBuffer.videoBuffer),this.isInTime&&(this.usefulBuffer.autoBuffer.setItem(this.tempBuffer.autoBuffer),this.stat.addCore(g.a.CORE.AUTO_BAD_QUALITY,1),this.stat.addCore(g.a.CORE.AUTO_BAD_DURATION,t),this.stat.setCoreDim(g.a.DIM_CORE.AUTO_BAD_REASON,this._badReasons),this.stat.setCoreDim(g.a.DIM_CORE.AUTO_BAD_MIN_REASON,this._minReason),this._continueBuffer=s,this.switchType===Wt&&(this.stat.addCore(g.a.CORE.AUTO_BAD_QUALITY_UP,1),this.stat.addCore(g.a.CORE.AUTO_BAD_DURATION_UP,t))),i!==fi&&(this.pausedStartTs=0,this.isInTime=!1),this.tempBuffer.reset()}},{key:"onCheckTimer",value:function(e,t){e>=this.endTs&&(v.a.log("AutoSwitchMonitor.onCheckTimer stop."),this.stat.setCore(g.a.CORE.AUTO_BAD_DONE,1),this.stop())}},{key:"resetPausedTs",value:function(){this.tempBuffer.reset(),this.pausedStartTs=0,this.isInTime=!1}},{key:"setPause",value:function(e,t){v.a.log("AutoSwitchMonitor.setPause now=".concat(e," buffer=").concat(t," endTs=").concat(this.endTs)),this.pausedStartTs=e,this.tempBuffer.videoBuffer.setBuffers(t),this.endTs>e?(this.isInTime=!0,this.tempBuffer.autoBuffer.setBuffers(t)):this.isInTime=!1}},{key:"reportDimPullStreamReason",value:function(e){null==e&&(e=5),v.a.log("AutoSwitchMonitor.reportDimPullStreamReason, type=".concat(e)),this.stat.setComDim(g.a.DIM_COM.PULLSTREAM_REASOM,e)}}]),e}(),sn=function(){function e(t){Object(s.a)(this,e),this.eventEmitter=t,this.hasEvent=!1,this.isSupported=void 0!==document.addEventListener&&void 0!==document.hidden,this.onVisibilitychangeBind=this.onVisibilitychange.bind(this),this.stat=null,this.vodStat=null,this.hiddenTs=0,this.visibleTs=S.a.now(),this.lastStatHiddenTs=0}return Object(a.a)(e,[{key:"setStat",value:function(e,t){this.stat=e,this.vodStat=t,this.onVisibilitychange(),this.addVisibilitychange()}},{key:"addVisibilitychange",value:function(){!this.hasEvent&&this.isSupported&&(this.hasEvent=!0,document.addEventListener("visibilitychange",this.onVisibilitychangeBind))}},{key:"delVisibilitychange",value:function(){this.hasEvent&&(this.hasEvent=!1,document.removeEventListener("visibilitychange",this.onVisibilitychangeBind))}},{key:"onVisibilitychange",value:function(){this.isSupported&&(v.a.log("Visibility.onVisibilitychange visibilityState=".concat(document.visibilityState)),this.stat&&this.stat.setComDim(g.a.DIM_COM.VISIBILITY_STATE,document.visibilityState),this.vodStat&&this.vodStat.setComDim(g.a.DIM_COM.VISIBILITY_STATE,document.visibilityState),this.eventEmitter.trigger(o.VISIBILITY_CHANGE,document.visibilityState),document.visibilityState===V.a.VISIBILITY_STATE.VISIBLE?this.visibleTs=S.a.now():document.visibilityState===V.a.VISIBILITY_STATE.HIDDEN&&(this.hiddenTs=S.a.now()))}},{key:"setHiddenTimeStat",value:function(){if(this.isSupported){var e=S.a.now(),t=0;0!=this.hiddenTs&&(document.visibilityState===V.a.VISIBILITY_STATE.HIDDEN&&this.hiddenTs>=this.visibleTs?t=e-this.hiddenTs:document.visibilityState===V.a.VISIBILITY_STATE.VISIBLE&&e-this.visibleTs<e-this.lastStatHiddenTs&&0!=this.lastStatHiddenTs&&(t=this.visibleTs-this.hiddenTs)),this.stat&&this.stat.setCore(g.a.CORE.VISIBILITY_HIDDEN_TIME,t),this.lastStatHiddenTs=e}}}]),e}(),rn=function(){function e(t){Object(s.a)(this,e),this.scene=t,this.sDispatchId="",this.expiredTime=0}return Object(a.a)(e,[{key:"isExpired",value:function(e){return e>this.expiredTime}}]),e}(),an=function(){function e(){Object(s.a)(this,e),this._sysMap=new Map}return Object(a.a)(e,[{key:"addItem",value:function(e,t,i){v.a.log("RecSysStat.addItem scene=".concat(e," now=").concat(S.a.now()," expiredTime=").concat(i));var s=this._sysMap.get(e);s||(s=new rn(e),this._sysMap.set(e,s)),s.sDispatchId=t,s.expiredTime=Number(i)||S.a.now()+6e4}},{key:"removeItem",value:function(e){this._sysMap.delete(e)}},{key:"recordAct",value:function(e){var t=this.getResult();t.length>0&&e.setActDim(g.a.DIM_CORE.DISPATCH_ID,t)}},{key:"recordHeart",value:function(e){var t=this.getResult();t.length>0&&e.setCoreDim(g.a.DIM_CORE.DISPATCH_ID,t)}},{key:"getResult",value:function(){var e=[],t=S.a.now();return this._sysMap.forEach((function(i){i.isExpired(t)||e.push("".concat(i.scene,":").concat(i.sDispatchId))})),e.join(",")}}]),e}(),nn=new(function(e){Object(M.a)(i,e);var t=Object(U.a)(i);function i(){var e;return Object(s.a)(this,i),(e=t.call(this)).libName="p2plib.js",e.loaded=!1,e.p2pLib=null,e.ON_LOAD="on_load",e.callbacks={onLoaded:e.onLoaded,onError:e.onLoadedError,thisObj:Object(L.a)(e)},e}return Object(a.a)(i,[{key:"isSupport",value:function(){return window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection||window.PeerConnection||window.webkitPeerConnection||window.mozPeerConnection}},{key:"hasLib",value:function(){return null!==window.P2PLib}},{key:"loadLib",value:function(e,t,i){this.hyPlyer=t,e?(i||(i=this.libName),this.loaded?this.trigger(this.ON_LOAD):Et(e,i,this.callbacks)):v.a.warn("P2PLibProxy.loadLib root none")}},{key:"onLoaded",value:function(){Ct(this.libName,this.callbacks),window.P2PLib?(this.loaded=!0,this.p2pLib=new P2PLib({userInfo:ee.a,roomInfo:null,config:f.a,TafLink:Ae,Timer:xt,TimeUtil:S.a,logger:v.a,HUYA:Da.default,Taf:La}),this.trigger(this.ON_LOAD),this.hyPlyer.reportLoadP2PLib(!1)):this.loadP2PLibError()}},{key:"onLoadedError",value:function(){this.loadP2PLibError()}},{key:"loadP2PLibError",value:function(){this.hyPlyer.reportLoadP2PLib(!0)}},{key:"playStream",value:function(e){return this.p2pLib?this.p2pLib.playStream(e):null}},{key:"removeStream",value:function(e){e&&this.p2pLib.removeStream(e)}},{key:"clearPunch",value:function(){this.p2pLib&&this.p2pLib.clearPunch()}},{key:"clearVideo",value:function(){this.p2pLib&&this.p2pLib.clearVideo()}},{key:"inflate",value:function(e,t){if(this.p2pLib)return this.p2pLib.inflate(e,t)}}]),i}(Ie)),on=new(function(e){Object(M.a)(i,e);var t=Object(U.a)(i);function i(e){var r;return Object(s.a)(this,i),(r=t.call(this)).loadCount=0,r.libName="mainlib.js",r.loaded=!1,r.p2pLib=null,r.ON_LOAD="on_mainlib_load",r.callbacks={onLoaded:r.onLoaded,onError:r.onLoadedError,thisObj:Object(L.a)(r)},r}return Object(a.a)(i,[{key:"hasLib",value:function(){return null!==window.MainLib}},{key:"loadLib",value:function(e){this.loadCount>=3?Ct(this.libName,this.callbacks):(this.loadCount++,e?(this.root=e,this.loaded?this.trigger(this.ON_LOAD):Et(e,this.libName,this.callbacks)):v.a.warn("MainLibProxy.loadLib root none"))}},{key:"onLoadedError",value:function(){this.loadLib(this.root)}},{key:"onLoaded",value:function(){Ct(this.libName,this.callbacks),window.MainLib&&(this.loaded=!0,this.mainlib=new MainLib({UserInfo:ee.a,roomInfo:null,config:f.a,TafLink:y.default,Timer:Q,TimeUtil:S.a,logger:v.a,HUYA:Da.default,Taf:La,hyPlayer:this.hyPlayer,Const:V.a,Event:o,StatCfg:g.a,P2PLibProxy:nn,Ntp:Yi,AverageCalculator:R,NtpInfo:ji,Utils:A.b,ProtoLink:ae,Status:l,MetadataTick:ie,AacFrame:Hs,MSEPlayer:Cr}),this.trigger(this.ON_LOAD))}}]),i}(Ie)),hn=function(){function e(t){Object(s.a)(this,e),this.handler=t,this.libLoaded=!1,this.videoPixelate=null,this.videoPixelateBox=null,this.playInfo=null,on.on(on.ON_LOAD,this.onLoadLib,this),this.handler.on(d.VIDEO_RESOLUTION_CHANGE,this.onResolutionChange.bind(this))}return Object(a.a)(e,[{key:"onLoadLib",value:function(){this.libLoaded=!0,this.init()}},{key:"init",value:function(){this.videoPixelate||(this.videoPixelate=new window.MainLib.VideoPixelateUtil(this.handler,this.handler.stat),this.playInfo&&this.setEnablePixelate(this.playInfo),this.videoPixelateBox&&this.setVideoPixelateBox(this.videoPixelateBox))}},{key:"setVideoPixelate",value:function(){if(this.handler.player&&this.handler.player.mse&&this.videoPixelate&&this.videoPixelateBox){var e=this.handler.player.mse||{},t=this.videoPixelateBox;this.videoPixelate.setVideoPixelateBox({viewElm:t,mse:e})}}},{key:"setVideoPixelateBox",value:function(e){e?(this.videoPixelateBox=e,(this.libLoaded||on.loaded)&&this.setVideoPixelate()):v.a.warn("video pixelate box is null")}},{key:"setEnablePixelate",value:function(e){this.playInfo=e,(this.libLoaded||on.loaded)&&this.videoPixelate&&this.videoPixelate.setEnablePixelate(e)}},{key:"containerResize",value:function(e){this.videoPixelate&&this.videoPixelate.containerResize(e)}},{key:"pushVideoPixlateInfo",value:function(e){this.videoPixelate&&this.videoPixelate.pushVideoPixlateInfo(e)}},{key:"setVideoPixelateData",value:function(e){this.videoPixelate&&this.videoPixelate.setVideoPixelateData&&this.videoPixelate.setVideoPixelateData(e)}},{key:"onResolutionChange",value:function(){if(this.videoPixelateBox){var e=this.videoPixelateBox.clientWidth,t=this.videoPixelateBox.clientHeight;v.a.log("VideoPixelateMgr.onResolutionChange",e,t),this.containerResize({width:e,height:t})}}},{key:"getMosaicStat",value:function(){return this.videoPixelate&&this.videoPixelate.getMosaicStat?this.videoPixelate.getMosaicStat():[]}},{key:"destory",value:function(){this.videoPixelate&&this.videoPixelate.destory(),this.playInfo=null}},{key:"resetData",value:function(){this.videoPixelate&&this.videoPixelate.resetData&&this.videoPixelate.resetData()}}]),e}(),un=function(){function e(t,i){Object(s.a)(this,e),this.handler=t,this.stat=i,this.muteData=[],this.cacheData=[],y.default.addListener("1200000",this._sendMuffledMessage.bind(this))}return Object(a.a)(e,[{key:"unescapeHTML",value:function(e){return A.b.unescapeHTML(e)}},{key:"_sendMuffledMessage",value:function(e){if(this.handler._type!==O.STREAM&&e&&e.sMuteInfo){var t=JSON.parse(this.unescapeHTML(e.sMuteInfo));this.sendMuffledMessage(t.voiceEliminationData)}}},{key:"sendMuffledMessage",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(this.handler.player&&this.handler.player.player){var i=this.handler.player.player;i.voiceEliminationData||(i.voiceEliminationData=[]);var s=this.handler.getCurrentDts(),r=this.handler.getCurrentSeiOffsetDts();t.length>0&&t.map((function(t){var a=!1;0===i.voiceEliminationData.length?a=!0:i.voiceEliminationData.map((function(e){e.type===t.type&&e.begin===t.begin&&e.end===t.end||(a=!0)})),a&&(e.reportMuffledDelay(r,s,t),i.voiceEliminationData.push(t),0==t.type&&(s+=r),e.cacheData.length>0&&s-e.cacheData[0].begin>=f.a.muteCfg[0]&&e.cacheData.shift(),e.cacheData.push(t),v.a.log("HYPlayer._sendMuffledMessage currentDts: ".concat(s,", currentSeiOffsetDts: ").concat(r),JSON.stringify(t),i.mse.getBufferLen()))}))}}},{key:"reportMuffledDelay",value:function(e,t,i){var s=i.begin,r=i.end,a=t;0==i.type&&(s+=e,r+=e,a=t-e);var n=0;t<=s?n=0:t>s&&t<r?n=2:t>=r&&(n=1);var o=[this.stat.createAct(g.a.ACT.MUTE_STATUS,{value:[n,i.type,a,i.begin,i.end],str:[i.reqKey]})];v.a.log("HYPlayer.reportMuffledDelay"),this.muteData.push({begin:i.begin,end:i.end,reqKey:i.reqKey,value:n,type:i.type,currentDts:a}),1==Number(f.a.isMuteAct)&&this.handler.sendMetrics(o)}},{key:"getMuteStat",value:function(){var e=this.muteData;return this.muteData=[],{muteData:e}}},{key:"getCacheData",value:function(){return Di(this.cacheData)}},{key:"resetData",value:function(){this.muteData.length=0,this.cacheData.length=0}}]),e}(),ln=0,dn=function(){function e(t){Object(s.a)(this,e),S.a.now();var i=Number(localStorage.sdkLogLevel);isNaN(i)||this.setLogLevel(i),ee.a.initUUId(),this.uuid=ee.a.uuid;var r=E.a.platform+" "+E.a.name+" "+E.a.version.string;v.a.warn("SDK ".concat(2308081438," | ").concat("2023-08-08 14:38:04"," | ").concat("RELEASE"," | ").concat(r," | ").concat(this.uuid)),this.config=f.a,this.config.init(t);var a=function(){var e=new D.a;return e.trigger=function(t){for(var i=arguments.length,s=new Array(i>1?i-1:0),r=1;r<i;r++)s[r-1]=arguments[r];var a=s;if("Array"===s.constructor.name&&(a=s[0]),t===d.PLAY_STATUS?v.a.log("%c"+t+" %c"+a.status,"color:#F9F900;background:gray","color:#53FF53;background:gray"):-1===ba.indexOf(t)&&v.a.log("%c"+t,"color:#F9F900;background:gray",a),t===d.DATA_METRIC2&&navigator){var n=navigator.userAgent;if(-1!=(n=n.toLowerCase()).indexOf("headlesschrome"))return}e.emit.apply(e,[t,t].concat(s))},e.off=function(t){for(var i=arguments.length,s=new Array(i>1?i-1:0),r=1;r<i;r++)s[r-1]=arguments[r];e.removeListener.apply(e,[t].concat(s))},e}();this.on=a.on.bind(a),this.off=a.off.bind(a),this.trigger=a.trigger.bind(a),this.stat=new ka,this.metrics=new k,this.abConfig=new xa,this.tsdbUtil=new P({stat:this.stat,eventEmiter:this}),this.sampleController=new Na,this.statSwitch=new Ga(this.tsdbUtil,this.stat,this),this.h265Proxy=new $a(this.stat,this.tsdbUtil),this.autoMonitor=new tn,this.recSysStat=new an,this.visibility=new sn,this.autoForce=new Va(this,this.abConfig),this.statSwitch.init(this.autoMonitor,this.recSysStat,this.autoForce),this.autoMonitor.init(this.stat),this.volume=1,this._type=0,this.player=null,this.lastFlvInfo=null,this.lastP2PInfo=null,this.noPictureP2PSended=!1,this.noPictureFlvSended=!1,this.noPictureWebrtcSended=!1,this.playingMgr=null,this.flacMgr=null,this.flacLibURL="flaclib.js",this.videoPlaybackrateAccess=!E.a.firefox,this.enableLowLatency=!1,this.webrtcErrored=!1,this._isP2pPlayIng=!1,this.isForceFlv=!1,this.isGetPcdnMode=!1,window.HYApplication&&(window.HYApplication.tafHandler&&y.default.setTafHandler(window.HYApplication.tafHandler),window.HYApplication.config&&this.config.init(window.HYApplication.config)),this.on(d.VIDEO_PLAY,this.onPlayVideo.bind(this)),this.on(d.H5_PLAYER_ERROR,this.onH5PlayerError.bind(this)),this._mediaLink=new Oa,this.muffleAudio=new un(this,this.stat),this.videoPixelateMgr=new hn(this,this.stat),this.isUsePcdn=!0,this.getAIRequestTime=0,this.isAiSupportP2P=!0,this.aiStartP2PCnt=0,this.aiStartFlvCnt=0,this.aiComp=0,this.sdkTurnToP2P=!0,this.sdkInRoomTs=Date.now(),this.startTs=0,this.lastPresenterUid=0}return Object(a.a)(e,null,[{key:"isSupported",value:function(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')}},{key:"Events",get:function(){return d}}]),Object(a.a)(e,[{key:"loginMedia",value:function(e,t,i){this._mediaLink.loginMedia(e,t,i)}},{key:"quitMedia",value:function(){this._mediaLink.quitMedia()}},{key:"onPlayVideo",value:function(e,t){this.player&&(this.player.setVolume(this.volume),this.videoPixelateMgr.setVideoPixelate())}},{key:"checkCooling",value:function(){if(ee.a.p2pCooling=!1,this.stat.delDim(g.a.DIM_COM.P2P_COOL_FLAG),localStorage.hasOwnProperty("p2p_cooling_time")){var e=new Date,t=new Date(Number(localStorage.getItem("p2p_cooling_time")));ee.a.p2pCooling=!(e.getFullYear()!=t.getFullYear()||e.getMonth()!=t.getMonth()||e.getDate()!=t.getDate()),ee.a.p2pCooling&&this.stat.setComDim(g.a.DIM_COM.P2P_COOL_FLAG,1)}}},{key:"setIDs",value:function(){}},{key:"setExtendConfig",value:function(e){var t={};e.p2pConfig&&(Object.assign(t,e.p2pConfig),delete e.p2pConfig),e.sdk&&(e.sdk.p2pConfig&&(Object.assign(t,e.sdk.p2pConfig),delete e.sdk.p2pConfig),Object.assign(t,e.sdk),delete e.sdk),Object.assign(t,e),this.config.init(t)}},{key:"setConfig",value:function(e,t){this.config[e]!=t&&(this.config[e]=t,v.a.log("HYPlayer.setConfig ".concat(e,"=").concat(t)))}},{key:"getConfig",value:function(e){return this.config[e]}},{key:"getVolume",value:function(){return this.volume}},{key:"setVolume",value:function(e){var t=Math.max(0,Number(e));t=Math.min(1,t),this.volume=t,this.flacMgr&&this.flacMgr.isPlaying()?(t=0,this.flacMgr.setVolume(this.volume),this.setVideoPlaybackrateAccess(!1)):this.setVideoPlaybackrateAccess(!0),this.player&&this.player.setVolume(t)}},{key:"setLogLevel",value:function(e){v.a.setLevel(e)}},{key:"getLog",value:function(){return v.a.getLog()}},{key:"getMetrics",value:function(){return this.metrics.getResult()}},{key:"getBufferLen",value:function(){return this.player&&this.player.getBufferLen&&this.player.getBufferLen()||0}},{key:"getCurrentTime",value:function(){return this.player?this.player.getCurrentTime():0}},{key:"getCurrentDts",value:function(){return this.player&&this.player.getCurrentDts?this.player.getCurrentDts():0}},{key:"getCurrentSeiOffsetDts",value:function(){return this.player&&this.player.getCurrentSeiOffsetDts?this.player.getCurrentSeiOffsetDts():0}},{key:"getCurrentSeiDts",value:function(){return this.getCurrentDts()-this.getCurrentSeiOffsetDts()}},{key:"getVideoInfo",value:function(){var e=0,t=NaN,i=this.player;if(i&&i.mse){var s=i.mse.video;e=s.currentTime,t=s.duration}return{currentTime:e,duration:t}}},{key:"sendMetrics",value:function(e){this.trigger(d.DATA_METRIC2,e)}},{key:"start",value:function(t){if(t.type!==e.STREAM||!f.a.isCloseP2P(t.uid)){this.loadlMainLib(t.h5Root),t=Object.assign({uuid:this.uuid,type:0,lineType:-1,curBitrate:0,originalBitrate:0},t),this.stop(),this.stat.setComDim(g.a.DIM_COM.PLAYER_TYPE,t.type),this.stat.setComDim(g.a.DIM_COM.LIVE_TYPE,t.liveType||0),this.stat.setComDim(g.a.DIM_COM.VR_ENABLE,t.type===e.VR?1:0),this.stat.setComDim(g.a.DIM_COM.BROWSER_KERNEL,E.a.name),this.stat.setComDim(g.a.DIM_COM.BROWSER_KERNEL_VERSION,E.a.version.major),this.stat.setComDim(g.a.DIM_COM.SESSION_ID,this.sdkInRoomTs),ee.a.sGuid=t.sGuid||ee.a.sGuid,ee.a.uid=t.uid||ee.a.uid,ee.a.roomId=t.uid||ee.a.roomId,0===ee.a.convertUid&&ee.a.uid>0&&(ee.a.convertUid=A.b.rotUid(ee.a.uid,t.presenterUid)),t.curBitrate>=1e4?f.a.maxPeerStreamNum=f.a.maxPeerStreamNum20M:f.a.maxPeerStreamNum=7,f.a.resendMode=this.getResendMode(t.curBitrate),0!=this.lastPresenterUid&&t.presenterUid!=this.lastPresenterUid&&(this.muffleAudio&&this.muffleAudio.resetData&&this.muffleAudio.resetData(),this.videoPixelateMgr&&this.videoPixelateMgr.resetData&&this.videoPixelateMgr.resetData()),this.lastPresenterUid=t.presenterUid,Yi.wsTimeSync(),v.a.log("HYPlayer.start type=".concat(t.type," convertUid=").concat(ee.a.convertUid),t),this.setAiP2PFlvComp(t),this.isAiSupportP2P=!0,this.getAiSupportP2P(t),t.type===e.P2PFLV?(t.iIsP2PSupport&&(this.lastP2PInfo=t),t.iIsP2PSupport&&this.isAiSupportP2P?t.type=e.P2P:t.type=e.FLV):t.type===e.VR&&t.iIsP2PSupport&&this.isAiSupportP2P&&!this.isForceFlv&&(t.vr.playerType=1),this._type=t.type,t.type!==e.FLV&&t.type!==e.P2P||Q.once(this.onNoPictureFlv,this,1e4);var i={stat:this.stat,tsdb:this.tsdbUtil,statSwitch:this.statSwitch,sampleController:this.sampleController,h265Proxy:this.h265Proxy,autoMonitor:this.autoMonitor,recSysStat:this.recSysStat,hyPlayerIns:this};switch(this.startTs=S.a.now(),t.type){case e.FLV:i.handlerType=1,this.player=new Aa(this,i),this.player.initPlayer(t,i),this.getFrameData=this.player.getFrameData.bind(this.player),this.lastFlvInfo=t;break;default:return void v.a.error("HYPlayer.start Unknown type[".concat(t.type,"]"))}this.checkCooling(),t.type==e.P2P&&t.p2purl?this.player.startP2PUrl(t):t.type==e.HUYA?(this.player.init(t),this.player.start(t.curBitrate)):this.player.start(t),this.enableLowLatency&&this.player&&this.player.setEnableLowLatency&&this.player.setEnableLowLatency(!0),this.player.setPlaybackrateAccess&&this.player.setPlaybackrateAccess(this.videoPlaybackrateAccess),this.playingMgr=this.player,this.getAbTestConfig(),this._type!==e.STREAM&&(this.pcdnInfo=t,this.isGetPcdnMode=!1,this.getPcdnSchedule(t)),this._setEnablePixelate(t)}}},{key:"loadlMainLib",value:function(e){0==ln&&(on.loadLib(e,this),ln++)}},{key:"getAiSupportP2P",value:function(t){var i=this;if(0!==Number(f.a.isAiP2PToFlv))if(this.isGetAiSupportP2P)this.isGetAiSupportP2P=!0;else if(f.a.playerdata){var s=f.a.playerdata.profileP2POpt;if(v.a.log("HYPlayer.getAiSupportP2P sProfileP2POpt",s),s&&""!=s&&0!=s.length){if(t.type===e.P2PFLV){if(!t.iIsP2PSupport)return}else if(t.type===e.VR&&(!t.iIsP2PSupport||this.isForceFlv))return;var r=0==t.originalBitrate?0:t.bitrate,a=t.lineType,n=JSON.parse(this.unescapeHTML(s));v.a.log("HYPlayer.getAiSupportP2P",n),n&&(n.p2pKa.split(",").map((function(e){var t=e.split("|");3==t.length&&a==t[0]&&r==t[1]&&(i.isAiSupportP2P=0==t[2])})),this.isAiSupportP2P?this.aiStartP2PCnt++:this.aiStartFlvCnt++)}}}},{key:"getAiStartStat",value:function(){var e={aiStartP2PCnt:this.aiStartP2PCnt,aiStartFlvCnt:this.aiStartFlvCnt};return this.aiStartP2PCnt=0,this.aiStartFlvCnt=0,e}},{key:"getResendMode",value:function(e){if(null!=f.a.resendModeConfig&&f.a.resendModeConfig[0].length==f.a.resendModeConfig[1].length){for(var t=f.a.resendModeConfig[0].length-1;t>=0;t--)if(e>=f.a.resendModeConfig[0][t])return f.a.resendModeConfig[1][t];return 1}}},{key:"getFrameData",value:function(){return this.player&&this.player.getFrameData?this.player.getFrameData():null}},{key:"updateLiveVodUrl",value:function(e){this.player&&this.player.updateLiveVodUrl&&this.player.updateLiveVodUrl(e)}},{key:"getExceptionStat",value:function(){return this.player.exceptionStat?this.player.exceptionStat.getStat():""}},{key:"seek",value:function(e){this.player&&this.player.seek&&this.player.seek(e)}},{key:"onNoPictureP2P",value:function(){}},{key:"onNoPictureWebrtc",value:function(){}},{key:"onNoPictureFlv",value:function(){this.player&&this.isFlv&&!this.noPictureFlvSended&&(this.noPictureFlvSended=!0,this.onNoPicture())}},{key:"onNoPictureHls",value:function(){this.player&&this.isHls&&!this.noPictureHlsSended&&(this.noPictureHlsSended=!0,this.onNoPicture())}},{key:"onNoPicture",value:function(){var e=[this.stat.createAct(g.a.ACT.NO_PICTURE,{value:[this.player.hasPicture?0:100],str:[E.a.platform]})];this.stat.setActDim(g.a.DIM_LINK_STA.name,this.getExceptionStat()),e.push(this.stat.createAct(g.a.ACT.LINK_STA,{value:[this.player.hasPicture?0:100],str:[E.a.platform]})),this.trigger(d.DATA_METRIC2,e),1==f.a.isAutoNoPicture&&Math.floor(1e3*Math.random())<50&&this.player&&!this.player.hasPicture&&(v.a.log("HYPlayer.onNoPicture auto report"),this.trigger(d.P2P_REPORT))}},{key:"onWebrtcVideoError",value:function(e){}},{key:"stop",value:function(){v.a.group("HYPlayer.stop"),Q.remove(this.onNoPictureFlv,this),Q.remove(this.onNoPictureP2P,this),this.player&&(this.player.stop(),this.player.destroy&&this.player.destroy(),this.player=null),this.stopFlac(),v.a.groupEnd(),this._isP2pPlayIng=!1,this.p2pPlayingEvent(this._isP2pPlayIng),this.player&&this.player.voiceEliminationData&&(this.player.voiceEliminationData=[]),this.stat.reset(),this.isGetPcdnMode=!1,this.videoPixelateMgr.destory()}},{key:"stopStream",value:function(e){v.a.log("HYPlayer.stopStream",e),this.player&&this.player.stopStream&&this.player.stopStream(e)}},{key:"setTafHandler",value:function(e){v.a.log("HYPlayer.setTafHandler success"),y.default.setTafHandler(e),Yi.start()}},{key:"onH5PlayerError",value:function(){this._type==e.P2P&&(this.sdkTurnToP2P=!0)}},{key:"switchLevel",value:function(e){this.player&&this.player.switchLevel(e)}},{key:"initMeeting",value:function(){}},{key:"startLiveMeeting",value:function(e,t,i){}},{key:"setMeetingStat",value:function(e){}},{key:"stopLiveMeeting",value:function(){}},{key:"startFlac",value:function(e,t){}},{key:"stopFlac",value:function(){this.flacMgr&&this.flacMgr.stop()}},{key:"flacPlayStatusChange",value:function(){this.setVolume(this.volume)}},{key:"setVideoPlaybackrateAccess",value:function(e){this.player&&this.player.setPlaybackrateAccess&&this.player.setPlaybackrateAccess(!!this.videoPlaybackrateAccess&&e)}},{key:"reportLoadP2PLib",value:function(e){var t=[this.stat.createAct(g.a.ACT.LOAD_P2PLIB_ERROR,{value:[e?100:0],str:[E.a.platform]})];this.trigger(d.DATA_METRIC2,t)}},{key:"p2pPlayingEvent",value:function(e){this.trigger(d.P2P_PLAYING_EVENT,{isP2pPlayIng:e})}},{key:"unescapeHTML",value:function(e){return(e=""+e).replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/&#39;/g,"'").replace("↵","")}},{key:"getMuteStat",value:function(){return this.muffleAudio.getMuteStat()}},{key:"getPcdnSchedule",value:function(t){var i=this;if(!f.a.isCloseP2P(t.uid)&&(this.type===e.P2P||this.type===e.FLV))if(t.sStreamName){if(f.a.notUsePcdnUids&&f.a.notUsePcdnUids.length>0){var s=!1;if(f.a.notUsePcdnUids.map((function(e){e===String(t.presenterUid)&&(s=!0)})),s)return}if(this.isUsePcdn)if(y.default.connected){Q.remove(this.timeoutGetPcdn),Q.remove(this.httpsFetch),Q.once(this.httpsFetch,this,1e3);var r=this.getPcdnReq(t);v.a.log("HYPlayer.getPcdnSchedule tqf req",r),y.default.sendWup("hypcdngw","clientQueryPcdnSchedule",r,(function(e){i.getPcdnRes(e)}),!0,y.default.getRequestId()),Q.once(this.timeoutGetPcdn,this,1e3)}else y.default.on(y.default.TAFLINK_INITED,(function(){v.a.log("HYPlayer.getPcdnSchedule taf inited"),i.getPcdnSchedule(t)}))}else v.a.log("HYPlayer.getPcdnSchedule has no sStreamName")}},{key:"getPcdnRes",value:function(e){v.a.log("HYPlayer.getPcdnSchedule res",e),this.isGetPcdnMode=!0,!e||0!=e.iErrCode&&7!=e.iErrCode||this.player&&this.player.checkPcdnMode&&this.player.checkPcdnMode(e)}},{key:"getPcdnReq",value:function(e){var t=new Da.default.ClientQueryPcdnScheduleReq;t.lReqTs=Date.now(),t.lUid=ee.a.uid,t.sGuid=ee.a.sGuid,t.lAnchorUid=e.presenterUid,t.iCdnLine=e.lineType,t.iCliType=Da.default.EM_CLINET_TYPE.E_CLIENT_WEB,t.lBucketPara=Number(localStorage.randomPcdnPercent)||0,t.vPcdnMode.value=[Da.default.EM_PCDN_MODE.E_PcdnMode_P2pHttpSubstream];var i=new La.Vector(new La.STRING);return i.value=["xy","ppio"],1===Number(f.a.pcdnFlv)&&(t.vPcdnMode.value.push(Da.default.EM_PCDN_MODE.E_PcdnMode_FlvOutsideSdkFullstream),t.mPcdnModeCliSupportPcdns.value[Da.default.EM_PCDN_MODE.E_PcdnMode_FlvOutsideSdkFullstream]=i),t.iBusiType=Da.default.EM_BUSI_TYPE.E_BusiType_Live,t.sStreamName=e.sStreamName,t}},{key:"httpsFetch",value:function(){var e=this;if(!this.isGetPcdnMode){v.a.log("HYPlayer.httpsFetch");var t=this.pcdnInfo,i=this.getPcdnReq(t);v.a.log("HYPlayer.httpsFetch req",i);var s=Date.now().toString(16),r="https://pcdngw.huya.com/huyalive/clientQueryPcdnSchedule";r+="?wsSecret=".concat(we("clientQueryPcdnSchedule".concat(s,"1211huyalive")),"&wsTime=").concat(s);var a=new La.JceOutputStream;i.writeTo(a),fetch(r,{body:a.getBuffer(),method:"POST"}).then((function(t){var i=t.body.getReader();e.pump.call(e,i)}))}}},{key:"pump",value:function(e){var t=this;e.read().then(function(i){if(i.done)v.a.log("httpsFetch done");else{var s=i.value.buffer;t.pump(e);var r=new La.JceInputStream(s),a=new Da.default.ClientQueryPcdnScheduleRsp;a.readFrom(r),t.getPcdnRes(a)}}.bind(this))}},{key:"getAnticode",value:function(e,t){var i=t.split("&"),s={};return i.map((function(e){var t=e.split("=");2==t.length&&(s[t[0]]=t[1])})),s[e]?s[e]:""}},{key:"timeoutGetPcdn",value:function(){v.a.log("HYPlayer.timeoutGetPcdn"),this.isGetPcdnMode||this.getPcdnSchedule(this.pcdnInfo)}},{key:"setVideoPixelateData",value:function(e){var t=e.config;1==localStorage._forceVideoMaskConfig&&(t.pixelateResource=[{key:1,url:"https://diy-assets.msstatic.com/OmpPixelate/cloud2.png"}]),t&&t.pixelateResource&&t.pixelateResource.length>0&&(this.videoPixelateMgr.setVideoPixelateData(t.pixelateResource),v.a.log("HYPlayer.setVideoPixelateData.config",t))}},{key:"pushVideoPixlateInfo",value:function(e){this.videoPixelateMgr.pushVideoPixlateInfo(e)}},{key:"setVideoPixelateBox",value:function(e){this.videoPixelateMgr.setVideoPixelateBox(e)}},{key:"getMosaicStat",value:function(){return{data:this.videoPixelateMgr.getMosaicStat()}}},{key:"containerResize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.videoPixelateMgr&&this.videoPixelateMgr.containerResize(e)}},{key:"getUseAuto",value:function(){return this.autoForce.getUseAuto()}},{key:"getSupportAuto",value:function(){return!f.a.getEnableJumpBuffer()}},{key:"_setEnablePixelate",value:function(e){this.videoPixelateMgr.setEnablePixelate(e)}},{key:"getRandomUseAiP2PFlv",value:function(e){var t=localStorage.aiP2PFlvPresentUid,i=e.presenterUid,s=!0;if(1==Number(f.a.allUidsAiP2P))s=!0;else{var r=f.a.aiBlackUids.concat(f.a.aiBlack2Uids);v.a.log("HYPlayer.getRandomUseAiP2PFlv blackUids",r),r.forEach((function(e){i&&e.toString()==i.toString()&&(s=!1)}))}if(/\/huyalive/g.test(e.sFlvUrl))return v.a.log("HYPlayer.getRandomUseAiP2PFlv flvUrk huyalive"),2;if(!s||7==e.lineType||0==e.iIsP2PSupport)return 2;if(f.a.isCloseP2P(e.uid))return 2;localStorage.randomAIP2PFlvPercent&&t==i||(localStorage.randomAIP2PFlvPercent=f.a.randomAIP2PFlvPercent);var a=Number(localStorage.randomAIP2PFlvPercent);return localStorage.aiP2PFlvPresentUid=e.presenterUid,a<f.a.aiRandomPercent?1:0}},{key:"setAiP2PFlvComp",value:function(e){var t=this.getRandomUseAiP2PFlv(e);this.aiComp=t,this.stat.setComDim("backup_field1",t),0==t||2==t?f.a.setAiP2PToFlv(0):1==t&&f.a.setAiP2PToFlv(1)}},{key:"getAbTestConfig",value:function(){var e=localStorage.abConfig;if(v.a.log("HYPlayer.getAbTestConfig abConfig",e),!e)return null;""!=(e=JSON.parse(e)).mpExperiment&&this.stat.setComDim(g.a.DIM_COM.OEXP,e.mpExperiment),!e.mpConfig||0!=Number(e.mpConfig.usePcdn)&&1!=Number(e.mpConfig.usePcdn)||(v.a.log("HYPlayer.getAbTestConfig",e.mpConfig,e.mpConfig.usePCdn),this.isUsePcdn=1==Number(e.mpConfig.usePcdn));var t=Number(e.mpConfig.abPlaybackMinRate),i=Number(e.mpConfig.abPlaybackMaxRate);e.mpConfig&&t&&i&&(v.a.log("HYPlayer.getAbTestConfig playbackRate, min=%f, max=%f",t,i),f.a.setAbPlaybackRate(t,i))}},{key:"getSdkTestConfig",value:function(){var e="";if(1===Number(f.a.isCommonAb))e=1;else{var t=this.aiComp;1===t?e=1:0===t?e=0:2===t&&(e="")}return v.a.log("HYPlayer.getSdkTestConfig",e),e}},{key:"isSupportP2P",get:function(){return X.isSupportP2P()}},{key:"isWebrtcSupport",get:function(){return X.isWebrtcSupport()}},{key:"type",get:function(){return this._type}},{key:"isFlv",get:function(){return this._type==e.FLV}},{key:"isP2P",get:function(){return this._type==e.P2P}},{key:"isHls",get:function(){return this._type==e.HLS}},{key:"isHuya",get:function(){return this._type==e.HUYA}},{key:"isHuyaWebrtc",get:function(){return this._type==e.HUYAWEBRTC}},{key:"isP2pPlayIng",get:function(){return this._isP2pPlayIng}}]),e}();dn.FLV=1,dn.P2P=2,dn.HLS=3,dn.HUYA=4,dn.STREAM=5,dn.OBS=6,dn.VR=7,dn.HUYAWEBRTC=8,dn.PLAYBACK=9,dn.P2PFLV=10,t.default=dn,window.HYPlayer=dn,window.H5Player=dn},function(e,t,s){"use strict";s.r(t);var a=function(){function e(t){p(this,e),this.data=new Uint8Array(t),this.idx=0,this.size=t}return m(e,[{key:"getData",value:function(){if(this.idx!=this.size)throw"Mismatch between size reserved and sized used";return this.data.slice(0,this.idx)}},{key:"writeUint8",value:function(e){this.data.set([e],this.idx),this.idx++}},{key:"writeUint16",value:function(e){var t=new Uint16Array(1);t[0]=e;var i=new Uint8Array(t.buffer);this.data.set([i[1],i[0]],this.idx),this.idx+=2}},{key:"writeUint8Array",value:function(e){this.data.set(e,this.idx),this.idx+=e.length}}]),e}(),o=function(){function e(t,i,s){p(this,e),this.timeStamp=i,this.frame=s,this.type=t,this.isEmptyAudioFrame=!1}return m(e,[{key:"setIsEmptyAudioFrame",value:function(e){this.isEmptyAudioFrame=e}}]),e}();o.VIDEO=0,o.AUIDO=1;var h=o,l=s(7),f=m((function e(t,i,s){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];p(this,e),this.data=s,this.timeStamp=i,this.type=t,this.startDecodeTime=0,this.decodedTime=0,this.discardAllow=r,this.isKeyFrame=a}));f.VIDEO=0,f.AUIDO=1;var _=f,y=s(16),v=s(19),S=function(){function e(t){p(this,e),this.samples=[],this.decodedFrames=[],this.decoder=null,this.decodingTimeStamp=0,this.decodingType=0,this.decodeState=e.DECODE_STATE_PENDDING,this.decodeNums=0,this.toDecodeNums=0,this.lastToDecodeNums=0,this.lastDecodedNums=0,this.player=t,this.decodeDatas=[],this.decodIngAudioFrameTimeStamps=[],this.decodIngAudioFrameIsEmptyTypes=[],this.count=0,this.closed=!1,this.toDecodeFrameLocalTimeMap=new Map,this.frameDecodeDelays=[],this.decodedFrameStamp=0,this.printTodecodeCnt=0,this.printDecodedCnt=0,this.lastToDecodePts=0,this.lastDecodedPts=0,this.lastTodecodeDts=0}return m(e,[{key:"configured",get:function(){return this.decoder&&"configured"==this.decoder.state}},{key:"close",value:function(){this.closed=!0,this.decodeDatas.length=0,this.decodeNums=0,this.toDecodeNums=0,this.lastToDecodeNums=0,this.lastDecodedNums=0,"closed"!=this.decoder.state&&(this.decoder.reset(),this.decoder.close()),this.decoder=null,this.player=null,this.decodedFrameStamp=0}},{key:"appendSamples",value:function(t,i){for(;t.length>0;)this.samples.push(t.shift());this.decodeState==e.DECODE_STATE_PENDDING&&this.decodeChunk(i)}},{key:"getUnDecodeBuffer",value:function(){return this.lastToDecodePts>0&&this.lastDecodedPts>0?this.lastToDecodePts-this.lastDecodedPts:0}},{key:"decodeFrame",value:function(e){this.toDecodeNums++,this.lastToDecodePts=e.timeStamp+(e.compositionTime||0),e.type==_.AUIDO?this.player.storeWorkerShared(y.StoreWorkerType.AUDIO_TODECODE_NUMS,this.toDecodeNums):e.type==_.VIDEO&&this.player.storeWorkerShared(y.StoreWorkerType.VIDEO_TODECODE_NUMS,this.toDecodeNums),this.toDecodeFrameLocalTimeMap.set(e.timeStamp,l.default.getNow()),v.a.printTodecodeVideo&&e.type===_.VIDEO&&l.default.log("WebCodecsDecoder.decodeFrame isKey=".concat(e.isKeyFrame," dts=").concat(e.timeStamp," cts=").concat(e.compositionTime," pts=").concat(e.timeStamp+e.compositionTime," gap=").concat(e.timeStamp-this.lastTodecodeDts," lastDecodedPts=").concat(this.lastDecodedPts,"  samples=").concat(this.player.decodeJitter.videoSamples.length," decodedNum=").concat(this.player.videoRender.framelist.length)),v.a.printToDecodeAudio&&e.type===_.AUIDO&&l.default.log("WebCodecsDecoder.decodeFrame dts=".concat(e.timeStamp," gap=").concat(e.timeStamp-this.lastTodecodeDts," lastDecodedPts=").concat(this.lastDecodedPts," samples=").concat(this.player.decodeJitter.audioSamples.length," decodedNum=").concat(this.player.audioRender.framelist.length)),this.lastTodecodeDts=e.timeStamp;try{this.decoder.decode(e.data)}catch(t){console.error(t,e,e.naluType,e.isKeyFrame,e.timeStamp,this.toDecodeNums,"webCodecsDecoder"),this.onDecoderError(t)}}},{key:"onFrame",value:function(e){var t=l.default.getNow();if(this.decodedFrameStamp=t,this.lastDecodedPts=e.timestamp,!this.closed){this.decodeNums++;var i=0,s=!1;if(this.decodingType==_.AUIDO?(i=this.decodIngAudioFrameTimeStamps.shift(),s=this.decodIngAudioFrameIsEmptyTypes.shift(),this.player.storeWorkerShared(y.StoreWorkerType.AUDIO_DECODE_NUMS,this.decodeNums)):this.decodingType==_.VIDEO&&(this.player.storeWorkerShared(y.StoreWorkerType.VIDEO_DECODE_NUMS,this.decodeNums),i=e.timestamp),this.toDecodeFrameLocalTimeMap.has(i)){var r=Math.floor(100*(l.default.getNow()-this.toDecodeFrameLocalTimeMap.get(i)))/100;v.a.printDecodedVideo&&this.decodingType===_.VIDEO&&l.default.log("WebcodecsDecoder.decode timeStamp=".concat(i," delay=").concat(r," samples=").concat(this.player.decodeJitter.videoSamples.length," frames=").concat(this.player.videoRender.framelist.length)),v.a.printDecodedAudio&&this.decodingType===_.AUIDO&&l.default.log("WebcodecsDecoder.decode timeStamp=".concat(i," delay=").concat(r," samples=").concat(this.player.decodeJitter.audioSamples.length," frames=").concat(this.player.audioRender.framelist.length)),this.frameDecodeDelays.push(r),this.toDecodeFrameLocalTimeMap.delete(i)}var a=i,n=new h(this.decodingType,a,e);n.setIsEmptyAudioFrame(s),this.player.onFrameDecoded(n)}}},{key:"getDecodeDelay",value:function(){var e=i(this.frameDecodeDelays).slice(0);return this.frameDecodeDelays.length=0,e}},{key:"onDecoderError",value:function(e){l.default.log("WebCodecsDecoder.onDecoderError, decodingType="+this.decodingType);var t=y.ToMainMessageType.VIDEODECODEERROR;this.decodingType==_.VIDEO?t=y.ToMainMessageType.VIDEODECODEERROR:this.decodingType==_.AUIDO&&(t=y.ToMainMessageType.AUDIODECODEERROR),this.player.handlerError(t,{msg:e&&e.message})}},{key:"getDecodeFps",value:function(){var e={toDecodeFps:this.toDecodeNums-this.lastToDecodeNums,decodeFps:this.decodeNums-this.lastDecodedNums};return this.lastDecodedNums=this.decodeNums,this.lastToDecodeNums=this.toDecodeNums,e}},{key:"resetDecoder",value:function(){}}]),e}();S.DECODE_STATE_PENDDING=0,S.DECODE_STATE_DECODEDING=1,S.DECODE_STATE_DECODEFINISH=2,S.DECODER_ERROR="video_deocde_error",S.DECODER_TYPE_VIDEO=0,S.DECODER_TYPE_AUDIO=1;var g=S,T=function(e){n(i,e);var t=u(i);function i(e){var s;return p(this,i),(s=t.call(this,e)).decodingType=_.VIDEO,s.avcHeader=null,s.avcHeaderChanged=!1,s.lastToDecodeFrameTimeStamp=0,s.createDecoder(),s._isUseSoftAcceleration=!1,s.checkDecodedOutputFrameTypeTimes=0,s.lastDecodedFrameTimeStamp=0,s.outputFrameByPts=!1,s.outputFrameMode=-1,s.checkFrameCnt=0,s.hasCts=!1,s.codecType="",s}return m(i,[{key:"resetDecoder",value:function(){this.decodeDatas.length=0,this.decodeNums=0,this.toDecodeNums=0,this.lastToDecodeNums=0,this.lastDecodedNums=0,"closed"!=this.decoder.state&&(this.decoder.reset(),this.decoder.close()),this.decoder=null,this.decodedFrameStamp=0,this.lastToDecodePts=0,this.lastDecodedPts=0,this.createDecoder(),this.setAVCConfig()}},{key:"createDecoder",value:function(){this.decoder=new VideoDecoder({output:this.onFrame.bind(this),error:this.onDecoderError.bind(this)})}},{key:"close",value:function(){r(c(i.prototype),"close",this).call(this),this.codecType=""}},{key:"decodeFrame",value:function(e){e.isKeyFrame&&this.updateAVCConfig(e.sps,e.pps,e.vps,e.codec,e.width,e.height),this.lastToDecodeFrameTimeStamp=e.timeStamp,e.compositionTime>0&&(this.hasCts=!0),r(c(i.prototype),"decodeFrame",this).call(this,e)}},{key:"onFrame",value:function(e){this.checkOutputMode(e.timestamp),this.checkFrameOutputByPts(e.timestamp),this.lastDecodedFrameTimeStamp=e.timestamp,r(c(i.prototype),"onFrame",this).call(this,e)}},{key:"checkFrameOutputByPts",value:function(e){!this.outputFrameByPts&&this.checkDecodedOutputFrameTypeTimes<100&&e<this.lastDecodedFrameTimeStamp&&(this.checkDecodedOutputFrameTypeTimes++,this.outputFrameByPts=!0,this.player.setVideoOutputByPts(this.outputFrameByPts))}},{key:"checkOutputMode",value:function(e){-1===this.outputFrameMode&&this.checkFrameCnt<100&&(this.checkFrameCnt++,e<this.lastDecodedFrameTimeStamp?this.outputFrameMode=2:100===this.checkFrameCnt&&-1===this.outputFrameMode&&(this.hasCts?this.outputFrameMode=1:this.outputFrameMode=2))}},{key:"isOutputFrameByDts",value:function(){return 1===this.outputFrameMode}},{key:"updateAVCConfig",value:function(e,t,i,s,r,a){this.avcHeaderChanged=this.checkAVCConfigChanged(t,e,i),this.avcHeader={sps:e,pps:t,vps:i,codec:s,width:r,height:a},this.avcHeaderChanged&&(l.default.log("WebCodecsDecoder.updateVideoConfig codec=".concat(s," width=").concat(r," height=").concat(a)),this.setAVCConfig())}},{key:"checkAVCConfigChanged",value:function(e,t,i){if(!this.avcHeader)return!0;if(this.avcHeader&&-1!==this.avcHeader.codec.indexOf("hvc")){if(this.avcHeader.pps[0].nalu.toLocaleString()==e[0].nalu.toLocaleString()&&this.avcHeader.sps[0].nalu.toLocaleString()==t[0].nalu.toLocaleString()&&this.avcHeader.vps[0].nalu.toLocaleString()==i[0].nalu.toLocaleString())return!1}else if(this.avcHeader&&-1!==this.avcHeader.codec.indexOf("avc")&&this.avcHeader.pps[0].nalu.toLocaleString()==e[0].nalu.toLocaleString()&&this.avcHeader.sps[0].nalu.toLocaleString()==t[0].nalu.toLocaleString())return!1;return!0}},{key:"setAVCConfig",value:function(){l.default.log("WebCodecsDecoder.setAVCConfig"),this.setDecoderConfig(),this.avcHeaderChanged=!1}},{key:"setDecoderConfig",value:function(){var e=this.getExtradata();if(e){var t={codec:this.avcHeader.codec,codedWidth:this.avcHeader.width,codedHeight:this.avcHeader.height,description:e,optimizeForLatency:!1};this._isUseSoftAcceleration&&(t.hardwareAcceleration="prefer-software"),l.default.log("WebCodecsDecoder.setDecoderConfig",t.hardwareAcceleration,this._isUseSoftAcceleration),this.decoder.configure(t)}else l.default.log("WebCodecsDecoder.setDecoderConfig extradata is null!")}},{key:"getExtradata",value:function(){return-1!==this.avcHeader.codec.indexOf("hvc")?(this.codecType="265",this.getExtradata265()):-1!==this.avcHeader.codec.indexOf("avc")?this.getExtradata264():null}},{key:"getExtradata265",value:function(){var e=this._getNumOfArrays(this.avcHeader.vps,32),t=this._getNumOfArrays(this.avcHeader.sps,33),i=this._getNumOfArrays(this.avcHeader.pps,34),s=this._getSPSOri(t),r=[1,s[8],s[9],s[10],s[11],s[12],s[13],s[14],s[15],s[16],s[17],s[18],s[19],240,0,252,253,248,248,0,0,15];return r.push(3),r=r.concat(e).concat(t).concat(i),new Uint8Array(r)}},{key:"_getNumOfArrays",value:function(e,t){var i=[];i.push(128|t),i.push((65280&e.length)>>8),i.push(255&e.length);for(var s=0;s<e.length;s++){var r=e[s].nalu;i.push((65280&r.length)>>8),i.push(255&r.length),i=i.concat(Array.prototype.slice.call(r))}return i}},{key:"_getSPSOri",value:function(e){for(var t=[],i=0,s=0;s<e.length;){var r=e[s];2!==i||3!==r?(0===r?i++:i=0,t.push(r),++s):(++s,i=0)}return t}},{key:"getExtradata264",value:function(){var e,t=7;for(e=0;e<this.avcHeader.sps.length;e++)t+=2+this.avcHeader.sps[e].length;for(e=0;e<this.avcHeader.pps.length;e++)t+=2+this.avcHeader.pps[e].length;var i=new a(t),s=this.avcHeader.sps[0].nalu[1],r=this.avcHeader.sps[0].nalu[2],n=this.avcHeader.sps[0].nalu[3];for(i.writeUint8(1),i.writeUint8(s),i.writeUint8(r),i.writeUint8(n),i.writeUint8(255),i.writeUint8(this.avcHeader.sps.length+224),e=0;e<this.avcHeader.sps.length;e++)i.writeUint16(this.avcHeader.sps[e].length),i.writeUint8Array(this.avcHeader.sps[e].nalu);for(i.writeUint8(this.avcHeader.pps.length),e=0;e<this.avcHeader.pps.length;e++)i.writeUint16(this.avcHeader.pps[e].length),i.writeUint8Array(this.avcHeader.pps[e].nalu);return i.getData()}},{key:"setUseSoftAcceleration",value:function(){this._isUseSoftAcceleration=!0}}]),i}(g),P=function(e){n(i,e);var t=u(i);function i(e){var s;return p(this,i),(s=t.call(this,e)).decodingType=_.AUIDO,s.aacConfig=null,s.aacConfigChanged=!1,s.aacConfigInited=!1,s.decoder=new AudioDecoder({output:s.onFrame.bind(d(s)),error:s.onDecoderError.bind(d(s))}),s}return m(i,[{key:"updateAudioConfig",value:function(e,t,i,s){this.aacConfig&&this.aacConfig.codec==e&&this.aacConfig.sampleRate==t&&this.aacConfig.numberOfChannels==i||(this.aacConfig={codec:e,sampleRate:t,numberOfChannels:i,timestamp:s},this.aacConfigChanged=!0),this.aacConfigInited||this.setAACConfig(this.aacConfig.codec,this.aacConfig.sampleRate,this.aacConfig.numberOfChannels)}},{key:"setAACConfig",value:function(e,t,i){var s={codec:e,sampleRate:t,numberOfChannels:i};this.decoder.configure(s),this.aacConfigInited=!0}},{key:"decodeFrame",value:function(e){this.aacConfigChanged&&this.aacConfig.timestamp<=e.timeStamp&&(this.setAACConfig(this.aacConfig.codec,this.aacConfig.sampleRate,this.aacConfig.numberOfChannels),this.aacConfigChanged=!1),r(c(i.prototype),"decodeFrame",this).call(this,e),this.decodIngAudioFrameTimeStamps.push(e.timeStamp),this.decodIngAudioFrameIsEmptyTypes.push(e.isEmptyAudioFrame)}},{key:"onFrame",value:function(e){r(c(i.prototype),"onFrame",this).call(this,e)}}]),i}(g),E=function(){function e(t){p(this,e),this._name=t,this._startTs=0,this._startDts=0,this._lastDts=0,this._jumpTime=0,this._lastDts=0,this._lastTs=0}return m(e,[{key:"setLast",value:function(e,t){this._lastDts=e,this._lastTs=t}},{key:"getDtsSlowTime",value:function(e,t){if(this._lastDts>0){var i=e-this._lastDts;return t-this._lastTs-i}return 0}},{key:"lastDts",get:function(){return this._lastDts}},{key:"setJumpTime",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._jumpTime+=e,t&&l.default.log("Timeline.setJumpTime name=".concat(this._name," jumpTime=").concat(e," totalJumpTime=").concat(this._jumpTime))}},{key:"reset",value:function(){this._startTs=0,this._startDts=0,this._lastDts=0}},{key:"start",value:function(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];0===this._startTs&&(i&&l.default.log("Timeline.start name=".concat(this._name," dts=").concat(t)),this._startTs=e,this._startDts=t)}},{key:"getTsTime",value:function(e){return Math.floor(e-this._startTs+this._jumpTime)}},{key:"getDtsNow",value:function(e){return this._startDts+this.getTsTime(e)}},{key:"isDtsLess",value:function(e,t){return t<this.getDtsNow(e)}}]),e}(),C=s(8),w=function(){function e(t){p(this,e),this.player=t,this.videoGlWrap=null,this.framelist=[],this.currentDts=0,this.lastCurrentAudioDts=0,this.lastPic=null,this.lastRenderRafTime=0,this.lastRafNow=0,this.renderFps=0,this.videoCurrentDts=0,this.noVideoRender=!1,this.throwFps=0,this.curBitrate=0,this.ageneratorWriter=null,this.isTriggerPlay=!1,this.renderedFrameTs=0,this.printCnt=0,this.fastPlayEndDts=0,this.fastPlay=!1,this.checkLatencyTs=0,this.latencyRenderCnt=0,this.lastRenderTs=0,this.lastRenderPts=0,this.renderSecFps=0,this.videoRender5SecFpsList=[],this.timeline=new E("video_render"),this.isBrowserHidden=!1,this.isPaused=!1}return m(e,[{key:"start",value:function(e,t,i,s){this.ageneratorWriter=i.getWriter()}},{key:"renderVideo",value:function(e,t){if(this.checkSkipFrame(t),0!=this.framelist.length){var i=this.framelist[0],s=this.getAudioDts(e);if(this.getIsRender(s,i)){this.lastPic=i,this.renderFps++,this.setVieoCurrentDts(i),this.player.storeWorkerShared(y.StoreWorkerType.VIDEO_RENDER_NUMS,this.renderFps),this.lastRenderRafTime=t,this.framelist.shift();var r=i.frame;this.renderedFrameTs=i.timeStamp,this.player.avRenderSync.setRenderVideoTs(t),this.timeline.setLast(i.timeStamp,t),this.noVideoRender||(v.a.printTorenderVideo&&l.default.log("VideoRender.renderVideo timeStamp=".concat(i.timeStamp," ptsNow=").concat(this.timeline.getDtsNow(t)," frames=").concat(this.framelist.length)),this.latencyRenderCnt++,this.ageneratorWriter.write(r),l.default.postMessage(y.ToMainMessageType.WebGLPLAY),this.checkPause(),this.isTriggerPlay||(this.startRenderTs=t,this.firstTimeStamp=i.timeStamp,this.isTriggerPlay=!0)),this.renderedFrameTs=i.timeStamp,r.close()}}}},{key:"onCheckTimer",value:function(e){if(0!=this.renderSecFps){var t=this.renderFps-this.renderSecFps;this.videoRender5SecFpsList.length>=5&&this.videoRender5SecFpsList.shift(),this.videoRender5SecFpsList.push(t)}this.renderSecFps=this.renderFps}},{key:"checkPause",value:function(){if(!this.player.userPaused){var e=this.getCurrentDts(),t=l.default.getNow();if(this.isBrowserHidden)this.isPaused&&(l.default.postMessage(y.ToMainMessageType.SET_FRMAE_RESUME),this.isPaused=!1);else if(0!=this.lastRenderPts&&0!=this.lastRenderTs){var i=e-this.lastRenderPts,s=t-this.lastRenderTs,r=s-i,a=this.videoRender5SecFpsList.length,n=!1;a>=5&&(n=this.videoRender5SecFpsList.reduce((function(e,t){return e+t}),0)/a<=10),s-i>200||i>300&&s>200?(l.default.log("VideoRender.mobPaused tsDelta:".concat(s," ptsDelta:").concat(i," delta:").concat(r)),l.default.postMessage(y.ToMainMessageType.SET_FRAME_PAUSE),this.isPaused=!0):this.isPaused&&(l.default.postMessage(y.ToMainMessageType.SET_FRMAE_RESUME),this.isPaused=!1),n&&l.default.postMessage(y.ToMainMessageType.RENDER_FPS_PAUSE)}this.lastRenderTs=t,this.lastRenderPts=e}}},{key:"checkSkipFrame",value:function(e){var t=this.player.latencyCfg;if(t.latencyMode){var i=this.player.getBufferLen(),s=this.framelist.length;if(i>=t.latencyBuf&&s>0){if(0===this.checkLatencyTs)this.checkLatencyTs=e;else if(e-this.checkLatencyTs>2e3&&this.latencyRenderCnt%t.skipFrameGap==0){var r=this.framelist[0];this.timeline.isDtsLess(e,r.timeStamp)&&(v.a.printRenderSkipFrame&&l.default.log("VideoRender.checkLatencySkip skipFrameGap=".concat(t.skipFrameGap," renderCnt=").concat(this.latencyRenderCnt," frames=").concat(s," skipDts=").concat(r.timeStamp)),this.framelist.shift(),this.timeline.setJumpTime(r.timeStamp-this.timeline.lastDts+1,!1),r.frame.close())}}else this.checkLatencyTs=0}}},{key:"setVieoCurrentDts",value:function(e){this.player.storeWorkerShared(y.StoreWorkerType.VIDEO_PTS,e.timeStamp),this.videoCurrentDts=e.timeStamp,this.player.decodeJitter.onRenderVideo(e.timeStamp)}},{key:"getAudioCurrentDts",value:function(){return self.mainSharedArrayBuffer?Atomics.load(self.mainSharedArrayBuffer,C.e.AUDIO_DTS):0}},{key:"rafHandler",value:function(e){var t=this.getAudioCurrentDts();this.curBitrate>=4e3&&this.throwFrame(t),this.renderVideo(t,e),this.lastRafNow=e}},{key:"getDecodedBuffer",value:function(){var e=this.getRenderBuffer();return this.player.storeWorkerShared(y.StoreWorkerType.VIDEO_NOT_RENDERD_BUFFER,e),e}},{key:"getRenderBuffer",value:function(){var e=0;return this.framelist.length>0&&(e=null==this.lastPic?0:this.framelist[this.framelist.length-1].timeStamp-this.lastPic.timeStamp),e}},{key:"throwFrame",value:function(e,t){var i=!1;if(0!=this.framelist.length)for(;!i&&this.framelist.length>=2;){if(!(e-this.framelist[0].timeStamp>=200)){i=!0;break}var s=this.framelist.shift();this.throwFps++,this.setVieoCurrentDts(s),this.player.storeWorkerShared(y.StoreWorkerType.VIDEO_THROW_FRAME_FPS,this.throwFps),s.frame.close()}}},{key:"getAudioDts",value:function(e){var t=l.default.getNow(),i=0;return 0!=this.lastRafNow&&(i=t-this.lastRafNow),0==e?this.currentDts=0:e!=this.lastCurrentAudioDts?this.currentDts=e:this.currentDts+=i,this.lastCurrentAudioDts=e,this.currentDts}},{key:"setJump",value:function(e){this.timeline.setJumpTime(e)}},{key:"getIsRender",value:function(e,t){var i=l.default.getNow(),s=!1;if(null==this.lastPic)s=!0,this.timeline.start(i,t.timeStamp);else if(this.player.latencyCfg.latencyMode)this.timeline.isDtsLess(i,t.timeStamp)&&(s=!0);else if(null!=this.lastPic&&0==e){this.lastPic.timeStamp,t.timeStamp;var r=i-this.startRenderTs,a=t.timeStamp-this.firstTimeStamp;r>=a&&(s=!0,r-a>100&&(this.startRenderTs=i,this.firstTimeStamp=t.timeStamp))}else 0!=e&&e>=t.timeStamp?s=!0:0!=e&&t.timeStamp;return s}},{key:"appendFrame",value:function(e){if(e.timeStamp<this.renderedFrameTs)return l.default.log("VideoRender.appendFrame, frame timeStamp too small and  drop frame,rendered frame ts="+this.renderedFrameTs+",now ts="+e.timeStamp),void this.closeVideoFrameInfo(e);this.framelist.push(e),this.framelist.sort((function(e,t){return e.timeStamp>t.timeStamp?1:-1}))}},{key:"updateCanvasRect",value:function(e,t){this.videoGlWrap.updateCanvasRect(e,t)}},{key:"updateRect",value:function(e,t){this.videoGlWrap.updateRect(e,t)}},{key:"getCurrentDts",value:function(){return this.videoCurrentDts}},{key:"setNoRender",value:function(){l.default.log("VideoRender.setNoRender"),this.noVideoRender=!0}},{key:"updateCurBitrate",value:function(e){this.curBitrate=e}},{key:"closeVideoFrameInfo",value:function(e){e.frame.close(),e=null}},{key:"setBrowserHidden",value:function(e){this.isBrowserHidden=e}},{key:"close",value:function(){var e=this;this.currentDts=0,this.lastCurrentAudioDts=0,this.framelist.map((function(t){e.closeVideoFrameInfo(t)})),this.lastPic=null,this.lastRafNow=0,this.renderFps=0,this.throwFps=0,this.videoCurrentDts=0,this.noVideoRender=!1,this.curBitrate=0,this.isTriggerPlay=!1,this.isBrowserHidden=!1,this.isPaused=!1}}]),e}(),I=function(){function e(t){p(this,e),this.player=t,this.audioDuration=0,this.framelist=[],this.ageneratorWriter=null,this.frameDuration=23,this.audioSampleRate=44100,this.isTriggerPlay=!1,this.lastRenderStamp=0,this.lastRenderNow=0,this.audioCurrentDts=0,this.renderNums=0,this.lastFrame=null,this.firstFrameRenderWriting=!1,this.firstFinshed=!1,this.startRenderTs=0,this.firstTimeStamp=0,this.totalLocalTime=0,this.decodeTotolTime=0,this.decodeTimeStamp=0,this.timeline=new E("audio_render")}return m(e,[{key:"setJump",value:function(e){this.timeline.setJumpTime(e)}},{key:"start",value:function(e){this.ageneratorWriter=e.getWriter()}},{key:"updateAACSampleRate",value:function(e){this.audioSampleRate=e,this.frameDuration=Math.floor(1024e3/e),l.default.log("AudioRender.updateAACSampleRate, frameDuration=",this.frameDuration)}},{key:"onQuickCheckTimer",value:function(e){if(this.player.latencyCfg.latencyMode&&this.player.latencyCfg.latencyMode.latencyBuf>0&&this.framelist.length>0){var t=this.framelist[0];this.timeline.start(e,t.timeStamp),this.player.setRenderAudioTs(e,this.timeline),v.a.printTorenderAudio&&l.default.log("AudioRender.toRender timeline dts=".concat(t.timeStamp," dtsNow=").concat(this.timeline.getDtsNow(e))),this.timeline.isDtsLess(e,t.timeStamp)&&(this.timeline.setLast(t.timeStamp,e),this.framelist.shift(),l.default.postMessage(y.ToMainMessageType.AUDIO_FRAME_DECODED,t))}if(this.ageneratorWriter&&this.framelist.length>0){var i=this.framelist[0],s=i.frame;this.getIsRender(i,e)&&(this.render(s,e,i),this.framelist.shift(),this.renderNums++,this.setAudioRenderNums(),this.lastRenderStamp=i.timeStamp,this.lastRenderNow=e,this.lastFrame=i,this.setAudioCurrentDts(i.timeStamp))}}},{key:"getIsRender",value:function(e){var t=l.default.getNow();if(null==this.lastFrame)return!0;var i=t-this.lastRenderNow,s=e.timeStamp-this.lastFrame.timeStamp;return t-this.startRenderTs>=e.timeStamp-this.firstTimeStamp||(i>2*this.frameDuration&&s>2*this.frameDuration?(this.startRenderTs=t,this.firstTimeStamp=e.timeStamp,!0):void 0)}},{key:"render",value:function(e,t,i){var s=this;return this.audioDuration+=e.duration/1e3,this.ageneratorWriter.ready.then((function(){return s.ageneratorWriter.write(e)})).then((function(){e.close(),s.isTriggerPlay||(s.isTriggerPlay=!0,l.default.postMessage(y.ToMainMessageType.AUDIO_PLAY),s.startRenderTs=t,s.firstTimeStamp=i.timeStamp)})).catch((function(t){console.error(t),e.close(),l.default.postMessage(y.ToMainMessageType.AUDIORENDERERROR)})),!0}},{key:"setAudioCurrentDts",value:function(e){this.audioCurrentDts=e,this.player.storeWorkerShared(y.StoreWorkerType.AUDIO_DTS,this.audioCurrentDts)}},{key:"getDecodedBuffer",value:function(){return 0==this.audioCurrentDts?0:this.decodeTimeStamp-this.audioCurrentDts}},{key:"setAudioRenderNums",value:function(){this.player.storeWorkerShared(y.StoreWorkerType.AUDIO_RENDER_NUMS,this.renderNums)}},{key:"getAudioCurrentDts",value:function(){var e=self.mainSharedArrayBuffer?Atomics.load(self.mainSharedArrayBuffer,y.MainSharedBufferType.AUDIO_DTS):0;return this.audioCurrentDts=e,this.audioCurrentDts}},{key:"onFrameDecoded",value:function(e){this.decodeTimeStamp=e.timeStamp,this.ageneratorWriter?this.appendFrame(e):this.sentAudioFrameData(e)}},{key:"sentAudioFrameData",value:function(e){if(-1!=e.frame.format.indexOf("32")){for(var t=e.frame.numberOfChannels,i=[],s=0;s<t;s++){var r=e.frame.allocationSize({planeIndex:s}),a=new ArrayBuffer(r);e.frame.copyTo(a,{planeIndex:s}),i.push(a)}var n=e.frame.allocationSize({planeIndex:0}),o=new ArrayBuffer(n);e.frame.copyTo(o,{planeIndex:0});var h={timeStamp:e.timeStamp,frameBuffer:o,frameBuffers:i,isEmptyAudioFrame:e.isEmptyAudioFrame,format:e.frame.format};this.player.latencyCfg.latencyMode&&this.player.latencyCfg.latencyMode.latencyBuf>0?this.framelist.push(h):(v.a.printTorenderAudio&&l.default.log("AudioRender.toRender rightnow dts="+h.timeStamp),l.default.postMessage(y.ToMainMessageType.AUDIO_FRAME_DECODED,h))}else l.default.postMessage(y.ToMainMessageType.AUDIO_FORMAT_ERROR)}},{key:"appendFrame",value:function(e){this.framelist.push(e)}},{key:"appendFrames",value:function(e){for(;e.length>0;)this.framelist.push(e.shift())}},{key:"close",value:function(){this.framelist.length=0,this.isTriggerPlay=!1,this.audioCurrentDts=0,this.renderNums=0,this.lastFrame=null,this.firstFrameRenderWriting=!1,this.firstFinshed=!1,this.startRenderTs=0,this.firstTimeStamp=0,this.decodeTimeStamp=0}}]),e}(),A=function(){function e(t){p(this,e),this._decodeHelper=t,this._decodeJitter=t.getDecodeJitter(),this._type="",this._initType(),this._timeline=new E(this._type+"_decode"),this._timelineSlow=new E(this._type+"_decode_slow"),this._state=R.FAST_DOING,this._fastBuf=0,this._waitKeyFrameTs=0,this._waitKeyFramePostTs=0}return m(e,[{key:"jitBuf",get:function(){return this._decodeJitter.player.latencyCfg.latencyBuf}},{key:"jitMin",get:function(){return this._decodeJitter.player.latencyCfg.latencyMin}},{key:"jitMax",get:function(){return this._decodeJitter.player.latencyCfg.latencyMax}},{key:"isNoGop",get:function(){return this._decodeJitter.player.latencyCfg.isNoGop}},{key:"_initType",value:function(){}},{key:"setFastEnding",value:function(){l.default.log("MediaDecodeHelper.setFastEnding type="+this._type),this._state=R.FAST_ENDING}},{key:"setNormal",value:function(){l.default.log("MediaDecodeHelper.setNormal type="+this._type),this._timelineSlow.reset(),this._state=R.NORMAL}},{key:"setSlow",value:function(){l.default.log("MediaDecodeHelper.setSlow type="+this._type),this._state=R.SLOW}},{key:"setWaitKeyFrame",value:function(){l.default.log("MediaDecodeHelper.setWaitKeyFrame type="+this._type),this._state=R.WAIT_KEY_FRAME,this._waitKeyFrameTs=l.default.getNow()}},{key:"isWaitForKeyFrame",value:function(){return this._state===R.WAIT_KEY_FRAME}},{key:"checkDecode",value:function(e){var t=this._getSamples();if(t.length>0){var i=t[0];this._timeline.start(e,i.timeStamp),this._state===R.FAST_DOING?this._decodeInFastDoing(e,i):this._state===R.FAST_ENDING?this._decodeInFastEnding(e,i):this._state===R.NORMAL?this._decodeInNormal(e,i):this._state===R.SLOW?this._decodeInSlow(e,i):this._state===R.WAIT_KEY_FRAME&&this._decodeInWaitKeyFrame(e,i)}}},{key:"_decodeInFastDoing",value:function(e,t){this._todecode(e,t)}},{key:"_decodeInFastEnding",value:function(e,t){}},{key:"_getWillDecodeBuffer",value:function(){var e=this._getSamples(),t=e.length,i=0,s=0;return t>0&&(i=e[t-1].timeStamp,s=this._timeline.lastDts),i-s}},{key:"_decodeInNormal",value:function(e,t){if(0===this.jitBuf)this._decode(e,t);else{var i=this._timeline.getDtsSlowTime(t.timeStamp,e);i>=500?(l.default.log("MediaDecodeHelper._decodeInNormal type=".concat(this._type," sample slow dtsSlowTime=").concat(i," dts=").concat(t.timeStamp," samples=").concat(this._getSamples().length)),this.setSlow(),this._timelineSlow.start(e,t.timeStamp),this._todecodeSlow(e,t)):0===this.jitBuf?this._decode(e,t):this._todecode(e,t)}}},{key:"_decodeInSlow",value:function(e,t){var i=this._getSamples(),s=this._findNextSample(e,i);if(-1!==s){var r=i[s],a=i[0],n=i[i.length-1];r.timeStamp-a.timeStamp<1e3&&this._decodeAllSlowSamples(e,i,s),l.default.log("MedisDecodeHelper._decodeInSlow type=".concat(this._type," done cur=").concat(r.timeStamp," first=").concat(a.timeStamp," last=").concat(n.timeStamp," lateBuf=").concat(r.timeStamp-a.timeStamp," buffer=").concat(n.timeStamp-r.timeStamp)),this._setSamples(i.slice(s)),this.setNormal()}else this._todecodeSlow(e,t)}},{key:"_decodeAllSlowSamples",value:function(e,t,i){}},{key:"_findNextSample",value:function(t,i){var s=i.length;if(s>0)for(var r=0;r<s;r++){var a=i[r];if((this._type!==e.Types.VIDEO||a.isKeyFrame)&&!this._timeline.isDtsLess(t,a.timeStamp))return r}return-1}},{key:"_findLastSample",value:function(t,i,s,r){var a=i.length;if(a>0)for(var n=i[a-1],o=a-1;o>=0;o--){var h=i[o];if(this._type!==e.Types.VIDEO||h.isKeyFrame){var u=n.timeStamp-h.timeStamp;if(s<=u&&u<=r&&!this._timeline.isDtsLess(t,h.timeStamp))return o}}return-1}},{key:"_decodeInWaitKeyFrame",value:function(e,t){(0===this._waitKeyFramePostTs||e-this._waitKeyFramePostTs>500)&&(this._waitKeyFramePostTs=e,l.default.postMessage(y.ToMainMessageType.WAIT_KEY_FRAME,e-this._waitKeyFrameTs))}},{key:"_todecode",value:function(e,t){this._timeline.isDtsLess(e,t.timeStamp)&&this._decode(e,t)}},{key:"_todecodeSlow",value:function(e,t){this._timelineSlow.isDtsLess(e,t.timeStamp)&&this._decode(e,t)}},{key:"_decode",value:function(e,t){}},{key:"_getSamples",value:function(){return[]}},{key:"_setSamples",value:function(e){}}]),e}(),R={FAST_DOING:1,FAST_ENDING:2,NORMAL:3,SLOW:4,WAIT_KEY_FRAME:5};A.Types={VIDEO:"video",AUDIO:"audio"};var k=A,b=function(e){n(i,e);var t=u(i);function i(e){return p(this,i),t.call(this,e)}return m(i,[{key:"_initType",value:function(){this._type=k.Types.VIDEO}},{key:"_getSamples",value:function(){return this._decodeJitter.videoSamples}},{key:"_setSamples",value:function(e){this._decodeJitter.videoSamples=e}},{key:"_decodeInFastEnding",value:function(e,t){var i=this._getWillDecodeBuffer();i<=this.jitBuf?(this._todecode(e,t),this.setNormal(),l.default.log("MediaDecodeHelper._decodeInFastEnding type=".concat(this._type," fastEnding to normal buffer=").concat(i))):this._lookupBuffer(e,t,i)}},{key:"_lookupBuffer",value:function(e,t,i){var s=this._getSamples(),r=this._findLastSample(e,s,this.jitMin,this.jitMax,!0);if(-1!==r){var a=s[r],n=s[s.length-1].timeStamp-a.timeStamp;if(n===this.jitBuf){var o=s[0];l.default.log("VideoDecodeHelper._lookupBuffer done firstDts=".concat(o.timeStamp," buffer=").concat(n)),this._setSamples(s.slice(r)),this._updateJump(e,o.timeStamp,a.timeStamp,i),this._decode(e,a)}else this._fixToJitBuf(e,s,r,i);this.setNormal()}else this._todecode(e,t)}},{key:"_fixToJitBuf",value:function(e,t,i,s){for(var r=t.length,a=t[0],n=t[i],o=t[r-1],h=o.timeStamp,u=r-1,d=i;d<r;d++){var c=t[d];if(0===this.jitBuf)this._decodeJitter._decodeVideoSample(c,e);else{if(o.timeStamp-c.timeStamp<=this.jitBuf){h=c.timeStamp,u=d;break}this._decodeJitter._decodeVideoSample(c,e)}}l.default.log("VideoDecoderHelper._fixToJitBuf fitBuf="+(h-n.timeStamp)),this._setSamples(0===this.jitBuf?[]:t.slice(u)),this._updateJump(e,a.timeStamp,h,s)}},{key:"_updateJump",value:function(e,t,i,s){var r=i-t;this._timeline.setJumpTime(r),this._timeline.setLast(i,e),this._decodeHelper.onVideoJump(e,{jumpTime:r}),this._fastBuf=this._getWillDecodeBuffer(),l.default.log("VideoDecodeHelper._updateJump jumpTime=".concat(r," jumpStartDts=").concat(t," endDts=").concat(i," before=").concat(s," after=").concat(this._fastBuf))}},{key:"_decodeAllSlowSamples",value:function(e,t,i){for(var s=0;s<i;s++){var r=t[s];this._decodeJitter._decodeVideoSample(r,e)}}},{key:"_decodeInWaitKeyFrame",value:function(e,t){r(c(i.prototype),"_decodeInWaitKeyFrame",this).call(this,e,t);var s=this._getSamples();if(t.isKeyFrame)this.setNormal();else{for(var a=s.length,n=-1,o=0;o<a;o++){var h=s[o];if(h.isKeyFrame){t=h,n=o;break}}-1!==n?(s=s.slice(n),this.setNormal()):(t=null,s=[]),this._setSamples(s)}}},{key:"_decode",value:function(e,t){this._timeline.setLast(t.timeStamp,e),this._decodeJitter._decodeVideoSample(t,e),this._decodeJitter.videoSamples.shift()}}]),i}(k),D=function(e){n(i,e);var t=u(i);function i(e){var s;return p(this,i),(s=t.call(this,e))._jumpEndDts=0,s}return m(i,[{key:"_initType",value:function(){this._type=k.Types.AUDIO}},{key:"_getSamples",value:function(){return this._decodeJitter.audioSamples}},{key:"_setSamples",value:function(e){this._decodeJitter.audioSamples=e}},{key:"setJump",value:function(e){this._timeline.setJumpTime(e),this._jumpEndDts=this._timeline.lastDts+e}},{key:"_decodeInFastEnding",value:function(e,t){if(this._jumpEndDts>0){var i=this._getSamples(),s=i.length;if(s>0){for(var r=i[0],a=i[s-1],n=-1,o=null,h=0;h<s;h++){var u=i[h];if(u.timeStamp>=this._jumpEndDts){n=h,o=u;break}}-1!==n&&(this._jumpEndDts=0,i=i.slice(n),l.default.log("AudioDecodeHelper._decodeInFastEnding done firstDts=".concat(r.timeStamp," endDts=").concat(o.timeStamp,"  lastDts=").concat(a.timeStamp," before=").concat(a.timeStamp-r.timeStamp," after=").concat(a.timeStamp-o.timeStamp," dropBuffer=").concat(o.timeStamp-r.timeStamp)),this._setSamples(i),this.setNormal())}}else this._todecode(e,t)}},{key:"_decodeAllSlowSamples",value:function(e,t,i){for(var s=0;s<i;s++){var r=t[s];this._decodeJitter._decodeAudioSample(r,e)}}},{key:"_decode",value:function(e,t){this._timeline.setLast(t.timeStamp,e),this._decodeJitter._decodeAudioSample(t,e),this._decodeJitter.audioSamples.shift()}}]),i}(k),O=function(){function e(t){p(this,e),this._decodeJitter=t,this._lastTodecodeDts=0,this._lastTodecodeTs=0,this._waitKeyFrameTs=0,this._waitKeyFramePostTs=0}return m(e,[{key:"checkDecode",value:function(e,t,i){var s=this._decodeJitter.videoSamples;if(this._waitKeyFrameTs>0)this._waitForKeyFrame(e,s);else if(s.length>0){var r=s[0];(i<2||e-this._lastTodecodeTs>=r.timeStamp-this._lastTodecodeDts)&&(s.shift(),this._lastTodecodeDts=r.timeStamp,this._lastTodecodeTs=e,v.a.printVideoDecodeFast&&l.default.log("VideoDecodeFastHelper.checkDecode dts=".concat(r.timeStamp," samples=").concat(s.length," videoDecodedFrames=").concat(t," queueSize=").concat(i)),this._decodeJitter._decodeVideoSample(r,l.default.getNow()))}}},{key:"_waitForKeyFrame",value:function(e,t){if((0===this._waitKeyFramePostTs||e-this._waitKeyFramePostTs>500)&&(this._waitKeyFramePostTs=e,l.default.postMessage(y.ToMainMessageType.WAIT_KEY_FRAME,e-this._waitKeyFrameTs)),t.length>0){for(var i=t.length,s=-1,r=0;r<i;r++)if(t[r].isKeyFrame){s=r;break}-1!==s?(t=t.slice(s),this._waitKeyFrameTs=0):t=[],this._decodeJitter.videoSamples=t}}},{key:"setWaitKeyFrame",value:function(){l.default.log("VideoDecodeFastHelper.setWaitKeyFrame"),this._waitKeyFrameTs=l.default.getNow()}},{key:"isWaitForKeyFrame",value:function(){return this._waitKeyFrameTs>0}}]),e}(),F=function(){function e(t){p(this,e),this._decodeJitter=t}return m(e,[{key:"checkDecode",value:function(e){var t=this._decodeJitter.audioSamples;if(t.length>0){var i=t.shift();this._decodeJitter._decodeAudioSample(i)}}}]),e}(),L=function(){function e(t){p(this,e),this._decodeJitter=t,this._videoHelper=new b(this),this._audioHelper=new D(this),this._videoFastHelper=new O(t),this._audioFastHelper=new F(t)}return m(e,[{key:"getDecodeJitter",value:function(){return this._decodeJitter}},{key:"decodeLowlatency",value:function(e,t){var i=l.default.getNow();this._decodeJitter.player.latencyCfg.fastMode?(this._videoFastHelper.checkDecode(i,e,t),this._audioFastHelper.checkDecode(i)):(this._videoHelper.checkDecode(i),this._audioHelper.checkDecode(i))}},{key:"onVideoJump",value:function(e,t){var i=t.jumpTime;this._audioHelper.setJump(i),this._decodeJitter.player.audioRender.setJump(i),this._decodeJitter.player.videoRender.setJump(i)}},{key:"fastAccessOver",value:function(){l.default.log("DecodeHelper.fastAccessOver"),this._videoHelper.setFastEnding(),this._audioHelper.setFastEnding()}},{key:"setNormal",value:function(){this._videoHelper.setNormal(),this._audioHelper.setNormal()}},{key:"updateSoftAcceleration",value:function(){this._videoHelper.setWaitKeyFrame(),this._videoFastHelper.setWaitKeyFrame()}},{key:"isWaitForKeyFrame",value:function(){return this._decodeJitter.player.latencyCfg.fastMode?this._videoFastHelper.isWaitForKeyFrame():this._videoHelper.isWaitForKeyFrame()}}]),e}(),B=function(){function e(t){p(this,e),this.player=t,this.videoSamples=[],this.audioSamples=[],this.audioFrameDecodedQueueLimit=10,this.lastDecodedVideoTimeStamp=0,this.lastToDecodAudioTimeStamp=0,this.lastJumpBufferAudioTimeStamp=0,this.videoFPS=0,this.noReferFps=0,this.discardVideoTSGap=60,this.decodeAudioQueueTime=1e3,this.decodeVideoQueueTime=100,this.discardFrameDecodeDelay=200,this.lastToDecodeTimeStamp=0,this.minBuffer=2e3,this.videoToDecodedLocalTime=0,this.firstVideoTs=0,this.videoToDecodedTime=0,this.isFirstAudioStamp=0,this.discardNums=0,this.lastVideoDiscardNums=0,this.JITTER_BUFLEN=0,this.JITTER_BUFMIN=0,this.JITTER_BUFMAX=0,this.JUMP_BUFFER=0,this.startPlayTime=0,this.isStartBuffer=!0,this.bufferCd=12e4,this.startCd=5e3,this.setVideoCurrentTime=0,this.startMoreBufferTime=0,this.bufferMoreContinueTime=6e4,this.isPauseVideoDecode=!1,this.isPauseAudioDecode=!1,this.isEnableDiscard=!1,this.isSoftWebcodecs=!1,this.decode10SecCostList=[],this.videoMaxCts=0,this.decodeVideoQueueTimeToCtsMaxGap=100,this.decodeVideoQueueTimeMax=350,this.outputFrameByPts=!1,this.decodeVideoQueueTimeDefault=100,this.recvMap=new Map,this.lastAppendVideoPts=0,this.firstVideoDts=0,this.fastDecodeTime=500,this.realFps=0,this.shieldAudioCfgBufLen=3e3,this._helper=new L(this)}return m(e,[{key:"fastOver",value:function(){this.player.latencyCfg.latencyMode&&this._helper.fastAccessOver()}},{key:"setJitter",value:function(e){this.JITTER_BUFLEN=e.bufLen,this.JITTER_BUFMIN=e.bufMin,this.JITTER_BUFMAX=e.bufMax,this.JUMP_BUFFER=e.jumpBuffer,this.shieldAudioCfgBufLen=e.shieldAudioCfgBufLen,l.default.log("WebCodecsWorkerPlayer.setJitter bufMin=".concat(e.bufMin," bufLen=").concat(e.bufLen," bufMax=").concat(e.bufMax," shieldAudioCfgBufLen=").concat(this.shieldAudioCfgBufLen))}},{key:"setVideoOutputByPts",value:function(e){this.outputFrameByPts=e,this.outputFrameByPts&&(this.decodeVideoQueueTime=this.decodeVideoQueueTimeDefault)}},{key:"updateVideoCts",value:function(e){!this.outputFrameByPts&&e>this.videoMaxCts&&(this.videoMaxCts=e,this.decodeVideoQueueTime=Math.max(this.decodeVideoQueueTime,this.videoMaxCts+this.decodeVideoQueueTimeToCtsMaxGap),this.decodeVideoQueueTime=Math.min(this.decodeVideoQueueTime,this.decodeVideoQueueTimeMax),l.default.log("WebCodecsWorkerPlayer.updateVideoCts videoMaxCts=".concat(this.videoMaxCts," decodeAudioQueueTime=").concat(this.decodeVideoQueueTime," ")))}},{key:"setStartPlayTime",value:function(e){this.startPlayTime=e}},{key:"setPlayMinBuffer",value:function(e){this.minBuffer=e}},{key:"decodeThread",value:function(e,t,i,s){if(this.player.latencyCfg.latencyMode)this._helper.decodeLowlatency(this.player.videoRender.framelist.length,s);else{this.newDiscardVideoFrame();var r=l.default.getNow();this.player.audioDecoderReadyed&&e<this.decodeAudioQueueTime&&this.audioSamples.length>0&&!this.isPauseAudioDecode&&this.decodeAudioSamples(),r-this.videoToDecodedTime>3e3&&0!=this.videoToDecodedTime&&(0==this.videoSamples.length?l.default.log("DecodeJitter.decodeThread videoSamplesLen = 0"):l.default.log("DecodeJitter.decodeThread videoFrameRenderBuffer = ".concat(t,", timeStamp=").concat(this.videoSamples[0].timeStamp,", lastToDecodAudioTimeStamp=").concat(this.lastToDecodAudioTimeStamp))),this.player.videoDecoderReadyed&&this.videoSamples.length>0&&!this.isPauseVideoDecode&&(this.decodeVideoSamples(t,r,i,s),this.jumpBuffers(i,r))}}},{key:"onCheckTimer",value:function(){this.checkTurnToSoft()}},{key:"checkTurnToSoft",value:function(){if(!this._helper.isWaitForKeyFrame()){var e=this.player.delayDecode;if(this.decode10SecCostList.length>=5&&this.decode10SecCostList.shift(),this.decode10SecCostList.push(e),!(this.decode10SecCostList.length<5)){var t=!0;this.decode10SecCostList.forEach((function(e){e<2e3&&(t=!1)})),this.isSoftWebcodecs?t&&this.player.turnToMse():t&&this.player.turnToWebcodecsSoft()}}}},{key:"decodeAudioSamples",value:function(){var e=this.audioSamples.shift();this._decodeAudioSample(e)}},{key:"_decodeAudioSample",value:function(e){this.lastToDecodAudioTimeStamp=e.timeStamp,this.player.toDecodeFrame(e)}},{key:"decodeVideoSamples",value:function(e,t,i,s){this.videoSamples[0].timeStamp;var r=this.decodeVideoQueueTime;this.lastToDecodAudioTimeStamp,this.player.getVideoCurrentDts();this.player.getAudioCurrentDts();var a=0;if(this.realFps>0&&(a=Math.floor(1e3/this.realFps)),e<r&&(s<2||(0!=a&&t-this.videoToDecodedTime)>=a)){var n=this.videoSamples.shift();this._decodeVideoSample(n,t)}}},{key:"_decodeVideoSample",value:function(e,t){this.lastToDecodeTimeStamp=e.timeStamp,this.player.toDecodeFrame(e),0==this.videoToDecodedLocalTime&&(this.videoToDecodedLocalTime=t),this.videoToDecodedTime=t}},{key:"updateAACSampleRate",value:function(e){this.audioSampleRate=e,this.frameDuration=1024e3/e,this.audioFrameDecodedQueueLimit=Math.ceil(this.decodeAudioQueueTime/this.frameDuration)}},{key:"getBufferLength",value:function(e){return this.lastAppendVideoPts>0?this.lastAppendVideoPts-e:0}},{key:"getWillDecodeVBuf",value:function(){return 0==this.videoSamples.length?0:1==this.videoSamples.length?33:this.videoSamples.length>1?this.videoSamples[this.videoSamples.length-1].timeStamp-this.videoSamples[0].timeStamp:0}},{key:"getAudioBufferLength",value:function(e){return 0==e?this.audioSamples.length>1?this.videoSamples[this.audioSamples.length-1].timeStamp-this.audioSamples[0].timeStamp:0:this.audioSamples.length>0?this.audioSamples[this.audioSamples.length-1].timeStamp-e:0}},{key:"jumpBuffers2",value:function(e,t){if(t-this.videoToDecodedLocalTime>5e3&&this.videoSamples.length>0&&this.audioSamples.length>0){var i=this.getBufferLength(e);i-this.minBuffer>200&&this.audioSamples[0].timeStamp-this.lastJumpBufferAudioTimeStamp>300&&(this.lastJumpBufferAudioTimeStamp=this.audioSamples[0].timeStamp,this.audioSamples.shift(),l.default.log("jump buffer drop audio frame ts ",this.lastJumpBufferAudioTimeStamp,"video buffer",i))}}},{key:"jumpBuffers",value:function(e,t){var i=t,s=this.getBufferLength(e),r=s-this.JITTER_BUFLEN,a=!1;if(self.mainSharedArrayBuffer&&(a=1==Atomics.load(self.mainSharedArrayBuffer,y.MainSharedBufferType.IS_SHIELD_AUDIO)),a){var n=(self.mainSharedArrayBuffer?Atomics.load(self.mainSharedArrayBuffer,y.MainSharedBufferType.FRAME_BUFFER_LEN):0)+s,o=this.JITTER_BUFLEN+this.shieldAudioCfgBufLen,h=this.JITTER_BUFLEN;if((r=n-o)<=0)return;if(s-r<h&&(r=s-h),r<0)return}if(!(i-this.startPlayTime<5e3))if(this.isStartBuffer&&i-this.startPlayTime>5e3)r>=this.JUMP_BUFFER&&this.setJumpBuffer(r,s,1,e,t,a),this.isStartBuffer=!1;else if(i-this.setVideoCurrentTime>=this.bufferCd||0==this.setVideoCurrentTime){if(i-this.startMoreBufferTime>=this.bufferMoreContinueTime&&0!=this.startMoreBufferTime)return this.setJumpBuffer(r,s,2,e,t,a),void(this.startMoreBufferTime=0);r>=this.JUMP_BUFFER?0==this.startMoreBufferTime&&(this.startMoreBufferTime=i):this.startMoreBufferTime=0}}},{key:"setJumpBuffer",value:function(e,t,i,s,r,a){if(0!=this.videoSamples.length&&0!=this.audioSamples.length){for(var n=-1,o=0,h=-1,u=0,d=Math.max(this.videoSamples[0].timeStamp,this.audioSamples[0].timeStamp),c=d+e,p=0,f=0,m=0;m<this.videoSamples.length;m++)if(-1==h&&this.videoSamples[m].timeStamp>=d&&(0==m||this.videoSamples[m-1].timeStamp<d)&&(h=m),this.videoSamples[m].isKeyFrame){if(!(this.videoSamples[m].timeStamp<=c))break;u=m}h>=0&&u>h&&(d=this.videoSamples[h].timeStamp,c=this.videoSamples[u].timeStamp);for(var _=0;_<this.audioSamples.length;_++)if(-1==n&&this.audioSamples[_].timeStamp>=d&&(0==_||this.audioSamples[_-1].timeStamp<d)&&(n=_),this.audioSamples[_].timeStamp>c){o=_;break}n>=0&&o>n&&(p=this.audioSamples[n].timeStamp,f=this.audioSamples[o].timeStamp),o-n<1||u-h<1?l.default.log("WebCodecs.DecodeJitter.jumpBuffers do not find suitable drop buffer","videoSamplesLen=".concat(this.videoSamples.length,", audioSamplesLen=").concat(this.audioSamples.length,", isShieldAudio=").concat(a)):(this.videoSamples.splice(h,u-h),this.audioSamples.splice(n,o-n),l.default.log("WebCodecs.DecodeJitter.setJumpBuffer, type=".concat(i,", currentTime=").concat(s,", aDrop=").concat(o-n,", vDrop=").concat(u-h,", 'jumpABuflen'=").concat(f-p,", 'jumpVbufLen'=").concat(c-d,", isShieldAudio=").concat(a)),this.setVideoCurrentTime=l.default.getNow())}}},{key:"discardDeltaVideoFrame",value:function(){if(this.isEnableDiscard&&0!=this.videoSamples.length){var e=this.player.getVideoCurrentDts(),t=this.player.getAudioCurrentDts(),i=this.getBufferLength(e),s=t-e;if(i<=1e3)return!1;var r=this.videoSamples[0],a=this.player.toDecodeVideoFps>=60?60:this.player.toDecodeVideoFps;if(0==a)return!1;var n=~~(1e3/a*3);n<=50&&(n=50);var o=0;return!(s<=100||(s<=200?(o=1,this.discardVideoTSGap=6*n):s<=500?(o=2,this.discardVideoTSGap=4*n):s<=1e3?(o=3,this.discardVideoTSGap=2*n):(o=4,this.discardVideoTSGap=n),!r.discardAllow||r.timeStamp-this.lastDiscardFrameTimeStamp<this.discardVideoTSGap||(this.lastDiscardFrameTimeStamp=r.timeStamp,this.videoSamples.shift(),this.discardNums++,this.player.storeWorkerShared(y.StoreWorkerType.VIDEO_DECODE_DISCARD_NUMS,this.discardNums),l.default.log("WebCodecs.DecodeJitter.discardDeltaVideoFrame discardNums=".concat(this.discardNums," dropLevel=").concat(o,", bufLen=").concat(i,", delta=").concat(s)),0)))}}},{key:"newDiscardVideoFrame",value:function(){return!!this.isEnableDiscard&&0!=this.videoSamples.length&&void(this.discardFrameByPending()||this.discardDeltaVideoFrame()||this.discardFrameByDecodeRate())}},{key:"discardFrameByPending",value:function(){var e=l.default.getNow();if(0!=this.setVideoCurrentTime&&e-this.setVideoCurrentTime<this.bufferCd)return!1;var t=this.player.toDecodeVideoFps>=60?60:this.player.toDecodeVideoFps,i=this.player.delayDecode,s=Number(t)*Number(i);if(0===t||0===i)return!1;var r=this.videoSamples[0],a=this.player.getVideoCurrentDts(),n=this.getWillDecodeVBuf(a),o=this.player.webcodecCfg,h=2e3,u=1e4,d=2e4;o&&o[5]&&o[5].length>=3&&(h=o[5][0],u=o[5][1],d=o[5][2]);var c=this.player.getAudioCurrentDts()-a;if(!(c<100)){var p=this.player.webcodecCfg[4]||1500,f=!1,m=0;if(n>=h&&n<=u)n-h>=Math.random()*h&&r.discardAllow&&s>=p&&(f=!0,m=1);else if(n>u&&n<=d)s>=p&&r.discardAllow&&(f=!0,m=2);else if(n>d&&s>=p)return m=3,this.discardPendingIframe(m,n,c),!0;var _=~~(1e3/t*3);return _<=50&&(_=50),!(r.timeStamp-this.lastDiscardFrameTimeStamp<_)&&(f&&(this.lastDiscardFrameTimeStamp=r.timeStamp,this.videoSamples.shift(),this.discardNums++,this.player.storeWorkerShared(y.StoreWorkerType.VIDEO_DECODE_DISCARD_NUMS,this.discardNums),l.default.log("WebCodecs.DecodeJitter.discardFrameByPending discardNums=".concat(this.discardNums," dropLevel=").concat(m,", bufLen=").concat(n))),f)}}},{key:"discardFrameByDecodeRate",value:function(){var e=this.player.getVideoCurrentDts(),t=!1;if(!(this.player.getAudioCurrentDts()-e<100)){var i=this.videoSamples[0];if(!i.discardAllow)return t;var s=this.player.toDecodeVideoFps>=60?60:this.player.toDecodeVideoFps,r=this.player.delayDecode;if(this.noReferFps<=0||s<=0||r<=0)return t;var a=Number(s)*Number(r),n=Number(this.noReferFps)*Number(r),o=(this.videoFPS-1e3/r)/this.noReferFps,h=this.player.webcodecCfg[4]||1500,u=0;a>=h&&(a<n+h?100*o>=100*Math.random()&&(t=!0,u=1):(t=!0,u=2));var d=~~(1e3/s*3);return d<=50&&(d=50),!(i.timeStamp-this.lastDiscardFrameTimeStamp<d)&&(t&&(this.lastDiscardFrameTimeStamp=i.timeStamp,this.videoSamples.shift(),this.discardNums++,this.player.storeWorkerShared(y.StoreWorkerType.VIDEO_DECODE_DISCARD_NUMS,this.discardNums),l.default.log("WebCodecs.DecodeJitter.discardFrameByDecodeRate discardNums=".concat(this.discardNums," dropLevel=").concat(u))),t)}}},{key:"discardPendingIframe",value:function(e,t,i){if(!(i<3e3)){var s=this.videoSamples,r=s.length;if(!(r<=0)){for(var a=-1,n=-1,o=0;o<r;o++){var h=s[o];if(-1!=a&&h.isKeyFrame){n=o-1;break}h.isKeyFrame&&(a=o+1)}a>=0&&n>=0&&a<n&&(this.videoSamples.splice(a,n-a),this.discardNums+=n-a,l.default.log("WebCodecs.DecodeJitter.discardFrameByPending discard=".concat(n-a,",start=").concat(a,",end=").concat(n,",dropLevel=").concat(e,",bufLen=").concat(t,"}")))}}}},{key:"appendVideoFrame",value:function(e){for(;e.length>0;){var t=e.shift();0===this.firstVideoDts&&(this.firstVideoDts=t.timeStamp),this.addRecv(t.timeStamp,t.compositionTime),v.a.printAppendVideo&&l.default.log("DecodeJitter.appendVideoFrame dts=".concat(t.timeStamp," samples=").concat(this.videoSamples.length)),this.videoSamples.push(t),this.player.latencyCfg.latencyMode||t.timeStamp-this.firstVideoDts<this.fastDecodeTime&&this.decodeVideoSamples(0,l.default.getNow(),0,0)}}},{key:"addRecv",value:function(e,t){var i=e+t;i>this.lastAppendVideoPts&&(this.lastAppendVideoPts=i)}},{key:"onRenderVideo",value:function(e){}},{key:"appendAudioFrame",value:function(e){for(;e.length>0;){var t=e.shift();0==this.isFirstAudioStamp&&(this.isFirstAudioStamp=t.timeStamp),v.a.printAppendAudio&&l.default.log("DecodeJitter.appendAudioFrame dts=".concat(t.timeStamp," samples=").concat(this.audioSamples.length)),this.audioSamples.push(t),this.player.latencyCfg.latencyMode||this.player.audioDecoderReadyed&&0!=this.isFirstAudioStamp&&t.timeStamp-this.isFirstAudioStamp<=500&&this.decodeAudioSamples()}}},{key:"updateVideoDecodedTimeStamp",value:function(e){this.lastDecodedVideoTimeStamp=e}},{key:"updateVideoFPS",value:function(e,t){this.videoFPS=e,this.noReferFps=t}},{key:"close",value:function(){this.player=null,this.videoSamples.length=0,this.videoSamples=null,this.audioSamples.length=0,this.lastAppendVideoPts=0,this.recvMap.clear(),this.videoToDecodedTime=0,this.isFirstAudioStamp=0,this.firstVideoDts=0,this.discardNums=0,this.startPlayTime=0,this.isStartBuffer=!0,this.setVideoCurrentTime=0,this.startMoreBufferTime=0,this.isPauseVideoDecode=!1,this.isPauseAudioDecode=!1,this.isEnableDiscard=!1,this.isSoftWebcodecs=!1,this.decode10SecCostList.length=0}},{key:"checkAVSync",value:function(){if(!(l.default.getNow()-this.startPlayTime<5e3)){var e=this.player.getVideoCurrentDts(),t=this.player.getAudioCurrentDts();if(!(e<=0||t<=0)){var i=t-e;i>=1e3&&i>=0||i<0&&i<=-1e3&&this.checkDiscardAudio(t,e)}}}},{key:"checkDiscardAudio",value:function(e,t){var i=this.getAudioBufferLength(e),s=i-this.JITTER_BUFLEN;if(!(l.default.log("DecodeJitter.checkDiscardAudio, bufLen=".concat(i,", audioCurrentDts=").concat(e,", videoCurrentDts=").concat(t,", minusBuffer=").concat(s,", delta=").concat(e-t)),i<=this.JITTER_BUFLEN||this.audioSamples.length<=1)){var r=this.audioSamples[0].timeStamp;if(!(0==t||t<r)){for(var a=r,n=0;this.audioSamples.length>0;){var o=this.audioSamples[0];if(!(o.timeStamp<t&&o.timeStamp-a<=s))break;this.audioSamples.shift(),n=o.timeStamp}n>0&&l.default.log("DecodeJitter.checkDiscardAudio, startTs=".concat(a,", endTs=").concat(n,", discardBuffer=").concat(n-a))}}}},{key:"checkDiscardVideo",value:function(e,t){var i=this.getBufferLength(t),s=i-this.JITTER_BUFLEN;if(l.default.log("DecodeJitter.checkDiscardVideo, bufLen=".concat(i,", audioCurrentDts=").concat(e,", videoCurrentDts=").concat(t,", minusBuffer=").concat(s,", delta=").concat(e-t)),!(i<=this.JITTER_BUFLEN)){var r=this.videoSamples.length;if(!(r<=1)){var a=this.videoSamples[0].timeStamp;if(!(0==e||e<a)){for(var n=a,o=0,h=0;h<r;h++){var u=this.videoSamples[h];if(!(u.timeStamp<e&&u.timeStamp-n<=s))break;u.discardAllow&&(this.videoSamples.shift(),o=u.timeStamp,r--)}o>0&&l.default.log("DecodeJitter.checkDiscardVideo, startTs=".concat(n,", endTs=").concat(o,", discardBuffer=").concat(o-n))}}}}},{key:"setPauseVideoDecode",value:function(e){this.isPauseVideoDecode=e.isPause}},{key:"setPauseAudioDecode",value:function(e){this.isPauseAudioDecode=e.isPause}},{key:"setEnableDiscard",value:function(e){this.isEnableDiscard=e.enableDiscard}},{key:"setUseSoftAcceleration",value:function(){this.isSoftWebcodecs=!0}},{key:"updateSoftAcceleration",value:function(){this.decode10SecCostList=[],this._helper.updateSoftAcceleration()}},{key:"getVideoDiscardNums",value:function(){var e=this.discardNums-this.lastVideoDiscardNums;return this.lastVideoDiscardNums=this.discardNums,e}},{key:"setRealFps",value:function(e){this.realFps=e}}]),e}(),N=function(){function e(){p(this,e),this._firstVideoRenderTs=0,this._firstVideoPts=0,this._firstAudioRenderTs=0,this._firstAudioPts=0,this._syncDone=!1,this._openSync=!1}return m(e,[{key:"reset",value:function(){this._firstVideoRenderTs=0,this._firstVideoPts=0,this._firstAudioRenderTs=0,this._firstAudioPts=0,this._syncDone=!1}},{key:"openSync",set:function(e){this._openSync=e}},{key:"setRenderVideoTs",value:function(e){0===this._firstVideoRenderTs&&(this._firstVideoRenderTs=e)}},{key:"setRenderAudioTs",value:function(e,t,i){if(0===this._firstAudioRenderTs&&(this._firstAudioRenderTs=e),this._openSync&&!this._syncDone&&this._firstAudioRenderTs>0&&this._firstVideoRenderTs>0&&this._firstVideoPts>0&&this._firstAudioPts>0){this._syncDone=!0;var s=this._firstVideoPts-this._firstAudioPts;l.default.log("AVRenderSync.syncAudio render done delta="+s),t.setJumpTime(s),i.setJumpTime(s)}}},{key:"setVideoPts",value:function(e){0===this._firstVideoPts&&(this._firstVideoPts=e)}},{key:"setAudioPts",value:function(e){0===this._firstAudioPts&&(this._firstAudioPts=e)}}]),e}(),M=function(){function e(){p(this,e),this.openRenderSync=!1,this.latencyBuf=2500,this.latencyMin=3e3,this.latencyMax=3500,this.skipFrameGap=5,this.isNoGop=!1,this.fastMode=!1,this.latencyMode=!1}return m(e,[{key:"initConfig",value:function(e){this.latencyMode=!1,e&&(e.hasOwnProperty("openRenderSync")&&(this.openRenderSync=e.openRenderSync),e.hasOwnProperty("lowlatencyBuf")&&(this.latencyBuf=e.lowlatencyBuf,this.latencyMode=-1!==this.latencyBuf),e.hasOwnProperty("lowlatencyMin")&&(this.latencyMin=e.lowlatencyMin),e.hasOwnProperty("lowlatencyMax")&&(this.latencyMax=e.lowlatencyMax),e.hasOwnProperty("isNoGop")&&(this.isNoGop=e.isNoGop),e.hasOwnProperty("fastMode")&&(this.fastMode=e.fastMode),e.hasOwnProperty("skipFrameGap")&&(this.skipFrameGap=e.skipFrameGap))}}]),e}();t.default=function(){function e(){p(this,e),this.videoDecoder=new T(this),this.audioDecoder=new P(this),this.videoRender=new w(this),this.audioRender=new I(this),this.decodeJitter=new B(this),this.audioDecodedFrames=[],this.audioRenderStarted=!1,this.audioStartRenderFrameTimeLen=500,this.oneSecNow=0,this.frameDuration=0,this.startAppendAudioTime=0,this.isFirstPostAudio=!1,this.quickTimerInterval=null,this.onQuickCheckTimerBind=this.onQuickCheckTimer.bind(this),this.videoFrameStampMap=new Map,this.delayDecode=0,this.toDecodeVideoFps=0,this.userPaused=!1,this.webcodecCfg={},this.latencyCfg=new M,this.videoDecodeCostErrCnt=0,this.printCnt=0,this.avRenderSync=new N,this.isBrowserHidden=!1}return m(e,[{key:"audioDecoderReadyed",get:function(){return this.audioDecoder&&this.audioDecoder.configured}},{key:"videoDecoderReadyed",get:function(){return this.videoDecoder&&this.videoDecoder.configured}},{key:"setVideoOutputByPts",value:function(e){this.decodeJitter.setVideoOutputByPts(e)}},{key:"initWebcodecCfg",value:function(e,t){e&&(this.webcodecCfg=e),this.latencyCfg.initConfig(t),this.avRenderSync.openSync=this.latencyCfg.openRenderSync,0===this.latencyCfg.latencyBuf&&this.decodeJitter._helper.setNormal()}},{key:"startVideoRender",value:function(e,t){var i=e.width,s=e.height,r=e.agenerator,a=l.default.getNow();this.videoRender.start(i,s,r,t),clearInterval(this.quickTimerInterval),this.quickTimerInterval=setInterval(this.onQuickCheckTimerBind,4),this.decodeJitter.setStartPlayTime(a)}},{key:"startAudioRender",value:function(e){this.audioRender.start(e)}},{key:"onQuickCheckTimer",value:function(){l.default.postMessage(y.ToMainMessageType.INTERVAL);var e=!1;self.mainSharedArrayBuffer&&(e=1==Atomics.load(self.mainSharedArrayBuffer,C.a.PAUSE_STATUS),this.userPaused=e);var t=l.default.getNow();if(!this.userPaused){var i=this.getAudioDecodedBuffer(),s=this.videoRender.getDecodedBuffer(),r=this.getVideoCurrentDts();this.decodeJitter.decodeThread(i,s,r,this.videoDecoder.decoder.decodeQueueSize),this.audioRender.onQuickCheckTimer(t),this.videoRender.rafHandler(t)}0===this.oneSecNow?this.oneSecNow=t:t-this.oneSecNow>=1e3&&(this.onCheckTimer(t),this.oneSecNow=t),this.storeWorkerShared(y.StoreWorkerType.VIDEO_BUFFER_LEN,this.getBufferLen())}},{key:"onCheckTimer",value:function(e){if(this.decodeJitter.onCheckTimer(e),l.default.logArr.length>0&&(l.default.postMessage(y.ToMainMessageType.LOG,l.default.logArr),l.default.logArr.length=0),this.statEverySec(e),self.mainSharedArrayBuffer){var t=Atomics.load(self.mainSharedArrayBuffer,C.a.VIDEO_REAL_FPS);this.decodeJitter.setRealFps(t)}this.videoRender.onCheckTimer(e)}},{key:"getAudioDecodedBuffer",value:function(){return this.audioRender.getDecodedBuffer()}},{key:"statEverySec",value:function(){var e=this.videoDecoder.getDecodeDelay(),t=0,i=0,s=-1;e.map((function(e){t+=e})),t>0&&(s=i=~~(t/e.length)),this.delayDecode=i,s>-1&&s<15?this.videoDecodeCostErrCnt++:this.videoDecodeCostErrCnt=0;var r=this.videoDecoder.getDecodeFps();this.toDecodeVideoFps=r.toDecodeFps,this.storeWorkerShared(y.StoreWorkerType.VIDEO_DECODED_DELAY,i),this.storeWorkerShared(y.StoreWorkerType.VIDEO_READY_TO_RENDER_LIST_LEN,this.videoRender.framelist.length),this.videoDecodeCostErrCnt,this.videoDecoder.isOutputFrameByDts()&&"265"==this.videoDecoder.codecType&&this.handlerError(y.ToMainMessageType.DECODE_DTS)}},{key:"storeWorkerShared",value:function(e,t){self.mainSharedArrayBuffer&&Atomics.store(self.mainSharedArrayBuffer,e,t)}},{key:"updateRect",value:function(e,t){this.videoRender.updateRect(e,t)}},{key:"updateAVCConfig",value:function(e){this.isRenderStart||(this.isRenderStart=!0),this.videoDecoder.updateAVCConfig(e.sps,e.pps,e.vps,e.codec,e.width,e.height)}},{key:"updateAudioConfig",value:function(e,t,i,s){this.audioDecoder.updateAudioConfig(e,t,i,s),this.decodeJitter.updateAACSampleRate(t),this.audioRender.updateAACSampleRate(t),this.updateAACSampleRate(t)}},{key:"updateAVCPPS",value:function(e,t){}},{key:"updateAVCSPS",value:function(e,t){}},{key:"updateAVCVPS",value:function(e,t){}},{key:"toDecodeFrame",value:function(e){e.type==_.AUIDO?(this.avRenderSync.setAudioPts(e.timeStamp),this.lastToDecodeAudioTs=e.timeStamp,this.audioDecoder.decodeFrame(e)):e.type==_.VIDEO&&(this.avRenderSync.setVideoPts(e.timeStamp+e.compositionTime||0),this.lastToDecodeVideoTs=e.timeStamp,this.toDecodeVideoFrameNums++,this.videoDecoder.decodeFrame(e))}},{key:"onFrameDecoded",value:function(e){if(e.type==h.VIDEO){this.decodedVideoFrameNums++,this.decodeJitter.updateVideoDecodedTimeStamp(e.frame.timestamp),0==this.firstPerformentTime&&(this.firstPerformentTime=l.default.getNow()),e.noRenderCount=0;var t=e.timeStamp,i=this.videoFrameStampMap.get(t);void 0!==i&&(e.timeStamp+=i,this.videoFrameStampMap.delete(t)),this.videoRender.appendFrame(e)}else e.type==h.AUIDO&&this.audioRender.onFrameDecoded(e)}},{key:"setRenderAudioTs",value:function(e,t){this.avRenderSync.setRenderAudioTs(e,t,this.decodeJitter._helper._audioHelper._timeline)}},{key:"appendAudioFrame",value:function(e){0==this.startAppendAudioTime&&(this.startAppendAudioTime=l.default.getNow()),this.decodeJitter.appendAudioFrame(e)}},{key:"appendVideoFrame",value:function(e){var t=this;e.map((function(e){t.videoFrameStampMap.set(e.timeStamp,e.compositionTime),t.decodeJitter.updateVideoCts(e.compositionTime)})),this.decodeJitter.appendVideoFrame(e)}},{key:"fastOver",value:function(){this.decodeJitter.fastOver()}},{key:"updateAACSampleRate",value:function(e){this.frameDuration=1024e3/e}},{key:"updateVideoFPS",value:function(e,t){this.decodeJitter.updateVideoFPS(e,t)}},{key:"setPlayMinBuffer",value:function(e){this.decodeJitter.updateVideoFPS(e)}},{key:"setJitter",value:function(e){this.decodeJitter.setJitter(e)}},{key:"handlerError",value:function(e,t){l.default.postMessage(e,t)}},{key:"getBufferLen",value:function(){return this.decodeJitter?this.decodeJitter.getBufferLength(this.videoRender.getCurrentDts()):0}},{key:"getAudioCurrentDts",value:function(){return this.audioRender.getAudioCurrentDts()}},{key:"getVideoCurrentDts",value:function(){return this.videoRender.getCurrentDts()}},{key:"setUseSoftAcceleration",value:function(){l.default.log("WebCodecsWorkerPlayer.setUseSoftAcceleration"),this.videoDecoder.setUseSoftAcceleration(),this.decodeJitter.setUseSoftAcceleration()}},{key:"updateSoftAcceleration",value:function(){l.default.log("WebCodecsWorkerPlayer.updateSoftAcceleration"),this.setUseSoftAcceleration(),this.videoDecoder.resetDecoder(),this.decodeJitter.updateSoftAcceleration()}},{key:"setLocalConfig",value:function(e){1==e._webcodecsNoRenderVideo&&this.videoRender.setNoRender(),1==e._useSoftAcceleration&&this.setUseSoftAcceleration()}},{key:"setPauseVideoDecode",value:function(e){this.decodeJitter.setPauseVideoDecode(e)}},{key:"setPauseAudioDecode",value:function(e){this.decodeJitter.setPauseAudioDecode(e)}},{key:"setEnableDiscard",value:function(e){this.decodeJitter.setEnableDiscard(e)}},{key:"turnToWebcodecsSoft",value:function(){console.log("this.videoDecoder.codecTyp",this.videoDecoder.codecType),"265"==this.videoDecoder.codecType?l.default.postMessage(y.ToMainMessageType.SOFT_TURN_TO_MSE):l.default.postMessage(y.ToMainMessageType.TURN_TO_WEBCODECS_SOFT)}},{key:"turnToMse",value:function(){l.default.postMessage(y.ToMainMessageType.SOFT_TURN_TO_MSE)}},{key:"updateCurBitrate",value:function(e){this.videoRender.updateCurBitrate(e)}},{key:"setRealFps",value:function(e){this.decodeJitter.setRealFps(e)}},{key:"setBrowserHidden",value:function(e){this.isBrowserHidden=e,this.videoRender.setBrowserHidden(e)}},{key:"destroy",value:function(){l.default.log("WebCodecsWorkerPlayer.destroy"),this.destroyed=!0,this.videoDecoder.close(),this.videoDecoder=null,this.audioDecoder.close(),this.audioDecoder=null,this.decodeJitter.close(),this.decodeJitter=null,this.videoRender.close(),this.videoRender=null,this.startAudioFastTs=0,this.startVideoFastTs=0,this.oneSecNow=0,this.startAppendAudioTime=0,this.isFirstPostAudio=!1,clearInterval(this.quickTimerInterval),this.quickTimerInterval=null,this.videoFrameStampMap=null,this.delayDecode=0,this.toDecodeVideoFps=0,this.userPaused=!1,this.isBrowserHidden=!1}}]),e}()}])},"9P+k":function(e,t,i){},CvKd:function(e,t,i){"use strict";i.r(t);i("9P+k");var s=i("nfRe"),r=i.n(s);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var n={storeDns:function(e){for(var t="",i=this.getIpsKey(!0),s=e.join("|").toLocaleLowerCase(),r=0,a=s.length;r<a;r++){var n=i[s.charAt(r)],o=Math.random()*n.length>>0;t+=n.charAt(o)}localStorage.wssdns=t},getDns:function(){var e=localStorage.wssdns;if(!e)return[];for(var t="",i=this.getIpsKey(!1),s=0,r=e.length;s<r;s++){t+=i[e.charAt(s)]}return t.split("|")},storeIps:function(e){for(var t="",i=this.getIpsKey(!0),s=e.join("|").toLocaleLowerCase(),r=0,a=s.length;r<a;r++){var n=i[s.charAt(r)],o=Math.random()*n.length>>0;t+=n.charAt(o)}localStorage.wssips=t},getIps:function(){var e=localStorage.wssips;if(!e)return[];for(var t="",i=this.getIpsKey(!1),s=0,r=e.length;s<r;s++){t+=i[e.charAt(s)]}return t.split("|")},getIpsKey:function(e){for(var t=["-",".",":","|"],i="_N1Y%/ny^6?Mi7|wCe#$VmT=.GBut]3L*f<acX2Eop>d}WqKPQ@r;zx!s`(:IHFRZ~[A{Jb-O&D)v0Ukj95,8lg+h4S",s={},r=0;r<40;r++){var a=r<11?3:2,n=i.substr(0,a);i=i.substr(a);var o=r+"";if(r>13?o=String.fromCharCode(r+83):r>9&&(o=t[r-10]),e)s[o]=n;else for(var h=0;h<n.length;h++){s[n.charAt(h)]=o}}return s},compareVersion:function(e,t){for(var i=(e+"").split("."),s=(t+"").split("."),r=i.length,a=s.length,n=Math.min(i.length,s.length),o=0;o<n;o++){var h=parseInt(i[o]),u=parseInt(s[o]);if(h!=u)return h-u}return r==a?0:r-a},deepCopy:function(e,t){t=t||{};for(var i in e)null!=e[i]&&"object"==a(e[i])?(t[i]=e[i].constructor===Array?[]:{},this.deepCopy(e[i],t[i])):t[i]=e[i];return t},NoDrag:function(e,t){t.ondragstart=function(){return!1}},NoSelect:function(e,t){t.onselectstart=function(){return!1}},setCookie:function(e,t,i,s){var r=new Date;r.setTime(r.getTime()+24*i*60*60*1e3);var a=e+"="+t+"; "+("expires="+r.toUTCString());s&&(a+="; domain="+s),document.cookie=a},getCookie:function(e){for(var t=e+"=",i=document.cookie.split(";"),s=0,r=i.length;s<r;s++){var a=i[s].trim();if(0==a.indexOf(t))return a.substr(t.length)}return""},clearCookie:function(e){setCookie(e,"",-1)},getQueryString:function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),i=window.location.search.substr(1).match(t);return null!=i?unescape(i[2]):null},getPos:function(e){var t=document.documentElement.scrollTop||document.body.scrollTop,i=document.documentElement.scrollLeft||document.body.scrollLeft,s=e.getBoundingClientRect();return{top:s.top+t,left:s.left+i,right:s.right+i,bottom:s.bottom+t}},parseQueryString:function(e){for(var t=/([^\?\=\&]+)\=([^\?\=\&]*)/g,i={};t.exec(e);)i[RegExp.$1]=RegExp.$2;return i},getStringLength:function(e){for(var t=0,i=e,s=/[^\x00-\xff]/,r=0;r<i.length;r++){var a=i.charAt(r);1==s.test(a)?t+=2:t+=1}return t=Math.ceil(t/2)},unescapeHTML:function(e){return(e=""+e).replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&apos;/g,"'")},objectIsEmpty:function(e){return 0===Object.keys(e).length},padNum:function(e,t){var i=e.toString().length;return"0".repeat(t-i)+e},getDateTimeStr:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:NaN,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=null,s=(i=e?new Date(e):new Date).getFullYear(),r=n.padNum(i.getMonth()+1,2),a=n.padNum(i.getDate(),2),o=n.padNum(i.getHours(),2),h=n.padNum(i.getMinutes(),2),u=n.padNum(i.getSeconds(),2),l="".concat(s,"-").concat(r,"-").concat(a," ").concat(o,":").concat(h,":").concat(u);if(t){var d=n.padNum(i.getMilliseconds(),3);l+="."+d}return l}},o=n,u={ISDEBUG:!1,config:{},VER:"0000",pid:0};u.yyuid=parseInt(o.getCookie("yyuid"))||parseInt(o.getCookie("udb_uid"))||0,u.anonymousUid=0,u.isLogin=u.yyuid>0,u.showDanmu=!1,u.streamInfo=null,u.appid=0,u.topsid=0,u.subsid=0,u.profileRoom=0,u.gameId=0,u.hasVideo=!0,u.isPlaying=!1,u.isPause=!1,u.shortlink2room=0,u.H5ROOT="",u.flv="",u.videoData=null,u.pidList="",u.isCsdnTokenTimeout=!1,u.slidesKey="",u.iLineIndex=1,u.isShowLoading=!1,u.codeRate=0,u.curRate=0,u.sCdnType="",u.userId=null,u.isHttps=function(){return-1!=window.location.href.indexOf("https")},u.h5player=null,u.browerPause=!1,u.beginTime=0,u.wsConnectTime=0,u.reConnectTimes=0,u.wsIps=[],u.httpWs=[],u.badWsIps=[],u.badCode=[],u.wsconnected=!1,u.danmuStatus=0,u.domain_list=[],u.from="",u.arrEmoji=["/{dx","/{pz","/{fn","/{tp","/{jy","/{ot","/{ng","/{hk","/{kz","/{wx","/{se","/{tx","/{lh","/{hp","/{am","/{kun","/{by","/{ka","/{cy","/{kx","/{ll","/{fd","/{yw","/{xu","/{yun","/{zs","/{88","/{qd","/{kl","/{dy","/{hx","/{bz","/{yb","/{dai","/{sj","/{zt","/{gz","/{qq","/{kb","/{wq","/{yx","/{kel","/{bs","/{zk","/{bq","/{ok","/{zan","/{ruo","/{ws","/{sl","/{mg","/{kw","/{wen","/{xd","/{xs","/{lw","/{sd","/{zd","/{dao","/{cc","/{dk","/{hh","/{66","/{jx","/{pu","/{zc","/{fe","/{xk","/{bk","/{hq","/{gl","/{cl","/{sh","/{gd","/{xh","/{sq","/{dg","&#x221C1;","&#x1F601;"],u.regEmoji=new RegExp(u.arrEmoji.join("|"),"g"),u.playerConfig={};var l=u,d={},c=null,p={},f={addEvent:function(e,t){return void 0===d[e]&&(d[e]=[]),"function"==typeof t&&d[e].push(t),this},removeEvent:function(e,t){if(null!=e&&e===c)return void 0===p[e]&&(p[e]=[]),p[e].push(t),this;var i=d[e];if("string"==typeof e&&i instanceof Array)if("function"==typeof t){for(var s=0,r=i.length;s<r;s++)if(i[s]===t){i.splice(s,1);break}0==i.length&&delete d[e]}else null==t&&delete d[e];return this},fireEvent:function(e,t){c=e;var i=d[e];if(i instanceof Array)for(var s=0,r=i.length;s<r;s++)"function"==typeof i[s]&&i[s](t);if(c=null,(i=p[e])instanceof Array){for(s=0,r=i.length;s<r;s++)this.removeEvent(e,i[s]);delete p[e]}return this},VIDEO_PLAY:"VIDEO_PLAY",VIDEO_PAUSE:"VIDEO_PAUSE",VIDEO_REFRESH:"VIDEO_REFRESH",SHOW_PLAY_TIPS:"SHOW_PLAY_TIPS",SHOW_BROWER_PAUSE_TIPS:"SHOW_BROWER_PAUSE_TIPS",VIDEO_VOLUME:"VIDEO_VOLUME",SET_BITRATE_LIST:"SET_BITRATE_LIST",SET_BITRATE:"SET_BITRATE",HIDE_BITRATE:"HIDE_BITRATE",SWITCH_BITRATE:"SWITCH_BITRAT",SHOW_LOADING:"SHOW_LOADING",HIDE_LOADING:"HIDE_LOADING",HUYA_REPORT:"HUYA_REPORT",PAUSE_VIDEO:"PAUSE_VIDEO",PLAY_VIDEO:"PLAY_VIDEO",SHOW_OR_HIDE_PLAY_STOP_BTN:"SHOW_OR_HIDE_PLAY_STOP_BTN",WEBSOCKET_CONNECTED:"WEBSOCKET_CONNECTED",SERVICE_STOP_VIDEO:"SERVICE_STOP_VIDEO",PLAY_TIPS:"PLAY_TIPS",USER_INFO_INITED:"USER_INFO_INITED",SHOW_COMMON_TOAST:"SHOW_COMMON_TOAST",DATA_METRIC2:"DATA_METRIC2",NEW_VIDEO:"NEW_VIDEO"},m=i("EO7y"),_=i.n(m),y=i("Qy2/"),v=i.n(y),S=1==localStorage.log?0:4,g=!0;//!!Number(localStorage._printLogTime);
function T(){return o.getDateTimeStr()+""}var P,E={_data:[],_length:0,_printAudioFrame:!!Number(localStorage._printAudioFrame),_printVideoFrame:!!Number(localStorage._printVideoFrame),getLogTimeState:function(){return g},setLogTimeState:function(e){g!=!!e&&(E.log("setLogTimeState to "+!!e),g=!!e)},debug:function(){var e=T(),t=Array.apply(null,arguments);S<=-1&&(g&&(t[0]=e+" "+t[0]),console.log.apply(console,t))},log:function(e){var t=T(),i=Array.apply(null,arguments);S<=0&&(g&&(i[0]=t+" "+i[0]),console.log.apply(console,i)),E.record(t,i,"log")},info:function(e){var t=T(),i=Array.apply(null,arguments);S<=1&&(g&&(i[0]=t+" "+i[0]),console.info.apply(console,i)),E.record(t,i,"info")},warn:function(e){var t=T(),i=Array.apply(null,arguments);S<=2&&(g&&(i[0]=t+" "+i[0]),console.warn.apply(console,i)),E.record(t,i,"warn")},error:function(e){var t=T(),i=Array.apply(null,arguments);S<=3&&(g&&(i[0]=t+" "+i[0]),console.error.apply(console,i)),E.record(t,i,"error")},group:function(e){var t=T(),i=Array.apply(null,arguments);if(S<=1){g&&(i[0]=t+" "+i[0]);var s=console.groupCollapsed||console.group||console.log;s.apply(console,i)}E.record(t,i,"group")},groupEnd:function(){console.groupEnd&&console.groupEnd.apply(console)},setLevel:function(e){e!=S&&(console.log(T()+" set log level from "+S+" to "+e),S=e)},getLevel:function(){return S},logcss:function(e){return"color:"+e+";font-weight:900"},record:function(e,t,i){}},C=E,w=!1,I="//live.huya.com/briefs/liverecommend?appid=16&gid=1&uid=0&callback=?";function A(){I=l.ISDEBUG?"//test.briefsapi.huya.com/briefs/liverecommend?appid=9&gid=".concat(l.gameId,"&uid=0&callback=?"):"//live.huya.com/briefs/liverecommend?appid=16&gid=".concat(l.gameId,"&uid=0&callback=?"),$.getJSON(I,(function(e){var t=JSON.parse(e.data);C.log("<=== RecommendList",t);for(var i=[],s=t.liveList.length>3?3:t.liveList.length,r=0;r<s;r++){var a=t.liveList[r];a.privateHost||(a.privateHost=""),i.push(a)}$(_()()).appendTo("#player-recommend-wrap");for(var n=$("#player-recommend ul"),o=0,h=i;o<h.length;o++){var u=h[o],d=u.yyid,c=u.profileRoom,p=u.privateHost,f=u.screenshot,m=u.intro,y=u.avatar,S=u.nick,g=u.totalCount,T=u.gameName,P=v()({yyid:d,profileRoom:c,privateHost:p,screenshot:f,intro:m,avatar:y,nick:S,totalCount:g,gameName:T});n.append($(P))}$(".player-recommend-vbox").click(b),k(),$(window).resize(R),function(){$("#player-recommend-bg");var e=l.config.avatarImg;l.config&&l.config.avatarImg&&(e=l.config.avatarImg,$("#player-recommend-bg").attr("src",e))}()}))}function R(){clearTimeout(P),P=setTimeout(k,100)}function k(){var e=$("#player-recommend").width(),t=$("#player-recommend").height(),i=(e-20)/280>>0,s=$(".player-recommend-container");i=Math.min(3,Math.max(0,i)),s.width(300*i+38),s.height(250),s.css({left:e-s.width()-20>>1,top:t-s.height()>>1})}function b(e){f.fireEvent(f.HUYA_REPORT,{name:"click/zhibo/jieshutuijian"});var t=e.currentTarget.parentNode,i=$(t).attr("yyid"),s=$(t).attr("profileRoom"),r=$(t).attr("privateHost");C.log(l.ISDEBUG,s,r);var a=location.protocol+"//"+location.host+"/yy/"+i;r?a=location.protocol+"//"+location.host+"/"+r:s&&(a=location.protocol+"//"+location.host+"/"+s),location.href=a}var D={isShow:w,show:function(){w||(w=!0,I=(I=I.replace(/gid=(.+?)&/,"gid="+(l.config.gameId||1)+"&")).replace(/uid=(.+?)&/,"uid="+l.pid+"&"),A(),f.fireEvent(f.SHOW_OR_HIDE_PLAY_STOP_BTN,!1))},hide:function(){f.fireEvent(f.SHOW_OR_HIDE_PLAY_STOP_BTN,!0),w=!1,$(".player-recommend-vbox").unbind("click"),$(window).unbind("resize",R),$("#player-recommend").remove()}};i("91eE");function O(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=function(e,t){if(!e)return;if("string"==typeof e)return F(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return F(e,t)}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var s=0,r=function(){};return{s:r,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,n=!0,o=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return n=e.done,e},e:function(e){o=!0,a=e},f:function(){try{n||null==i.return||i.return()}finally{if(o)throw a}}}}function F(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,s=new Array(t);i<t;i++)s[i]=e[i];return s}function L(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var B=function(){function e(t){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.vplayer=t,this.isRefreshing=!1,this.lastRefreshTime=0,this.refreshChannel=0,this.tokenTimeId=0,this.tryPlay=!0,this.isVideoLoad=!1,this.isFirstPlay=!0,this.container=$("#player-video"),this.cacheMetric2=[],this.volume=0,this.curVideoWidth=0,this.curVideoHeight=0,f.addEvent(f.VIDEO_PLAY,this.play.bind(this)),f.addEvent(f.VIDEO_PAUSE,this.pause.bind(this)),f.addEvent(f.VIDEO_REFRESH,this.refresh.bind(this)),f.addEvent(f.VIDEO_VOLUME,this.setVolume.bind(this)),f.addEvent(f.SERVICE_STOP_VIDEO,this.stop.bind(this)),f.addEvent(f.WEBSOCKET_CONNECTED,this.onWebsocketInited.bind(this)),$("#player-wrap").resize((function(){return i.resize()}))}var t,i,s;return t=e,(i=[{key:"initH5player",value:function(){var e=this;l.h5player=this.h5player=new window.H5Player,this.h5player.setIDs(l.appid,l.topsid,l.subsid,l.yyuid);var t=parseInt(localStorage.sdkLogLevel);isNaN(t)||this.h5player.setLogLevel(t),this.h5player.setConfig("jitBufLen",4e3),this.h5player.setConfig("isProduce",l.ISDEBUG?0:1),this.h5player.on(H5Player.Events.VIDEO_PLAY,this.onPlayVideo.bind(this)),this.h5player.on(H5Player.Events.VIDEO_STOP,this.onStopVideo.bind(this)),this.h5player.on(H5Player.Events.ANCHOR_STOP,this.onEndVideo.bind(this)),this.h5player.on(H5Player.Events.NO_VIDEO,this.onNoVideo.bind(this)),this.h5player.on(H5Player.Events.H5_PLAYER_ERROR,this.onH5PlayerError.bind(this)),this.h5player.on(H5Player.Events.FLV_URL_UNAVAILABLE,this.onFlvUrlUnavailable.bind(this)),this.h5player.on(H5Player.Events.PLAY_STATUS,this.onPlayStatus.bind(this)),this.h5player.on(H5Player.Events.NO_DATA_RECEIVED,this.onDataReceived.bind(this)),this.h5player.on(H5Player.Events.DATA_METRIC2,this.onDataMetric2.bind(this)),this.h5player.on(H5Player.Events.BROWSER_PAUSE,this.onBrowerPause.bind(this)),this.h5player.on(H5Player.Events.VIDEO_RESOLUTION_CHANGE,(function(t,i){return e.onVideoResolutionChange(t,i)}))}},{key:"checkChannelId",value:function(e){var t,i=O(e);try{for(i.s();!(t=i.n()).done;){var s=t.value;if(s.codeRate<=2e3)return s.channelId}}catch(e){i.e(e)}finally{i.f()}return e[0].channelId}},{key:"sortBitRate",value:function(e,t){return t.codeRate-e.codeRate}},{key:"getDisplayName",value:function(e){return e>=2500?"蓝光":e>=1500?"超清":e>=1e3?"高清":e>=800?"标清":"流畅"}},{key:"onPlayVideo",value:function(e,t){t.video.autoplay=!0,l.isPause=!1,l.isPlaying=!0,this.isRefreshing=!1,this.tryPlay=!0,this.video||(window.h5VideoloadTime&&h5VideoloadTime(),this.vplayer.trigger("indexVideoload"),this.isVideoLoad=!0),this.video&&(this.video.pause(),this.video.src="");var i=this.video=t.video;i=t.video;var s=t.canvas;this.video=i,this.canvas=s,this.curVideoWidth=t.width||0,this.curVideoHeight=t.height||0,$(i).attr("id","hy-video"),$("#hy-video").remove(),$("#player-video").append(i),this.resize(),D.hide(),this.showTip("play",!0),f.fireEvent(f.HIDE_LOADING),this.vplayer.barrage&&this.vplayer.barrage.isShow&&this.vplayer.barrage.setDanmuVisible(!0),this.h5player.setVolume(.01*this.volume),C.log("%c======onPlayVideo","color:#F9F900;background:gray",t),f.fireEvent(f.NEW_VIDEO)}},{key:"onStopVideo",value:function(e,t){C.log("%c======onStopVideo","color:#F9F900;background:gray",t),C.log(l.isPlaying,l.isPause)}},{key:"onDataReceived",value:function(e,t){C.log("%c======onDataReceived","color:#F9F900;background:gray",t),1==this.tryPlay?(this.playAgain(),this.tryPlay=!1):(D.show(),this.showTip("none"))}},{key:"onEndVideo",value:function(e,t){C.log("%c======onEndVideo","color:#F9F900;background:gray",t),D.show(),this.showTip("none")}},{key:"onNoVideo",value:function(e,t){C.log("%c======onNoVideo","color:#F9F900;background:gray",t),D.show(),this.showTip("none")}},{key:"onH5PlayerError",value:function(e,t){C.log("%c======onH5PlayerError","color:#F9F900;background:gray",t),this.playAgain()}},{key:"onFlvUrlUnavailable",value:function(e,t){C.log("%c======onFlvUrlUnavailable","color:#F9F900;background:gray",t),this.playAgain()}},{key:"onPlayStatus",value:function(e,t){t.status,C.log("%c======onPlayStatus:","color:#F9F800;background:gray",t)}},{key:"pause",value:function(){this.stop(),l.isPause=!0,this.showTip("pause",!0),this.vplayer.barrage&&this.vplayer.barrage.setDanmuVisible(!1)}},{key:"stop",value:function(){l.isPlaying=!1,this.h5player.stop()}},{key:"play",value:function(){var e=this.getLiveInfo();if(!l.videoData||!e||0==e.gameStreamInfoList.length){if(D.show(),this.showTip("none"),this.isVideoLoad)return;return this.vplayer.trigger("indexVideoload"),void(this.isVideoLoad=!0)}D.hide(),this.setDisPlay(e),this.intType(),1==l.isCsdnTokenTimeout?(C.log("getCdnToken"),this.getCdnToken()):(C.log("startFlv",e),this.startFlv(e))}},{key:"playAgain",value:function(){var e=Date.now();e-this.lastClickTime<1e3||(this.lastClickTime=e,this.getCdnToken())}},{key:"startFlv",value:function(e){var t=e.gameLiveInfo.codecType,i=this.isH265CodecType(t);this.makeFlv(e,i),C.log("G.flv",l.flv);var s={uid:l.yyuid>0?l.yyuid:l.anonymousUid,sid:l.topsid,subSid:l.subsid,presenterUid:l.pid,lineType:l.iLineIndex,sGuid:o.getCookie("guid"),roomId:l.profileRoom,h5Root:l.H5ROOT,liveType:1};s.url=l.flv,s.originalBitrate=i||l.codeRate!=l.curRate?1:0,s.curBitrate=l.curRate,s.type=H5Player.FLV,s.domainList=this.getDomainList(),s.sFlvUrl=l.streamInfo.sFlvUrl,s.sStreamName=l.streamInfo.sStreamName,s.sFlvAntiCode=l.streamInfo.sFlvAntiCode.replace(/&amp;/g,"&");var r=i||l.codeRate!=l.curRate?l.curRate:0;s.bitrate=r,s.iBitRate=r,this.h5player.start(s);var a=this.isRefreshing?"refresh":"loading";this.showTip(a,!1)}},{key:"getDomainList",value:function(){for(var e=l.domain_list||[],t=[],i=0,s=e.length;i<s;i++)if(l.iLineIndex==e[i].line_index){e[i].flv_domain_list&&(t=e[i].flv_domain_list.concat());break}return t}},{key:"setDisPlay",value:function(e){var t=e.gameLiveInfo.bitRate;l.codeRate=t;var i=this.getDisplayName(t);f.fireEvent(f.SET_BITRATE,i)}},{key:"makeFlv",value:function(e,t){for(var i in e.gameStreamInfoList)e.gameStreamInfoList[i].sFlvUrl&&-1==e.gameStreamInfoList[i].sFlvUrl.indexOf("ws3")||e.gameStreamInfoList.splice(i,1);var s=e.gameStreamInfoList,r=s.length,a=-1;try{this.setRatioByDomainList(s);for(var n=-1,o=[],h=0,u=0;u<r;u++){var d=s[u].iWebPriorityRate,c=parseInt(d);c<0||(h+=c,o.push({index:u,rate:c}),100==c&&(n=u))}if(1==r)a=0;else if(-1!=n)a=n;else for(var p=0,f=Math.random(),m=0,_=o.length;m<_;m++){var y=o[m];if(f<=(p+=y.rate/h)){a=y.index;break}}if(-1==a){var v=parseInt(Math.random()*o.length);o[v]&&(a=o[v].index)}}catch(e){C.log("makeFlv",e)}-1==a&&(a=parseInt(Math.random()*r)),l.streamInfo=s[a],l.iLineIndex=parseInt(s[a].iLineIndex);var S=s[a].sFlvUrl+"/"+s[a].sStreamName;S+=".flv?",S+=s[a].newCFlvAntiCode,C.log("sStreamName",s[a].sStreamName),l.sCdnType=s[a].sCdnType,l.curRate=l.codeRate,t?l.codeRate>=2e3?(S+="&ratio=2000",l.curRate=2e3):S+="&ratio=".concat(l.codeRate):l.codeRate>2e3&&(S+="&ratio=2000",l.curRate=2e3),l.isHttps()&&(S=S.replace("http","https")),S=S.replace(/&amp;/g,"&"),l.flv=S}},{key:"isH265CodecType",value:function(e){return 1==e||4==e||6==e||8==e}},{key:"setRatioByDomainList",value:function(e){for(var t=l.domain_list||[],i=0,s=t.length;i<s;i++)for(var r=0;r<e.length;r++)e[r].iLineIndex==t[i].line_index&&t[i].line_ratio_web&&(e[r].iWebPriorityRate=t[i].line_ratio_web)}},{key:"getCdnToken",value:function(){this.getJson(this.getCdnTokenRsp.bind(this))}},{key:"getJson",value:function(e){var t,i,s;t=e,i={m:"Stream",do:"getBannerStreamInfo"},s=window.APP_URL+"member/index.php",i.us=l.pidList,i.k=l.slidesKey,$.get(s,i,t,"json")}},{key:"getCdnTokenRsp",value:function(e){C.log("getCdnTokenRsp",e),l.videoData=e.data.data,l.isCsdnTokenTimeout=!1,this.checkTimeOut(),this.play()}},{key:"intType",value:function(){l.topsid=parseInt(l.topsid),l.subsid=parseInt(l.subsid),l.appid=parseInt(l.appid),l.curBitRate=parseInt(l.curBitRate),isNaN(l.curBitRate)&&(l.curBitRate=l.appid)}},{key:"refresh",value:function(){if(!this.isRefreshing){var e=Date.now();e-this.lastRefreshTime<3e3||(C.log("%c======refresh","color:#F9F900;background:gray"),this.lastRefreshTime=e,this.isRefreshing=!0,this.stop(),this.play())}}},{key:"setVolume",value:function(e){e=Math.min(e,100),e=Math.max(e,0),this.volume=e,this.h5player&&(C.log("setVolume",e),this.h5player.setVolume(.01*this.volume))}},{key:"getLiveInfo",value:function(){for(var e in l.videoData)if(l.videoData[e].gameLiveInfo){var t=l.videoData[e].gameLiveInfo.uid;if(l.pid==t)return l.videoData[e]}return null}},{key:"checkTimeOut",value:function(){clearTimeout(this.tokenTimeId),this.tokenTimeId=setTimeout(this.onTimeOut,6e4)}},{key:"onTimeOut",value:function(){l.isCsdnTokenTimeout=!0,C.log("G.isCsdnTokenTimeout = true")}},{key:"showTip",value:function(e,t){f.fireEvent(f.SHOW_PLAY_TIPS,{type:e,autoHide:t})}},{key:"getSDKLog",value:function(){return this.h5player?this.h5player.getLog():""}},{key:"onWebsocketInited",value:function(e){if(this.cacheMetric2.length>0){for(var t=0,i=this.cacheMetric2.length;t<i;t++)this.onDataMetric2(H5Player.Events.DATA_METRIC2,this.cacheMetric2[t]);this.cacheMetric2=[]}}},{key:"setTafHandler",value:function(e){this.h5player&&this.h5player.setTafHandler&&(C.log("setTafHandler",e),this.h5player.setTafHandler(e))}},{key:"onDataMetric2",value:function(e,t){C.log("onDataMetric2",t),l.wsconnected?f.fireEvent(f.DATA_METRIC2,t):this.cacheMetric2.push(t)}},{key:"onBrowerPause",value:function(e,t){C.log(e,t),l.browerPause=!0,f.fireEvent(f.SHOW_BROWER_PAUSE_TIPS),this.h5player.setVolume(0)}},{key:"onVideoResolutionChange",value:function(e,t){C.log("=== onVideoResolutionChange",e,t),this.resize(t)}},{key:"resize",value:function(e){if(l.hasVideoPiexlate){var t=this.container.width(),i=this.container.height(),s=t,r=i,a=e||this.getVideoSize(),n=a.width,o=a.height,h=0,u=0;0!==n&&0!==o&&l.hasVideo?n/o>t/i?(s=t,u=(i-(r=o*t/n))/2):(r=i,h=(t-(s=n*i/o))/2):(s=0,r=0);var d={left:h,top:u,width:s,height:r};l.hasVideoPiexlate&&$("#video-pixelate-box").css(d),$.isFunction(this.h5player.containerResize)&&this.h5player.containerResize({width:s,height:r})}}},{key:"getVideoSize",value:function(){return{width:this.canvas?this.canvas.width:this.video?this.video.videoWidth||this.curVideoWidth:0,height:this.canvas?this.canvas.height:this.video?this.video.videoHeight||this.curVideoHeight:0}}},{key:"testPlay",value:function(){var e={uid:l.yyuid,sid:l.topsid,subSid:l.subsid,presenterUid:l.pid,lineType:l.iLineIndex,sGuid:o.getCookie("guid"),roomId:l.profileRoom};e.url=l.flv,e.originalBitrate=l.codeRate==l.curRate?0:1,e.curBitrate=l.curRate,e.type=H5Player.FLV,e.domainList=this.getDomainList(),e.sFlvUrl=l.streamInfo.sFlvUrl,e.sStreamName=l.streamInfo.sStreamName,e.sFlvAntiCode=l.streamInfo.sFlvAntiCode.replace(/&amp;/g,"&"),this.h5player.start(e)}}])&&L(t.prototype,i),s&&L(t,s),Object.defineProperty(t,"prototype",{writable:!1}),e}(),N=i("bQv4"),M=i.n(N),U=i("Jk/3"),V=i.n(U);function x(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var H=function(){function e(t){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.isPlaying=!0,this.lastClickTime=0,this.autohideTips,this.vplayer=t,this.playBtn=$("#player-btn"),this.playBtnBig=$(".player-play-big"),this.refreshBtn=$(".player-refresh-btn"),this.tips=$("#player-play-tips"),this.playBtn.click(this.togglePlay.bind(this)),this.playBtnBig.click(this.togglePlay.bind(this)),this.refreshBtn.click(this.refresh.bind(this)),this.browerPauseGuide=null,this.delayid=0,this.loginGuide=null,this.activeCloseGuide=!1,this.playBtnBig.hide(),f.addEvent(f.SHOW_PLAY_TIPS,this.showPlayTip.bind(this)),f.addEvent(f.PAUSE_VIDEO,this.pauseVideo.bind(this)),f.addEvent(f.SHOW_OR_HIDE_PLAY_STOP_BTN,this.showOrHidePlayStopBtn.bind(this)),f.addEvent(f.PLAY_VIDEO,(function(){i.playVideo()})),f.addEvent(f.PLAY_TIPS,this.showPlayTips.bind(this))}var t,i,s;return t=e,(i=[{key:"showPlayTips",value:function(){this.tips.show(),this.isPlaying=!1,f.fireEvent(f.PAUSE_VIDEO),this.updateStyle()}},{key:"showOrHidePlayStopBtn",value:function(e){e?(this.playBtn.css("visibility","visible"),this.playBtnBig.css("visibility","visible"),this.refreshBtn.css("visibility","visible")):(this.playBtn.css("visibility","hidden"),this.playBtnBig.css("visibility","hidden"),this.refreshBtn.css("visibility","hidden"))}},{key:"pauseVideo",value:function(){this.isPlaying=!1,f.fireEvent(f.VIDEO_PAUSE),this.updateStyle()}},{key:"playVideo",value:function(){this.togglePlay()}},{key:"togglePlay",value:function(){if(l.hasVideo){var e=Date.now();if(e-this.lastClickTime<500)return!1;this.lastClickTime=e,this.isPlaying=!this.isPlaying,this.isPlaying?(console.info("firevideoPlay"),f.fireEvent(f.VIDEO_PLAY),f.fireEvent(f.HUYA_REPORT,{name:"click/kongzhi/bofang"}),this.browerPauseGuide&&this.browerPauseGuide.hide()):(console.info("firevideoStop"),f.fireEvent(f.VIDEO_PAUSE),f.fireEvent(f.HUYA_REPORT,{name:"click/kongzhi/zanting"})),this.updateStyle()}}},{key:"updateStyle",value:function(){this.isPlaying?(this.playBtn.removeClass("player-play-btn"),this.playBtn.addClass("player-pause-btn"),this.playBtn.attr("title","暂停观看"),this.playBtnBig.hide(),this.refreshBtn.show(),this.tips.hide(),this.hideLoginGuide()):(this.playBtn.removeClass("player-pause-btn"),this.playBtn.addClass("player-play-btn"),this.playBtn.attr("title","开始观看"),this.playBtnBig.show(),this.refreshBtn.hide(),this.showLoginGuideTip())}},{key:"refresh",value:function(){l.hasVideo&&(f.fireEvent(f.VIDEO_REFRESH),f.fireEvent(f.HUYA_REPORT,{name:"click/kongzhi/shuaxin"}))}},{key:"turnPlayButtonOn",value:function(){this.isPlaying||(this.browerPauseGuide&&this.browerPauseGuide.hide(),this.isPlaying=!0,this.updateStyle())}},{key:"showPlayTip",value:function(e){if(!l.isShowLoading){var t=e.type,i=e.autoHide,s=!1;$("#player-tip div").hide(),"pause"==t?$("#player-tip-pause").show():"play"==t?$("#player-tip-play").show():"loading"==t?$("#player-tip-loading").show():"refresh"==t?$("#player-tip-refresh").show():s=!0,clearTimeout(this.autohideTips),!s&&i&&(this.autohideTips=setTimeout((function(){$("#player-tip div").hide()}),2e3))}}},{key:"showLoginGuideTip",value:function(){var e=this;l.isLogin||this.activeCloseGuide||(null==this.loginGuide&&($("#player-ctrl-wrap").append(V()()),this.loginGuide=$("#player-login-guide-tip"),$(".player-login-guide-close").click((function(){e.activeCloseGuide=!0,e.clearLoginGuide()})),$(".player-login-guide-text").click((function(){e.vplayer.trigger("webgamelivelogin"),e.vplayer.report.newHuyaReport({eid_desc:"点击立即登录提醒toast",eid:"click/immediate_sign_toast",prop:JSON.stringify({scene:1})},"huya_web")}))),this.loginGuide.show(),clearTimeout(this.delayid),this.delayid=setTimeout((function(){e.loginGuide.hide()}),5e3),this.vplayer.report.newHuyaReport({eid_desc:"曝光立即登录提醒toast",eid:"show/immediate_sign_toast",prop:JSON.stringify({scene:1})},"huya_web"))}},{key:"hideLoginGuide",value:function(){null!=this.loginGuide&&(clearTimeout(this.delayid),this.loginGuide.hide())}},{key:"clearLoginGuide",value:function(){null!=this.loginGuide&&(clearTimeout(this.delayid),this.loginGuide.unbind(),this.loginGuide.remove())}}])&&x(t.prototype,i),s&&x(t,s),Object.defineProperty(t,"prototype",{writable:!1}),e}();function W(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var G=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.playerSoundBtn=$("#player-sound-btn"),this.soundProgress=$(".sound-progress"),this.soundBtn=$(".sound-progress .sound-btn"),this.soundBar=$(".sound-progress .sound-bar"),this.isMute=!1,this.bDrag=!1,this.disX=0,this.minX=2,this.maxW=85,this.progressLeft=0,this.timeId=0,this.mouseMove=this.onMouseMove.bind(this),this.mouseUp=this.onMouseUp.bind(this),this.soundValue=parseFloat(o.getCookie("SoundValue")),isNaN(this.soundValue)&&(this.soundValue=.5),this.soundValue=Math.min(this.soundValue,1),this.soundValue=Math.max(this.soundValue,0);var i=(this.maxW-this.minX)*this.soundValue+this.minX;"ceshi05"===l.from&&(i=this.minX),this.volumeChange(i),this.playerSoundBtn.click(this.toggleMute.bind(this)),this.soundProgress.mousedown(this.onMouseDown.bind(this)),l.browerPause&&this.showBrowerPauseTips(),f.addEvent(f.SHOW_BROWER_PAUSE_TIPS,(function(){t.showBrowerPauseTips()}))}var t,i,s;return t=e,(i=[{key:"volumeChange",value:function(e,t){this.soundBtn.css("left",e+"px"),this.soundBar.css("width",e+"px");var i=(e-this.minX)/(this.maxW-this.minX)*100>>0;f.fireEvent(f.VIDEO_VOLUME,i),t||o.setCookie("SoundValue",(.01*i).toFixed(2),365,".huya.com"),this.isMute=0==i,this.isMute?(this.playerSoundBtn.removeClass("player-sound-on"),this.playerSoundBtn.addClass("player-sound-off")):(this.playerSoundBtn.removeClass("player-sound-off"),this.playerSoundBtn.addClass("player-sound-on"))}},{key:"onMouseMove",value:function(e){if(this.bDrag){var t=e.pageX-this.disX-this.progressLeft;t=(t=t<this.minX?this.minX:t)>this.maxW?this.maxW:t,this.volumeChange(t)}}},{key:"onMouseUp",value:function(e){this.bDrag=!1,$(document).unbind("mousemove",this.mouseMove),$(document).unbind("mouseup",this.mouseUp),f.fireEvent(f.HUYA_REPORT,{name:"click/kongzhi/yinliang"})}},{key:"onMouseDown",value:function(e){return e.target!=this.soundBtn[0]&&this.volumeChange(e.offsetX-this.minX),this.bDrag=!0,this.progressLeft=o.getPos(this.soundProgress[0]).left,this.disX=e.pageX-o.getPos(this.soundBtn[0]).left,$(document).mousemove(this.mouseMove),$(document).mouseup(this.mouseUp),!1}},{key:"toggleMute",value:function(){this.playerSoundBtn.hasClass("player-sound-off")?this.volumeChange(this.maxW/2):this.volumeChange(this.minX),f.fireEvent(f.HUYA_REPORT,{name:"click/kongzhi/yinliang"})}},{key:"showBrowerPauseTips",value:function(){clearTimeout(this.timeId),this.timeId=setTimeout((function(){f.fireEvent(f.SHOW_COMMON_TOAST,"由于浏览器限制，请手动开启声音")}),1e3),this.volumeChange(this.minX,!0)}}])&&W(t.prototype,i),s&&W(t,s),Object.defineProperty(t,"prototype",{writable:!1}),e}();function j(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var Y=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.ctrl=t,this.videoType=$(".player-videotype"),this.curType=$(".player-videotype-cur"),this.hideBitRate()}var t,i,s;return t=e,(i=[{key:"setCurType",value:function(e){this.curType.text(e),this.videoType.show()}},{key:"hideBitRate",value:function(){this.videoType.hide()}}])&&j(t.prototype,i),s&&j(t,s),Object.defineProperty(t,"prototype",{writable:!1}),e}(),q=i("zsW8"),J=i.n(q),z=i("Wgyc"),K=i.n(z);function Q(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var X=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._x=0,this._y=0,this.target=t;var s={handle:t,limit:!0,lock:!1,lockX:!1,lockY:!1,container:document.body,onStart:function(){},onMove:function(){},onStop:function(){}};for(var r in i)s[r]=i[r];for(var r in s)this[r]=s[r];this._moveDrag=this.bind(this,this.moveDrag.bind(this)),this._stopDrag=this.bind(this,this.stopDrag.bind(this)),this.handle.style.cursor="move",t.style.top=t.offsetTop+"px",t.style.left=t.offsetLeft+"px",t.style.position="absolute",t.style.margin="0",this.container=i.container,this.container.appendChild(t),this.addHandler(this.handle,"mousedown",this.bind(this,this.startDrag))}var t,i,s;return t=e,(i=[{key:"toCenter",value:function(){var e=$(l.config.idDom).width(),t=$(l.config.idDom).height(),i=$(this.target).width(),s=t-40-$(this.target).height()>>1;s=Math.max(0,s),$(this.target).css({left:e-i>>1,top:s})}},{key:"startDrag",value:function(e){e=e||window.event,this._x=e.clientX-this.target.offsetLeft,this._y=e.clientY-this.target.offsetTop,this.addHandler(this.container,"mousemove",this._moveDrag),this.addHandler(this.container,"mouseup",this._stopDrag),this.addHandler(this.container,"mouseleave",this._stopDrag),e.preventDefault&&e.preventDefault(),this.handle.setCapture&&this.handle.setCapture(),this.onStart&&this.onStart()}},{key:"moveDrag",value:function(e){if(e=e||window.event,!this.lock){var t=e.clientY-this._y,i=e.clientX-this._x,s=this.container.clientHeight-this.target.offsetHeight,r=this.container.clientWidth-this.target.offsetWidth;this.limit&&(t=(t=t<0?0:t)>s?s:t,i=(i=i<0?0:i)>r?r:i),this.lockY||(this.target.style.top=t+"px"),this.lockX||(this.target.style.left=i+"px"),e.preventDefault&&e.preventDefault(),this.onMove&&this.onMove()}}},{key:"stopDrag",value:function(){this.removeHandler(this.container,"mousemove",this._moveDrag),this.removeHandler(this.container,"mouseup",this._stopDrag),this.removeHandler(this.container,"mouseleave",this._stopDrag),this.handle.releaseCapture&&this.handle.releaseCapture(),this.onStop&&this.onStop()}},{key:"addHandler",value:function(e,t,i){return e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent("on"+t,i)}},{key:"removeHandler",value:function(e,t,i){return e.removeEventListener?e.removeEventListener(t,i,!1):e.detachEvent("on"+t,i)}},{key:"bind",value:function(e,t){return function(){return t.apply(e,arguments)}}}])&&Q(t.prototype,i),s&&Q(t,s),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Z(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var ee=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.onHide=i,$("#player-wrap").append(K.a),$(".player-panel-content").html(t.htmlText),this.addEvents(),this.toFront()}var t,i,s;return t=e,(i=[{key:"addEvents",value:function(){var e="#player-panel-feedback";this.panel=document.querySelector(e),this.close=document.querySelector(e+" .player-panel-close"),this.close.onclick=this.hide.bind(this);var t=this.panel.getElementsByTagName("h2")[0];t.onmousedown=this.toFront.bind(this),this.drag=new X(this.panel,{limit:!1,handle:t,container:document.querySelector("#player-wrap")}),$(this.drag.container).resize(this.onResize)}},{key:"show",value:function(){this.isShow=!0,this.panel.style.display="block",this.drag.toCenter(),this.toFront()}},{key:"hide",value:function(){this.isShow=!1,this.panel.style.display="none",this.onHide&&this.onHide()}},{key:"onResize",value:function(){this.drag.toCenter()}},{key:"toFront",value:function(e){return this.drag.container.appendChild(this.panel),!1}}])&&Z(t.prototype,i),s&&Z(t,s),Object.defineProperty(t,"prototype",{writable:!1}),e}(),te=i("NpRk"),ie=i.n(te);function se(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var re=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.vplayer=t,this.id="#player-panel-feedback",this.tick=3,this.oldNum=0,this.oldTitle="",this.oldContent="";var i={htmlText:J.a};this.panel=new ee(i,this.onHide.bind(this)),this.ul=$(this.id+" ul");for(var s=["画面卡顿","无限缓冲","声音和画面不同步","有画面没声音","发送不了道具","有声音没画面","花屏","黑屏","其它"],r=[1,2,5,6,7,9,3,4,8],a=0,n=s.length;a<n;a++){var o=s[a],h="<li index='".concat(r[a],"'><i></i>").concat(o,"</li>");$(h).appendTo(this.ul)}this.tip=$("#feedback-tip"),this.input=$(this.id+" input"),this.addEvents()}var t,i,s;return t=e,(i=[{key:"addEvents",value:function(){$(this.id+" li").click(this.onItemClick.bind(this)),$("#feedback-submit").click(this.onSubmit.bind(this)),$("#feedback-footer span").click(this.onQQClick.bind(this)),this.input.bind("input",this.onInput.bind(this))}},{key:"onInput",value:function(){var e,t=this.input[0].selectionStart;(e=(e=this.input.val()).replace(/\D/g,""))==this.oldNum&&t--,this.oldNum=e,this.input.val(e),this.input[0].setSelectionRange&&this.input[0].setSelectionRange(t,t)}},{key:"onItemClick",value:function(e){var t=e.currentTarget;$(t).find("i").attr("class","select"),$(t).siblings("li").find("i").removeClass("select")}},{key:"onSubmit",value:function(){var e=$(this.id+" li i.select").parent(),t=e.text().replace(/\s/gim,""),i=$(this.id+" textarea").val();if(t!=this.oldTitle||i!=this.oldContent)if(this.oldTitle=t,this.oldContent=i,"其它"!=t||""!=i.replace(/\s/gim,"")){var s=$(this.id+" input").val(),r=e.attr("index"),a=i;a+="+birate:"+l.curRate,a+="+line:"+l.iLineIndex,""!=s&&(a+="+qq:"+s);var n=window.TT_ENV_DETECTOR;n&&n.browser&&(a+="+(".concat(n.browser.name,":").concat(n.browser.version,")"));var o={site:1,type:r,error_text:a},h=JSON.stringify(o),u={data:h,log:this.getLog(),sign:ie()("flash_feedback_20141105_"+h)};C.log("反馈数据",u);var d="//www.huya.com/api/flashFeedBack.php";l.ISDEBUG&&(d="//test.www.huya.com/api/flashFeedBack.php"),$.ajax({type:"POST",url:d,data:u,error:function(e,t,i){C.error("x","FeedBack请求出错",t,i)},success:function(e,t){"success"==t?C.log("反馈数据提交成功"):C.log("反馈数据提交失败",t,e)}}),this.getFbId(t,a,this.postLog.bind(this)),this.tick=3,this.tip.text("正在提交..."),clearInterval(this.tickHandler),this.tickHandler=setInterval(this.onTick.bind(this),1e3)}else this.panel.hide()}},{key:"getFbId",value:function(e,t,i){var s={fbType:e,fbDetails:t||e,uid:l.yyuid?l.yyuid:18e11+parseInt(1e11*Math.random()),gid:o.getCookie("guid"),device:this.detectOS(),appVersion:"H5首页"+l.VER,deviceType:1,anchorId:l.pid,ssid:l.subsid,appId:200,isp2p:0};$.ajax({type:"POST",url:"//ffilelogapp.huya.com/addFeedBack",data:s,error:function(e,t,i){C.log(e,"获取fbid出错",t,i)},success:function(e){C.log("获取反馈id",e);var t=e.fbId;1==e.result?(i(t),C.log("获取fbid成功")):C.log("获取fbid失败")}})}},{key:"gblen",value:function(e){for(var t=0,i=e.length,s=0;s<i;s++){var r=e.charCodeAt(s);r>=1&&r<=126||65376<=r&&r<=65439?t++:t+=2}return t}},{key:"postLog",value:function(e){var t=this.getLog(),i=this.gblen(t);$.ajax({type:"POST",url:"//ffilelogupload.huya.com/uploadStringLog",data:{feedbackId:e,log:t,fileSize:i},error:function(e,t,i){C.log(e,"上传日志出错",t,i)},success:function(e){C.log("上传日志返回",e),200==e.status?C.log("上传日志成功"):C.log("上传日志失败")}})}},{key:"detectOS",value:function(){var e=navigator.userAgent,t="Win32"==navigator.platform||"Windows"==navigator.platform,i="Mac68K"==navigator.platform||"MacPPC"==navigator.platform||"Macintosh"==navigator.platform||"MacIntel"==navigator.platform;if(i)return"Mac";if("X11"==navigator.platform&&!t&&!i)return"Unix";if(String(navigator.platform).indexOf("Linux")>-1)return"Linux";if(t){if(e.indexOf("Windows NT 5.0")>-1||e.indexOf("Windows 2000")>-1)return"Win2000";if(e.indexOf("Windows NT 5.1")>-1||e.indexOf("Windows XP")>-1)return"WinXP";if(e.indexOf("Windows NT 5.2")>-1||e.indexOf("Windows 2003")>-1)return"Win2003";if(e.indexOf("Windows NT 6.0")>-1||e.indexOf("Windows Vista")>-1)return"WinVista";if(e.indexOf("Windows NT 6.1")>-1||e.indexOf("Windows 7")>-1)return"Win7";if(e.indexOf("Windows NT 10")>-1||e.indexOf("Windows 10")>-1)return"Win10"}return"other"}},{key:"getLog",value:function(){var e={isFromHome:!0};return e.ua=navigator.userAgent,e.uid=l.yyuid,e.tid=l.topsid,e.sid=l.subsid,e.appid=l.appid,e.yyuid=l.yyuid,e.pid=l.pid,e.isPlaying=l.isPlaying,e.hasVideo=l.hasVideo,e.videoData=l.videoData,e.sdkLog=this.vplayer.vcore.getSDKLog(),e=JSON.stringify(e)}},{key:"onTick",value:function(){0!=this.tick?(this.tip.text("提交成功，"+this.tick+"秒后关闭窗口..."),this.tick--):this.panel.hide()}},{key:"onQQClick",value:function(){window.open("//shang.qq.com/wpa/qunwpa?idkey=e9d5c7c88c2ea111215a3a1155f07eac34907ebe8dd58d8d2c9d7600d4c7d9fd")}},{key:"show",value:function(){this.tip.text(""),$(this.id+" textarea").val(""),$(this.id+" input").val(""),$(this.id+" li i").removeAttr("class"),$(this.id+" li[index=8] i").attr("class","select"),this.panel.show()}},{key:"onHide",value:function(){clearInterval(this.tickHandler),this.oldTitle="",this.oldContent=""}},{key:"hide",value:function(){this.panel.hide()}},{key:"isShow",value:function(){return this.panel.isShow}}])&&se(t.prototype,i),s&&se(t,s),Object.defineProperty(t,"prototype",{writable:!1}),e}();function ae(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var ne=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.vplayer=t,this.hideCtrlTime=0}var t,i,s;return t=e,(i=[{key:"init",value:function(){$("#player-ctrl-wrap").prepend(M()()),this.initToast(),this.playStop=new H(this.vplayer),this.volume=new G(this),this.menu=new Y(this),$(".player-wrap").mousemove(this.onMouseMoveVideo.bind(this)),$(".player-wrap").mouseleave(this.onMouseLeaveVideo.bind(this)),$(".player-enter-room-center").click(this.onEnterRoom.bind(this)),$(".player-enter-room-center").mouseover(this.mouseOverEnterRoom.bind(this)),$("#player-enter-room").click(this.onEnterRoom.bind(this)),$(".player-report-btn").click(this.showFeedback.bind(this)),this.hideCtrlTime=setTimeout(this.hideCtrlWrap,3e3)}},{key:"showPlayCtrl",value:function(){$("#player-ctrl-wrap").css("bottom","0px"),clearTimeout(this.hideCtrlTime),this.hideCtrlTime=setTimeout(this.hideCtrlWrap,3e3)}},{key:"hideCtrlWrap",value:function(){$("#player-ctrl-wrap").css("bottom","-44px")}},{key:"showFeedback",value:function(){this.feedbackPanel||(this.feedbackPanel=new re(this.vplayer)),this.feedbackPanel.isShow()?this.feedbackPanel.hide():this.feedbackPanel.show(),this.feedbackPanel.isShow()&&f.fireEvent(f.HUYA_REPORT,{name:"click/kongzhi/fankui"})}},{key:"onEnterRoom",value:function(){sessionStorage.ya_eid=l.config.ref;var e="click/enterroom/"+l.danmuStatus+"/"+l.pid,t="点击/进入直播间/弹幕状态/"+l.pid;f.fireEvent(f.HUYA_REPORT,{name:"",dynamicEid:{eid:e,eid_desc:t}}),l.ISDEBUG||(l.config.shortlink2room=l.config.shortlink2room.replace("http:","https:")),window.open(l.config.shortlink2room)}},{key:"mouseOverEnterRoom",value:function(){l.isPlaying&&($(".player-enter-room-center").css("visibility","visible"),clearTimeout(this.timeOut),this.showPlayCtrl())}},{key:"onMouseLeaveVideo",value:function(){this.hideEnterRoom(),this.hideCtrlWrap()}},{key:"onMouseMoveVideo",value:function(){this.showPlayCtrl(),l.isPlaying&&($(".player-enter-room-center").css("visibility","visible"),clearTimeout(this.timeOut),this.timeOut=setTimeout(this.hideEnterRoom,4e3))}},{key:"hideEnterRoom",value:function(){$(".player-enter-room-center").css("visibility","hidden")}},{key:"turnPlayButtonOn",value:function(){this.playStop.turnPlayButtonOn()}},{key:"initToast",value:function(){var e=0;f.addEvent(f.SHOW_COMMON_TOAST,(function(t){if(t){var i=$(".player-common-toast");i.show(),i.fadeIn("fast"),i.text(t),clearTimeout(e),e=setTimeout((function(){i.fadeOut("normal",(function(){i.hide()}))}),2e3)}}))}}])&&ae(t.prototype,i),s&&ae(t,s),Object.defineProperty(t,"prototype",{writable:!1}),e}(),oe=/\s+/;function he(){}he.prototype.on=function(e,t,i){var s,r;if(!t)return this;for(s=this.__events||(this.__events={}),e=e.split(oe);r=e.shift();)(s[r]||(s[r]=[])).push(t,i);return this},he.prototype.once=function(e,t,i){var s=this;return this.on(e,(function r(){s.off(e,r),t.apply(i||s,arguments)}),i)},he.prototype.off=function(e,t,i){var s,r,a,n;if(!(s=this.__events))return this;if(!(e||t||i))return delete this.__events,this;for(e=e?e.split(oe):ue(s);r=e.shift();)if(a=s[r])if(t||i)for(n=a.length-2;n>=0;n-=2)t&&a[n]!==t||i&&a[n+1]!==i||a.splice(n,2);else delete s[r];return this},he.prototype.trigger=function(e){var t,i,s,r,a,n,o=[],h=!0;if(!(t=this.__events))return this;for(e=e.split(oe),a=1,n=arguments.length;a<n;a++)o[a-1]=arguments[a];for(;i=e.shift();)(s=t.all)&&(s=s.slice()),(r=t[i])&&(r=r.slice()),"all"!==i&&(h=le(r,o,this)&&h),h=le(s,[i].concat(o),this)&&h;return h},he.prototype.emit=he.prototype.trigger;var ue=Object.keys;function le(e,t,i){var s=!0;if(e){var r=0,a=e.length,n=t[0],o=t[1],h=t[2];switch(t.length){case 0:for(;r<a;r+=2)s=!1!==e[r].call(e[r+1]||i)&&s;break;case 1:for(;r<a;r+=2)s=!1!==e[r].call(e[r+1]||i,n)&&s;break;case 2:for(;r<a;r+=2)s=!1!==e[r].call(e[r+1]||i,n,o)&&s;break;case 3:for(;r<a;r+=2)s=!1!==e[r].call(e[r+1]||i,n,o,h)&&s;break;default:for(;r<a;r+=2)s=!1!==e[r].apply(e[r+1]||i,t)&&s}}return s}ue||(ue=function(e){var t=[];for(var i in e)e.hasOwnProperty(i)&&t.push(i);return t}),he.mixTo=function(e){var t;t=e,e="[object Function]"===Object.prototype.toString.call(t)?e.prototype:e;var i=he.prototype,s=new he;!function(e,t){if(e.forEach)return e.forEach(t);for(var i=0;i<e.length;i+=1)t(e[i],i,e)}(Object.keys(i),(function(t){e[t]=function(){return i[t].apply(s,Array.prototype.slice.call(arguments)),this}}))};var de=he;function ce(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var pe=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),f.addEvent(f.SHOW_LOADING,this.showLoading),f.addEvent(f.HIDE_LOADING,this.hideLoading),this.get5Root(),this.showLoading()}var t,i,s;return t=e,(i=[{key:"get5Root",value:function(){l.H5ROOT="//a.msstatic.com/huya/h5player/home/"+l.VER+"/",l.ISDEBUG&&(l.H5ROOT="//test.msstatic.com/huya/h5player/home/");for(var e=document.scripts,t=0,i=e.length;t<i;t++){var s=e[t].src,r=s.indexOf("vplayer2.js");if(-1!=r){l.H5ROOT=s.substring(0,r);break}}}},{key:"showLoading",value:function(){var e=l.H5ROOT+"/src/img/static/videoloading.gif";$(".player-loading-progress img").attr("src",e),$(".player-loading").css("display","block"),f.fireEvent(f.SHOW_PLAY_TIPS,{type:"none",autoHide:!1}),l.isShowLoading=!0}},{key:"hideLoading",value:function(){$(".player-loading-progress img").attr("src",""),$(".player-loading").css("display","none"),l.isShowLoading=!1}}])&&ce(t.prototype,i),s&&ce(t,s),Object.defineProperty(t,"prototype",{writable:!1}),e}();function fe(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var me=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._heartbeatTimes=0,this._beginReportTime=0,this.__mid="",this.__sessionId="",this.__reportList=[],this._tongjiReady=!1,this._reportEvents={webyyhb:"心跳",startup:"会话启动",heartbeat:"心跳",videoload:"视频加载","click/kongzhi/bofang":"点击/控制栏/播放","click/kongzhi/zanting":"点击/控制栏/暂停","click/kongzhi/shuaxin":"点击/控制栏/刷新","click/kongzhi/fankui":"点击/控制栏/问题反馈","click/kongzhi/yinliang":"点击/控制栏/音量","click/zhibo/jieshutuijian":"点击/直播间/结束推荐"},setInterval(this.sendHeartBeat.bind(this),6e4),this.huyuReport({name:"startup"}),this.sendHeartBeat(),f.addEvent(f.HUYA_REPORT,this.huyuReport.bind(this)),this.getSessionData()}var t,i,s;return t=e,(i=[{key:"sendHeartBeat",value:function(){l.topsid&&l.subsid&&this.huyuReport({name:"heartbeat"})}},{key:"getSessionData",value:function(){var e="//l.web.huya.com/index.php?m=HuyaWeb&do=check";l.ISDEBUG&&(e="//test-l.huya.com/index.php?m=HuyaWeb&do=check"),e+="&pro=huya_web&pid=".concat(l.pid,"&replay=0&watchVideo=1&uid=").concat(l.yyuid,"&anmosuid=").concat(l.anonymousUid,"&sguid=").concat(o.getCookie("guid"),"&curl=").concat(encodeURIComponent(location.href)),C.log("report=== getSessionData dataUrl",e),this.getJsonp(e,this.getDataCom)}},{key:"getJsonp",value:function(e,t){$.ajax({type:"get",url:e,data:{},cache:!0,dataType:"jsonp",jsonp:"callback",jsonpCallback:"data",success:t})}},{key:"getDataCom",value:function(e){e.code&&e.data&&(this.__mid=e.data.mid,this.__sessionId=e.data.sessionId),C.log("report=== getDataCom",e)}},{key:"tongjiReady",value:function(e){C.log("report=== tongjiReady",e),this._tongjiReady=!0,this.__mid=this.__mid||e.mid,this.__sessionId=this.__sessionId||e.sessionId;for(var t=0,i=this.__reportList.length;t<i;t++){var s=this.__reportList[t];s.mid=this.__mid,s.session_id=this.__sessionId,ya.reportProductEvent(s)}this.__reportList=[]}},{key:"huyuReport",value:function(e){var t=e.name,i=e.dynamicEid,s=new Date;0==this._beginReportTime&&(this._beginReportTime=s.getTime());var r=s.getFullYear()+"",a=s.getMonth()+1;a<10&&(a="0"+a);var n=s.getDate();n<10&&(n="0"+n);var h=s.getHours();h<10&&(h="0"+h);var u=s.getMinutes();u<10&&(u="0"+u);var d=s.getSeconds();d<10&&(d="0"+d);var c=r+a+n+h+u+d,p=i?i.eid:t,f=i?i.eid_desc:this._reportEvents[t];e={act:"/event",eid:p,eid_desc:encodeURI(f),dur:s.getTime()-this._beginReportTime,pro:"huya_flash",session_id:this.__sessionId,dty:"live",mid:this.__mid,ayyuid:l.config.profile,yyuid:l.yyuid,anmos_uid:l.anonymousUid,rso:l.config.rso,ive:"homeh5",sdk_ver:l.VER,platform:"web",ati:c,ref:l.config.ref,game_id:l.config.gameId,scid:0,cid:l.topsid+"/"+l.subsid,online_cnt:0,follow_cnt:0,replay:0,watchVideo:l.hasVideo?1:0,furl:l.config.furl,curl:location.href,wyy:"",cutc:Date.now(),sdver:1,sguid:o.getCookie("guid"),video_line:l.hasVideo?l.sCdnType:""},this._tongjiReady?ya.reportProductEvent(e):this.__reportList.push(e)}},{key:"newHuyaReport",value:function(e,t){var i=new Date;0==this._beginReportTime&&(this._beginReportTime=i.getTime());var s=i.getFullYear()+"",r=i.getMonth()+1;r<10&&(r="0"+r);var a=i.getDate();a<10&&(a="0"+a);var n=i.getHours();n<10&&(n="0"+n);var h=i.getMinutes();h<10&&(h="0"+h);var u=i.getSeconds();u<10&&(u="0"+u);var d=s+r+a+n+h+u,c={act:"/event",eid_desc:e.eid_desc,dur:i.getTime()-this._beginReportTime,pro:t||"huya_flash",session_id:this.__sessionId,dty:"live",mid:this.__mid,ayyuid:l.config.profile,yyuid:l.yyuid,anmos_uid:l.anonymousUid,rso:l.config.rso,ive:"homeh5",sdk_ver:l.VER,platform:"web",ati:d,ref:l.config.ref,game_id:l.config.gameId,scid:0,cid:l.topsid+"/"+l.subsid,online_cnt:0,follow_cnt:0,replay:0,watchVideo:l.hasVideo?1:0,furl:l.config.furl,curl:location.href,wyy:"",cutc:Date.now(),sdver:1,sguid:o.getCookie("guid"),video_line:l.hasVideo?l.sCdnType:""};e&&(c=$.extend({},c,e)),this._tongjiReady?ya.reportProductEvent(c):this.__reportList.push(c)}},{key:"generalPasUrl",value:function(e,t){for(var i in e+="?",t)e+=i+"="+t[i]+"&";return e+((new Date).getTime()+parseInt(1e3*Math.random()))}},{key:"doGetSend",value:function(e,t){l.isHttps()&&(e=e.replace("http","https"));var i=this.generalPasUrl(e,t),s=new Image(1,1);s.onload=s.onerror=function(){s=null},s.src=i}}])&&fe(t.prototype,i),s&&fe(t,s),Object.defineProperty(t,"prototype",{writable:!1}),e}(),_e=_e||{};_e.Wup=function(){this.iVersion=3,this.cPacketType=0,this.iMessageType=0,this.iRequestId=0,this.sServantName="",this.sFuncName="",this.sBuffer=new _e.BinBuffer,this.iTimeout=0,this.context=new _e.Map(new _e.STRING,new _e.STRING),this.status=new _e.Map(new _e.STRING,new _e.STRING),this.data=new _e.Map(new _e.STRING,new _e.Map(new _e.STRING,new _e.BinBuffer)),this.newdata=new _e.Map(new _e.STRING,new _e.BinBuffer)},_e.Wup.prototype.setVersion=function(e){this.iVersion=e},_e.Wup.prototype.getVersion=function(e){return this.iVersion},_e.Wup.prototype.setServant=function(e){this.sServantName=e},_e.Wup.prototype.setFunc=function(e){this.sFuncName=e},_e.Wup.prototype.setRequestId=function(e){this.iRequestId=e||++this.iRequestId},_e.Wup.prototype.getRequestId=function(){return this.iRequestId},_e.Wup.prototype.setTimeOut=function(e){this.iTimeout=e},_e.Wup.prototype.getTimeOut=function(){return this.iTimeout},_e.Wup.prototype.writeTo=function(){var e=new _e.JceOutputStream;return e.writeInt16(1,this.iVersion),e.writeInt8(2,this.cPacketType),e.writeInt32(3,this.iMessageType),e.writeInt32(4,this.iRequestId),e.writeString(5,this.sServantName),e.writeString(6,this.sFuncName),e.writeBytes(7,this.sBuffer),e.writeInt32(8,this.iTimeout),e.writeMap(9,this.context),e.writeMap(10,this.status),new _e.BinBuffer(e.getBuffer())},_e.Wup.prototype.encode=function(){var e=new _e.JceOutputStream;3==this.iVersion?e.writeMap(0,this.newdata):e.writeMap(0,this.data),this.sBuffer=e.getBinBuffer();var t=new _e.BinBuffer;t=this.writeTo();var i=new _e.BinBuffer;return i.writeInt32(4+t.len),i.writeBytes(t),i},_e.Wup.prototype.writeBoolean=function(e,t){var i=new _e.JceOutputStream;if(i.writeBoolean(0,t),3==this.iVersion)this.newdata.put(e,new _e.BinBuffer(i.getBuffer()));else{var s=this.data.get(e),r=TAF.TypeHelp.BOOLEAN;if(null==s)s=new _e.Map(_e.STRING,_e.STRING);s.put(r,new _e.BinBuffer(i.getBuffer())),this.data.put(e,s)}},_e.Wup.prototype.writeInt8=function(e,t){var i=new _e.JceOutputStream;if(i.writeInt8(0,t),3==this.iVersion)this.newdata.put(e,new _e.BinBuffer(i.getBuffer()));else{var s=this.data.get(e),r=TAF.TypeHelp.CHAR;if(null==s)s=new _e.Map(_e.STRING,_e.STRING);s.put(r,new _e.BinBuffer(i.getBuffer())),this.data.put(e,s)}},_e.Wup.prototype.writeInt16=function(e,t){var i=new _e.JceOutputStream;if(i.writeInt16(0,t),3==this.iVersion)this.newdata.put(e,new _e.BinBuffer(i.getBuffer()));else{var s=this.data.get(e),r=TAF.TypeHelp.SHORT;if(null==s)s=new _e.Map(_e.STRING,_e.STRING);s.put(r,new Uint8Array(i.getBuffer())),this.data.put(e,s)}},_e.Wup.prototype.writeInt32=function(e,t){var i=new _e.JceOutputStream;if(i.writeInt32(0,t),3==this.iVersion)this.newdata.put(e,new _e.BinBuffer(i.getBuffer()));else{var s=this.data.get(e),r=TAF.TypeHelp.INT32;if(null==s)s=new _e.Map(_e.STRING,_e.STRING);s.put(r,new Uint8Array(i.getBuffer())),this.data.put(e,s)}},_e.Wup.prototype.writeInt64=function(e,t){var i=new _e.JceOutputStream;if(i.writeInt64(0,t),3==this.iVersion)this.newdata.put(e,new _e.BinBuffer(i.getBuffer()));else{var s=this.data.get(e),r=TAF.TypeHelp.INT64;if(null==s)s=new _e.Map(_e.STRING,_e.STRING);s.put(r,new Uint8Array(i.getBuffer())),this.data.put(e,s)}},_e.Wup.prototype.writeFloat=function(e,t){var i=new _e.JceOutputStream;if(i.writeFloat(0,t),3==this.iVersion)this.newdata.put(e,new _e.BinBuffer(i.getBuffer()));else{var s=this.data.get(e),r=TAF.TypeHelp.FLOAT;if(null==s)s=new _e.Map(_e.STRING,_e.STRING);s.put(r,new Uint8Array(i.getBuffer())),this.data.put(e,s)}},_e.Wup.prototype.writeDouble=function(e,t){var i=new _e.JceOutputStream;if(i.writeDouble(0,t),3==this.iVersion)this.newdata.put(e,new _e.BinBuffer(i.getBuffer()));else{var s=this.data.get(e),r=TAF.TypeHelp.DOUBLE;if(null==s)s=new _e.Map(_e.STRING,_e.STRING);s.put(r,new Uint8Array(i.getBuffer())),this.data.put(e,s)}},_e.Wup.prototype.writeString=function(e,t){var i=new _e.JceOutputStream;if(i.writeString(0,t),3==this.iVersion)this.newdata.put(e,new _e.BinBuffer(i.getBuffer()));else{var s=this.data.get(e),r=_e.TypeHelp.STRING;if(null==s)s=new _e.Map(_e.STRING,_e.STRING);s.put(r,new Uint8Array(i.getBuffer())),this.data.put(e,s)}},_e.Wup.prototype.writeVector=function(e,t){var i=new _e.JceOutputStream;if(i.writeVector(0,t),3==this.iVersion)this.newdata.put(e,new _e.BinBuffer(i.getBinBuffer()));else{var s=this.data.get(e),r=t._className();if(null==s)s=new _e.Map(_e.STRING,_e.STRING);s.put(r,new Uint8Array(i.getBuffer())),this.data.put(e,s)}},_e.Wup.prototype.writeStruct=function(e,t){var i=new _e.JceOutputStream;if(i.writeStruct(0,t),3==this.iVersion)this.newdata.put(e,new _e.BinBuffer(i.getBuffer()));else{var s=this.data.get(e);if(null==s)s=new _e.Map(_e.STRING,_e.STRING);s.put(" ",new Uint8Array(i.getBuffer())),this.data.put(e,s)}},_e.Wup.prototype.writeBytes=function(e,t){var i=new _e.JceOutputStream;if(i.writeBytes(0,t),3==this.iVersion)this.newdata.put(e,new _e.BinBuffer(i.getBuffer()));else{var s=this.data.get(e);if(null==s)s=new _e.Map(_e.STRING,_e.STRING);s.put("vec",new Uint8Array(i.getBuffer())),this.data.put(e,s)}},_e.Wup.prototype.writeMap=function(e,t){var i=new _e.JceOutputStream;if(i.writeMap(0,t),3==this.iVersion)this.newdata.put(e,new _e.BinBuffer(i.getBuffer()));else{var s=this.data.get(e),r=_e.Util.getClassType(t);if(null==s)s=new _e.Map(_e.STRING,_e.STRING);s.put(r,new Uint8Array(i.getBuffer())),this.data.put(e,s)}},_e.Wup.prototype.readFrom=function(e){this.iVersion=e.readInt16(1,!0),this.cPacketType=e.readInt8(2,!0),this.iMessageType=e.readInt32(3,!0),this.iRequestId=e.readInt32(4,!0),this.sServantName=e.readString(5,!0),this.sFuncName=e.readString(6,!0),localStorage.__wup&&console.info("%c@@@ "+this.sServantName+"."+this.sFuncName,"color:white;background:black;",this),this.sBuffer=e.readBytes(7,!0),this.iTimeout=e.readInt32(8,!0),this.context=e.readMap(9,!0),this.status=e.readMap(10,!0)},_e.Wup.prototype.decode=function(e){var t=new _e.JceInputStream(e);if(t.buf.vew.getInt32(t.buf.position)<4)throw Error("packet length too short");t.buf.position+=4,this.readFrom(t),t=new _e.JceInputStream(this.sBuffer.getBuffer()),3==this.iVersion?(this.newdata.clear(),t.readMap(0,!0,this.newdata)):(this.data.clear(),t.readMap(0,!0,this.newdata))},_e.Wup.prototype.readBoolean=function(e){var t,i;if(3==this.iVersion){if(null==(t=this.newdata.get(e)))throw Error("UniAttribute not found key:"+e);i=new _e.JceInputStream(t.buffer).readBoolean(0,!0,i)}else{if(null==(t=this.newdata.get(e)))throw Error("UniAttribute not found key:"+e);var s=_e.TypeHelp.BOOLEAN,r=t.get(s);if(null==r)throw Error("UniAttribute not found type:"+s);i=new _e.JceInputStream(r).readBoolean(0,!0,i)}return i},_e.Wup.prototype.readInt8=function(e){var t,i;if(3==this.iVersion){if(null==(t=this.newdata.get(e)))throw Error("UniAttribute not found key:"+e);i=new _e.JceInputStream(t.buffer).readInt8(0,!0,i)}else{if(null==(t=this.newdata.get(e)))throw Error("UniAttribute not found key:"+e);var s=_e.TypeHelp.CHAR,r=t.get(s);if(null==r)throw Error("UniAttribute not found type:"+s);i=new _e.JceInputStream(r).readInt8(0,!0,i)}return i},_e.Wup.prototype.readInt16=function(e){var t,i;if(3==this.iVersion){if(null==(t=this.newdata.get(e)))throw Error("UniAttribute not found key:"+e);i=(a=new _e.JceInputStream(t.buffer)).readInt16(0,!0,i)}else{if(null==(t=this.newdata.get(e)))throw Error("UniAttribute not found key:"+e);var s=_e.TypeHelp.SHORT,r=t.get(s),a=new _e.JceInputStream(r);if(null==r)throw Error("UniAttribute not found type:"+s);i=a.readInt16(0,!0,i)}return i},_e.Wup.prototype.readInt32=function(e){var t,i;if(3==this.iVersion){if(null==(t=this.newdata.get(e)))throw Error("UniAttribute not found key:"+e);i=new _e.JceInputStream(t.buffer).readInt32(0,!0,i)}else{if(null==(t=this.newdata.get(e)))throw Error("UniAttribute not found key:"+e);var s=_e.TypeHelp.INT32,r=t.get(s);if(null==r)throw Error("UniAttribute not found type:"+s);i=new _e.JceInputStream(r).readInt32(0,!0,i)}return i},_e.Wup.prototype.readInt64=function(e){var t,i;if(3==this.iVersion){if(null==(t=this.newdata.get(e)))throw Error("UniAttribute not found key:"+e);i=new _e.JceInputStream(t.buffer).readInt64(0,!0,i)}else{if(null==(t=this.newdata.get(e)))throw Error("UniAttribute not found key:"+e);var s=_e.TypeHelp.INT64,r=t.get(s);if(null==r)throw Error("UniAttribute not found type:"+s);i=new _e.JceInputStream(r).readInt64(0,!0,i)}return i},_e.Wup.prototype.readFloat=function(e){var t,i;if(3==this.iVersion){if(null==(t=this.newdata.get(e)))throw Error("UniAttribute not found key:"+e);i=new _e.JceInputStream(t.buffer).readFloat(0,!0,i)}else{if(null==(t=this.newdata.get(e)))throw Error("UniAttribute not found key:"+e);var s=_e.TypeHelp.FLOAT,r=t.get(s);if(null==r)throw Error("UniAttribute not found type:"+s);i=new _e.JceInputStream(r).readFloat(0,!0,i)}return i},_e.Wup.prototype.readDouble=function(e){var t;if(3==this.iVersion){if(null==(t=this.newdata.get(e)))throw Error("UniAttribute not found key:"+e);var i=new _e.JceInputStream(t.buffer);def=i.readDouble(0,!0,def)}else{if(null==(t=this.newdata.get(e)))throw Error("UniAttribute not found key:"+e);var s=_e.TypeHelp.DOUBLE,r=t.get(s);if(null==r)throw Error("UniAttribute not found type:"+s);i=new _e.JceInputStream(r);def=i.readDouble(0,!0,def)}return def},_e.Wup.prototype.readVector=function(e,t,i){var s;if(3==this.iVersion){if(null==(s=this.newdata.get(e)))throw Error("UniAttribute not found key:"+e);t=new _e.JceInputStream(s.buffer).readVector(0,!0,t)}else{if(null==(s=this.newdata.get(e)))throw Error("UniAttribute not found key:"+e);var r=s.get(i);if(null==r)throw Error("UniAttribute not found type:"+i);t=new _e.JceInputStream(r).readVector(0,!0,t)}return t},_e.Wup.prototype.readStruct=function(e,t,i){var s;if(3==this.iVersion){if(null==(s=this.newdata.get(e)))throw Error("UniAttribute not found key:"+e);t=new _e.JceInputStream(s.buffer).readStruct(0,!0,t)}else{if(null==(s=this.newdata.get(e)))throw Error("UniAttribute not found key:"+e);var r=s.get(i);if(null==r)throw Error("UniAttribute not found type:"+i);t=new _e.JceInputStream(r).readStruct(0,!0,t)}return t},_e.Wup.prototype.readMap=function(e,t,i){var s;if(3==this.iVersion){if(null==(s=this.newdata.get(e)))throw Error("UniAttribute not found key:"+e);t=new _e.JceInputStream(s.buffer).readMap(0,!0,t)}else{if(null==(s=this.newdata.get(e)))throw Error("UniAttribute not found key:"+e);var r=s.get(i);if(null==r)throw Error("UniAttribute not found type:"+i);t=new _e.JceInputStream(r).readMap(0,!0,t)}return t},_e.Wup.prototype.readBytes=function(e,t,i){var s;if(3==this.iVersion){if(null==(s=this.newdata.get(e)))throw Error("UniAttribute not found key:"+e);t=new _e.JceInputStream(s.buffer).readBytes(0,!0,t)}else{if(null==(s=this.newdata.get(e)))throw Error("UniAttribute not found key:"+e);var r=s.get(i);if(null==r)throw Error("UniAttribute not found type:"+i);t=new _e.JceInputStream(r).readBytes(0,!0,t)}return t},_e.DataHelp={EN_INT8:0,EN_INT16:1,EN_INT32:2,EN_INT64:3,EN_FLOAT:4,EN_DOUBLE:5,EN_STRING1:6,EN_STRING4:7,EN_MAP:8,EN_LIST:9,EN_STRUCTBEGIN:10,EN_STRUCTEND:11,EN_ZERO:12,EN_SIMPLELIST:13},_e.TypeHelp={BOOLEAN:"bool",CHAR:"char",SHORT:"short",INT32:"int32",INT64:"int64",FLOAT:"float",DOUBLE:"double",STRING:"string",VECTOR:"list<$t>",MAP:"map<$k, $v>"},_e.BinBuffer=function(e){this.buf=null,this.vew=null,this.len=0,this.position=0,null!=e&&null!=e&&e instanceof _e.BinBuffer&&(this.buf=e.buf,this.vew=new DataView(this.buf),this.len=e.length,this.position=e.position),null!=e&&null!=e&&e instanceof ArrayBuffer&&(this.buf=e,this.vew=new DataView(this.buf),this.len=this.vew.byteLength,this.position=0),this.__defineGetter__("length",(function(){return this.len})),this.__defineGetter__("buffer",(function(){return this.buf}))},_e.BinBuffer.prototype._write=function(e,t,i){return e.writeBytes(t,i)},_e.BinBuffer.prototype._read=function(e,t,i){return e.readBytes(t,!0,i)},_e.BinBuffer.prototype._clone=function(){return new _e.BinBuffer},_e.BinBuffer.prototype.allocate=function(e){if(e=this.position+e,!(null!=this.buf&&this.buf.length>e)){var t=new ArrayBuffer(Math.max(256,2*e));null!=this.buf&&(new Uint8Array(t).set(new Uint8Array(this.buf)),this.buf=void 0),this.buf=t,this.vew=void 0,this.vew=new DataView(this.buf)}},_e.BinBuffer.prototype.getBuffer=function(){var e=new ArrayBuffer(this.len);return new Uint8Array(e).set(new Uint8Array(this.buf,0,this.len)),e},_e.BinBuffer.prototype.memset=function(e,t,i){this.allocate(i),new Uint8Array(this.buf).set(new Uint8Array(e,t,i),this.position)},_e.BinBuffer.prototype.writeInt8=function(e){this.allocate(1),this.vew.setInt8(this.position,e),this.position+=1,this.len=this.position},_e.BinBuffer.prototype.writeUInt8=function(e){this.allocate(1),this.vew.setUint8(this.position++,e),this.len=this.position},_e.BinBuffer.prototype.writeInt16=function(e){this.allocate(2),this.vew.setInt16(this.position,e),this.position+=2,this.len=this.position},_e.BinBuffer.prototype.writeUInt16=function(e){this.allocate(2),this.vew.setUint16(this.position,e),this.position+=2,this.len=this.position},_e.BinBuffer.prototype.writeInt32=function(e){this.allocate(4),this.vew.setInt32(this.position,e),this.position+=4,this.len=this.position},_e.BinBuffer.prototype.writeUInt32=function(e){this.allocate(4),this.vew.setUint32(this.position,e),this.position+=4,this.len=this.position},_e.BinBuffer.prototype.writeInt64=function(e){this.allocate(8),this.vew.setUint32(this.position,parseInt(e/4294967296)),this.vew.setUint32(this.position+4,e%4294967296),this.position+=8,this.len=this.position},_e.BinBuffer.prototype.writeFloat=function(e){this.allocate(4),this.vew.setFloat32(this.position,e),this.position+=4,this.len=this.position},_e.BinBuffer.prototype.writeDouble=function(e){this.allocate(8),this.vew.setFloat64(this.position,e),this.position+=8,this.len=this.position},_e.BinBuffer.prototype.writeString=function(e){for(var t=[],i=0;i<e.length;i++)t.push(255&e.charCodeAt(i));this.allocate(t.length),new Uint8Array(this.buf).set(new Uint8Array(t),this.position),this.position+=t.length,this.len=this.position},_e.BinBuffer.prototype.writeBytes=function(e){0!=e.length&&null!=e.buf&&(this.allocate(e.length),new Uint8Array(this.buf).set(new Uint8Array(e.buf,0,e.length),this.position),this.position+=e.length,this.len=this.position)},_e.BinBuffer.prototype.readInt8=function(){return this.vew.getInt8(this.position++)},_e.BinBuffer.prototype.readInt16=function(){return this.position+=2,this.vew.getInt16(this.position-2)},_e.BinBuffer.prototype.readInt32=function(){return this.position+=4,this.vew.getInt32(this.position-4)},_e.BinBuffer.prototype.readUInt8=function(){return this.position+=1,this.vew.getUint8(this.position-1)},_e.BinBuffer.prototype.readUInt16=function(){return this.position+=2,this.vew.getUint16(this.position-2)},_e.BinBuffer.prototype.readUInt32=function(){return this.position+=4,this.vew.getUint32(this.position-4)},_e.BinBuffer.prototype.readInt64=function(){var e=this.vew.getUint32(this.position),t=this.vew.getUint32(this.position+4);return this.position+=8,4294967296*e+t},_e.BinBuffer.prototype.readFloat=function(){var e=this.vew.getFloat32(this.position);return this.position+=4,e},_e.BinBuffer.prototype.readDouble=function(){var e=this.vew.getFloat64(this.position);return this.position+=8,e},_e.BinBuffer.prototype.readString=function(e){for(var t=[],i=0;i<e;i++)t.push(String.fromCharCode(this.vew.getUint8(this.position++)));var s=t.join("");try{s=decodeURIComponent(escape(s))}catch(e){}return s},_e.BinBuffer.prototype.readBytes=function(e){var t=new _e.BinBuffer;return t.allocate(e),t.memset(this.buf,this.position,e),t.position=0,t.len=e,this.position=this.position+e,t},_e.JceOutputStream=function(){this.buf=new _e.BinBuffer,this.getBinBuffer=function(){return this.buf},this.getBuffer=function(){return this.buf.getBuffer()}},_e.JceOutputStream.prototype.writeTo=function(e,t){e<15?this.buf.writeUInt8(e<<4&240|t):this.buf.writeUInt16((240|t)<<8|e)},_e.JceOutputStream.prototype.writeBoolean=function(e,t){this.writeInt8(e,1==t?1:0)},_e.JceOutputStream.prototype.writeInt8=function(e,t){0==t?this.writeTo(e,_e.DataHelp.EN_ZERO):(this.writeTo(e,_e.DataHelp.EN_INT8),this.buf.writeInt8(t))},_e.JceOutputStream.prototype.writeInt16=function(e,t){t>=-128&&t<=127?this.writeInt8(e,t):(this.writeTo(e,_e.DataHelp.EN_INT16),this.buf.writeInt16(t))},_e.JceOutputStream.prototype.writeInt32=function(e,t){t>=-32768&&t<=32767?this.writeInt16(e,t):(this.writeTo(e,_e.DataHelp.EN_INT32),this.buf.writeInt32(t))},_e.JceOutputStream.prototype.writeInt64=function(e,t){t>=-2147483648&&t<=2147483647?this.writeInt32(e,t):(this.writeTo(e,_e.DataHelp.EN_INT64),this.buf.writeInt64(t))},_e.JceOutputStream.prototype.writeUInt8=function(e,t){this.writeInt16(e,t)},_e.JceOutputStream.prototype.writeUInt16=function(e,t){this.writeInt32(e,t)},_e.JceOutputStream.prototype.writeUInt32=function(e,t){this.writeInt64(e,t)},_e.JceOutputStream.prototype.writeFloat=function(e,t){0==t?this.writeTo(e,_e.DataHelp.EN_ZERO):(this.writeTo(e,_e.DataHelp.EN_FLOAT),this.buf.writeFloat(t))},_e.JceOutputStream.prototype.writeDouble=function(e,t){0==t?this.writeTo(e,_e.DataHelp.EN_ZERO):(this.writeTo(e,_e.DataHelp.EN_DOUBLE),this.buf.writeDouble(t))},_e.JceOutputStream.prototype.writeStruct=function(e,t){if(null==t.writeTo)throw Error("not defined writeTo Function");this.writeTo(e,_e.DataHelp.EN_STRUCTBEGIN),t.writeTo(this),this.writeTo(0,_e.DataHelp.EN_STRUCTEND)},_e.JceOutputStream.prototype.writeString=function(e,t){var i=t;try{i=unescape(encodeURIComponent(i))}catch(e){}i.length>255?(this.writeTo(e,_e.DataHelp.EN_STRING4),this.buf.writeUInt32(i.length)):(this.writeTo(e,_e.DataHelp.EN_STRING1),this.buf.writeUInt8(i.length)),this.buf.writeString(i)},_e.JceOutputStream.prototype.writeBytes=function(e,t){if(!(t instanceof _e.BinBuffer))throw Error("value not instanceof Taf.BinBuffer");this.writeTo(e,_e.DataHelp.EN_SIMPLELIST),this.writeTo(0,_e.DataHelp.EN_INT8),this.writeInt32(0,t.length),this.buf.writeBytes(t)},_e.JceOutputStream.prototype.writeVector=function(e,t){this.writeTo(e,_e.DataHelp.EN_LIST),this.writeInt32(0,t.value.length);for(var i=0;i<t.value.length;i++)t.proto._write(this,0,t.value[i])},_e.JceOutputStream.prototype.writeMap=function(e,t){for(var i in this.writeTo(e,_e.DataHelp.EN_MAP),this.writeInt32(0,t.size()),t.value)t.kproto._write(this,0,i),t.vproto._write(this,1,t.value[i])},_e.JceInputStream=function(e){this.buf=new _e.BinBuffer(e)},_e.JceInputStream.prototype.readFrom=function(){var e=this.buf.readUInt8(),t=(240&e)>>4,i=15&e;return t>=15&&(t=this.buf.readUInt8()),{tag:t,type:i}},_e.JceInputStream.prototype.peekFrom=function(){var e=this.buf.position,t=this.readFrom();return this.buf.position=e,{tag:t.tag,type:t.type,size:t.tag>=15?2:1}},_e.JceInputStream.prototype.skipField=function(e){switch(e){case _e.DataHelp.EN_INT8:this.buf.position+=1;break;case _e.DataHelp.EN_INT16:this.buf.position+=2;break;case _e.DataHelp.EN_INT32:this.buf.position+=4;break;case _e.DataHelp.EN_INT64:this.buf.position+=8;break;case _e.DataHelp.EN_STRING1:var t=this.buf.readUInt8();this.buf.position+=t;break;case _e.DataHelp.EN_STRING4:var i=this.buf.readInt32();this.buf.position+=i;break;case _e.DataHelp.EN_STRUCTBEGIN:this.skipToStructEnd();break;case _e.DataHelp.EN_STRUCTEND:case _e.DataHelp.EN_ZERO:break;case _e.DataHelp.EN_MAP:for(var s=this.readInt32(0,!0),r=0;r<2*s;++r){var a=this.readFrom();this.skipField(a.type)}break;case _e.DataHelp.EN_SIMPLELIST:if((a=this.readFrom()).type!=_e.DataHelp.EN_INT8)throw Error("skipField with invalid type, type value: "+e+","+a.type);t=this.readInt32(0,!0);this.buf.position+=t;break;case _e.DataHelp.EN_LIST:for(s=this.readInt32(0,!0),r=0;r<s;++r){a=this.readFrom();this.skipField(a.type)}break;default:throw new Error("skipField with invalid type, type value: "+e)}},_e.JceInputStream.prototype.skipToStructEnd=function(){for(;;){var e=this.readFrom();if(this.skipField(e.type),e.type==_e.DataHelp.EN_STRUCTEND)return}},_e.JceInputStream.prototype.skipToTag=function(e,t){for(;this.buf.position<this.buf.length;){var i=this.peekFrom();if(e<=i.tag||i.type==_e.DataHelp.EN_STRUCTEND)return i.type!=_e.DataHelp.EN_STRUCTEND&&e==i.tag;this.buf.position+=i.size,this.skipField(i.type)}if(t)throw Error("require field not exist, tag:"+e);return!1},_e.JceInputStream.prototype.readBoolean=function(e,t,i){return 1==this.readInt8(e,t,i)},_e.JceInputStream.prototype.readInt8=function(e,t,i){if(0==this.skipToTag(e,t))return i;var s=this.readFrom();switch(s.type){case _e.DataHelp.EN_ZERO:return 0;case _e.DataHelp.EN_INT8:return this.buf.readInt8()}throw Error("read int8 type mismatch, tag:"+e+", get type:"+s.type)},_e.JceInputStream.prototype.readInt16=function(e,t,i){if(0==this.skipToTag(e,t))return i;var s=this.readFrom();switch(s.type){case _e.DataHelp.EN_ZERO:return 0;case _e.DataHelp.EN_INT8:return this.buf.readInt8();case _e.DataHelp.EN_INT16:return this.buf.readInt16()}throw Error("read int8 type mismatch, tag:"+e+", get type:"+s.type)},_e.JceInputStream.prototype.readInt32=function(e,t,i){if(0==this.skipToTag(e,t))return i;var s=this.readFrom();switch(s.type){case _e.DataHelp.EN_ZERO:return 0;case _e.DataHelp.EN_INT8:return this.buf.readInt8();case _e.DataHelp.EN_INT16:return this.buf.readInt16();case _e.DataHelp.EN_INT32:return this.buf.readInt32()}throw Error("read int8 type mismatch, tag:"+e+", get type:"+s.type)},_e.JceInputStream.prototype.readInt64=function(e,t,i){if(0==this.skipToTag(e,t))return i;switch(this.readFrom().type){case _e.DataHelp.EN_ZERO:return 0;case _e.DataHelp.EN_INT8:return this.buf.readInt8();case _e.DataHelp.EN_INT16:return this.buf.readInt16();case _e.DataHelp.EN_INT32:return this.buf.readInt32();case _e.DataHelp.EN_INT64:return this.buf.readInt64()}throw Error("read int64 type mismatch, tag:"+e+", get type:"+h.type)},_e.JceInputStream.prototype.readFloat=function(e,t,i){if(0==this.skipToTag(e,t))return i;switch(this.readFrom().type){case _e.DataHelp.EN_ZERO:return 0;case _e.DataHelp.EN_FLOAT:return this.buf.readFloat()}throw Error("read float type mismatch, tag:"+e+", get type:"+h.type)},_e.JceInputStream.prototype.readDouble=function(e,t,i){if(0==this.skipToTag(e,t))return i;switch(this.readFrom().type){case _e.DataHelp.EN_ZERO:return 0;case _e.DataHelp.EN_DOUBLE:return this.buf.readDouble()}throw Error("read double type mismatch, tag:"+e+", get type:"+h.type)},_e.JceInputStream.prototype.readUInt8=function(e,t,i){return this.readInt16(e,t,i)},_e.JceInputStream.prototype.readUInt16=function(e,t,i){return this.readInt32(e,t,i)},_e.JceInputStream.prototype.readUInt32=function(e,t,i){return this.readInt64(e,t,i)},_e.JceInputStream.prototype.readStruct=function(e,t,i){if(0==this.skipToTag(e,t))return i;var s=this.readFrom();if(s.type!=_e.DataHelp.EN_STRUCTBEGIN)throw Error("read struct type mismatch, tag: "+e+", get type:"+s.type);return i.readFrom(this),this.skipToStructEnd(),i},_e.JceInputStream.prototype.readString=function(e,t,i){if(0==this.skipToTag(e,t))return i;var s=this.readFrom();if(s.type==_e.DataHelp.EN_STRING1)return this.buf.readString(this.buf.readUInt8());if(s.type==_e.DataHelp.EN_STRING4)return this.buf.readString(this.buf.readUInt32());throw Error("read 'string' type mismatch, tag: "+e+", get type: "+s.type+".")},_e.JceInputStream.prototype.readString2=function(e,t,i){if(0==this.skipToTag(e,t))return i;var s=this.readFrom();if(s.type==_e.DataHelp.EN_STRING1)return this.buf.readBytes(this.buf.readUInt8());if(s.type==_e.DataHelp.EN_STRING4)return this.buf.readBytes(this.buf.readUInt32());throw Error("read 'string' type mismatch, tag: "+e+", get type: "+s.type+".")},_e.JceInputStream.prototype.readBytes=function(e,t,i){if(0==this.skipToTag(e,t))return i;var s=this.readFrom();if(s.type==_e.DataHelp.EN_SIMPLELIST){var r=this.readFrom();if(r.type!=_e.DataHelp.EN_INT8)throw Error("type mismatch, tag:"+e+",type:"+s.type+","+r.type);if((a=this.readInt32(0,!0))<0)throw Error("invalid size, tag:"+e+",type:"+s.type+","+r.type);return this.buf.readBytes(a)}if(s.type==_e.DataHelp.EN_LIST){var a=this.readInt32(0,!0);return this.buf.readBytes(a)}throw Error("type mismatch, tag:"+e+",type:"+s.type)},_e.JceInputStream.prototype.readVector=function(e,t,i){if(0==this.skipToTag(e,t))return i;var s=this.readFrom();if(s.type!=_e.DataHelp.EN_LIST)throw Error("read 'vector' type mismatch, tag: "+e+", get type: "+s.type);var r=this.readInt32(0,!0);if(r<0)throw Error("invalid size, tag: "+e+", type: "+s.type+", size: "+r);for(var a=0;a<r;++a)i.value.push(i.proto._read(this,0,i.proto._clone()));return i},_e.JceInputStream.prototype.readMap=function(e,t,i){if(0==this.skipToTag(e,t))return i;var s=this.readFrom();if(s.type!=_e.DataHelp.EN_MAP)throw Error("read 'map' type mismatch, tag: "+e+", get type: "+s.type);var r=this.readInt32(0,!0);if(r<0)throw Error("invalid map, tag: "+e+", size: "+r);for(var a=0;a<r;a++){var n=i.kproto._read(this,0,i.kproto._clone()),o=i.vproto._read(this,1,i.vproto._clone());i.put(n,o)}return i},_e.Util=_e.Util||{},_e.Util.jcestream=function(e,t){if(null!=e&&null!=e)if(e instanceof ArrayBuffer){t=t||16;for(var i=new Uint8Array(e),s="",r=0;r<i.length;r++)s+=(i[r]>15?"":"0")+i[r].toString(16);console.log(s.toUpperCase())}else console.log("Taf.Util.jcestream::value is not ArrayBuffer");else console.log("Taf.Util.jcestream::value is null or undefined")},_e.Util.str2ab=function(e){var t,i=e.length,s=new Array(i);for(t=0;t<i;++t)s[t]=e.charCodeAt(t);return new Uint8Array(s).buffer},_e.Util.ajax=function(e,t,i,s){var r=new XMLHttpRequest;r.overrideMimeType("text/plain; charset=x-user-defined");r.addEventListener("readystatechange",(function e(){4===r.readyState&&(200===r.status||304===r.status?i(_e.Util.str2ab(r.response)):s(r.status),r.removeEventListener("readystatechange",e),r=void 0)})),r.open("post",e),r.send(t)},_e.INT8=function(){this._clone=function(){return 0},this._write=function(e,t,i){return e.writeInt8(t,i)},this._read=function(e,t,i){return e.readInt8(t,!0,i)},this._className=function(){return _e.CHAR}},_e.INT16=function(){this._clone=function(){return 0},this._write=function(e,t,i){return e.writeInt16(t,i)},this._read=function(e,t,i){return e.readInt16(t,!0,i)},this._className=function(){return _e.SHORT}},_e.INT32=function(){this._clone=function(){return 0},this._write=function(e,t,i){return e.writeInt32(t,i)},this._read=function(e,t,i){return e.readInt32(t,!0,i)},this._className=function(){return _e.INT32}},_e.INT64=function(){this._clone=function(){return 0},this._write=function(e,t,i){return e.writeInt64(t,i)},this._read=function(e,t,i){return e.readInt64(t,!0,i)},this._className=function(){return _e.INT64}},_e.UINT8=function(){this._clone=function(){return 0},this._write=function(e,t,i){return e.writeInt16(t,i)},this._read=function(e,t,i){return e.readInt16(t,!0,i)},this._className=function(){return _e.SHORT}},_e.UInt16=function(){this._clone=function(){return 0},this._write=function(e,t,i){return e.writeInt32(t,i)},this._read=function(e,t,i){return e.readInt32(t,!0,i)},this._className=function(){return _e.INT32}},_e.UInt32=function(){this._clone=function(){return 0},this._write=function(e,t,i){return e.writeInt64(t,i)},this._read=function(e,t,i){return e.readInt64(t,!0,i)},this._className=function(){return _e.INT64}},_e.Float=function(){this._clone=function(){return 0},this._write=function(e,t,i){return e.writeFloat(t,i)},this._read=function(e,t,i){return e.readFloat(t,!0,i)},this._className=function(){return _e.FLOAT}},_e.Double=function(){this._clone=function(){return 0},this._write=function(e,t,i){return e.writeDouble(t,i)},this._read=function(e,t,i){return e.readDouble(t,!0,i)},this._className=function(){return _e.DOUBLE}},_e.STRING=function(){this._clone=function(){return 0},this._write=function(e,t,i){return e.writeString(t,i)},this._read=function(e,t,i){return e.readString(t,!0,i)},this._className=function(){return _e.STRING}},_e.BOOLEAN=function(){this._clone=function(){return!1},this._write=function(e,t,i){return e.writeBoolean(t,i)},this._read=function(e,t,i){return e.readBoolean(t,!0,i)},this._className=function(){return _e.BOOLEAN}},_e.ENUM=function(){this._clone=function(){return 0},this._write=function(e,t,i){return e.writeInt32(t,i)},this._read=function(e,t,i){return e.readInt32(t,!0,i)}},_e.Vector=function(e){this.proto=e,this.value=new Array},_e.Vector.prototype._clone=function(){return new _e.Vector(this.proto)},_e.Vector.prototype._write=function(e,t,i){return e.writeVector(t,i)},_e.Vector.prototype._read=function(e,t,i){return e.readVector(t,!0,i)},_e.Vector.prototype._className=function(){return _e.TypeHelp.VECTOR.replace("$t",this.proto._className())},_e.Map=function(e,t){this.kproto=e,this.vproto=t,this.value=new Object},_e.Map.prototype._clone=function(){return new _e.Map(this.kproto,this.vproto)},_e.Map.prototype._write=function(e,t,i){return e.writeMap(t,i)},_e.Map.prototype._read=function(e,t,i){return e.readMap(t,!0,i)},_e.Map.prototype.put=function(e,t){this.value[e]=t},_e.Map.prototype.get=function(e){return this.value[e]},_e.Map.prototype.remove=function(e){delete this.value[e]},_e.Map.prototype.clear=function(){this.value=new Object},_e.Map.prototype.size=function(){var e=0;for(var t in this.value)e++;return e},_e.Vector.prototype._className=function(){return _e.TypeHelp.Map.replace("$k",this.kproto._className()).replace("$v",this.vproto._className())};var ye=_e,ve=ve||{};ve.EWebSocketCommandType={EWSCmd_NULL:0,EWSCmd_RegisterReq:1,EWSCmd_RegisterRsp:2,EWSCmd_WupReq:3,EWSCmd_WupRsp:4,EWSCmdC2S_HeartBeat:5,EWSCmdS2C_HeartBeatAck:6,EWSCmdS2C_MsgPushReq:7,EWSCmdC2S_DeregisterReq:8,EWSCmdS2C_DeRegisterRsp:9,EWSCmdC2S_VerifyCookieReq:10,EWSCmdS2C_VerifyCookieRsp:11,EWSCmdC2S_VerifyHuyaTokenReq:12,EWSCmdS2C_VerifyHuyaTokenRsp:13,EWSCmdC2S_RegisterGroupReq:16,EWSCmdS2C_RegisterGroupRsp:17,EWSCmdC2S_UnRegisterGroupReq:18,EWSCmdS2C_UnRegisterGroupRsp:19,EWSCmdS2C_MsgPushReq_V2:22},ve.ELiveSource={PC_YY:0,PC_HUYA:1,MOBILE_HUYA:2,WEB_HUYA:3},ve.EGender={MALE:0,FEMALE:1},ve.EClientTemplateType={TPL_PC:64,TPL_WEB:32,TPL_JIEDAI:16,TPL_TEXAS:8,TPL_MATCH:4,TPL_HUYAAPP:2,TPL_MIRROR:1},ve.TemplateType={PRIMARY:1,RECEPTION:2},ve.EStreamLineType={STREAM_LINE_OLD_YY:0,STREAM_LINE_WS:1,STREAM_LINE_NEW_YY:2,STREAM_LINE_AL:3,STREAM_LINE_HUYA:4,STREAM_LINE_TX:5,STREAM_LINE_CDN:8},ve.eUserOperation={USER_IN:1,USER_OUT:2,USER_MOVE:3},ve.WebSocketCommand=function(){this.iCmdType=0,this.vData=new ye.BinBuffer,this.lRequestId=0,this.traceId="",this.iEncryptType=0,this.lTime=0,this.sMD5=""},ve.WebSocketCommand.prototype._clone=function(){return new ve.WebSocketCommand},ve.WebSocketCommand.prototype._write=function(e,t,i){e.writeStruct(t,i)},ve.WebSocketCommand.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},ve.WebSocketCommand.prototype.writeTo=function(e){e.writeInt32(0,this.iCmdType),e.writeBytes(1,this.vData),e.writeInt64(2,this.lRequestId),e.writeString(3,this.traceId),e.writeInt32(4,this.iEncryptType),e.writeInt64(5,this.lTime),e.writeString(6,this.sMD5)},ve.WebSocketCommand.prototype.readFrom=function(e){this.iCmdType=e.readInt32(0,!1,this.iCmdType),this.vData=e.readBytes(1,!1,this.vData),this.lRequestId=e.readInt64(2,!1,this.lRequestId),this.traceId=e.readString(3,!1,this.traceId),this.iEncryptType=e.readInt32(4,!1,this.iEncryptType),this.lTime=e.readInt64(5,!1,this.lTime),this.sMD5=e.readString(6,!1,this.sMD5)},ve.WSPushMessage=function(){this.ePushType=0,this.iUri=0,this.sMsg=new ye.BinBuffer,this.iProtocolType=0},ve.WSPushMessage.prototype._clone=function(){return new ve.WSPushMessage},ve.WSPushMessage.prototype._write=function(e,t,i){e.writeStruct(t,i)},ve.WSPushMessage.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},ve.WSPushMessage.prototype.writeTo=function(e){e.writeInt32(0,this.ePushType),e.writeInt64(1,this.iUri),e.writeBytes(2,this.sMsg),e.writeInt32(3,this.iProtocolType)},ve.WSPushMessage.prototype.readFrom=function(e){this.ePushType=e.readInt32(0,!1,this.ePushType),this.iUri=e.readInt64(1,!1,this.iUri),this.sMsg=e.readBytes(2,!1,this.sMsg),this.iProtocolType=e.readInt32(3,!1,this.iProtocolType)},ve.WSHeartBeat=function(){this.iState=0},ve.WSHeartBeat.prototype._clone=function(){return new ve.WSHeartBeat},ve.WSHeartBeat.prototype._write=function(e,t,i){e.writeStruct(t,i)},ve.WSHeartBeat.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},ve.WSHeartBeat.prototype.writeTo=function(e){e.writeInt32(0,this.iState)},ve.WSHeartBeat.prototype.readFrom=function(e){this.iState=e.readInt32(0,!1,this.iState)},ve.WSUserInfo=function(){this.lUid=0,this.bAnonymous=!0,this.sGuid="",this.sToken="",this.lTid=0,this.lSid=0,this.lGroupId=0,this.lGroupType=0,this.sAppId=""},ve.WSUserInfo.prototype._clone=function(){return new ve.WSUserInfo},ve.WSUserInfo.prototype._write=function(e,t,i){e.writeStruct(t,i)},ve.WSUserInfo.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},ve.WSUserInfo.prototype.writeTo=function(e){e.writeInt64(0,this.lUid),e.writeBoolean(1,this.bAnonymous),e.writeString(2,this.sGuid),e.writeString(3,this.sToken),e.writeInt64(4,this.lTid),e.writeInt64(5,this.lSid),e.writeInt64(6,this.lGroupId),e.writeInt64(7,this.lGroupType),e.writeString(8,this.sAppId)},ve.WSUserInfo.prototype.readFrom=function(e){this.lUid=e.readInt64(0,!1,this.lUid),this.bAnonymous=e.readBoolean(1,!1,this.bAnonymous),this.sGuid=e.readString(2,!1,this.sGuid),this.sToken=e.readString(3,!1,this.sToken),this.lTid=e.readInt64(4,!1,this.lTid),this.lSid=e.readInt64(5,!1,this.lSid),this.lGroupId=e.readInt64(6,!1,this.lGroupId),this.lGroupType=e.readInt64(7,!1,this.lGroupType),this.sAppId=e.readString(8,!1,this.sAppId)},ve.WSVerifyCookieReq=function(){this.lUid=0,this.sUA="",this.sCookie="",this.sGuid="",this.bAutoRegisterUid=0},ve.WSVerifyCookieReq.prototype._clone=function(){return new ve.WSVerifyCookieReq},ve.WSVerifyCookieReq.prototype._write=function(e,t,i){e.writeStruct(t,i)},ve.WSVerifyCookieReq.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},ve.WSVerifyCookieReq.prototype.writeTo=function(e){e.writeInt64(0,this.lUid),e.writeString(1,this.sUA),e.writeString(2,this.sCookie),e.writeString(3,this.sGuid),e.writeInt32(4,this.bAutoRegisterUid)},ve.WSVerifyCookieReq.prototype.readFrom=function(e){this.lUid=e.readInt64(0,!1,this.lUid),this.sUA=e.readString(1,!1,this.sUA),this.sCookie=e.readString(2,!1,this.sCookie),this.sGuid=e.readString(3,!1,this.sGuid),this.bAutoRegisterUid=e.readInt32(4,!1,this.bAutoRegisterUid)},ve.WSVerifyCookieRsp=function(){this.iValidate=0},ve.WSVerifyCookieRsp.prototype._clone=function(){return new ve.WSVerifyCookieRsp},ve.WSVerifyCookieRsp.prototype._write=function(e,t,i){e.writeStruct(t,i)},ve.WSVerifyCookieRsp.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},ve.WSVerifyCookieRsp.prototype.writeTo=function(e){e.writeInt32(0,this.iValidate)},ve.WSVerifyCookieRsp.prototype.readFrom=function(e){this.iValidate=e.readInt32(0,!1,this.iValidate)},ve.UserId=function(){this.lUid=0,this.sGuid="",this.sToken="",this.sHuYaUA="",this.sCookie="",this.iTokenType=0},ve.UserId.prototype._clone=function(){return new ve.UserId},ve.UserId.prototype._write=function(e,t,i){e.writeStruct(t,i)},ve.UserId.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},ve.UserId.prototype.writeTo=function(e){e.writeInt64(0,this.lUid),e.writeString(1,this.sGuid),e.writeString(2,this.sToken),e.writeString(3,this.sHuYaUA),e.writeString(4,this.sCookie),e.writeInt32(5,this.iTokenType)},ve.UserId.prototype.readFrom=function(e){this.lUid=e.readInt64(0,!1,this.lUid),this.sGuid=e.readString(1,!1,this.sGuid),this.sToken=e.readString(2,!1,this.sToken),this.sHuYaUA=e.readString(3,!1,this.sHuYaUA),this.sCookie=e.readString(4,!1,this.sCookie),this.iTokenType=e.readInt32(5,!1,this.iTokenType)},ve.EnterChannelReq=function(){this.tUserId=new ve.UserId,this.lTid=0,this.lSid=0,this.iChannelType=0},ve.EnterChannelReq.prototype._clone=function(){return new ve.EnterChannelReq},ve.EnterChannelReq.prototype._write=function(e,t,i){e.writeStruct(t,i)},ve.EnterChannelReq.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},ve.EnterChannelReq.prototype.writeTo=function(e){e.writeStruct(1,this.tUserId),e.writeInt64(2,this.lTid),e.writeInt64(3,this.lSid),e.writeInt32(4,this.iChannelType)},ve.EnterChannelReq.prototype.readFrom=function(e){this.tUserId=e.readStruct(1,!1,this.tUserId),this.lTid=e.readInt64(2,!1,this.lTid),this.lSid=e.readInt64(3,!1,this.lSid),this.iChannelType=e.readInt32(4,!1,this.iChannelType)},ve.UserEventReq=function(){this.tId=new ve.UserId,this.lTid=0,this.lSid=0,this.eOp=0,this.sChan="",this.eSource=0,this.lPid=0,this.bWatchVideo=!1,this.bAnonymous=!1,this.eTemplateType=ve.TemplateType.PRIMARY,this.sTraceSource=""},ve.UserEventReq.prototype._clone=function(){return new ve.UserEventReq},ve.UserEventReq.prototype._write=function(e,t,i){e.writeStruct(t,i)},ve.UserEventReq.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},ve.UserEventReq.prototype.writeTo=function(e){e.writeStruct(0,this.tId),e.writeInt64(1,this.lTid),e.writeInt64(2,this.lSid),e.writeInt32(4,this.eOp),e.writeString(5,this.sChan),e.writeInt32(6,this.eSource),e.writeInt64(7,this.lPid),e.writeBoolean(8,this.bWatchVideo),e.writeBoolean(9,this.bAnonymous),e.writeInt32(10,this.eTemplateType),e.writeString(11,this.sTraceSource)},ve.UserEventReq.prototype.readFrom=function(e){this.tId=e.readStruct(0,!1,this.tId),this.lTid=e.readInt64(1,!1,this.lTid),this.lSid=e.readInt64(2,!1,this.lSid),this.eOp=e.readInt32(4,!1,this.eOp),this.sChan=e.readString(5,!1,this.sChan),this.eSource=e.readInt32(6,!1,this.eSource),this.lPid=e.readInt64(7,!1,this.lPid),this.bWatchVideo=e.readBoolean(8,!1,this.bWatchVideo),this.bAnonymous=e.readBoolean(9,!1,this.bAnonymous),this.eTemplateType=e.readInt32(10,!1,this.eTemplateType),this.sTraceSource=e.readString(11,!1,this.sTraceSource)},ve.UserEventRsp=function(){this.lTid=0,this.lSid=0,this.iUserHeartBeatInterval=60,this.iPresentHeartBeatInterval=60},ve.UserEventRsp.prototype._clone=function(){return new ve.UserEventRsp},ve.UserEventRsp.prototype._write=function(e,t,i){e.writeStruct(t,i)},ve.UserEventRsp.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},ve.UserEventRsp.prototype.writeTo=function(e){e.writeInt64(0,this.lTid),e.writeInt64(1,this.lSid),e.writeInt32(2,this.iUserHeartBeatInterval),e.writeInt32(3,this.iPresentHeartBeatInterval)},ve.UserEventRsp.prototype.readFrom=function(e){this.lTid=e.readInt64(0,!1,this.lTid),this.lSid=e.readInt64(1,!1,this.lSid),this.iUserHeartBeatInterval=e.readInt32(2,!1,this.iUserHeartBeatInterval),this.iPresentHeartBeatInterval=e.readInt32(3,!1,this.iPresentHeartBeatInterval)},ve.UserHeartBeatReq=function(){this.tId=new ve.UserId,this.lTid=0,this.lSid=0,this.lPid=0,this.bWatchVideo=!1,this.eLineType=ve.EStreamLineType.STREAM_LINE_OLD_YY,this.iFps=0,this.iAttendee=0,this.iBandwidth=0,this.iLastHeartElapseTime=0},ve.UserHeartBeatReq.prototype._clone=function(){return new ve.UserHeartBeatReq},ve.UserHeartBeatReq.prototype._write=function(e,t,i){e.writeStruct(t,i)},ve.UserHeartBeatReq.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},ve.UserHeartBeatReq.prototype.writeTo=function(e){e.writeStruct(0,this.tId),e.writeInt64(1,this.lTid),e.writeInt64(2,this.lSid),e.writeInt64(4,this.lPid),e.writeBoolean(5,this.bWatchVideo),e.writeInt32(6,this.eLineType),e.writeInt32(7,this.iFps),e.writeInt32(8,this.iAttendee),e.writeInt32(9,this.iBandwidth),e.writeInt32(10,this.iLastHeartElapseTime)},ve.UserHeartBeatReq.prototype.readFrom=function(e){this.tId=e.readStruct(0,!1,this.tId),this.lTid=e.readInt64(1,!1,this.lTid),this.lSid=e.readInt64(2,!1,this.lSid),this.lPid=e.readInt64(4,!1,this.lPid),this.bWatchVideo=e.readBoolean(5,!1,this.bWatchVideo),this.eLineType=e.readInt32(6,!1,this.eLineType),this.iFps=e.readInt32(7,!1,this.iFps),this.iAttendee=e.readInt32(8,!1,this.iAttendee),this.iBandwidth=e.readInt32(9,!1,this.iBandwidth),this.iLastHeartElapseTime=e.readInt32(10,!1,this.iLastHeartElapseTime)},ve.UserHeartBeatRsp=function(){this.iRet=0},ve.UserHeartBeatRsp.prototype._clone=function(){return new ve.UserHeartBeatRsp},ve.UserHeartBeatRsp.prototype._write=function(e,t,i){e.writeStruct(t,i)},ve.UserHeartBeatRsp.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},ve.UserHeartBeatRsp.prototype.writeTo=function(e){e.writeInt32(0,this.iRet)},ve.UserHeartBeatRsp.prototype.readFrom=function(e){this.iRet=e.readInt32(0,!1,this.iRet)},ve.SendMessageReq=function(){this.tUserId=new ve.UserId,this.lTid=0,this.lSid=0,this.sContent="",this.iShowMode=0,this.tFormat=new ve.ContentFormat,this.tBulletFormat=new ve.BulletFormat,this.vAtSomeone=new ye.Vector(new ve.UidNickName),this.lPid=0},ve.SendMessageReq.prototype._clone=function(){return new ve.SendMessageReq},ve.SendMessageReq.prototype._write=function(e,t,i){e.writeStruct(t,i)},ve.SendMessageReq.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},ve.SendMessageReq.prototype.writeTo=function(e){e.writeStruct(0,this.tUserId),e.writeInt64(1,this.lTid),e.writeInt64(2,this.lSid),e.writeString(3,this.sContent),e.writeInt32(4,this.iShowMode),e.writeStruct(5,this.tFormat),e.writeStruct(6,this.tBulletFormat),e.writeVector(7,this.vAtSomeone),e.writeInt64(8,this.lPid)},ve.SendMessageReq.prototype.readFrom=function(e){this.tUserId=e.readStruct(0,!1,this.tUserId),this.lTid=e.readInt64(1,!1,this.lTid),this.lSid=e.readInt64(2,!1,this.lSid),this.sContent=e.readString(3,!1,this.sContent),this.iShowMode=e.readInt32(4,!1,this.iShowMode),this.tFormat=e.readStruct(5,!1,this.tFormat),this.tBulletFormat=e.readStruct(6,!1,this.tBulletFormat),this.vAtSomeone=e.readVector(7,!1,this.vAtSomeone),this.lPid=e.readInt64(8,!1,this.lPid)},ve.MessageNotice=function(){this.tUserInfo=new ve.SenderInfo,this.lTid=0,this.lSid=0,this.sContent="",this.iShowMode=0,this.tFormat=new ve.ContentFormat,this.tBulletFormat=new ve.BulletFormat,this.iTermType=0,this.vDecorationPrefix=new ye.Vector(new ve.DecorationInfo),this.vDecorationSuffix=new ye.Vector(new ve.DecorationInfo),this.vAtSomeone=new ye.Vector(new ve.UidNickName),this.lPid=0},ve.MessageNotice.prototype._clone=function(){return new ve.MessageNotice},ve.MessageNotice.prototype._write=function(e,t,i){e.writeStruct(t,i)},ve.MessageNotice.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},ve.MessageNotice.prototype.writeTo=function(e){e.writeStruct(0,this.tUserInfo),e.writeInt64(1,this.lTid),e.writeInt64(2,this.lSid),e.writeString(3,this.sContent),e.writeInt32(4,this.iShowMode),e.writeStruct(5,this.tFormat),e.writeStruct(6,this.tBulletFormat),e.writeInt32(7,this.iTermType),e.writeVector(8,this.vDecorationPrefix),e.writeVector(9,this.vDecorationSuffix),e.writeVector(10,this.vAtSomeone),e.writeInt64(11,this.lPid)},ve.MessageNotice.prototype.readFrom=function(e){this.tUserInfo=e.readStruct(0,!1,this.tUserInfo),this.lTid=e.readInt64(1,!1,this.lTid),this.lSid=e.readInt64(2,!1,this.lSid),this.sContent=e.readString(3,!1,this.sContent),this.iShowMode=e.readInt32(4,!1,this.iShowMode),this.tFormat=e.readStruct(5,!1,this.tFormat),this.tBulletFormat=e.readStruct(6,!1,this.tBulletFormat),this.iTermType=e.readInt32(7,!1,this.iTermType),this.vDecorationPrefix=e.readVector(8,!1,this.vDecorationPrefix),this.vDecorationSuffix=e.readVector(9,!1,this.vDecorationSuffix),this.vAtSomeone=e.readVector(10,!1,this.vAtSomeone),this.lPid=e.readInt64(11,!1,this.lPid)},ve.ContentFormat=function(){this.iFontColor=-1,this.iFontSize=4,this.iPopupStyle=0},ve.ContentFormat.prototype._clone=function(){return new ve.ContentFormat},ve.ContentFormat.prototype._write=function(e,t,i){e.writeStruct(t,i)},ve.ContentFormat.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},ve.ContentFormat.prototype.writeTo=function(e){e.writeInt32(0,this.iFontColor),e.writeInt32(1,this.iFontSize),e.writeInt32(2,this.iPopupStyle)},ve.ContentFormat.prototype.readFrom=function(e){this.iFontColor=e.readInt32(0,!1,this.iFontColor),this.iFontSize=e.readInt32(1,!1,this.iFontSize),this.iPopupStyle=e.readInt32(2,!1,this.iPopupStyle)},ve.BulletFormat=function(){this.iFontColor=-1,this.iFontSize=4,this.iTextSpeed=0,this.iTransitionType=1,this.iPopupStyle=0},ve.BulletFormat.prototype._clone=function(){return new ve.BulletFormat},ve.BulletFormat.prototype._write=function(e,t,i){e.writeStruct(t,i)},ve.BulletFormat.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},ve.BulletFormat.prototype.writeTo=function(e){e.writeInt32(0,this.iFontColor),e.writeInt32(1,this.iFontSize),e.writeInt32(2,this.iTextSpeed),e.writeInt32(3,this.iTransitionType),e.writeInt32(4,this.iPopupStyle)},ve.BulletFormat.prototype.readFrom=function(e){this.iFontColor=e.readInt32(0,!1,this.iFontColor),this.iFontSize=e.readInt32(1,!1,this.iFontSize),this.iTextSpeed=e.readInt32(2,!1,this.iTextSpeed),this.iTransitionType=e.readInt32(3,!1,this.iTransitionType),this.iPopupStyle=e.readInt32(4,!1,this.iPopupStyle)},ve.UidNickName=function(){this.lUid=0,this.sNickName=""},ve.UidNickName.prototype._clone=function(){return new ve.UidNickName},ve.UidNickName.prototype._write=function(e,t,i){e.writeStruct(t,i)},ve.UidNickName.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},ve.UidNickName.prototype.writeTo=function(e){e.writeInt64(0,this.lUid),e.writeString(1,this.sNickName)},ve.UidNickName.prototype.readFrom=function(e){this.lUid=e.readInt64(0,!1,this.lUid),this.sNickName=e.readString(1,!1,this.sNickName)},ve.SenderInfo=function(){this.lUid=0,this.lImid=0,this.sNickName="",this.iGender=0,this.sAvatarUrl=""},ve.SenderInfo.prototype._clone=function(){return new ve.SenderInfo},ve.SenderInfo.prototype._write=function(e,t,i){e.writeStruct(t,i)},ve.SenderInfo.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},ve.SenderInfo.prototype.writeTo=function(e){e.writeInt64(0,this.lUid),e.writeInt64(1,this.lImid),e.writeString(2,this.sNickName),e.writeInt32(3,this.iGender),e.writeString(4,this.sAvatarUrl)},ve.SenderInfo.prototype.readFrom=function(e){this.lUid=e.readInt64(0,!1,this.lUid),this.lImid=e.readInt64(1,!1,this.lImid),this.sNickName=e.readString(2,!1,this.sNickName),this.iGender=e.readInt32(3,!1,this.iGender),this.sAvatarUrl=e.readString(4,!1,this.sAvatarUrl)},ve.DecorationInfo=function(){this.iAppId=0,this.iViewType=0,this.vData=new ye.BinBuffer},ve.DecorationInfo.prototype._clone=function(){return new ve.DecorationInfo},ve.DecorationInfo.prototype._write=function(e,t,i){e.writeStruct(t,i)},ve.DecorationInfo.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},ve.DecorationInfo.prototype.writeTo=function(e){e.writeInt32(0,this.iAppId),e.writeInt32(1,this.iViewType),e.writeBytes(2,this.vData)},ve.DecorationInfo.prototype.readFrom=function(e){this.iAppId=e.readInt32(0,!1,this.iAppId),this.iViewType=e.readInt32(1,!1,this.iViewType),this.vData=e.readBytes(2,!1,this.vData)},ve.EDecorationAppType={kDecorationAppTypeCommon:100,kDecorationAppTypeChannel:1e4,kDecorationAppTypeAdmin:10100,kDecorationAppTypeDaiyanClub:10150,kDecorationAppTypeNoble:10200,kDecorationAppTypeGuard:10300,kDecorationAppTypeFans:10400,kDecorationAppTypeVIP:10500,kDecorationAppTypeUserProfile:10560,kDecorationAppTyperPurpleDiamond:10600,kDecorationAppTypeStamp:10700,KDecorationAppTypeNobleEmoticon:10800,KDecorationAppTypePresenter:10900},ve.EDecorationViewType={kDecorationViewTypeCustomized:0,kDecorationViewTypeText:1,kDecorationViewTypeIcon:2},ve.LiveLaunchReq=function(){this.tId=new ve.UserId,this.tLiveUB=new ve.LiveUserbase,this.bSupportDomain=0},ve.LiveLaunchReq.prototype._clone=function(){return new ve.LiveLaunchReq},ve.LiveLaunchReq.prototype._write=function(e,t,i){e.writeStruct(t,i)},ve.LiveLaunchReq.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},ve.LiveLaunchReq.prototype.writeTo=function(e){e.writeStruct(0,this.tId),e.writeStruct(1,this.tLiveUB),e.writeInt32(2,this.bSupportDomain)},ve.LiveLaunchReq.prototype.readFrom=function(e){this.tId=e.readStruct(0,!1,this.tId),this.tLiveUB=e.readStruct(1,!1,this.tLiveUB),this.bSupportDomain=e.readInt32(2,!1,this.bSupportDomain)},ve.LiveLaunchRsp=function(){this.sGuid="",this.iTime=0,this.vProxyList=new ye.Vector(new ve.LiveProxyValue),this.eAccess=0},ve.LiveLaunchRsp.prototype._clone=function(){return new ve.LiveLaunchRsp},ve.LiveLaunchRsp.prototype._write=function(e,t,i){e.writeStruct(t,i)},ve.LiveLaunchRsp.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},ve.LiveLaunchRsp.prototype.writeTo=function(e){e.writeString(0,this.sGuid),e.writeInt32(1,this.iTime),e.writeVector(2,this.vProxyList),e.writeInt32(3,this.eAccess)},ve.LiveLaunchRsp.prototype.readFrom=function(e){this.sGuid=e.readString(0,!1,this.sGuid),this.iTime=e.readInt32(1,!1,this.iTime),this.vProxyList=e.readVector(2,!1,this.vProxyList),this.eAccess=e.readInt32(3,!1,this.eAccess)},ve.LiveAppUAEx=function(){this.sIMEI="",this.sAPN="",this.sNetType="",this.sDeviceId=""},ve.LiveAppUAEx.prototype._clone=function(){return new ve.LiveAppUAEx},ve.LiveAppUAEx.prototype._write=function(e,t,i){e.writeStruct(t,i)},ve.LiveAppUAEx.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},ve.LiveAppUAEx.prototype.writeTo=function(e){e.writeString(1,this.sIMEI),e.writeString(2,this.sAPN),e.writeString(3,this.sNetType),e.writeString(4,this.sDeviceId)},ve.LiveAppUAEx.prototype.readFrom=function(e){this.sIMEI=e.readString(1,!1,this.sIMEI),this.sAPN=e.readString(2,!1,this.sAPN),this.sNetType=e.readString(3,!1,this.sNetType),this.sDeviceId=e.readString(4,!1,this.sDeviceId)},ve.LiveUserbase=function(){this.eSource=0,this.eType=0,this.tUAEx=new ve.LiveAppUAEx},ve.LiveUserbase.prototype._clone=function(){return new ve.LiveUserbase},ve.LiveUserbase.prototype._write=function(e,t,i){e.writeStruct(t,i)},ve.LiveUserbase.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},ve.LiveUserbase.prototype.writeTo=function(e){e.writeInt32(0,this.eSource),e.writeInt32(1,this.eType),e.writeStruct(2,this.tUAEx)},ve.LiveUserbase.prototype.readFrom=function(e){this.eSource=e.readInt32(0,!1,this.eSource),this.eType=e.readInt32(1,!1,this.eType),this.tUAEx=e.readStruct(2,!1,this.tUAEx)},ve.LiveProxyValue=function(){this.eProxyType=0,this.sProxy=new ye.Vector(new ye.STRING)},ve.LiveProxyValue.prototype._clone=function(){return new ve.LiveProxyValue},ve.LiveProxyValue.prototype._write=function(e,t,i){e.writeStruct(t,i)},ve.LiveProxyValue.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},ve.LiveProxyValue.prototype.writeTo=function(e){e.writeInt32(0,this.eProxyType),e.writeVector(1,this.sProxy)},ve.LiveProxyValue.prototype.readFrom=function(e){this.eProxyType=e.readInt32(0,!1,this.eProxyType),this.sProxy=e.readVector(1,!1,this.sProxy)},ve.EndLiveNotice=function(){this.lPresenterUid=0,this.iReason=0,this.lLiveId=0,this.sReason=""},ve.EndLiveNotice.prototype._clone=function(){return new ve.EndLiveNotice},ve.EndLiveNotice.prototype._write=function(e,t,i){e.writeStruct(t,i)},ve.EndLiveNotice.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},ve.EndLiveNotice.prototype.writeTo=function(e){e.writeInt64(0,this.lPresenterUid),e.writeInt32(1,this.iReason),e.writeInt64(2,this.lLiveId),e.writeString(3,this.sReason)},ve.EndLiveNotice.prototype.readFrom=function(e){this.lPresenterUid=e.readInt64(0,!1,this.lPresenterUid),this.iReason=e.readInt32(1,!1,this.iReason),this.lLiveId=e.readInt64(2,!1,this.lLiveId),this.sReason=e.readString(3,!1,this.sReason)},ve.GetWebdbUserInfoReq=function(){this.lUid=0,this.lImid=0,this.sPassport="",this.sAccount="",this.bCacheFirst=!0},ve.GetWebdbUserInfoReq.prototype._clone=function(){return new ve.GetWebdbUserInfoReq},ve.GetWebdbUserInfoReq.prototype._write=function(e,t,i){e.writeStruct(t,i)},ve.GetWebdbUserInfoReq.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},ve.GetWebdbUserInfoReq.prototype.writeTo=function(e){e.writeInt64(0,this.lUid),e.writeInt64(1,this.lImid),e.writeString(2,this.sPassport),e.writeString(3,this.sAccount),e.writeBoolean(4,this.bCacheFirst)},ve.GetWebdbUserInfoReq.prototype.readFrom=function(e){this.lUid=e.readInt64(0,!1,this.lUid),this.lImid=e.readInt64(1,!1,this.lImid),this.sPassport=e.readString(2,!1,this.sPassport),this.sAccount=e.readString(3,!1,this.sAccount),this.bCacheFirst=e.readBoolean(4,!1,this.bCacheFirst)},ve.GetWebdbUserInfoRsp=function(){this.tUserInfo=new ve.DBUserInfo},ve.GetWebdbUserInfoRsp.prototype._clone=function(){return new ve.GetWebdbUserInfoRsp},ve.GetWebdbUserInfoRsp.prototype._write=function(e,t,i){e.writeStruct(t,i)},ve.GetWebdbUserInfoRsp.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},ve.GetWebdbUserInfoRsp.prototype.writeTo=function(e){e.writeStruct(0,this.tUserInfo)},ve.GetWebdbUserInfoRsp.prototype.readFrom=function(e){this.tUserInfo=e.readStruct(0,!1,this.tUserInfo)},ve.DBUserInfo=function(){this.lUid=0,this.sPassport="",this.sAccount="",this.sNick="",this.iSex=0,this.iBirthday=0,this.sArea="",this.sProvince="",this.sCity="",this.sSign="",this.sIntro="",this.iJifen=0,this.sRegisterTime="",this.sHdlogo="",this.sSessionCard="",this.lImid=0,this.iLogoIndex=0},ve.DBUserInfo.prototype._clone=function(){return new ve.DBUserInfo},ve.DBUserInfo.prototype._write=function(e,t,i){e.writeStruct(t,i)},ve.DBUserInfo.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},ve.DBUserInfo.prototype.writeTo=function(e){e.writeInt64(0,this.lUid),e.writeString(1,this.sPassport),e.writeString(2,this.sAccount),e.writeString(3,this.sNick),e.writeInt32(4,this.iSex),e.writeInt32(5,this.iBirthday),e.writeString(6,this.sArea),e.writeString(7,this.sProvince),e.writeString(8,this.sCity),e.writeString(9,this.sSign),e.writeString(10,this.sIntro),e.writeInt32(11,this.iJifen),e.writeString(12,this.sRegisterTime),e.writeString(13,this.sHdlogo),e.writeString(14,this.sSessionCard),e.writeInt64(16,this.lImid),e.writeInt32(17,this.iLogoIndex)},ve.DBUserInfo.prototype.readFrom=function(e){this.lUid=e.readInt64(0,!1,this.lUid),this.sPassport=e.readString(1,!1,this.sPassport),this.sAccount=e.readString(2,!1,this.sAccount),this.sNick=e.readString(3,!1,this.sNick),this.iSex=e.readInt32(4,!1,this.iSex),this.iBirthday=e.readInt32(5,!1,this.iBirthday),this.sArea=e.readString(6,!1,this.sArea),this.sProvince=e.readString(7,!1,this.sProvince),this.sCity=e.readString(8,!1,this.sCity),this.sSign=e.readString(9,!1,this.sSign),this.sIntro=e.readString(10,!1,this.sIntro),this.iJifen=e.readInt32(11,!1,this.iJifen),this.sRegisterTime=e.readString(12,!1,this.sRegisterTime),this.sHdlogo=e.readString(13,!1,this.sHdlogo),this.sSessionCard=e.readString(14,!1,this.sSessionCard),this.lImid=e.readInt64(16,!1,this.lImid),this.iLogoIndex=e.readInt32(17,!1,this.iLogoIndex)},ve.UserChannelReq=function(){this.tId=new ve.UserId,this.lTopcid=0,this.lSubcid=0,this.sSendContent=""},ve.UserChannelReq.prototype._clone=function(){return new ve.UserChannelReq},ve.UserChannelReq.prototype._write=function(e,t,i){e.writeStruct(t,i)},ve.UserChannelReq.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},ve.UserChannelReq.prototype.writeTo=function(e){e.writeStruct(0,this.tId),e.writeInt64(1,this.lTopcid),e.writeInt64(2,this.lSubcid),e.writeString(3,this.sSendContent)},ve.UserChannelReq.prototype.readFrom=function(e){this.tId=e.readStruct(0,!1,this.tId),this.lTopcid=e.readInt64(1,!1,this.lTopcid),this.lSubcid=e.readInt64(2,!1,this.lSubcid),this.sSendContent=e.readString(3,!1,this.sSendContent)},ve.WSRegisterGroupReq=function(){this.vGroupId=new ye.Vector(new ye.STRING)},ve.WSRegisterGroupReq.prototype._clone=function(){return new ve.WSRegisterGroupReq},ve.WSRegisterGroupReq.prototype._write=function(e,t,i){e.writeStruct(t,i)},ve.WSRegisterGroupReq.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},ve.WSRegisterGroupReq.prototype.writeTo=function(e){e.writeVector(0,this.vGroupId)},ve.WSRegisterGroupReq.prototype.readFrom=function(e){this.vGroupId=e.readVector(0,!1,this.vGroupId)},ve.WSRegisterGroupRsp=function(){this.iResCode=0},ve.WSRegisterGroupRsp.prototype._clone=function(){return new ve.WSRegisterGroupRsp},ve.WSRegisterGroupRsp.prototype._write=function(e,t,i){e.writeStruct(t,i)},ve.WSRegisterGroupRsp.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},ve.WSRegisterGroupRsp.prototype.writeTo=function(e){e.writeInt32(0,this.iResCode)},ve.WSRegisterGroupRsp.prototype.readFrom=function(e){this.iResCode=e.readInt32(0,!1,this.iResCode)},ve.WSUnRegisterGroupReq=function(){this.vGroupId=new ye.Vector(new ye.STRING)},ve.WSUnRegisterGroupReq.prototype._clone=function(){return new ve.WSUnRegisterGroupReq},ve.WSUnRegisterGroupReq.prototype._write=function(e,t,i){e.writeStruct(t,i)},ve.WSUnRegisterGroupReq.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},ve.WSUnRegisterGroupReq.prototype.writeTo=function(e){e.writeVector(0,this.vGroupId)},ve.WSUnRegisterGroupReq.prototype.readFrom=function(e){this.vGroupId=e.readVector(0,!1,this.vGroupId)},ve.WSUnRegisterGroupRsp=function(){this.iResCode=0},ve.WSUnRegisterGroupRsp.prototype._clone=function(){return new ve.WSUnRegisterGroupRsp},ve.WSUnRegisterGroupRsp.prototype._write=function(e,t,i){e.writeStruct(t,i)},ve.WSUnRegisterGroupRsp.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},ve.WSUnRegisterGroupRsp.prototype.writeTo=function(e){e.writeInt32(0,this.iResCode)},ve.WSUnRegisterGroupRsp.prototype.readFrom=function(e){this.iResCode=e.readInt32(0,!1,this.iResCode)},ve.WSPushMessage_V2=function(){this.sGroupId="",this.vMsgItem=new ye.Vector(new ve.WSMsgItem)},ve.WSPushMessage_V2.prototype._clone=function(){return new ve.WSPushMessage_V2},ve.WSPushMessage_V2.prototype._write=function(e,t,i){e.writeStruct(t,i)},ve.WSPushMessage_V2.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},ve.WSPushMessage_V2.prototype.writeTo=function(e){e.writeString(0,this.sGroupId),e.writeVector(1,this.vMsgItem)},ve.WSPushMessage_V2.prototype.readFrom=function(e){this.sGroupId=e.readString(0,!1,this.sGroupId),this.vMsgItem=e.readVector(1,!1,this.vMsgItem)},ve.WSMsgItem=function(){this.iUri=0,this.sMsg=new ye.BinBuffer},ve.WSMsgItem.prototype._clone=function(){return new ve.WSMsgItem},ve.WSMsgItem.prototype._write=function(e,t,i){e.writeStruct(t,i)},ve.WSMsgItem.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},ve.WSMsgItem.prototype.writeTo=function(e){e.writeInt64(0,this.iUri),e.writeBytes(1,this.sMsg)},ve.WSMsgItem.prototype.readFrom=function(e){this.iUri=e.readInt64(0,!1,this.iUri),this.sMsg=e.readBytes(1,!1,this.sMsg)},ve.MetricDetailSet=function(){this.tId=new ve.UserId,this.vMetricDetail=new ye.Vector(new ve.MetricDetail)},ve.MetricDetailSet.prototype._clone=function(){return new ve.MetricDetailSet},ve.MetricDetailSet.prototype._write=function(e,t,i){e.writeStruct(t,i)},ve.MetricDetailSet.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},ve.MetricDetailSet.prototype.writeTo=function(e){e.writeStruct(0,this.tId),e.writeVector(1,this.vMetricDetail)},ve.MetricDetailSet.prototype.readFrom=function(e){this.tId=e.readStruct(0,!0,this.tId),this.vMetricDetail=e.readVector(1,!0,this.vMetricDetail)},ve.MetricDetail=function(){this.sMetricName="",this.iTS=0,this.vDimension=new ye.Vector(new ve.Dimension),this.vFiled=new ye.Vector(new ve.Field),this.vExLog=new ye.Vector(new ve.Dimension)},ve.MetricDetail.prototype._clone=function(){return new ve.MetricDetail},ve.MetricDetail.prototype._write=function(e,t,i){e.writeStruct(t,i)},ve.MetricDetail.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},ve.MetricDetail.prototype.writeTo=function(e){e.writeString(0,this.sMetricName),e.writeInt64(1,this.iTS),e.writeVector(2,this.vDimension),e.writeVector(3,this.vFiled),e.writeVector(4,this.vExLog)},ve.MetricDetail.prototype.readFrom=function(e){this.sMetricName=e.readString(0,!0,this.sMetricName),this.iTS=e.readInt64(1,!1,this.iTS),this.vDimension=e.readVector(2,!1,this.vDimension),this.vFiled=e.readVector(3,!1,this.vFiled),this.vExLog=e.readVector(4,!1,this.vExLog)},ve.Field=function(){this.sName="",this.fValue=0},ve.Field.prototype._clone=function(){return new ve.Field},ve.Field.prototype._write=function(e,t,i){e.writeStruct(t,i)},ve.Field.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},ve.Field.prototype.writeTo=function(e){e.writeString(0,this.sName),e.writeDouble(1,this.fValue)},ve.Field.prototype.readFrom=function(e){this.sName=e.readString(0,!1,this.sName),this.fValue=e.readDouble(1,!1,this.fValue)},ve.Dimension=function(){this.sName="",this.sValue=""},ve.Dimension.prototype._clone=function(){return new ve.Dimension},ve.Dimension.prototype._write=function(e,t,i){e.writeStruct(t,i)},ve.Dimension.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},ve.Dimension.prototype.writeTo=function(e){e.writeString(0,this.sName),e.writeString(1,this.sValue)},ve.Dimension.prototype.readFrom=function(e){this.sName=e.readString(0,!1,this.sName),this.sValue=e.readString(1,!1,this.sValue)},ve.GetLiveViewLimitInfoReq=function(){this.tId=new ve.UserId,this.lPid=0},ve.GetLiveViewLimitInfoReq.prototype._clone=function(){return new ve.GetLiveViewLimitInfoReq},ve.GetLiveViewLimitInfoReq.prototype._write=function(e,t,i){e.writeStruct(t,i)},ve.GetLiveViewLimitInfoReq.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},ve.GetLiveViewLimitInfoReq.prototype.writeTo=function(e){e.writeStruct(0,this.tId),e.writeInt64(1,this.lPid)},ve.GetLiveViewLimitInfoReq.prototype.readFrom=function(e){this.tId=e.readStruct(0,!1,this.tId),this.lPid=e.readInt64(1,!1,this.lPid)},ve.GetLiveViewLimitInfoRsp=function(){this.tLimitInfo=new ve.LiveViewLimitInfo},ve.GetLiveViewLimitInfoRsp.prototype._clone=function(){return new ve.GetLiveViewLimitInfoRsp},ve.GetLiveViewLimitInfoRsp.prototype._write=function(e,t,i){e.writeStruct(t,i)},ve.GetLiveViewLimitInfoRsp.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},ve.GetLiveViewLimitInfoRsp.prototype.writeTo=function(e){e.writeStruct(0,this.tLimitInfo)},ve.GetLiveViewLimitInfoRsp.prototype.readFrom=function(e){this.tLimitInfo=e.readStruct(0,!1,this.tLimitInfo)},ve.LiveViewLimitInfo=function(){this.iLimitType=0,this.lRemainTime=0,this.sLimitMessage="",this.sLimitTitle="",this.sPayUrl="",this.sFreeWatchTips="",this.iLiveType=0,this.mpExtend=new ye.Map(new ye.STRING,new ye.STRING)},ve.LiveViewLimitInfo.prototype._clone=function(){return new ve.LiveViewLimitInfo},ve.LiveViewLimitInfo.prototype._write=function(e,t,i){e.writeStruct(t,i)},ve.LiveViewLimitInfo.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},ve.LiveViewLimitInfo.prototype.writeTo=function(e){e.writeInt32(0,this.iLimitType),e.writeInt64(1,this.lRemainTime),e.writeString(2,this.sLimitMessage),e.writeString(3,this.sLimitTitle),e.writeString(4,this.sPayUrl),e.writeString(5,this.sFreeWatchTips),e.writeInt32(6,this.iLiveType),e.writeMap(7,this.mpExtend)},ve.LiveViewLimitInfo.prototype.readFrom=function(e){this.iLimitType=e.readInt32(0,!1,this.iLimitType),this.lRemainTime=e.readInt64(1,!1,this.lRemainTime),this.sLimitMessage=e.readString(2,!1,this.sLimitMessage),this.sLimitTitle=e.readString(3,!1,this.sLimitTitle),this.sPayUrl=e.readString(4,!1,this.sPayUrl),this.sFreeWatchTips=e.readString(5,!1,this.sFreeWatchTips),this.iLiveType=e.readInt32(6,!1,this.iLiveType),this.mpExtend=e.readMap(7,!1,this.mpExtend)},ve.LiveViewLimitChangeNotice=function(){this.lRandomDelayTimeMs=3e3,this.lPid=0},ve.LiveViewLimitChangeNotice.prototype._clone=function(){return new ve.LiveViewLimitChangeNotice},ve.LiveViewLimitChangeNotice.prototype._write=function(e,t,i){e.writeStruct(t,i)},ve.LiveViewLimitChangeNotice.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},ve.LiveViewLimitChangeNotice.prototype.writeTo=function(e){e.writeInt64(0,this.lRandomDelayTimeMs),e.writeInt64(1,this.lPid)},ve.LiveViewLimitChangeNotice.prototype.readFrom=function(e){this.lRandomDelayTimeMs=e.readInt64(0,!1,this.lRandomDelayTimeMs),this.lPid=e.readInt64(1,!1,this.lPid)},ve.GetOrderBroadcastInfoReq=function(){this.busses=new ye.Vector(new ye.STRING),this.anthorId=0,this.streamName="",this.appid=0},ve.GetOrderBroadcastInfoReq.prototype._clone=function(){return new ve.GetOrderBroadcastInfoReq},ve.GetOrderBroadcastInfoReq.prototype._write=function(e,t,i){e.writeStruct(t,i)},ve.GetOrderBroadcastInfoReq.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},ve.GetOrderBroadcastInfoReq.prototype.writeTo=function(e){e.writeVector(0,this.busses),e.writeInt64(1,this.anthorId),e.writeString(2,this.streamName),e.writeInt32(3,this.appid)},ve.GetOrderBroadcastInfoRsp=function(){this.ret=0,this.anthorId=0,this.broadcastInfos=new ye.Vector(new ve.OrderBroadcastInfo)},ve.GetOrderBroadcastInfoRsp.prototype._clone=function(){return new ve.GetOrderBroadcastInfoRsp},ve.GetOrderBroadcastInfoRsp.prototype._write=function(e,t,i){e.writeStruct(t,i)},ve.GetOrderBroadcastInfoRsp.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},ve.GetOrderBroadcastInfoRsp.prototype.readFrom=function(e){this.ret=e.readInt32(0,!1,this.ret),this.anthorId=e.readInt64(1,!1,this.anthorId),this.broadcastInfos=e.readVector(2,!1,this.broadcastInfos)},ve.OrderBroadcastInfo=function(){this.buss="",this.enable=0,this.broadcastGroup="",this.uri=0,this.configJson=""},ve.OrderBroadcastInfo.prototype._clone=function(){return new ve.OrderBroadcastInfo},ve.OrderBroadcastInfo.prototype._write=function(e,t,i){e.writeStruct(t,i)},ve.OrderBroadcastInfo.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},ve.OrderBroadcastInfo.prototype.writeTo=function(e){e.writeString(0,this.buss),e.writeInt32(1,this.enable),e.writeString(2,this.broadcastGroup),e.writeInt32(3,this.uri),e.writeString(4,this.configJson)},ve.OrderBroadcastInfo.prototype.readFrom=function(e){this.buss=e.readString(0,!1,this.buss),this.enable=e.readInt32(1,!1,this.enable),this.broadcastGroup=e.readString(2,!1,this.broadcastGroup),this.uri=e.readInt32(3,!1,this.uri),this.configJson=e.readString(4,!1,this.configJson)},ve.PixelateInfo=function(){this.dtsType=0,this.beginDts=0,this.endDts=0,this.pixelateKey=0,this.shapeInfos=new ye.BinBuffer},ve.PixelateInfo.prototype._clone=function(){return new ve.PixelateInfo},ve.PixelateInfo.prototype._write=function(e,t,i){e.writeStruct(t,i)},ve.PixelateInfo.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},ve.PixelateInfo.prototype.writeTo=function(e){e.writeInt32(0,this.dtsType),e.writeUInt32(1,this.beginDts),e.writeUInt32(2,this.endDts),e.writeUInt32(3,this.pixelateKey),e.writeBytes(4,this.shapeInfos)},ve.PixelateInfo.prototype.readFrom=function(e){this.dtsType=e.readInt32(0,!1,this.dtsType),this.beginDts=e.readUInt32(1,!1,this.beginDts),this.endDts=e.readUInt32(2,!1,this.endDts),this.pixelateKey=e.readUInt32(3,!1,this.pixelateKey),this.shapeInfos=e.readBytes(4,!1,this.shapeInfos)},ve.MaskShape=function(){this.points=new ye.Vector(new ye.INT64),this.type=0,this.x=0,this.y=0,this.w=0,this.h=0,this.ext="",this.pixelcolor=0,this.reqKey=0,this.pic_id=0},ve.MaskShape.prototype._clone=function(){return new ve.MaskShape},ve.MaskShape.prototype._write=function(e,t,i){e.writeStruct(t,i)},ve.MaskShape.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},ve.MaskShape.prototype.writeTo=function(e){e.writeVector(0,this.points),e.writeUInt32(1,this.type),e.writeUInt32(2,this.x),e.writeUInt32(3,this.y),e.writeUInt32(4,this.w),e.writeUInt32(5,this.h),e.writeString(6,this.ext),e.writeUInt32(8,this.pixelcolor),e.writeInt64(10,this.reqKey),e.writeUInt32(11,this.pic_id)},ve.MaskShape.prototype.readFrom=function(e){this.points=e.readVector(0,!1,this.points),this.type=e.readUInt32(1,!1,this.type),this.x=e.readUInt32(2,!1,this.x),this.y=e.readUInt32(3,!1,this.y),this.w=e.readUInt32(4,!1,this.w),this.h=e.readUInt32(5,!1,this.h),this.ext=e.readString(6,!1,this.ext),this.pixelcolor=e.readUInt32(8,!1,this.pixelcolor),this.reqKey=e.readInt64(10,!1,this.reqKey),this.pic_id=e.readUInt32(11,!1,this.pic_id)},ve.SafeRoiMaskProto=function(){this.ver_no=0,this.dts=0,this.frame_width=0,this.frame_height=0,this.contrs=new ye.Vector(new ve.MaskShape),this.ext=""},ve.SafeRoiMaskProto.prototype._clone=function(){return new ve.SafeRoiMaskProto},ve.SafeRoiMaskProto.prototype._write=function(e,t,i){e.writeStruct(t,i)},ve.SafeRoiMaskProto.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},ve.SafeRoiMaskProto.prototype.writeTo=function(e){e.writeUInt32(0,this.ver_no),e.writeUInt32(1,this.dts),e.writeUInt32(2,this.frame_width),e.writeUInt32(3,this.frame_height),e.writeVector(4,this.contrs),e.writeString(5,this.ext)},ve.SafeRoiMaskProto.prototype.readFrom=function(e){this.ver_no=e.readUInt32(0,!1,this.ver_no),this.dts=e.readUInt32(1,!1,this.dts),this.frame_width=e.readUInt32(2,!1,this.frame_width),this.frame_height=e.readUInt32(3,!1,this.frame_height),this.contrs=e.readVector(4,!1,this.contrs),this.ext=e.readString(5,!1,this.ext)},ve.VoiceMuteJsonInfo=function(){this.sMuteInfo=""},ve.VoiceMuteJsonInfo.prototype._clone=function(){return new ve.VoiceMuteJsonInfo},ve.VoiceMuteJsonInfo.prototype._write=function(e,t,i){e.writeStruct(t,i)},ve.VoiceMuteJsonInfo.prototype._read=function(e,t,i){return e.readStruct(t,!0,i)},ve.VoiceMuteJsonInfo.prototype.writeTo=function(e){e.writeString(0,this.sMuteInfo)},ve.VoiceMuteJsonInfo.prototype.readFrom=function(e){this.sMuteInfo=e.readString(0,!1,this.sMuteInfo)};var Se=ve,ge=ge||{};ge.UriMapping={1400:Se.MessageNotice,8001:Se.EndLiveNotice,1035100:Se.LiveViewLimitChangeNotice,12e5:Se.VoiceMuteJsonInfo,1200001:Se.PixelateInfo},ge.WupMapping={OnUserEvent:Se.UserEventRsp,doLaunch:Se.LiveLaunchRsp,getWebdbUserInfo:Se.GetWebdbUserInfoRsp,OnUserHeartBeat:Se.UserHeartBeatRsp,getLiveViewLimitInfo:Se.GetLiveViewLimitInfoRsp,getOrderBroadcastConfig:Se.GetOrderBroadcastInfoRsp};var Te=ge;function Pe(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var Ee=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.DEBUG_IP="testws.va.huya.com",this.DEFAULT_IP="ws.api.huya.com",this.CDN_IP="cdnws.api.huya.com",this.WSS_DEBUG_IP="testws.va.huya.com",this.WSS_DEFAULT_IP="wsapi.huya.com",this.WSS_CDN_IP="cdnws.api.huya.com",this.connected=!1,this.ws=null,this.url="",this.wsType=0,this.listeners={},this.lockType=null,this.delayRemove={},this.requestID=0,l.wsConnectTime=Date.now(),C.log("开始连接WebSocket："+(l.wsConnectTime-l.beginTime)),this._testws=localStorage._testws,this._testws&&""!=this._testws||l.ISDEBUG?this.connecting():this.testWsIp(),setTimeout(function(){l.wsIps.unshift(l.isHttps()?this.WSS_CDN_IP:this.CDN_IP),this.connecting()}.bind(this),5e3)}var t,i,s;return t=e,(i=[{key:"testWsIp",value:function(){var e;l.isHttps()?(e=o.getDns(),delete localStorage.wssdns):(e=o.getIps(),delete localStorage.wssips);var t=e.length;0==t&&this.connecting();for(var i=!1,s=[],r=function(e){var t=e.currentTarget,s=t.ip;t.onopen=t.onclose=t.onerror=void 0,i?(l.wsIps.push(s),C.log("@@@ good ws",s),t.close()):(i=!0,C.log("%c@@@ good ws "+s,"background:#FFFBE6"),this.url=(l.isHttps()?"wss://":"ws://")+s,this.connecting(t),this.onopen())},a=function(e){var r=e.currentTarget.ip;-1==s.indexOf(r)&&(s.push(r),C.warn("@@@ bad ws",r)),s.length!=t||i||this.connecting()},n=0;n<t;n++){var h=e[n];C.log("@@@ test ws",h);var u=new WebSocket((l.isHttps()?"wss://":"ws://")+h);u.ip=h,u.onopen=r.bind(this),u.onclose=a.bind(this),u.onerror=a.bind(this)}}},{key:"connecting",value:function(e){if(!this.connected){if(this.ws){this.releaseWs(this.ws);var t=this.url.replace(l.isHttps()?"wss://":"ws://","");1==this.wsType?l.wsIps.push(t):2==this.wsType&&l.httpWs.push(t)}if(e)this.ws=e,this.wsType=1;else{var i="",s=localStorage._testws;s&&""!=s?(this.wsType=3,i=s):(this.wsType=0,i=l.isHttps()?this.WSS_DEFAULT_IP:this.DEFAULT_IP,l.ISDEBUG?(this.wsType=4,i=this.DEBUG_IP,i=l.isHttps()?this.WSS_DEBUG_IP:this.DEBUG_IP):l.wsIps.length>0?(this.wsType=1,i=l.wsIps.shift()):l.httpWs.length>0&&(this.wsType=2,i=l.httpWs.shift())),this.url=(l.isHttps()?"wss://":"ws://")+i,this.ws=new WebSocket(this.url)}this.ws.onopen=this.onopen.bind(this),this.ws.onclose=this.onclose.bind(this),this.ws.onerror=this.onerror.bind(this),this.ws.onmessage=this.onmessage.bind(this),C.log("%cconnecting "+this.url)}}},{key:"releaseWs",value:function(e){if(e){C.log("===== releaseWs =====",e),e.onopen=e.onclose=e.onerror=e.onmessage=void 0;try{e.close()}catch(e){}}}},{key:"reconnetWS",value:function(){l.wsconnected||(l.reConnectTimes=0,this.connecting())}},{key:"send",value:function(e){this.ws&&this.connected&&this.ws.send(e)}},{key:"onopen",value:function(){C.log("=== WebSocket Connected ==="),l.loginRegister=!1,l.wsurl=this.url.replace(l.isHttps()?"wss://":"ws://",""),l.wsconnected||0!=l.reConnectTimes||(l.wsConnectTime=Date.now()-l.wsConnectTime),this.connected=!0,l.wsconnected=!0,this.VerifyCookie(),f.fireEvent("WEBSOCKET_CONNECTED")}},{key:"onclose",value:function(e){this.connected=!1,l.wsconnected=!1;var t=this.url.replace(l.isHttps()?"wss://":"ws://","");-1==l.badWsIps.indexOf(t)&&(l.badWsIps.push(t),l.badCode.push(e.code),l.badReason=e.reason),C.log("%c=== WebSocket Closed ===","font-size:120%",e),C.log("%cbadIp "+t,"color:white;background:black;"),l.reConnectTimes++,l.reConnectTimes<10?(C.log("%c=== WebSocket 重连"+l.reConnectTimes+"... ===","font-size:120%"),this.connecting()):C.log("%c=== WebSocket重连次数超标 ===","font-size:120%")}},{key:"onerror",value:function(e){this.connected=!1,l.wsconnected=!1,C.log("%c=== WebSocket Error ===","font-size:120%",e)}},{key:"onmessage",value:function(e){var t=this,i=new FileReader;i.onload=function(){t.decodeTaf(i)},i.readAsArrayBuffer(e.data)}},{key:"decodeTaf",value:function(e){var t=e.result;localStorage.__wup>1&&ye.Util.jcestream(t,32);var i=new ye.JceInputStream(t),s=new Se.WebSocketCommand;switch(s.readFrom(i),s.iCmdType){case Se.EWebSocketCommandType.EWSCmdS2C_RegisterGroupRsp:i=new ye.JceInputStream(s.vData.buffer);var r=new Se.WSRegisterGroupRsp;r.readFrom(i),this.dispatch("rspregisterGroup".concat(s.lRequestId),r);break;case Se.EWebSocketCommandType.EWSCmdS2C_UnRegisterGroupRsp:i=new ye.JceInputStream(s.vData.buffer);var a=new Se.WSUnRegisterGroupRsp;a.readFrom(i),this.dispatch("rspUnRegisterGroup".concat(s.lRequestId),a);break;case Se.EWebSocketCommandType.EWSCmd_WupRsp:var n=new ye.Wup;n.decode(s.vData.buffer);var o=n.sFuncName,h=Te.WupMapping[o];if(h){var u=new h,l=n.newdata.get("tRsp")?"tRsp":"tResp";n.readStruct(l,u,h),C.log("%c<<<<<<< %crspWup:%c "+o,this.logcss("#0000E3"),this.logcss("black"),this.logcss("#0000E3"),n.sServantName,u),this.dispatch(o,u)}else"OnUserHeartBeat"!=o&&C.log("收到未映射的 WupRsp，sFuncName="+o);break;case Se.EWebSocketCommandType.EWSCmdS2C_MsgPushReq:i=new ye.JceInputStream(s.vData.buffer);var d=new Se.WSPushMessage;d.readFrom(i);var c=d.iUri;i=new ye.JceInputStream(d.sMsg.buffer);var p=Te.UriMapping[d.iUri];if(p){var f=new p;f.readFrom(i),C.log(c,f),this.dispatch(c,f)}break;case Se.EWebSocketCommandType.EWSCmdS2C_HeartBeatAck:C.log("%c<<<<<<< rspHeartBeat: "+Date.now());break;case Se.EWebSocketCommandType.EWSCmdS2C_VerifyCookieRsp:i=new ye.JceInputStream(s.vData.buffer);var m=new Se.WSVerifyCookieRsp;m.readFrom(i);var _=0==m.iValidate;C.log("%c<<<<<<< %cVerifyCookie","校验"+(_?"通过！":"失败！"),m);break;case Se.EWebSocketCommandType.EWSCmdS2C_MsgPushReq_V2:i=new ye.JceInputStream(s.vData.buffer);var y=new Se.WSPushMessage_V2;y.readFrom(i);for(var v=y.vMsgItem.value.length,S=0;S<v;S++){var g=y.vMsgItem.value[S],T=g.iUri,P=Te.UriMapping[T];if(P){var E=new P,w=new ye.JceInputStream(g.sMsg);E.readFrom(w),C.log(T,E),this.dispatch(T,E)}}break;default:C.log("%c<<<<<<< Not matched CmdType: "+s.iCmdType)}}},{key:"logcss",value:function(e){return"color:"+e+";font-weight:900"}},{key:"VerifyCookie",value:function(){var e=o.getCookie("yyuid");if(""!=e){var t=new Se.WSVerifyCookieReq;t.lUid=e,t.sUA=l.VER,t.sCookie=document.cookie,t.sGuid=o.getCookie("guid"),t.bAutoRegisterUid=1;var i=new ye.JceOutputStream;t.writeTo(i);var s=new Se.WebSocketCommand;s.iCmdType=Se.EWebSocketCommandType.EWSCmdC2S_VerifyCookieReq,s.vData=i.getBinBuffer(),i=new ye.JceOutputStream,s.writeTo(i),this.send(i.getBuffer()),C.log("%c>>>>>>> %cVerifyCookie:",t)}}},{key:"getTokenBeforeSendWup",value:function(e,t,i){reqTicket((function(s){this.sendWup(e,t,i,s)}))}},{key:"sendWup",value:function(e,t,i){C.log("%c>>>>>>> %creqWup: %c"+t,this.logcss("#009100"),this.logcss("black"),this.logcss("#009100"),e,i);var s=new ye.Wup;s.setServant(e),s.setFunc(t),s.writeStruct("tReq",i);var r=new Se.WebSocketCommand;r.iCmdType=Se.EWebSocketCommandType.EWSCmd_WupReq,r.vData=s.encode();var a=new ye.JceOutputStream;r.writeTo(a),this.send(a.getBuffer())}},{key:"sendWup2",value:function(e,t,i,s){var r=this;"function"==typeof s&&this.addListener(t,(function e(i){s(i),r.removeListener(t,e)})),this.sendWup(e,t,i)}},{key:"sendRegisterGroup",value:function(e,t){var i=this,s=this.getRequestId(),r="rspregisterGroup".concat(s);"function"==typeof t&&this.addListener(r,(function e(s){t(s),i.removeListener(r,e),C.log("%c>>>>>>> rspregisterGroup: %c",i.logcss("#009100"),i.logcss("black"),s)}));var a=Se.EWebSocketCommandType.EWSCmdC2S_RegisterGroupReq;this.sendWebSocketCommand(e,a,s),C.log("%c>>>>>>> sendRegisterGroup: %c",this.logcss("#009100"),this.logcss("black"),e)}},{key:"sendUnRegisterGroup",value:function(e,t){var i=this,s=this.getRequestId(),r="rspUnRegisterGroup".concat(s);"function"==typeof t&&this.addListener(r,(function e(s){t(s),i.removeListener(r,e),C.log("%c>>>>>>> rspUnRegisterGroup: %c",i.logcss("#009100"),i.logcss("black"),s)}));var a=Se.EWebSocketCommandType.EWSCmdC2S_UnRegisterGroupReq;this.sendWebSocketCommand(e,a,s),C.log("%c>>>>>>> sendUnRegisterGroup: %c",this.logcss("#009100"),this.logcss("black"),e)}},{key:"sendWebSocketCommand",value:function(e,t,i){var s=new ye.JceOutputStream;e.writeTo(s);var r=new Se.WebSocketCommand;r.iCmdType=t,r.vData=s.getBinBuffer(),i&&(r.lRequestId=i),s=new ye.JceOutputStream,r.writeTo(s),this.send(s.getBuffer())}},{key:"registerUri",value:function(e,t){Te.UriMapping[e+""]||(Te.UriMapping[e+""]=t)}},{key:"registerUriMap",value:function(e){for(var t in e){var i=e[t];Te.UriMapping[t+""]||(Te.UriMapping[t+""]=i)}}},{key:"registerWup",value:function(e,t){Te.WupMapping[e]||(Te.WupMapping[e]=t)}},{key:"registerWupMap",value:function(e){for(var t in e){var i=e[t];Te.WupMapping[t]||(Te.WupMapping[t]=i)}}},{key:"getTaf",value:function(){return ye}},{key:"getUserId",value:function(){return l.userId}},{key:"addListener",value:function(e,t){if(void 0===this.listeners[e]&&(this.listeners[e]=[]),"function"==typeof t){for(var i=this.listeners[e],s=0,r=i.length;s<r;s++)if(i[s]===t)return this;i.push(t)}return this}},{key:"removeListener",value:function(e,t){if(null!=e&&e===this.lockType)return void 0===this.delayRemove[e]&&(this.delayRemove[e]=[]),this.delayRemove[e].push(t),this;var i=this.listeners[e];if(i instanceof Array)if("function"==typeof t){for(var s=0,r=i.length;s<r;s++)if(i[s]===t){i.splice(s,1);break}0==i.length&&delete this.listeners[e]}else null==t&&delete this.listeners[e];return this}},{key:"dispatch",value:function(e,t){this.lockType=e;var i=this.listeners[e];if(i instanceof Array){for(var s=0,r=i.length;s<r;s++){var a=i[s];"function"==typeof a&&a(t)}i.length}if(this.lockType=null,(i=this.delayRemove[e])instanceof Array){for(var n=0,o=i.length;n<o;n++)this.removeListener(e,i[n]);delete this.delayRemove[e]}return this}},{key:"getRequestId",value:function(){return this.requestID++,this.requestID}}])&&Pe(t.prototype,i),s&&Pe(t,s),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Ce(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var we=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.taf=new Ee(t),this.tokenTimeId=0,this.isDoLaunch=!1,this.heartElapseTime=0,this.heartReqTime=0,this.userHeartBeatHandler=0,this.interval=60,this.isUserIn=!1,this.isSetTaf=!1,this.vplayer=t,l.userId=new Se.UserId,l.userId.lUid=l.yyuid,l.userId.sGuid=o.getCookie("guid"),l.userId.sToken="",l.userId.sHuYaUA="webh5&"+l.VER+"&home",l.userId.sCookie=document.cookie,f.addEvent(f.WEBSOCKET_CONNECTED,this.onWebSocketInited.bind(this)),f.addEvent(f.DATA_METRIC2,this.onDataMetric2.bind(this)),f.addEvent(f.VIDEO_PLAY,this.onVideoPlay.bind(this)),f.addEvent(f.VIDEO_PAUSE,this.onVideoPause.bind(this)),this.taf.addListener("8001",this.endLive.bind(this))}var t,i,s;return t=e,(i=[{key:"onVideoPlay",value:function(){this.isUserIn||this.OnUserEvent(!0)}},{key:"onVideoPause",value:function(){this.isUserIn&&this.OnUserEvent(!1)}},{key:"endLive",value:function(){l.hasVideo=!1,f.fireEvent(f.SERVICE_STOP_VIDEO),D.show()}},{key:"onWebSocketInited",value:function(){this.doLaunch(),this.isSetTaf||(this.isSetTaf=!0,this.vplayer.vcore.setTafHandler(this.taf))}},{key:"doLaunch",value:function(){if(!this.isDoLaunch){this.isDoLaunch=!0;var e=new Se.LiveLaunchReq;e.tId=l.userId,e.tLiveUB.eSource=Se.ELiveSource.WEB_HUYA,l.isHttps()&&(e.bSupportDomain=1),this.taf.sendWup2("liveui","doLaunch",e,this.onDoLaunch.bind(this))}}},{key:"onDoLaunch",value:function(e){l.serverTimeGap=1e3*e.iTime-Date.now(),l.userId.sGuid=e.sGuid;for(var t=e.vProxyList.value,i=0,s=t.length;i<s;i++){var r=t[i];if(5==r.eProxyType){var a=r.sProxy.value;if(1==a.length&&a[0]==this.taf.DEBUG_IP)break;l.isHttps()?o.storeDns(a):o.storeIps(a);break}}this.registerGroup()}},{key:"registerGroup",value:function(){var e=this;if(l.pid){var t=new Se.WSRegisterGroupReq;t.vGroupId.value.push("chat:"+l.pid),t.vGroupId.value.push("live:"+l.pid),this.taf.sendRegisterGroup(t,(function(){e.afterRegister()}))}}},{key:"afterRegister",value:function(){var e=new Se.EnterChannelReq;e.tUserId=l.userId,e.lTid=l.topsid,e.lSid=l.subsid,this.taf.sendWup("ActivityUIServer","OnClientReady",e),this.getWebdbUserInfo(),this.userIn(),this.OnUserEvent(!0)}},{key:"unRegisterGroup",value:function(){var e=new Se.WSUnRegisterGroupReq;e.vGroupId.value.push("chat:"+l.pid),e.vGroupId.value.push("live:"+l.pid),this.taf.sendUnRegisterGroup(e)}},{key:"getWebdbUserInfo",value:function(){var e=new Se.GetWebdbUserInfoReq;e.lUid=l.yyuid,e.lImid=0,e.sPassport=o.getCookie("username"),e.sAccount=0,e.bCacheFirst=!0,this.taf.sendWup2("liveui","getWebdbUserInfo",e,this.ongetWebdbUserInfo)}},{key:"ongetWebdbUserInfo",value:function(e){l.userInfo=e.tUserInfo,f.fireEvent(f.USER_INFO_INITED)}},{key:"userIn",value:function(){var e=new Se.UserChannelReq;e.tId=l.userId,e.lTopcid=l.topsid,e.lSubcid=l.subsid,e.sSendContent="",C.log("订阅频道：",l.topsid,l.subsid),this.taf.sendWup2("liveui","userIn",e,this.onUserIn)}},{key:"onUserIn",value:function(e){l.userIn=!0,C.log("<<< 成功进入频道 ",e)}},{key:"OnUserEvent",value:function(e){var t=this,i=new Se.UserEventReq;i.tId=l.userId,i.lTid=l.topsid,i.lSid=l.subsid,i.lShortTid=0,i.eOp=e?1:2,i.sChan="",i.eSource=3,i.lPid=l.pid,i.bWatchVideo=l.hasVideo,i.bAnonymous=!l.isLogin,i.eTemplateType=1,this.isUserIn=e,C.log(e?"进直播间":"退出直播间"),this.taf.sendWup2("onlineui","OnUserEvent",i,(function(e){return t.onUserEventRsp(e)}))}},{key:"onUserEventRsp",value:function(e){var t=this;this.isUserIn&&(C.log("发心跳"),this.interval=1e3*e.iUserHeartBeatInterval,this.interval>0&&(clearInterval(this.userHeartBeatHandler),this.userHeartBeatHandler=setInterval((function(){return t.OnUserHeartBeat()}),this.interval)))}},{key:"OnUserHeartBeat",value:function(){var e=this,t=new Se.UserHeartBeatReq;t.tId=l.userId,t.lTid=l.topsid,t.lSid=l.subsid,t.lShortTid=0,t.lPid=l.pid,t.bWatchVideo=l.hasVideo,t.eLineType=l.videoLine,t.iFps=l.livingInfo?l.livingInfo.tStreamSettingNotice.iFrameRate:0,t.iAttendee=l.iAttendeeCount,t.iLastHeartElapseTime=this.heartElapseTime,this.taf.sendWup2("onlineui","OnUserHeartBeat",t,(function(t){return e.onUserHeartBeatRsp(t)})),this.heartReqTime=(new Date).getTime()}},{key:"onUserHeartBeatRsp",value:function(e){var t=(new Date).getTime();this.heartElapseTime=t-this.heartReqTime}},{key:"onDataMetric2",value:function(e){var t=new Se.MetricDetailSet;t.tId=l.userId;var i=Date.now();for(var s in e)t.vMetricDetail.value.push(this.createDetail(e[s],i));this.sendWupHttp("metric","reportDetailV2",t)}},{key:"createDetail",value:function(e,t){var i=new Se.MetricDetail;return i.sMetricName=e.sMetricName,i.iTS=t,this.fillField(e.vField,i.vFiled.value),this.fillDimension(e.vDimension,i.vDimension.value),this.fillExLog(e.vExLog,i.vExLog.value),i}},{key:"fillField",value:function(e,t){if(e)for(var i in e){var s=new Se.Field;s.sName=i,s.fValue=e[i],t.push(s)}}},{key:"fillDimension",value:function(e,t){var i={anchoruid:l.pid,line:l.iLineIndex,coderate:l.curRate,coderatebps:1e3*l.curRate,gameId:l.gameId,h265:0,p2p:0,experiment:"default",anonymousuid:l.anonymousUid,place:2},s=window.TT_ENV_DETECTOR;s&&s.browser&&(i.browser_name=s.browser.name,i.browser_version=s.browser.version),Object.assign(i,this.getExDim(),e),this.creatDimension(i,t)}},{key:"creatDimension",value:function(e,t){for(var i in e){var s=new Se.Dimension;s.sName=i,s.sValue=e[i],t.push(s)}}},{key:"fillExLog",value:function(e,t){var i=this.getExDim();Object.assign(i,e),this.creatDimension(i,t)}},{key:"getExDim",value:function(){var e="",t="";if(l.streamInfo){var i=l.streamInfo.sFlvUrl.match(/\/\/(.+?)\//i);e=i&&i.length>1?i[1]:"",t=l.streamInfo.sStreamName}return""==e&&(e="cdndomain"),""==t&&(t="stream"),{cdndomain:e,stream:t}}},{key:"sendWupHttp",value:function(e,t,i){var s=new ye.Wup;s.setServant(e),s.setFunc(t),s.writeStruct("tReq",i);var r,a=s.encode().getBuffer(),n=(new Date).getTime();r=l.ISDEBUG&&!localStorage.mytest?"//14.116.171.232:9998":"https://statwup.huya.com",ye.Util.ajax(r+"?timestamp="+n,a,(function(e){C.log("http sucess",e)}),(function(e){C.warn("%c<http fail reqWup>","color:#FF6100",e)}))}},{key:"sendWup",value:function(e,t,i,s){this.taf&&this.taf.sendWup2(e,t,i,s)}}])&&Ce(t.prototype,i),s&&Ce(t,s),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Ie(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var Ae=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.ItemHeight=34,this.TopOffset=0,this.tickHandler=0,this.MAX_WAITING=10,this.alpha=.8,this.danmuPool=[],this.waitingList=[],this.showingList=[],this.lineList=[],this.danmuLine=5,this.visible=!0,this.isLock=!1,this.vWidth=0,this.K=1,this.turnOn(),this.resizeDanmu(),$("#player-video").resize(this.resizeDanmu.bind(this)),t.tafManager.taf.addListener(1400,this.dealDanmu.bind(this))}var t,i,s;return t=e,(i=[{key:"dealDanmu",value:function(e){if(-1!=e.tUserInfo.lUid&&!(0!=e.iShowMode&&2!=e.iShowMode||l.playerConfig.danmu&&0==l.playerConfig.danmu||l.pid!=e.lPid)){var t=e.sContent;if(""!=(t=t.replace(l.regEmoji,""))){var i=e.tUserInfo.lUid==l.yyuid,s=e.tBulletFormat.iFontColor,r=e.tBulletFormat.iFontSize||4;e.tBulletFormat.iTransitionType,this.addDanmu(t,s,r,i)}}}},{key:"getRightDanmuLine",value:function(){for(var e=-1,t=[],i=0;i<this.showingList.length;i++)t.push(this.showingList[i].line);for(i=0;i<this.danmuLine;i++)if(-1==t.indexOf(i)){e=i;break}return e}},{key:"resizeDanmu",value:function(){this.isLock=!0;var e=$("#player-video").width();this.vWidth=e,this.isLock=!1}},{key:"turnOn",value:function(){0==this.tickHandler&&this.visible&&(this.tickHandler=setInterval(this.loop.bind(this),this.FRAME))}},{key:"resizeList",value:function(e,t){for(var i=new Array(t),s=0,r=e.length;s<r&&!(s>=t);s++)i[s]=e[s];return i}},{key:"setVisible",value:function(e){(e=!!e)!=this.visible&&(this.visible=e,this.visible?this.turnOn():(this.waitingList=[],this.showingList=[],this.lineList=new Array(this.danmuLine),this.turnOff()))}},{key:"getVisible",value:function(){return this.visible}},{key:"clear",value:function(){for(var e in this.showingList){var t=this.showingList[e];t&&t.div&&t.div.remove(),t=null}$("#danmudiv").empty(),this.showingList=[],this.waitingList=[]}},{key:"doColor",value:function(e){if(this.color=parseInt(e+""),isNaN(this.color)||-1==this.color)this.color="#FFFFFF";else{for(this.color=this.color.toString(16);this.color.length<6;)this.color="0"+this.color;this.color="#"+this.color}return this.color.toUpperCase()}},{key:"doSize",value:function(e){return this.size=parseInt(e+""),this.size?(this.size=Math.max(this.size,1),this.size=Math.min(this.size,7),this.size=18+2*this.size):this.size=26,this.size}},{key:"addDanmu",value:function(e,t,i,s){if(this.visible&&e){var r={type:1,msg:e,color:t=this.doColor(t),size:i,isSelf:s,line:0,top:0,isWhite:"#FFFFFF"==t};s?this.waitingList.unshift(r):(this.waitingList.push(r),this.dropSomeItems(this.waitingList,this.MAX_WAITING)),this.turnOn()}}},{key:"dropSomeItems",value:function(e,t){if(e&&!(t<1)){var i=e.length;if(!(i<this.MAX_WAITING+t)){for(var s=[],r=0;r<i&&(e[r].isSelf||(s.push(r),s.length!=t));r++);for(;s.length>0;){var a=s.pop();e.splice(a,1)}return s=null,e}}}},{key:"turnOff",value:function(){clearInterval(this.tickHandler),this.tickHandler=0,this.clear()}},{key:"loop",value:function(){this.loopDanmu()}},{key:"loopDanmu",value:function(e){if(!this.isLock){for(var t=0;t<this.danmuLine&&0!=this.waitingList.length;t++){var i=this.getRightDanmuLine(),s=this.lineList[t],r=void 0;if(-1!=i){var a=0;(r=this.waitingList.shift()).size=24;var n=o.getStringLength(r.msg);r.width=n*r.size,s&&s.width<r.width&&(a=(r.width-s.width)*this.K),r.dvalue=a,r.line=i,r.top=i*this.ItemHeight+this.TopOffset,r.canUse=!1,this.lineList[i]=r,this.creatDanmuItem(r),this.showingList.push(r)}else if(!s||1==s.canUse){var h=0;(r=this.waitingList.shift()).size=24,n=o.getStringLength(r.msg),r.width=n*r.size,s&&s.width<r.width&&(h=(r.width-s.width)*this.K),r.dvalue=h,r.line=t,r.top=t*this.ItemHeight+this.TopOffset,r.canUse=!1,this.lineList[t]=r,this.creatDanmuItem(r),this.showingList.push(r)}}this.judgLineCanUse(this.danmuLine,this.lineList),this.deleteDanmu(this.showingList),0==this.waitingList.length+this.showingList.length&&this.turnOff()}}},{key:"judgLineCanUse",value:function(e,t){for(var i=0;i<e;i++){var s=t[i];if(s){var r=s.div.css("transform").replace(/[^0-9\-.,]/g,"").split(",")[4],a=s.width;!s.canUse&&r<this.vWidth-a-100&&(s.canUse=!0)}}}},{key:"deleteDanmu",value:function(e){for(var t=[],i=0,s=e.length;i<s;i++){var r=e[i];r.div.css("transform").replace(/[^0-9\-.,]/g,"").split(",")[4]<=-(r.width-1)&&(r.div.remove(),r.div.isUse=!1,t.push(i))}for(var a=t.length-1;a>=0;a--)e.splice(t[a],1)}},{key:"getDanmuItem",value:function(){for(var e in this.danmuPool)if(this.danmuPool[e]&&0==this.danmuPool[e].isUse)return this.danmuPool[e];return null}},{key:"creatDanmuItem",value:function(e){if(this.visible&&!e.div){var t=this.getDanmuItem();null==t&&((t=$("<div><span></span></div>")).addClass("danmu-item"),this.danmuPool.push(t)),t.css("line-height",this.ItemHeight+"px"),t.isUse=!0,t.find("span").text(e.msg);var i=10+Math.random()/10,s=this.vWidth;e.dvalue&&(s=this.vWidth+e.dvalue),t.css({"-webkit-transition":"transform "+i+"s linear",transition:"transform "+i+"s linear","-webkit-transform":"translateX("+s+"px)",transform:"translateX("+s+"px)",top:e.top,"font-size":e.size,color:e.color,opacity:this.alpha}),e.isSelf&&t.css({border:"1.5px solid #FFF"}),e.div=t,$("#danmudiv").append(e.div);var r=e.div.width();e.width=r,e.div.css({"-webkit-transform":"translateX("+-r+"px)",transform:"translateX("+-r+"px)"})}}},{key:"stopdanmu",value:function(){clearInterval(this.testHandler)}}])&&Ie(t.prototype,i),s&&Ie(t,s),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Re(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var ke=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.vplayer=t,this.reqDanmu()}var t,i,s;return t=e,(i=[{key:"reqDanmu",value:function(){l.showDanmu=!0,l.danmuStatus=1,this.showDanmuUI()}},{key:"showDanmuUI",value:function(){this.isShow=!0,this.danmuBtn=$("#player-danmu-btn"),this.danmuBtn.show(),this.danmu=new Ae(this.vplayer),this.danmuBtn.click(this.toggleDanmu.bind(this))}},{key:"toggleDanmu",value:function(e){this.isShow=!this.isShow,l.isShowDanmu=this.isShow,this.isShow?(this.danmuBtn.attr("title","关闭弹幕"),this.danmuBtn.removeClass("danmu-hide-btn")):(this.danmuBtn.attr("title","开启弹幕"),this.danmuBtn.addClass("danmu-hide-btn")),this.danmu.setVisible(this.isShow)}},{key:"clearDanmu",value:function(){l.showDanmu&&this.danmu.clear()}},{key:"setDanmuVisible",value:function(e){this.danmu.setVisible(e)}}])&&Re(t.prototype,i),s&&Re(t,s),Object.defineProperty(t,"prototype",{writable:!1}),e}();function be(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var De=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.vplayer=t,this.isInLiveRoom="isInLiveRoom",f.addEvent(f.VIDEO_PLAY,this.startCheck.bind(this))}var t,i,s;return t=e,(i=[{key:"startCheck",value:function(){o.setCookie(this.isInLiveRoom,"",365,".huya.com"),clearInterval(this.tickHandler),this.tickHandler=setInterval(this.checkInLiveRoom.bind(this),2e3)}},{key:"checkInLiveRoom",value:function(){this.isInRoom=o.getCookie(this.isInLiveRoom),this.isInRoom&&""!=this.isInRoom&&(f.fireEvent(f.PAUSE_VIDEO),clearInterval(this.tickHandler))}}])&&be(t.prototype,i),s&&be(t,s),Object.defineProperty(t,"prototype",{writable:!1}),e}();i("Kv1T");function Oe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Fe(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var Le=function(){function e(){var t=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Oe(this,e),this.udbAnonymousUid="";try{this.udbAnonymousUid=localStorage.udbAnonymousUid}catch(e){}this.udbAnonymousUid||(this.udbAnonymousUid=this.uuid(13,10),this.getScript("https://a.msstatic.com/huya/hd/cdn_libs/hyudbwebsdk_2.0.2.js",(function(){HyUDBWebSDK.init({appid:i.appid||5002,domain:i.domain||"huya.com",loadFunc:{login:!0,register:!1,thrid:!1,security:!1,api:!1},success:function(){t.anonymous()},error:function(e){console.log(e)}})})))}var t,i,s;return t=e,(i=[{key:"uuid",value:function(e,t){var i,s,r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),a=[];if(t=t||r.length,e)for(i=0;i<e;i++)a[i]=r[0|Math.random()*t];else for(a[8]=a[13]=a[18]=a[23]="-",a[14]="4",i=0;i<36;i++)a[i]||(s=0|16*Math.random(),a[i]=r[19==i?3&s|8:s]);return a.join("")}},{key:"anonymous",value:function(){HyUDBWebSDK.Login.anonymous({success:function(e){if(e&&0===e.returnCode&&e.data)try{localStorage.udbAnonymousUid=e.data.uid}catch(e){}},error:function(e){console.log(e)}})}},{key:"getScript",value:function(e,t){var i=document.getElementsByTagName("head")[0]||document.documentElement,s=document.createElement("script");s.type="text/javascript",s.async=!0,s.charset="utf-8",s.src=e,s.onload=s.onreadystatechange=function(){s.readyState&&!/loaded|complete/.test(s.readyState)||(t&&t(),s.onload=s.onreadystatechange=null,s.parentNode&&s.parentNode.removeChild(s))},i.insertBefore(s,null)}}])&&Fe(t.prototype,i),s&&Fe(t,s),Object.defineProperty(t,"prototype",{writable:!1}),e}(),Be=i("Jcgu"),Ne=i.n(Be);function Me(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var Ue=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.vplayer=t,this.tip=$(Ne()()),$("#player-wrap").append(this.tip),this.txtmsg=this.tip.find(".content"),this.txttitle=this.tip.find(".title"),this.vipBtn=this.tip.find("#player-vip-btn-open"),this.loginBtn=this.tip.find("#player-vip-btn-login"),this.vipBtn.click(this.clickVipBtn.bind(this)),this.loginBtn.click(this.clickLogin.bind(this))}var t,i,s;return t=e,(i=[{key:"clickVipBtn",value:function(){l.ISDEBUG||(l.config.shortlink2room=l.config.shortlink2room.replace("http:","https:")),window.open(l.config.shortlink2room);var e=this.tipObj,t=e.session_id;if(!e.hasMpExtend){var i={live_id:this.liveId,paylive_id:t,scene:0,room_id:l.profileRoom,anchor_uid:l.pid,game_id:l.gameId};this.vplayer.report.newHuyaReport({eid_desc:"付费直播间解锁按钮点击",eid:"click/unlock_paylive",prop:JSON.stringify(i)},"huya_web")}}},{key:"clickLogin",value:function(){this.vplayer.trigger("webgamelivelogin")}},{key:"show",value:function(){this.tip&&this.tip.show()}},{key:"hide",value:function(){this.tip&&this.tip.hide()}},{key:"setData",value:function(e){var t="",i=e.title;1==e.type?(t=e.msg||"该直播为会员内容，请登录后观看",this.loginBtn.show(),this.vipBtn.hide()):(this.loginBtn.hide(),this.vipBtn.show(),t=e.msg||"开通会员可继续观看"),this.txttitle.text(i),this.txtmsg.text(t),this.tipObj=e;var s=this.tipObj,r=s.session_id;if(!s.hasMpExtend){this.liveId=this.getLiveId();var a={live_id:this.liveId,paylive_id:r,scene:0,room_id:l.profileRoom,anchor_uid:l.pid,game_id:l.gameId};this.vplayer.report.newHuyaReport({eid_desc:"付费直播间解锁界面曝光",eid:"show/unlock_paylive",prop:JSON.stringify(a)},"huya_web")}}},{key:"getLiveId",value:function(){var e=0;try{var t=this.vplayer.vcore.getLiveInfo();t&&(e=t.gameLiveInfo.liveId)}catch(e){C.log("getLiveId",e)}return e}}])&&Me(t.prototype,i),s&&Me(t,s),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Ve(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var xe=function(){function e(t){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.vplayer=t,this.reqTimeId=0,l.userInfo?this.getLiveViewLimitInfo():f.addEvent(f.USER_INFO_INITED,(function(){i.getLiveViewLimitInfo()})),t.tafManager.taf.addListener("1035100",(function(e){return i.onLiveViewLimitChangeNotice(e)}))}var t,i,s;return t=e,(i=[{key:"getLiveViewLimitInfo",value:function(){var e=this;this.clearTip();var t=new Se.GetLiveViewLimitInfoReq;t.tId=l.userId,t.lPid=l.pid,this.vplayer.sendWup("wupui","getLiveViewLimitInfo",t,(function(t){e.onGetLiveViewLimitInfo(t)}))}},{key:"onGetLiveViewLimitInfo",value:function(e){var t=e.tLimitInfo,i=t.iLimitType,s=t.sLimitMessage,r=t.sLimitTitle,a=t.mpExtend.value,n=(a.highlight_text,a.session_id||0),h=a.is_pay_live||0,u=a.user_view_type||0,l=(a.can_free_watch,{msg:s,title:a.homepage_limit_text||r,session_id:n,is_pay_live:h,user_view_type:u,hasMpExtend:o.objectIsEmpty(a)});0!=i&&(3==i?(l.type=1,this.showTip(l)):1!=i&&2!=i||(l.type=2,this.showTip(l)),f.fireEvent(f.HIDE_LOADING),f.fireEvent(f.PAUSE_VIDEO))}},{key:"onLiveViewLimitChangeNotice",value:function(e){var t=this,i=e.lRandomDelayTimeMs,s=e.lPid;if(!s||s==l.pid){var r=Math.random()*i;clearTimeout(this.reqTimeId),this.reqTimeId=setTimeout((function(){return t.getLiveViewLimitInfo()}),r)}}},{key:"showTip",value:function(e){null==this.tip&&(this.tip=new Ue(this.vplayer)),this.tip.setData(e),this.tip.show()}},{key:"clearTip",value:function(){this.tip&&this.tip.hide()}}])&&Ve(t.prototype,i),s&&Ve(t,s),Object.defineProperty(t,"prototype",{writable:!1}),e}();function He(e){return(He="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var We={storeDns:function(e){for(var t="",i=this.getIpsKey(!0),s=e.join("|").toLocaleLowerCase(),r=0,a=s.length;r<a;r++){var n=i[s.charAt(r)],o=Math.random()*n.length>>0;t+=n.charAt(o)}localStorage.wssdns=t},getDns:function(){var e=localStorage.wssdns;if(!e)return[];for(var t="",i=this.getIpsKey(!1),s=0,r=e.length;s<r;s++){t+=i[e.charAt(s)]}return t.split("|")},storeIps:function(e){for(var t="",i=this.getIpsKey(!0),s=e.join("|").toLocaleLowerCase(),r=0,a=s.length;r<a;r++){var n=i[s.charAt(r)],o=Math.random()*n.length>>0;t+=n.charAt(o)}localStorage.wssips=t},getIps:function(){var e=localStorage.wssips;if(!e)return[];for(var t="",i=this.getIpsKey(!1),s=0,r=e.length;s<r;s++){t+=i[e.charAt(s)]}return t.split("|")},getIpsKey:function(e){for(var t=["-",".",":","|"],i="_N1Y%/ny^6?Mi7|wCe#$VmT=.GBut]3L*f<acX2Eop>d}WqKPQ@r;zx!s`(:IHFRZ~[A{Jb-O&D)v0Ukj95,8lg+h4S",s={},r=0;r<40;r++){var a=r<11?3:2,n=i.substr(0,a);i=i.substr(a);var o=r+"";if(r>13?o=String.fromCharCode(r+83):r>9&&(o=t[r-10]),e)s[o]=n;else for(var h=0;h<n.length;h++){s[n.charAt(h)]=o}}return s},compareVersion:function(e,t){for(var i=(e+"").split("."),s=(t+"").split("."),r=i.length,a=s.length,n=Math.min(i.length,s.length),o=0;o<n;o++){var h=parseInt(i[o]),u=parseInt(s[o]);if(h!=u)return h-u}return r==a?0:r-a},deepCopy:function(e,t){t=t||{};for(var i in e)null!=e[i]&&"object"==He(e[i])?(t[i]=e[i].constructor===Array?[]:{},this.deepCopy(e[i],t[i])):t[i]=e[i];return t},NoDrag:function(e,t){t.ondragstart=function(){return!1}},NoSelect:function(e,t){t.onselectstart=function(){return!1}},setCookie:function(e,t,i,s){var r=new Date;r.setTime(r.getTime()+24*i*60*60*1e3);var a=e+"="+t+"; "+("expires="+r.toUTCString());s&&(a+="; domain="+s),document.cookie=a},getCookie:function(e){for(var t=e+"=",i=document.cookie.split(";"),s=0,r=i.length;s<r;s++){var a=i[s].trim();if(0==a.indexOf(t))return a.substr(t.length)}return""},clearCookie:function(e){setCookie(e,"",-1)},getQueryString:function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),i=window.location.search.substr(1).match(t);return null!=i?unescape(i[2]):null},getPos:function(e){var t=document.documentElement.scrollTop||document.body.scrollTop,i=document.documentElement.scrollLeft||document.body.scrollLeft,s=e.getBoundingClientRect();return{top:s.top+t,left:s.left+i,right:s.right+i,bottom:s.bottom+t}},parseQueryString:function(e){for(var t=/([^\?\=\&]+)\=([^\?\=\&]*)/g,i={};t.exec(e);)i[RegExp.$1]=RegExp.$2;return i},getStringLength:function(e){for(var t=0,i=e,s=/[^\x00-\xff]/,r=0;r<i.length;r++){var a=i.charAt(r);1==s.test(a)?t+=2:t+=1}return t=Math.ceil(t/2)},unescapeHTML:function(e){return(e=""+e).replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&apos;/g,"'")},objectIsEmpty:function(e){return 0===Object.keys(e).length},padNum:function(e,t){var i=e.toString().length;return"0".repeat(t-i)+e},getDateTimeStr:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:NaN,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=null,s=(i=e?new Date(e):new Date).getFullYear(),r=We.padNum(i.getMonth()+1,2),a=We.padNum(i.getDate(),2),n=We.padNum(i.getHours(),2),o=We.padNum(i.getMinutes(),2),h=We.padNum(i.getSeconds(),2),u="".concat(s,"-").concat(r,"-").concat(a," ").concat(n,":").concat(o,":").concat(h);if(t){var l=We.padNum(i.getMilliseconds(),3);u+="."+l}return u}},Ge=We;function je(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var Ye=function(){function e(t,i){var s=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),$('<div id="video-pixelate-box"></div>').appendTo($("#player-video"));var r=document.querySelector("#video-pixelate-box");l.hasVideoPiexlate=!0,l.h5player.setVideoPixelateData({config:i}),l.h5player.setVideoPixelateBox(r),t.tafManager.taf.addListener(1200001,(function(e){return s.onPixelateInfo(e)}))}var t,i,s;return t=e,(i=[{key:"onPixelateInfo",value:function(e){var t=e.shapeInfos.buffer,i=new ye.JceInputStream(t),s=new Se.SafeRoiMaskProto;s.readFrom(i),e.shapeInfos=s,l.h5player.pushVideoPixlateInfo(e)}}])&&je(t.prototype,i),s&&je(t,s),Object.defineProperty(t,"prototype",{writable:!1}),e}();function qe(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var Je=function(){function e(t){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.vplayer=t,this.streamName="",this.videoPixelate=null,this.groupList=[],l.userInfo?this.getOrderBroadcastConfig():f.addEvent(f.USER_INFO_INITED,(function(){i.getOrderBroadcastConfig()})),f.addEvent(f.NEW_VIDEO,(function(){i.getOrderBroadcastConfig()}))}var t,i,s;return t=e,(i=[{key:"getOrderBroadcastConfig",value:function(){var e=this;if(l.streamInfo&&this.streamName!=l.streamInfo.sStreamName){this.streamName=l.streamInfo.sStreamName,this.unRegisterAllGroup();var t=new Se.GetOrderBroadcastInfoReq;t.anthorId=l.pid,t.busses.value=["voice_mute","video_pixelate"],t.streamName=this.streamName,this.vplayer.sendWup("mediaui","getOrderBroadcastConfig",t,(function(t){e.onGetOrderBroadcastConfig(t)}))}}},{key:"onGetOrderBroadcastConfig",value:function(e){var t=e.ret,i=e.anthorId,s=e.broadcastInfos;if(0==t&&i==l.pid){var r=s.value;for(var a in r){var n=r[a],o=n.buss,h=n.enable,u=n.broadcastGroup,d=n.configJson;if(!(h<1)){switch(o){case"voice_mute":break;case"video_pixelate":var c={};try{c=Ge.unescapeHTML(d),c=JSON.parse(c)}catch(e){}this.creatVideoPixelate(c)}this.registerGroup(u)}}}}},{key:"creatVideoPixelate",value:function(e){null==this.videoPixelate&&(this.videoPixelate=new Ye(this.vplayer,e))}},{key:"registerGroup",value:function(e){this.groupList.push(e);var t=new Se.WSRegisterGroupReq;t.vGroupId.value.push(e),this.vplayer.tafManager.taf.sendRegisterGroup(t)}},{key:"unRegisterAllGroup",value:function(){if(!(this.groupList.length<=0)){var e=new Se.WSUnRegisterGroupReq;for(var t in this.groupList)e.vGroupId.value.push(this.groupList[t]);this.vplayer.tafManager.taf.sendUnRegisterGroup(e)}}}])&&qe(t.prototype,i),s&&qe(t,s),Object.defineProperty(t,"prototype",{writable:!1}),e}();function ze(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var Ke=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!t)throw new Error("VPlayer初始化缺少参数！");l.config=t,l.VER="2308081431",C.log("%ch5player_"+l.VER,"color:white;background:black;",t);var i=o.getQueryString("topSid"),s=o.getQueryString("sid"),a=o.getQueryString("appid"),n=o.getQueryString("from"),h=o.getQueryString("dev")||0;l.topsid=parseInt(i||t.chTopId),l.subsid=parseInt(s||t.subChId),l.appid=parseInt(a||t.vappid),l.from=n||"",l.pid=parseInt(t.profile)||0,l.gameId=parseInt(t.gameId)||0,l.profileRoom=parseInt(t.profileRoom)||0,l.pidList=t.pidList,l.slidesKey=t.slidesKey,l.domain_list=t.domain_list||[];try{var u=-1!=location.host.indexOf("test");l.ISDEBUG=u||h;var d=t.playerConfig;d=o.unescapeHTML(d),l.playerConfig=JSON.parse(d)}catch(e){C.log("playerConfig error",e)}var c=0;try{if(l.yyuid<=0){var p=new Le;c=parseInt(p.udbAnonymousUid),l.anonymousUid=c}}catch(e){C.log("获取匿名uid错误",e)}$(t.idDom).css("height","100%"),$(r()()).appendTo(t.idDom),this.report=new me,this.vcore=new B(this),this.vcore.initH5player(),this.ctrl=new ne(this),this.ctrl.init(),new pe,(new De).startCheck(),h&&this.testPlay(),this.tafManager=new we(this),this.aiModule=new Je(this),this.barrage=new ke(this),this.vip=new xe(this),document.querySelector(t.idDom).oncontextmenu=function(){return!1}}var t,i,s;return t=e,(i=[{key:"switchTo",value:function(e){C.log("=========== switchTo",e),this.tafManager&&this.tafManager.unRegisterGroup(),f.fireEvent(f.HIDE_BITRATE),l.config=$.extend(l.config,e),l.topsid=parseInt(e.chTopId),l.subsid=parseInt(e.subChId),l.appid=parseInt(e.vappid),l.pid=parseInt(e.profile)||0,l.gameId=parseInt(e.gameId)||0,l.profileRoom=parseInt(e.profileRoom)||0,l.domain_list=e.domain_list||[],this.barrage.clearDanmu(),this.tafManager&&this.tafManager.registerGroup(),this.vip&&this.vip.getLiveViewLimitInfo(),f.fireEvent(f.SHOW_LOADING),this.vcore.stop(),f.fireEvent(f.VIDEO_PLAY),this.ctrl&&this.ctrl.turnPlayButtonOn()}},{key:"tongjiReady",value:function(e){this.report.tongjiReady(e)}},{key:"setVideoData",value:function(e){l.videoData=e.data,0!=l.videoData.length?(l.isCsdnTokenTimeout=!1,this.vcore.checkTimeOut(),this.vcore.play(),C.log("setVideoData",e)):this.vcore.getCdnToken()}},{key:"testPlay",value:function(){l.streamInfo={},l.streamInfo.sFlvUrl="http://test-al.flv.huya.com/src",l.streamInfo.sStreamName="1099511667849-1099511667849-172112224452608-2199023459154-10060-A-0-1",l.streamInfo.sFlvAntiCode="wsSecret=46a487046323f8deba5ad4ca86cbc7a5&wsTime=64a7d71a&fm=RFdxOEJjSjNoNkRKdDZUWV8kMF8kMV8kMl8kMw%3D%3D&ctype=huya_webh5&fs=bgct",this.vcore.testPlay()}},{key:"sendWup",value:function(e,t,i,s){this.tafManager&&this.tafManager.sendWup(e,t,i,s)}}])&&ze(t.prototype,i),s&&ze(t,s),Object.defineProperty(t,"prototype",{writable:!1}),e}();de.mixTo(Ke);t.default=Ke;window.VPlayer=Ke},EO7y:function(module,exports){module.exports=function anonymous(locals,escapeFn,include,rethrow){rethrow=rethrow||function(e,t,i,s,r){var a=t.split("\n"),n=Math.max(s-3,0),o=Math.min(a.length,s+3),h=r(i),u=a.slice(n,o).map((function(e,t){var i=t+n+1;return(i==s?" >> ":"    ")+i+"| "+e})).join("\n");throw e.path=h,e.message=(h||"ejs")+":"+s+"\n"+u+"\n\n"+e.message,e},escapeFn=escapeFn||function(e){return null==e?"":String(e).replace(_MATCH_HTML,encode_char)};var _ENCODE_HTML_RULES={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},_MATCH_HTML=/[&<>'"]/g;function encode_char(e){return _ENCODE_HTML_RULES[e]||e}var __line=1,__lines='<div class="player-recommend" id="player-recommend">\r\n    <img class="player-recommend-bg" id="player-recommend-bg" src="">\r\n    <div class="player-recommend-bg-cover"></div>\r\n    <div class="player-recommend-container">\r\n        <p class="player-recommend-title">\r\n            主播正在赶来的路上！ 下面的内容同样精彩~\r\n        </p>\r\n        <div class="player-recommend-list">\r\n            <ul></ul>\r\n        </div>\r\n    </div>\r\n</div>\r\n',__filename="src\\tpl\\recommend.ejs";try{var __output="";function __append(e){null!=e&&(__output+=e)}with(locals||{})__append('<div class="player-recommend" id="player-recommend">\r\n    <img class="player-recommend-bg" id="player-recommend-bg" src="">\r\n    <div class="player-recommend-bg-cover"></div>\r\n    <div class="player-recommend-container">\r\n        <p class="player-recommend-title">\r\n            主播正在赶来的路上！ 下面的内容同样精彩~\r\n        </p>\r\n        <div class="player-recommend-list">\r\n            <ul></ul>\r\n        </div>\r\n    </div>\r\n</div>\r\n'),__line=13;return __output}catch(e){rethrow(e,__lines,__filename,__line,escapeFn)}}},Jcgu:function(module,exports){module.exports=function anonymous(locals,escapeFn,include,rethrow){rethrow=rethrow||function(e,t,i,s,r){var a=t.split("\n"),n=Math.max(s-3,0),o=Math.min(a.length,s+3),h=r(i),u=a.slice(n,o).map((function(e,t){var i=t+n+1;return(i==s?" >> ":"    ")+i+"| "+e})).join("\n");throw e.path=h,e.message=(h||"ejs")+":"+s+"\n"+u+"\n\n"+e.message,e},escapeFn=escapeFn||function(e){return null==e?"":String(e).replace(_MATCH_HTML,encode_char)};var _ENCODE_HTML_RULES={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},_MATCH_HTML=/[&<>'"]/g;function encode_char(e){return _ENCODE_HTML_RULES[e]||e}var __line=1,__lines='<div class="player-vip-tips" id="player-vip-tips">\r\n\t<div class="player-vip-bg"></div>\r\n\t<div class="player-vip-context">\r\n\t\t<div class="title">试看结束</div>\r\n\t\t<div class="content">开通会员观看完整直播</div>\r\n\t\t<div id="player-vip-btn-open" class="player-vip-btn">立即开通</div>\r\n\t\t<div id="player-vip-btn-login" class="player-vip-btn">去登录</div>\r\n\t</div>\r\n</div>\r\n',__filename="src\\tpl\\vip-tip.ejs";try{var __output="";function __append(e){null!=e&&(__output+=e)}with(locals||{})__append('<div class="player-vip-tips" id="player-vip-tips">\r\n\t<div class="player-vip-bg"></div>\r\n\t<div class="player-vip-context">\r\n\t\t<div class="title">试看结束</div>\r\n\t\t<div class="content">开通会员观看完整直播</div>\r\n\t\t<div id="player-vip-btn-open" class="player-vip-btn">立即开通</div>\r\n\t\t<div id="player-vip-btn-login" class="player-vip-btn">去登录</div>\r\n\t</div>\r\n</div>\r\n'),__line=10;return __output}catch(e){rethrow(e,__lines,__filename,__line,escapeFn)}}},"Jk/3":function(module,exports){module.exports=function anonymous(locals,escapeFn,include,rethrow){rethrow=rethrow||function(e,t,i,s,r){var a=t.split("\n"),n=Math.max(s-3,0),o=Math.min(a.length,s+3),h=r(i),u=a.slice(n,o).map((function(e,t){var i=t+n+1;return(i==s?" >> ":"    ")+i+"| "+e})).join("\n");throw e.path=h,e.message=(h||"ejs")+":"+s+"\n"+u+"\n\n"+e.message,e},escapeFn=escapeFn||function(e){return null==e?"":String(e).replace(_MATCH_HTML,encode_char)};var _ENCODE_HTML_RULES={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},_MATCH_HTML=/[&<>'"]/g;function encode_char(e){return _ENCODE_HTML_RULES[e]||e}var __line=1,__lines='<div id="player-login-guide-tip">\r\n    <div class="player-login-guide-close"></div>\r\n    <div class="player-login-guide-text">登录免费享蓝光10M画质<span>&nbsp立即登录</span></div>\r\n</div>\r\n',__filename="src\\tpl\\login-guide-tip.ejs";try{var __output="";function __append(e){null!=e&&(__output+=e)}with(locals||{})__append('<div id="player-login-guide-tip">\r\n    <div class="player-login-guide-close"></div>\r\n    <div class="player-login-guide-text">登录免费享蓝光10M画质<span>&nbsp立即登录</span></div>\r\n</div>\r\n'),__line=5;return __output}catch(e){rethrow(e,__lines,__filename,__line,escapeFn)}}},Kv1T:function(e,t){var i;!function(e,t,i){var s,r=e([]),a=e.resize=e.extend(e.resize,{}),n="setTimeout",o="resize",h=o+"-special-event",u="delay",l="throttleWindow";a[u]=250,a[l]=!0,e.event.special[o]={setup:function(){if(!a[l]&&this[n])return!1;var t=e(this);r=r.add(t),e.data(this,h,{w:t.width(),h:t.height()}),1===r.length&&function t(){s=setTimeout((function(){r.each((function(){var t=e(this),i=t.width(),s=t.height(),r=e.data(this,h);i===r.w&&s===r.h||t.trigger(o,[r.w=i,r.h=s])})),t()}),a[u])}()},teardown:function(){if(!a[l]&&this[n])return!1;var t=e(this);r=r.not(t),t.removeData(h),r.length||clearTimeout(s)},add:function(t){if(!a[l]&&this[n])return!1;var s;function r(t,r,a){var n=e(this),o=e.data(this,h);o&&(o.w=r!==i?r:n.width()),o&&(o.h=a!==i?a:n.height()),s.apply(this,arguments)}if(e.isFunction(t))return s=t,r;s=t.handler,t.handler=r}}}($),(i=$).fn.mousestop=function(e){return this.each((function(){var t,s=0,r=0,a=0,n=0,o=!1,h=this;i(this).mousemove((function(i){a=i.pageX,n=i.pageY,!o&&(t=setInterval((function(){s==a&&r==n&&(clearInterval(t),o=!1,e&&e.call(h)),s=a,r=n}),300)),o=!0})).mouseout((function(){clearInterval(t),o=!1}))}))}},NpRk:function(e,t,i){var s;!function(r){"use strict";function a(e,t){var i=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(i>>16)<<16|65535&i}function n(e,t,i,s,r,n){return a(function(e,t){return e<<t|e>>>32-t}(a(a(t,e),a(s,n)),r),i)}function o(e,t,i,s,r,a,o){return n(t&i|~t&s,e,t,r,a,o)}function h(e,t,i,s,r,a,o){return n(t&s|i&~s,e,t,r,a,o)}function u(e,t,i,s,r,a,o){return n(t^i^s,e,t,r,a,o)}function l(e,t,i,s,r,a,o){return n(i^(t|~s),e,t,r,a,o)}function d(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;var i,s,r,n,d,c=1732584193,p=-271733879,f=-1732584194,m=271733878;for(i=0;i<e.length;i+=16)s=c,r=p,n=f,d=m,c=o(c,p,f,m,e[i],7,-680876936),m=o(m,c,p,f,e[i+1],12,-389564586),f=o(f,m,c,p,e[i+2],17,606105819),p=o(p,f,m,c,e[i+3],22,-1044525330),c=o(c,p,f,m,e[i+4],7,-176418897),m=o(m,c,p,f,e[i+5],12,1200080426),f=o(f,m,c,p,e[i+6],17,-1473231341),p=o(p,f,m,c,e[i+7],22,-45705983),c=o(c,p,f,m,e[i+8],7,1770035416),m=o(m,c,p,f,e[i+9],12,-1958414417),f=o(f,m,c,p,e[i+10],17,-42063),p=o(p,f,m,c,e[i+11],22,-1990404162),c=o(c,p,f,m,e[i+12],7,1804603682),m=o(m,c,p,f,e[i+13],12,-40341101),f=o(f,m,c,p,e[i+14],17,-1502002290),c=h(c,p=o(p,f,m,c,e[i+15],22,1236535329),f,m,e[i+1],5,-165796510),m=h(m,c,p,f,e[i+6],9,-1069501632),f=h(f,m,c,p,e[i+11],14,643717713),p=h(p,f,m,c,e[i],20,-373897302),c=h(c,p,f,m,e[i+5],5,-701558691),m=h(m,c,p,f,e[i+10],9,38016083),f=h(f,m,c,p,e[i+15],14,-660478335),p=h(p,f,m,c,e[i+4],20,-405537848),c=h(c,p,f,m,e[i+9],5,568446438),m=h(m,c,p,f,e[i+14],9,-1019803690),f=h(f,m,c,p,e[i+3],14,-187363961),p=h(p,f,m,c,e[i+8],20,1163531501),c=h(c,p,f,m,e[i+13],5,-1444681467),m=h(m,c,p,f,e[i+2],9,-51403784),f=h(f,m,c,p,e[i+7],14,1735328473),c=u(c,p=h(p,f,m,c,e[i+12],20,-1926607734),f,m,e[i+5],4,-378558),m=u(m,c,p,f,e[i+8],11,-2022574463),f=u(f,m,c,p,e[i+11],16,1839030562),p=u(p,f,m,c,e[i+14],23,-35309556),c=u(c,p,f,m,e[i+1],4,-1530992060),m=u(m,c,p,f,e[i+4],11,1272893353),f=u(f,m,c,p,e[i+7],16,-155497632),p=u(p,f,m,c,e[i+10],23,-1094730640),c=u(c,p,f,m,e[i+13],4,681279174),m=u(m,c,p,f,e[i],11,-358537222),f=u(f,m,c,p,e[i+3],16,-722521979),p=u(p,f,m,c,e[i+6],23,76029189),c=u(c,p,f,m,e[i+9],4,-640364487),m=u(m,c,p,f,e[i+12],11,-421815835),f=u(f,m,c,p,e[i+15],16,530742520),c=l(c,p=u(p,f,m,c,e[i+2],23,-995338651),f,m,e[i],6,-198630844),m=l(m,c,p,f,e[i+7],10,1126891415),f=l(f,m,c,p,e[i+14],15,-1416354905),p=l(p,f,m,c,e[i+5],21,-57434055),c=l(c,p,f,m,e[i+12],6,1700485571),m=l(m,c,p,f,e[i+3],10,-1894986606),f=l(f,m,c,p,e[i+10],15,-1051523),p=l(p,f,m,c,e[i+1],21,-2054922799),c=l(c,p,f,m,e[i+8],6,1873313359),m=l(m,c,p,f,e[i+15],10,-30611744),f=l(f,m,c,p,e[i+6],15,-1560198380),p=l(p,f,m,c,e[i+13],21,1309151649),c=l(c,p,f,m,e[i+4],6,-145523070),m=l(m,c,p,f,e[i+11],10,-1120210379),f=l(f,m,c,p,e[i+2],15,718787259),p=l(p,f,m,c,e[i+9],21,-343485551),c=a(c,s),p=a(p,r),f=a(f,n),m=a(m,d);return[c,p,f,m]}function c(e){var t,i="";for(t=0;t<32*e.length;t+=8)i+=String.fromCharCode(e[t>>5]>>>t%32&255);return i}function p(e){var t,i=[];for(i[(e.length>>2)-1]=void 0,t=0;t<i.length;t+=1)i[t]=0;for(t=0;t<8*e.length;t+=8)i[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return i}function f(e){var t,i,s="0123456789abcdef",r="";for(i=0;i<e.length;i+=1)t=e.charCodeAt(i),r+=s.charAt(t>>>4&15)+s.charAt(15&t);return r}function m(e){return unescape(encodeURIComponent(e))}function _(e){return function(e){return c(d(p(e),8*e.length))}(m(e))}function y(e,t){return function(e,t){var i,s,r=p(e),a=[],n=[];for(a[15]=n[15]=void 0,r.length>16&&(r=d(r,8*e.length)),i=0;16>i;i+=1)a[i]=909522486^r[i],n[i]=1549556828^r[i];return s=d(a.concat(p(t)),512+8*t.length),c(d(n.concat(s),640))}(m(e),m(t))}function v(e,t,i){return t?i?y(t,e):function(e,t){return f(y(e,t))}(t,e):i?_(e):function(e){return f(_(e))}(e)}void 0===(s=function(){return v}.call(t,i,t,e))||(e.exports=s)}()},"Qy2/":function(module,exports){module.exports=function anonymous(locals,escapeFn,include,rethrow){rethrow=rethrow||function(e,t,i,s,r){var a=t.split("\n"),n=Math.max(s-3,0),o=Math.min(a.length,s+3),h=r(i),u=a.slice(n,o).map((function(e,t){var i=t+n+1;return(i==s?" >> ":"    ")+i+"| "+e})).join("\n");throw e.path=h,e.message=(h||"ejs")+":"+s+"\n"+u+"\n\n"+e.message,e},escapeFn=escapeFn||function(e){return null==e?"":String(e).replace(_MATCH_HTML,encode_char)};var _ENCODE_HTML_RULES={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},_MATCH_HTML=/[&<>'"]/g;function encode_char(e){return _ENCODE_HTML_RULES[e]||e}var __line=1,__lines='<li yyid=\'<%=yyid%>\' profileRoom=\'<%=profileRoom%>\' privateHost=\'<%=privateHost%>\'>\r\n\t<div class="player-recommend-vbox">\r\n\t\t<img src="<%=screenshot%>" class="player-recommend-video" alt="<%=intro%>" onerror="this.onerror=\'\';this.src=\'//assets.msstatic.com/amkit/p/duya/common/img/default_live.jpg\'">\r\n\t\t<div class="player-recommend-mask">\r\n\t\t\t<i></i><span></span>\r\n\t\t</div>\r\n\t</div>\r\n\t<img src="<%=avatar%>" class="player-recommend-head" alt="<%=nick%>" onerror="this.onerror=\'\';this.src=\'//assets.msstatic.com/amkit/p/duya/common/img/default_profile.jpg\'">\r\n\t<p class="player-recommend-name">\r\n\t\t<%=nick%>\r\n\t</p>\r\n\t<p class="player-recommend-viewers">\r\n\t\t<i></i>\r\n\t\t<span style=\'float: left;\'><%=totalCount%>个观众</span>\r\n\t\t<span style="float: right;"><%=gameName%></span>\r\n\t</p>\r\n</li>\r\n',__filename="src\\tpl\\recommend-item.ejs";try{var __output="";function __append(e){null!=e&&(__output+=e)}with(locals||{})__append("<li yyid='"),__append(escapeFn(yyid)),__append("' profileRoom='"),__append(escapeFn(profileRoom)),__append("' privateHost='"),__append(escapeFn(privateHost)),__append('\'>\r\n\t<div class="player-recommend-vbox">\r\n\t\t<img src="'),__line=3,__append(escapeFn(screenshot)),__append('" class="player-recommend-video" alt="'),__append(escapeFn(intro)),__append('" onerror="this.onerror=\'\';this.src=\'//assets.msstatic.com/amkit/p/duya/common/img/default_live.jpg\'">\r\n\t\t<div class="player-recommend-mask">\r\n\t\t\t<i></i><span></span>\r\n\t\t</div>\r\n\t</div>\r\n\t<img src="'),__line=8,__append(escapeFn(avatar)),__append('" class="player-recommend-head" alt="'),__append(escapeFn(nick)),__append('" onerror="this.onerror=\'\';this.src=\'//assets.msstatic.com/amkit/p/duya/common/img/default_profile.jpg\'">\r\n\t<p class="player-recommend-name">\r\n\t\t'),__line=10,__append(escapeFn(nick)),__append("\r\n\t</p>\r\n\t<p class=\"player-recommend-viewers\">\r\n\t\t<i></i>\r\n\t\t<span style='float: left;'>"),__line=14,__append(escapeFn(totalCount)),__append('个观众</span>\r\n\t\t<span style="float: right;">'),__line=15,__append(escapeFn(gameName)),__append("</span>\r\n\t</p>\r\n</li>\r\n"),__line=18;return __output}catch(e){rethrow(e,__lines,__filename,__line,escapeFn)}}},Wgyc:function(module,exports){module.exports=function anonymous(locals,escapeFn,include,rethrow){rethrow=rethrow||function(e,t,i,s,r){var a=t.split("\n"),n=Math.max(s-3,0),o=Math.min(a.length,s+3),h=r(i),u=a.slice(n,o).map((function(e,t){var i=t+n+1;return(i==s?" >> ":"    ")+i+"| "+e})).join("\n");throw e.path=h,e.message=(h||"ejs")+":"+s+"\n"+u+"\n\n"+e.message,e},escapeFn=escapeFn||function(e){return null==e?"":String(e).replace(_MATCH_HTML,encode_char)};var _ENCODE_HTML_RULES={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},_MATCH_HTML=/[&<>'"]/g;function encode_char(e){return _ENCODE_HTML_RULES[e]||e}var __line=1,__lines='<div class="player-panel" id="player-panel-feedback">\r\n    <h2>问题反馈</h2>\r\n    <span class="player-panel-close" title="关闭 ">\r\n    </span>\r\n    <div class="player-panel-content">\r\n    </div>\r\n</div>\r\n',__filename="src\\tpl\\Panel.ejs";try{var __output="";function __append(e){null!=e&&(__output+=e)}with(locals||{})__append('<div class="player-panel" id="player-panel-feedback">\r\n    <h2>问题反馈</h2>\r\n    <span class="player-panel-close" title="关闭 ">\r\n    </span>\r\n    <div class="player-panel-content">\r\n    </div>\r\n</div>\r\n'),__line=8;return __output}catch(e){rethrow(e,__lines,__filename,__line,escapeFn)}}},bQv4:function(module,exports){module.exports=function anonymous(locals,escapeFn,include,rethrow){rethrow=rethrow||function(e,t,i,s,r){var a=t.split("\n"),n=Math.max(s-3,0),o=Math.min(a.length,s+3),h=r(i),u=a.slice(n,o).map((function(e,t){var i=t+n+1;return(i==s?" >> ":"    ")+i+"| "+e})).join("\n");throw e.path=h,e.message=(h||"ejs")+":"+s+"\n"+u+"\n\n"+e.message,e},escapeFn=escapeFn||function(e){return null==e?"":String(e).replace(_MATCH_HTML,encode_char)};var _ENCODE_HTML_RULES={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},_MATCH_HTML=/[&<>'"]/g;function encode_char(e){return _ENCODE_HTML_RULES[e]||e}var __line=1,__lines='<ul>\r\n    <li class="player-pause-btn" id="player-btn" title="暂停观看"></li>\r\n    <li class="player-refresh-btn" title="刷新视频"></li>\r\n</ul>\r\n<div class="player-play-big"></div>\r\n<div id="player-play-tips" class="tip-bg-common">\r\n    <i>点击“播放”按钮，即可观看精彩的直播内容哟</i>\r\n</div>\r\n<div class="player-ctrl-btn">\r\n    <div class="player-report-btn" title="问题反馈"></div>\r\n    <div class="player-sound">\r\n        <div class="player-sound-on" id="player-sound-btn" title="音量"></div>\r\n        <div class="sound-progress">\r\n            <span class="sound-bg"></span>\r\n            <span class="sound-bar" style="width:50%;"></span>\r\n            <span class="sound-btn" style="left:50%;"></span>\r\n        </div>\r\n    </div>\r\n    <div id="player-danmu-btn" class="danmu-show-btn" title="关闭弹幕">\r\n        <span class="danmu-btn-quan"></span>\r\n        <span class="danmu-btn-txt">弹幕</span>\r\n    </div>\r\n    <div class="player-enter-room" id="player-enter-room" title="进入直播间">\r\n        <div class="enter-room-arrow"></div>\r\n        <span>进入直播间</span>\r\n    </div>\r\n</div>\r\n<div class="player-tip" id="player-tip">\r\n    <div id="player-tip-pause">已暂停</div>\r\n    <div id="player-tip-loading">\r\n        <span class="h5player-loading"></span>直播加载中\r\n    </div>\r\n    <div id="player-tip-refresh">\r\n        <span class="h5player-loading"></span>直播刷新中\r\n    </div>\r\n    <div id="player-tip-play">播放中</div>\r\n</div>',__filename="src\\tpl\\ctrl.ejs";try{var __output="";function __append(e){null!=e&&(__output+=e)}with(locals||{})__append('<ul>\r\n    <li class="player-pause-btn" id="player-btn" title="暂停观看"></li>\r\n    <li class="player-refresh-btn" title="刷新视频"></li>\r\n</ul>\r\n<div class="player-play-big"></div>\r\n<div id="player-play-tips" class="tip-bg-common">\r\n    <i>点击“播放”按钮，即可观看精彩的直播内容哟</i>\r\n</div>\r\n<div class="player-ctrl-btn">\r\n    <div class="player-report-btn" title="问题反馈"></div>\r\n    <div class="player-sound">\r\n        <div class="player-sound-on" id="player-sound-btn" title="音量"></div>\r\n        <div class="sound-progress">\r\n            <span class="sound-bg"></span>\r\n            <span class="sound-bar" style="width:50%;"></span>\r\n            <span class="sound-btn" style="left:50%;"></span>\r\n        </div>\r\n    </div>\r\n    <div id="player-danmu-btn" class="danmu-show-btn" title="关闭弹幕">\r\n        <span class="danmu-btn-quan"></span>\r\n        <span class="danmu-btn-txt">弹幕</span>\r\n    </div>\r\n    <div class="player-enter-room" id="player-enter-room" title="进入直播间">\r\n        <div class="enter-room-arrow"></div>\r\n        <span>进入直播间</span>\r\n    </div>\r\n</div>\r\n<div class="player-tip" id="player-tip">\r\n    <div id="player-tip-pause">已暂停</div>\r\n    <div id="player-tip-loading">\r\n        <span class="h5player-loading"></span>直播加载中\r\n    </div>\r\n    <div id="player-tip-refresh">\r\n        <span class="h5player-loading"></span>直播刷新中\r\n    </div>\r\n    <div id="player-tip-play">播放中</div>\r\n</div>'),__line=37;return __output}catch(e){rethrow(e,__lines,__filename,__line,escapeFn)}}},nfRe:function(module,exports){module.exports=function anonymous(locals,escapeFn,include,rethrow){rethrow=rethrow||function(e,t,i,s,r){var a=t.split("\n"),n=Math.max(s-3,0),o=Math.min(a.length,s+3),h=r(i),u=a.slice(n,o).map((function(e,t){var i=t+n+1;return(i==s?" >> ":"    ")+i+"| "+e})).join("\n");throw e.path=h,e.message=(h||"ejs")+":"+s+"\n"+u+"\n\n"+e.message,e},escapeFn=escapeFn||function(e){return null==e?"":String(e).replace(_MATCH_HTML,encode_char)};var _ENCODE_HTML_RULES={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},_MATCH_HTML=/[&<>'"]/g;function encode_char(e){return _ENCODE_HTML_RULES[e]||e}var __line=1,__lines='<div class="player-wrap" id="player-wrap">\r\n    <div class="player-video" id="player-video">\r\n        <div id="danmudiv">\r\n        </div>\r\n    </div>\r\n    <div class="player-loading" id="player-loading">\r\n        <div class="player-loading-logo"></div>\r\n        <div class="player-loading-progress" alt="进度条">\r\n            <img src="">\r\n        </div>\r\n    </div>\r\n    <div id="player-recommend-wrap"></div>\r\n    <div class="player-ctrl-wrap" id="player-ctrl-wrap"></div>\r\n    <div class="player-enter-room-center" id="player-enter-room-center">\r\n        <span>进入直播间</span>\r\n    </div>\r\n    <div class="player-common-toast"></div>\r\n</div>\r\n',__filename="src\\tpl\\VPlayer.ejs";try{var __output="";function __append(e){null!=e&&(__output+=e)}with(locals||{})__append('<div class="player-wrap" id="player-wrap">\r\n    <div class="player-video" id="player-video">\r\n        <div id="danmudiv">\r\n        </div>\r\n    </div>\r\n    <div class="player-loading" id="player-loading">\r\n        <div class="player-loading-logo"></div>\r\n        <div class="player-loading-progress" alt="进度条">\r\n            <img src="">\r\n        </div>\r\n    </div>\r\n    <div id="player-recommend-wrap"></div>\r\n    <div class="player-ctrl-wrap" id="player-ctrl-wrap"></div>\r\n    <div class="player-enter-room-center" id="player-enter-room-center">\r\n        <span>进入直播间</span>\r\n    </div>\r\n    <div class="player-common-toast"></div>\r\n</div>\r\n'),__line=19;return __output}catch(e){rethrow(e,__lines,__filename,__line,escapeFn)}}},zsW8:function(module,exports){module.exports=function anonymous(locals,escapeFn,include,rethrow){rethrow=rethrow||function(e,t,i,s,r){var a=t.split("\n"),n=Math.max(s-3,0),o=Math.min(a.length,s+3),h=r(i),u=a.slice(n,o).map((function(e,t){var i=t+n+1;return(i==s?" >> ":"    ")+i+"| "+e})).join("\n");throw e.path=h,e.message=(h||"ejs")+":"+s+"\n"+u+"\n\n"+e.message,e},escapeFn=escapeFn||function(e){return null==e?"":String(e).replace(_MATCH_HTML,encode_char)};var _ENCODE_HTML_RULES={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},_MATCH_HTML=/[&<>'"]/g;function encode_char(e){return _ENCODE_HTML_RULES[e]||e}var __line=1,__lines='<ul>\r\n</ul>\r\n<p>请描述你遇到的问题：</p>\r\n<textarea wrap="virtual" spellcheck="false" placeholder="请描述你遇到的问题，方便我们快速定位。"></textarea>\r\n<p>你的QQ号是：</p>\r\n<input type="tel" placeholder="以便我们为你提供更好的直播体验。" />\r\n<button id="feedback-submit">提交反馈</button>\r\n<p id="feedback-tip"></p>\r\n<form name="feedback-form" id="feedback-form">\r\n    <input type="text" name="nyy" id="feeback-nyy">\r\n    <input type="text" name="fbl" id="feeback-log">\r\n</form>\r\n\x3c!--先屏蔽QQ反馈，说不一定哪天又要加回去--\x3e\r\n\x3c!-- <p id="feedback-footer">更多反馈请加入QQ群：419429819&nbsp;<span></span></p> --\x3e\r\n',__filename="src\\tpl\\feedback.ejs";try{var __output="";function __append(e){null!=e&&(__output+=e)}with(locals||{})__append('<ul>\r\n</ul>\r\n<p>请描述你遇到的问题：</p>\r\n<textarea wrap="virtual" spellcheck="false" placeholder="请描述你遇到的问题，方便我们快速定位。"></textarea>\r\n<p>你的QQ号是：</p>\r\n<input type="tel" placeholder="以便我们为你提供更好的直播体验。" />\r\n<button id="feedback-submit">提交反馈</button>\r\n<p id="feedback-tip"></p>\r\n<form name="feedback-form" id="feedback-form">\r\n    <input type="text" name="nyy" id="feeback-nyy">\r\n    <input type="text" name="fbl" id="feeback-log">\r\n</form>\r\n\x3c!--先屏蔽QQ反馈，说不一定哪天又要加回去--\x3e\r\n\x3c!-- <p id="feedback-footer">更多反馈请加入QQ群：419429819&nbsp;<span></span></p> --\x3e\r\n'),__line=15;return __output}catch(e){rethrow(e,__lines,__filename,__line,escapeFn)}}}});