var b$=b$||{};b$.universal=b$.universal||{},b$.universal.widgets=b$.universal.widgets||{},b$.universal.widgets.StructuredContentOverlays=function(M){"use strict";define("tc-overlay",function(H,e,t){t.exports={tcOverlay:function(l,e,n,a,t){var d,o;M.ajax({url:e,success:function(e){var t=e;if(d=t.pageId,null!=t.TextArray)for(var o=0;o<t.TextArray.length;o++)t.TextArray[o].bodyBorderTop&&M(l.htmlNode).find(".tc-overlay .main-body .main-container:eq("+o+")").addClass("sections-border"),M(l.htmlNode).find(".tc-overlay .main-container:nth-child("+(o+1)+") .ind-row").html(t.TextArray[o].richTextItem),M(l.htmlNode).find(".tc-overlay .main-container:nth-child("+(o+1)+") .left-content").html(t.TextArray[o].leftText),M(l.htmlNode).find(".tc-overlay .main-container:nth-child("+(o+1)+") .right-content").html(t.TextArray[o].rightText),M(l.htmlNode).find(".tc-overlay .main-container:nth-child("+(o+1)+") .center-content").html(t.TextArray[o].centerText);M(l.htmlNode).find(".tc-overlay .popup-heading").text(t.overlayTitle),t.heading&&M(l.htmlNode).find(".tc-overlay .heading").text(t.heading),M(l.htmlNode).find(".tc-overlay .fb-img-container .left-img .fbleft").text(t.feedbackImgOneText),M(l.htmlNode).find(".tc-overlay .fb-img-container .right-img .fbright").text(t.feedbackImgTwoText),M(l.htmlNode).find(".tc-overlay .fb-img-container .small-gray-text").text(t.thirdPartyNotice),M(l.htmlNode).find(".tc-overlay .download-container .downLabel").text(t.downloadLabel),M(l.htmlNode).find(".tc-overlay .sms-captcha-container .smsLabel").text(t.getSmsLabel)},error:function(e){}}),"tnc"==n?o="overlay-terms-conditions":"downloadApp"==n?o="overlay-download-app":"feedback"==n?o="overlay-feedback":"feesAndCharges"==n?o="overlay-fees-charges":"howToGetStarted"==n&&(o="overlay-get-started"),M(l.htmlNode).find(".tc-overlay").addClass(o),gadgets.pubsub.subscribe("overlayTypeToOpened",function(e){var t=e.overlayType,o=e.sequenceNumber;n==t&&a==o&&("downloadApp"==n&&L(),M(l.htmlNode).find(".cover").css("display","block"),M("body").addClass("noScroll"),M(l.htmlNode).find(".popup-container").addClass("opened"))});function r(){M(l.htmlNode).find(".tc-overlay").hasClass("overlay-download-app")&&(M(l.htmlNode).find(".modal-body").show(),M(l.htmlNode).find(".download-success-container, .download-error-container").hide(),M(l.htmlNode).find(".mobile-number").val(""),M(l.htmlNode).find(".captcha-image").empty(),M(l.htmlNode).find(".captcha-input").val(""),M(l.htmlNode).find(".get-captcha-error").hide(),M(l.htmlNode).find(".get-sms-error").hide(),M(l.htmlNode).find(".country-codes").val(M(".country-codes option:first").val()),M(l.htmlNode).find(".captcha-input").removeClass("captcha-error"))}M(l.htmlNode).find(".tc-overlay .popup-download").on("click",function(){H(["features/%5BBBHOST%5D/feature-hdfc-download-pdf/scripts/html2canvas"]),0<M(l.htmlNode).find(".modal-content .ind-row table").length&&0==M(l.htmlNode).find(".modal-content .ind-row table p").length&&H(["features/%5BBBHOST%5D/feature-hdfc-download-pdf/scripts/pdfmake.min"],function(){H(["features/%5BBBHOST%5D/feature-hdfc-download-pdf/scripts/vfs_fonts"],function(){for(var e,t=M(l.htmlNode).find(".modal-content table")[0],o="",n=0;e=t.rows[n];n++){for(var a,d=0;a=e.cells[d];d++)a.innerText=a.innerText.replace(/^\s+|\s+$/g,""),o=o+" "+a.innerText;o+="\n\n"}var r=M(l.htmlNode).find(".modal-content .modal-header"),i=r.height();html2canvas(r,{onrendered:function(e){var t={pageMargins:[40,0,40,40],content:[{image:e.toDataURL("image/jpeg"),height:i-10,width:595,style:"header"},{text:o}],styles:{header:{margin:[0,0,0,10],alignment:"center"}}};M(l.htmlNode).find(".modal-content").attr("style",""),M("body").attr("style",""),M(l.htmlNode).find(".popup-container.opened").removeClass("download-in-progress"),M(l.htmlNode).find(".modal.popup-container.opened .button-options").show(),pdfMake.createPdf(t).download("download.pdf")}})})})}),M(l.htmlNode).find(".close-button,.logo-section .icon-left-open-big").on("click",function(){M(l.htmlNode).find(".cover").css("display","none"),M("body").removeClass("noScroll"),M(l.htmlNode).find(".popup-container").removeClass("opened"),r()}),gadgets.pubsub.subscribe("overlayClosed",function(){r()}),M(l.htmlNode).find(".popup-print").on("click",function(){M("body").css("visibility","hidden"),window.print(),M("body").css("visibility","visible")});var s,p,h,m,f,i=[],u=[],c=function(e){m=s.height(),f=s.width();for(var o,t=Math.ceil(m/h),n=0;n<t;n++){var a=document.createElement("canvas"),d=a.getContext("2d");a.width=f,a.height=h,p.height<h+5&&(h=p.height-5),a.height=h,d.drawImage(p,0,n*h,f,h+5,0,0,a.width,a.height+5);for(var r=d.getImageData(0,0,a.width,a.height),i=r.data,c=0;c<i.length;c+=4)i[c+3]<255&&(i[c]=255,i[c+1]=255,i[c+2]=255,i[c+3]=255);d.putImageData(r,0,0),u.push(a.toDataURL("image/jpeg"))}o=u.length-1,H(["features/%5BBBHOST%5D/feature-hdfc-download-pdf/scripts/jspdf"],function(){var t=new jsPDF;u.forEach(function(e){t.addImage(e,"JPEG",10,9),o&&t.addPage(),o--}),void 0!==M.browser.safari?t.output("datauri"):t.save(void 0),s.attr("style",""),M("body").attr("style",""),M(l.htmlNode).find(".popup-container.opened").removeClass("download-in-progress"),M(l.htmlNode).find(".modal.popup-container.opened .button-options").show()})},v=function(){new Promise(function(t,e){H(["features/%5BBBHOST%5D/feature-hdfc-download-pdf/scripts/html2canvas"],function(){html2canvas(s,{onrendered:function(e){t(e)}})})}).then(function(e){(p=new Image).src=e.toDataURL("image/jpeg"),p.onload=c})};M(l.htmlNode).find(".tc-overlay .popup-download").on("click",function(){M(l.htmlNode).find(".modal.popup-container.opened .button-options").hide(),(0==M(l.htmlNode).find(".modal-content .ind-row table").length||0<M(l.htmlNode).find(".modal-content .ind-row table p").length)&&(M(l.htmlNode).find(".popup-container.opened").addClass("download-in-progress"),setTimeout(function(){s=M(l.htmlNode).find(".modal-content"),i=[760,888],M(window).outerWidth()<790&&540<M(window).outerWidth()&&(i[0]=550),h=i[1],m=s.height(),M("body").scrollTop(0),(u=[]).length=0,v()},100))});var g=[];M(l.htmlNode).find(".hidden-country-codes li").each(function(){g.push(M(this).text())});for(var b='<select class="form-control country-codes">',y=0;y<g.length;y++)b=b+'<option value="'+g[y]+'">'+g[y]+"</option>";b+="</select>";var N=b$.portal.portalModel.serverURL,w=M('<img class="refresh-icon">');w.attr("src",N+"/static/widgets/%5BBBHOST%5D/widget-hdfc-common-overlays/media/refresh.png");var T=M('<img id ="voice-icon">');T.attr("src",N+"/static/widgets/%5BBBHOST%5D/widget-hdfc-common-overlays/media/voice.png");var x,B,C,D,S,O,P,I;function L(){M.ajax({url:window.location.origin+"/services/proxy/getCaptcha",type:"GET",async:!1,success:function(e){var t=JSON.parse(e);x=t.captchaId,""!=B&&(B=" "),B="data:data/png;base64,"+t.captchaImg,C=t.captchaAudio,(D=M('<img id="captcha-image">')).attr("src",B),""==B||"undefined"==B?M(l.htmlNode).find(".sms-captcha-container").addClass("captcha-not-pres"):(M(l.htmlNode).find(".sms-captcha-container").removeClass("captcha-not-pres"),M(l.htmlNode).find(".captcha-image").append(D))}})}function k(){M(l.htmlNode).find(".captcha-image").empty(),M(l.htmlNode).find(".get-captcha-error").hide(),M(l.htmlNode).find(".get-sms-error").hide(),M(l.htmlNode).find(".captcha-input").removeClass("captcha-error"),L()}function A(){if(""!=I){var e={captchaId:x,mobileNumber:P.trim()+O.trim(),captchaValue:I.trim(),appId:d};e=JSON.stringify(e);var t=window.location.origin+"/services/proxy/verifyCaptcha";M.ajax({method:"POST",url:t,headers:{"Content-Type":"text/plain"},data:e}).done(function(e){var t=JSON.parse(e);0==t.rc.returncode?(M(l.htmlNode).find(".get-sms-error").hide(),M(l.htmlNode).find(".modal-body").hide(),M(l.htmlNode).find(".download-success-container").show()):"A1208"==t.rc.errorcode?(k(),M(l.htmlNode).find(".get-captcha-error").show(),M(l.htmlNode).find(".captcha-input").addClass("captcha-error")):$()}).fail(function(e){$()})}else k(),M(l.htmlNode).find(".get-sms-error").hide(),M(l.htmlNode).find(".get-captcha-error").show(),M(l.htmlNode).find(".captcha-input").addClass("captcha-error")}function $(){M(l.htmlNode).find(".get-sms-error").hide(),M(l.htmlNode).find(".modal-body").hide(),M(l.htmlNode).find(".download-error-container").show()}M(l.htmlNode).find(".get-sms-interaction-code").append(b),M(l.htmlNode).find(".get-sms-interaction").append('<input type="text" name="mobile-number" placeholder="Enter Mobile Number" class="form-control mobile-number" />'),M(l.htmlNode).find(".get-sms-interaction").append('<label class="get-sms-error col-xs-12">Sorry, You have entered an invalid phone number. Please enter your valid phone number.</label>'),M(l.htmlNode).find(".refresh").append(w),M(l.htmlNode).find(".voice").append(T),M(l.htmlNode).find(".captcha-input-val").append('<label class="captcha-text">Type the text displayed above.</label>'),M(l.htmlNode).find(".captcha-input-val").append('<input type="text" name="captcha-input" class="form-control captcha-input"/>'),M(l.htmlNode).find(".captcha-input-val").append('<label class="get-captcha-error col-xs-12">Text did not match. Please type the correct code displayed above.</label>'),M(l.htmlNode).find(".get-sms-btn").append('<a class="btn-primary send-code">GET LINK</a>'),M(l.htmlNode).find(".refresh").click(function(){k()}),M(l.htmlNode).find(".voice").click(function(){var e=new Audio("data:audio/mp3;base64,"+C);e.play(),M(l.htmlNode).find(".close-button,.logo-section .icon-left-open-big").on("click",function(){e.pause()})}),M(l.htmlNode).find(".get-sms-btn").click(function(){S=/^(?:(?:\+|0{0,2})91(\s*[\-]\s*)?|[0]?)?[6789]\d{9}$/i,O=M(l.htmlNode).find(".mobile-number").val(),P=M(l.htmlNode).find(".country-codes option:selected").text(),I=M(l.htmlNode).find(".captcha-input").val(),"91"==P.replace("+","")?S.test(O)?A():(M(l.htmlNode).find(".get-sms-error").show(),M(l.htmlNode).find(".get-captcha-error").hide(),M(l.htmlNode).find(".captcha-input").removeClass("captcha-error")):""!=O||"undefined"==O?""!=I||"undefined"==I?A():(M(l.htmlNode).find(".get-captcha-error").show(),M(l.htmlNode).find(".captcha-input").addClass("captcha-error"),M(l.htmlNode).find(".get-sms-error").hide()):M(l.htmlNode).find(".get-sms-error").show()})}}});var w="cs";return{prefModified:function(e){e.refreshIncludes();var t=M(e.htmlNode);M(".bd-structured-content-widget",t).attr("data-type",e.getPreference("contentType")||"Content")},start:function(r){var n,e=r.getPreference("contentRef"),a=M(r.htmlNode),t=!1;try{top.bd}catch(e){t=!0}for(var o,d=!(!window.be||t)&&be.utils.module("top.bd.PageMgmtTree.selectedLink").isMasterPage||"true"===r.model.manageable||""===r.model.manageable||void 0===r.model.manageable,i=[],c=0;c<r.model.preferences.array.length;c++)"templateUrl"==r.model.preferences.array[c].name&&(o=r.model.preferences.array[c].value);var l=r.getPreference("urlContent"),s=b$.portal.portalModel.serverURL;if(null!=l){var p=l.indexOf("content"),h=l.slice(p,l.length);l=s+"/"+h}var m=b$.portal.portalModel.serverURL,f=m+"/static/features/%5BBBHOST%5D/feature-hdfc-slick-slider/media/pop-close.png";M(".close-icon-url").attr("src",f);var u=m+"/static/features/%5BBBHOST%5D/feature-hdfc-download-pdf/media/print-36-26.png",v=m+"/static/features/%5BBBHOST%5D/feature-hdfc-download-pdf/media/download-36-26.png";M(".tc-overlay .button-options .popup-print img").attr("src",u),M(".tc-overlay .button-options .popup-download img").attr("src",v);var g=m+"/static/widgets/%5BBBHOST%5D/widget-hdfc-common-overlays/media/success-arrow.png",b=m+"/static/widgets/%5BBBHOST%5D/widget-hdfc-common-overlays/media/failure.png";if(M(".tc-overlay .download-success-container img").attr("src",g),M(".tc-overlay .download-error-container img").attr("src",b),null==o&&null==o||(i=o.split("/")),d){e||a.addClass("bd-empty-structured-content"),M(".bd-structured-content-widget",a).attr("data-type",r.getPreference("contentType")||"Content"),r.addEventListener("preferences-form",function(e){for(var t=b$.portal.portalModel.filterPreferences(r.model.preferences.array),o=t.length-1;0<=o;o--)if("Template"==t[o].label)for(var n=r.getPreference("templateList").split(","),a=0,d=0;a<n.length;a++,d++)t[o].inputType.options[d]={label:n[a],value:n[a+1]},a++}),r.addEventListener("bdDrop.enter",function(e){var t=e.detail.info.helper.bdDragData.fileDataArray[0];t.metaData&&t.metaData["cmis:objectTypeId"]&&"bb:structuredcontent"===t.metaData["cmis:objectTypeId"].property?(n=t,a.addClass("bd-over-structured-content")):n=void 0}),r.addEventListener("bdDrop.leave",function(e){a.removeClass("bd-over-structured-content")}),r.addEventListener("bdDrop.drop",function(e){var t=e.detail.info.helper.bdDragData.fileDataArray[0];if(n){if(!r.model.preferences.getByName("contentRef")){var o=b$.portal.portalModel.createPreference("contentRef","contentRef",void 0,"");r.model.preferences.add(o)}r.setPreference("urlContent",t.url),r.setPreference("contentRef",[w,"contentRepository"===n.repository?n.repository:"@portalRepository",n.contentUId].join(":")),r.model.save(function(){r.refreshHTML(),a.removeClass("bd-empty-structured-content")}),a.removeClass("bd-over-structured-content")}n=void 0}),window.bd&&window.bd.bindDropEvents&&window.bd.bindDropEvents(r.htmlNode);var y=r.getPreference("overlayType"),N=r.getPreference("occurrenceSeq");"tc-overlay.html"==i[i.length-1].trim()&&require(["tc-overlay"],function(e){e.tcOverlay(r,l,y,N,s)})}}}}(jQuery);