define(["OK/logger","OK/cookie"],(function(n,t){"use strict";var e,r,u,o,i="garbagelog",l=!1;function a(t){var e=n.repository.getRequestData();e&&OK.sendBeacon("/gwtlog",e)}function c(){l?!0:(!1,a())}function d(n){var t=n.indexOf(".");return-1===t?n:n.substring(0,t)}function f(t,e,r,l,f,s,g){(function(t){if(!t)return!1;var e=d(t);return u.indexOf(e)>=0||(u.indexOf(i)>=0&&n.success(i,e),!1)})(t)&&(l&&!function(n){if(!n)return!1;var t=d(n),e=u.indexOf(t);return e>=0&&e<o}(t)&&(l=null),e?n.repository.addLog(t,parseInt(e,10),r,l,null,g[0],g[1]):n.repository.addLog(t,null,r,l,null,g[0],g[1]),f?a():s&&c())}function s(n,t,e,r,u){f(n,null,t,e,r,!1,u)}function g(n,e,r,u){var o;((o=t.readCookie("dme"))&&"true"===o.toLowerCase()||document.getElementById("__gwtd__m"))&&window.alert("Fatal Error '"+n+"'\nplace='"+r+"'\nerror name='"+u+"'\nCLOB='"+e+"'"),s(n,null,e,!0,[r,u])}function v(t){var e=parseInt(t.getAttribute("data-interval"),10)||1e3,i="true"===t.getAttribute("data-onbeforeunload");o=parseInt(t.getAttribute("data-clobslen"),10)||0,u=JSON.parse(t.firstChild.textContent),n.error=function(n,t){s("error","",null,!1,[t,n])},n.success=function(n,t,e){!function(n,t){f(n,null,null,null,!1,!1,t)}(n,[t,e])},n.force=function(n,t,e){!function(n,t){f(n,null,null,null,!1,!0,t)}(n,[t,e])},n.duration=function(n,t,e,r){!function(n,t,e){f(n,t,null,null,!1,!1,e)}(n,t,[e,r])},n.clob=g,n.raw=function(n,t,e,r){s(n,null,t,!1,[e,r])},n.replayQueue(),r=setInterval(c,e),document.addEventListener("visibilitychange",(function(){"hidden"===document.visibilityState&&a()})),i&&window.addEventListener("beforeunload",(function(){a()}),!1)}return{activate:function(n){e||(v(n),e=!0)},deactivate:function(){r&&(clearInterval(r),r=null)}}}));